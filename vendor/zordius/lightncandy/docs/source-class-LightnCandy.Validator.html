<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="robots" content="noindex">

	<title>File Validator.php</title>

	<link rel="stylesheet" href="resources/style.css?e99947befd7bf673c6b43ff75e9e0f170c88a60e">

</head>

<body>
<div id="left">
	<div id="menu">
		<a href="index.html" title="Overview"><span>Overview</span></a>


		<div id="groups">
				<h3>Namespaces</h3>
			<ul>
				<li>
					<a href="namespace-LightnCandy.html">
						LightnCandy					</a>

						</li>
			</ul>
		</div>

		<hr>


		<div id="elements">
			<h3>Classes</h3>
			<ul>
				<li><a href="class-LightnCandy.Compiler.html">LightnCandy\Compiler</a></li>
				<li><a href="class-LightnCandy.Context.html">LightnCandy\Context</a></li>
				<li><a href="class-LightnCandy.Encoder.html">LightnCandy\Encoder</a></li>
				<li><a href="class-LightnCandy.Exporter.html">LightnCandy\Exporter</a></li>
				<li><a href="class-LightnCandy.Expression.html">LightnCandy\Expression</a></li>
				<li><a href="class-LightnCandy.Flags.html">LightnCandy\Flags</a></li>
				<li><a href="class-LightnCandy.LightnCandy.html">LightnCandy\LightnCandy</a></li>
				<li><a href="class-LightnCandy.Parser.html">LightnCandy\Parser</a></li>
				<li><a href="class-LightnCandy.Partial.html">LightnCandy\Partial</a></li>
				<li><a href="class-LightnCandy.Runtime.html">LightnCandy\Runtime</a></li>
				<li><a href="class-LightnCandy.SafeString.html">LightnCandy\SafeString</a></li>
				<li><a href="class-LightnCandy.StringObject.html">LightnCandy\StringObject</a></li>
				<li><a href="class-LightnCandy.Token.html">LightnCandy\Token</a></li>
				<li><a href="class-LightnCandy.Validator.html">LightnCandy\Validator</a></li>
			</ul>





		</div>
	</div>
</div>

<div id="splitter"></div>

<div id="right">
<div id="rightInner">
	<form id="search">
		<input type="hidden" name="cx" value="">
		<input type="hidden" name="ie" value="UTF-8">
		<input type="text" name="q" class="text" placeholder="Search">
	</form>

	<div id="navigation">
		<ul>
			<li>
				<a href="index.html" title="Overview"><span>Overview</span></a>
			</li>
			<li>
<span>Namespace</span>			</li>
			<li>
<span>Class</span>			</li>
		</ul>
		<ul>
		</ul>
		<ul>
		</ul>
	</div>

<pre><code><span id="1" class="l"><a href="#1">  1: </a><span class="xlang">&lt;?php</span>
</span><span id="2" class="l"><a href="#2">  2: </a><span class="php-comment">/*
</span></span><span id="3" class="l"><a href="#3">  3: </a><span class="php-comment">
</span></span><span id="4" class="l"><a href="#4">  4: </a><span class="php-comment">MIT License
</span></span><span id="5" class="l"><a href="#5">  5: </a><span class="php-comment">Copyright 2013-2019 Zordius Chen. All Rights Reserved.
</span></span><span id="6" class="l"><a href="#6">  6: </a><span class="php-comment">Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the &quot;Software&quot;), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
</span></span><span id="7" class="l"><a href="#7">  7: </a><span class="php-comment">The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
</span></span><span id="8" class="l"><a href="#8">  8: </a><span class="php-comment">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
</span></span><span id="9" class="l"><a href="#9">  9: </a><span class="php-comment">
</span></span><span id="10" class="l"><a href="#10"> 10: </a><span class="php-comment">Origin: https://github.com/zordius/lightncandy
</span></span><span id="11" class="l"><a href="#11"> 11: </a><span class="php-comment">*/</span>
</span><span id="12" class="l"><a href="#12"> 12: </a>
</span><span id="13" class="l"><a href="#13"> 13: </a><span class="php-comment">/**
</span></span><span id="14" class="l"><a href="#14"> 14: </a><span class="php-comment"> * file to keep LightnCandy Validator
</span></span><span id="15" class="l"><a href="#15"> 15: </a><span class="php-comment"> *
</span></span><span id="16" class="l"><a href="#16"> 16: </a><span class="php-comment"> * @package    LightnCandy
</span></span><span id="17" class="l"><a href="#17"> 17: </a><span class="php-comment"> * @author     Zordius &lt;zordius@gmail.com&gt;
</span></span><span id="18" class="l"><a href="#18"> 18: </a><span class="php-comment"> */</span>
</span><span id="19" class="l"><a href="#19"> 19: </a>
</span><span id="20" class="l"><a href="#20"> 20: </a><span class="php-keyword1">namespace</span> LightnCandy;
</span><span id="21" class="l"><a href="#21"> 21: </a>
</span><span id="22" class="l"><a href="#22"> 22: </a><span class="php-comment">/**
</span></span><span id="23" class="l"><a href="#23"> 23: </a><span class="php-comment"> * LightnCandy Validator
</span></span><span id="24" class="l"><a href="#24"> 24: </a><span class="php-comment"> */</span>
</span><span id="25" class="l"><a href="#25"> 25: </a><span class="php-keyword1">class</span> Validator
</span><span id="26" class="l"><a href="#26"> 26: </a>{
</span><span id="27" class="l"><a href="#27"> 27: </a>    <span class="php-comment">/**
</span></span><span id="28" class="l"><a href="#28"> 28: </a><span class="php-comment">     * Verify template
</span></span><span id="29" class="l"><a href="#29"> 29: </a><span class="php-comment">     *
</span></span><span id="30" class="l"><a href="#30"> 30: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context Current context
</span></span><span id="31" class="l"><a href="#31"> 31: </a><span class="php-comment">     * @param string $template handlebars template
</span></span><span id="32" class="l"><a href="#32"> 32: </a><span class="php-comment">     */</span>
</span><span id="33" class="l"><a href="#33"> 33: </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> verify(&amp;<span class="php-var">$context</span>, <span class="php-var">$template</span>)
</span><span id="34" class="l"><a href="#34"> 34: </a>    {
</span><span id="35" class="l"><a href="#35"> 35: </a>        <span class="php-var">$template</span> = SafeString::stripExtendedComments(<span class="php-var">$template</span>);
</span><span id="36" class="l"><a href="#36"> 36: </a>        <span class="php-var">$context</span>[<span class="php-quote">'level'</span>] = <span class="php-num">0</span>;
</span><span id="37" class="l"><a href="#37"> 37: </a>        Parser::setDelimiter(<span class="php-var">$context</span>);
</span><span id="38" class="l"><a href="#38"> 38: </a>
</span><span id="39" class="l"><a href="#39"> 39: </a>        <span class="php-keyword1">while</span> (<span class="php-keyword2">preg_match</span>(<span class="php-var">$context</span>[<span class="php-quote">'tokens'</span>][<span class="php-quote">'search'</span>], <span class="php-var">$template</span>, <span class="php-var">$matches</span>)) {
</span><span id="40" class="l"><a href="#40"> 40: </a>            <span class="php-comment">// Skip a token when it is slash escaped</span>
</span><span id="41" class="l"><a href="#41"> 41: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$context</span>[<span class="php-quote">'flags'</span>][<span class="php-quote">'slash'</span>] &amp;&amp; (<span class="php-var">$matches</span>[Token::POS_LSPACE] === <span class="php-quote">''</span>) &amp;&amp; <span class="php-keyword2">preg_match</span>(<span class="php-quote">'/^(.*?)(\\\\+)$/s'</span>, <span class="php-var">$matches</span>[Token::POS_LOTHER], <span class="php-var">$escmatch</span>)) {
</span><span id="42" class="l"><a href="#42"> 42: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">strlen</span>(<span class="php-var">$escmatch</span>[<span class="php-num">2</span>]) % <span class="php-num">4</span>) {
</span><span id="43" class="l"><a href="#43"> 43: </a>                    <span class="php-keyword1">static</span>::pushToken(<span class="php-var">$context</span>, <span class="php-keyword2">substr</span>(<span class="php-var">$matches</span>[Token::POS_LOTHER], <span class="php-num">0</span>, -<span class="php-num">2</span>) . <span class="php-var">$context</span>[<span class="php-quote">'tokens'</span>][<span class="php-quote">'startchar'</span>]);
</span><span id="44" class="l"><a href="#44"> 44: </a>                    <span class="php-var">$matches</span>[Token::POS_BEGINTAG] = <span class="php-keyword2">substr</span>(<span class="php-var">$matches</span>[Token::POS_BEGINTAG], <span class="php-num">1</span>);
</span><span id="45" class="l"><a href="#45"> 45: </a>                    <span class="php-var">$template</span> = <span class="php-keyword2">implode</span>(<span class="php-quote">''</span>, <span class="php-keyword2">array_slice</span>(<span class="php-var">$matches</span>, Token::POS_BEGINTAG));
</span><span id="46" class="l"><a href="#46"> 46: </a>                    <span class="php-keyword1">continue</span>;
</span><span id="47" class="l"><a href="#47"> 47: </a>                } <span class="php-keyword1">else</span> {
</span><span id="48" class="l"><a href="#48"> 48: </a>                    <span class="php-var">$matches</span>[Token::POS_LOTHER] = <span class="php-var">$escmatch</span>[<span class="php-num">1</span>] . <span class="php-keyword2">str_repeat</span>(<span class="php-quote">'\\'</span>, <span class="php-keyword2">strlen</span>(<span class="php-var">$escmatch</span>[<span class="php-num">2</span>]) / <span class="php-num">2</span>);
</span><span id="49" class="l"><a href="#49"> 49: </a>                }
</span><span id="50" class="l"><a href="#50"> 50: </a>            }
</span><span id="51" class="l"><a href="#51"> 51: </a>            <span class="php-var">$context</span>[<span class="php-quote">'tokens'</span>][<span class="php-quote">'count'</span>]++;
</span><span id="52" class="l"><a href="#52"> 52: </a>            <span class="php-var">$V</span> = <span class="php-keyword1">static</span>::token(<span class="php-var">$matches</span>, <span class="php-var">$context</span>);
</span><span id="53" class="l"><a href="#53"> 53: </a>            <span class="php-keyword1">static</span>::pushLeft(<span class="php-var">$context</span>);
</span><span id="54" class="l"><a href="#54"> 54: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$V</span>) {
</span><span id="55" class="l"><a href="#55"> 55: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$V</span>)) {
</span><span id="56" class="l"><a href="#56"> 56: </a>                    <span class="php-keyword2">array_push</span>(<span class="php-var">$V</span>, <span class="php-var">$matches</span>, <span class="php-var">$context</span>[<span class="php-quote">'tokens'</span>][<span class="php-quote">'partialind'</span>]);
</span><span id="57" class="l"><a href="#57"> 57: </a>                }
</span><span id="58" class="l"><a href="#58"> 58: </a>                <span class="php-keyword1">static</span>::pushToken(<span class="php-var">$context</span>, <span class="php-var">$V</span>);
</span><span id="59" class="l"><a href="#59"> 59: </a>            }
</span><span id="60" class="l"><a href="#60"> 60: </a>            <span class="php-var">$template</span> = <span class="php-quote">&quot;</span><span class="php-var">{$matches[Token::POS_RSPACE]}{$matches[Token::POS_ROTHER]}</span><span class="php-quote">&quot;</span>;
</span><span id="61" class="l"><a href="#61"> 61: </a>        }
</span><span id="62" class="l"><a href="#62"> 62: </a>        <span class="php-keyword1">static</span>::pushToken(<span class="php-var">$context</span>, <span class="php-var">$template</span>);
</span><span id="63" class="l"><a href="#63"> 63: </a>
</span><span id="64" class="l"><a href="#64"> 64: </a>        <span class="php-keyword1">if</span> (<span class="php-var">$context</span>[<span class="php-quote">'level'</span>] &gt; <span class="php-num">0</span>) {
</span><span id="65" class="l"><a href="#65"> 65: </a>            <span class="php-keyword2">array_pop</span>(<span class="php-var">$context</span>[<span class="php-quote">'stack'</span>]);
</span><span id="66" class="l"><a href="#66"> 66: </a>            <span class="php-keyword2">array_pop</span>(<span class="php-var">$context</span>[<span class="php-quote">'stack'</span>]);
</span><span id="67" class="l"><a href="#67"> 67: </a>            <span class="php-var">$token</span> = <span class="php-keyword2">array_pop</span>(<span class="php-var">$context</span>[<span class="php-quote">'stack'</span>]);
</span><span id="68" class="l"><a href="#68"> 68: </a>            <span class="php-var">$context</span>[<span class="php-quote">'error'</span>][] = <span class="php-quote">'Unclosed token '</span> . (<span class="php-var">$context</span>[<span class="php-quote">'rawblock'</span>] ? <span class="php-quote">&quot;{{{{</span><span class="php-var">{$token}</span><span class="php-quote">}}}}&quot;</span> : (<span class="php-var">$context</span>[<span class="php-quote">'partialblock'</span>] ? <span class="php-quote">&quot;{{#&gt;</span><span class="php-var">{$token}</span><span class="php-quote">}}&quot;</span> : <span class="php-quote">&quot;{{#</span><span class="php-var">{$token}</span><span class="php-quote">}}&quot;</span>)) . <span class="php-quote">' !!'</span>;
</span><span id="69" class="l"><a href="#69"> 69: </a>        }
</span><span id="70" class="l"><a href="#70"> 70: </a>    }
</span><span id="71" class="l"><a href="#71"> 71: </a>
</span><span id="72" class="l"><a href="#72"> 72: </a>    <span class="php-comment">/**
</span></span><span id="73" class="l"><a href="#73"> 73: </a><span class="php-comment">     * push left string of current token and clear it
</span></span><span id="74" class="l"><a href="#74"> 74: </a><span class="php-comment">     *
</span></span><span id="75" class="l"><a href="#75"> 75: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context Current context
</span></span><span id="76" class="l"><a href="#76"> 76: </a><span class="php-comment">     */</span>
</span><span id="77" class="l"><a href="#77"> 77: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> pushLeft(&amp;<span class="php-var">$context</span>)
</span><span id="78" class="l"><a href="#78"> 78: </a>    {
</span><span id="79" class="l"><a href="#79"> 79: </a>        <span class="php-var">$L</span> = <span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_LOTHER] . <span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_LSPACE];
</span><span id="80" class="l"><a href="#80"> 80: </a>        <span class="php-keyword1">static</span>::pushToken(<span class="php-var">$context</span>, <span class="php-var">$L</span>);
</span><span id="81" class="l"><a href="#81"> 81: </a>        <span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_LOTHER] = <span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_LSPACE] = <span class="php-quote">''</span>;
</span><span id="82" class="l"><a href="#82"> 82: </a>    }
</span><span id="83" class="l"><a href="#83"> 83: </a>
</span><span id="84" class="l"><a href="#84"> 84: </a>    <span class="php-comment">/**
</span></span><span id="85" class="l"><a href="#85"> 85: </a><span class="php-comment">     * push a string into the partial stacks
</span></span><span id="86" class="l"><a href="#86"> 86: </a><span class="php-comment">     *
</span></span><span id="87" class="l"><a href="#87"> 87: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context Current context
</span></span><span id="88" class="l"><a href="#88"> 88: </a><span class="php-comment">     * @param string $append a string to be appended int partial stacks
</span></span><span id="89" class="l"><a href="#89"> 89: </a><span class="php-comment">     */</span>
</span><span id="90" class="l"><a href="#90"> 90: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> pushPartial(&amp;<span class="php-var">$context</span>, <span class="php-var">$append</span>)
</span><span id="91" class="l"><a href="#91"> 91: </a>    {
</span><span id="92" class="l"><a href="#92"> 92: </a>        <span class="php-var">$appender</span> = <span class="php-keyword1">function</span> (&amp;<span class="php-var">$p</span>) <span class="php-keyword1">use</span> (<span class="php-var">$append</span>) {
</span><span id="93" class="l"><a href="#93"> 93: </a>            <span class="php-var">$p</span> .= <span class="php-var">$append</span>;
</span><span id="94" class="l"><a href="#94"> 94: </a>        };
</span><span id="95" class="l"><a href="#95"> 95: </a>        <span class="php-keyword2">array_walk</span>(<span class="php-var">$context</span>[<span class="php-quote">'inlinepartial'</span>], <span class="php-var">$appender</span>);
</span><span id="96" class="l"><a href="#96"> 96: </a>        <span class="php-keyword2">array_walk</span>(<span class="php-var">$context</span>[<span class="php-quote">'partialblock'</span>], <span class="php-var">$appender</span>);
</span><span id="97" class="l"><a href="#97"> 97: </a>    }
</span><span id="98" class="l"><a href="#98"> 98: </a>
</span><span id="99" class="l"><a href="#99"> 99: </a>    <span class="php-comment">/**
</span></span><span id="100" class="l"><a href="#100">100: </a><span class="php-comment">     * push a token into the stack when it is not empty string
</span></span><span id="101" class="l"><a href="#101">101: </a><span class="php-comment">     *
</span></span><span id="102" class="l"><a href="#102">102: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context Current context
</span></span><span id="103" class="l"><a href="#103">103: </a><span class="php-comment">     * @param string|array $token a parsed token or a string
</span></span><span id="104" class="l"><a href="#104">104: </a><span class="php-comment">     */</span>
</span><span id="105" class="l"><a href="#105">105: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> pushToken(&amp;<span class="php-var">$context</span>, <span class="php-var">$token</span>)
</span><span id="106" class="l"><a href="#106">106: </a>    {
</span><span id="107" class="l"><a href="#107">107: </a>        <span class="php-keyword1">if</span> (<span class="php-var">$token</span> === <span class="php-quote">''</span>) {
</span><span id="108" class="l"><a href="#108">108: </a>            <span class="php-keyword1">return</span>;
</span><span id="109" class="l"><a href="#109">109: </a>        }
</span><span id="110" class="l"><a href="#110">110: </a>        <span class="php-keyword1">if</span> (<span class="php-keyword2">is_string</span>(<span class="php-var">$token</span>)) {
</span><span id="111" class="l"><a href="#111">111: </a>            <span class="php-keyword1">static</span>::pushPartial(<span class="php-var">$context</span>, <span class="php-var">$token</span>);
</span><span id="112" class="l"><a href="#112">112: </a>            <span class="php-var">$append</span> = <span class="php-var">$token</span>;
</span><span id="113" class="l"><a href="#113">113: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">is_string</span>(<span class="php-keyword2">end</span>(<span class="php-var">$context</span>[<span class="php-quote">'parsed'</span>][<span class="php-num">0</span>]))) {
</span><span id="114" class="l"><a href="#114">114: </a>                <span class="php-var">$context</span>[<span class="php-quote">'parsed'</span>][<span class="php-num">0</span>][<span class="php-keyword2">key</span>(<span class="php-var">$context</span>[<span class="php-quote">'parsed'</span>][<span class="php-num">0</span>])] .= <span class="php-var">$token</span>;
</span><span id="115" class="l"><a href="#115">115: </a>                <span class="php-keyword1">return</span>;
</span><span id="116" class="l"><a href="#116">116: </a>            }
</span><span id="117" class="l"><a href="#117">117: </a>        } <span class="php-keyword1">else</span> {
</span><span id="118" class="l"><a href="#118">118: </a>            <span class="php-keyword1">static</span>::pushPartial(<span class="php-var">$context</span>, Token::toString(<span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>]));
</span><span id="119" class="l"><a href="#119">119: </a>            <span class="php-keyword1">switch</span> (<span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_OP]) {
</span><span id="120" class="l"><a href="#120">120: </a>            <span class="php-keyword1">case</span> <span class="php-quote">'#*'</span>:
</span><span id="121" class="l"><a href="#121">121: </a>                <span class="php-keyword2">array_unshift</span>(<span class="php-var">$context</span>[<span class="php-quote">'inlinepartial'</span>], <span class="php-quote">''</span>);
</span><span id="122" class="l"><a href="#122">122: </a>                <span class="php-keyword1">break</span>;
</span><span id="123" class="l"><a href="#123">123: </a>            <span class="php-keyword1">case</span> <span class="php-quote">'#&gt;'</span>:
</span><span id="124" class="l"><a href="#124">124: </a>                <span class="php-keyword2">array_unshift</span>(<span class="php-var">$context</span>[<span class="php-quote">'partialblock'</span>], <span class="php-quote">''</span>);
</span><span id="125" class="l"><a href="#125">125: </a>                <span class="php-keyword1">break</span>;
</span><span id="126" class="l"><a href="#126">126: </a>            }
</span><span id="127" class="l"><a href="#127">127: </a>        }
</span><span id="128" class="l"><a href="#128">128: </a>        <span class="php-var">$context</span>[<span class="php-quote">'parsed'</span>][<span class="php-num">0</span>][] = <span class="php-var">$token</span>;
</span><span id="129" class="l"><a href="#129">129: </a>    }
</span><span id="130" class="l"><a href="#130">130: </a>
</span><span id="131" class="l"><a href="#131">131: </a>    <span class="php-comment">/**
</span></span><span id="132" class="l"><a href="#132">132: </a><span class="php-comment">     * push current token into the section stack
</span></span><span id="133" class="l"><a href="#133">133: </a><span class="php-comment">     *
</span></span><span id="134" class="l"><a href="#134">134: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context Current context
</span></span><span id="135" class="l"><a href="#135">135: </a><span class="php-comment">     * @param string $operation operation string
</span></span><span id="136" class="l"><a href="#136">136: </a><span class="php-comment">     * @param array&lt;boolean|integer|string|array&gt; $vars parsed arguments list
</span></span><span id="137" class="l"><a href="#137">137: </a><span class="php-comment">     */</span>
</span><span id="138" class="l"><a href="#138">138: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> pushStack(&amp;<span class="php-var">$context</span>, <span class="php-var">$operation</span>, <span class="php-var">$vars</span>)
</span><span id="139" class="l"><a href="#139">139: </a>    {
</span><span id="140" class="l"><a href="#140">140: </a>        <span class="php-keyword1">list</span>(<span class="php-var">$levels</span>, <span class="php-var">$spvar</span>, <span class="php-var">$var</span>) = Expression::analyze(<span class="php-var">$context</span>, <span class="php-var">$vars</span>[<span class="php-num">0</span>]);
</span><span id="141" class="l"><a href="#141">141: </a>        <span class="php-var">$context</span>[<span class="php-quote">'stack'</span>][] = <span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_INNERTAG];
</span><span id="142" class="l"><a href="#142">142: </a>        <span class="php-var">$context</span>[<span class="php-quote">'stack'</span>][] = Expression::toString(<span class="php-var">$levels</span>, <span class="php-var">$spvar</span>, <span class="php-var">$var</span>);
</span><span id="143" class="l"><a href="#143">143: </a>        <span class="php-var">$context</span>[<span class="php-quote">'stack'</span>][] = <span class="php-var">$operation</span>;
</span><span id="144" class="l"><a href="#144">144: </a>        <span class="php-var">$context</span>[<span class="php-quote">'level'</span>]++;
</span><span id="145" class="l"><a href="#145">145: </a>    }
</span><span id="146" class="l"><a href="#146">146: </a>
</span><span id="147" class="l"><a href="#147">147: </a>    <span class="php-comment">/**
</span></span><span id="148" class="l"><a href="#148">148: </a><span class="php-comment">     * Verify delimiters and operators
</span></span><span id="149" class="l"><a href="#149">149: </a><span class="php-comment">     *
</span></span><span id="150" class="l"><a href="#150">150: </a><span class="php-comment">     * @param string[] $token detected handlebars {{ }} token
</span></span><span id="151" class="l"><a href="#151">151: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="152" class="l"><a href="#152">152: </a><span class="php-comment">     *
</span></span><span id="153" class="l"><a href="#153">153: </a><span class="php-comment">     * @return boolean|null Return true when invalid
</span></span><span id="154" class="l"><a href="#154">154: </a><span class="php-comment">     *
</span></span><span id="155" class="l"><a href="#155">155: </a><span class="php-comment">     * @expect null when input array_fill(0, 11, ''), array()
</span></span><span id="156" class="l"><a href="#156">156: </a><span class="php-comment">     * @expect null when input array(0, 0, 0, 0, 0, '{{', '#', '...', '}}'), array()
</span></span><span id="157" class="l"><a href="#157">157: </a><span class="php-comment">     * @expect true when input array(0, 0, 0, 0, 0, '{', '#', '...', '}'), array()
</span></span><span id="158" class="l"><a href="#158">158: </a><span class="php-comment">     */</span>
</span><span id="159" class="l"><a href="#159">159: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> delimiter(<span class="php-var">$token</span>, &amp;<span class="php-var">$context</span>)
</span><span id="160" class="l"><a href="#160">160: </a>    {
</span><span id="161" class="l"><a href="#161">161: </a>        <span class="php-comment">// {{ }}} or {{{ }} are invalid</span>
</span><span id="162" class="l"><a href="#162">162: </a>        <span class="php-keyword1">if</span> (<span class="php-keyword2">strlen</span>(<span class="php-var">$token</span>[Token::POS_BEGINRAW]) !== <span class="php-keyword2">strlen</span>(<span class="php-var">$token</span>[Token::POS_ENDRAW])) {
</span><span id="163" class="l"><a href="#163">163: </a>            <span class="php-var">$context</span>[<span class="php-quote">'error'</span>][] = <span class="php-quote">'Bad token '</span> . Token::toString(<span class="php-var">$token</span>) . <span class="php-quote">' ! Do you mean '</span> . Token::toString(<span class="php-var">$token</span>, <span class="php-keyword1">array</span>(Token::POS_BEGINRAW =&gt; <span class="php-quote">''</span>, Token::POS_ENDRAW =&gt; <span class="php-quote">''</span>)) . <span class="php-quote">' or '</span> . Token::toString(<span class="php-var">$token</span>, <span class="php-keyword1">array</span>(Token::POS_BEGINRAW =&gt; <span class="php-quote">'{'</span>, Token::POS_ENDRAW =&gt; <span class="php-quote">'}'</span>)) . <span class="php-quote">'?'</span>;
</span><span id="164" class="l"><a href="#164">164: </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="165" class="l"><a href="#165">165: </a>        }
</span><span id="166" class="l"><a href="#166">166: </a>        <span class="php-comment">// {{{# }}} or {{{! }}} or {{{/ }}} or {{{^ }}} are invalid.</span>
</span><span id="167" class="l"><a href="#167">167: </a>        <span class="php-keyword1">if</span> ((<span class="php-keyword2">strlen</span>(<span class="php-var">$token</span>[Token::POS_BEGINRAW]) == <span class="php-num">1</span>) &amp;&amp; <span class="php-var">$token</span>[Token::POS_OP] &amp;&amp; (<span class="php-var">$token</span>[Token::POS_OP] !== <span class="php-quote">'&amp;'</span>)) {
</span><span id="168" class="l"><a href="#168">168: </a>            <span class="php-var">$context</span>[<span class="php-quote">'error'</span>][] = <span class="php-quote">'Bad token '</span> . Token::toString(<span class="php-var">$token</span>) . <span class="php-quote">' ! Do you mean '</span> . Token::toString(<span class="php-var">$token</span>, <span class="php-keyword1">array</span>(Token::POS_BEGINRAW =&gt; <span class="php-quote">''</span>, Token::POS_ENDRAW =&gt; <span class="php-quote">''</span>)) . <span class="php-quote">' ?'</span>;
</span><span id="169" class="l"><a href="#169">169: </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="170" class="l"><a href="#170">170: </a>        }
</span><span id="171" class="l"><a href="#171">171: </a>    }
</span><span id="172" class="l"><a href="#172">172: </a>
</span><span id="173" class="l"><a href="#173">173: </a>    <span class="php-comment">/**
</span></span><span id="174" class="l"><a href="#174">174: </a><span class="php-comment">     * Verify operators
</span></span><span id="175" class="l"><a href="#175">175: </a><span class="php-comment">     *
</span></span><span id="176" class="l"><a href="#176">176: </a><span class="php-comment">     * @param string $operator the operator string
</span></span><span id="177" class="l"><a href="#177">177: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="178" class="l"><a href="#178">178: </a><span class="php-comment">     * @param array&lt;boolean|integer|string|array&gt; $vars parsed arguments list
</span></span><span id="179" class="l"><a href="#179">179: </a><span class="php-comment">     *
</span></span><span id="180" class="l"><a href="#180">180: </a><span class="php-comment">     * @return boolean|integer|null Return true when invalid or detected
</span></span><span id="181" class="l"><a href="#181">181: </a><span class="php-comment">     *
</span></span><span id="182" class="l"><a href="#182">182: </a><span class="php-comment">     * @expect null when input '', array(), array()
</span></span><span id="183" class="l"><a href="#183">183: </a><span class="php-comment">     * @expect 2 when input '^', array('usedFeature' =&gt; array('isec' =&gt; 1), 'level' =&gt; 0, 'currentToken' =&gt; array(0,0,0,0,0,0,0,0), 'elselvl' =&gt; array(), 'flags' =&gt; array('spvar' =&gt; 0), 'elsechain' =&gt; false, 'helperresolver' =&gt; 0), array(array('foo'))
</span></span><span id="184" class="l"><a href="#184">184: </a><span class="php-comment">     * @expect true when input '/', array('stack' =&gt; array('[with]', '#'), 'level' =&gt; 1, 'currentToken' =&gt; array(0,0,0,0,0,0,0,'with'), 'flags' =&gt; array('nohbh' =&gt; 0)), array(array())
</span></span><span id="185" class="l"><a href="#185">185: </a><span class="php-comment">     * @expect 4 when input '#', array('usedFeature' =&gt; array('sec' =&gt; 3), 'level' =&gt; 0, 'currentToken' =&gt; array(0,0,0,0,0,0,0,0), 'flags' =&gt; array('spvar' =&gt; 0), 'elsechain' =&gt; false, 'elselvl' =&gt; array(), 'helperresolver' =&gt; 0), array(array('x'))
</span></span><span id="186" class="l"><a href="#186">186: </a><span class="php-comment">     * @expect 5 when input '#', array('usedFeature' =&gt; array('if' =&gt; 4), 'level' =&gt; 0, 'currentToken' =&gt; array(0,0,0,0,0,0,0,0), 'flags' =&gt; array('spvar' =&gt; 0, 'nohbh' =&gt; 0), 'elsechain' =&gt; false, 'elselvl' =&gt; array(), 'helperresolver' =&gt; 0), array(array('if'))
</span></span><span id="187" class="l"><a href="#187">187: </a><span class="php-comment">     * @expect 6 when input '#', array('usedFeature' =&gt; array('with' =&gt; 5), 'level' =&gt; 0, 'flags' =&gt; array('nohbh' =&gt; 0, 'runpart' =&gt; 0, 'spvar' =&gt; 0), 'currentToken' =&gt; array(0,0,0,0,0,0,0,0), 'elsechain' =&gt; false, 'elselvl' =&gt; array(), 'helperresolver' =&gt; 0), array(array('with'))
</span></span><span id="188" class="l"><a href="#188">188: </a><span class="php-comment">     * @expect 7 when input '#', array('usedFeature' =&gt; array('each' =&gt; 6), 'level' =&gt; 0, 'currentToken' =&gt; array(0,0,0,0,0,0,0,0), 'flags' =&gt; array('spvar' =&gt; 0, 'nohbh' =&gt; 0), 'elsechain' =&gt; false, 'elselvl' =&gt; array(), 'helperresolver' =&gt; 0), array(array('each'))
</span></span><span id="189" class="l"><a href="#189">189: </a><span class="php-comment">     * @expect 8 when input '#', array('usedFeature' =&gt; array('unless' =&gt; 7), 'level' =&gt; 0, 'currentToken' =&gt; array(0,0,0,0,0,0,0,0), 'flags' =&gt; array('spvar' =&gt; 0, 'nohbh' =&gt; 0), 'elsechain' =&gt; false, 'elselvl' =&gt; array(), 'helperresolver' =&gt; 0), array(array('unless'))
</span></span><span id="190" class="l"><a href="#190">190: </a><span class="php-comment">     * @expect 9 when input '#', array('helpers' =&gt; array('abc' =&gt; ''), 'usedFeature' =&gt; array('helper' =&gt; 8), 'level' =&gt; 0, 'currentToken' =&gt; array(0,0,0,0,0,0,0,0), 'flags' =&gt; array('spvar' =&gt; 0), 'elsechain' =&gt; false, 'elselvl' =&gt; array()), array(array('abc'))
</span></span><span id="191" class="l"><a href="#191">191: </a><span class="php-comment">     * @expect 11 when input '#', array('helpers' =&gt; array('abc' =&gt; ''), 'usedFeature' =&gt; array('helper' =&gt; 10), 'level' =&gt; 0, 'currentToken' =&gt; array(0,0,0,0,0,0,0,0), 'flags' =&gt; array('spvar' =&gt; 0), 'elsechain' =&gt; false, 'elselvl' =&gt; array()), array(array('abc'))
</span></span><span id="192" class="l"><a href="#192">192: </a><span class="php-comment">     * @expect true when input '&gt;', array('partialresolver' =&gt; false, 'usedFeature' =&gt; array('partial' =&gt; 7), 'level' =&gt; 0, 'flags' =&gt; array('skippartial' =&gt; 0, 'runpart' =&gt; 0, 'spvar' =&gt; 0), 'currentToken' =&gt; array(0,0,0,0,0,0,0,0), 'elsechain' =&gt; false, 'elselvl' =&gt; array()), array('test')
</span></span><span id="193" class="l"><a href="#193">193: </a><span class="php-comment">     */</span>
</span><span id="194" class="l"><a href="#194">194: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> operator(<span class="php-var">$operator</span>, &amp;<span class="php-var">$context</span>, &amp;<span class="php-var">$vars</span>)
</span><span id="195" class="l"><a href="#195">195: </a>    {
</span><span id="196" class="l"><a href="#196">196: </a>        <span class="php-keyword1">switch</span> (<span class="php-var">$operator</span>) {
</span><span id="197" class="l"><a href="#197">197: </a>            <span class="php-keyword1">case</span> <span class="php-quote">'#*'</span>:
</span><span id="198" class="l"><a href="#198">198: </a>                <span class="php-keyword1">if</span> (!<span class="php-var">$context</span>[<span class="php-quote">'compile'</span>]) {
</span><span id="199" class="l"><a href="#199">199: </a>                    <span class="php-var">$context</span>[<span class="php-quote">'stack'</span>][] = <span class="php-keyword2">count</span>(<span class="php-var">$context</span>[<span class="php-quote">'parsed'</span>][<span class="php-num">0</span>]) + (<span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_LOTHER] . <span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_LSPACE] === <span class="php-quote">''</span> ? <span class="php-num">0</span> : <span class="php-num">1</span>);
</span><span id="200" class="l"><a href="#200">200: </a>                    <span class="php-keyword1">static</span>::pushStack(<span class="php-var">$context</span>, <span class="php-quote">'#*'</span>, <span class="php-var">$vars</span>);
</span><span id="201" class="l"><a href="#201">201: </a>                }
</span><span id="202" class="l"><a href="#202">202: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">static</span>::inline(<span class="php-var">$context</span>, <span class="php-var">$vars</span>);
</span><span id="203" class="l"><a href="#203">203: </a>
</span><span id="204" class="l"><a href="#204">204: </a>            <span class="php-keyword1">case</span> <span class="php-quote">'#&gt;'</span>:
</span><span id="205" class="l"><a href="#205">205: </a>                <span class="php-keyword1">if</span> (!<span class="php-var">$context</span>[<span class="php-quote">'compile'</span>]) {
</span><span id="206" class="l"><a href="#206">206: </a>                    <span class="php-var">$context</span>[<span class="php-quote">'stack'</span>][] = <span class="php-keyword2">count</span>(<span class="php-var">$context</span>[<span class="php-quote">'parsed'</span>][<span class="php-num">0</span>]) + (<span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_LOTHER] . <span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_LSPACE] === <span class="php-quote">''</span> ? <span class="php-num">0</span> : <span class="php-num">1</span>);
</span><span id="207" class="l"><a href="#207">207: </a>                    <span class="php-var">$vars</span>[Parser::PARTIALBLOCK] = ++<span class="php-var">$context</span>[<span class="php-quote">'usedFeature'</span>][<span class="php-quote">'pblock'</span>];
</span><span id="208" class="l"><a href="#208">208: </a>                    <span class="php-keyword1">static</span>::pushStack(<span class="php-var">$context</span>, <span class="php-quote">'#&gt;'</span>, <span class="php-var">$vars</span>);
</span><span id="209" class="l"><a href="#209">209: </a>                }
</span><span id="210" class="l"><a href="#210">210: </a>                <span class="php-comment">// no break</span>
</span><span id="211" class="l"><a href="#211">211: </a>            <span class="php-keyword1">case</span> <span class="php-quote">'&gt;'</span>:
</span><span id="212" class="l"><a href="#212">212: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">static</span>::partial(<span class="php-var">$context</span>, <span class="php-var">$vars</span>);
</span><span id="213" class="l"><a href="#213">213: </a>
</span><span id="214" class="l"><a href="#214">214: </a>            <span class="php-keyword1">case</span> <span class="php-quote">'^'</span>:
</span><span id="215" class="l"><a href="#215">215: </a>                <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$vars</span>[<span class="php-num">0</span>][<span class="php-num">0</span>])) {
</span><span id="216" class="l"><a href="#216">216: </a>                    <span class="php-keyword1">if</span> (!<span class="php-var">$context</span>[<span class="php-quote">'flags'</span>][<span class="php-quote">'else'</span>]) {
</span><span id="217" class="l"><a href="#217">217: </a>                        <span class="php-var">$context</span>[<span class="php-quote">'error'</span>][] = <span class="php-quote">'Do not support {{^}}, you should do compile with LightnCandy::FLAG_ELSE flag'</span>;
</span><span id="218" class="l"><a href="#218">218: </a>                        <span class="php-keyword1">return</span>;
</span><span id="219" class="l"><a href="#219">219: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="220" class="l"><a href="#220">220: </a>                        <span class="php-keyword1">return</span> <span class="php-keyword1">static</span>::doElse(<span class="php-var">$context</span>, <span class="php-var">$vars</span>);
</span><span id="221" class="l"><a href="#221">221: </a>                    }
</span><span id="222" class="l"><a href="#222">222: </a>                }
</span><span id="223" class="l"><a href="#223">223: </a>
</span><span id="224" class="l"><a href="#224">224: </a>                <span class="php-keyword1">static</span>::doElseChain(<span class="php-var">$context</span>);
</span><span id="225" class="l"><a href="#225">225: </a>
</span><span id="226" class="l"><a href="#226">226: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">static</span>::isBlockHelper(<span class="php-var">$context</span>, <span class="php-var">$vars</span>)) {
</span><span id="227" class="l"><a href="#227">227: </a>                    <span class="php-keyword1">static</span>::pushStack(<span class="php-var">$context</span>, <span class="php-quote">'#'</span>, <span class="php-var">$vars</span>);
</span><span id="228" class="l"><a href="#228">228: </a>                    <span class="php-keyword1">return</span> <span class="php-keyword1">static</span>::blockCustomHelper(<span class="php-var">$context</span>, <span class="php-var">$vars</span>, <span class="php-keyword1">true</span>);
</span><span id="229" class="l"><a href="#229">229: </a>                }
</span><span id="230" class="l"><a href="#230">230: </a>
</span><span id="231" class="l"><a href="#231">231: </a>                <span class="php-keyword1">static</span>::pushStack(<span class="php-var">$context</span>, <span class="php-quote">'^'</span>, <span class="php-var">$vars</span>);
</span><span id="232" class="l"><a href="#232">232: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">static</span>::invertedSection(<span class="php-var">$context</span>, <span class="php-var">$vars</span>);
</span><span id="233" class="l"><a href="#233">233: </a>
</span><span id="234" class="l"><a href="#234">234: </a>            <span class="php-keyword1">case</span> <span class="php-quote">'/'</span>:
</span><span id="235" class="l"><a href="#235">235: </a>                <span class="php-var">$r</span> = <span class="php-keyword1">static</span>::blockEnd(<span class="php-var">$context</span>, <span class="php-var">$vars</span>);
</span><span id="236" class="l"><a href="#236">236: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$r</span> !== Token::POS_BACKFILL) {
</span><span id="237" class="l"><a href="#237">237: </a>                    <span class="php-keyword2">array_pop</span>(<span class="php-var">$context</span>[<span class="php-quote">'stack'</span>]);
</span><span id="238" class="l"><a href="#238">238: </a>                    <span class="php-keyword2">array_pop</span>(<span class="php-var">$context</span>[<span class="php-quote">'stack'</span>]);
</span><span id="239" class="l"><a href="#239">239: </a>                    <span class="php-keyword2">array_pop</span>(<span class="php-var">$context</span>[<span class="php-quote">'stack'</span>]);
</span><span id="240" class="l"><a href="#240">240: </a>                }
</span><span id="241" class="l"><a href="#241">241: </a>                <span class="php-keyword1">return</span> <span class="php-var">$r</span>;
</span><span id="242" class="l"><a href="#242">242: </a>
</span><span id="243" class="l"><a href="#243">243: </a>            <span class="php-keyword1">case</span> <span class="php-quote">'#'</span>:
</span><span id="244" class="l"><a href="#244">244: </a>                <span class="php-keyword1">static</span>::doElseChain(<span class="php-var">$context</span>);
</span><span id="245" class="l"><a href="#245">245: </a>                <span class="php-keyword1">static</span>::pushStack(<span class="php-var">$context</span>, <span class="php-quote">'#'</span>, <span class="php-var">$vars</span>);
</span><span id="246" class="l"><a href="#246">246: </a>
</span><span id="247" class="l"><a href="#247">247: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">static</span>::isBlockHelper(<span class="php-var">$context</span>, <span class="php-var">$vars</span>)) {
</span><span id="248" class="l"><a href="#248">248: </a>                    <span class="php-keyword1">return</span> <span class="php-keyword1">static</span>::blockCustomHelper(<span class="php-var">$context</span>, <span class="php-var">$vars</span>);
</span><span id="249" class="l"><a href="#249">249: </a>                }
</span><span id="250" class="l"><a href="#250">250: </a>
</span><span id="251" class="l"><a href="#251">251: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">static</span>::blockBegin(<span class="php-var">$context</span>, <span class="php-var">$vars</span>);
</span><span id="252" class="l"><a href="#252">252: </a>        }
</span><span id="253" class="l"><a href="#253">253: </a>    }
</span><span id="254" class="l"><a href="#254">254: </a>
</span><span id="255" class="l"><a href="#255">255: </a>    <span class="php-comment">/**
</span></span><span id="256" class="l"><a href="#256">256: </a><span class="php-comment">     * validate inline partial begin token
</span></span><span id="257" class="l"><a href="#257">257: </a><span class="php-comment">     *
</span></span><span id="258" class="l"><a href="#258">258: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="259" class="l"><a href="#259">259: </a><span class="php-comment">     * @param array&lt;boolean|integer|string|array&gt; $vars parsed arguments list
</span></span><span id="260" class="l"><a href="#260">260: </a><span class="php-comment">     *
</span></span><span id="261" class="l"><a href="#261">261: </a><span class="php-comment">     * @return boolean|null Return true when inline partial ends
</span></span><span id="262" class="l"><a href="#262">262: </a><span class="php-comment">     */</span>
</span><span id="263" class="l"><a href="#263">263: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> inlinePartial(&amp;<span class="php-var">$context</span>, <span class="php-var">$vars</span>)
</span><span id="264" class="l"><a href="#264">264: </a>    {
</span><span id="265" class="l"><a href="#265">265: </a>        <span class="php-var">$ended</span> = <span class="php-keyword1">false</span>;
</span><span id="266" class="l"><a href="#266">266: </a>        <span class="php-keyword1">if</span> (<span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_OP] === <span class="php-quote">'/'</span>) {
</span><span id="267" class="l"><a href="#267">267: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">static</span>::blockEnd(<span class="php-var">$context</span>, <span class="php-var">$vars</span>, <span class="php-quote">'#*'</span>) !== <span class="php-keyword1">null</span>) {
</span><span id="268" class="l"><a href="#268">268: </a>                <span class="php-var">$context</span>[<span class="php-quote">'usedFeature'</span>][<span class="php-quote">'inlpartial'</span>]++;
</span><span id="269" class="l"><a href="#269">269: </a>                <span class="php-var">$tmpl</span> = <span class="php-keyword2">array_shift</span>(<span class="php-var">$context</span>[<span class="php-quote">'inlinepartial'</span>]) . <span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_LOTHER] . <span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_LSPACE];
</span><span id="270" class="l"><a href="#270">270: </a>                <span class="php-var">$c</span> = <span class="php-var">$context</span>[<span class="php-quote">'stack'</span>][<span class="php-keyword2">count</span>(<span class="php-var">$context</span>[<span class="php-quote">'stack'</span>]) - <span class="php-num">4</span>];
</span><span id="271" class="l"><a href="#271">271: </a>                <span class="php-var">$context</span>[<span class="php-quote">'parsed'</span>][<span class="php-num">0</span>] = <span class="php-keyword2">array_slice</span>(<span class="php-var">$context</span>[<span class="php-quote">'parsed'</span>][<span class="php-num">0</span>], <span class="php-num">0</span>, <span class="php-var">$c</span> + <span class="php-num">1</span>);
</span><span id="272" class="l"><a href="#272">272: </a>                <span class="php-var">$P</span> = &amp;<span class="php-var">$context</span>[<span class="php-quote">'parsed'</span>][<span class="php-num">0</span>][<span class="php-var">$c</span>];
</span><span id="273" class="l"><a href="#273">273: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$P</span>[<span class="php-num">1</span>][<span class="php-num">1</span>][<span class="php-num">0</span>])) {
</span><span id="274" class="l"><a href="#274">274: </a>                    <span class="php-var">$context</span>[<span class="php-quote">'usedPartial'</span>][<span class="php-var">$P</span>[<span class="php-num">1</span>][<span class="php-num">1</span>][<span class="php-num">0</span>]] = <span class="php-var">$tmpl</span>;
</span><span id="275" class="l"><a href="#275">275: </a>                    <span class="php-var">$P</span>[<span class="php-num">1</span>][<span class="php-num">0</span>][<span class="php-num">0</span>] = Partial::compileDynamic(<span class="php-var">$context</span>, <span class="php-var">$P</span>[<span class="php-num">1</span>][<span class="php-num">1</span>][<span class="php-num">0</span>]);
</span><span id="276" class="l"><a href="#276">276: </a>                }
</span><span id="277" class="l"><a href="#277">277: </a>                <span class="php-var">$ended</span> = <span class="php-keyword1">true</span>;
</span><span id="278" class="l"><a href="#278">278: </a>            }
</span><span id="279" class="l"><a href="#279">279: </a>        }
</span><span id="280" class="l"><a href="#280">280: </a>        <span class="php-keyword1">return</span> <span class="php-var">$ended</span>;
</span><span id="281" class="l"><a href="#281">281: </a>    }
</span><span id="282" class="l"><a href="#282">282: </a>
</span><span id="283" class="l"><a href="#283">283: </a>    <span class="php-comment">/**
</span></span><span id="284" class="l"><a href="#284">284: </a><span class="php-comment">     * validate partial block token
</span></span><span id="285" class="l"><a href="#285">285: </a><span class="php-comment">     *
</span></span><span id="286" class="l"><a href="#286">286: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="287" class="l"><a href="#287">287: </a><span class="php-comment">     * @param array&lt;boolean|integer|string|array&gt; $vars parsed arguments list
</span></span><span id="288" class="l"><a href="#288">288: </a><span class="php-comment">     *
</span></span><span id="289" class="l"><a href="#289">289: </a><span class="php-comment">     * @return boolean|null Return true when partial block ends
</span></span><span id="290" class="l"><a href="#290">290: </a><span class="php-comment">     */</span>
</span><span id="291" class="l"><a href="#291">291: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> partialBlock(&amp;<span class="php-var">$context</span>, <span class="php-var">$vars</span>)
</span><span id="292" class="l"><a href="#292">292: </a>    {
</span><span id="293" class="l"><a href="#293">293: </a>        <span class="php-var">$ended</span> = <span class="php-keyword1">false</span>;
</span><span id="294" class="l"><a href="#294">294: </a>        <span class="php-keyword1">if</span> (<span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_OP] === <span class="php-quote">'/'</span>) {
</span><span id="295" class="l"><a href="#295">295: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">static</span>::blockEnd(<span class="php-var">$context</span>, <span class="php-var">$vars</span>, <span class="php-quote">'#&gt;'</span>) !== <span class="php-keyword1">null</span>) {
</span><span id="296" class="l"><a href="#296">296: </a>                <span class="php-var">$c</span> = <span class="php-var">$context</span>[<span class="php-quote">'stack'</span>][<span class="php-keyword2">count</span>(<span class="php-var">$context</span>[<span class="php-quote">'stack'</span>]) - <span class="php-num">4</span>];
</span><span id="297" class="l"><a href="#297">297: </a>                <span class="php-var">$context</span>[<span class="php-quote">'parsed'</span>][<span class="php-num">0</span>] = <span class="php-keyword2">array_slice</span>(<span class="php-var">$context</span>[<span class="php-quote">'parsed'</span>][<span class="php-num">0</span>], <span class="php-num">0</span>, <span class="php-var">$c</span> + <span class="php-num">1</span>);
</span><span id="298" class="l"><a href="#298">298: </a>                <span class="php-var">$found</span> = Partial::resolve(<span class="php-var">$context</span>, <span class="php-var">$vars</span>[<span class="php-num">0</span>][<span class="php-num">0</span>]) !== <span class="php-keyword1">null</span>;
</span><span id="299" class="l"><a href="#299">299: </a>                <span class="php-var">$v</span> = <span class="php-var">$found</span> ? <span class="php-quote">&quot;@partial-block</span><span class="php-var">{$context['parsed'][0][$c][1][Parser::PARTIALBLOCK]}</span><span class="php-quote">&quot;</span> : <span class="php-quote">&quot;</span><span class="php-var">{$vars[0][0]}</span><span class="php-quote">&quot;</span>;
</span><span id="300" class="l"><a href="#300">300: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">count</span>(<span class="php-var">$context</span>[<span class="php-quote">'partialblock'</span>]) == <span class="php-num">1</span>) {
</span><span id="301" class="l"><a href="#301">301: </a>                    <span class="php-var">$tmpl</span> = <span class="php-var">$context</span>[<span class="php-quote">'partialblock'</span>][<span class="php-num">0</span>] . <span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_LOTHER] . <span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_LSPACE];
</span><span id="302" class="l"><a href="#302">302: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$found</span>) {
</span><span id="303" class="l"><a href="#303">303: </a>                        <span class="php-var">$context</span>[<span class="php-quote">'partials'</span>][<span class="php-var">$v</span>] = <span class="php-var">$tmpl</span>;
</span><span id="304" class="l"><a href="#304">304: </a>                    }
</span><span id="305" class="l"><a href="#305">305: </a>                    <span class="php-var">$context</span>[<span class="php-quote">'usedPartial'</span>][<span class="php-var">$v</span>] = <span class="php-var">$tmpl</span>;
</span><span id="306" class="l"><a href="#306">306: </a>                    Partial::compileDynamic(<span class="php-var">$context</span>, <span class="php-var">$v</span>);
</span><span id="307" class="l"><a href="#307">307: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$found</span>) {
</span><span id="308" class="l"><a href="#308">308: </a>                        Partial::read(<span class="php-var">$context</span>, <span class="php-var">$vars</span>[<span class="php-num">0</span>][<span class="php-num">0</span>]);
</span><span id="309" class="l"><a href="#309">309: </a>                    }
</span><span id="310" class="l"><a href="#310">310: </a>                }
</span><span id="311" class="l"><a href="#311">311: </a>                <span class="php-keyword2">array_shift</span>(<span class="php-var">$context</span>[<span class="php-quote">'partialblock'</span>]);
</span><span id="312" class="l"><a href="#312">312: </a>                <span class="php-var">$ended</span> = <span class="php-keyword1">true</span>;
</span><span id="313" class="l"><a href="#313">313: </a>            }
</span><span id="314" class="l"><a href="#314">314: </a>        }
</span><span id="315" class="l"><a href="#315">315: </a>        <span class="php-keyword1">return</span> <span class="php-var">$ended</span>;
</span><span id="316" class="l"><a href="#316">316: </a>    }
</span><span id="317" class="l"><a href="#317">317: </a>
</span><span id="318" class="l"><a href="#318">318: </a>    <span class="php-comment">/**
</span></span><span id="319" class="l"><a href="#319">319: </a><span class="php-comment">     * handle else chain
</span></span><span id="320" class="l"><a href="#320">320: </a><span class="php-comment">     *
</span></span><span id="321" class="l"><a href="#321">321: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="322" class="l"><a href="#322">322: </a><span class="php-comment">     */</span>
</span><span id="323" class="l"><a href="#323">323: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> doElseChain(&amp;<span class="php-var">$context</span>)
</span><span id="324" class="l"><a href="#324">324: </a>    {
</span><span id="325" class="l"><a href="#325">325: </a>        <span class="php-keyword1">if</span> (<span class="php-var">$context</span>[<span class="php-quote">'elsechain'</span>]) {
</span><span id="326" class="l"><a href="#326">326: </a>            <span class="php-var">$context</span>[<span class="php-quote">'elsechain'</span>] = <span class="php-keyword1">false</span>;
</span><span id="327" class="l"><a href="#327">327: </a>        } <span class="php-keyword1">else</span> {
</span><span id="328" class="l"><a href="#328">328: </a>            <span class="php-keyword2">array_unshift</span>(<span class="php-var">$context</span>[<span class="php-quote">'elselvl'</span>], <span class="php-keyword1">array</span>());
</span><span id="329" class="l"><a href="#329">329: </a>        }
</span><span id="330" class="l"><a href="#330">330: </a>    }
</span><span id="331" class="l"><a href="#331">331: </a>
</span><span id="332" class="l"><a href="#332">332: </a>    <span class="php-comment">/**
</span></span><span id="333" class="l"><a href="#333">333: </a><span class="php-comment">     * validate block begin token
</span></span><span id="334" class="l"><a href="#334">334: </a><span class="php-comment">     *
</span></span><span id="335" class="l"><a href="#335">335: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="336" class="l"><a href="#336">336: </a><span class="php-comment">     * @param array&lt;boolean|integer|string|array&gt; $vars parsed arguments list
</span></span><span id="337" class="l"><a href="#337">337: </a><span class="php-comment">     *
</span></span><span id="338" class="l"><a href="#338">338: </a><span class="php-comment">     * @return boolean Return true always
</span></span><span id="339" class="l"><a href="#339">339: </a><span class="php-comment">     */</span>
</span><span id="340" class="l"><a href="#340">340: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> blockBegin(&amp;<span class="php-var">$context</span>, <span class="php-var">$vars</span>)
</span><span id="341" class="l"><a href="#341">341: </a>    {
</span><span id="342" class="l"><a href="#342">342: </a>        <span class="php-keyword1">switch</span> ((<span class="php-keyword1">isset</span>(<span class="php-var">$vars</span>[<span class="php-num">0</span>][<span class="php-num">0</span>]) &amp;&amp; <span class="php-keyword2">is_string</span>(<span class="php-var">$vars</span>[<span class="php-num">0</span>][<span class="php-num">0</span>])) ? <span class="php-var">$vars</span>[<span class="php-num">0</span>][<span class="php-num">0</span>] : <span class="php-keyword1">null</span>) {
</span><span id="343" class="l"><a href="#343">343: </a>            <span class="php-keyword1">case</span> <span class="php-quote">'with'</span>:
</span><span id="344" class="l"><a href="#344">344: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">static</span>::with(<span class="php-var">$context</span>, <span class="php-var">$vars</span>);
</span><span id="345" class="l"><a href="#345">345: </a>            <span class="php-keyword1">case</span> <span class="php-quote">'each'</span>:
</span><span id="346" class="l"><a href="#346">346: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">static</span>::section(<span class="php-var">$context</span>, <span class="php-var">$vars</span>, <span class="php-keyword1">true</span>);
</span><span id="347" class="l"><a href="#347">347: </a>            <span class="php-keyword1">case</span> <span class="php-quote">'unless'</span>:
</span><span id="348" class="l"><a href="#348">348: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">static</span>::unless(<span class="php-var">$context</span>, <span class="php-var">$vars</span>);
</span><span id="349" class="l"><a href="#349">349: </a>            <span class="php-keyword1">case</span> <span class="php-quote">'if'</span>:
</span><span id="350" class="l"><a href="#350">350: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">static</span>::doIf(<span class="php-var">$context</span>, <span class="php-var">$vars</span>);
</span><span id="351" class="l"><a href="#351">351: </a>            <span class="php-keyword1">default</span>:
</span><span id="352" class="l"><a href="#352">352: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">static</span>::section(<span class="php-var">$context</span>, <span class="php-var">$vars</span>);
</span><span id="353" class="l"><a href="#353">353: </a>        }
</span><span id="354" class="l"><a href="#354">354: </a>    }
</span><span id="355" class="l"><a href="#355">355: </a>
</span><span id="356" class="l"><a href="#356">356: </a>    <span class="php-comment">/**
</span></span><span id="357" class="l"><a href="#357">357: </a><span class="php-comment">     * validate builtin helpers
</span></span><span id="358" class="l"><a href="#358">358: </a><span class="php-comment">     *
</span></span><span id="359" class="l"><a href="#359">359: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="360" class="l"><a href="#360">360: </a><span class="php-comment">     * @param array&lt;boolean|integer|string|array&gt; $vars parsed arguments list
</span></span><span id="361" class="l"><a href="#361">361: </a><span class="php-comment">     */</span>
</span><span id="362" class="l"><a href="#362">362: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> builtin(&amp;<span class="php-var">$context</span>, <span class="php-var">$vars</span>)
</span><span id="363" class="l"><a href="#363">363: </a>    {
</span><span id="364" class="l"><a href="#364">364: </a>        <span class="php-keyword1">if</span> (<span class="php-var">$context</span>[<span class="php-quote">'flags'</span>][<span class="php-quote">'nohbh'</span>]) {
</span><span id="365" class="l"><a href="#365">365: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$vars</span>[<span class="php-num">1</span>][<span class="php-num">0</span>])) {
</span><span id="366" class="l"><a href="#366">366: </a>                <span class="php-var">$context</span>[<span class="php-quote">'error'</span>][] = <span class="php-quote">&quot;Do not support {{#</span><span class="php-var">{$vars[0][0]}</span><span class="php-quote"> var}} because you compile with LightnCandy::FLAG_NOHBHELPERS flag&quot;</span>;
</span><span id="367" class="l"><a href="#367">367: </a>            }
</span><span id="368" class="l"><a href="#368">368: </a>        } <span class="php-keyword1">else</span> {
</span><span id="369" class="l"><a href="#369">369: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">count</span>(<span class="php-var">$vars</span>) &lt; <span class="php-num">2</span>) {
</span><span id="370" class="l"><a href="#370">370: </a>                <span class="php-var">$context</span>[<span class="php-quote">'error'</span>][] = <span class="php-quote">&quot;No argument after {{#</span><span class="php-var">{$vars[0][0]}</span><span class="php-quote">}} !&quot;</span>;
</span><span id="371" class="l"><a href="#371">371: </a>            }
</span><span id="372" class="l"><a href="#372">372: </a>        }
</span><span id="373" class="l"><a href="#373">373: </a>        <span class="php-var">$context</span>[<span class="php-quote">'usedFeature'</span>][<span class="php-var">$vars</span>[<span class="php-num">0</span>][<span class="php-num">0</span>]]++;
</span><span id="374" class="l"><a href="#374">374: </a>    }
</span><span id="375" class="l"><a href="#375">375: </a>
</span><span id="376" class="l"><a href="#376">376: </a>    <span class="php-comment">/**
</span></span><span id="377" class="l"><a href="#377">377: </a><span class="php-comment">     * validate section token
</span></span><span id="378" class="l"><a href="#378">378: </a><span class="php-comment">     *
</span></span><span id="379" class="l"><a href="#379">379: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="380" class="l"><a href="#380">380: </a><span class="php-comment">     * @param array&lt;boolean|integer|string|array&gt; $vars parsed arguments list
</span></span><span id="381" class="l"><a href="#381">381: </a><span class="php-comment">     * @param boolean $isEach the section is #each
</span></span><span id="382" class="l"><a href="#382">382: </a><span class="php-comment">     *
</span></span><span id="383" class="l"><a href="#383">383: </a><span class="php-comment">     * @return boolean Return true always
</span></span><span id="384" class="l"><a href="#384">384: </a><span class="php-comment">     */</span>
</span><span id="385" class="l"><a href="#385">385: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> section(&amp;<span class="php-var">$context</span>, <span class="php-var">$vars</span>, <span class="php-var">$isEach</span> = <span class="php-keyword1">false</span>)
</span><span id="386" class="l"><a href="#386">386: </a>    {
</span><span id="387" class="l"><a href="#387">387: </a>        <span class="php-keyword1">if</span> (<span class="php-var">$isEach</span>) {
</span><span id="388" class="l"><a href="#388">388: </a>            <span class="php-keyword1">static</span>::builtin(<span class="php-var">$context</span>, <span class="php-var">$vars</span>);
</span><span id="389" class="l"><a href="#389">389: </a>        } <span class="php-keyword1">else</span> {
</span><span id="390" class="l"><a href="#390">390: </a>            <span class="php-keyword1">if</span> ((<span class="php-keyword2">count</span>(<span class="php-var">$vars</span>) &gt; <span class="php-num">1</span>) &amp;&amp; !<span class="php-var">$context</span>[<span class="php-quote">'flags'</span>][<span class="php-quote">'lambda'</span>]) {
</span><span id="391" class="l"><a href="#391">391: </a>                <span class="php-var">$context</span>[<span class="php-quote">'error'</span>][] = <span class="php-quote">&quot;Custom helper not found: </span><span class="php-var">{$vars[0][0]}</span><span class="php-quote"> in &quot;</span> . Token::toString(<span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>]) . <span class="php-quote">' !'</span>;
</span><span id="392" class="l"><a href="#392">392: </a>            }
</span><span id="393" class="l"><a href="#393">393: </a>            <span class="php-var">$context</span>[<span class="php-quote">'usedFeature'</span>][<span class="php-quote">'sec'</span>]++;
</span><span id="394" class="l"><a href="#394">394: </a>        }
</span><span id="395" class="l"><a href="#395">395: </a>        <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="396" class="l"><a href="#396">396: </a>    }
</span><span id="397" class="l"><a href="#397">397: </a>
</span><span id="398" class="l"><a href="#398">398: </a>    <span class="php-comment">/**
</span></span><span id="399" class="l"><a href="#399">399: </a><span class="php-comment">     * validate with token
</span></span><span id="400" class="l"><a href="#400">400: </a><span class="php-comment">     *
</span></span><span id="401" class="l"><a href="#401">401: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="402" class="l"><a href="#402">402: </a><span class="php-comment">     * @param array&lt;boolean|integer|string|array&gt; $vars parsed arguments list
</span></span><span id="403" class="l"><a href="#403">403: </a><span class="php-comment">     *
</span></span><span id="404" class="l"><a href="#404">404: </a><span class="php-comment">     * @return boolean Return true always
</span></span><span id="405" class="l"><a href="#405">405: </a><span class="php-comment">     */</span>
</span><span id="406" class="l"><a href="#406">406: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> with(&amp;<span class="php-var">$context</span>, <span class="php-var">$vars</span>)
</span><span id="407" class="l"><a href="#407">407: </a>    {
</span><span id="408" class="l"><a href="#408">408: </a>        <span class="php-keyword1">static</span>::builtin(<span class="php-var">$context</span>, <span class="php-var">$vars</span>);
</span><span id="409" class="l"><a href="#409">409: </a>        <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="410" class="l"><a href="#410">410: </a>    }
</span><span id="411" class="l"><a href="#411">411: </a>
</span><span id="412" class="l"><a href="#412">412: </a>    <span class="php-comment">/**
</span></span><span id="413" class="l"><a href="#413">413: </a><span class="php-comment">     * validate unless token
</span></span><span id="414" class="l"><a href="#414">414: </a><span class="php-comment">     *
</span></span><span id="415" class="l"><a href="#415">415: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="416" class="l"><a href="#416">416: </a><span class="php-comment">     * @param array&lt;boolean|integer|string|array&gt; $vars parsed arguments list
</span></span><span id="417" class="l"><a href="#417">417: </a><span class="php-comment">     *
</span></span><span id="418" class="l"><a href="#418">418: </a><span class="php-comment">     * @return boolean Return true always
</span></span><span id="419" class="l"><a href="#419">419: </a><span class="php-comment">     */</span>
</span><span id="420" class="l"><a href="#420">420: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> unless(&amp;<span class="php-var">$context</span>, <span class="php-var">$vars</span>)
</span><span id="421" class="l"><a href="#421">421: </a>    {
</span><span id="422" class="l"><a href="#422">422: </a>        <span class="php-keyword1">static</span>::builtin(<span class="php-var">$context</span>, <span class="php-var">$vars</span>);
</span><span id="423" class="l"><a href="#423">423: </a>        <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="424" class="l"><a href="#424">424: </a>    }
</span><span id="425" class="l"><a href="#425">425: </a>
</span><span id="426" class="l"><a href="#426">426: </a>    <span class="php-comment">/**
</span></span><span id="427" class="l"><a href="#427">427: </a><span class="php-comment">     * validate if token
</span></span><span id="428" class="l"><a href="#428">428: </a><span class="php-comment">     *
</span></span><span id="429" class="l"><a href="#429">429: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="430" class="l"><a href="#430">430: </a><span class="php-comment">     * @param array&lt;boolean|integer|string|array&gt; $vars parsed arguments list
</span></span><span id="431" class="l"><a href="#431">431: </a><span class="php-comment">     *
</span></span><span id="432" class="l"><a href="#432">432: </a><span class="php-comment">     * @return boolean Return true always
</span></span><span id="433" class="l"><a href="#433">433: </a><span class="php-comment">     */</span>
</span><span id="434" class="l"><a href="#434">434: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> doIf(&amp;<span class="php-var">$context</span>, <span class="php-var">$vars</span>)
</span><span id="435" class="l"><a href="#435">435: </a>    {
</span><span id="436" class="l"><a href="#436">436: </a>        <span class="php-keyword1">static</span>::builtin(<span class="php-var">$context</span>, <span class="php-var">$vars</span>);
</span><span id="437" class="l"><a href="#437">437: </a>        <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="438" class="l"><a href="#438">438: </a>    }
</span><span id="439" class="l"><a href="#439">439: </a>
</span><span id="440" class="l"><a href="#440">440: </a>    <span class="php-comment">/**
</span></span><span id="441" class="l"><a href="#441">441: </a><span class="php-comment">     * validate block custom helper token
</span></span><span id="442" class="l"><a href="#442">442: </a><span class="php-comment">     *
</span></span><span id="443" class="l"><a href="#443">443: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="444" class="l"><a href="#444">444: </a><span class="php-comment">     * @param array&lt;boolean|integer|string|array&gt; $vars parsed arguments list
</span></span><span id="445" class="l"><a href="#445">445: </a><span class="php-comment">     * @param boolean $inverted the logic will be inverted
</span></span><span id="446" class="l"><a href="#446">446: </a><span class="php-comment">     *
</span></span><span id="447" class="l"><a href="#447">447: </a><span class="php-comment">     * @return integer|null Return number of used custom helpers
</span></span><span id="448" class="l"><a href="#448">448: </a><span class="php-comment">     */</span>
</span><span id="449" class="l"><a href="#449">449: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> blockCustomHelper(&amp;<span class="php-var">$context</span>, <span class="php-var">$vars</span>, <span class="php-var">$inverted</span> = <span class="php-keyword1">false</span>)
</span><span id="450" class="l"><a href="#450">450: </a>    {
</span><span id="451" class="l"><a href="#451">451: </a>        <span class="php-keyword1">if</span> (<span class="php-keyword2">is_string</span>(<span class="php-var">$vars</span>[<span class="php-num">0</span>][<span class="php-num">0</span>])) {
</span><span id="452" class="l"><a href="#452">452: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">static</span>::resolveHelper(<span class="php-var">$context</span>, <span class="php-var">$vars</span>)) {
</span><span id="453" class="l"><a href="#453">453: </a>                <span class="php-keyword1">return</span> ++<span class="php-var">$context</span>[<span class="php-quote">'usedFeature'</span>][<span class="php-quote">'helper'</span>];
</span><span id="454" class="l"><a href="#454">454: </a>            }
</span><span id="455" class="l"><a href="#455">455: </a>        }
</span><span id="456" class="l"><a href="#456">456: </a>    }
</span><span id="457" class="l"><a href="#457">457: </a>
</span><span id="458" class="l"><a href="#458">458: </a>    <span class="php-comment">/**
</span></span><span id="459" class="l"><a href="#459">459: </a><span class="php-comment">     * validate inverted section
</span></span><span id="460" class="l"><a href="#460">460: </a><span class="php-comment">     *
</span></span><span id="461" class="l"><a href="#461">461: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="462" class="l"><a href="#462">462: </a><span class="php-comment">     * @param array&lt;boolean|integer|string|array&gt; $vars parsed arguments list
</span></span><span id="463" class="l"><a href="#463">463: </a><span class="php-comment">     *
</span></span><span id="464" class="l"><a href="#464">464: </a><span class="php-comment">     * @return integer Return number of inverted sections
</span></span><span id="465" class="l"><a href="#465">465: </a><span class="php-comment">     */</span>
</span><span id="466" class="l"><a href="#466">466: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> invertedSection(&amp;<span class="php-var">$context</span>, <span class="php-var">$vars</span>)
</span><span id="467" class="l"><a href="#467">467: </a>    {
</span><span id="468" class="l"><a href="#468">468: </a>        <span class="php-keyword1">return</span> ++<span class="php-var">$context</span>[<span class="php-quote">'usedFeature'</span>][<span class="php-quote">'isec'</span>];
</span><span id="469" class="l"><a href="#469">469: </a>    }
</span><span id="470" class="l"><a href="#470">470: </a>
</span><span id="471" class="l"><a href="#471">471: </a>    <span class="php-comment">/**
</span></span><span id="472" class="l"><a href="#472">472: </a><span class="php-comment">     * Return compiled PHP code for a handlebars block end token
</span></span><span id="473" class="l"><a href="#473">473: </a><span class="php-comment">     *
</span></span><span id="474" class="l"><a href="#474">474: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="475" class="l"><a href="#475">475: </a><span class="php-comment">     * @param array&lt;boolean|integer|string|array&gt; $vars parsed arguments list
</span></span><span id="476" class="l"><a href="#476">476: </a><span class="php-comment">     * @param string|null $match should also match to this operator
</span></span><span id="477" class="l"><a href="#477">477: </a><span class="php-comment">     *
</span></span><span id="478" class="l"><a href="#478">478: </a><span class="php-comment">     * @return boolean|integer Return true when required block ended, or Token::POS_BACKFILL when backfill happened.
</span></span><span id="479" class="l"><a href="#479">479: </a><span class="php-comment">     */</span>
</span><span id="480" class="l"><a href="#480">480: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> blockEnd(&amp;<span class="php-var">$context</span>, &amp;<span class="php-var">$vars</span>, <span class="php-var">$match</span> = <span class="php-keyword1">null</span>)
</span><span id="481" class="l"><a href="#481">481: </a>    {
</span><span id="482" class="l"><a href="#482">482: </a>        <span class="php-var">$c</span> = <span class="php-keyword2">count</span>(<span class="php-var">$context</span>[<span class="php-quote">'stack'</span>]) - <span class="php-num">2</span>;
</span><span id="483" class="l"><a href="#483">483: </a>        <span class="php-var">$pop</span> = (<span class="php-var">$c</span> &gt;= <span class="php-num">0</span>) ? <span class="php-var">$context</span>[<span class="php-quote">'stack'</span>][<span class="php-var">$c</span> + <span class="php-num">1</span>] : <span class="php-quote">''</span>;
</span><span id="484" class="l"><a href="#484">484: </a>        <span class="php-keyword1">if</span> ((<span class="php-var">$match</span> !== <span class="php-keyword1">null</span>) &amp;&amp; (<span class="php-var">$match</span> !== <span class="php-var">$pop</span>)) {
</span><span id="485" class="l"><a href="#485">485: </a>            <span class="php-keyword1">return</span>;
</span><span id="486" class="l"><a href="#486">486: </a>        }
</span><span id="487" class="l"><a href="#487">487: </a>        <span class="php-comment">// if we didn't match our $pop, we didn't actually do a level, so only subtract a level here</span>
</span><span id="488" class="l"><a href="#488">488: </a>        <span class="php-var">$context</span>[<span class="php-quote">'level'</span>]--;
</span><span id="489" class="l"><a href="#489">489: </a>        <span class="php-var">$pop2</span> = (<span class="php-var">$c</span> &gt;= <span class="php-num">0</span>) ? <span class="php-var">$context</span>[<span class="php-quote">'stack'</span>][<span class="php-var">$c</span>]: <span class="php-quote">''</span>;
</span><span id="490" class="l"><a href="#490">490: </a>        <span class="php-keyword1">switch</span> (<span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_INNERTAG]) {
</span><span id="491" class="l"><a href="#491">491: </a>            <span class="php-keyword1">case</span> <span class="php-quote">'with'</span>:
</span><span id="492" class="l"><a href="#492">492: </a>                <span class="php-keyword1">if</span> (!<span class="php-var">$context</span>[<span class="php-quote">'flags'</span>][<span class="php-quote">'nohbh'</span>]) {
</span><span id="493" class="l"><a href="#493">493: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$pop2</span> !== <span class="php-quote">'[with]'</span>) {
</span><span id="494" class="l"><a href="#494">494: </a>                        <span class="php-var">$context</span>[<span class="php-quote">'error'</span>][] = <span class="php-quote">'Unexpect token: {{/with}} !'</span>;
</span><span id="495" class="l"><a href="#495">495: </a>                        <span class="php-keyword1">return</span>;
</span><span id="496" class="l"><a href="#496">496: </a>                    }
</span><span id="497" class="l"><a href="#497">497: </a>                }
</span><span id="498" class="l"><a href="#498">498: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="499" class="l"><a href="#499">499: </a>        }
</span><span id="500" class="l"><a href="#500">500: </a>
</span><span id="501" class="l"><a href="#501">501: </a>        <span class="php-keyword1">switch</span> (<span class="php-var">$pop</span>) {
</span><span id="502" class="l"><a href="#502">502: </a>            <span class="php-keyword1">case</span> <span class="php-quote">'#'</span>:
</span><span id="503" class="l"><a href="#503">503: </a>            <span class="php-keyword1">case</span> <span class="php-quote">'^'</span>:
</span><span id="504" class="l"><a href="#504">504: </a>                <span class="php-var">$elsechain</span> = <span class="php-keyword2">array_shift</span>(<span class="php-var">$context</span>[<span class="php-quote">'elselvl'</span>]);
</span><span id="505" class="l"><a href="#505">505: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$elsechain</span>[<span class="php-num">0</span>])) {
</span><span id="506" class="l"><a href="#506">506: </a>                    <span class="php-comment">// we need to repeat a level due to else chains: {{else if}}</span>
</span><span id="507" class="l"><a href="#507">507: </a>                    <span class="php-var">$context</span>[<span class="php-quote">'level'</span>]++;
</span><span id="508" class="l"><a href="#508">508: </a>                    <span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_RSPACE] = <span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_BACKFILL] = <span class="php-quote">'{{/'</span> . <span class="php-keyword2">implode</span>(<span class="php-quote">'}}{{/'</span>, <span class="php-var">$elsechain</span>) . <span class="php-quote">'}}'</span> . Token::toString(<span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>]) . <span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_RSPACE];
</span><span id="509" class="l"><a href="#509">509: </a>                    <span class="php-keyword1">return</span> Token::POS_BACKFILL;
</span><span id="510" class="l"><a href="#510">510: </a>                }
</span><span id="511" class="l"><a href="#511">511: </a>                <span class="php-comment">// no break</span>
</span><span id="512" class="l"><a href="#512">512: </a>            <span class="php-keyword1">case</span> <span class="php-quote">'#&gt;'</span>:
</span><span id="513" class="l"><a href="#513">513: </a>            <span class="php-keyword1">case</span> <span class="php-quote">'#*'</span>:
</span><span id="514" class="l"><a href="#514">514: </a>                <span class="php-keyword1">list</span>(<span class="php-var">$levels</span>, <span class="php-var">$spvar</span>, <span class="php-var">$var</span>) = Expression::analyze(<span class="php-var">$context</span>, <span class="php-var">$vars</span>[<span class="php-num">0</span>]);
</span><span id="515" class="l"><a href="#515">515: </a>                <span class="php-var">$v</span> = Expression::toString(<span class="php-var">$levels</span>, <span class="php-var">$spvar</span>, <span class="php-var">$var</span>);
</span><span id="516" class="l"><a href="#516">516: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$pop2</span> !== <span class="php-var">$v</span>) {
</span><span id="517" class="l"><a href="#517">517: </a>                    <span class="php-var">$context</span>[<span class="php-quote">'error'</span>][] = <span class="php-quote">'Unexpect token '</span> . Token::toString(<span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>]) . <span class="php-quote">&quot; ! Previous token {{</span><span class="php-var">{$pop}$pop2</span><span class="php-quote">}} is not closed&quot;</span>;
</span><span id="518" class="l"><a href="#518">518: </a>                    <span class="php-keyword1">return</span>;
</span><span id="519" class="l"><a href="#519">519: </a>                }
</span><span id="520" class="l"><a href="#520">520: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="521" class="l"><a href="#521">521: </a>            <span class="php-keyword1">default</span>:
</span><span id="522" class="l"><a href="#522">522: </a>                <span class="php-var">$context</span>[<span class="php-quote">'error'</span>][] = <span class="php-quote">'Unexpect token: '</span> . Token::toString(<span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>]) . <span class="php-quote">' !'</span>;
</span><span id="523" class="l"><a href="#523">523: </a>                <span class="php-keyword1">return</span>;
</span><span id="524" class="l"><a href="#524">524: </a>        }
</span><span id="525" class="l"><a href="#525">525: </a>    }
</span><span id="526" class="l"><a href="#526">526: </a>
</span><span id="527" class="l"><a href="#527">527: </a>    <span class="php-comment">/**
</span></span><span id="528" class="l"><a href="#528">528: </a><span class="php-comment">     * handle delimiter change
</span></span><span id="529" class="l"><a href="#529">529: </a><span class="php-comment">     *
</span></span><span id="530" class="l"><a href="#530">530: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="531" class="l"><a href="#531">531: </a><span class="php-comment">     *
</span></span><span id="532" class="l"><a href="#532">532: </a><span class="php-comment">     * @return boolean|null Return true when delimiter changed
</span></span><span id="533" class="l"><a href="#533">533: </a><span class="php-comment">     */</span>
</span><span id="534" class="l"><a href="#534">534: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> isDelimiter(&amp;<span class="php-var">$context</span>)
</span><span id="535" class="l"><a href="#535">535: </a>    {
</span><span id="536" class="l"><a href="#536">536: </a>        <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/^=\s*([^ ]+)\s+([^ ]+)\s*=$/'</span>, <span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_INNERTAG], <span class="php-var">$matched</span>)) {
</span><span id="537" class="l"><a href="#537">537: </a>            <span class="php-var">$context</span>[<span class="php-quote">'usedFeature'</span>][<span class="php-quote">'delimiter'</span>]++;
</span><span id="538" class="l"><a href="#538">538: </a>            Parser::setDelimiter(<span class="php-var">$context</span>, <span class="php-var">$matched</span>[<span class="php-num">1</span>], <span class="php-var">$matched</span>[<span class="php-num">2</span>]);
</span><span id="539" class="l"><a href="#539">539: </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="540" class="l"><a href="#540">540: </a>        }
</span><span id="541" class="l"><a href="#541">541: </a>    }
</span><span id="542" class="l"><a href="#542">542: </a>
</span><span id="543" class="l"><a href="#543">543: </a>    <span class="php-comment">/**
</span></span><span id="544" class="l"><a href="#544">544: </a><span class="php-comment">     * handle raw block
</span></span><span id="545" class="l"><a href="#545">545: </a><span class="php-comment">     *
</span></span><span id="546" class="l"><a href="#546">546: </a><span class="php-comment">     * @param string[] $token detected handlebars {{ }} token
</span></span><span id="547" class="l"><a href="#547">547: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="548" class="l"><a href="#548">548: </a><span class="php-comment">     *
</span></span><span id="549" class="l"><a href="#549">549: </a><span class="php-comment">     * @return boolean|null Return true when in rawblock mode
</span></span><span id="550" class="l"><a href="#550">550: </a><span class="php-comment">     */</span>
</span><span id="551" class="l"><a href="#551">551: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> rawblock(&amp;<span class="php-var">$token</span>, &amp;<span class="php-var">$context</span>)
</span><span id="552" class="l"><a href="#552">552: </a>    {
</span><span id="553" class="l"><a href="#553">553: </a>        <span class="php-var">$inner</span> = <span class="php-var">$token</span>[Token::POS_INNERTAG];
</span><span id="554" class="l"><a href="#554">554: </a>        <span class="php-keyword2">trim</span>(<span class="php-var">$inner</span>);
</span><span id="555" class="l"><a href="#555">555: </a>
</span><span id="556" class="l"><a href="#556">556: </a>        <span class="php-comment">// skip parse when inside raw block</span>
</span><span id="557" class="l"><a href="#557">557: </a>        <span class="php-keyword1">if</span> (<span class="php-var">$context</span>[<span class="php-quote">'rawblock'</span>] &amp;&amp; !((<span class="php-var">$token</span>[Token::POS_BEGINRAW] === <span class="php-quote">'{{'</span>) &amp;&amp; (<span class="php-var">$token</span>[Token::POS_OP] === <span class="php-quote">'/'</span>) &amp;&amp; (<span class="php-var">$context</span>[<span class="php-quote">'rawblock'</span>] === <span class="php-var">$inner</span>))) {
</span><span id="558" class="l"><a href="#558">558: </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="559" class="l"><a href="#559">559: </a>        }
</span><span id="560" class="l"><a href="#560">560: </a>
</span><span id="561" class="l"><a href="#561">561: </a>        <span class="php-var">$token</span>[Token::POS_INNERTAG] = <span class="php-var">$inner</span>;
</span><span id="562" class="l"><a href="#562">562: </a>
</span><span id="563" class="l"><a href="#563">563: </a>        <span class="php-comment">// Handle raw block</span>
</span><span id="564" class="l"><a href="#564">564: </a>        <span class="php-keyword1">if</span> (<span class="php-var">$token</span>[Token::POS_BEGINRAW] === <span class="php-quote">'{{'</span>) {
</span><span id="565" class="l"><a href="#565">565: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$token</span>[Token::POS_ENDRAW] !== <span class="php-quote">'}}'</span>) {
</span><span id="566" class="l"><a href="#566">566: </a>                <span class="php-var">$context</span>[<span class="php-quote">'error'</span>][] = <span class="php-quote">'Bad token '</span> . Token::toString(<span class="php-var">$token</span>) . <span class="php-quote">' ! Do you mean '</span> . Token::toString(<span class="php-var">$token</span>, <span class="php-keyword1">array</span>(Token::POS_ENDRAW =&gt; <span class="php-quote">'}}'</span>)) . <span class="php-quote">' ?'</span>;
</span><span id="567" class="l"><a href="#567">567: </a>            }
</span><span id="568" class="l"><a href="#568">568: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$context</span>[<span class="php-quote">'rawblock'</span>]) {
</span><span id="569" class="l"><a href="#569">569: </a>                Parser::setDelimiter(<span class="php-var">$context</span>);
</span><span id="570" class="l"><a href="#570">570: </a>                <span class="php-var">$context</span>[<span class="php-quote">'rawblock'</span>] = <span class="php-keyword1">false</span>;
</span><span id="571" class="l"><a href="#571">571: </a>            } <span class="php-keyword1">else</span> {
</span><span id="572" class="l"><a href="#572">572: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$token</span>[Token::POS_OP]) {
</span><span id="573" class="l"><a href="#573">573: </a>                    <span class="php-var">$context</span>[<span class="php-quote">'error'</span>][] = <span class="php-quote">&quot;Wrong raw block begin with &quot;</span> . Token::toString(<span class="php-var">$token</span>) . <span class="php-quote">' ! Remove &quot;'</span> . <span class="php-var">$token</span>[Token::POS_OP] . <span class="php-quote">'&quot; to fix this issue.'</span>;
</span><span id="574" class="l"><a href="#574">574: </a>                }
</span><span id="575" class="l"><a href="#575">575: </a>                <span class="php-var">$context</span>[<span class="php-quote">'rawblock'</span>] = <span class="php-var">$token</span>[Token::POS_INNERTAG];
</span><span id="576" class="l"><a href="#576">576: </a>                Parser::setDelimiter(<span class="php-var">$context</span>);
</span><span id="577" class="l"><a href="#577">577: </a>                <span class="php-var">$token</span>[Token::POS_OP] = <span class="php-quote">'#'</span>;
</span><span id="578" class="l"><a href="#578">578: </a>            }
</span><span id="579" class="l"><a href="#579">579: </a>            <span class="php-var">$token</span>[Token::POS_ENDRAW] = <span class="php-quote">'}}'</span>;
</span><span id="580" class="l"><a href="#580">580: </a>        }
</span><span id="581" class="l"><a href="#581">581: </a>    }
</span><span id="582" class="l"><a href="#582">582: </a>
</span><span id="583" class="l"><a href="#583">583: </a>    <span class="php-comment">/**
</span></span><span id="584" class="l"><a href="#584">584: </a><span class="php-comment">     * handle comment
</span></span><span id="585" class="l"><a href="#585">585: </a><span class="php-comment">     *
</span></span><span id="586" class="l"><a href="#586">586: </a><span class="php-comment">     * @param string[] $token detected handlebars {{ }} token
</span></span><span id="587" class="l"><a href="#587">587: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="588" class="l"><a href="#588">588: </a><span class="php-comment">     *
</span></span><span id="589" class="l"><a href="#589">589: </a><span class="php-comment">     * @return boolean|null Return true when is comment
</span></span><span id="590" class="l"><a href="#590">590: </a><span class="php-comment">     */</span>
</span><span id="591" class="l"><a href="#591">591: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> comment(&amp;<span class="php-var">$token</span>, &amp;<span class="php-var">$context</span>)
</span><span id="592" class="l"><a href="#592">592: </a>    {
</span><span id="593" class="l"><a href="#593">593: </a>        <span class="php-keyword1">if</span> (<span class="php-var">$token</span>[Token::POS_OP] === <span class="php-quote">'!'</span>) {
</span><span id="594" class="l"><a href="#594">594: </a>            <span class="php-var">$context</span>[<span class="php-quote">'usedFeature'</span>][<span class="php-quote">'comment'</span>]++;
</span><span id="595" class="l"><a href="#595">595: </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="596" class="l"><a href="#596">596: </a>        }
</span><span id="597" class="l"><a href="#597">597: </a>    }
</span><span id="598" class="l"><a href="#598">598: </a>
</span><span id="599" class="l"><a href="#599">599: </a>    <span class="php-comment">/**
</span></span><span id="600" class="l"><a href="#600">600: </a><span class="php-comment">     * Collect handlebars usage information, detect template error.
</span></span><span id="601" class="l"><a href="#601">601: </a><span class="php-comment">     *
</span></span><span id="602" class="l"><a href="#602">602: </a><span class="php-comment">     * @param string[] $token detected handlebars {{ }} token
</span></span><span id="603" class="l"><a href="#603">603: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="604" class="l"><a href="#604">604: </a><span class="php-comment">     *
</span></span><span id="605" class="l"><a href="#605">605: </a><span class="php-comment">     * @return string|array&lt;string,array|string|integer&gt;|null $token string when rawblock; array when valid token require to be compiled, null when skip the token.
</span></span><span id="606" class="l"><a href="#606">606: </a><span class="php-comment">     */</span>
</span><span id="607" class="l"><a href="#607">607: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> token(&amp;<span class="php-var">$token</span>, &amp;<span class="php-var">$context</span>)
</span><span id="608" class="l"><a href="#608">608: </a>    {
</span><span id="609" class="l"><a href="#609">609: </a>        <span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>] = &amp;<span class="php-var">$token</span>;
</span><span id="610" class="l"><a href="#610">610: </a>
</span><span id="611" class="l"><a href="#611">611: </a>        <span class="php-keyword1">if</span> (<span class="php-keyword1">static</span>::rawblock(<span class="php-var">$token</span>, <span class="php-var">$context</span>)) {
</span><span id="612" class="l"><a href="#612">612: </a>            <span class="php-keyword1">return</span> Token::toString(<span class="php-var">$token</span>);
</span><span id="613" class="l"><a href="#613">613: </a>        }
</span><span id="614" class="l"><a href="#614">614: </a>
</span><span id="615" class="l"><a href="#615">615: </a>        <span class="php-keyword1">if</span> (<span class="php-keyword1">static</span>::delimiter(<span class="php-var">$token</span>, <span class="php-var">$context</span>)) {
</span><span id="616" class="l"><a href="#616">616: </a>            <span class="php-keyword1">return</span>;
</span><span id="617" class="l"><a href="#617">617: </a>        }
</span><span id="618" class="l"><a href="#618">618: </a>
</span><span id="619" class="l"><a href="#619">619: </a>        <span class="php-keyword1">if</span> (<span class="php-keyword1">static</span>::isDelimiter(<span class="php-var">$context</span>)) {
</span><span id="620" class="l"><a href="#620">620: </a>            <span class="php-keyword1">static</span>::spacing(<span class="php-var">$token</span>, <span class="php-var">$context</span>);
</span><span id="621" class="l"><a href="#621">621: </a>            <span class="php-keyword1">return</span>;
</span><span id="622" class="l"><a href="#622">622: </a>        }
</span><span id="623" class="l"><a href="#623">623: </a>
</span><span id="624" class="l"><a href="#624">624: </a>        <span class="php-keyword1">if</span> (<span class="php-keyword1">static</span>::comment(<span class="php-var">$token</span>, <span class="php-var">$context</span>)) {
</span><span id="625" class="l"><a href="#625">625: </a>            <span class="php-keyword1">static</span>::spacing(<span class="php-var">$token</span>, <span class="php-var">$context</span>);
</span><span id="626" class="l"><a href="#626">626: </a>            <span class="php-keyword1">return</span>;
</span><span id="627" class="l"><a href="#627">627: </a>        }
</span><span id="628" class="l"><a href="#628">628: </a>
</span><span id="629" class="l"><a href="#629">629: </a>        <span class="php-keyword1">list</span>(<span class="php-var">$raw</span>, <span class="php-var">$vars</span>) = Parser::parse(<span class="php-var">$token</span>, <span class="php-var">$context</span>);
</span><span id="630" class="l"><a href="#630">630: </a>
</span><span id="631" class="l"><a href="#631">631: </a>        <span class="php-comment">// Handle spacing (standalone tags, partial indent)</span>
</span><span id="632" class="l"><a href="#632">632: </a>        <span class="php-keyword1">static</span>::spacing(<span class="php-var">$token</span>, <span class="php-var">$context</span>, ((<span class="php-var">$token</span>[Token::POS_OP] === <span class="php-quote">''</span>) || (<span class="php-var">$token</span>[Token::POS_OP] === <span class="php-quote">'&amp;'</span>)) &amp;&amp; (!<span class="php-var">$context</span>[<span class="php-quote">'flags'</span>][<span class="php-quote">'else'</span>] || !<span class="php-keyword1">isset</span>(<span class="php-var">$vars</span>[<span class="php-num">0</span>][<span class="php-num">0</span>]) || (<span class="php-var">$vars</span>[<span class="php-num">0</span>][<span class="php-num">0</span>] !== <span class="php-quote">'else'</span>)) || (<span class="php-var">$context</span>[<span class="php-quote">'flags'</span>][<span class="php-quote">'nostd'</span>] &gt; <span class="php-num">0</span>));
</span><span id="633" class="l"><a href="#633">633: </a>
</span><span id="634" class="l"><a href="#634">634: </a>        <span class="php-var">$inlinepartial</span> = <span class="php-keyword1">static</span>::inlinePartial(<span class="php-var">$context</span>, <span class="php-var">$vars</span>);
</span><span id="635" class="l"><a href="#635">635: </a>        <span class="php-var">$partialblock</span> = <span class="php-keyword1">static</span>::partialBlock(<span class="php-var">$context</span>, <span class="php-var">$vars</span>);
</span><span id="636" class="l"><a href="#636">636: </a>
</span><span id="637" class="l"><a href="#637">637: </a>        <span class="php-keyword1">if</span> (<span class="php-var">$partialblock</span> || <span class="php-var">$inlinepartial</span>) {
</span><span id="638" class="l"><a href="#638">638: </a>            <span class="php-var">$context</span>[<span class="php-quote">'stack'</span>] = <span class="php-keyword2">array_slice</span>(<span class="php-var">$context</span>[<span class="php-quote">'stack'</span>], <span class="php-num">0</span>, -<span class="php-num">4</span>);
</span><span id="639" class="l"><a href="#639">639: </a>            <span class="php-keyword1">static</span>::pushPartial(<span class="php-var">$context</span>, <span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_LOTHER] . <span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_LSPACE] . Token::toString(<span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>]));
</span><span id="640" class="l"><a href="#640">640: </a>            <span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_LOTHER] = <span class="php-quote">''</span>;
</span><span id="641" class="l"><a href="#641">641: </a>            <span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_LSPACE] = <span class="php-quote">''</span>;
</span><span id="642" class="l"><a href="#642">642: </a>            <span class="php-keyword1">return</span>;
</span><span id="643" class="l"><a href="#643">643: </a>        }
</span><span id="644" class="l"><a href="#644">644: </a>
</span><span id="645" class="l"><a href="#645">645: </a>        <span class="php-keyword1">if</span> (<span class="php-keyword1">static</span>::operator(<span class="php-var">$token</span>[Token::POS_OP], <span class="php-var">$context</span>, <span class="php-var">$vars</span>)) {
</span><span id="646" class="l"><a href="#646">646: </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">isset</span>(<span class="php-var">$token</span>[Token::POS_BACKFILL]) ? <span class="php-keyword1">null</span> : <span class="php-keyword1">array</span>(<span class="php-var">$raw</span>, <span class="php-var">$vars</span>);
</span><span id="647" class="l"><a href="#647">647: </a>        }
</span><span id="648" class="l"><a href="#648">648: </a>
</span><span id="649" class="l"><a href="#649">649: </a>        <span class="php-keyword1">if</span> (<span class="php-keyword2">count</span>(<span class="php-var">$vars</span>) == <span class="php-num">0</span>) {
</span><span id="650" class="l"><a href="#650">650: </a>            <span class="php-keyword1">return</span> <span class="php-var">$context</span>[<span class="php-quote">'error'</span>][] = <span class="php-quote">'Wrong variable naming in '</span> . Token::toString(<span class="php-var">$token</span>);
</span><span id="651" class="l"><a href="#651">651: </a>        }
</span><span id="652" class="l"><a href="#652">652: </a>
</span><span id="653" class="l"><a href="#653">653: </a>        <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$vars</span>[<span class="php-num">0</span>])) {
</span><span id="654" class="l"><a href="#654">654: </a>            <span class="php-keyword1">return</span> <span class="php-var">$context</span>[<span class="php-quote">'error'</span>][] = <span class="php-quote">'Do not support name=value in '</span> . Token::toString(<span class="php-var">$token</span>) . <span class="php-quote">', you should use it after a custom helper.'</span>;
</span><span id="655" class="l"><a href="#655">655: </a>        }
</span><span id="656" class="l"><a href="#656">656: </a>
</span><span id="657" class="l"><a href="#657">657: </a>        <span class="php-var">$context</span>[<span class="php-quote">'usedFeature'</span>][<span class="php-var">$raw</span> ? <span class="php-quote">'raw'</span> : <span class="php-quote">'enc'</span>]++;
</span><span id="658" class="l"><a href="#658">658: </a>
</span><span id="659" class="l"><a href="#659">659: </a>        <span class="php-keyword1">foreach</span> (<span class="php-var">$vars</span> <span class="php-keyword1">as</span> <span class="php-var">$var</span>) {
</span><span id="660" class="l"><a href="#660">660: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$var</span>[<span class="php-num">0</span>]) || (<span class="php-var">$var</span>[<span class="php-num">0</span>] === <span class="php-num">0</span>)) {
</span><span id="661" class="l"><a href="#661">661: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$context</span>[<span class="php-quote">'level'</span>] == <span class="php-num">0</span>) {
</span><span id="662" class="l"><a href="#662">662: </a>                    <span class="php-var">$context</span>[<span class="php-quote">'usedFeature'</span>][<span class="php-quote">'rootthis'</span>]++;
</span><span id="663" class="l"><a href="#663">663: </a>                }
</span><span id="664" class="l"><a href="#664">664: </a>                <span class="php-var">$context</span>[<span class="php-quote">'usedFeature'</span>][<span class="php-quote">'this'</span>]++;
</span><span id="665" class="l"><a href="#665">665: </a>            }
</span><span id="666" class="l"><a href="#666">666: </a>        }
</span><span id="667" class="l"><a href="#667">667: </a>
</span><span id="668" class="l"><a href="#668">668: </a>        <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$vars</span>[<span class="php-num">0</span>][<span class="php-num">0</span>])) {
</span><span id="669" class="l"><a href="#669">669: </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">array</span>(<span class="php-var">$raw</span>, <span class="php-var">$vars</span>);
</span><span id="670" class="l"><a href="#670">670: </a>        }
</span><span id="671" class="l"><a href="#671">671: </a>
</span><span id="672" class="l"><a href="#672">672: </a>        <span class="php-keyword1">if</span> ((<span class="php-var">$vars</span>[<span class="php-num">0</span>][<span class="php-num">0</span>] === <span class="php-quote">'else'</span>) &amp;&amp; <span class="php-var">$context</span>[<span class="php-quote">'flags'</span>][<span class="php-quote">'else'</span>]) {
</span><span id="673" class="l"><a href="#673">673: </a>            <span class="php-keyword1">static</span>::doElse(<span class="php-var">$context</span>, <span class="php-var">$vars</span>);
</span><span id="674" class="l"><a href="#674">674: </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">array</span>(<span class="php-var">$raw</span>, <span class="php-var">$vars</span>);
</span><span id="675" class="l"><a href="#675">675: </a>        }
</span><span id="676" class="l"><a href="#676">676: </a>
</span><span id="677" class="l"><a href="#677">677: </a>        <span class="php-keyword1">if</span> (!<span class="php-keyword1">static</span>::helper(<span class="php-var">$context</span>, <span class="php-var">$vars</span>)) {
</span><span id="678" class="l"><a href="#678">678: </a>            <span class="php-keyword1">static</span>::lookup(<span class="php-var">$context</span>, <span class="php-var">$vars</span>);
</span><span id="679" class="l"><a href="#679">679: </a>            <span class="php-keyword1">static</span>::<span class="php-keyword2">log</span>(<span class="php-var">$context</span>, <span class="php-var">$vars</span>);
</span><span id="680" class="l"><a href="#680">680: </a>        }
</span><span id="681" class="l"><a href="#681">681: </a>
</span><span id="682" class="l"><a href="#682">682: </a>        <span class="php-keyword1">return</span> <span class="php-keyword1">array</span>(<span class="php-var">$raw</span>, <span class="php-var">$vars</span>);
</span><span id="683" class="l"><a href="#683">683: </a>    }
</span><span id="684" class="l"><a href="#684">684: </a>
</span><span id="685" class="l"><a href="#685">685: </a>    <span class="php-comment">/**
</span></span><span id="686" class="l"><a href="#686">686: </a><span class="php-comment">     * Return 1 or larger number when else token detected
</span></span><span id="687" class="l"><a href="#687">687: </a><span class="php-comment">     *
</span></span><span id="688" class="l"><a href="#688">688: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="689" class="l"><a href="#689">689: </a><span class="php-comment">     * @param array&lt;boolean|integer|string|array&gt; $vars parsed arguments list
</span></span><span id="690" class="l"><a href="#690">690: </a><span class="php-comment">     *
</span></span><span id="691" class="l"><a href="#691">691: </a><span class="php-comment">     * @return integer Return 1 or larger number when else token detected
</span></span><span id="692" class="l"><a href="#692">692: </a><span class="php-comment">     */</span>
</span><span id="693" class="l"><a href="#693">693: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> doElse(&amp;<span class="php-var">$context</span>, <span class="php-var">$vars</span>)
</span><span id="694" class="l"><a href="#694">694: </a>    {
</span><span id="695" class="l"><a href="#695">695: </a>        <span class="php-keyword1">if</span> (<span class="php-var">$context</span>[<span class="php-quote">'level'</span>] == <span class="php-num">0</span>) {
</span><span id="696" class="l"><a href="#696">696: </a>            <span class="php-var">$context</span>[<span class="php-quote">'error'</span>][] = <span class="php-quote">'{{else}} only valid in if, unless, each, and #section context'</span>;
</span><span id="697" class="l"><a href="#697">697: </a>        }
</span><span id="698" class="l"><a href="#698">698: </a>
</span><span id="699" class="l"><a href="#699">699: </a>        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$vars</span>[<span class="php-num">1</span>][<span class="php-num">0</span>])) {
</span><span id="700" class="l"><a href="#700">700: </a>            <span class="php-var">$token</span> = <span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>];
</span><span id="701" class="l"><a href="#701">701: </a>            <span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_INNERTAG] = <span class="php-quote">'else'</span>;
</span><span id="702" class="l"><a href="#702">702: </a>            <span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_RSPACE] = <span class="php-quote">&quot;{{#</span><span class="php-var">{$vars[1][0]}</span><span class="php-quote"> &quot;</span> . <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/^\\s*else\\s+'</span> . <span class="php-var">$vars</span>[<span class="php-num">1</span>][<span class="php-num">0</span>] . <span class="php-quote">'\\s*/'</span>, <span class="php-quote">''</span>, <span class="php-var">$token</span>[Token::POS_INNERTAG]) . <span class="php-quote">'}}'</span> . <span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_RSPACE];
</span><span id="703" class="l"><a href="#703">703: </a>            <span class="php-keyword2">array_unshift</span>(<span class="php-var">$context</span>[<span class="php-quote">'elselvl'</span>][<span class="php-num">0</span>], <span class="php-var">$vars</span>[<span class="php-num">1</span>][<span class="php-num">0</span>]);
</span><span id="704" class="l"><a href="#704">704: </a>            <span class="php-var">$context</span>[<span class="php-quote">'elsechain'</span>] = <span class="php-keyword1">true</span>;
</span><span id="705" class="l"><a href="#705">705: </a>        }
</span><span id="706" class="l"><a href="#706">706: </a>
</span><span id="707" class="l"><a href="#707">707: </a>        <span class="php-keyword1">return</span> ++<span class="php-var">$context</span>[<span class="php-quote">'usedFeature'</span>][<span class="php-quote">'else'</span>];
</span><span id="708" class="l"><a href="#708">708: </a>    }
</span><span id="709" class="l"><a href="#709">709: </a>
</span><span id="710" class="l"><a href="#710">710: </a>    <span class="php-comment">/**
</span></span><span id="711" class="l"><a href="#711">711: </a><span class="php-comment">     * Return true when this is {{log ...}}
</span></span><span id="712" class="l"><a href="#712">712: </a><span class="php-comment">     *
</span></span><span id="713" class="l"><a href="#713">713: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="714" class="l"><a href="#714">714: </a><span class="php-comment">     * @param array&lt;boolean|integer|string|array&gt; $vars parsed arguments list
</span></span><span id="715" class="l"><a href="#715">715: </a><span class="php-comment">     *
</span></span><span id="716" class="l"><a href="#716">716: </a><span class="php-comment">     * @return boolean|null Return true when it is custom helper
</span></span><span id="717" class="l"><a href="#717">717: </a><span class="php-comment">     */</span>
</span><span id="718" class="l"><a href="#718">718: </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> <span class="php-keyword2">log</span>(&amp;<span class="php-var">$context</span>, <span class="php-var">$vars</span>)
</span><span id="719" class="l"><a href="#719">719: </a>    {
</span><span id="720" class="l"><a href="#720">720: </a>        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$vars</span>[<span class="php-num">0</span>][<span class="php-num">0</span>]) &amp;&amp; (<span class="php-var">$vars</span>[<span class="php-num">0</span>][<span class="php-num">0</span>] === <span class="php-quote">'log'</span>)) {
</span><span id="721" class="l"><a href="#721">721: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$context</span>[<span class="php-quote">'flags'</span>][<span class="php-quote">'nohbh'</span>]) {
</span><span id="722" class="l"><a href="#722">722: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">count</span>(<span class="php-var">$vars</span>) &lt; <span class="php-num">2</span>) {
</span><span id="723" class="l"><a href="#723">723: </a>                    <span class="php-var">$context</span>[<span class="php-quote">'error'</span>][] = <span class="php-quote">&quot;No argument after {{log}} !&quot;</span>;
</span><span id="724" class="l"><a href="#724">724: </a>                }
</span><span id="725" class="l"><a href="#725">725: </a>                <span class="php-var">$context</span>[<span class="php-quote">'usedFeature'</span>][<span class="php-quote">'log'</span>]++;
</span><span id="726" class="l"><a href="#726">726: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="727" class="l"><a href="#727">727: </a>            }
</span><span id="728" class="l"><a href="#728">728: </a>        }
</span><span id="729" class="l"><a href="#729">729: </a>    }
</span><span id="730" class="l"><a href="#730">730: </a>
</span><span id="731" class="l"><a href="#731">731: </a>    <span class="php-comment">/**
</span></span><span id="732" class="l"><a href="#732">732: </a><span class="php-comment">     * Return true when this is {{lookup ...}}
</span></span><span id="733" class="l"><a href="#733">733: </a><span class="php-comment">     *
</span></span><span id="734" class="l"><a href="#734">734: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="735" class="l"><a href="#735">735: </a><span class="php-comment">     * @param array&lt;boolean|integer|string|array&gt; $vars parsed arguments list
</span></span><span id="736" class="l"><a href="#736">736: </a><span class="php-comment">     *
</span></span><span id="737" class="l"><a href="#737">737: </a><span class="php-comment">     * @return boolean|null Return true when it is custom helper
</span></span><span id="738" class="l"><a href="#738">738: </a><span class="php-comment">     */</span>
</span><span id="739" class="l"><a href="#739">739: </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> lookup(&amp;<span class="php-var">$context</span>, <span class="php-var">$vars</span>)
</span><span id="740" class="l"><a href="#740">740: </a>    {
</span><span id="741" class="l"><a href="#741">741: </a>        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$vars</span>[<span class="php-num">0</span>][<span class="php-num">0</span>]) &amp;&amp; (<span class="php-var">$vars</span>[<span class="php-num">0</span>][<span class="php-num">0</span>] === <span class="php-quote">'lookup'</span>)) {
</span><span id="742" class="l"><a href="#742">742: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$context</span>[<span class="php-quote">'flags'</span>][<span class="php-quote">'nohbh'</span>]) {
</span><span id="743" class="l"><a href="#743">743: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">count</span>(<span class="php-var">$vars</span>) &lt; <span class="php-num">2</span>) {
</span><span id="744" class="l"><a href="#744">744: </a>                    <span class="php-var">$context</span>[<span class="php-quote">'error'</span>][] = <span class="php-quote">&quot;No argument after {{lookup}} !&quot;</span>;
</span><span id="745" class="l"><a href="#745">745: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword2">count</span>(<span class="php-var">$vars</span>) &lt; <span class="php-num">3</span>) {
</span><span id="746" class="l"><a href="#746">746: </a>                    <span class="php-var">$context</span>[<span class="php-quote">'error'</span>][] = <span class="php-quote">&quot;{{lookup}} requires 2 arguments !&quot;</span>;
</span><span id="747" class="l"><a href="#747">747: </a>                }
</span><span id="748" class="l"><a href="#748">748: </a>                <span class="php-var">$context</span>[<span class="php-quote">'usedFeature'</span>][<span class="php-quote">'lookup'</span>]++;
</span><span id="749" class="l"><a href="#749">749: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="750" class="l"><a href="#750">750: </a>            }
</span><span id="751" class="l"><a href="#751">751: </a>        }
</span><span id="752" class="l"><a href="#752">752: </a>    }
</span><span id="753" class="l"><a href="#753">753: </a>
</span><span id="754" class="l"><a href="#754">754: </a>    <span class="php-comment">/**
</span></span><span id="755" class="l"><a href="#755">755: </a><span class="php-comment">     * Return true when the name is listed in helper table
</span></span><span id="756" class="l"><a href="#756">756: </a><span class="php-comment">     *
</span></span><span id="757" class="l"><a href="#757">757: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="758" class="l"><a href="#758">758: </a><span class="php-comment">     * @param array&lt;boolean|integer|string|array&gt; $vars parsed arguments list
</span></span><span id="759" class="l"><a href="#759">759: </a><span class="php-comment">     * @param boolean $checkSubexp true when check for subexpression
</span></span><span id="760" class="l"><a href="#760">760: </a><span class="php-comment">     *
</span></span><span id="761" class="l"><a href="#761">761: </a><span class="php-comment">     * @return boolean Return true when it is custom helper
</span></span><span id="762" class="l"><a href="#762">762: </a><span class="php-comment">     */</span>
</span><span id="763" class="l"><a href="#763">763: </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> helper(&amp;<span class="php-var">$context</span>, <span class="php-var">$vars</span>, <span class="php-var">$checkSubexp</span> = <span class="php-keyword1">false</span>)
</span><span id="764" class="l"><a href="#764">764: </a>    {
</span><span id="765" class="l"><a href="#765">765: </a>        <span class="php-keyword1">if</span> (<span class="php-keyword1">static</span>::resolveHelper(<span class="php-var">$context</span>, <span class="php-var">$vars</span>)) {
</span><span id="766" class="l"><a href="#766">766: </a>            <span class="php-var">$context</span>[<span class="php-quote">'usedFeature'</span>][<span class="php-quote">'helper'</span>]++;
</span><span id="767" class="l"><a href="#767">767: </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="768" class="l"><a href="#768">768: </a>        }
</span><span id="769" class="l"><a href="#769">769: </a>
</span><span id="770" class="l"><a href="#770">770: </a>        <span class="php-keyword1">if</span> (<span class="php-var">$checkSubexp</span>) {
</span><span id="771" class="l"><a href="#771">771: </a>            <span class="php-keyword1">switch</span> (<span class="php-var">$vars</span>[<span class="php-num">0</span>][<span class="php-num">0</span>]) {
</span><span id="772" class="l"><a href="#772">772: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'if'</span>:
</span><span id="773" class="l"><a href="#773">773: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'unless'</span>:
</span><span id="774" class="l"><a href="#774">774: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'with'</span>:
</span><span id="775" class="l"><a href="#775">775: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'each'</span>:
</span><span id="776" class="l"><a href="#776">776: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'lookup'</span>:
</span><span id="777" class="l"><a href="#777">777: </a>                    <span class="php-keyword1">return</span> <span class="php-var">$context</span>[<span class="php-quote">'flags'</span>][<span class="php-quote">'nohbh'</span>] ? <span class="php-keyword1">false</span> : <span class="php-keyword1">true</span>;
</span><span id="778" class="l"><a href="#778">778: </a>            }
</span><span id="779" class="l"><a href="#779">779: </a>        }
</span><span id="780" class="l"><a href="#780">780: </a>
</span><span id="781" class="l"><a href="#781">781: </a>        <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="782" class="l"><a href="#782">782: </a>    }
</span><span id="783" class="l"><a href="#783">783: </a>
</span><span id="784" class="l"><a href="#784">784: </a>    <span class="php-comment">/**
</span></span><span id="785" class="l"><a href="#785">785: </a><span class="php-comment">     * use helperresolver to resolve helper, return true when helper founded
</span></span><span id="786" class="l"><a href="#786">786: </a><span class="php-comment">     *
</span></span><span id="787" class="l"><a href="#787">787: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context Current context of compiler progress.
</span></span><span id="788" class="l"><a href="#788">788: </a><span class="php-comment">     * @param array&lt;boolean|integer|string|array&gt; $vars parsed arguments list
</span></span><span id="789" class="l"><a href="#789">789: </a><span class="php-comment">     *
</span></span><span id="790" class="l"><a href="#790">790: </a><span class="php-comment">     * @return boolean $found helper exists or not
</span></span><span id="791" class="l"><a href="#791">791: </a><span class="php-comment">     */</span>
</span><span id="792" class="l"><a href="#792">792: </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> resolveHelper(&amp;<span class="php-var">$context</span>, &amp;<span class="php-var">$vars</span>)
</span><span id="793" class="l"><a href="#793">793: </a>    {
</span><span id="794" class="l"><a href="#794">794: </a>        <span class="php-keyword1">if</span> (<span class="php-keyword2">count</span>(<span class="php-var">$vars</span>[<span class="php-num">0</span>]) !== <span class="php-num">1</span>) {
</span><span id="795" class="l"><a href="#795">795: </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="796" class="l"><a href="#796">796: </a>        }
</span><span id="797" class="l"><a href="#797">797: </a>        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$context</span>[<span class="php-quote">'helpers'</span>][<span class="php-var">$vars</span>[<span class="php-num">0</span>][<span class="php-num">0</span>]])) {
</span><span id="798" class="l"><a href="#798">798: </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="799" class="l"><a href="#799">799: </a>        }
</span><span id="800" class="l"><a href="#800">800: </a>
</span><span id="801" class="l"><a href="#801">801: </a>        <span class="php-keyword1">if</span> (<span class="php-var">$context</span>[<span class="php-quote">'helperresolver'</span>]) {
</span><span id="802" class="l"><a href="#802">802: </a>            <span class="php-var">$helper</span> = <span class="php-var">$context</span>[<span class="php-quote">'helperresolver'</span>](<span class="php-var">$context</span>, <span class="php-var">$vars</span>[<span class="php-num">0</span>][<span class="php-num">0</span>]);
</span><span id="803" class="l"><a href="#803">803: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$helper</span>) {
</span><span id="804" class="l"><a href="#804">804: </a>                <span class="php-var">$context</span>[<span class="php-quote">'helpers'</span>][<span class="php-var">$vars</span>[<span class="php-num">0</span>][<span class="php-num">0</span>]] = <span class="php-var">$helper</span>;
</span><span id="805" class="l"><a href="#805">805: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="806" class="l"><a href="#806">806: </a>            }
</span><span id="807" class="l"><a href="#807">807: </a>        }
</span><span id="808" class="l"><a href="#808">808: </a>
</span><span id="809" class="l"><a href="#809">809: </a>        <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="810" class="l"><a href="#810">810: </a>    }
</span><span id="811" class="l"><a href="#811">811: </a>
</span><span id="812" class="l"><a href="#812">812: </a>    <span class="php-comment">/**
</span></span><span id="813" class="l"><a href="#813">813: </a><span class="php-comment">     * detect for block custom helper
</span></span><span id="814" class="l"><a href="#814">814: </a><span class="php-comment">     *
</span></span><span id="815" class="l"><a href="#815">815: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="816" class="l"><a href="#816">816: </a><span class="php-comment">     * @param array&lt;boolean|integer|string|array&gt; $vars parsed arguments list
</span></span><span id="817" class="l"><a href="#817">817: </a><span class="php-comment">     *
</span></span><span id="818" class="l"><a href="#818">818: </a><span class="php-comment">     * @return boolean|null Return true when this token is block custom helper
</span></span><span id="819" class="l"><a href="#819">819: </a><span class="php-comment">     */</span>
</span><span id="820" class="l"><a href="#820">820: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> isBlockHelper(<span class="php-var">$context</span>, <span class="php-var">$vars</span>)
</span><span id="821" class="l"><a href="#821">821: </a>    {
</span><span id="822" class="l"><a href="#822">822: </a>        <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$vars</span>[<span class="php-num">0</span>][<span class="php-num">0</span>])) {
</span><span id="823" class="l"><a href="#823">823: </a>            <span class="php-keyword1">return</span>;
</span><span id="824" class="l"><a href="#824">824: </a>        }
</span><span id="825" class="l"><a href="#825">825: </a>
</span><span id="826" class="l"><a href="#826">826: </a>        <span class="php-keyword1">if</span> (!<span class="php-keyword1">static</span>::resolveHelper(<span class="php-var">$context</span>, <span class="php-var">$vars</span>)) {
</span><span id="827" class="l"><a href="#827">827: </a>            <span class="php-keyword1">return</span>;
</span><span id="828" class="l"><a href="#828">828: </a>        }
</span><span id="829" class="l"><a href="#829">829: </a>
</span><span id="830" class="l"><a href="#830">830: </a>        <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="831" class="l"><a href="#831">831: </a>    }
</span><span id="832" class="l"><a href="#832">832: </a>
</span><span id="833" class="l"><a href="#833">833: </a>    <span class="php-comment">/**
</span></span><span id="834" class="l"><a href="#834">834: </a><span class="php-comment">     * validate inline partial
</span></span><span id="835" class="l"><a href="#835">835: </a><span class="php-comment">     *
</span></span><span id="836" class="l"><a href="#836">836: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="837" class="l"><a href="#837">837: </a><span class="php-comment">     * @param array&lt;boolean|integer|string|array&gt; $vars parsed arguments list
</span></span><span id="838" class="l"><a href="#838">838: </a><span class="php-comment">     *
</span></span><span id="839" class="l"><a href="#839">839: </a><span class="php-comment">     * @return boolean Return true always
</span></span><span id="840" class="l"><a href="#840">840: </a><span class="php-comment">     */</span>
</span><span id="841" class="l"><a href="#841">841: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> inline(&amp;<span class="php-var">$context</span>, <span class="php-var">$vars</span>)
</span><span id="842" class="l"><a href="#842">842: </a>    {
</span><span id="843" class="l"><a href="#843">843: </a>        <span class="php-keyword1">if</span> (!<span class="php-var">$context</span>[<span class="php-quote">'flags'</span>][<span class="php-quote">'runpart'</span>]) {
</span><span id="844" class="l"><a href="#844">844: </a>            <span class="php-var">$context</span>[<span class="php-quote">'error'</span>][] = <span class="php-quote">&quot;Do not support {{#*</span><span class="php-var">{$context['currentToken'][Token::POS_INNERTAG]}</span><span class="php-quote">}}, you should do compile with LightnCandy::FLAG_RUNTIMEPARTIAL flag&quot;</span>;
</span><span id="845" class="l"><a href="#845">845: </a>        }
</span><span id="846" class="l"><a href="#846">846: </a>        <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$vars</span>[<span class="php-num">0</span>][<span class="php-num">0</span>]) || (<span class="php-var">$vars</span>[<span class="php-num">0</span>][<span class="php-num">0</span>] !== <span class="php-quote">'inline'</span>)) {
</span><span id="847" class="l"><a href="#847">847: </a>            <span class="php-var">$context</span>[<span class="php-quote">'error'</span>][] = <span class="php-quote">&quot;Do not support {{#*</span><span class="php-var">{$context['currentToken'][Token::POS_INNERTAG]}</span><span class="php-quote">}}, now we only support {{#*inline \&quot;partialName\&quot;}}template...{{/inline}}&quot;</span>;
</span><span id="848" class="l"><a href="#848">848: </a>        }
</span><span id="849" class="l"><a href="#849">849: </a>        <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$vars</span>[<span class="php-num">1</span>][<span class="php-num">0</span>])) {
</span><span id="850" class="l"><a href="#850">850: </a>            <span class="php-var">$context</span>[<span class="php-quote">'error'</span>][] = <span class="php-quote">&quot;Error in {{#*</span><span class="php-var">{$context['currentToken'][Token::POS_INNERTAG]}</span><span class="php-quote">}}: inline require 1 argument for partial name!&quot;</span>;
</span><span id="851" class="l"><a href="#851">851: </a>        }
</span><span id="852" class="l"><a href="#852">852: </a>        <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="853" class="l"><a href="#853">853: </a>    }
</span><span id="854" class="l"><a href="#854">854: </a>
</span><span id="855" class="l"><a href="#855">855: </a>    <span class="php-comment">/**
</span></span><span id="856" class="l"><a href="#856">856: </a><span class="php-comment">     * validate partial
</span></span><span id="857" class="l"><a href="#857">857: </a><span class="php-comment">     *
</span></span><span id="858" class="l"><a href="#858">858: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="859" class="l"><a href="#859">859: </a><span class="php-comment">     * @param array&lt;boolean|integer|string|array&gt; $vars parsed arguments list
</span></span><span id="860" class="l"><a href="#860">860: </a><span class="php-comment">     *
</span></span><span id="861" class="l"><a href="#861">861: </a><span class="php-comment">     * @return integer|boolean Return 1 or larger number for runtime partial, return true for other case
</span></span><span id="862" class="l"><a href="#862">862: </a><span class="php-comment">     */</span>
</span><span id="863" class="l"><a href="#863">863: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> partial(&amp;<span class="php-var">$context</span>, <span class="php-var">$vars</span>)
</span><span id="864" class="l"><a href="#864">864: </a>    {
</span><span id="865" class="l"><a href="#865">865: </a>        <span class="php-keyword1">if</span> (Parser::isSubExp(<span class="php-var">$vars</span>[<span class="php-num">0</span>])) {
</span><span id="866" class="l"><a href="#866">866: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$context</span>[<span class="php-quote">'flags'</span>][<span class="php-quote">'runpart'</span>]) {
</span><span id="867" class="l"><a href="#867">867: </a>                <span class="php-keyword1">return</span> <span class="php-var">$context</span>[<span class="php-quote">'usedFeature'</span>][<span class="php-quote">'dynpartial'</span>]++;
</span><span id="868" class="l"><a href="#868">868: </a>            } <span class="php-keyword1">else</span> {
</span><span id="869" class="l"><a href="#869">869: </a>                <span class="php-var">$context</span>[<span class="php-quote">'error'</span>][] = <span class="php-quote">&quot;You use dynamic partial name as '</span><span class="php-var">{$vars[0][2]}</span><span class="php-quote">', this only works with option FLAG_RUNTIMEPARTIAL enabled&quot;</span>;
</span><span id="870" class="l"><a href="#870">870: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="871" class="l"><a href="#871">871: </a>            }
</span><span id="872" class="l"><a href="#872">872: </a>        } <span class="php-keyword1">else</span> {
</span><span id="873" class="l"><a href="#873">873: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$context</span>[<span class="php-quote">'currentToken'</span>][Token::POS_OP] !== <span class="php-quote">'#&gt;'</span>) {
</span><span id="874" class="l"><a href="#874">874: </a>                Partial::read(<span class="php-var">$context</span>, <span class="php-var">$vars</span>[<span class="php-num">0</span>][<span class="php-num">0</span>]);
</span><span id="875" class="l"><a href="#875">875: </a>            }
</span><span id="876" class="l"><a href="#876">876: </a>        }
</span><span id="877" class="l"><a href="#877">877: </a>        <span class="php-keyword1">if</span> (!<span class="php-var">$context</span>[<span class="php-quote">'flags'</span>][<span class="php-quote">'runpart'</span>]) {
</span><span id="878" class="l"><a href="#878">878: </a>            <span class="php-var">$named</span> = <span class="php-keyword2">count</span>(<span class="php-keyword2">array_diff_key</span>(<span class="php-var">$vars</span>, <span class="php-keyword2">array_keys</span>(<span class="php-keyword2">array_keys</span>(<span class="php-var">$vars</span>)))) &gt; <span class="php-num">0</span>;
</span><span id="879" class="l"><a href="#879">879: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$named</span> || (<span class="php-keyword2">count</span>(<span class="php-var">$vars</span>) &gt; <span class="php-num">1</span>)) {
</span><span id="880" class="l"><a href="#880">880: </a>                <span class="php-var">$context</span>[<span class="php-quote">'error'</span>][] = <span class="php-quote">&quot;Do not support {{&gt;</span><span class="php-var">{$context['currentToken'][Token::POS_INNERTAG]}</span><span class="php-quote">}}, you should do compile with LightnCandy::FLAG_RUNTIMEPARTIAL flag&quot;</span>;
</span><span id="881" class="l"><a href="#881">881: </a>            }
</span><span id="882" class="l"><a href="#882">882: </a>        }
</span><span id="883" class="l"><a href="#883">883: </a>
</span><span id="884" class="l"><a href="#884">884: </a>        <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="885" class="l"><a href="#885">885: </a>    }
</span><span id="886" class="l"><a href="#886">886: </a>
</span><span id="887" class="l"><a href="#887">887: </a>    <span class="php-comment">/**
</span></span><span id="888" class="l"><a href="#888">888: </a><span class="php-comment">     * Modify $token when spacing rules matched.
</span></span><span id="889" class="l"><a href="#889">889: </a><span class="php-comment">     *
</span></span><span id="890" class="l"><a href="#890">890: </a><span class="php-comment">     * @param array&lt;string&gt; $token detected handlebars {{ }} token
</span></span><span id="891" class="l"><a href="#891">891: </a><span class="php-comment">     * @param array&lt;string,array|string|integer&gt; $context current compile context
</span></span><span id="892" class="l"><a href="#892">892: </a><span class="php-comment">     * @param boolean $nost do not do stand alone logic
</span></span><span id="893" class="l"><a href="#893">893: </a><span class="php-comment">     *
</span></span><span id="894" class="l"><a href="#894">894: </a><span class="php-comment">     * @return string|null Return compiled code segment for the token
</span></span><span id="895" class="l"><a href="#895">895: </a><span class="php-comment">     */</span>
</span><span id="896" class="l"><a href="#896">896: </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> spacing(&amp;<span class="php-var">$token</span>, &amp;<span class="php-var">$context</span>, <span class="php-var">$nost</span> = <span class="php-keyword1">false</span>)
</span><span id="897" class="l"><a href="#897">897: </a>    {
</span><span id="898" class="l"><a href="#898">898: </a>        <span class="php-comment">// left line change detection</span>
</span><span id="899" class="l"><a href="#899">899: </a>        <span class="php-var">$lsp</span> = <span class="php-keyword2">preg_match</span>(<span class="php-quote">'/^(.*)(\\r?\\n)([ \\t]*?)$/s'</span>, <span class="php-var">$token</span>[Token::POS_LSPACE], <span class="php-var">$lmatch</span>);
</span><span id="900" class="l"><a href="#900">900: </a>        <span class="php-var">$ind</span> = <span class="php-var">$lsp</span> ? <span class="php-var">$lmatch</span>[<span class="php-num">3</span>] : <span class="php-var">$token</span>[Token::POS_LSPACE];
</span><span id="901" class="l"><a href="#901">901: </a>        <span class="php-comment">// right line change detection</span>
</span><span id="902" class="l"><a href="#902">902: </a>        <span class="php-var">$rsp</span> = <span class="php-keyword2">preg_match</span>(<span class="php-quote">'/^([ \\t]*?)(\\r?\\n)(.*)$/s'</span>, <span class="php-var">$token</span>[Token::POS_RSPACE], <span class="php-var">$rmatch</span>);
</span><span id="903" class="l"><a href="#903">903: </a>        <span class="php-var">$st</span> = <span class="php-keyword1">true</span>;
</span><span id="904" class="l"><a href="#904">904: </a>        <span class="php-comment">// setup ahead flag</span>
</span><span id="905" class="l"><a href="#905">905: </a>        <span class="php-var">$ahead</span> = <span class="php-var">$context</span>[<span class="php-quote">'tokens'</span>][<span class="php-quote">'ahead'</span>];
</span><span id="906" class="l"><a href="#906">906: </a>        <span class="php-var">$context</span>[<span class="php-quote">'tokens'</span>][<span class="php-quote">'ahead'</span>] = <span class="php-keyword2">preg_match</span>(<span class="php-quote">'/^[^\n]*{{/s'</span>, <span class="php-var">$token</span>[Token::POS_RSPACE] . <span class="php-var">$token</span>[Token::POS_ROTHER]);
</span><span id="907" class="l"><a href="#907">907: </a>        <span class="php-comment">// reset partial indent</span>
</span><span id="908" class="l"><a href="#908">908: </a>        <span class="php-var">$context</span>[<span class="php-quote">'tokens'</span>][<span class="php-quote">'partialind'</span>] = <span class="php-quote">''</span>;
</span><span id="909" class="l"><a href="#909">909: </a>        <span class="php-comment">// same tags in the same line , not standalone</span>
</span><span id="910" class="l"><a href="#910">910: </a>        <span class="php-keyword1">if</span> (!<span class="php-var">$lsp</span> &amp;&amp; <span class="php-var">$ahead</span>) {
</span><span id="911" class="l"><a href="#911">911: </a>            <span class="php-var">$st</span> = <span class="php-keyword1">false</span>;
</span><span id="912" class="l"><a href="#912">912: </a>        }
</span><span id="913" class="l"><a href="#913">913: </a>        <span class="php-keyword1">if</span> (<span class="php-var">$nost</span>) {
</span><span id="914" class="l"><a href="#914">914: </a>            <span class="php-var">$st</span> = <span class="php-keyword1">false</span>;
</span><span id="915" class="l"><a href="#915">915: </a>        }
</span><span id="916" class="l"><a href="#916">916: </a>        <span class="php-comment">// not standalone because other things in the same line ahead</span>
</span><span id="917" class="l"><a href="#917">917: </a>        <span class="php-keyword1">if</span> (<span class="php-var">$token</span>[Token::POS_LOTHER] &amp;&amp; !<span class="php-var">$token</span>[Token::POS_LSPACE]) {
</span><span id="918" class="l"><a href="#918">918: </a>            <span class="php-var">$st</span> = <span class="php-keyword1">false</span>;
</span><span id="919" class="l"><a href="#919">919: </a>        }
</span><span id="920" class="l"><a href="#920">920: </a>        <span class="php-comment">// not standalone because other things in the same line behind</span>
</span><span id="921" class="l"><a href="#921">921: </a>        <span class="php-keyword1">if</span> (<span class="php-var">$token</span>[Token::POS_ROTHER] &amp;&amp; !<span class="php-var">$token</span>[Token::POS_RSPACE]) {
</span><span id="922" class="l"><a href="#922">922: </a>            <span class="php-var">$st</span> = <span class="php-keyword1">false</span>;
</span><span id="923" class="l"><a href="#923">923: </a>        }
</span><span id="924" class="l"><a href="#924">924: </a>        <span class="php-keyword1">if</span> (<span class="php-var">$st</span> &amp;&amp; (
</span><span id="925" class="l"><a href="#925">925: </a>            (<span class="php-var">$lsp</span> &amp;&amp; <span class="php-var">$rsp</span>) <span class="php-comment">// both side cr</span>
</span><span id="926" class="l"><a href="#926">926: </a>                || (<span class="php-var">$rsp</span> &amp;&amp; !<span class="php-var">$token</span>[Token::POS_LOTHER]) <span class="php-comment">// first line without left</span>
</span><span id="927" class="l"><a href="#927">927: </a>                || (<span class="php-var">$lsp</span> &amp;&amp; !<span class="php-var">$token</span>[Token::POS_ROTHER]) <span class="php-comment">// final line</span>
</span><span id="928" class="l"><a href="#928">928: </a>            )) {
</span><span id="929" class="l"><a href="#929">929: </a>            <span class="php-comment">// handle partial</span>
</span><span id="930" class="l"><a href="#930">930: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$token</span>[Token::POS_OP] === <span class="php-quote">'&gt;'</span>) {
</span><span id="931" class="l"><a href="#931">931: </a>                <span class="php-keyword1">if</span> (!<span class="php-var">$context</span>[<span class="php-quote">'flags'</span>][<span class="php-quote">'noind'</span>]) {
</span><span id="932" class="l"><a href="#932">932: </a>                    <span class="php-var">$context</span>[<span class="php-quote">'tokens'</span>][<span class="php-quote">'partialind'</span>] = <span class="php-var">$token</span>[Token::POS_LSPACECTL] ? <span class="php-quote">''</span> : <span class="php-var">$ind</span>;
</span><span id="933" class="l"><a href="#933">933: </a>                    <span class="php-var">$token</span>[Token::POS_LSPACE] = (<span class="php-keyword1">isset</span>(<span class="php-var">$lmatch</span>[<span class="php-num">2</span>]) ? (<span class="php-var">$lmatch</span>[<span class="php-num">1</span>] . <span class="php-var">$lmatch</span>[<span class="php-num">2</span>]) : <span class="php-quote">''</span>);
</span><span id="934" class="l"><a href="#934">934: </a>                }
</span><span id="935" class="l"><a href="#935">935: </a>            } <span class="php-keyword1">else</span> {
</span><span id="936" class="l"><a href="#936">936: </a>                <span class="php-var">$token</span>[Token::POS_LSPACE] = (<span class="php-keyword1">isset</span>(<span class="php-var">$lmatch</span>[<span class="php-num">2</span>]) ? (<span class="php-var">$lmatch</span>[<span class="php-num">1</span>] . <span class="php-var">$lmatch</span>[<span class="php-num">2</span>]) : <span class="php-quote">''</span>);
</span><span id="937" class="l"><a href="#937">937: </a>            }
</span><span id="938" class="l"><a href="#938">938: </a>            <span class="php-var">$token</span>[Token::POS_RSPACE] = <span class="php-keyword1">isset</span>(<span class="php-var">$rmatch</span>[<span class="php-num">3</span>]) ? <span class="php-var">$rmatch</span>[<span class="php-num">3</span>] : <span class="php-quote">''</span>;
</span><span id="939" class="l"><a href="#939">939: </a>        }
</span><span id="940" class="l"><a href="#940">940: </a>
</span><span id="941" class="l"><a href="#941">941: </a>        <span class="php-comment">// Handle space control.</span>
</span><span id="942" class="l"><a href="#942">942: </a>        <span class="php-keyword1">if</span> (<span class="php-var">$token</span>[Token::POS_LSPACECTL]) {
</span><span id="943" class="l"><a href="#943">943: </a>            <span class="php-var">$token</span>[Token::POS_LSPACE] = <span class="php-quote">''</span>;
</span><span id="944" class="l"><a href="#944">944: </a>        }
</span><span id="945" class="l"><a href="#945">945: </a>        <span class="php-keyword1">if</span> (<span class="php-var">$token</span>[Token::POS_RSPACECTL]) {
</span><span id="946" class="l"><a href="#946">946: </a>            <span class="php-var">$token</span>[Token::POS_RSPACE] = <span class="php-quote">''</span>;
</span><span id="947" class="l"><a href="#947">947: </a>        }
</span><span id="948" class="l"><a href="#948">948: </a>    }
</span><span id="949" class="l"><a href="#949">949: </a>}
</span><span id="950" class="l"><a href="#950">950: </a></span></code></pre>

	<div id="footer">
		 API documentation generated by <a href="http://apigen.org">ApiGen</a>
	</div>
</div>
</div>
<script src="resources/combined.js?472378db19b0b81e1ab5ea63043c5edeacbc47be"></script>
<script src="elementlist.js?ffa3394bccc8d172fecaeb3ac95e484d4bbab070"></script>
</body>
</html>
