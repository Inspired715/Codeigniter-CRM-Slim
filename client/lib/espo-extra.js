/*! espocrm 2023-09-18 */
define("views/email/record/detail",["exports","views/record/detail"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{sideView="views/email/record/detail-side";duplicateAction=!1;shortcutKeyCtrlEnterAction="send";layoutNameConfigure(){if(!this.model.isNew()){var t=this.model.get("status");if("Draft"!==t){let e="Sent"===t?!0:!1;"Archived"===t&&(this.model.get("createdById")!==this.getHelper().getAppParam("systemUserId")&&this.model.get("createdById")&&!this.model.get("isImported")||(e=!0)),e&&(this.layoutName+="Restricted"),this.isRestricted=e}else this.layoutName="composeSmall"}}init(){super.init(),this.layoutNameConfigure()}setup(){super.setup(),["Archived","Sent"].includes(this.model.get("status"))&&(this.shortcutKeyCtrlEnterAction="save"),this.addButtonEdit({name:"send",action:"send",label:"Send",style:"primary",title:"Ctrl+Enter"},!0),this.addButtonEdit({name:"saveDraft",action:"save",label:"Save Draft",title:"Ctrl+S"},!0),this.addButton({name:"sendFromDetail",label:"Send",hidden:!0}),this.controlSendButton(),this.listenTo(this.model,"change:status",()=>this.controlSendButton()),"Draft"!==this.model.get("status")&&this.model.has("isRead")&&!this.model.get("isRead")&&this.model.set("isRead",!0),this.listenTo(this.model,"sync",()=>{this.model.get("isRead")||"Draft"===this.model.get("status")||this.model.set("isRead",!0)}),this.model.get("isHtml")&&this.model.get("bodyPlain")||this.listenToOnce(this.model,"sync",()=>{this.model.get("isHtml")&&this.model.get("bodyPlain")&&this.showActionItem("showBodyPlain")}),this.model.get("isUsers")&&(this.addDropdownItem({label:"Mark as Important",name:"markAsImportant",hidden:this.model.get("isImportant")}),this.addDropdownItem({label:"Unmark Importance",name:"markAsNotImportant",hidden:!this.model.get("isImportant")}),this.addDropdownItem({label:"Move to Trash",name:"moveToTrash",hidden:this.model.get("inTrash")}),this.addDropdownItem({label:"Retrieve from Trash",name:"retrieveFromTrash",hidden:!this.model.get("inTrash")}),this.addDropdownItem({label:"Move to Folder",name:"moveToFolder"})),this.addDropdownItem({label:"Show Plain Text",name:"showBodyPlain",hidden:!(this.model.get("isHtml")&&this.model.get("bodyPlain"))}),this.addDropdownItem({label:"Print",name:"print"}),this.listenTo(this.model,"change:isImportant",()=>{this.model.get("isImportant")?(this.hideActionItem("markAsImportant"),this.showActionItem("markAsNotImportant")):(this.hideActionItem("markAsNotImportant"),this.showActionItem("markAsImportant"))}),this.listenTo(this.model,"change:inTrash",()=>{this.model.get("inTrash")?(this.hideActionItem("moveToTrash"),this.showActionItem("retrieveFromTrash")):(this.hideActionItem("retrieveFromTrash"),this.showActionItem("moveToTrash"))}),this.handleTasksField(),this.listenTo(this.model,"change:tasksIds",()=>this.handleTasksField()),this.getUser().isAdmin()&&this.addDropdownItem({label:"View Users",name:"viewUsers"}),this.setFieldReadOnly("replied"),"Draft"===this.model.get("status")&&(this.setFieldReadOnly("dateSent"),this.controlSelectTemplateField(),this.on("after:mode-change",()=>this.controlSelectTemplateField())),this.isRestricted&&(this.handleAttachmentField(),this.listenTo(this.model,"change:attachmentsIds",()=>this.handleAttachmentField()),this.handleCcField(),this.listenTo(this.model,"change:cc",()=>this.handleCcField()),this.handleBccField(),this.listenTo(this.model,"change:bcc",()=>this.handleBccField()))}controlSelectTemplateField(){this.mode,this.MODE_EDIT,this.hideField("selectTemplate")}controlSendButton(){if("Draft"===this.model.get("status"))return this.showActionItem("send"),this.showActionItem("saveDraft"),this.showActionItem("sendFromDetail"),this.hideActionItem("save"),void this.hideActionItem("saveAndContinueEditing");this.hideActionItem("sendFromDetail"),this.hideActionItem("send"),this.hideActionItem("saveDraft"),this.showActionItem("save"),this.showActionItem("saveAndContinueEditing")}actionSaveDraft(){this.actionSaveAndContinueEditing()}actionMarkAsImportant(){Espo.Ajax.postRequest("Email/inbox/important",{id:this.model.id}),this.model.set("isImportant",!0)}actionMarkAsNotImportant(){Espo.Ajax.deleteRequest("Email/inbox/important",{id:this.model.id}),this.model.set("isImportant",!1)}actionMoveToTrash(){Espo.Ajax.postRequest("Email/inbox/inTrash",{id:this.model.id}).then(()=>{Espo.Ui.warning(this.translate("Moved to Trash","labels","Email"))}),this.model.set("inTrash",!0),this.model.collection&&this.model.collection.trigger("moving-to-trash",this.model.id)}actionRetrieveFromTrash(){Espo.Ajax.deleteRequest("Email/inbox/inTrash",{id:this.model.id}).then(()=>{Espo.Ui.warning(this.translate("Retrieved from Trash","labels","Email"))}),this.model.set("inTrash",!1),this.model.collection&&this.model.collection.trigger("retrieving-from-trash",this.model.id)}actionMoveToFolder(){this.createView("dialog","views/email-folder/modals/select-folder",{},e=>{e.render(),this.listenToOnce(e,"select",e=>{this.clearView("dialog"),Espo.Ajax.postRequest("Email/inbox/folders/"+e,{id:this.model.id}).then(()=>{"inbox"===e&&(e=null),this.model.set("folderId",e),Espo.Ui.success(this.translate("Done"))})})})}actionShowBodyPlain(){this.createView("bodyPlain","views/email/modals/body-plain",{model:this.model},e=>{e.render()})}handleAttachmentField(){0===(this.model.get("attachmentsIds")||[]).length?this.hideField("attachments"):this.showField("attachments")}handleCcField(){this.model.get("cc")?this.showField("cc"):this.hideField("cc")}handleBccField(){this.model.get("bcc")?this.showField("bcc"):this.hideField("bcc")}send(){var e=this.model;let t=e.get("status");e.set("status","Sending"),this.isSending=!0;var i=()=>{e.trigger("after:send"),this.trigger("after:send"),this.isSending=!1};return this.once("after:save",i,this),this.once("cancel:save",()=>{this.off("after:save",i),this.isSending=!1,e.set("status",t)}),this.once("before:save",()=>{Espo.Ui.notify(this.translate("Sending...","labels","Email"))}),this.save()}actionSendFromDetail(){this.setEditMode().then(()=>this.send()).then(()=>{this.setDetailMode()})}exitAfterDelete(){var e=((this.collection||{}).data||{}).folderId||null,t={isReturn:!0,isReturnThroughLink:!1,folder:e="inbox"===e?null:e},i="#"+this.scope,s=null;return e&&(s="list",i+="/list/folder="+e),this.getRouter().dispatch(this.scope,s,t),this.getRouter().navigate(i,{trigger:!1}),!0}actionViewUsers(e){var t=this.getMetadata().get(["clientDefs",this.model.entityType,"relationshipPanels","users","viewModalView"])||this.getMetadata().get(["clientDefs","User","modalViews","relatedList"])||"views/modals/related-list",i={model:this.model,link:"users",scope:"User",filtersDisabled:!0,url:this.model.entityType+"/"+this.model.id+"/users",createDisabled:!0,selectDisabled:!this.getUser().isAdmin(),rowActionsView:"views/record/row-actions/relationship-view-and-unlink"};if(e.viewOptions)for(var s in e.viewOptions)i[s]=e.viewOptions[s];Espo.Ui.notify(" ... "),this.createView("modalRelatedList",t,i,e=>{Espo.Ui.notify(!1),e.render(),this.listenTo(e,"action",(e,t)=>{Espo.Utils.handleAction(this,e,t)}),this.listenToOnce(e,"close",()=>{this.clearView("modalRelatedList")})})}actionSend(){this.send().then(()=>{this.model.set("status","Sent"),this.mode!==this.MODE_DETAIL&&(this.setDetailMode(),this.setFieldReadOnly("dateSent"),this.setFieldReadOnly("name"),this.setFieldReadOnly("attachments"),this.setFieldReadOnly("isHtml"),this.setFieldReadOnly("from"),this.setFieldReadOnly("to"),this.setFieldReadOnly("cc"),this.setFieldReadOnly("bcc"))})}actionPrint(){let s=this.getFieldView("body");if(s){let i=s.$el.find("iframe").get(0);if(i)i.contentWindow.print();else{var a=s.$el.get(0);let e=this.$el.get(0),t=((i=document.createElement("iframe")).style.display="none",e.append(i),i.contentWindow);t.document.open(),t.document.write(a.innerHTML),t.document.close(),t.focus(),t.print(),t.onafterprint=()=>{e.removeChild(i)}}}}errorHandlerSendingFail(e){this.model.id||(this.model.id=e.id);let t=this.translate("sendingFailed","strings","Email");e.message&&(t+=": "+e.message),Espo.Ui.error(t,!0),console.error(t)}handleTasksField(){0!==(this.model.get("tasksIds")||[]).length?this.showField("tasks"):this.hideField("tasks")}handleShortcutKeyCtrlS(e){this.inlineEditModeIsOn||this.buttonsDisabled||(e.preventDefault(),e.stopPropagation(),this.mode===this.MODE_EDIT&&this.saveAndContinueEditingAction&&(this.hasAvailableActionItem("saveDraft")||this.hasAvailableActionItem("saveAndContinueEditing"))&&this.actionSaveAndContinueEditing())}}e.default=s}),define("views/email/fields/email-address",["views/fields/base"],function(e){return e.extend({getAutocompleteMaxCount:function(){return this.autocompleteMaxCount||this.getConfig().get("recordsPerPage")},afterRender:function(){e.prototype.afterRender.call(this),this.$input=this.$el.find("input"),this.mode===this.MODE_SEARCH&&this.getAcl().check("Email","create")&&this.initSearchAutocomplete(),this.mode===this.MODE_SEARCH&&this.$input.on("input",()=>{this.trigger("change")})},initSearchAutocomplete:function(){this.$input=this.$input||this.$el.find("input"),this.$input.autocomplete({serviceUrl:()=>"EmailAddress/search?maxSize="+this.getAutocompleteMaxCount(),paramName:"q",minChars:1,autoSelectFirst:!0,triggerSelectOnValidInput:!1,noCache:!0,formatResult:e=>this.getHelper().escapeString(e.name)+" &#60;"+this.getHelper().escapeString(e.id)+"&#62;",transformResult:e=>{let i=(e=JSON.parse(e)).map(e=>({id:e.emailAddress,name:e.entityName,emailAddress:e.emailAddress,entityId:e.entityId,entityName:e.entityName,entityType:e.entityType,data:e.emailAddress,value:e.emailAddress}));if(this.skipCurrentInAutocomplete){let t=this.$input.val();i=i.filter(e=>e.emailAddress!==t)}return{suggestions:i}},onSelect:e=>{this.$input.val(e.emailAddress),this.$input.focus()}}),this.once("render",()=>{this.$input.autocomplete("dispose")}),this.once("remove",()=>{this.$input.autocomplete("dispose")})},fetchSearch:function(){let e=this.$element.val();return(e="function"==typeof e.trim?e.trim():e)?{type:"equals",value:e}:null}})}),define("views/user/record/detail",["exports","views/record/detail"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{sideView="views/user/record/detail-side";bottomView="views/user/record/detail-bottom";editModeDisabled=!0;setup(){super.setup(),this.setupNonAdminFieldsAccess(),this.getUser().isAdmin()&&!this.model.isPortal()&&this.addButton({name:"access",label:"Access",style:"default",onClick:()=>this.actionAccess()});var e=this.model.isPortal()||this.model.id===this.getUser().id&&this.getUser().isPortal();(this.model.id===this.getUser().id||this.getUser().isAdmin())&&this.getConfig().get("auth2FA")&&(this.model.isRegular()||this.model.isAdmin()||e&&this.getConfig().get("auth2FAInPortal"))&&this.addButton({name:"viewSecurity",label:"Security"}),this.model.id!==this.getUser().id||this.model.isApi()||!this.getUser().isAdmin()&&this.getHelper().getAppParam("passwordChangeForNonAdminDisabled")||this.addDropdownItem({name:"changePassword",label:"Change Password",style:"default"}),this.getUser().isAdmin()&&(this.model.isRegular()||this.model.isAdmin()||this.model.isPortal())&&!this.model.isSuperAdmin()&&(this.addDropdownItem({name:"sendPasswordChangeLink",label:"Send Password Change Link",action:"sendPasswordChangeLink",hidden:!this.model.get("emailAddress")}),this.addDropdownItem({name:"generateNewPassword",label:"Generate New Password",action:"generateNewPassword",hidden:!this.model.get("emailAddress")}),this.model.get("emailAddress")||this.listenTo(this.model,"sync",()=>{this.model.get("emailAddress")?(this.showActionItem("generateNewPassword"),this.showActionItem("sendPasswordChangeLink")):(this.hideActionItem("generateNewPassword"),this.hideActionItem("sendPasswordChangeLink"))})),(this.model.isPortal()||this.model.isApi())&&this.hideActionItem("duplicate"),this.model.id===this.getUser().id&&this.listenTo(this.model,"after:save",()=>{this.getUser().set(this.model.getClonedAttributes())}),this.getUser().isAdmin()&&this.model.isRegular()&&!this.getConfig().get("authAnotherUserDisabled")&&this.addDropdownItem({label:"Log in",name:"login",action:"login"}),this.setupFieldAppearance()}setupActionItems(){super.setupActionItems(),this.model.isApi()&&this.getUser().isAdmin()&&this.addDropdownItem({label:"Generate New API Key",name:"generateNewApiKey"})}setupNonAdminFieldsAccess(){if(!this.getUser().isAdmin()){let e=["userName","isActive","teams","roles","password","portals","portalRoles","contact","accounts","type","emailAddress"];(e=e.filter(e=>{if(!this.model.hasField(e))return!0;e=this.getMetadata().get(["entityAcl","User","fields",e]);return!e||!!e.nonAdminReadOnly})).forEach(e=>{this.setFieldReadOnly(e,!0)}),this.getAcl().checkScope("Team")||this.setFieldReadOnly("defaultTeam",!0)}}setupFieldAppearance(){this.controlFieldAppearance(),this.listenTo(this.model,"change",()=>{this.controlFieldAppearance()})}controlFieldAppearance(){"portal"===this.model.get("type")?(this.hideField("roles"),this.hideField("teams"),this.hideField("defaultTeam"),this.showField("portals"),this.showField("portalRoles"),this.showField("contact"),this.showField("accounts"),this.showPanel("portal"),this.hideField("title")):(this.showField("roles"),this.showField("teams"),this.showField("defaultTeam"),this.hideField("portals"),this.hideField("portalRoles"),this.hideField("contact"),this.hideField("accounts"),this.hidePanel("portal"),"api"===this.model.get("type")?(this.hideField("title"),this.hideField("emailAddress"),this.hideField("phoneNumber"),this.hideField("name"),this.hideField("gender"),"Hmac"===this.model.get("authMethod")?this.showField("secretKey"):this.hideField("secretKey")):this.showField("title")),this.model.id!==this.getUser().id&&("admin"===this.model.get("type")||"regular"===this.model.get("type"))?(this.setFieldNotReadOnly("type"),this.setFieldOptionList("type",["regular","admin"])):this.setFieldReadOnly("type"),this.getConfig().get("auth2FA")&&(this.model.isRegular()||this.model.isAdmin())||this.hideField("auth2FA")}actionChangePassword(){Espo.Ui.notify(" ... "),this.createView("changePassword","views/modals/change-password",{userId:this.model.id},e=>{e.render(),Espo.Ui.notify(!1),this.listenToOnce(e,"changed",()=>{setTimeout(()=>{this.getBaseController().logout()},2e3)})})}actionPreferences(){this.getRouter().navigate("#Preferences/edit/"+this.model.id,{trigger:!0})}actionEmailAccounts(){this.getRouter().navigate("#EmailAccount/list/userId="+this.model.id,{trigger:!0})}actionExternalAccounts(){this.getRouter().navigate("#ExternalAccount",{trigger:!0})}actionAccess(){Espo.Ui.notify(" ... "),Espo.Ajax.getRequest(`User/${this.model.id}/acl`).then(e=>{this.createView("access","views/user/modals/access",{aclData:e,model:this.model},e=>{Espo.Ui.notify(!1),e.render()})})}getGridLayout(i){this.getHelper().layoutManager.get(this.model.entityType,this.options.layoutName||this.layoutName,e=>{let t=Espo.Utils.cloneDeep(e);this.getUser().isPortal()||(t.push({label:"Teams and Access Control",name:"accessControl",rows:[[{name:"type"},{name:"isActive"}],[{name:"teams"},{name:"defaultTeam"}],[{name:"roles"},!1]]}),this.model.isPortal()&&(t.push({label:"Portal",name:"portal",rows:[[{name:"portals"},{name:"contact"}],[{name:"portalRoles"},{name:"accounts"}]]}),this.getUser().isAdmin()&&t.push({label:"Misc",name:"portalMisc",rows:[[{name:"dashboardTemplate"},!1]]})),(this.model.isAdmin()||this.model.isRegular())&&t.push({label:"Misc",name:"misc",rows:[[{name:"workingTimeCalendar"},{name:"layoutSet"}]]})),this.getUser().isAdmin()&&this.model.isApi()&&t.push({name:"auth",rows:[[{name:"authMethod"},!1],[{name:"apiKey"},{name:"secretKey"}]]});e={type:"record",layout:this.convertDetailLayout(t)};i(e)})}actionGenerateNewApiKey(){this.confirm(this.translate("confirmation","messages"),()=>{Espo.Ajax.postRequest("UserSecurity/apiKey/generate",{id:this.model.id}).then(e=>{this.model.set(e)})})}actionViewSecurity(){this.createView("dialog","views/user/modals/security",{userModel:this.model},e=>{e.render()})}actionSendPasswordChangeLink(){this.confirm({message:this.translate("sendPasswordChangeLinkConfirmation","messages","User"),confirmText:this.translate("Send","labels","Email")}).then(()=>{Espo.Ui.notify(this.translate("pleaseWait","messages")),Espo.Ajax.postRequest("UserSecurity/password/recovery",{id:this.model.id}).then(()=>{Espo.Ui.success(this.translate("Done"))})})}actionGenerateNewPassword(){this.confirm(this.translate("generateAndSendNewPassword","messages","User")).then(()=>{Espo.Ui.notify(this.translate("pleaseWait","messages")),Espo.Ajax.postRequest("UserSecurity/password/generate",{id:this.model.id}).then(()=>{Espo.Ui.success(this.translate("Done"))})})}actionLogin(){var e=this.model.get("userName"),t=this.getUser().get("userName");this.createView("dialog","views/user/modals/login-as",{model:this.model,anotherUser:e,username:t}).then(e=>e.render())}}e.default=s}),define("views/user/record/detail-side",["views/record/detail-side"],function(t){return t.extend({setupPanels:function(){if(t.prototype.setupPanels.call(this),this.model.isApi()||this.model.isSystem())return this.hidePanel("activities",!0),this.hidePanel("history",!0),this.hidePanel("tasks",!0),void this.hidePanel("stream",!0);var e=this.getAcl().checkUserPermission(this.model);e||"team"===this.getAcl().get("userPermission")&&(this.model.has("teamsIds")||this.listenToOnce(this.model,"sync",function(){this.getAcl().checkUserPermission(this.model)&&this.onPanelsReady(function(){this.showPanel("activities","acl"),this.showPanel("history","acl"),this.model.isPortal()||this.showPanel("tasks","acl")})},this)),e||(this.hidePanel("activities",!1,"acl"),this.hidePanel("history",!1,"acl"),this.hidePanel("tasks",!1,"acl")),this.model.isPortal()&&this.hidePanel("tasks",!0)}})}),define("views/settings/fields/theme",["views/fields/enum","theme-manager","ui/select"],function(i,t,s){return i.extend({editTemplateContent:`
            <div class="grid-auto-fit-xxs">
                <div>
                    <select data-name="{{name}}" class="form-control main-element">
                        {{options
                            params.options value
                            scope=scope
                            field=name
                            translatedOptions=translatedOptions
                            includeMissingOption=true
                            styleMap=params.style
                        }}
                    </select>
                </div>
                {{#if navbarOptionList.length}}
                <div>
                    <select data-name="themeNavbar" class="form-control">
                        {{options navbarOptionList navbar translatedOptions=navbarTranslatedOptions}}
                    </select>
                </div>
                {{/if}}
            </div>
        `,data:function(){let t=i.prototype.data.call(this);return t.navbarOptionList=this.getNavbarOptionList(),t.navbar=this.getNavbarValue()||this.getDefaultNavbar(),t.navbarTranslatedOptions={},t.navbarOptionList.forEach(e=>{t.navbarTranslatedOptions[e]=this.translate(e,"themeNavbars")}),t},setup:function(){i.prototype.setup.call(this),this.initThemeManager(),this.model.on("change:theme",(e,t,i)=>{this.initThemeManager(),i.ui&&this.reRender().then(()=>s.focus(this.$element,{noTrigger:!0}))})},afterRenderEdit:function(){this.$navbar=this.$el.find('[data-name="themeNavbar"]'),this.$navbar.on("change",()=>this.trigger("change")),s.init(this.$navbar)},getNavbarValue:function(){return(this.model.get("themeParams")||{}).navbar},getNavbarDefs:function(){if(!this.themeManager)return null;var e=this.themeManager.getParam("params");return e&&e.navbar?Espo.Utils.cloneDeep(e.navbar):null},getNavbarOptionList:function(){var e=this.getNavbarDefs();if(!e)return[];e=e.options||[];return e.length&&1!==e.length?e:[]},getDefaultNavbar:function(){return(this.getNavbarDefs()||{}).default||null},initThemeManager:function(){var e=this.model.get("theme");this.themeManager=e?new t(this.getConfig(),this.getPreferences(),this.getMetadata(),e):null},getAttributeList:function(){return[this.name,"themeParams"]},setupOptions:function(){this.params.options=Object.keys(this.getMetadata().get("themes")||{}).sort((e,t)=>"EspoRtl"===t?-1:this.translate(e,"theme").localeCompare(this.translate(t,"theme")))},fetch:function(){let e=i.prototype.fetch.call(this),t={};return this.$navbar.length&&(t.navbar=this.$navbar.val()),e.themeParams=t,e}})}),define("views/settings/fields/tab-list",["exports","views/fields/array"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{addItemModalView="views/settings/modals/tab-list-field-add";noGroups=!1;noDelimiters=!1;setup(){super.setup(),this.selected.forEach(e=>{e&&"object"==typeof e&&(e.id||(e.id=this.generateItemId()))}),this.events['click [data-action="editGroup"]']=e=>{e=$(e.currentTarget).parent().data("value").toString();this.editGroup(e)}}generateItemId(){return Math.floor(1e6*Math.random()+1).toString()}setupOptions(){this.params.options=Object.keys(this.getMetadata().get("scopes")).filter(e=>!this.getMetadata().get("scopes."+e+".disabled")&&(!!this.getAcl().checkScope(e)&&this.getMetadata().get("scopes."+e+".tab"))).sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural"))),this.noDelimiters||(this.params.options.push("_delimiter_"),this.params.options.push("_delimiter-ext_")),this.translatedOptions={},this.params.options.forEach(e=>{this.translatedOptions[e]=this.translate(e,"scopeNamesPlural")}),this.translatedOptions._delimiter_=". . .",this.translatedOptions["_delimiter-ext_"]=". . ."}addValue(e){var t;if(e&&"object"==typeof e)return e.id||(e.id=this.generateItemId()),t=this.getItemHtml(e),this.$list.append(t),this.selected.push(e),void this.trigger("change");super.addValue(e)}removeValue(e){var t=this.getGroupIndexById(e);if(~t)return this.$list.children('[data-value="'+e+'"]').remove(),this.selected.splice(t,1),void this.trigger("change");super.removeValue(e)}getItemHtml(e){return e&&"object"==typeof e?this.getGroupItemHtml(e):super.getItemHtml(e)}getGroupItemHtml(e){var t=e.text||"";let i=$("<span>").text(t),s=null,a=("group"===e.type&&(s=$("<span>").addClass("far fa-list-alt").addClass("text-muted")),"divider"===e.type&&i.addClass("text-soft").addClass("text-italic"),$("<span>").append(i));return s&&a.prepend(s," "),$("<div>").addClass("list-group-item").attr("data-value",e.id).css("cursor","default").append($("<a>").attr("role","button").attr("tabindex","0").attr("data-value",e.id).attr("data-action","editGroup").css("margin-right","7px").append($("<span>").addClass("fas fa-pencil-alt fa-sm")),a,"&nbsp;",$("<a>").addClass("pull-right").attr("role","button").attr("tabindex","0").attr("data-value",e.id).attr("data-action","removeValue").append($("<span>").addClass("fas fa-times"))).get(0).outerHTML}fetchFromDom(){let s=[];this.$el.find(".list-group .list-group-item").each((e,t)=>{var t=$(t).data("value").toString(),i=this.getGroupValueById(t);i?s.push(i):s.push(t)}),this.selected=s}getGroupIndexById(t){for(let e=0;e<this.selected.length;e++){var i=this.selected[e];if(i&&"object"==typeof i&&i.id===t)return e}return-1}getGroupValueById(e){for(var t of this.selected)if(t&&"object"==typeof t&&t.id===e)return t;return null}editGroup(e){var t=Espo.Utils.cloneDeep(this.getGroupValueById(e)||{});let s=this.getGroupIndexById(e),a=Espo.Utils.cloneDeep(this.selected);e="divider"===t.type?"views/settings/modals/edit-tab-divider":"views/settings/modals/edit-tab-group";this.createView("dialog",e,{itemData:t},i=>{i.render(),this.listenToOnce(i,"apply",e=>{for(var t in e)a[s][t]=e[t];this.model.set(this.name,a),i.close()})})}getAddItemModalOptions(){return{...super.getAddItemModalOptions(),noGroups:this.noGroups}}getValueForDisplay(){const t=this.translatedOptions||{},e=this.selected.map(e=>"string"!=typeof e?" - "+(e.text||"?"):t[e]||e);return e.map(e=>$("<div>").addClass("multi-enum-item-container").text(e).get(0).outerHTML).join("")}}e.default=s}),define("views/settings/fields/quick-create-list",["views/fields/array"],function(e){return e.extend({setup:function(){this.params.options=Object.keys(this.getMetadata().get("scopes")).filter(e=>{if(!this.getMetadata().get("scopes."+e+".disabled"))return this.getMetadata().get("scopes."+e+".entity")&&this.getMetadata().get("scopes."+e+".object")}).sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural"))),e.prototype.setup.call(this)}})}),define("views/import/record/panels/imported",["exports","views/record/panels/relationship"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{link="imported";readOnly=!0;rowActionsView="views/record/row-actions/relationship-no-unlink";setup(){this.scope=this.model.get("entityType"),this.title=this.title||this.translate("Imported","labels","Import"),super.setup()}}e.default=s}),define("views/email-template/record/detail",["views/record/detail"],function(e){return e.extend({duplicateAction:!0,saveAndContinueEditingAction:!0,setup:function(){e.prototype.setup.call(this),this.listenToInsertField(),this.hideField("insertField"),this.on("before:set-edit-mode",function(){this.showField("insertField")},this),this.on("before:set-detail-mode",function(){this.hideField("insertField")},this)},listenToInsertField:function(){this.listenTo(this.model,"insert-field",function(e){var t,e="{"+e.entityType+"."+e.field+"}",i=this.getFieldView("body");i&&(this.model.get("isHtml")?$(window.getSelection().anchorNode).closest(".note-editing-area").length&&i.$summernote.summernote("insertText",e):(t=(i=i.$element).val(),i.val(t+=e)))},this)}})}),define("views/email-account/record/detail",["views/record/detail"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.setupFieldsBehaviour(),this.initSslFieldListening(),this.initSmtpFieldsControl(),this.getUser().isAdmin()?this.setFieldNotReadOnly("assignedUser"):this.setFieldReadOnly("assignedUser")},modifyDetailLayout:function(e){e.filter(e=>"$label:SMTP"===e.tabLabel).forEach(e=>{e.rows.forEach(e=>{e.forEach(e=>{let t=this.translate(e.name,"fields","EmailAccount");t&&0===t.indexOf("SMTP ")&&(e.labelText=Espo.Utils.upperCaseFirst(t.substring(5)))})})})},setupFieldsBehaviour:function(){this.controlStatusField(),this.listenTo(this.model,"change:status",(e,t,i)=>{i.ui&&this.controlStatusField()}),this.listenTo(this.model,"change:useImap",(e,t,i)=>{i.ui&&this.controlStatusField()}),this.wasFetched()?this.setFieldReadOnly("fetchSince"):this.setFieldNotReadOnly("fetchSince")},controlStatusField:function(){let e=["username","port","host","monitoredFolders"];"Active"===this.model.get("status")&&this.model.get("useImap")?e.forEach(e=>{this.setFieldRequired(e)}):e.forEach(e=>{this.setFieldNotRequired(e)})},wasFetched:function(){return!this.model.isNew()&&!!(this.model.get("fetchData")||{}).lastUID},initSslFieldListening:function(){this.listenTo(this.model,"change:security",(e,t,i)=>{i.ui&&(t?this.model.set("port",993):this.model.set("port",143))}),this.listenTo(this.model,"change:smtpSecurity",(e,t,i)=>{i.ui&&("SSL"===t?this.model.set("smtpPort",465):"TLS"===t?this.model.set("smtpPort",587):this.model.set("smtpPort",25))})},initSmtpFieldsControl:function(){this.controlSmtpFields(),this.listenTo(this.model,"change:useSmtp",this.controlSmtpFields,this),this.listenTo(this.model,"change:smtpAuth",this.controlSmtpFields,this)},controlSmtpFields:function(){if(this.model.get("useSmtp"))return this.showField("smtpHost"),this.showField("smtpPort"),this.showField("smtpAuth"),this.showField("smtpSecurity"),this.showField("smtpTestSend"),this.setFieldRequired("smtpHost"),this.setFieldRequired("smtpPort"),void this.controlSmtpAuthField();this.hideField("smtpHost"),this.hideField("smtpPort"),this.hideField("smtpAuth"),this.hideField("smtpUsername"),this.hideField("smtpPassword"),this.hideField("smtpAuthMechanism"),this.hideField("smtpSecurity"),this.hideField("smtpTestSend"),this.setFieldNotRequired("smtpHost"),this.setFieldNotRequired("smtpPort"),this.setFieldNotRequired("smtpUsername")},controlSmtpAuthField:function(){if(this.model.get("smtpAuth"))return this.showField("smtpUsername"),this.showField("smtpPassword"),this.showField("smtpAuthMechanism"),void this.setFieldRequired("smtpUsername");this.hideField("smtpUsername"),this.hideField("smtpPassword"),this.hideField("smtpAuthMechanism"),this.setFieldNotRequired("smtpUsername")}})}),define("views/email/detail",["exports","views/detail","email-helper"],function(e,t,o){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),o=i(o);class s extends t.default{setup(){super.setup();var e=this.model.get("status");"Draft"===e?this.menu={buttons:[],dropdown:[],actions:[]}:(this.addMenuItem("buttons",{name:"reply",label:"Reply",action:this.getPreferences().get("emailReplyToAllByDefault")?"replyToAll":"reply",style:"danger",className:"btn-s-wide"},!0),this.addMenuItem("dropdown",!1),"Archived"===e&&(this.model.get("parentId")||(this.addMenuItem("dropdown",{label:"Create Lead",action:"createLead",acl:"create",aclScope:"Lead"}),this.addMenuItem("dropdown",{label:"Create Contact",action:"createContact",acl:"create",aclScope:"Contact"}))),this.addMenuItem("dropdown",{label:"Create Task",action:"createTask",acl:"create",aclScope:"Task"}),"Case"===this.model.get("parentType")&&this.model.get("parentId")||this.addMenuItem("dropdown",{label:"Create Case",action:"createCase",acl:"create",aclScope:"Case"}),this.getAcl().checkScope("Document","create")&&(void 0!==this.model.get("attachmentsIds")&&!this.model.getLinkMultipleIdList("attachments").length||(this.addMenuItem("dropdown",{text:this.translate("Create Document","labels","Document"),action:"createDocument",acl:"create",aclScope:"Document",hidden:void 0===this.model.get("attachmentsIds")}),void 0===this.model.get("attachmentsIds")&&this.listenToOnce(this.model,"sync",()=>{this.model.getLinkMultipleIdList("attachments").length&&this.showHeaderActionItem("createDocument")})))),this.listenTo(this.model,"change",()=>{if(this.isRendered()&&(this.model.hasChanged("isImportant")||this.model.hasChanged("inTrash"))){let e=this.getHeaderView();e&&e.reRender()}}),this.shortcutKeys["Control+Delete"]=t=>{if(!$(t.target).hasClass("note-editable")){let e=this.getRecordView();this.model.get("isUsers")&&!this.model.get("inTrash")&&(t.preventDefault(),t.stopPropagation(),e.actionMoveToTrash())}},this.shortcutKeys["Control+KeyI"]=t=>{if(!$(t.target).hasClass("note-editable")){let e=this.getRecordView();this.model.get("isUsers")&&(t.preventDefault(),t.stopPropagation(),this.model.get("isImportant")?e.actionMarkAsNotImportant():e.actionMarkAsImportant())}},this.shortcutKeys["Control+KeyM"]=t=>{if(!$(t.target).hasClass("note-editable")){let e=this.getRecordView();this.model.get("isUsers")&&(t.preventDefault(),t.stopPropagation(),e.actionMoveToFolder())}}}actionCreateLead(){let i={},s=new o.default(this.getLanguage(),this.getUser(),this.getDateTime(),this.getAcl());var a=this.model.get("fromString")||this.model.get("fromName");if(a){let e=s.parseNameFromStringAddress(a);e&&(a=e.split(" ").slice(0,-1).join(" "),n=e.split(" ").slice(-1).join(" "),i.firstName=a,i.lastName=n)}if(this.model.get("replyToString")){let e=this.model.get("replyToString");var a=e.split(";")[0];i.emailAddress=s.parseAddressFromStringAddress(a);let t=s.parseNameFromStringAddress(a);t&&(n=t.split(" ").slice(0,-1).join(" "),a=t.split(" ").slice(-1).join(" "),i.firstName=n,i.lastName=a)}i.emailAddress||(i.emailAddress=this.model.get("from")),i.emailId=this.model.id;var n=this.getMetadata().get("clientDefs.Lead.modalViews.edit")||"views/modals/edit";Espo.Ui.notify(" ... "),this.createView("quickCreate",n,{scope:"Lead",attributes:i},e=>{e.render(),e.notify(!1),this.listenTo(e,"before:save",()=>{this.getRecordView().blockUpdateWebSocket(!0)}),this.listenToOnce(e,"after:save",()=>{this.model.fetch(),this.removeMenuItem("createContact"),this.removeMenuItem("createLead"),e.close()})})}actionCreateCase(){let i={};var e=this.model.get("parentId"),t=this.model.get("parentType"),s=this.model.get("parentName"),a=this.model.get("accountId"),n=this.model.get("accountName");e&&("Account"===t?(i.accountId=e,i.accountName=s):"Contact"===t?(i.contactId=e,i.contactName=s,i.contactsIds=[e],i.contactsNames={},i.contactsNames[e]=s,a&&(i.accountId=a,i.accountName=n||a)):"Lead"===t&&(i.leadId=e,i.leadName=s)),i.emailsIds=[this.model.id],i.emailId=this.model.id,i.name=this.model.get("name"),i.description=this.model.get("bodyPlain")||"";let o=this.getMetadata().get("clientDefs.Case.modalViews.edit")||"views/modals/edit";Espo.Ui.notify(" ... "),new Promise(t=>{(this.model.get("attachmentsIds")||[]).length?Espo.Ajax.postRequest(`Email/${this.model.id}/attachments/copy`,{parentType:"Case",field:"attachments"}).then(e=>{i.attachmentsIds=e.ids,i.attachmentsNames=e.names,t()}):t()}).then(()=>{this.createView("quickCreate",o,{scope:"Case",attributes:i},e=>{e.render(),Espo.Ui.notify(!1),this.listenToOnce(e,"after:save",()=>{this.model.fetch(),this.removeMenuItem("createCase"),e.close()}),this.listenTo(e,"before:save",()=>{this.getRecordView().blockUpdateWebSocket(!0)})})})}actionCreateTask(){let e={};e.parentId=this.model.get("parentId"),e.parentName=this.model.get("parentName"),e.parentType=this.model.get("parentType"),e.emailId=this.model.id;var t=this.model.get("name"),t=(e.description="["+this.translate("Email","scopeNames")+": "+t+"](#Email/view/"+this.model.id+")\n",this.getMetadata().get("clientDefs.Task.modalViews.edit")||"views/modals/edit");Espo.Ui.notify(" ... "),this.createView("quickCreate",t,{scope:"Task",attributes:e},e=>{let t=e.getRecordView();var i=t.getFieldView("name");let s=[];(s=i&&i.params.options?s.concat(i.params.options):s).push(this.translate("replyToEmail","nameOptions","Task")),t.setFieldOptionList("name",s),e.render(),e.notify(!1),this.listenToOnce(e,"after:save",()=>{e.close(),this.model.fetch()})})}actionCreateContact(){let i={},s=new o.default(this.getLanguage(),this.getUser(),this.getDateTime(),this.getAcl());var a=this.model.get("fromString")||this.model.get("fromName");if(a){let e=s.parseNameFromStringAddress(a);e&&(a=e.split(" ").slice(0,-1).join(" "),n=e.split(" ").slice(-1).join(" "),i.firstName=a,i.lastName=n)}if(this.model.get("replyToString")){let e=this.model.get("replyToString");var a=e.split(";")[0];i.emailAddress=s.parseAddressFromStringAddress(a);let t=s.parseNameFromStringAddress(a);t&&(n=t.split(" ").slice(0,-1).join(" "),a=t.split(" ").slice(-1).join(" "),i.firstName=n,i.lastName=a)}i.emailAddress||(i.emailAddress=this.model.get("from")),i.emailId=this.model.id;var n=this.getMetadata().get("clientDefs.Contact.modalViews.edit")||"views/modals/edit";Espo.Ui.notify(" ... "),this.createView("quickCreate",n,{scope:"Contact",attributes:i},e=>{e.render(),e.notify(!1),this.listenToOnce(e,"after:save",()=>{this.model.fetch(),this.removeMenuItem("createContact"),this.removeMenuItem("createLead"),e.close()}),this.listenTo(e,"before:save",()=>{this.getRecordView().blockUpdateWebSocket(!0)})})}actionReply(e,t,i){let s=new o.default(this.getLanguage(),this.getUser(),this.getDateTime(),this.getAcl());e=s.getReplyAttributes(this.model,e,i),Espo.Ui.notify(" ... "),i=this.getMetadata().get("clientDefs.Email.modalViews.compose")||"views/modals/compose-email";this.createView("quickCreate",i,{attributes:e,focusForCreate:!0},e=>{e.render(),e.notify(!1),this.listenTo(e,"after:save",()=>{this.model.fetch()})})}actionReplyToAll(e,t){this.actionReply(e,t,!0)}actionForward(){let s=new o.default(this.getLanguage(),this.getUser(),this.getDateTime(),this.getAcl());Espo.Ui.notify(" ... "),Espo.Ajax.postRequest("Email/action/getDuplicateAttributes",{id:this.model.id}).then(e=>{let t=this.model.clone(),i=(t.set("body",e.body),s.getForwardAttributes(t));i.attachmentsIds=e.attachmentsIds,i.attachmentsNames=e.attachmentsNames,Espo.Ui.notify(" ... ");e=this.getMetadata().get("clientDefs.Email.modalViews.compose")||"views/modals/compose-email";this.createView("quickCreate",e,{attributes:i},e=>{e.render(),e.notify(!1)})})}getHeader(){var e=this.model.get("name"),t=this.model.get("isImportant"),i=this.model.get("inTrash"),s=this.options.rootUrl||this.options.params.rootUrl||"#"+this.scope,a=this.getHeaderIconHtml();let n=$("<a>").attr("href",s).attr("data-action","navigateToRoot").addClass("action").text(this.getLanguage().translate(this.model.name,"scopeNamesPlural"));return a&&(n=$("<span>").append(a,n).get(0).innerHTML),this.buildHeaderHtml([n,$("<span>").addClass("font-size-flexible title").addClass(t?"text-warning":"").addClass(i?"text-muted":"").text(e)])}actionNavigateToRoot(e,t){t.stopPropagation(),this.getRouter().checkConfirmLeaveOut(()=>{var e=this.options.rootUrl||this.options.params.rootUrl||"#"+this.scope;this.getRouter().navigate(e,{trigger:!1}),this.getRouter().dispatch(this.scope,null,{isReturn:!0,isReturnThroughLink:!0})})}actionCreateDocument(){let e=this.model.getLinkMultipleIdList("attachments");if(e.length){let i=this.model.get("attachmentsNames")||{},s=this.model.get("attachmentsTypes")||{},a=e=>{let t={};this.model.get("accountId")&&(t.accountsIds=[this.model.get("accountId")],t.accountsNames={},t.accountsNames[this.model.get("accountId")]=this.model.get("accountName")),Espo.Ui.notify(" ... "),Espo.Ajax.postRequest("Attachment/copy/"+e,{relatedType:"Document",field:"file"}).then(e=>{t.fileId=e.id,t.fileName=e.name,t.name=e.name;e=this.getMetadata().get("clientDefs.Document.modalViews.edit")||"views/modals/edit";this.createView("quickCreate",e,{scope:"Document",attributes:t},e=>{e.render(),Espo.Ui.notify(!1),this.listenToOnce(e,"after:save",()=>{e.close()})})})};if(1!==e.length){let t=[];e.forEach(e=>{t.push({id:e,name:i[e]||e,type:s[e]})}),this.createView("dialog","views/attachment/modals/select-one",{dataList:t,fieldLabel:this.translate("attachments","fields","Email")},e=>{e.render(),this.listenToOnce(e,"select",a.bind(this))})}else a(e[0])}}}e.default=s}),define("views/email/record/list",["exports","views/record/list","helpers/mass-action"],function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),a=i(a);class s extends t.default{rowActionsView="views/email/record/row-actions/default";massActionList=["remove","massUpdate"];setup(){super.setup(),this.collection.url===this.entityType&&(this.addMassAction("retrieveFromTrash",!1,!0),this.addMassAction("moveToFolder",!0,!0),this.addMassAction("markAsNotImportant",!1,!0),this.addMassAction("markAsImportant",!1,!0),this.addMassAction("markAsNotRead",!1,!0),this.addMassAction("markAsRead",!1,!0),this.addMassAction("moveToTrash",!1,!0),this.dropdownItemList.push({name:"markAllAsRead",label:"Mark all as read"})),this.listenTo(this.collection,"moving-to-trash",e=>{let t=this.collection.get(e);t&&t.set("inTrash",!0),"trash"!==this.collection.selectedFolderId&&"all"!==this.collection.selectedFolderId&&this.removeRecordFromList(e)}),this.listenTo(this.collection,"retrieving-from-trash",e=>{let t=this.collection.get(e);t&&t.set("inTrash",!1),"trash"===this.collection.selectedFolderId&&this.removeRecordFromList(e)})}massActionMarkAsRead(){let e=[];for(var t in this.checkedList)e.push(this.checkedList[t]);Espo.Ajax.postRequest("Email/inbox/read",{ids:e}),e.forEach(e=>{let t=this.collection.get(e);t&&t.set("isRead",!0)})}massActionMarkAsNotRead(){let e=[];for(var t in this.checkedList)e.push(this.checkedList[t]);Espo.Ajax.deleteRequest("Email/inbox/read",{ids:e}),e.forEach(e=>{let t=this.collection.get(e);t&&t.set("isRead",!1)})}massActionMarkAsImportant(){let e=[];for(var t in this.checkedList)e.push(this.checkedList[t]);Espo.Ajax.postRequest("Email/inbox/important",{ids:e}),e.forEach(e=>{let t=this.collection.get(e);t&&t.set("isImportant",!0)})}massActionMarkAsNotImportant(){let e=[];for(var t in this.checkedList)e.push(this.checkedList[t]);Espo.Ajax.deleteRequest("Email/inbox/important",{ids:e}),e.forEach(e=>{let t=this.collection.get(e);t&&t.set("isImportant",!1)})}massActionMoveToTrash(){let e=[];for(var t in this.checkedList)e.push(this.checkedList[t]);Espo.Ajax.postRequest("Email/inbox/inTrash",{ids:e}).then(()=>{Espo.Ui.warning(this.translate("Moved to Trash","labels","Email"))}),"trash"!==this.collection.selectedFolderId&&e.forEach(e=>{this.collection.trigger("moving-to-trash",e,this.collection.get(e)),this.uncheckRecord(e,null,!0)})}massActionRetrieveFromTrash(){let e=[];for(var t in this.checkedList)e.push(this.checkedList[t]);Espo.Ajax.deleteRequest("Email/inbox/inTrash",{ids:e}).then(()=>{Espo.Ui.success(this.translate("Done"))}),"trash"===this.collection.selectedFolderId&&e.forEach(e=>{this.collection.trigger("retrieving-from-trash",e,this.collection.get(e)),this.uncheckRecord(e,null,!0)})}massMoveToFolder(e){var t=this.getMassActionSelectionPostData();let i=new a.default(this);var s=!!t.searchParams&&i.checkIsIdle();Espo.Ui.notify(this.translate("pleaseWait","messages")),Espo.Ajax.postRequest("MassAction",{entityType:this.entityType,action:"moveToFolder",params:t,idle:s,data:{folderId:e}}).then(e=>{Espo.Ui.notify(!1),e.id?i.process(e.id,"moveToFolder").then(e=>{this.listenToOnce(e,"close:success",()=>{this.collection.fetch().then(()=>{Espo.Ui.success(this.translate("Done"))})})}):this.collection.fetch().then(()=>{Espo.Ui.success(this.translate("Done"))})})}massActionMoveToFolder(){this.createView("dialog","views/email-folder/modals/select-folder",{headerText:this.translate("Move to Folder","labels","Email")},e=>{e.render(),this.listenToOnce(e,"select",e=>{this.clearView("dialog"),this.massMoveToFolder(e)})})}actionMarkAsImportant(e){e=(e=e||{}).id;Espo.Ajax.postRequest("Email/inbox/important",{id:e});let t=this.collection.get(e);t&&t.set("isImportant",!0)}actionMarkAsNotImportant(e){e=(e=e||{}).id;Espo.Ajax.deleteRequest("Email/inbox/important",{id:e});let t=this.collection.get(e);t&&t.set("isImportant",!1)}actionMarkAllAsRead(){Espo.Ajax.postRequest("Email/inbox/read",{all:!0}),this.collection.forEach(e=>{e.set("isRead",!0)}),this.collection.trigger("all-marked-read")}actionMoveToTrash(e){let t=e.id;Espo.Ui.notify(" ... "),Espo.Ajax.postRequest("Email/inbox/inTrash",{id:t}).then(()=>{Espo.Ui.warning(this.translate("Moved to Trash","labels","Email")),this.collection.trigger("moving-to-trash",t,this.collection.get(t))})}actionRetrieveFromTrash(e){let t=e.id;Espo.Ui.notify(" ... "),this.retrieveFromTrash(t).then(()=>{Espo.Ui.warning(this.translate("Retrieved from Trash","labels","Email")),this.collection.trigger("retrieving-from-trash",t,this.collection.get(t))})}retrieveFromTrash(e){return Espo.Ajax.deleteRequest("Email/inbox/inTrash",{id:e})}massRetrieveFromTrashMoveToFolder(e){let t=[];for(var i in this.checkedList)t.push(this.checkedList[i]);Espo.Ajax.deleteRequest("Email/inbox/inTrash",{ids:t}).then(()=>(t.forEach(e=>{this.collection.trigger("retrieving-from-trash",e,this.collection.get(e))}),Espo.Ajax.postRequest("Email/inbox/folders/"+e,{ids:t}).then(()=>{Espo.Ui.success(this.translate("Done"))})))}actionRetrieveFromTrashMoveToFolder(e){let t=e.id,i=e.folderId;Espo.Ui.notify(" ... "),this.retrieveFromTrash(t).then(()=>this.moveToFolder(t,i)).then(()=>{this.collection.fetch().then(()=>{Espo.Ui.success(this.translate("Done"))})})}moveToFolder(e,t){return Espo.Ajax.postRequest("Email/inbox/folders/"+t,{id:e})}actionMoveToFolder(e){let t=e.id;e=e.folderId;if(e)return Espo.Ui.notify(" ... "),void this.moveToFolder(t,e).then(()=>{this.collection.fetch().then(()=>{Espo.Ui.success(this.translate("Done"))})});this.createView("dialog","views/email-folder/modals/select-folder",{headerText:this.translate("Move to Folder","labels","Email")},e=>{e.render(),this.listenToOnce(e,"select",e=>{this.clearView("dialog"),Espo.Ui.notify(" ... "),this.moveToFolder(t,e).then(()=>{this.collection.fetch().then(()=>{Espo.Ui.success(this.translate("Done"))})})})})}actionSend(e){let t=e.id;this.confirm({message:this.translate("sendConfirm","messages","Email"),confirmText:this.translate("Send","labels","Email")}).then(()=>{let e=this.collection.get(t);e&&(Espo.Ui.notify(this.translate("Sending...","labels","Email")),e.save({status:"Sending"}).then(()=>{Espo.Ui.success(this.translate("emailSent","messages","Email")),"drafts"===this.collection.selectedFolderId&&(this.removeRecordFromList(t),this.uncheckRecord(t,null,!0),this.collection.trigger("draft-sent"))}))})}toggleMassMarkAsImportant(){this.checkedList.map(e=>this.collection.get(e)).find(e=>!e.get("isImportant"))?this.massActionMarkAsImportant():this.massActionMarkAsNotImportant()}}e.default=s}),define("views/email/record/edit",["exports","views/record/edit","views/email/record/detail"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{shortcutKeyCtrlEnterAction="send";init(){super.init(),i.default.prototype.layoutNameConfigure.call(this)}setup(){super.setup(),["Archived","Sent"].includes(this.model.get("status"))&&(this.shortcutKeyCtrlEnterAction="save"),this.addButton({name:"send",label:"Send",style:"primary",title:"Ctrl+Enter"},!0),this.addButton({name:"saveDraft",label:"Save Draft",title:"Ctrl+S"},!0),this.controlSendButton(),"Draft"===this.model.get("status")&&(this.setFieldReadOnly("dateSent"),this.hideField("selectTemplate")),this.handleAttachmentField(),this.handleCcField(),this.handleBccField(),this.listenTo(this.model,"change:attachmentsIds",()=>this.handleAttachmentField()),this.listenTo(this.model,"change:cc",()=>this.handleCcField()),this.listenTo(this.model,"change:bcc",()=>this.handleBccField())}handleAttachmentField(){0!==(this.model.get("attachmentsIds")||[]).length||this.isNew||"Draft"===this.model.get("status")?this.showField("attachments"):this.hideField("attachments")}handleCcField(){this.model.get("cc")||"Draft"===this.model.get("status")?this.showField("cc"):this.hideField("cc")}handleBccField(){this.model.get("bcc")||"Draft"===this.model.get("status")?this.showField("bcc"):this.hideField("bcc")}controlSendButton(){if("Draft"===this.model.get("status"))return this.showActionItem("send"),this.showActionItem("saveDraft"),this.hideActionItem("save"),void this.hideActionItem("saveAndContinueEditing");this.hideActionItem("send"),this.hideActionItem("saveDraft"),this.showActionItem("save"),this.showActionItem("saveAndContinueEditing")}actionSaveDraft(){this.actionSaveAndContinueEditing()}actionSend(){i.default.prototype.send.call(this).then(()=>this.exit()).catch(()=>{})}handleShortcutKeyCtrlS(e){this.inlineEditModeIsOn||this.buttonsDisabled||(e.preventDefault(),e.stopPropagation(),this.mode===this.MODE_EDIT&&this.saveAndContinueEditingAction&&(this.hasAvailableActionItem("saveDraft")||this.hasAvailableActionItem("saveAndContinueEditing"))&&this.actionSaveAndContinueEditing())}}e.default=a}),define("views/email/fields/person-string-data",["views/fields/varchar"],function(t){return t.extend({listTemplate:"email/fields/person-string-data/list",getAttributeList:function(){return["personStringData","isReplied"]},data:function(){var e=t.prototype.data.call(this);return e.isReplied=this.model.get("isReplied"),e}})}),define("views/email/fields/from-address-varchar",["views/fields/base","views/email/fields/email-address","helpers/record-modal"],function(i,e,s){return i.extend({detailTemplate:"email/fields/email-address-varchar/detail",validations:["required","email"],skipCurrentInAutocomplete:!0,setup:function(){i.prototype.setup.call(this),this.erasedPlaceholder="ERASED:",this.on("render",()=>{this.mode!==this.MODE_SEARCH&&this.initAddressList()})},events:{'click [data-action="createContact"]':function(e){e=$(e.currentTarget).data("address");this.createPerson("Contact",e)},'click [data-action="createLead"]':function(e){e=$(e.currentTarget).data("address");this.createPerson("Lead",e)},'click [data-action="addToContact"]':function(e){e=$(e.currentTarget).data("address");this.addToPerson("Contact",e)},'click [data-action="addToLead"]':function(e){e=$(e.currentTarget).data("address");this.addToPerson("Lead",e)},"auxclick a[href][data-scope][data-id]":function(t){if(1===t.button&&(t.ctrlKey||t.metaKey)){let e=$(t.currentTarget);var i=e.attr("data-id"),s=e.attr("data-scope");t.preventDefault(),t.stopPropagation(),this.quickView({id:i,scope:s})}}},data:function(){var e=i.prototype.data.call(this),t=this.model.get(this.name);return!t||t in this.idHash||!this.model.get("parentId")||this.getAcl().check("Contact","edit")&&(e.showCreate=!0),e.valueIsSet=this.model.has(this.name),e},afterRender:function(){i.prototype.afterRender.call(this),this.mode===this.MODE_SEARCH&&this.getAcl().check("Email","create")&&e.prototype.initSearchAutocomplete.call(this),this.mode===this.MODE_EDIT&&this.getAcl().check("Email","create")&&e.prototype.initSearchAutocomplete.call(this),this.mode===this.MODE_SEARCH&&this.$input.on("input",()=>{this.trigger("change")})},getAutocompleteMaxCount:function(){return e.prototype.getAutocompleteMaxCount.call(this)},initAddressList:function(){this.nameHash={},this.typeHash=this.model.get("typeHash")||{},this.idHash=this.model.get("idHash")||{},_.extend(this.nameHash,this.model.get("nameHash")||{})},getAttributeList:function(){var e=i.prototype.getAttributeList.call(this);return e.push("nameHash"),e.push("idHash"),e.push("accountId"),e},getValueForDisplay:function(){var e;return this.mode===this.MODE_DETAIL?(e=this.model.get(this.name),this.getDetailAddressHtml(e)):i.prototype.getValueForDisplay.call(this)},getDetailAddressHtml:function(e){if(!e)return"";var t=this.model.get("fromString")||this.model.get("fromName"),t=this.nameHash[e]||this.parseNameFromStringAddress(t)||null,i=this.typeHash[e]||null,s=this.idHash[e]||null;if(s)return $("<div>").append($("<a>").attr("href",`#${i}/view/`+s).attr("data-scope",i).attr("data-id",s).text(t)," ",$("<span>").addClass("text-muted chevron-right")," ",$("<span>").text(e)).get(0).outerHTML;let a=$("<div>");return(this.getAcl().check("Contact","create")||this.getAcl().check("Lead","create"))&&a.append(this.getCreateHtml(e)),t?a.append($("<span>").addClass("email-address-line").text(t).append(" ",$("<span>").addClass("text-muted chevron-right")," ",$("<span>").text(e))):a.append($("<span>").addClass("email-address-line").text(e)),a.get(0).outerHTML},getCreateHtml:function(e){let t=$("<ul>").addClass("dropdown-menu").attr("role","menu"),i=$("<span>").addClass("dropdown email-address-create-dropdown pull-right").append($("<button>").addClass("dropdown-toggle btn btn-link btn-sm").attr("data-toggle","dropdown").append($("<span>").addClass("caret text-muted")),t);return this.getAcl().check("Contact","create")&&t.append($("<li>").append($("<a>").attr("role","button").attr("tabindex","0").attr("data-action","createContact").attr("data-address",e).text(this.translate("Create Contact","labels","Email")))),this.getAcl().check("Lead","create")&&t.append($("<li>").append($("<a>").attr("role","button").attr("tabindex","0").attr("data-action","createLead").attr("data-address",e).text(this.translate("Create Lead","labels","Email")))),this.getAcl().check("Contact","edit")&&t.append($("<li>").append($("<a>").attr("role","button").attr("tabindex","0").attr("data-action","addToContact").attr("data-address",e).text(this.translate("Add to Contact","labels","Email")))),this.getAcl().check("Lead","edit")&&t.append($("<li>").append($("<a>").attr("role","button").attr("tabindex","0").attr("data-action","addToLead").attr("data-address",e).text(this.translate("Add to Lead","labels","Email")))),i.get(0).outerHTML},parseNameFromStringAddress:function(e){return~(e=e||"").indexOf("<")?'"'===(e=e.replace(/<(.*)>/,"").trim()).charAt(0)&&'"'===e.charAt(e.length-1)?e.substr(1,e.length-2):e:null},createPerson:function(n,o){var e=this.model.get("fromString")||this.model.get("fromName"),t=this.nameHash[o]||null,e=(t||"from"===this.name&&(t=this.parseNameFromStringAddress(e)||null),t=t&&this.getHelper().escapeString(t),{emailAddress:o}),i=(this.model.get("accountId")&&"Contact"===n&&(e.accountId=this.model.get("accountId"),e.accountName=this.model.get("accountName")),t&&(i=t.split(" ").slice(0,-1).join(" "),t=t.split(" ").slice(-1).join(" "),e.firstName=i,e.lastName=t),this.getMetadata().get("clientDefs."+n+".modalViews.edit")||"views/modals/edit");this.createView("create",i,{scope:n,attributes:e},e=>{e.render(),this.listenTo(e,"after:save",e=>{var t=Espo.Utils.clone(this.model.get("nameHash")||{}),i=Espo.Utils.clone(this.model.get("typeHash")||{}),s=Espo.Utils.clone(this.model.get("idHash")||{}),a=(s[o]=e.id,t[o]=e.get("name"),i[o]=n,this.idHash=s,{nameHash:this.nameHash=t,idHash:s,typeHash:this.typeHash=i});setTimeout(()=>{this.model.set(a),this.model.get("icsContents")&&this.model.fetch()},50)})})},addToPerson:function(n,o){var e=this.model.get("fromString")||this.model.get("fromName"),t=this.nameHash[o]||null,e=(t||"from"===this.name&&(t=this.parseNameFromStringAddress(e)||null),t=t&&this.getHelper().escapeString(t),{emailAddress:o}),e=(this.model.get("accountId")&&"Contact"===n&&(e.accountId=this.model.get("accountId"),e.accountName=this.model.get("accountName")),this.getMetadata().get("clientDefs."+n+".modalViews.select")||"views/modals/select-records"),i=(Espo.Ui.notify(" ... "),{});t&&(i.name={type:"equals",field:"name",value:t}),this.createView("dialog",e,{scope:n,createButton:!1,filters:i},e=>{e.render(),Espo.Ui.notify(!1),this.listenToOnce(e,"select",a=>{var i=()=>{var e=Espo.Utils.clone(this.model.get("nameHash")||{}),t=Espo.Utils.clone(this.model.get("typeHash")||{}),i=Espo.Utils.clone(this.model.get("idHash")||{}),s=(i[o]=a.id,e[o]=a.get("name"),t[o]=n,this.idHash=i,{nameHash:this.nameHash=e,idHash:i,typeHash:this.typeHash=t});setTimeout(()=>{this.model.set(s),this.model.get("icsContents")&&this.model.fetch()},50)};a.get("emailAddress")?a.fetch().then(()=>{var e=a.get("emailAddressData")||[],t={emailAddress:o,primary:0===e.length};e.push(t),a.save({emailAddressData:e},{patch:!0}).then(i)}):a.save({emailAddress:o},{patch:!0}).then(i)})})},fetchSearch:function(){var e=this.$element.val().trim();return e?{type:"equals",value:e}:null},validateEmail:function(){var e,t=this.model.get(this.name);if(t)return e=String(t).toLowerCase(),/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)||0===t.indexOf(this.erasedPlaceholder)?void 0:(e=this.translate("fieldShouldBeEmail","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0)},quickView:function(e){let t=new s(this.getMetadata(),this.getAcl());t.showDetail(this,{id:e.id,scope:e.scope})}})}),define("helpers/misc/field-language",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t){this.metadata=e,this.language=t}translateAttribute(e,t){let i=this.language.translate(t,"fields",e);var s;return t.indexOf("Id")===t.length-2?(s=t.slice(0,t.length-2),this.metadata.get(["entityDefs",e,"fields",s])&&(i=this.language.translate(s,"fields",e)+" ("+this.language.translate("id","fields")+")")):t.indexOf("Name")===t.length-4?(s=t.slice(0,t.length-4),this.metadata.get(["entityDefs",e,"fields",s])&&(i=this.language.translate(s,"fields",e)+" ("+this.language.translate("name","fields")+")")):t.indexOf("Type")===t.length-4&&(s=t.slice(0,t.length-4),this.metadata.get(["entityDefs",e,"fields",s])&&(i=this.language.translate(s,"fields",e)+" ("+this.language.translate("type","fields")+")")),t.indexOf("Ids")===t.length-3?(s=t.slice(0,t.length-3),this.metadata.get(["entityDefs",e,"fields",s])&&(i=this.language.translate(s,"fields",e)+" ("+this.language.translate("ids","fields")+")")):t.indexOf("Names")===t.length-5?(s=t.slice(0,t.length-5),this.metadata.get(["entityDefs",e,"fields",s])&&(i=this.language.translate(s,"fields",e)+" ("+this.language.translate("names","fields")+")")):t.indexOf("Types")===t.length-5&&(s=t.slice(0,t.length-5),this.metadata.get(["entityDefs",e,"fields",s])&&(i=this.language.translate(s,"fields",e)+" ("+this.language.translate("types","fields")+")")),i}}}),define("handlers/select-related",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e){this.viewHelper=e}getFilters(e){return Promise.resolve({})}}}),define("handlers/login",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t){this.loginView=e,this.data=t}process(){return Promise.resolve({})}}}),define("views/wysiwyg/modals/insert-link",["views/modal"],function(e){return e.extend({className:"dialog dialog-record",template:"wysiwyg/modals/insert-link",events:{'input [data-name="url"]':function(){this.controlInputs()},'paste [data-name="url"]':function(){this.controlInputs()}},shortcutKeys:{"Control+Enter":function(){this.hasAvailableActionItem("insert")&&this.actionInsert()}},data:function(){return{labels:this.options.labels||{}}},setup:function(){var e=this.options.labels||{};this.headerText=e.insert,this.buttonList=[{name:"insert",text:this.translate("Insert"),style:"primary",disabled:!0}],this.linkInfo=this.options.linkInfo||{},this.linkInfo.url&&this.enableButton("insert")},afterRender:function(){this.$url=this.$el.find('[data-name="url"]'),this.$text=this.$el.find('[data-name="text"]'),this.$openInNewWindow=this.$el.find('[data-name="openInNewWindow"]');var e=this.linkInfo;this.$url.val(e.url||""),this.$text.val(e.text||""),"isNewWindow"in e&&(this.$openInNewWindow.get(0).checked=!!e.isNewWindow)},controlInputs:function(){this.$url.val().trim()?this.enableButton("insert"):this.disableButton("insert")},actionInsert:function(){var e=this.$url.val().trim(),e={url:e,text:this.$text.val().trim()||e,isNewWindow:this.$openInNewWindow.get(0).checked,range:this.linkInfo.range};this.trigger("insert",e),this.close()}})}),define("views/wysiwyg/modals/insert-image",["views/modal"],function(e){return e.extend({className:"dialog dialog-record",template:"wysiwyg/modals/insert-image",events:{'click [data-action="insert"]':function(){this.actionInsert()},'input [data-name="url"]':function(){this.controlInsertButton()},'paste [data-name="url"]':function(){this.controlInsertButton()}},shortcutKeys:{"Control+Enter":function(){this.$el.find('[data-name="insert"]').hasClass("disabled")||this.actionInsert()}},data:function(){return{labels:this.options.labels||{}}},setup:function(){var e=this.options.labels||{};this.headerText=e.insert,this.buttonList=[]},afterRender:function(){let e=this.$el.find('[data-name="files"]');e.replaceWith(e.clone().on("change",e=>{this.trigger("upload",e.target.files||e.target.value),this.close()}).val(""))},controlInsertButton:function(){var e=this.$el.find('[data-name="url"]').val().trim();let t=this.$el.find('[data-name="insert"]');e?t.removeClass("disabled").removeAttr("disabled"):t.addClass("disabled").attr("disabled","disabled")},actionInsert:function(){var e=this.$el.find('[data-name="url"]').val().trim();this.trigger("insert",e),this.close()}})}),define("views/working-time-range/fields/users",["views/fields/link-multiple"],function(e){return e.extend({getSelectPrimaryFilterName:function(){return"active"}})}),define("views/working-time-range/fields/date-end",["views/fields/date"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.validations.push("afterOrSame")},validateAfterOrSame:function(){var e="dateStart",t=this.model.get(this.name),i=this.model.get(e);if(t&&i&&moment(t).unix()<moment(i).unix())return t=this.translate("fieldShouldAfter","messages").replace("{field}",this.getLabelText()).replace("{otherField}",this.translate(e,"fields",this.model.entityType)),this.showValidationMessage(t),!0;return!1}})}),define("views/working-time-calendar/fields/time-ranges",["views/fields/base"],function(t){return t.extend({listTemplateContent:`
            <div class="item-list">
            {{#each itemDataList}}
                <span class="item" data-key="{{key}}"
                >{{{var viewKey ../this}}}</span>{{#unless isLast}} &nbsp;&middot;&nbsp; {{/unless}}
            {{/each}}
            </div>
            {{#unless itemDataList.length}}
            <span class="none-value">{{translate 'None'}}</span>
            {{/unless}}
        `,detailTemplateContent:`
            <div class="item-list">
            {{#each itemDataList}}
                <div class="item" data-key="{{key}}">
                    {{{var viewKey ../this}}}
                </div>
            {{/each}}
            </div>
            {{#unless itemDataList.length}}
            <span class="none-value">{{translate 'None'}}</span>
            {{/unless}}
        `,editTemplateContent:`
            <div class="item-list">
            {{#each itemDataList}}
                <div class="item" data-key="{{key}}">
                    {{{var viewKey ../this}}}
                </div>
            {{/each}}
            </div>
            <div class="add-item-container margin-top-sm">
                <a
                    role="button"
                    tabindex="0"
                    class="add-item"
                    title="{{translate 'Add'}}"
                ><span class="fas fa-plus"></span></a>
            </div>
        `,fetchEmptyAsNull:!1,validations:["required","valid"],events:{"click .add-item":function(){this.addItem()},"click .remove-item":function(e){e=parseInt($(e.currentTarget).attr("data-key"));this.removeItem(e)}},data:function(){let e=t.prototype.data.call(this);return e.itemDataList=this.itemKeyList.map((e,t)=>({key:e.toString(),viewKey:this.composeViewKey(e),isLast:t===this.itemKeyList.length-1})),e},prepare:function(){return this.initItems(),this.createItemViews()},initItems:function(){this.itemKeyList=[],this.getItemListFromModel().forEach((e,t)=>{this.itemKeyList.push(t)})},createItemView:function(e,t){var i=this.isEditMode()?"views/working-time-calendar/fields/time-ranges/item-edit":"views/working-time-calendar/fields/time-ranges/item-detail";return this.createView(this.composeViewKey(t),i,{value:e,selector:'.item[data-key="'+t+'"]',key:t}).then(e=>(this.listenTo(e,"change",()=>{this.trigger("change")}),e))},createItemViews:function(){if(this.itemKeyList.forEach(e=>{this.clearView(this.composeViewKey(e))}),!this.model.has(this.name))return Promise.resolve();let i=this.getItemListFromModel(),s=[];return this.itemKeyList.forEach((e,t)=>{t=i[t],t=this.createItemView(t,e);s.push(t)}),Promise.all(s)},getItemView:function(e){return this.getView(this.composeViewKey(e))},composeViewKey:function(e){return"item-"+e},getItemListFromModel:function(){return Espo.Utils.cloneDeep(this.model.get(this.name)||[])},addItem:function(){let e=this.getItemListFromModel(),t=null;var i=[t=e.length?e[e.length-1][1]:t,null];e.push(i);let s=this.itemKeyList[this.itemKeyList.length-1];void 0===s&&(s=0),s++,this.itemKeyList.push(s),this.$el.find(".item-list").append($("<div>").addClass("item").attr("data-key",s)),this.createItemView(i,s).then(e=>e.render()).then(()=>{this.trigger("change")})},removeItem:function(t){var i=this.itemKeyList.indexOf(t);if(-1!==t){let e=this.getItemListFromModel();this.itemKeyList.splice(i,1),e.splice(i,1),this.model.set(this.name,e,{ui:!0}),this.clearView(this.composeViewKey(t)),this.$el.find(`.item[data-key="${t}"`).remove(),this.trigger("change")}},fetch:function(){let t=[],e=(this.itemKeyList.forEach(e=>{t.push(this.getItemView(e).fetch())}),{});return e[this.name]=Espo.Utils.cloneDeep(t),0===e[this.name].length&&(e[this.name]=null),e},validateRequired:function(){if(!this.isRequired())return!1;if(this.getItemListFromModel().length)return!1;var e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText());return this.showValidationMessage(e,".add-item-container"),!0},validateValid:function(){if(!this.isRangesInvalid())return!1;var e=this.translate("fieldInvalid","messages").replace("{field}",this.getLabelText());return this.showValidationMessage(e,".add-item-container"),!0},isRangesInvalid:function(){var t=this.getItemListFromModel();for(let e=0;e<t.length;e++){var i=t[e];if(this.isRangeInvalid(i[0],i[1],!0))return!0;if(0!==e){var s=i[e-1];if(this.isRangeInvalid(s[1],i[0]))return!0}}return!1},isRangeInvalid:function(e,t,i){if(null===e||null===t)return!0;e=parseFloat(e.replace(":",".")),t=parseFloat(t.replace(":","."));return!(!i||e!==t)||t<e}})}),define("views/working-time-calendar/fields/time-ranges/item-edit",["view","lib!moment"],function(e,i){return e.extend({templateContent:`
            <div class="row">
                <div class="start-container col-xs-5">
                    <input
                        class="form-control"
                        type="text"
                        data-name="start"
                        value="{{start}}"
                        autocomplete="espo-start"
                        spellcheck="false"
                    >
                </div>
                <div class="start-container col-xs-1 center-align">
                    <span class="field-row-text-item">&nbsp;–&nbsp;</span>
                </div>
                <div class="end-container col-xs-5">
                    <input
                        class="form-control"
                        type="text"
                        data-name="end"
                        value="{{end}}"
                        autocomplete="espo-end"
                        spellcheck="false"
                    >
                </div>
                <div class="col-xs-1 center-align">
                    <a
                        role="button"
                        tabindex="0"
                        class="remove-item field-row-text-item"
                        data-key="{{key}}"
                        title="{{translate 'Remove'}}"
                    ><span class="fas fa-times"></span></a>
                </div>
            </div>
        `,timeFormatMap:{"HH:mm":"H:i","hh:mm A":"h:i A","hh:mm a":"h:i a","hh:mmA":"h:iA","hh:mma":"h:ia"},minuteStep:30,data:function(){let e={};return e.start=this.convertTimeToDisplay(this.value[0]),e.end=this.convertTimeToDisplay(this.value[1]),e.key=this.key,e},setup:function(){this.value=this.options.value||[null,null],this.key=this.options.key},convertTimeToDisplay:function(e){if(!e)return"";let t=i(e,"HH:mm");return t.isValid()?t.format(this.getDateTime().timeFormat):""},convertTimeFromDisplay:function(e){if(!e)return null;let t=i(e,this.getDateTime().timeFormat);return t.isValid()?t.format("HH:mm"):null},afterRender:function(){this.$start=this.$el.find('[data-name="start"]'),this.$end=this.$el.find('[data-name="end"]'),this.initTimepicker(this.$start),this.initTimepicker(this.$end),this.setMinTime(),this.$start.on("change",()=>this.setMinTime())},setMinTime:function(){var e=this.$start.val();this.$end.timepicker("option","maxTime",this.convertTimeToDisplay("23:59")),e?this.$end.timepicker("option","minTime",e):this.$end.timepicker("option","minTime",null)},initTimepicker:function(e){e.timepicker({step:this.minuteStep,timeFormat:this.timeFormatMap[this.getDateTime().timeFormat]}),e.on("change",()=>this.trigger("change")),e.attr("autocomplete","espo-time-range-item")},fetch:function(){return[this.convertTimeFromDisplay(this.$start.val()),this.convertTimeFromDisplay(this.$end.val())]}})}),define("views/working-time-calendar/fields/time-ranges/item-detail",["view","lib!moment"],(e,i)=>{class t extends e{templateContent=`
            {{start}}
            &nbsp;–&nbsp;
            {{end}}
        `;data(){return{start:this.convertTimeToDisplay(this.value[0]),end:this.convertTimeToDisplay(this.value[1])}}setup(){this.value=this.options.value}convertTimeToDisplay(e){if(!e)return"";let t=i(e,"HH:mm");return t.isValid()?t.format(this.getDateTime().timeFormat):""}}return t}),define("views/webhook/record/list",["views/record/list"],function(e){return e.extend({massActionList:["remove","massUpdate","export"]})}),define("views/webhook/fields/user",["views/fields/link"],function(e){return e.extend({selectPrimaryFilterName:"activeApi"})}),define("views/webhook/fields/event",["views/fields/varchar"],function(e){return e.extend({setupOptions:function(){var t=[];this.getMetadata().getScopeObjectList().sort(function(e,t){return e.localeCompare(t)}.bind(this)).forEach(function(e){t.push(e+".create"),t.push(e+".update"),t.push(e+".delete")},this),this.params.options=t}})}),define("views/user-security/modals/two-factor-sms",["views/modal","model"],function(e,i){return e.extend({template:"user-security/modals/two-factor-sms",className:"dialog dialog-record",shortcutKeys:{"Control+Enter":"apply"},events:{'click [data-action="sendCode"]':function(){this.actionSendCode()}},setup:function(){this.buttonList=[{name:"apply",label:"Apply",style:"danger",hidden:!0},{name:"cancel",label:"Cancel"}],this.headerHtml="&nbsp";var e=this.getConfig().get("auth2FASmsCodeLength")||7;let t=new i;t.name="UserSecurity",t.set("phoneNumber",null),t.setDefs({fields:{code:{type:"varchar",required:!0,maxLength:e},phoneNumber:{type:"enum",required:!0}}}),this.internalModel=t,this.wait(Espo.Ajax.postRequest("UserSecurity/action/getTwoFactorUserSetupData",{id:this.model.id,password:this.model.get("password"),auth2FAMethod:this.model.get("auth2FAMethod"),reset:this.options.reset}).then(e=>{this.phoneNumberList=e.phoneNumberList,this.createView("record","views/record/edit-for-modal",{scope:"None",selector:".record",model:t,detailLayout:[{rows:[[{name:"phoneNumber",labelText:this.translate("phoneNumber","fields","User")},!1],[{name:"code",labelText:this.translate("Code","labels","User")},!1]]}]},e=>{e.setFieldOptionList("phoneNumber",this.phoneNumberList),this.phoneNumberList.length&&t.set("phoneNumber",this.phoneNumberList[0]),e.hideField("code")})}))},afterRender:function(){this.$sendCode=this.$el.find('[data-action="sendCode"]'),this.$pInfo=this.$el.find("p.p-info"),this.$pButton=this.$el.find("p.p-button"),this.$pInfoAfter=this.$el.find("p.p-info-after")},actionSendCode:function(){this.$sendCode.attr("disabled","disabled").addClass("disabled"),Espo.Ajax.postRequest("TwoFactorSms/action/sendCode",{id:this.model.id,phoneNumber:this.internalModel.get("phoneNumber")}).then(()=>{this.showButton("apply"),this.$pInfo.addClass("hidden"),this.$pButton.addClass("hidden"),this.$pInfoAfter.removeClass("hidden"),this.getView("record").setFieldReadOnly("phoneNumber"),this.getView("record").showField("code")}).catch(()=>{this.$sendCode.removeAttr("disabled").removeClass("disabled")})},actionApply:function(){var e=this.getView("record").processFetch();e&&(this.model.set("code",e.code),this.hideButton("apply"),this.hideButton("cancel"),Espo.Ui.notify(this.translate("pleaseWait","messages")),this.model.save().then(()=>{Espo.Ui.notify(!1),this.trigger("done")}).catch(()=>{this.showButton("apply"),this.showButton("cancel")}))}})}),define("views/user-security/modals/two-factor-email",["views/modal","model"],function(e,i){return e.extend({template:"user-security/modals/two-factor-email",className:"dialog dialog-record",shortcutKeys:{"Control+Enter":"apply"},events:{'click [data-action="sendCode"]':function(){this.actionSendCode()}},setup:function(){this.buttonList=[{name:"apply",label:"Apply",style:"danger",hidden:!0},{name:"cancel",label:"Cancel"}],this.headerHtml="&nbsp";var e=this.getConfig().get("auth2FAEmailCodeLength")||7;let t=new i;t.entityType=t.name="UserSecurity",t.set("emailAddress",null),t.setDefs({fields:{code:{type:"varchar",required:!0,maxLength:e},emailAddress:{type:"enum",required:!0}}}),this.internalModel=t,this.wait(Espo.Ajax.postRequest("UserSecurity/action/getTwoFactorUserSetupData",{id:this.model.id,password:this.model.get("password"),auth2FAMethod:this.model.get("auth2FAMethod"),reset:this.options.reset}).then(e=>{this.emailAddressList=e.emailAddressList,this.createView("record","views/record/edit-for-modal",{scope:"None",selector:".record",model:t,detailLayout:[{rows:[[{name:"emailAddress",labelText:this.translate("emailAddress","fields","User")},!1],[{name:"code",labelText:this.translate("Code","labels","User")},!1]]}]},e=>{e.setFieldOptionList("emailAddress",this.emailAddressList),this.emailAddressList.length&&t.set("emailAddress",this.emailAddressList[0]),e.hideField("code")})}))},afterRender:function(){this.$sendCode=this.$el.find('[data-action="sendCode"]'),this.$pInfo=this.$el.find("p.p-info"),this.$pButton=this.$el.find("p.p-button"),this.$pInfoAfter=this.$el.find("p.p-info-after")},actionSendCode:function(){this.$sendCode.attr("disabled","disabled").addClass("disabled"),Espo.Ajax.postRequest("TwoFactorEmail/action/sendCode",{id:this.model.id,emailAddress:this.internalModel.get("emailAddress")}).then(()=>{this.showButton("apply"),this.$pInfo.addClass("hidden"),this.$pButton.addClass("hidden"),this.$pInfoAfter.removeClass("hidden"),this.getView("record").setFieldReadOnly("emailAddress"),this.getView("record").showField("code")}).catch(()=>{this.$sendCode.removeAttr("disabled").removeClass("disabled")})},actionApply:function(){var e=this.getView("record").processFetch();e&&(this.model.set("code",e.code),this.hideButton("apply"),this.hideButton("cancel"),Espo.Ui.notify(this.translate("pleaseWait","messages")),this.model.save().then(()=>{Espo.Ui.notify(!1),this.trigger("done")}).catch(()=>{this.showButton("apply"),this.showButton("cancel")}))}})}),define("views/user-security/modals/totp",["views/modal","model"],function(e,i){let s;return e.extend({template:"user-security/modals/totp",className:"dialog dialog-record",shortcutKeys:{"Control+Enter":"apply"},setup:function(){this.buttonList=[{name:"apply",label:"Apply",style:"danger"},{name:"cancel",label:"Cancel"}],this.headerHtml="&nbsp";var t=new i;t.name="UserSecurity",this.wait(Espo.Ajax.postRequest("UserSecurity/action/getTwoFactorUserSetupData",{id:this.model.id,password:this.model.get("password"),auth2FAMethod:this.model.get("auth2FAMethod"),reset:this.options.reset}).then(e=>{this.label=e.label,this.secret=e.auth2FATotpSecret,t.set("secret",e.auth2FATotpSecret)})),t.setDefs({fields:{code:{type:"varchar",required:!0,maxLength:7},secret:{type:"varchar",readOnly:!0}}}),this.createView("record","views/record/edit-for-modal",{scope:"None",selector:".record",model:t,detailLayout:[{rows:[[{name:"secret",labelText:this.translate("Secret","labels","User")},!1],[{name:"code",labelText:this.translate("Code","labels","User")},!1]]}]}),Espo.loader.requirePromise("lib!qrcodejs").then(e=>{s=e})},afterRender:function(){new s(this.$el.find(".qrcode").get(0),{text:"otpauth://totp/"+this.label+"?secret="+this.secret,width:256,height:256,colorDark:"#000000",colorLight:"#ffffff",correctLevel:s.CorrectLevel.H})},actionApply:function(){var e=this.getView("record").processFetch();e&&(this.model.set("code",e.code),this.hideButton("apply"),this.hideButton("cancel"),Espo.Ui.notify(this.translate("pleaseWait","messages")),this.model.save().then(()=>{Espo.Ui.notify(!1),this.trigger("done")}).catch(()=>{this.showButton("apply"),this.showButton("cancel")}))}})}),define("views/user/password-change-request",["view","model"],function(e,i){return e.extend({template:"user/password-change-request",data:function(){return{requestId:this.options.requestId,notFound:this.options.notFound,notFoundMessage:this.notFoundMessage}},events:{"click #btn-submit":function(){this.submit()}},setup:function(){let e=this.model=new i;e.entityType=e.name="User",this.createView("password","views/user/fields/password",{model:e,mode:"edit",selector:'.field[data-name="password"]',defs:{name:"password",params:{required:!0,maxLength:255}},strengthParams:this.options.strengthParams}),this.createView("passwordConfirm","views/fields/password",{model:e,mode:"edit",selector:'.field[data-name="passwordConfirm"]',defs:{name:"passwordConfirm",params:{required:!0,maxLength:255}}}),this.createView("generatePassword","views/user/fields/generate-password",{model:e,mode:"detail",readOnly:!0,selector:'.field[data-name="generatePassword"]',defs:{name:"generatePassword"},strengthParams:this.options.strengthParams}),this.createView("passwordPreview","views/fields/base",{model:e,mode:"detail",readOnly:!0,selector:'.field[data-name="passwordPreview"]',defs:{name:"passwordPreview"}}),this.model.on("change:passwordPreview",()=>this.reRender());var t=this.baseUrl=window.location.href.split("?")[0];this.notFoundMessage=this.translate("passwordChangeRequestNotFound","messages","User").replace("{url}",t)},submit:function(){this.getView("password").fetchToModel(),this.getView("passwordConfirm").fetchToModel();var e=this.getView("password").validate()||this.getView("passwordConfirm").validate(),t=this.model.get("password");if(!e){let e=this.$el.find(".btn-submit");e.addClass("disabled"),Espo.Ajax.postRequest("User/changePasswordByRequest",{requestId:this.options.requestId,password:t}).then(e=>{this.$el.find(".password-change").remove();e=e.url||this.baseUrl,e=this.translate("passwordChangedByRequest","messages","User")+' <a href="'+e+'">'+this.translate("Login","labels","User")+"</a>.";this.$el.find(".msg-box").removeClass("hidden").html('<span class="text-success">'+e+"</span>")}).catch(()=>e.removeClass("disabled"))}}})}),define("views/user/list",["views/list"],function(e){return e.extend({storeViewAfterUpdate:!1,setup:function(){e.prototype.setup.call(this)}})}),define("views/user/detail",["views/detail"],function(t){return t.extend({setup:function(){var e;t.prototype.setup.call(this),this.getUser().isPortal()&&(this.rootLinkDisabled=!0),this.model.id!==this.getUser().id&&!this.getUser().isAdmin()||((this.model.isRegular()||this.model.isAdmin()||this.model.isPortal())&&this.addMenuItem("dropdown",{name:"preferences",label:"Preferences",style:"default",action:"preferences",link:"#Preferences/edit/"+this.getUser().id}),(this.model.isRegular()||this.model.isAdmin())&&((this.getAcl().check("EmailAccountScope")&&this.model.id===this.getUser().id||this.getUser().isAdmin())&&this.addMenuItem("dropdown",{name:"emailAccounts",label:"Email Accounts",style:"default",action:"emailAccounts",link:"#EmailAccount/list/userId="+this.model.id+"&userName="+encodeURIComponent(this.model.get("name"))}),this.model.id===this.getUser().id&&this.getAcl().checkScope("ExternalAccount")&&this.menu.buttons.push({name:"externalAccounts",label:"External Accounts",style:"default",action:"externalAccounts",link:"#ExternalAccount"}))),this.getAcl().checkScope("Calendar")&&(this.model.isRegular()||this.model.isAdmin())&&((e=this.getAcl().checkUserPermission(this.model))||"team"===this.getAcl().get("userPermission")&&(this.model.has("teamsIds")||this.listenToOnce(this.model,"sync",function(){this.getAcl().checkUserPermission(this.model)&&this.showHeaderActionItem("calendar")},this)),this.menu.buttons.push({name:"calendar",iconHtml:'<span class="far fa-calendar-alt"></span>',text:this.translate("Calendar","scopeNames"),style:"default",link:"#Calendar/show/userId="+this.model.id+"&userName="+encodeURIComponent(this.model.get("name")),hidden:!e}))},actionPreferences:function(){this.getRouter().navigate("#Preferences/edit/"+this.model.id,{trigger:!0})},actionEmailAccounts:function(){this.getRouter().navigate("#EmailAccount/list/userId="+this.model.id+"&userName="+encodeURIComponent(this.model.get("name")),{trigger:!0})},actionExternalAccounts:function(){this.getRouter().navigate("#ExternalAccount",{trigger:!0})}})}),define("views/user/record/list",["views/record/list"],function(e){return e.extend({quickEditDisabled:!0,rowActionsView:"views/user/record/row-actions/default",massActionList:["remove","massUpdate","export"],checkAllResultMassActionList:["massUpdate","export"],setupMassActionItems:function(){e.prototype.setupMassActionItems.call(this),"ApiUser"===this.scope&&(this.removeMassAction("massUpdate"),this.removeMassAction("export"),this.layoutName="listApi"),"PortalUser"===this.scope&&(this.layoutName="listPortal"),this.getUser().isAdmin()||(this.removeMassAction("massUpdate"),this.removeMassAction("export"))},getModelScope:function(e){return this.collection.get(e).isPortal()?"PortalUser":this.scope}})}),define("views/user/record/edit",["exports","views/record/edit","views/user/record/detail"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{sideView="views/user/record/edit-side";setup(){super.setup(),this.setupNonAdminFieldsAccess(),this.model.id===this.getUser().id&&this.listenTo(this.model,"after:save",()=>{this.getUser().set(this.model.getClonedAttributes())}),this.hideField("sendAccessInfo"),this.passwordInfoMessage=this.getPasswordSendingMessage(),this.passwordInfoMessage||this.hideField("passwordInfo");let t=!1;this.listenToOnce(this.model,"change:password",()=>{t=!0,this.model.isNew()?this.controlSendAccessInfoFieldForNew():this.controlSendAccessInfoField()}),this.listenTo(this.model,"change",e=>{(this.model.isNew()||t)&&(e.hasChanged("emailAddress")||e.hasChanged("portalsIds")||e.hasChanged("password"))&&(this.model.isNew()?this.controlSendAccessInfoFieldForNew():this.controlSendAccessInfoField())}),i.default.prototype.setupFieldAppearance.call(this),this.hideField("passwordPreview"),this.listenTo(this.model,"change:passwordPreview",(e,t)=>{(t=t||"").length?this.showField("passwordPreview"):this.hideField("passwordPreview")}),this.listenTo(this.model,"after:save",()=>{this.model.unset("password",{silent:!0}),this.model.unset("passwordConfirm",{silent:!0})})}controlSendAccessInfoField(){this.isPasswordSendable()&&this.model.get("password")?this.showField("sendAccessInfo"):(this.hideField("sendAccessInfo"),this.model.set("sendAccessInfo",!1))}controlSendAccessInfoFieldForNew(){var e=!1===this.recordHelper.getFieldStateParam("sendAccessInfo","hidden");if(this.isPasswordSendable())return this.showField("sendAccessInfo"),void(e||this.model.set("sendAccessInfo",!0));this.hideField("sendAccessInfo"),this.model.set("sendAccessInfo",!1)}isPasswordSendable(){return!(this.model.isPortal()&&!(this.model.get("portalsIds")||[]).length)&&!!this.model.get("emailAddress")}setupNonAdminFieldsAccess(){i.default.prototype.setupNonAdminFieldsAccess.call(this)}controlFieldAppearance(){i.default.prototype.controlFieldAppearance.call(this)}getGridLayout(i){this.getHelper().layoutManager.get(this.model.entityType,this.options.layoutName||this.layoutName,e=>{let t=Espo.Utils.cloneDeep(e);t.push({label:"Teams and Access Control",name:"accessControl",rows:[[{name:"type"},{name:"isActive"}],[{name:"teams"},{name:"defaultTeam"}],[{name:"roles"},!1]]}),t.push({label:"Portal",name:"portal",rows:[[{name:"portals"},{name:"contact"}],[{name:"portalRoles"},{name:"accounts"}]]}),this.getUser().isAdmin()&&this.model.isPortal()&&t.push({label:"Misc",name:"portalMisc",rows:[[{name:"dashboardTemplate"},!1]]}),(this.model.isAdmin()||this.model.isRegular())&&t.push({label:"Misc",name:"misc",rows:[[{name:"workingTimeCalendar"},{name:"layoutSet"}]]}),this.type===this.TYPE_EDIT&&this.getUser().isAdmin()&&!this.model.isApi()&&t.push({label:"Password",rows:[[{name:"password",type:"password",params:{required:!1,readyToChange:!0},view:"views/user/fields/password"},{name:"generatePassword",view:"views/user/fields/generate-password",customLabel:""}],[{name:"passwordConfirm",type:"password",params:{required:!1,readyToChange:!0}},{name:"passwordPreview",view:"views/fields/base",params:{readOnly:!0}}],[{name:"sendAccessInfo"},{name:"passwordInfo",type:"text",customLabel:"",customCode:this.passwordInfoMessage}]]}),this.getUser().isAdmin()&&this.model.isApi()&&t.push({name:"auth",rows:[[{name:"authMethod"},!1]]});e={type:"record",layout:this.convertDetailLayout(t)};i(e)})}getPasswordSendingMessage(){if(this.getConfig().get("outboundEmailFromAddress"))return"";var e=this.translate("setupSmtpBefore","messages","User").replace("{url}","#Admin/outboundEmails");return this.getHelper().transformMarkdownInlineText(e)}fetch(){let e=super.fetch();return this.isNew||"password"in e&&(""===e.password||null==e.password)&&(delete e.password,delete e.passwordConfirm,this.model.unset("password"),this.model.unset("passwordConfirm")),e}exit(e){"create"!==e&&"save"!==e||this.model.unset("sendAccessInfo",{silent:!0}),super.exit(e)}errorHandlerUserNameExists(){Espo.Ui.error(this.translate("userNameExists","messages","User"))}}e.default=a}),define("views/user/record/edit-side",["views/record/edit-side"],function(e){return e.extend({})}),define("views/user/record/edit-quick",["views/record/edit-small","views/user/record/detail"],function(e,t){return e.extend({sideView:"views/user/record/edit-side",setup:function(){e.prototype.setup.call(this),t.prototype.setupNonAdminFieldsAccess.call(this),t.prototype.setupFieldAppearance.call(this)},controlFieldAppearance:function(){t.prototype.controlFieldAppearance.call(this)}})}),define("views/user/record/detail-quick",["views/record/detail-small","views/user/record/detail"],function(e,t){return e.extend({sideView:"views/user/record/detail-quick-side",bottomView:null,editModeEnabled:!1,setup:function(){e.prototype.setup.call(this),t.prototype.setupNonAdminFieldsAccess.call(this),t.prototype.setupFieldAppearance.call(this)},controlFieldAppearance:function(){t.prototype.controlFieldAppearance.call(this)}})}),define("views/user/record/detail-quick-side",["views/record/detail-side","views/user/record/detail-side"],function(e,t){return e.extend({setupPanels:function(){t.prototype.setupPanels.call(this)}})}),define("views/user/record/detail-bottom",["exports","views/record/detail-bottom"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setupPanels(){super.setupPanels();var e=this.getAcl().checkUserPermission(this.model);e||"team"!==this.getAcl().getPermissionLevel("userPermission")||this.model.has("teamsIds")||this.listenToOnce(this.model,"sync",()=>{this.getAcl().checkUserPermission(this.model)&&this.onPanelsReady(()=>{this.showPanel("stream","acl")})}),this.panelList.push({name:"stream",label:"Stream",view:"views/user/record/panels/stream",sticked:!0,hidden:!e}),e||this.recordHelper.setPanelStateParam("stream","hiddenAclLocked",!0)}}e.default=s}),define("views/user/record/row-actions/relationship-followers",["views/record/row-actions/relationship"],function(e){return e.extend({getActionList:function(){var e=[{action:"quickView",label:"View",data:{id:this.model.id},link:"#"+this.model.entityType+"/view/"+this.model.id}];return(this.getUser().isAdmin()||"no"!==this.getAcl().get("followerManagementPermission")||this.model.isPortal()&&"yes"===this.getAcl().get("portalPermission")||this.model.id===this.getUser().id)&&e.push({action:"unlinkRelated",label:"Unlink",data:{id:this.model.id}}),e}})}),define("views/user/record/row-actions/default",["views/record/row-actions/default"],function(e){return e.extend({getActionList:function(){var e="User",t=(this.model.isPortal()?e="PortalUser":this.model.isApi()&&(e="ApiUser"),[{action:"quickView",label:"View",data:{id:this.model.id,scope:e},link:"#"+e+"/view/"+this.model.id}]);return this.options.acl.edit&&t.push({action:"quickEdit",label:"Edit",data:{id:this.model.id,scope:e},link:"#"+e+"/edit/"+this.model.id}),t}})}),define("views/user/record/panels/stream",["views/stream/panel"],function(t){return t.extend({setup:function(){t.prototype.setup.call(this);let e=this.getAcl().checkPermission("message",this.model);this.model.id===this.getUser().id?this.placeholderText=this.translate("writeMessageToSelf","messages"):this.placeholderText=this.translate("writeMessageToUser","messages").replace("{user}",this.model.get("name")),e||(this.postDisabled=!0,"team"===this.getAcl().getPermissionLevel("message")&&(this.model.has("teamsIds")||this.listenToOnce(this.model,"sync",()=>{(e=this.getAcl().checkUserPermission(this.model))&&(this.postDisabled=!1,this.$el.find(".post-container").removeClass("hidden"))})))},prepareNoteForPost:function(e){var t=[this.model.id],i={};i[t]=this.model.get("name"),e.set("usersIds",t),e.set("usersNames",i),e.set("targetType","users")}})}),define("views/user/record/panels/default-side",["views/record/panels/default-side"],function(e){return e.extend({complexCreatedDisabled:!0,complexModifiedDisabled:!0})}),define("views/user/modals/select-followers",["views/modals/select-records"],function(e){return e.extend({setup:function(){this.filterList=["active"],this.getAcl().getPermissionLevel("portalPermission")&&this.filterList.push("activePortal"),e.prototype.setup.call(this)}})}),define("views/user/modals/security",["exports","views/modal","model"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{templateContent='<div class="record no-side-margin">{{{record}}}</div>';className="dialog dialog-record";shortcutKeys={"Control+Enter":"apply"};setup(){this.buttonList=[{name:"apply",label:"Apply",hidden:!0,style:"danger",onClick:()=>this.apply()},{name:"cancel",label:"Close"}],this.dropdownItemList=[{name:"reset",text:this.translate("Reset 2FA"),hidden:!0,onClick:()=>this.reset()}],this.userModel=this.options.userModel,this.$header=$("<span>").append($("<span>").text(this.translate("Security")),' <span class="chevron-right"></span> ',$("<span>").text(this.userModel.get("userName")));const e=this.model=new i.default;e.name="UserSecurity",e.id=this.userModel.id,e.url="UserSecurity/"+this.userModel.id;var t=this.getConfig().get("auth2FAMethodList")||[];e.setDefs({fields:{auth2FA:{type:"bool",labelText:this.translate("auth2FAEnable","fields","User")},auth2FAMethod:{type:"enum",options:t,translation:"Settings.options.auth2FAMethodList"}}}),this.wait(e.fetch().then(()=>{this.initialAttributes=Espo.Utils.cloneDeep(e.attributes),e.get("auth2FA")&&this.showActionItem("reset"),this.createView("record","views/record/edit-for-modal",{scope:"None",selector:".record",model:this.model,detailLayout:[{rows:[[{name:"auth2FA",labelText:this.translate("auth2FAEnable","fields","User")},{name:"auth2FAMethod",labelText:this.translate("auth2FAMethod","fields","User")}]]}]},e=>{this.controlFieldsVisibility(e),this.listenTo(this.model,"change:auth2FA",()=>{this.controlFieldsVisibility(e)})})})),this.listenTo(this.model,"change",()=>{this.initialAttributes&&(this.isChanged()?this.showActionItem("apply"):this.hideActionItem("apply"))})}controlFieldsVisibility(e){this.model.get("auth2FA")?(e.showField("auth2FAMethod"),e.setFieldRequired("auth2FAMethod")):(e.hideField("auth2FAMethod"),e.setFieldNotRequired("auth2FAMethod"))}isChanged(){return this.initialAttributes.auth2FA!==this.model.get("auth2FA")||this.initialAttributes.auth2FAMethod!==this.model.get("auth2FAMethod")}reset(){this.confirm(this.translate("security2FaResetConfirmation","messages","User"),()=>{this.apply(!0)})}getRecordView(){return this.getView("record")}apply(e){this.getRecordView().processFetch()&&(this.hideActionItem("apply"),new Promise(i=>{this.createView("dialog","views/user/modals/password",{},t=>{t.render(),this.listenToOnce(t,"cancel",()=>this.showActionItem("apply")),this.listenToOnce(t,"proceed",e=>{this.model.set("password",e.password),t.close(),i()})})}).then(()=>this.processApply(e)))}processApply(e){var t;if(this.model.get("auth2FA"))return t=this.model.get("auth2FAMethod"),(t=this.getMetadata().get(["app","authentication2FAMethods",t,"userApplyView"]))?(Espo.Ui.notify(" ... "),void this.createView("dialog",t,{model:this.model,reset:e},e=>{Espo.Ui.notify(!1),e.render(),this.listenToOnce(e,"cancel",()=>{this.close()}),this.listenToOnce(e,"apply",()=>{e.close(),this.processSave()}),this.listenToOnce(e,"done",()=>{Espo.Ui.success(this.translate("Done")),this.trigger("done"),e.close(),this.close()})})):(e&&this.model.set("auth2FA",!1),void this.processSave());this.processSave()}processSave(){this.hideActionItem("apply"),this.model.save().then(()=>{this.close(),Espo.Ui.success(this.translate("Done"))}).catch(()=>this.showActionItem("apply"))}}e.default=a}),define("views/user/modals/password",["views/modal","model"],function(e,t){return e.extend({templateContent:'<div class="record no-side-margin">{{{record}}}</div>',className:"dialog dialog-record",shortcutKeys:{"Control+Enter":"apply"},setup:function(){this.buttonList=[{name:"apply",label:"Apply",style:"danger"},{name:"cancel",label:"Cancel"}],this.headerHtml="&nbsp",this.userModel=this.options.userModel;var e=this.model=new t;e.name="UserSecurity",e.setDefs({fields:{password:{type:"password",required:!0}}}),this.createView("record","views/record/edit-for-modal",{scope:"None",selector:".record",model:this.model,detailLayout:[{rows:[[{name:"password",labelText:this.translate("yourPassword","fields","User"),params:{readyToChange:!0}},!1]]}]})},actionApply:function(){var e=this.getView("record").processFetch();e&&this.trigger("proceed",e)}})}),define("views/user/modals/mass-update",["views/modals/mass-update"],function(e){return e.extend({setup:function(){"ApiUser"===this.options.scope?this.layoutName="massUpdateApi":"PortalUser"===this.options.scope&&(this.layoutName="massUpdatePortal"),e.prototype.setup.call(this)}})}),define("views/user/modals/login-as",["views/modal"],function(e){return e.extend({backdrop:!0,templateContent:`
            <div class="well">
                {{translate 'loginAs' category='messages' scope='User'}}
            </div>
            <a href="{{viewObject.url}}" class="text-large">{{translate 'Login Link' scope='User'}}</a>
        `,setup:function(){this.$header=$("<span>").append($("<span>").text(this.model.get("name"))," ",$("<span>").addClass("chevron-right")," ",$("<span>").text(this.translate("Login"))),this.url="?entryPoint=loginAs"+`&anotherUser=${this.options.anotherUser}&username=`+this.options.username}})}),define("views/user/modals/detail",["views/modals/detail"],function(e){return e.extend({editDisabled:!0,getScope:function(){return this.model.isPortal()?"PortalUser":"User"}})}),define("views/user/modals/access",["views/modal"],function(e){return e.extend({cssName:"user-access",multiple:!1,template:"user/modals/access",backdrop:!0,data:function(){return{valuePermissionDataList:this.getValuePermissionList(),levelListTranslation:this.getLanguage().get("Role","options","levelList")||{}}},getValuePermissionList:function(){var e=this.getMetadata().get(["app","acl","valuePermissionList"],[]),i=[];return e.forEach(function(e){var t={};t.name=e,t.value=this.options.aclData[e],i.push(t)},this),i},setup:function(){this.buttonList=[{name:"cancel",label:"Cancel"}];var e,t=Espo.Utils.cloneDeep(this.options.aclData.fieldTable||{});for(e in t){var i,s=t[e]||{};for(i in s)null!==this.getMetadata().get(["app","acl","mandatory","scopeFieldLevel",e,i])&&delete s[i],s[i]&&this.getMetadata().get(["entityDefs",e,"fields",i,"readOnly"])&&"no"===s[i].edit&&"yes"===s[i].read&&delete s[i]}this.createView("table","views/role/record/table",{acl:{data:this.options.aclData.table,fieldData:t},final:!0}),this.headerText=this.translate("Access")}})}),define("views/user/fields/user-name",["views/fields/varchar"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.validations.push("userName")},afterRender:function(){e.prototype.afterRender.call(this);let i=this.getUserNameRegularExpression();this.isEditMode()&&this.$element.on("change",()=>{let e=this.$element.val();var t=new RegExp(i,"gi");e=e.replace(t,"").replace(/[\s]/g,"_").toLowerCase(),this.$element.val(e),this.trigger("change")})},getUserNameRegularExpression:function(){return this.getConfig().get("userNameRegularExpression")||"[^a-z0-9-@_.s]"},validateUserName:function(){var t=this.model.get(this.name);if(t){var i=this.getUserNameRegularExpression();let e=new RegExp(i,"gi");if(e.test(t))return i=this.translate("fieldInvalid","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(i),!0}}})}),define("views/user/fields/teams",["views/fields/link-multiple-with-role"],function(e){return e.extend({forceRoles:!0,setup:function(){e.prototype.setup.call(this),this.roleListMap={},this.loadRoleList(()=>{this.isEditMode()&&(this.isRendered()||this.isBeingRendered())&&this.reRender()}),this.listenTo(this.model,"change:teamsIds",()=>{let t=!1;this.ids.forEach(e=>{e in this.roleListMap||(t=!0)}),t&&this.loadRoleList(()=>{this.reRender()})})},loadRoleList:function(i,s){if(this.getAcl().checkScope("Team","read")){let t=this.ids||[];0!==t.length&&this.getCollectionFactory().create("Team",e=>{e.maxSize=50,e.where=[{type:"in",field:"id",value:t}],this.listenToOnce(e,"sync",()=>{e.models.forEach(e=>{this.roleListMap[e.id]=e.get("positionList")||[]}),i.call(s)}),e.fetch()})}},getDetailLinkHtml:function(e,t){t=t||this.nameHash[e];var i=(this.columns[e]||{})[this.columnName]||"";let s=$("<div>").append($("<a>").attr("href","#"+this.foreignScope+"/view/"+e).attr("data-id",e).text(t));return i&&(i=this.getHelper().escapeString(i),s.append($("<span>").text(" "),$("<span>").addClass("text-muted chevron-right"),$("<span>").text(" "),$("<span>").addClass("text-muted").text(i))),s.get(0).outerHTML},getJQSelect:function(e,i){let t=Espo.Utils.clone(this.roleListMap[e]||[]);if(!t.length&&!i)return null;t.unshift(""),i&&-1===t.indexOf(i)&&t.push(i);let s=$("<select>").addClass("role form-control input-sm pull-right").attr("data-id",e);return t.forEach(e=>{let t=$("<option>").val(e).text(e);e===(i||"")&&t.attr("selected","selected"),s.append(t)}),s}})}),define("views/user/fields/password",["views/fields/password"],function(i){return i.extend({validations:["required","strength","confirm"],setup:function(){i.prototype.setup.call(this)},init:function(){var e=[],t=(this.strengthParams=this.options.strengthParams||{passwordStrengthLength:this.getConfig().get("passwordStrengthLength"),passwordStrengthLetterCount:this.getConfig().get("passwordStrengthLetterCount"),passwordStrengthNumberCount:this.getConfig().get("passwordStrengthNumberCount"),passwordStrengthBothCases:this.getConfig().get("passwordStrengthBothCases")},this.strengthParams.passwordStrengthLength),t=(t&&e.push("* "+this.translate("passwordStrengthLength","messages","User").replace("{length}",t.toString())),this.strengthParams.passwordStrengthLetterCount),t=(t&&e.push("* "+this.translate("passwordStrengthLetterCount","messages","User").replace("{count}",t.toString())),this.strengthParams.passwordStrengthNumberCount);t&&e.push("* "+this.translate("passwordStrengthNumberCount","messages","User").replace("{count}",t.toString())),this.strengthParams.passwordStrengthBothCases&&e.push("* "+this.translate("passwordStrengthBothCases","messages","User")),e.length&&(this.tooltip=!0,this.tooltipText=this.translate("Requirements","labels","User")+":\n"+e.join("\n")),i.prototype.init.call(this)},validateStrength:function(){if(this.model.get(this.name)){var e=this.model.get(this.name),t=this.strengthParams.passwordStrengthLength;if(t)if(e.length<t)return a=this.translate("passwordStrengthLength","messages","User").replace("{length}",t.toString()),this.showValidationMessage(a),!0;t=this.strengthParams.passwordStrengthLetterCount;if(t){var i=0;if(e.split("").forEach(function(e){e.toLowerCase()!==e.toUpperCase()&&i++},this),i<t)return a=this.translate("passwordStrengthLetterCount","messages","User").replace("{count}",t.toString()),this.showValidationMessage(a),!0}t=this.strengthParams.passwordStrengthNumberCount;if(t){var s=0;if(e.split("").forEach(function(e){"0"<=e&&e<="9"&&s++},this),s<t)return a=this.translate("passwordStrengthNumberCount","messages","User").replace("{count}",t.toString()),this.showValidationMessage(a),!0}if(this.strengthParams.passwordStrengthBothCases){var a,n=0,o=(e.split("").forEach(function(e){e.toLowerCase()!==e.toUpperCase()&&e===e.toUpperCase()&&n++},this),0);if(e.split("").forEach(function(e){e.toLowerCase()!==e.toUpperCase()&&e===e.toLowerCase()&&o++},this),!n||!o)return a=this.translate("passwordStrengthBothCases","messages","User"),this.showValidationMessage(a),!0}}}})}),define("views/user/fields/name",["views/fields/person-name"],function(e){return e.extend({listTemplate:"user/fields/name/list-link",listLinkTemplate:"user/fields/name/list-link",data:function(){return _.extend({avatar:this.getAvatarHtml(),frontScope:this.model.isPortal()?"PortalUser":"User",isOwn:this.model.id===this.getUser().id},e.prototype.data.call(this))},getAvatarHtml:function(){return this.getHelper().getAvatarHtml(this.model.id,"small",16,"avatar-link")}})}),define("views/user/fields/generate-password",["views/fields/base"],function(e){return e.extend({templateContent:'<button type="button" class="btn btn-default" data-action="generatePassword">'+"{{translate 'Generate' scope='User'}}</button>",events:{'click [data-action="generatePassword"]':function(){this.actionGeneratePassword()}},setup:function(){e.prototype.setup.call(this),this.listenTo(this.model,"change:password",(e,t,i)=>{i.isGenerated||this.model.set({passwordPreview:""})}),this.strengthParams=this.options.strengthParams||{},this.passwordStrengthLength=this.strengthParams.passwordStrengthLength||this.getConfig().get("passwordStrengthLength"),this.passwordStrengthLetterCount=this.strengthParams.passwordStrengthLetterCount||this.getConfig().get("passwordStrengthLetterCount"),this.passwordStrengthNumberCount=this.strengthParams.passwordStrengthNumberCount||this.getConfig().get("passwordStrengthNumberCount"),this.passwordGenerateLength=this.strengthParams.passwordGenerateLength||this.getConfig().get("passwordGenerateLength"),this.passwordGenerateLetterCount=this.strengthParams.passwordGenerateLetterCount||this.getConfig().get("passwordGenerateLetterCount"),this.passwordGenerateNumberCount=this.strengthParams.passwordGenerateNumberCount||this.getConfig().get("passwordGenerateNumberCount")},fetch:function(){return{}},actionGeneratePassword:function(){var e=this.passwordStrengthLength,t=this.passwordStrengthLetterCount,i=this.passwordStrengthNumberCount,s=this.passwordGenerateLength||10,a=this.passwordGenerateLetterCount||4,n=this.passwordGenerateNumberCount||2,t=void 0===t?a:t,i=void 0===i?n:i,s=((e=void 0===e?s:e)<s&&(e=s),this.generatePassword(e,t=t<a?a:t,i=i<n?n:i,!0));this.model.set({password:s,passwordConfirm:s,passwordPreview:s},{isGenerated:!0})},generatePassword:function(e,t,i,s){var a=["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz","0123456789","ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789","ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz"],n=0,o=0,s=(s&&(o=n=1,2<=t?t-=2:t=0),e-(t+i+n+o));return function(e){for(var t,i,s=e.length;0!==s;)i=Math.floor(Math.random()*s),t=e[--s],e[s]=e[i],e[i]=t;return e}([t,i,s=s<0?0:s,n,o].map(function(e,t){return Array(e).fill(a[t]).map(function(e){return e[Math.floor(Math.random()*e.length)]}).join("")}).concat()).join("")}})}),define("views/user/fields/contact",["views/fields/link"],function(s){return s.extend({select:function(e){s.prototype.select.call(this,e);var t,i={};e.get("accountId")&&((t={})[e.get("accountId")]=e.get("accountName"),i.accountsIds=[e.get("accountId")],i.accountsNames=t),i.firstName=e.get("firstName"),i.lastName=e.get("lastName"),i.salutationName=e.get("salutationName"),i.emailAddress=e.get("emailAddress"),i.emailAddressData=e.get("emailAddressData"),i.phoneNumber=e.get("phoneNumber"),i.phoneNumberData=e.get("phoneNumberData"),this.model.isNew()&&!this.model.get("userName")&&i.emailAddress&&(i.userName=i.emailAddress),this.model.set(i)}})}),define("views/user/fields/avatar",["views/fields/image"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.on("after:inline-save",()=>{this.suspendCache=!0,this.reRender()})},handleUploadingFile:function(t){return new Promise((i,s)=>{let e=new FileReader;e.onload=e=>{this.createView("crop","views/modals/image-crop",{contents:e.target.result}).then(e=>{e.render();let t=!1;this.listenToOnce(e,"crop",e=>{t=!0,setTimeout(()=>{fetch(e).then(e=>e.blob()).then(e=>{i(new File([e],"avatar.jpg",{type:"image/jpeg"}))})},10)}),this.listenToOnce(e,"remove",()=>{t||(setTimeout(()=>this.render(),10),s()),this.clearView("crop")})})},e.readAsDataURL(t)})},getValueForDisplay:function(){if(!this.isReadMode())return"";var e=this.model.get(this.idName),t=this.model.id;let i=this.cacheTimestamp=this.cacheTimestamp||Date.now();this.suspendCache&&(i=Date.now());var s=this.getBasePath()+"?entryPoint=avatar&size="+this.previewSize+"&id="+t+"&t="+i+"&attachmentId="+(e||"false");let a=$("<img>").attr("src",s).css({maxWidth:(this.imageSizes[this.previewSize]||{})[0],maxHeight:(this.imageSizes[this.previewSize]||{})[1]});return this.isDetailMode()||(this.getCache()&&(i=this.getCache().get("app","timestamp")),s=this.getBasePath()+"?entryPoint=avatar&size="+this.previewSize+"&id="+t+"&t="+i,a.attr("width","16").attr("src",s).css("maxWidth","16px")),(e?$("<a>").attr("data-id",e).attr("data-action","showImagePreview").attr("href",this.getBasePath()+"?entryPoint=image&id="+e).append(a):a).get(0).outerHTML}})}),define("views/preferences/fields/auto-follow-entity-type-list",["views/fields/multi-enum"],function(e){return e.extend({setup:function(){this.params.options=Object.keys(this.getMetadata().get("scopes")).filter(e=>this.getMetadata().get("scopes."+e+".entity")&&this.getMetadata().get("scopes."+e+".stream")).sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural"))),e.prototype.setup.call(this)}})}),define("views/template/record/edit",["views/record/edit"],function(e){return e.extend({saveAndContinueEditingAction:!0,setup:function(){var o;e.prototype.setup.call(this),this.model.isNew()||this.setFieldReadOnly("entityType"),this.model.get("entityType")?this.showField("variables"):this.hideField("variables"),this.model.isNew()&&(o={},this.listenTo(this.model,"change:entityType",function(e){var t,i,s,a=this.model.get("entityType");if(!a)return this.model.set("header",""),this.model.set("body",""),this.model.set("footer",""),void this.hideField("variables");if(this.showField("variables"),a in o)return this.model.set("header",o[a].header),this.model.set("body",o[a].body),void this.model.set("footer",o[a].footer);var n=null;this.getMetadata().get(["entityDefs","Template","defaultTemplates",a])?n=a:(a=this.getMetadata().get(["scopes",a,"type"]))&&this.getMetadata().get(["entityDefs","Template","defaultTemplates",a])&&(n=a),n&&(t=this.getMetadata().get(["entityDefs","Template","defaultTemplates",n,"header"]),i=this.getMetadata().get(["entityDefs","Template","defaultTemplates",n,"body"]),s=this.getMetadata().get(["entityDefs","Template","defaultTemplates",n,"footer"])),t=t||null,s=s||null,this.model.set("body",i=i||""),this.model.set("header",t),this.model.set("footer",s)},this),this.listenTo(this.model,"change",function(e,t){t.ui&&(!(this.model.hasChanged("header")||this.model.hasChanged("body")||this.model.hasChanged("footer"))||(t=this.model.get("entityType"))&&(o[t]={header:this.model.get("header"),body:this.model.get("body"),footer:this.model.get("footer")}))},this))}})}),define("views/template/record/detail",["views/record/detail"],function(e){return e.extend({saveAndContinueEditingAction:!0,setup:function(){e.prototype.setup.call(this),this.hideField("variables"),this.on("after:set-edit-mode",function(){this.showField("variables")},this),this.on("after:set-detail-mode",function(){this.hideField("variables")},this)}})}),define("views/template/fields/variables",["views/fields/base","ui/select"],function(e,t){return e.extend({inlineEditDisabled:!0,detailTemplate:"template/fields/variables/detail",editTemplate:"template/fields/variables/edit",data:function(){return{attributeList:this.attributeList,entityType:this.model.get("entityType"),translatedOptions:this.translatedOptions}},events:{'change [data-name="variables"]':function(){var e=this.$el.find('[data-name="variables"]').val(),t=this.$el.find('[data-name="copy"]');""!==e?this.textVariables[e]?t.val("{{{"+e+"}}}"):t.val("{{"+e+"}}"):t.val("")}},setup:function(){this.setupAttributeList(),this.setupTranslatedOptions(),this.listenTo(this.model,"change:entityType",()=>{this.setupAttributeList(),this.setupTranslatedOptions(),this.reRender()})},setupAttributeList:function(){this.translatedOptions={};var o=this.model.get("entityType"),e=this.getFieldManager().getEntityTypeFieldList(o),s=[],e=(e.forEach(e=>{var t=this.getMetadata().get(["entityAcl",o,"fields",e])||{},i=this.getMetadata().get(["entityDefs",o,"fields",e])||{};(t.onlyAdmin||t.forbidden||t.internal||i.disabled||i.utility||i.directAccessDisabled||i.templatePlaceholderDisabled)&&s.push(e)}),this.getFieldManager().getEntityTypeAttributeList(o)||[]),t=Espo.Utils.clone(this.getAcl().getScopeForbiddenAttributeList(o)),l=(s.forEach(e=>{this.getFieldManager().getEntityTypeFieldAttributeList(o,e).forEach(function(e){t.push(e)})}),(e=e.filter(e=>{if(!~t.indexOf(e)&&"map"!==this.getMetadata().get(["entityDefs",o,"fields",e,"type"]))return!0})).push("id"),"personName"===this.getMetadata().get("entityDefs."+o+".fields.name.type")&&(~e.indexOf("name")||e.unshift("name")),this.addAdditionalPlaceholders(o,e),e=e.sort((e,t)=>this.translate(e,"fields",o).localeCompare(this.translate(t,"fields",o))),this.attributeList=e,this.textVariables={},this.attributeList.forEach(e=>{~["text","wysiwyg"].indexOf(this.getMetadata().get(["entityDefs",o,"fields",e,"type"]))&&(this.textVariables[e]=!0)}),~this.attributeList.indexOf("now")||this.attributeList.unshift("now"),~this.attributeList.indexOf("today")||this.attributeList.unshift("today"),e.unshift("pagebreak"),this.attributeList.unshift(""),this.getMetadata().get("entityDefs."+o+".links")||{});return Object.keys(l).sort((e,t)=>this.translate(e,"links",o).localeCompare(this.translate(t,"links",o))).forEach(i=>{var s,a,e,t,n;"belongsTo"!==l[i].type||(s=l[i].entity)&&(l[i].disabled||l[i].utility||this.getMetadata().get(["entityAcl",o,"links",i,"onlyAdmin"])||this.getMetadata().get(["entityAcl",o,"links",i,"forbidden"])||this.getMetadata().get(["entityAcl",o,"links",i,"internal"])||(e=this.getFieldManager().getEntityTypeFieldList(s),a=[],e.forEach(e=>{var t=this.getMetadata().get(["entityAcl",o,"fields",e])||{},i=this.getMetadata().get(["entityDefs",o,"fields",e])||{};(t.onlyAdmin||t.forbidden||t.internal||i.disabled||i.utility||i.directAccessDisabled||i.templatePlaceholderDisabled)&&a.push(e)}),e=this.getFieldManager().getEntityTypeAttributeList(s)||[],t=Espo.Utils.clone(this.getAcl().getScopeForbiddenAttributeList(s)),a.forEach(e=>{this.getFieldManager().getEntityTypeFieldAttributeList(s,e).forEach(e=>{t.push(e)})}),(e=e.filter(e=>{if(!~t.indexOf(e)&&"map"!==this.getMetadata().get(["entityDefs",s,"fields",e,"type"]))return!0})).push("id"),"personName"===this.getMetadata().get("entityDefs."+s+".fields.name.type")&&e.unshift("name"),n=Espo.Utils.clone(e),this.addAdditionalPlaceholders(s,e,i,o),e.sort((e,t)=>this.translate(e,"fields",s).localeCompare(this.translate(t,"fields",s))),e.forEach(e=>{~n.indexOf(e)?this.attributeList.push(i+"."+e):this.attributeList.push(e)}),e.forEach(e=>{var t=i+"."+e;~["text","wysiwyg"].indexOf(this.getMetadata().get(["entityDefs",s,"fields",e,"type"]))&&(this.textVariables[t]=!0)})))}),this.attributeList},addAdditionalPlaceholders:function(e,t,i,s){function a(e,t){for(var i=0;i<e.length;i++)e[i]===t&&e.splice(i,1)}var n,o=this.getMetadata().get(["entityDefs",e,"fields"])||{};for(n in o){var l,r=o[n].type,d=n;i&&(d=i+"."+d),Espo.Utils.clone(t);"image"===r?(a(t,n+"Name"),a(t,n+"Id"),t.push(l="imageTag "+d+"Id"),this.translatedOptions[l]=this.translate(n,"fields",e),i&&(this.translatedOptions[l]=this.translate(i,"links",s)+"."+this.translatedOptions[l])):"barcode"===r&&(a(t,n),l="barcodeImage "+d+" type='"+this.getMetadata().get(["entityDefs",e,"fields",n,"codeType"])+"'",t.push(l),this.translatedOptions[l]=this.translate(n,"fields",e),i&&(this.translatedOptions[l]=this.translate(i,"links",s)+"."+this.translatedOptions[l]))}},setupTranslatedOptions:function(){var o=this.model.get("entityType");this.attributeList.forEach(e=>{var t,i,s,a,n;!~["today","now","pagebreak"].indexOf(e)||this.getMetadata().get(["entityDefs",o,"fields",e])?(a=o,t=!1,~(i=e).indexOf(".")&&(t=!0,i=e.split(".")[1],s=e.split(".")[0],a=this.getMetadata().get("entityDefs."+o+".links."+s+".entity")),this.translatedOptions[e]||(this.translatedOptions[e]=this.translate(i,"fields",a),i.indexOf("Id")===i.length-2?(n=i.substr(0,i.length-2),this.getMetadata().get(["entityDefs",a,"fields",n])&&(this.translatedOptions[e]=this.translate(n,"fields",a)+" ("+this.translate("id","fields")+")")):i.indexOf("Name")===i.length-4?(n=i.substr(0,i.length-4),this.getMetadata().get(["entityDefs",a,"fields",n])&&(this.translatedOptions[e]=this.translate(n,"fields",a)+" ("+this.translate("name","fields")+")")):i.indexOf("Type")===i.length-4&&(n=i.substr(0,i.length-4),this.getMetadata().get(["entityDefs",a,"fields",n])&&(this.translatedOptions[e]=this.translate(n,"fields",a)+" ("+this.translate("type","fields")+")")),i.indexOf("Ids")===i.length-3?(n=i.substr(0,i.length-3),this.getMetadata().get(["entityDefs",a,"fields",n])&&(this.translatedOptions[e]=this.translate(n,"fields",a)+" ("+this.translate("ids","fields")+")")):i.indexOf("Names")===i.length-5?(n=i.substr(0,i.length-5),this.getMetadata().get(["entityDefs",a,"fields",n])&&(this.translatedOptions[e]=this.translate(n,"fields",a)+" ("+this.translate("names","fields")+")")):i.indexOf("Types")===i.length-5&&(n=i.substr(0,i.length-5),this.getMetadata().get(["entityDefs",a,"fields",n])&&(this.translatedOptions[e]=this.translate(n,"fields",a)+" ("+this.translate("types","fields")+")")),t&&(this.translatedOptions[e]=this.translate(s,"links",o)+"."+this.translatedOptions[e]))):this.translatedOptions[e]=this.getLanguage().translateOption(e,"placeholders","Template")})},afterRender:function(){e.prototype.afterRender.call(this),this.mode===this.MODE_EDIT&&t.init(this.$el.find('[data-name="variables"]'))},fetch:function(){}})}),define("views/template/fields/font-face",["views/fields/enum"],function(e){return e.extend({setupOptions:function(){var e=this.getConfig().get("pdfEngine")||"Tcpdf",e=this.getMetadata().get(["app","pdfEngines",e,"fontFaceList"])||[];(e=Espo.Utils.clone(e)).unshift(""),this.params.options=e}})}),define("views/template/fields/entity-type",["views/fields/entity-type"],function(e){return e.extend({checkAvailability:function(e){e=this.scopesMetadataDefs[e]||{};return!!e.pdfTemplate||(!(!e.entity||!e.object)||void 0)}})}),define("views/template/fields/body",["views/fields/wysiwyg"],function(e){return e.extend({htmlPurificationForEditDisabled:!0})}),define("views/team/record/list",["views/record/list"],function(e){return e.extend({quickDetailDisabled:!0,quickEditDisabled:!0,massActionList:["remove"],checkAllResultDisabled:!0})}),define("views/team/record/edit",["views/record/edit"],function(e){return e.extend({})}),define("views/team/record/detail",["views/record/detail"],function(e){return e.extend({})}),define("views/team/modals/detail",["views/modals/detail"],function(e){return e.extend({editDisabled:!0})}),define("views/site-portal/navbar",["views/site/navbar"],function(e){return e.extend({getLogoSrc:function(){var e=this.getConfig().get("companyLogoId");return e?this.getBasePath()+"?entryPoint=LogoImage&id="+e+"&t="+e:this.getBasePath()+(this.getThemeManager().getParam("logo")||"client/img/logo.svg")},getTabList:function(){var e=this.getConfig().get("tabList")||[],e=Espo.Utils.clone(e||[]);return(this.getThemeManager().getParam("navbarIsVertical")||e.length)&&e.unshift("Home"),e},getQuickCreateList:function(){return this.getConfig().get("quickCreateList")||[]}})}),define("views/site-portal/master",["views/site/master"],function(e){return e.extend({template:"site/master",views:{header:{id:"header",view:"views/site-portal/header"},main:{id:"main",view:!1},footer:{fullSelector:"body > footer",view:"views/site/footer"}},afterRender:function(){e.prototype.afterRender.call(this),this.$el.find("#main").addClass("main-portal")}})}),define("views/site-portal/header",["views/site/header"],function(e){return e.extend({template:"site/header",navbarView:"views/site-portal/navbar",customViewPath:["clientDefs","App","portalNavbarView"]})}),define("views/settings/modals/tab-list-field-add",["exports","views/modals/array-field-add"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setup(){super.setup(),this.options.noGroups||this.buttonList.push({name:"addGroup",text:this.translate("Group Tab","labels","Settings")}),this.buttonList.push({name:"addDivider",text:this.translate("Divider","labels","Settings")})}actionAddGroup(){this.trigger("add",{type:"group",text:this.translate("Group Tab","labels","Settings"),iconClass:null,color:null})}actionAddDivider(){this.trigger("add",{type:"divider",text:null})}}e.default=s}),define("views/settings/modals/edit-tab-group",["views/modal","model"],function(i,s){return i.extend({className:"dialog dialog-record",templateContent:'<div class="record no-side-margin">{{{record}}}</div>',setup:function(){i.prototype.setup.call(this),this.headerText=this.translate("Group Tab","labels","Settings"),this.buttonList.push({name:"apply",label:"Apply",style:"danger"}),this.buttonList.push({name:"cancel",label:"Cancel"}),this.shortcutKeys={"Control+Enter":()=>this.actionApply()};var e=[{rows:[[{name:"text",labelText:this.translate("label","fields","Admin")},{name:"iconClass",labelText:this.translate("iconClass","fields","EntityManager")},{name:"color",labelText:this.translate("color","fields","EntityManager")}],[{name:"itemList",labelText:this.translate("tabList","fields","Settings")},!1]]}],t=this.model=new s;t.name="GroupTab",t.set(this.options.itemData),t.setDefs({fields:{text:{type:"varchar"},iconClass:{type:"base",view:"views/admin/entity-manager/fields/icon-class"},color:{type:"base",view:"views/fields/colorpicker"},itemList:{type:"array",view:"views/settings/fields/group-tab-list"}}}),this.createView("record","views/record/edit-for-modal",{detailLayout:e,model:t,selector:".record"})},actionApply:function(){var e=this.getView("record");e.validate()||(e=e.fetch(),this.trigger("apply",e))}})}),define("views/settings/modals/edit-tab-divider",["exports","views/modal","model"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{className="dialog dialog-record";templateContent='<div class="record no-side-margin">{{{record}}}</div>';setup(){super.setup(),this.headerText=this.translate("Divider","labels","Settings"),this.buttonList.push({name:"apply",label:"Apply",style:"danger"}),this.buttonList.push({name:"cancel",label:"Cancel"}),this.shortcutKeys={"Control+Enter":()=>this.actionApply()};var e=[{rows:[[{name:"text",labelText:this.translate("label","fields","Admin")},!1]]}];let t=this.model=new i.default({},{entityType:"Dummy"});t.set(this.options.itemData),t.setDefs({fields:{text:{type:"varchar"}}}),this.createView("record","views/record/edit-for-modal",{detailLayout:e,model:t,selector:".record"})}actionApply(){let e=this.getView("record");var t;e.validate()||(t=e.fetch(),this.trigger("apply",t))}}e.default=a}),define("views/settings/fields/time-format",["views/fields/enum"],function(e){return e.extend({setupOptions:function(){this.params.options=this.getMetadata().get(["app","dateTime","timeFormatList"])||[]}})}),define("views/settings/fields/thousand-separator",["views/fields/varchar"],function(e){return e.extend({validations:["required","thousandSeparator"],validateThousandSeparator:function(){var e;if(this.model.get("thousandSeparator")===this.model.get("decimalMark"))return e=this.translate("thousandSeparatorEqualsDecimalMark","messages","Admin"),this.showValidationMessage(e),!0},fetch:function(){var e={},t=this.$element.val();return e[this.name]=t||"",e}})}),define("views/settings/fields/stream-email-notifications-entity-list",["views/fields/entity-type-list"],function(e){return e.extend({setupOptions:function(){e.prototype.setupOptions.call(this),this.params.options=this.params.options.filter(function(e){if(!this.getMetadata().get("scopes."+e+".disabled")&&this.getMetadata().get("scopes."+e+".object")&&this.getMetadata().get("scopes."+e+".stream"))return!0},this)}})}),define("views/settings/fields/sms-provider",["views/fields/enum"],function(e){return e.extend({fetchEmptyValueAsNull:!0,setupOptions:function(){this.params.options=Object.keys(this.getMetadata().get(["app","smsProviders"])||{}),this.params.options.unshift("")}})}),define("views/settings/fields/pdf-engine",["views/fields/enum"],function(e){return e.extend({setupOptions:function(){this.params.options=Object.keys(this.getMetadata().get(["app","pdfEngines"])),0===this.params.options.length&&(this.params.options=[""])}})}),define("views/settings/fields/outbound-email-from-address",["exports","views/fields/email-address"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{useAutocompleteUrl=!0;getAutocompleteUrl(e){return"InboundEmail?searchParams="+JSON.stringify({select:["emailAddress"],maxSize:7,where:[{type:"startsWith",attribute:"emailAddress",value:e},{type:"isTrue",attribute:"useSmtp"}]})}transformAutocompleteResult(e){const t=super.transformAutocompleteResult(e);return t.suggestions.forEach(e=>{e.value=e.attributes.emailAddress}),t}}e.default=s}),define("views/settings/fields/oidc-teams",["views/fields/link-multiple-with-role"],function(e){return e.extend({forceRoles:!0,roleType:"varchar",columnName:"group",roleMaxLength:255,setup:function(){e.prototype.setup.call(this),this.rolePlaceholderText=this.translate("IdP Group","labels","Settings")}})}),define("views/settings/fields/oidc-redirect-uri",["views/fields/varchar"],function(e){return e.extend({detailTemplateContent:`
            {{#if isNotEmpty}}
                <a
                    role="button"
                    data-action="copyToClipboard"
                    class="pull-right text-soft"
                    title="{{translate 'Copy to Clipboard'}}"
                ><span class="far fa-copy"></span></a>
                {{value}}
            {{else}}
                <span class="none-value">{{translate 'None'}}</span>
            {{/if}}
        `,portalCollection:null,data:function(){var e="AuthenticationProvider"!==this.model.entityType||this.portalCollection;return{value:this.getValueForDisplay(),isNotEmpty:e}},copyToClipboard:function(){var e=this.getValueForDisplay();navigator.clipboard.writeText(e).then(()=>{Espo.Ui.success(this.translate("Copied to clipboard"))})},getValueForDisplay:function(){return"AuthenticationProvider"===this.model.entityType?this.portalCollection?this.portalCollection.models.map(e=>{return(e.get("url")||"").replace(/\/+$/,"")+"/oauth-callback.php"}).join("\n"):null:(this.getConfig().get("siteUrl")||"").replace(/\/+$/,"")+"/oauth-callback.php"},setup:function(){e.prototype.setup.call(this),"AuthenticationProvider"===this.model.entityType&&this.getCollectionFactory().create("Portal").then(e=>{e.data.select=["url","isDefault"],e.fetch().then(()=>{this.portalCollection=e,this.reRender()})})}})}),define("views/settings/fields/language",["views/fields/enum"],function(e){return e.extend({setupOptions:function(){this.params.options=Espo.Utils.clone(this.getMetadata().get(["app","language","list"])||[]),this.translatedOptions=Espo.Utils.clone(this.getLanguage().translate("language","options")||{})}})}),define("views/settings/fields/history-entity-list",["views/fields/entity-type-list"],function(e){return e.extend({setupOptions:function(){e.prototype.setupOptions.call(this),this.params.options=this.params.options.filter(e=>{if(!this.getMetadata().get("scopes."+e+".disabled")&&this.getMetadata().get("scopes."+e+".object")&&this.getMetadata().get("scopes."+e+".activity"))return!0})}})}),define("views/settings/fields/group-tab-list",["views/settings/fields/tab-list"],function(e){return e.extend({noGroups:!0,noDelimiters:!0})}),define("views/settings/fields/global-search-entity-list",["views/fields/multi-enum"],function(e){return e.extend({setup:function(){this.params.options=Object.keys(this.getMetadata().get("scopes")).filter(e=>{var t=this.getMetadata().get(["scopes",e])||{};if(!t.disabled&&"Note"!==e)return t.customizable&&t.entity}).sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural"))),e.prototype.setup.call(this)}})}),define("views/settings/fields/fiscal-year-shift",["views/fields/enum-int"],function(e){return e.extend({setupOptions:function(){this.params.options=[],this.translatedOptions={},(this.getLanguage().get("Global","lists","monthNames")||[]).forEach((e,t)=>{this.params.options.push(t),this.translatedOptions[t]=e})}})}),define("views/settings/fields/email-address-lookup-entity-type-list",["views/fields/entity-type-list"],function(e){return e.extend({setupOptions:function(){e.prototype.setupOptions.call(this),this.params.options=this.params.options.filter(e=>{if(!this.getMetadata().get(["scopes",e,"disabled"])&&this.getMetadata().get(["scopes",e,"object"])){if(~["User","Contact","Lead","Account"].indexOf(e))return!0;e=this.getMetadata().get(["scopes",e,"type"]);return"Company"===e||"Person"===e||void 0}})}})}),define("views/settings/fields/default-currency",["views/fields/enum"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.validations.push("existing")},setupOptions:function(){this.params.options=Espo.Utils.clone(this.getConfig().get("currencyList")||[])},validateExisting:function(){var e=this.model.get("currencyList");if(e){var t=this.model.get(this.name);if(!~e.indexOf(t))return e=this.translate("fieldInvalid","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0}}})}),define("views/settings/fields/date-format",["views/fields/enum"],function(e){return e.extend({setupOptions:function(){this.params.options=this.getMetadata().get(["app","dateTime","dateFormatList"])||[]}})}),define("views/settings/fields/dashboard-layout",["views/fields/base","lib!gridstack"],function(e,t){return e.extend({detailTemplate:"settings/fields/dashboard-layout/detail",editTemplate:"settings/fields/dashboard-layout/edit",validationElementSelector:'button[data-action="addDashlet"]',WIDTH_MULTIPLIER:3,events:{'click button[data-action="selectTab"]':function(e){e=parseInt($(e.currentTarget).data("tab"));this.selectTab(e)},'click [data-action="removeDashlet"]':function(e){e=$(e.currentTarget).data("id");this.removeDashlet(e)},'click [data-action="editDashlet"]':function(e){var t=$(e.currentTarget).data("id"),e=$(e.currentTarget).data("name");this.editDashlet(t,e)},'click button[data-action="editTabs"]':function(){this.editTabs()},'click button[data-action="addDashlet"]':function(){this.createView("addDashlet","views/modals/add-dashlet",{parentType:this.model.entityType},e=>{e.render(),this.listenToOnce(e,"add",e=>{this.addDashlet(e)})})}},data:function(){return{dashboardLayout:this.dashboardLayout,currentTab:this.currentTab,isEmpty:this.isEmpty()}},hasLocked:function(){return"Preferences"===this.model.entityType},setup:function(){this.dashboardLayout=Espo.Utils.cloneDeep(this.model.get(this.name)||[]),this.dashletsOptions=Espo.Utils.cloneDeep(this.model.get("dashletsOptions")||{}),this.hasLocked()&&(this.dashboardLocked=this.model.get("dashboardLocked")||!1),this.listenTo(this.model,"change",()=>{this.model.hasChanged(this.name)&&(this.dashboardLayout=Espo.Utils.cloneDeep(this.model.get(this.name)||[])),this.model.hasChanged("dashletsOptions")&&(this.dashletsOptions=Espo.Utils.cloneDeep(this.model.get("dashletsOptions")||{})),this.model.hasChanged(this.name)&&this.dashboardLayout.length&&this.isDetailMode()&&this.selectTab(0),this.hasLocked()&&(this.dashboardLocked=this.model.get("dashboardLocked")||!1)}),this.currentTab=-1,this.currentTabLayout=null,this.dashboardLayout.length&&this.selectTab(0)},selectTab:function(e){this.currentTab=e,this.setupCurrentTabLayout(),this.isRendered()&&this.reRender().then(()=>{this.$el.find(`[data-action="selectTab"][data-tab="${e}"]`).focus()})},setupCurrentTabLayout:function(){~this.currentTab||(this.currentTabLayout=null);var e=this.dashboardLayout[this.currentTab].layout||[],e=t.Utils.sort(e);this.currentTabLayout=e},addDashletHtml:function(e,t){e=this.prepareGridstackItem(e,t);this.grid.addWidget(e.get(0),{x:0,y:0,w:2*this.WIDTH_MULTIPLIER,h:2})},generateId:function(){return Math.floor(10000001*Math.random()).toString()},addDashlet:function(e){var t="d"+Math.floor(1000001*Math.random()).toString();~this.currentTab?(this.addDashletHtml(t,e),this.fetchLayout()):(this.dashboardLayout.push({name:"My Espo",layout:[],id:this.generateId()}),this.currentTab=0,this.setupCurrentTabLayout(),this.once("after:render",()=>{setTimeout(()=>{this.addDashletHtml(t,e),this.fetchLayout()},50)}),this.reRender())},removeDashlet:function(i){let e=this.$gridstack.find('.grid-stack-item[data-id="'+i+'"]');this.grid.removeWidget(e.get(0),!0);var s=this.dashboardLayout[this.currentTab].layout;s.forEach((e,t)=>{e.id===i&&s.splice(t,1)}),delete this.dashletsOptions[i],this.setupCurrentTabLayout()},editTabs:function(){let e={dashboardLayout:this.dashboardLayout,tabListIsNotRequired:!0};this.hasLocked()&&(e.dashboardLocked=this.dashboardLocked),this.createView("editTabs","views/modals/edit-dashboard",e,t=>{t.render(),this.listenToOnce(t,"after:save",e=>{t.close();let a=[];e.dashboardTabList.forEach(t=>{var i=[],s=this.generateId();this.dashboardLayout.forEach(e=>{e.name===t&&(i=e.layout,s=e.id)}),t in e.renameMap&&(t=e.renameMap[t]),a.push({name:t,layout:i,id:s})}),this.dashboardLayout=a,this.hasLocked()&&(this.dashboardLocked=e.dashboardLocked),this.selectTab(0),this.deleteNotExistingDashletsOptions()})})},deleteNotExistingDashletsOptions:function(){var t=[];(this.dashboardLayout||[]).forEach(e=>{(e.layout||[]).forEach(e=>{t.push(e.id)})}),Object.keys(this.dashletsOptions).forEach(e=>{~t.indexOf(e)||delete this.dashletsOptions[e]})},editDashlet:function(i,s){var t=this.dashletsOptions[i]||{},t=Espo.Utils.cloneDeep(t),a=this.getMetadata().get(["dashlets",s,"options","defaults"])||{},e=(Object.keys(a).forEach(e=>{e in t||(t[e]=Espo.Utils.cloneDeep(a[e]))}),"title"in t||(t.title=this.translate(s,"dashlets")),this.getMetadata().get(["dashlets",s,"options","view"])||"views/dashlets/options/base");this.createView("options",e,{name:s,optionsData:t,fields:this.getMetadata().get(["dashlets",s,"options","fields"])||{},userId:"Preferences"===this.model.entityType?this.model.id:null},t=>{t.render(),this.listenToOnce(t,"save",e=>{this.dashletsOptions[i]=e,t.close(),"title"in e&&(e=(e=e.title)||this.translate(s,"dashlets"),this.$el.find('[data-id="'+i+'"] .panel-title').text(e))})})},fetchLayout:function(){~this.currentTab&&(this.dashboardLayout[this.currentTab].layout=_.map(this.$gridstack.find(".grid-stack-item"),e=>{var e=$(e),t=e.attr("gs-x"),i=e.attr("gs-y"),s=e.attr("gs-h"),a=e.attr("gs-w");return{id:e.data("id"),name:e.data("name"),x:t/this.WIDTH_MULTIPLIER,y:i,width:a/this.WIDTH_MULTIPLIER,height:s}}),this.setupCurrentTabLayout())},afterRender:function(){var e;this.currentTabLayout&&(e=this.$gridstack=this.$el.find("> .grid-stack"),(this.grid=t.init({minWidth:4,cellHeight:60,margin:10,column:12,resizable:{handles:"se",helper:!1},disableOneColumnMode:!0,animate:!1,staticGrid:"edit"!==this.mode,disableResize:"edit"!==this.mode,disableDrag:"edit"!==this.mode})).removeAll(),this.currentTabLayout.forEach(e=>{var t=this.prepareGridstackItem(e.id,e.name);this.grid.addWidget(t.get(0),{x:e.x*this.WIDTH_MULTIPLIER,y:e.y,w:e.width*this.WIDTH_MULTIPLIER,h:e.height})}),e.find(" .grid-stack-item").css("position","absolute"),e.on("change",(e,t)=>{this.fetchLayout(),this.trigger("change")}))},prepareGridstackItem:function(e,t){let i=$("<div>").addClass("grid-stack-item"),s="",a=(this.isEditMode()&&(s=(s+=$("<div>").addClass("btn-group pull-right").append($("<button>").addClass("btn btn-default").attr("data-action","removeDashlet").attr("data-id",e).attr("title",this.translate("Remove")).append($("<span>").addClass("fas fa-times"))).get(0).outerHTML)+$("<div>").addClass("btn-group pull-right").append($("<button>").addClass("btn btn-default").attr("data-action","editDashlet").attr("data-id",e).attr("data-name",t).attr("title",this.translate("Edit")).append($("<span>").addClass("fas fa-pencil-alt fa-sm").css({position:"relative",top:"-1px"}))).get(0).outerHTML),this.getOption(e,"title"));a=a||this.translate(t,"dashlets");var n=$("<div>").addClass("panel-heading").append(s).append($("<h4>").addClass("panel-title").text(a)).get(0).outerHTML;let o=$("<div>").addClass("grid-stack-item-content panel panel-default").append(n);return o.attr("data-id",e),o.attr("data-name",t),i.attr("data-id",e),i.attr("data-name",t),i.append(o),i},getOption:function(e,t){return((this.model.get("dashletsOptions")||{})[e]||{})[t]},isEmpty:function(){var t=!0;return this.dashboardLayout&&this.dashboardLayout.length&&this.dashboardLayout.forEach(e=>{e.layout&&e.layout.length&&(t=!1)}),t},validateRequired:function(){var e;if(this.isRequired())return this.isEmpty()?(e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0):void 0},fetch:function(){let e={};return this.dashboardLayout&&this.dashboardLayout.length?(e[this.name]=Espo.Utils.cloneDeep(this.dashboardLayout),e.dashletsOptions=Espo.Utils.cloneDeep(this.dashletsOptions),this.hasLocked()&&(e.dashboardLocked=this.dashboardLocked)):(e[this.name]=null,e.dashletsOptions={}),e}})}),define("views/settings/fields/currency-rates",["views/fields/base"],function(e){return e.extend({editTemplate:"settings/fields/currency-rates/edit",data:function(){var t=this.model.get("baseCurrency"),i=this.model.get("currencyRates")||{},s={};return(this.model.get("currencyList")||[]).forEach(e=>{e!==t&&(s[e]=i[e],s[e]||(i[t]&&(s[e]=Math.round(1/i[t]*1e3)/1e3),s[e]||(s[e]=1)))}),{rateValues:s,baseCurrency:t}},setup:function(){},fetch:function(){var e,t={},i={},s=this.model.get("baseCurrency"),a=this.model.get("currencyList")||[];for(e in a.forEach(e=>{e!==s&&(i[e]=parseFloat(this.$el.find('input[data-currency="'+e+'"]').val()||1))}),delete i[s],i)~a.indexOf(e)||delete i[e];return t[this.name]=i,t}})}),define("views/settings/fields/currency-list",["views/fields/multi-enum"],function(e){return e.extend({matchAnyWord:!0,setupOptions:function(){this.params.options=this.getMetadata().get(["app","currency","list"])||[],this.translatedOptions={},this.params.options.forEach(e=>{var t=e,i=this.getLanguage().get("Currency","names",e);i&&(t+=" - "+i),this.translatedOptions[e]=t})}})}),define("views/settings/fields/calendar-entity-list",["views/fields/entity-type-list"],function(e){return e.extend({setupOptions:function(){e.prototype.setupOptions.call(this),this.params.options=this.params.options.filter(e=>{if(!this.getMetadata().get("scopes."+e+".disabled")&&this.getMetadata().get("scopes."+e+".object")&&this.getMetadata().get("scopes."+e+".calendar"))return!0})}})}),define("views/settings/fields/busy-ranges-entity-list",["views/fields/entity-type-list"],function(e){return e.extend({setupOptions:function(){e.prototype.setupOptions.call(this),this.params.options=this.params.options.filter(e=>{if(!this.getMetadata().get(["scopes",e,"disabled"])&&this.getMetadata().get(["scopes",e,"object"])&&this.getMetadata().get(["scopes",e,"calendar"]))return!0})}})}),define("views/settings/fields/authentication-method",["views/fields/enum"],function(e){return e.extend({setupOptions:function(){this.params.options=[];var e,t=this.getMetadata().get(["authenticationMethods"])||{};for(e in t)t[e].settings&&t[e].settings.isAvailable&&this.params.options.push(e)}})}),define("views/settings/fields/auth-two-fa-method-list",["views/fields/multi-enum"],function(e){return e.extend({setupOptions:function(){this.params.options=[];var e,t=this.getMetadata().get(["app","authentication2FAMethods"])||{};for(e in t)t[e].settings&&t[e].settings.isAvailable&&this.params.options.push(e)}})}),define("views/settings/fields/assignment-notifications-entity-list",["views/fields/multi-enum"],function(e){return e.extend({setup:function(){this.params.options=Object.keys(this.getMetadata().get("scopes")).filter(e=>{if(!this.getMetadata().get("scopes."+e+".disabled")&&(!this.getMetadata().get(["scopes",e,"stream"])||this.getMetadata().get(["entityDefs",e,"fields","assignedUsers"])))return this.getMetadata().get("scopes."+e+".notifications")&&this.getMetadata().get("scopes."+e+".entity")}).sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural"))),e.prototype.setup.call(this)}})}),define("views/settings/fields/assignment-email-notifications-entity-list",["views/fields/multi-enum"],function(e){return e.extend({setup:function(){this.params.options=Object.keys(this.getMetadata().get("scopes")).filter(e=>{if("Email"!==e&&!this.getMetadata().get("scopes."+e+".disabled"))return this.getMetadata().get("scopes."+e+".notifications")&&this.getMetadata().get("scopes."+e+".entity")}).sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural"))),e.prototype.setup.call(this)}})}),define("views/settings/fields/address-preview",["views/fields/address"],function(i){return i.extend({setup:function(){i.prototype.setup.call(this);var e=this.model,t=e.clone();t.entityType=e.entityType,t.name=e.name,t.set({addressPreviewStreet:"Street",addressPreviewPostalCode:"PostalCode",addressPreviewCity:"City",addressPreviewState:"State",addressPreviewCountry:"Country"}),this.listenTo(e,"change:addressFormat",()=>{t.set("addressFormat",e.get("addressFormat")),this.reRender()}),this.model=t},getAddressFormat:function(){return this.model.get("addressFormat")||1}})}),define("views/settings/fields/activities-entity-list",["views/fields/entity-type-list"],function(e){return e.extend({setupOptions:function(){e.prototype.setupOptions.call(this),this.params.options=this.params.options.filter(e=>{if("Email"!==e&&!this.getMetadata().get("scopes."+e+".disabled")&&this.getMetadata().get("scopes."+e+".object")&&this.getMetadata().get("scopes."+e+".activity"))return!0})}})}),define("views/preferences/edit",["views/edit"],function(e){return e.extend({userName:"",setup:function(){e.prototype.setup.call(this),this.userName=this.model.get("name")},getHeader:function(){return this.buildHeaderHtml([$("<span>").text(this.translate("Preferences")),$("<span>").text(this.userName)])}})}),define("views/preferences/record/edit",["views/record/edit"],function(t){return t.extend({sideView:null,saveAndContinueEditingAction:!1,buttonList:[{name:"save",label:"Save",style:"primary"},{name:"cancel",label:"Cancel"}],dynamicLogicDefs:{fields:{tabList:{visible:{conditionGroup:[{type:"isTrue",attribute:"useCustomTabList"}]}}}},setup:function(){t.prototype.setup.call(this),this.addDropdownItem({name:"reset",text:this.getLanguage().translate("Reset to Default","labels","Admin"),style:"danger"});~this.getAcl().getScopeForbiddenFieldList("Preferences","edit").indexOf("dashboardLayout")||this.model.isPortal()||this.addDropdownItem({name:"resetDashboard",text:this.getLanguage().translate("Reset Dashboard to Default","labels","Preferences")}),this.model.isPortal()&&(this.layoutName="detailPortal"),this.model.id===this.getUser().id&&this.on("after:save",()=>{let e=this.model.getClonedAttributes();delete e.smtpPassword,this.getPreferences().set(e),this.getPreferences().trigger("update")}),this.getUser().isAdmin()&&!this.model.isPortal()||this.hideField("dashboardLayout"),this.controlFollowCreatedEntityListVisibility(),this.listenTo(this.model,"change:followCreatedEntities",this.controlFollowCreatedEntityListVisibility),this.controlColorsField(),this.listenTo(this.model,"change:scopeColorsDisabled",this.controlColorsField,this);var e=!0;!this.getConfig().get("assignmentEmailNotifications")||this.model.isPortal()?(this.hideField("receiveAssignmentEmailNotifications"),this.hideField("assignmentEmailNotificationsIgnoreEntityTypeList")):(e=!1,this.controlAssignmentEmailNotificationsVisibility(),this.listenTo(this.model,"change:receiveAssignmentEmailNotifications",()=>{this.controlAssignmentEmailNotificationsVisibility()})),0===(this.getConfig().get("assignmentEmailNotificationsEntityList")||[]).length&&this.hideField("assignmentEmailNotificationsIgnoreEntityTypeList"),0===(this.getConfig().get("assignmentNotificationsEntityList")||[]).length||this.model.isPortal()?this.hideField("assignmentNotificationsIgnoreEntityTypeList"):e=!1,this.getConfig().get("emailForceUseExternalClient")&&this.hideField("emailUseExternalClient"),!this.getConfig().get("mentionEmailNotifications")||this.model.isPortal()?this.hideField("receiveMentionEmailNotifications"):e=!1,!this.getConfig().get("streamEmailNotifications")&&!this.model.isPortal()||!this.getConfig().get("portalStreamEmailNotifications")&&this.model.isPortal()?this.hideField("receiveStreamEmailNotifications"):e=!1,this.getConfig().get("scopeColorsDisabled")&&(this.hideField("scopeColorsDisabled"),this.hideField("tabColorsDisabled")),this.getConfig().get("tabColorsDisabled")&&this.hideField("tabColorsDisabled"),e&&this.hidePanel("notifications"),this.getConfig().get("userThemesDisabled")&&this.hideField("theme"),this.on("save",e=>{this.model.get("language")===e.language&&this.model.get("theme")===e.theme&&(this.model.get("themeParams")||{}).navbar===(e.themeParams||{}).navbar||(this.setConfirmLeaveOut(!1),window.location.reload())})},controlFollowCreatedEntityListVisibility:function(){this.model.get("followCreatedEntities")?this.hideField("followCreatedEntityTypeList"):this.showField("followCreatedEntityTypeList")},controlColorsField:function(){this.model.get("scopeColorsDisabled")?this.hideField("tabColorsDisabled"):this.showField("tabColorsDisabled")},controlAssignmentEmailNotificationsVisibility:function(){this.model.get("receiveAssignmentEmailNotifications")?this.showField("assignmentEmailNotificationsIgnoreEntityTypeList"):this.hideField("assignmentEmailNotificationsIgnoreEntityTypeList")},actionReset:function(){this.confirm(this.translate("resetPreferencesConfirmation","messages"),()=>{Espo.Ajax.deleteRequest("Preferences/"+this.model.id).then(()=>{for(var e in Espo.Ui.success(this.translate("resetPreferencesDone","messages")),this.model.set(data),data)this.setInitialAttributeValue(e,data[e]);this.getPreferences().set(this.model.getClonedAttributes()),this.getPreferences().trigger("update"),this.setIsNotChanged()})})},actionResetDashboard:function(){this.confirm(this.translate("confirmation","messages"),()=>{Espo.Ajax.postRequest("Preferences/action/resetDashboard",{id:this.model.id}).then(e=>{for(var t in Espo.Ui.success(this.translate("Done")),this.model.set(e),e)this.setInitialAttributeValue(t,e[t]);this.getPreferences().set(this.model.getClonedAttributes()),this.getPreferences().trigger("update")})})},afterRender:function(){t.prototype.afterRender.call(this)},exit:function(e){"cancel"===e&&(e="#User/view/"+this.model.id,this.getAcl().checkModel(this.getUser())||(e="#"),this.getRouter().navigate(e,{trigger:!0}))}})}),define("views/preferences/fields/week-start",["views/fields/enum-int"],function(e){return e.extend({setupOptions:function(){this.params.options=Espo.Utils.clone(this.params.options),this.params.options.unshift(-1),this.translatedOptions={};var e=this.getLanguage().get("Global","lists","dayNames")||[],t=(e.forEach((e,t)=>{this.translatedOptions[t]=e}),this.getConfig().get("weekStart"));this.translatedOptions[-1]=this.translate("Default")+" ("+e[t]+")"}})}),define("views/preferences/fields/time-zone",["views/fields/enum"],function(e){return e.extend({setupOptions:function(){this.params.options=Espo.Utils.clone(this.getHelper().getAppParam("timeZoneList"))||[],this.params.options.unshift(""),this.translatedOptions=this.translatedOptions||{},this.translatedOptions[""]=this.translate("Default")+" ("+this.getConfig().get("timeZone")+")"}})}),define("views/preferences/fields/time-format",["views/fields/enum"],function(e){return e.extend({setupOptions:function(){this.params.options=Espo.Utils.clone(this.getMetadata().get(["app","dateTime","timeFormatList"])||[]),this.params.options.unshift(""),this.translatedOptions=this.translatedOptions||{},this.translatedOptions[""]=this.translate("Default")+" ("+this.getConfig().get("timeFormat")+")"}})}),define("views/preferences/fields/theme",["views/settings/fields/theme"],function(t){return t.extend({setupOptions:function(){this.params.options=Object.keys(this.getMetadata().get("themes")||{}).sort((e,t)=>"EspoRtl"===t?-1:this.translate(e,"themes").localeCompare(this.translate(t,"themes"))),this.params.options.unshift("")},setupTranslation:function(){t.prototype.setupTranslation.call(this),this.translatedOptions=this.translatedOptions||{};var e=this.getConfig().get("theme"),e=this.translatedOptions[e]||e;this.translatedOptions[""]=this.translate("Default")+" ("+e+")"},afterRenderDetail:function(){var e=this.getNavbarValue()||this.getDefaultNavbar();e&&this.$el.append(" ").append($("<span>").addClass("text-muted chevron-right")).append(" ").append($("<span>").text(this.translate(e,"themeNavbars")))}})}),define("views/preferences/fields/tab-list",["views/settings/fields/tab-list"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.params.options=this.params.options.filter(e=>{if("_delimiter_"===e||"Home"===e)return!0;var t=this.getMetadata().get(["scopes",e]);if(t&&!t.disabled)return t.acl?this.getAcl().check(e):!t.tabAclPermission||(e=this.getAcl().get(t.tabAclPermission))&&"no"!==e})}})}),define("views/preferences/fields/signature",["views/fields/wysiwyg"],function(e){return e.extend({fetchEmptyValueAsNull:!0,toolbar:[["style",["bold","italic","underline","clear"]],["color",["color"]],["height",["height"]],["table",["espoLink"]],["misc",["codeview","fullscreen"]]]})}),define("views/preferences/fields/language",["views/fields/enum"],function(e){return e.extend({setupOptions:function(){this.params.options=Espo.Utils.clone(this.getMetadata().get(["app","language","list"])||[]).sort((e,t)=>this.getLanguage().translateOption(e,"language").localeCompare(this.getLanguage().translateOption(t,"language"))),this.params.options.unshift(""),this.translatedOptions=Espo.Utils.clone(this.getLanguage().translate("language","options")||{});var e=this.translatedOptions[this.getConfig().get("language")]||this.getConfig().get("language");this.translatedOptions[""]=this.translate("Default")+" ("+e+")"}})}),define("views/preferences/fields/default-currency",["views/fields/enum"],function(e){return e.extend({setupOptions:function(){this.params.options=Espo.Utils.clone(this.getConfig().get("currencyList")||[]),this.params.options.unshift(""),this.translatedOptions=this.translatedOptions||{},this.translatedOptions[""]=this.translate("Default")+" ("+this.getConfig().get("defaultCurrency")+")"}})}),define("views/preferences/fields/date-format",["views/fields/enum"],function(e){return e.extend({setupOptions:function(){this.params.options=Espo.Utils.clone(this.getMetadata().get(["app","dateTime","dateFormatList"])||[]),this.params.options.unshift(""),this.translatedOptions=this.translatedOptions||{},this.translatedOptions[""]=this.translate("Default")+" ("+this.getConfig().get("dateFormat")+")"}})}),define("views/preferences/fields/dashboard-tab-list",["views/fields/array"],function(t){return t.extend({maxItemLength:36,setup:function(){t.prototype.setup.call(this),this.translatedOptions={};let e=this.model.get(this.name)||[];e.forEach(e=>{this.translatedOptions[e]=e}),this.validations.push("uniqueLabel")},getItemHtml:function(e){e=e.toString();var t=this.translatedOptions[e]||e;return $("<div>").addClass("list-group-item link-with-role form-inline").attr("data-value",e).append($("<div>").addClass("pull-left").css("width","92%").css("display","inline-block").append($("<input>").attr("maxLength",this.maxItemLength).attr("data-name","translatedValue").attr("data-value",e).addClass("role form-control input-sm").attr("value",t).css("width","65%"))).append($("<div>").css("width","8%").css("display","inline-block").css("vertical-align","top").append($("<a>").attr("role","button").attr("tabindex","0").addClass("pull-right").attr("data-value",e).attr("data-action","removeValue").append($("<span>").addClass("fas fa-times")))).append($("<br>").css("clear","both")).get(0).outerHTML},validateUniqueLabel:function(){var e,t=this.model.get(this.name)||[],i=this.model.get("translatedOptions")||{};let s=[];for(e of t){var a=i[e];if(!a)return!0;if(-1!==s.indexOf(a))return!0;s.push(a)}return!1},fetch:function(){let i=t.prototype.fetch.call(this);return i.translatedOptions={},(i[this.name]||[]).forEach(e=>{var t=e.replace(/"/g,'\\"');i.translatedOptions[e]=this.$el.find('input[data-name="translatedValue"][data-value="'+t+'"]').val()||e}),i}})}),define("views/preferences/fields/auto-follow-entity-type-list",["views/fields/multi-enum"],function(e){return e.extend({setup:function(){this.params.options=Object.keys(this.getMetadata().get("scopes")).filter(e=>{if(!this.getMetadata().get("scopes."+e+".disabled"))return this.getMetadata().get("scopes."+e+".entity")&&this.getMetadata().get("scopes."+e+".stream")}).sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural"))),e.prototype.setup.call(this)}})}),define("views/preferences/fields/assignment-notifications-ignore-entity-type-list",["views/fields/checklist"],function(e){return e.extend({isInversed:!0,setupOptions:function(){this.params.options=Espo.Utils.clone(this.getConfig().get("assignmentNotificationsEntityList"))||[]}})}),define("views/preferences/fields/assignment-email-notifications-ignore-entity-type-list",["views/fields/checklist"],function(e){return e.extend({isInversed:!0,setupOptions:function(){this.params.options=Espo.Utils.clone(this.getConfig().get("assignmentEmailNotificationsEntityList"))||[]}})}),define("views/portal-user/list",["views/list"],function(e){return e.extend({defaultOrderBy:"createdAt",defaultOrder:"desc",setup:function(){e.prototype.setup.call(this)},actionCreate:function(){this.createView("modal","crm:views/contact/modals/select-for-portal-user",{scope:"Contact",primaryFilterName:"notPortalUsers",createButton:!1,mandatorySelectAttributeList:["salutationName","firstName","lastName","accountName","accountId","emailAddress","emailAddressData","phoneNumber","phoneNumberData"]},e=>{e.render(),this.listenToOnce(e,"select",e=>{var t={},i=(t.contactId=e.id,t.contactName=e.get("name"),e.get("accountId")&&((i={})[e.get("accountId")]=e.get("accountName"),t.accountsIds=[e.get("accountId")],t.accountsNames=i),t.firstName=e.get("firstName"),t.lastName=e.get("lastName"),t.salutationName=e.get("salutationName"),t.emailAddress=e.get("emailAddress"),t.emailAddressData=e.get("emailAddressData"),t.phoneNumber=e.get("phoneNumber"),t.phoneNumberData=e.get("phoneNumberData"),t.userName=t.emailAddress,t.type="portal",this.getRouter()),e="#"+this.scope+"/create";i.dispatch(this.scope,"create",{attributes:t}),i.navigate(e,{trigger:!1})}),this.listenToOnce(e,"skip",()=>{var e=this.getRouter(),t="#"+this.scope+"/create";e.dispatch(this.scope,"create",{attributes:{type:"portal"}}),e.navigate(t,{trigger:!1})})})}})}),define("views/portal/record/list",["views/record/list"],function(e){return e.extend({massActionList:["remove"]})}),define("views/portal/fields/tab-list",["views/settings/fields/tab-list"],function(e){return e.extend({noGroups:!0,setupOptions:function(){e.prototype.setupOptions.call(this),this.params.options=this.params.options.filter(e=>"_delimiter_"===e||(!!this.getMetadata().get("scopes."+e+".aclPortal")||void 0))}})}),define("views/portal/fields/quick-create-list",["views/settings/fields/quick-create-list"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.params.options=this.params.options.filter(e=>{if(this.getMetadata().get("scopes."+e+".aclPortal"))return!0})}})}),define("views/portal/fields/custom-id",["views/fields/varchar"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.listenTo(this,"change",()=>{var e=this.model.get("customId");e&&""!==e&&(e=e.replace(/ /i,"-").toLowerCase(),e=encodeURIComponent(e),this.model.set("customId",e))})}})}),define("views/personal-data/record/record",["views/record/base"],function(i){return i.extend({template:"personal-data/record/record",additionalEvents:{"click .checkbox":function(e){var t=$(e.currentTarget).data("name");e.currentTarget.checked?(~this.checkedFieldList.indexOf(t)||this.checkedFieldList.push(t),this.checkedFieldList.length===this.fieldList.length?this.$el.find(".checkbox-all").prop("checked",!0):this.$el.find(".checkbox-all").prop("checked",!1)):(~(e=this.checkedFieldList.indexOf(t))&&this.checkedFieldList.splice(e,1),this.$el.find(".checkbox-all").prop("checked",!1)),this.trigger("check",this.checkedFieldList)},"click .checkbox-all":function(e){e.currentTarget.checked?(this.checkedFieldList=Espo.Utils.clone(this.fieldList),this.$el.find(".checkbox").prop("checked",!0)):(this.checkedFieldList=[],this.$el.find(".checkbox").prop("checked",!1)),this.trigger("check",this.checkedFieldList)}},data:function(){var e={};return e.fieldDataList=this.getFieldDataList(),e.scope=this.scope,e.editAccess=this.editAccess,e},setup:function(){i.prototype.setup.call(this),this.events={...this.additionalEvents,...this.events},this.scope=this.model.entityType,this.fieldList=[],this.checkedFieldList=[],this.editAccess=this.getAcl().check(this.model,"edit");var e,s=this.getMetadata().get(["entityDefs",this.scope,"fields"])||{},t=[];for(e in s)s[e].isPersonalData&&t.push(e);t.forEach(e=>{var t=s[e].type,t=this.getFieldManager().getActualAttributeList(t,e),i=!1,t=(t.forEach(e=>{e=this.model.get(e);e&&("[object Array]"===Object.prototype.toString.call(e)&&e.length||(i=!0))}),!~this.getAcl().getScopeForbiddenFieldList(this.scope,"view").indexOf(e));i&&t&&this.fieldList.push(e)}),this.fieldList=this.fieldList.sort((e,t)=>this.translate(e,"fields",this.scope).localeCompare(this.translate(t,"fields",this.scope))),this.fieldList.forEach(e=>{this.createField(e,null,null,"detail",!0)})},getFieldDataList:function(){var t=this.getAcl().getScopeForbiddenFieldList(this.scope,"edit"),i=[];return this.fieldList.forEach(e=>{i.push({name:e,key:e+"Field",editAccess:this.editAccess&&!~t.indexOf(e)})}),i}})}),define("views/personal-data/modals/personal-data",["views/modal"],function(e){return e.extend({className:"dialog dialog-record",template:"personal-data/modals/personal-data",backdrop:!0,setup:function(){e.prototype.setup.call(this),this.buttonList=[{name:"cancel",label:"Close"}],this.headerText=this.getLanguage().translate("Personal Data"),this.headerText+=": "+this.model.get("name"),this.getAcl().check(this.model,"edit")&&this.buttonList.unshift({name:"erase",label:"Erase",style:"danger",disabled:!0}),this.fieldList=[],this.scope=this.model.entityType,this.createView("record","views/personal-data/record/record",{selector:".record",model:this.model},e=>{this.listenTo(e,"check",e=>{(this.fieldList=e).length?this.enableButton("erase"):this.disableButton("erase")}),e.fieldList.length||this.disableButton("export")})},actionErase:function(){this.confirm({message:this.translate("erasePersonalDataConfirmation","messages"),confirmText:this.translate("Erase")},()=>{this.disableButton("erase"),Espo.Ajax.postRequest("DataPrivacy/action/erase",{fieldList:this.fieldList,entityType:this.scope,id:this.model.id}).then(()=>{Espo.Ui.success(this.translate("Done")),this.trigger("erase")}).catch(()=>{this.enableButton("erase")})})}})}),define("views/outbound-email/modals/test-send",["views/modal"],function(e){return e.extend({cssName:"test-send",templateContent:`
            <label class="control-label">{{translate 'Email Address' scope='Email'}}</label>
            <input type="text" name="emailAddress" value="{{emailAddress}}" class="form-control">
        `,data:function(){return{emailAddress:this.options.emailAddress}},setup:function(){this.buttonList=[{name:"send",text:this.translate("Send","labels","Email"),style:"primary",onClick:()=>{var e=this.$el.find("input").val();""!==e&&this.trigger("send",e)}},{name:"cancel",label:"Cancel",onClick:e=>{e.close()}}]}})}),define("views/notification/record/list",["exports","views/record/list-expanded"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setup(){super.setup(),this.listenTo(this.collection,"sync",(e,t,i)=>{if(i.fetchNew){i=i.lengthBeforeFetch||0;if(0!==i){let t=this.$el.find(this.listContainerEl);for(let e=this.collection.length-i-1;0<=e;e--){var s=this.collection.at(e);t.prepend($(this.getRowContainerHtml(s.id))),this.buildRow(e,s,e=>{e.render()})}}else this.reRender()}}),this.events["auxclick a[href][data-scope][data-id]"]=t=>{if(1===t.button&&(t.ctrlKey||t.metaKey)){let e=$(t.currentTarget);var i=e.attr("data-id"),s=e.attr("data-scope");t.preventDefault(),t.stopPropagation(),this.actionQuickView({id:i,scope:s})}}}showNewRecords(){this.collection.fetchNew()}}e.default=s}),define("views/notification/items/system",["exports","views/notification/items/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="notification/items/system";data(){return{...super.data(),message:this.model.get("message")}}setup(){var e=this.model.get("data")||{};this.userId=e.userId}}e.default=s}),define("views/notification/items/message",["exports","views/notification/items/base","marked","dompurify"],function(e,t,i,s){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),s=a(s);class n extends t.default{template="notification/items/message";data(){return{...super.data(),style:this.style}}setup(){var e=this.model.get("data")||{},t=this.model.get("message")||e.message||"",t=i.marked.parse(t);this.messageTemplate=s.default.sanitize(t,{}).toString(),this.userId=e.userId,this.style=e.style||"text-muted",this.messageData.entityType=this.translateEntityType(e.entityType),this.messageData.user=$("<a>").attr("href","#User/view/"+e.userId).attr("data-id",e.userId).attr("data-scope","User").text(e.userName),this.messageData.entity=$("<a>").attr("href","#"+e.entityType+"/view/"+e.entityId).attr("data-id",e.entityId).attr("data-scope",e.entityType).text(e.entityName),this.createMessage()}}e.default=n}),define("views/notification/items/entity-removed",["exports","views/notification/items/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{messageName="entityRemoved";template="notification/items/entity-removed";setup(){var e=this.model.get("data")||{};this.userId=e.userId,this.messageData.entityType=this.translateEntityType(e.entityType),this.messageData.user=$("<a>").attr("href","#User/view/"+e.userId).attr("data-id",e.userId).attr("data-scope","User").text(e.userName),this.messageData.entity=$("<a>").attr("href","#"+e.entityType+"/view/"+e.entityId).attr("data-id",e.entityId).attr("data-scope",e.entityType).text(e.entityName),this.createMessage()}}e.default=s}),define("views/notification/items/email-received",["exports","views/notification/items/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{messageName="emailReceived";template="notification/items/email-received";data(){return{...super.data(),emailId:this.emailId,emailName:this.emailName}}setup(){var e,t=this.model.get("data")||{};this.userId=t.userId,this.messageData.entityType=this.translateEntityType(t.entityType),t.personEntityId?this.messageData.from=$("<a>").attr("href","#"+t.personEntityType+"/view/"+t.personEntityId).attr("data-id",t.personEntityId).attr("data-scope",t.personEntityType).text(t.personEntityName):(e=t.fromString||this.translate("empty address"),this.messageData.from=$("<span>").text(e)),this.emailId=t.emailId,this.emailName=t.emailName,this.createMessage()}}e.default=s}),define("views/notification/items/assign",["exports","views/notification/items/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{messageName="assign";template="notification/items/assign";setup(){var e=this.model.get("data")||{};this.userId=e.userId,this.messageData.entityType=this.translateEntityType(e.entityType),this.messageData.entity=$("<a>").attr("href","#"+e.entityType+"/view/"+e.entityId).attr("data-id",e.entityId).attr("data-scope",e.entityType).text(e.entityName),this.messageData.user=$("<a>").attr("href","#User/view/"+e.userId).attr("data-id",e.userId).attr("data-scope","User").text(e.userName),this.createMessage()}}e.default=s}),define("views/notification/fields/read",["exports","views/fields/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="read";listTemplate="notification/fields/read";detailTemplate="notification/fields/read";data(){return{isRead:this.model.get("read")}}}e.default=s}),define("views/notification/fields/read-with-menu",["exports","views/fields/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="read";listTemplate="notification/fields/read-with-menu";detailTemplate="notification/fields/read-with-menu";data(){return{isRead:this.model.get("read")}}}e.default=s}),define("views/notification/fields/container",["exports","views/fields/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="notification";listTemplate="notification/fields/container";detailTemplate="notification/fields/container";setup(){switch(this.model.get("type")){case"Note":this.processNote(this.model.get("noteData"));break;case"MentionInPost":this.processMentionInPost(this.model.get("noteData"));break;default:this.process()}}process(){let e=this.model.get("type");var t;e&&(e=e.replace(/ /g,""),t=this.getMetadata().get("clientDefs.Notification.itemViews."+e)||"views/notification/items/"+Espo.Utils.camelCaseToHyphen(e),this.createView("notification",t,{model:this.model,fullSelector:this.options.containerSelector+' li[data-id="'+this.model.id+'"]'}))}processNote(i){i&&(this.wait(!0),this.getModelFactory().create("Note",e=>{e.set(i);var t=this.getMetadata().get("clientDefs.Note.itemViews."+i.type)||"views/stream/notes/"+Espo.Utils.camelCaseToHyphen(i.type);this.createView("notification",t,{model:e,isUserStream:!0,fullSelector:this.options.containerSelector+' li[data-id="'+this.model.id+'"]',onlyContent:!0,isNotification:!0}),this.wait(!1)}))}processMentionInPost(t){t&&(this.wait(!0),this.getModelFactory().create("Note",e=>{e.set(t);this.createView("notification","views/stream/notes/mention-in-post",{model:e,userId:this.model.get("userId"),isUserStream:!0,fullSelector:this.options.containerSelector+' li[data-id="'+this.model.id+'"]',onlyContent:!0,isNotification:!0}),this.wait(!1)}))}}e.default=s}),define("views/last-viewed/list",["views/list"],function(e){return e.extend({searchPanel:!1,createButton:!1,setup:function(){e.prototype.setup.call(this),this.collection.url="LastViewed"}})}),define("views/last-viewed/record/list",["views/record/list"],function(e){return e.extend({layoutName:"listForLastViewed",rowActionsDisabled:!0,massActionsDisabled:!0,headerDisabled:!0})}),define("views/import-error/fields/validation-failures",["views/fields/base"],t=>t.extend({detailTemplateContent:`
            {{#if itemList.length}}
            <table class="table">
                <thead>
                    <tr>
                        <th style="width: 50%;">{{translate 'Field'}}</th>
                        <th>{{translateOption 'Validation' scope='ImportError' field='type'}}</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each itemList}}
                    <tr>
                        <td>{{translate field category='fields' scope=entityType}}</td>
                        <td>
                            {{translate type category='fieldValidations'}}
                            {{#if popoverText}}
                            <a
                                role="button"
                                tabindex="-1"
                                class="text-muted popover-anchor"
                                data-text="{{popoverText}}"
                            ><span class="fas fa-info-circle"></span></a>
                            {{/if}}
                        </td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
            {{else}}
            <span class="none-value">{{translate 'None'}}</span>
            {{/if}}
        `,data:function(){let e=t.prototype.data.call(this);return e.itemList=this.getDataList(),e},afterRenderDetail:function(){this.$el.find(".popover-anchor").each((e,t)=>{var i=this.getHelper().transformMarkdownText(t.dataset.text).toString();Espo.Ui.popover($(t),{content:i},this)})},getDataList:function(){let e=Espo.Utils.cloneDeep(this.model.get(this.name))||[],a=this.model.get("entityType");return Array.isArray(e)&&e.forEach(e=>{let t=this.getFieldManager(),i=this.getLanguage();var s=t.getEntityTypeFieldParam(a,e.field,"type");s&&(s=s+"_"+e.type,i.has(s,"fieldValidationExplanations","Global")&&(e.popoverText=i.translate(s,"fieldValidationExplanations")))}),e}})),define("views/import-error/fields/line-number",["views/fields/int"],t=>t.extend({disableFormatting:!0,data:function(){let e=t.prototype.data.call(this);return e.valueIsSet=this.model.has(this.sourceName),e.isNotEmpty=this.model.has(this.sourceName),e},setup:function(){t.prototype.setup.call(this),this.sourceName="exportLineNumber"===this.name?"exportRowIndex":"rowIndex"},getAttributeList:function(){return[this.sourceName]},getValueForDisplay:function(){var e=this.model.get(this.sourceName);return this.formatNumber(++e)}})),define("views/import/step2",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="import/step-2";allowedFieldList=["createdAt","createdBy"];events={'click button[data-action="back"]':function(){this.back()},'click button[data-action="next"]':function(){this.next()},'click a[data-action="addField"]':function(e){e=$(e.currentTarget).data("name");this.addField(e)},'click a[data-action="removeField"]':function(e){var e=$(e.currentTarget).data("name"),t=(this.$el.find('a[data-action="addField"]').parent().removeClass("hidden"),this.additionalFields.indexOf(e));~t&&this.additionalFields.splice(t,1),this.$el.find('.field[data-name="'+e+'"]').parent().remove()}};data(){return{scope:this.scope,fieldList:this.getFieldList()}}setup(){this.formData=this.options.formData,this.scope=this.formData.entityType;let s=[];if(this.additionalFields=[],this.formData.previewArray){let e=0;this.formData.headerRow&&(e=1),this.formData.previewArray.length>e&&this.formData.previewArray[e].forEach((e,t)=>{let i={value:e};this.formData.headerRow&&(i.name=this.formData.previewArray[0][t]),s.push(i)})}this.wait(!0),this.getModelFactory().create(this.scope,e=>{this.model=e,this.formData.defaultValues&&this.model.set(this.formData.defaultValues),this.wait(!1)}),this.mapping=s}afterRender(){let e=$("#mapping-container");var t,i=$("<table>").addClass("table").addClass("table-bordered").css("table-layout","fixed");let a=$("<tbody>").appendTo(i),n=$("<tr>"),o=(this.formData.headerRow&&(t=$("<th>").attr("width","25%").text(this.translate("Header Row Value","labels","Import")),n.append(t)),$("<th>").attr("width","25%").text(this.translate("Field","labels","Import")));n.append(o),o=$("<th>").text(this.translate("First Row Value","labels","Import")),n.append(o),~["update","createAndUpdate"].indexOf(this.formData.action)&&(o=$("<th>").text(this.translate("Update by","labels","Import")),n.append(o)),a.append(n),this.mapping.forEach((t,i)=>{n=$("<tr>"),this.formData.headerRow&&(o=$("<td>").text(t.name),n.append(o));let e=t.name;this.formData.attributeList&&(e=this.formData.attributeList[i]||null);var s=this.getFieldDropdown(i,e),s=(o=$("<td>").append(s),n.append(o),t.value||"");if(200<s.length&&(s=s.substring(0,200)+"..."),o=$("<td>").css("overflow","hidden").text(s),n.append(o),~["update","createAndUpdate"].indexOf(this.formData.action)){let e=$("<input>").attr("type","checkbox").attr("id","update-by-"+i.toString());this.formData.updateBy?~this.formData.updateBy.indexOf(i)&&e.attr("checked",!0):"id"===t.name&&e.attr("checked",!0),o=$("<td>").append(e),n.append(o)}a.append(n)}),e.empty(),e.append(i),this.formData.defaultFieldList&&this.formData.defaultFieldList.forEach(e=>{this.addField(e)})}getFieldList(){var e,t,i=this.getMetadata().get("entityDefs."+this.scope+".fields");let s=this.getAcl().getScopeForbiddenFieldList(this.scope,"edit"),a=[];for(e in i)~s.indexOf(e)||(t=i[e],!~this.allowedFieldList.indexOf(e)&&(t.disabled||t.importDisabled)||a.push(e));return a=a.sort((e,t)=>this.translate(e,"fields",this.scope).localeCompare(this.translate(t,"fields",this.scope)))}getAttributeList(){var e,i=this.getMetadata().get(["entityDefs",this.scope,"fields"])||{};let s=this.getAcl().getScopeForbiddenFieldList(this.scope,"edit"),a=[];a.push("id");for(let t in i)~s.indexOf(t)||(e=i[t],!~this.allowedFieldList.indexOf(t)&&(e.disabled&&!e.importNotDisabled||e.importDisabled)||("phone"!==e.type?("email"===e.type&&(a.push(t+"2"),a.push(t+"3"),a.push(t+"4")),"link"===e.type&&(a.push(t+"Name"),a.push(t+"Id")),~["foreign"].indexOf(e.type)||("personName"===e.type&&a.push(t),e=e.type,(e=(e=this.getFieldManager().getActualAttributeList(e,t)).length?e:[t]).forEach(e=>{-1===a.indexOf(e)&&a.push(e)}))):(a.push(t),(this.getMetadata().get("entityDefs."+this.scope+".fields."+t+".typeList")||[]).map(e=>e.replace(/\s/g,"_")).forEach(e=>{a.push(t+Espo.Utils.upperCaseFirst(e))}))));return a=a.sort((e,t)=>this.translate(e,"fields",this.scope).localeCompare(this.translate(t,"fields",this.scope)))}getFieldDropdown(e,s){s=s||!1;let t=this.getAttributeList(),a=$("<select>").addClass("form-control").attr("id","column-"+e.toString()),n=$("<option>").val("").text("-"+this.translate("Skip","labels","Import")+"-"),o=this.formData.entityType;return a.append(n),t.forEach(t=>{let i="";if(this.getLanguage().has(t,"fields",o)||this.getLanguage().has(t,"fields","Global"))i=this.translate(t,"fields",o);else if(t.indexOf("Id")===t.length-2){var e=t.substr(0,t.length-2);this.getMetadata().get(["entityDefs",o,"fields",e])&&(i=this.translate(e,"fields",o)+" ("+this.translate("id","fields")+")")}else if(t.indexOf("Name")===t.length-4){e=t.substr(0,t.length-4);this.getMetadata().get(["entityDefs",o,"fields",e])&&(i=this.translate(e,"fields",o)+" ("+this.translate("name","fields")+")")}else if(t.indexOf("Type")===t.length-4){e=t.substr(0,t.length-4);this.getMetadata().get(["entityDefs",o,"fields",e])&&(i=this.translate(e,"fields",o)+" ("+this.translate("type","fields")+")")}else if(0===t.indexOf("phoneNumber")){e=t.substr(11),e=this.getLanguage().translateOption(e,"phoneNumber",o);i=this.translate("phoneNumber","fields",o)+" ("+e+")"}else if(0===t.indexOf("emailAddress")&&parseInt(t.substr(12)).toString()===t.substr(12)){let e=t.substr(12);i=this.translate("emailAddress","fields",o)+" "+e.toString()}else t.indexOf("Ids")===t.length-3&&(e=t.substr(0,t.length-3),this.getMetadata().get(["entityDefs",o,"fields",e])&&(i=this.translate(e,"fields",o)+" ("+this.translate("ids","fields")+")"));i=i||t,n=$("<option>").val(t).text(i),!s||t!==s&&s.toLowerCase().replace("_","")!==t.toLowerCase()||n.prop("selected",!0),a.append(n)}),a}addField(t){this.$el.find('[data-action="addField"][data-name="'+t+'"]').parent().addClass("hidden"),$(this.containerSelector+' button[data-name="update"]').removeClass("disabled"),Espo.Ui.notify(" ... ");var e=this.translate(t,"fields",this.scope),e=this.getHelper().escapeString(e),e='<div class="cell form-group">'+('<a role="button" class="pull-right" data-action="removeField" data-name="'+t+'"><span class="fas fa-times"></span></a>')+'<label class="control-label">'+e+'</label><div class="field" data-name="'+t+'"/></div>',e=($("#default-values-container").append(e),Espo.Utils.upperCaseFirst(this.model.getFieldParam(t,"type"))),e=this.getMetadata().get(["entityDefs",this.scope,"fields",t,"view"])||this.getFieldManager().getViewName(e);this.createView(t,e,{model:this.model,fullSelector:this.getSelector()+' .field[data-name="'+t+'"]',defs:{name:t},mode:"edit",readOnlyDisabled:!0},e=>{this.additionalFields.push(t),e.render(),e.notify(!1)})}disableButtons(){this.$el.find('button[data-action="next"]').addClass("disabled").attr("disabled","disabled"),this.$el.find('button[data-action="back"]').addClass("disabled").attr("disabled","disabled")}enableButtons(){this.$el.find('button[data-action="next"]').removeClass("disabled").removeAttr("disabled"),this.$el.find('button[data-action="back"]').removeClass("disabled").removeAttr("disabled")}getFieldView(e){return this.getView(e)}fetch(e){let i={},s=(this.additionalFields.forEach(e=>{const t=this.getFieldView(e);_.extend(i,t.fetch())}),this.model.set(i),!1);if(this.additionalFields.forEach(e=>{let t=this.getFieldView(e);s=t.validate()||s}),s||(this.formData.defaultValues=i),s&&!e)return!1;this.formData.defaultFieldList=Espo.Utils.clone(this.additionalFields);var a=[];if(this.mapping.forEach((e,t)=>{a.push($("#column-"+t).val())}),this.formData.attributeList=a,~["update","createAndUpdate"].indexOf(this.formData.action)){let i=[];this.mapping.forEach((e,t)=>{$("#update-by-"+t).get(0).checked&&i.push(t)}),this.formData.updateBy=i}return this.getParentIndexView().formData=this.formData,this.getParentIndexView().trigger("change"),!0}getParentIndexView(){return this.getParentView()}back(){this.fetch(!0),this.getParentIndexView().changeStep(1)}next(){this.fetch()&&(this.disableButtons(),Espo.Ui.notify(" ... "),Espo.Ajax.postRequest("Import/file",null,{timeout:0,contentType:"text/csv",data:this.getParentIndexView().fileContents}).then(e=>{e.attachmentId?this.runImport(e.attachmentId):Espo.Ui.error(this.translate("Bad response"))}))}runImport(e){this.formData.attachmentId=e,this.getRouter().confirmLeaveOut=!1,Espo.Ui.notify(this.translate("importRunning","messages","Import")),Espo.Ajax.postRequest("Import",this.formData,{timeout:0}).then(e=>{const t=e.id;return this.getParentIndexView().trigger("done"),t?(this.formData.manualMode?this.createView("dialog","views/modal",{templateContent:"{{complexText viewObject.options.msg}}",headerText:" ",backdrop:"static",msg:this.translate("commandToRun","strings","Import")+":\n\n```php command.php import --id="+t+"```",buttonList:[{name:"close",label:this.translate("Close")}]},e=>{e.render(),this.listenToOnce(e,"close",()=>{this.getRouter().navigate("#Import/view/"+t,{trigger:!0})})}):this.getRouter().navigate("#Import/view/"+t,{trigger:!0}),void Espo.Ui.notify(!1)):(Espo.Ui.error(this.translate("Error"),!0),void this.enableButtons())}).catch(()=>this.enableButtons())}}e.default=s}),define("views/import/step1",["exports","view","model"],function(e,t,c){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),c=i(c);class s extends t.default{template="import/step-1";events={"change #import-file":function(e){e=e.currentTarget.files;e.length&&this.loadFile(e[0])},'click button[data-action="next"]':function(){this.next()},'click button[data-action="saveAsDefault"]':function(){this.saveAsDefault()}};getEntityList(){let e=[];var t,i=this.getMetadata().get("scopes");for(t in i)i[t].importable&&this.getAcl().checkScope(t,"create")&&e.push(t);return e.sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural"))),e}data(){return{entityList:this.getEntityList()}}setup(){this.attributeList=["entityType","action"],this.paramList=["headerRow","decimalMark","personNameFormat","delimiter","dateFormat","timeFormat","currency","timezone","textQualifier","silentMode","idleMode","skipDuplicateChecking","manualMode"],this.paramList.forEach(e=>{this.attributeList.push(e)}),this.formData=this.options.formData||{entityType:this.options.entityType||null,create:"create",headerRow:!0,delimiter:",",textQualifier:'"',dateFormat:"YYYY-MM-DD",timeFormat:"HH:mm:ss",currency:this.getConfig().get("defaultCurrency"),timezone:"UTC",decimalMark:".",personNameFormat:"f l",idleMode:!1,skipDuplicateChecking:!1,silentMode:!0,manualMode:!1};var e=Espo.Utils.cloneDeep((this.getPreferences().get("importParams")||{}).default||{});if(!this.options.formData)for(var t in e)this.formData[t]=e[t];let i=this.model=new c.default,s=(this.attributeList.forEach(e=>{i.set(e,this.formData[e])}),this.attributeList.forEach(s=>{this.listenTo(i,"change:"+s,(e,t,i)=>{i.ui&&(this.formData[s]=this.model.get(s),this.preview())})}),["f l","l f","l, f"]),a=this.getConfig().get("personNameFormat")||"firstLast",n=(~a.toString().toLowerCase().indexOf("middle")&&(s.push("f m l"),s.push("l f m")),this.getDateFormatDataList()),h=this.getTimeFormatDataList(),o=[],l={},r=(n.forEach(e=>{o.push(e.key),l[e.key]=e.label}),[]),d={};h.forEach(e=>{r.push(e.key),d[e.key]=e.label}),this.createView("actionField","views/fields/enum",{selector:'.field[data-name="action"]',model:this.model,name:"action",mode:"edit",params:{options:["create","createAndUpdate","update"],translatedOptions:{create:this.translate("Create Only","labels","Admin"),createAndUpdate:this.translate("Create and Update","labels","Admin"),update:this.translate("Update Only","labels","Admin")}}}),this.createView("entityTypeField","views/fields/enum",{selector:'.field[data-name="entityType"]',model:this.model,name:"entityType",mode:"edit",params:{options:[""].concat(this.getEntityList()),translation:"Global.scopeNamesPlural",required:!0},labelText:this.translate("Entity Type","labels","Import")}),this.createView("decimalMarkField","views/fields/varchar",{selector:'.field[data-name="decimalMark"]',model:this.model,name:"decimalMark",mode:"edit",params:{options:[".",","],maxLength:1,required:!0},labelText:this.translate("Decimal Mark","labels","Import")}),this.createView("personNameFormatField","views/fields/enum",{selector:'.field[data-name="personNameFormat"]',model:this.model,name:"personNameFormat",mode:"edit",params:{options:s,translation:"Import.options.personNameFormat"}}),this.createView("delimiterField","views/fields/enum",{selector:'.field[data-name="delimiter"]',model:this.model,name:"delimiter",mode:"edit",params:{options:[",",";","\\t","|"]}}),this.createView("textQualifierField","views/fields/enum",{selector:'.field[data-name="textQualifier"]',model:this.model,name:"textQualifier",mode:"edit",params:{options:['"',"'"],translatedOptions:{'"':this.translate("Double Quote","labels","Import"),"'":this.translate("Single Quote","labels","Import")}}}),this.createView("dateFormatField","views/fields/enum",{selector:'.field[data-name="dateFormat"]',model:this.model,name:"dateFormat",mode:"edit",params:{options:o,translatedOptions:l}}),this.createView("timeFormatField","views/fields/enum",{selector:'.field[data-name="timeFormat"]',model:this.model,name:"timeFormat",mode:"edit",params:{options:r,translatedOptions:d}}),this.createView("currencyField","views/fields/enum",{selector:'.field[data-name="currency"]',model:this.model,name:"currency",mode:"edit",params:{options:this.getConfig().get("currencyList")}}),this.createView("timezoneField","views/fields/enum",{selector:'.field[data-name="timezone"]',model:this.model,name:"timezone",mode:"edit",params:{options:this.getMetadata().get(["entityDefs","Settings","fields","timeZone","options"])}}),this.createView("headerRowField","views/fields/bool",{selector:'.field[data-name="headerRow"]',model:this.model,name:"headerRow",mode:"edit"}),this.createView("silentModeField","views/fields/bool",{selector:'.field[data-name="silentMode"]',model:this.model,name:"silentMode",mode:"edit",tooltip:!0,tooltipText:this.translate("silentMode","tooltips","Import")}),this.createView("idleModeField","views/fields/bool",{selector:'.field[data-name="idleMode"]',model:this.model,name:"idleMode",mode:"edit"}),this.createView("skipDuplicateCheckingField","views/fields/bool",{selector:'.field[data-name="skipDuplicateChecking"]',model:this.model,name:"skipDuplicateChecking",mode:"edit"}),this.createView("manualModeField","views/fields/bool",{selector:'.field[data-name="manualMode"]',model:this.model,name:"manualMode",mode:"edit",tooltip:!0,tooltipText:this.translate("manualMode","tooltips","Import")}),this.listenTo(this.model,"change",(i,e)=>{if(e.ui){let t=!1;this.paramList.forEach(e=>{i.hasChanged(e)&&(t=!0)}),t&&this.showSaveAsDefaultButton()}}),this.listenTo(this.model,"change",()=>{this.isRendered()&&this.controlFieldVisibility()}),this.listenTo(this.model,"change:entityType",()=>{delete this.formData.defaultFieldList,delete this.formData.defaultValues,delete this.formData.attributeList,delete this.formData.updateBy}),this.listenTo(this.model,"change:action",()=>{delete this.formData.updateBy}),this.listenTo(this.model,"change",(e,t)=>{t.ui&&(this.getRouter().confirmLeaveOut=!0)})}afterRender(){this.setupFormData(),this.getParentIndexView()&&this.getParentIndexView().fileContents&&(this.setFileIsLoaded(),this.preview()),this.controlFieldVisibility()}getParentIndexView(){return this.getParentView()}showSaveAsDefaultButton(){this.$el.find('[data-action="saveAsDefault"]').removeClass("hidden")}hideSaveAsDefaultButton(){this.$el.find('[data-action="saveAsDefault"]').addClass("hidden")}getFieldView(e){return this.getView(e+"Field")}next(){this.attributeList.forEach(e=>{this.getFieldView(e).fetchToModel(),this.formData[e]=this.model.get(e)});let t=!1;this.attributeList.forEach(e=>{t|=this.getFieldView(e).validate()}),t?Espo.Ui.error(this.translate("Not valid")):(this.getParentIndexView().formData=this.formData,this.getParentIndexView().trigger("change"),this.getParentIndexView().changeStep(2))}setupFormData(){this.attributeList.forEach(e=>{this.model.set(e,this.formData[e])})}loadFile(t){var e=t.slice(0,16384);let i=new FileReader,s=(i.onloadend=e=>{e.target.readyState===FileReader.DONE&&(this.formData.previewString=e.target.result,this.preview())},i.readAsText(e),new FileReader);s.onloadend=e=>{e.target.readyState===FileReader.DONE&&(this.getParentIndexView().fileContents=e.target.result,this.setFileIsLoaded(),this.getRouter().confirmLeaveOut=!0,this.setFileName(t.name))},s.readAsText(t)}setFileName(e){this.$el.find(".import-file-name").text(e),this.$el.find(".import-file-info").text("")}setFileIsLoaded(){this.$el.find('button[data-action="next"]').removeClass("hidden")}preview(){if(this.formData.previewString){let e=this.csvToArray(this.formData.previewString,this.formData.delimiter,this.formData.textQualifier);this.formData.previewArray=e;var s=$("<table>").addClass("table").addClass("table-bordered");let i=$("<tbody>").appendTo(s),t=(e.forEach((e,t)=>{if(!(3<=t)){let t=$("<tr>");e.forEach(e=>{e=$("<td>").html(this.getHelper().sanitizeHtml(e));t.append(e)}),i.append(t)}}),$("#import-preview"));t.empty().append(s)}}csvToArray(e,t,i){i=i||'"',t=(t=t||",").replace(/\\t/,"\t");let s=new RegExp("(\\"+t+"|\\r?\\n|\\r|^)(?:"+i+"([^"+i+"]*(?:"+i+i+"[^"+i+"]*)*)"+i+"|([^"+i+"\\"+t+"\\r\\n]*))","gi"),a=[[]],n=null;for(;n=s.exec(e);){var o=n[1];let e;o.length&&o!==t&&a.push([]),e=n[2]?n[2].replace(new RegExp('""',"g"),'"'):n[3],a[a.length-1].push(e)}return a}saveAsDefault(){let e=this.getPreferences(),t=Espo.Utils.cloneDeep(e.get("importParams")||{}),i={};this.paramList.forEach(e=>{i[e]=this.model.get(e)}),t.default=i,e.save({importParams:t}).then(()=>{Espo.Ui.success(this.translate("Saved"))}),this.hideSaveAsDefaultButton()}controlFieldVisibility(){this.model.get("idleMode")?this.hideField("manualMode"):this.showField("manualMode"),this.model.get("manualMode")?this.hideField("idleMode"):this.showField("idleMode")}hideField(e){this.$el.find('.field[data-name="'+e+'"]').parent().addClass("hidden-cell")}showField(e){this.$el.find('.field[data-name="'+e+'"]').parent().removeClass("hidden-cell")}convertFormatToLabel(e){var t,i={YYYY:"2021",DD:"27",MM:"12",HH:"23",mm:"00",hh:"11",ss:"00",a:"pm",A:"PM"};let s=e;for(t in i){var a=i[t];s=s.replace(new RegExp(t,"g"),a)}return e+" - "+s}getDateFormatDataList(){let e=this.getMetadata().get(["clientDefs","Import","dateFormatList"])||[];return e.map(e=>({key:e,label:this.convertFormatToLabel(e)}))}getTimeFormatDataList(){let e=this.getMetadata().get(["clientDefs","Import","timeFormatList"])||[];return e.map(e=>({key:e,label:this.convertFormatToLabel(e)}))}}e.default=s}),define("views/import/list",["exports","views/list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{createButton=!1;setup(){super.setup(),this.menu.buttons.unshift({iconHtml:'<span class="fas fa-plus fa-sm"></span>',text:this.translate("New Import","labels","Import"),link:"#Import",acl:"edit"})}}e.default=s}),define("views/import/index",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="import/index";formData=null;fileContents=null;data(){return{fromAdmin:this.options.fromAdmin}}setup(){this.entityType=this.options.entityType||null,this.startFromStep=1,(this.options.formData||this.options.fileContents)&&(this.formData=this.options.formData||{},this.fileContents=this.options.fileContents||null,this.entityType=this.formData.entityType||null,this.options.step&&(this.startFromStep=this.options.step))}changeStep(e,t){1<(this.step=e)&&this.setConfirmLeaveOut(!0),this.createView("step","views/import/step"+e.toString(),{selector:"> .import-container",entityType:this.entityType,formData:this.formData,result:t},e=>{e.render()});e="#Import";this.options.fromAdmin&&(e="#Admin/import"),1<this.step&&(e+="/index/step="+this.step),this.getRouter().navigate(e,{trigger:!1})}afterRender(){this.changeStep(this.startFromStep)}updatePageTitle(){this.setPageTitle(this.getLanguage().translate("Import","labels","Admin"))}setConfirmLeaveOut(e){this.getRouter().confirmLeaveOut=e}}e.default=s}),define("views/import/detail",["exports","views/detail"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getHeader(){var e=this.getDateTime().toDisplay(this.model.get("createdAt"));return this.buildHeaderHtml([$("<a>").attr("href","#"+this.model.entityType+"/list").text(this.getLanguage().translate(this.model.entityType,"scopeNamesPlural")),$("<span>").text(e)])}setup(){super.setup(),this.setupMenu(),this.listenTo(this.model,"change",()=>{this.setupMenu(),this.isRendered()&&this.getView("header").reRender()}),this.listenTo(this.model,"sync",e=>{this.controlButtons(e)})}setupMenu(){this.addMenuItem("buttons",{label:"Remove Import Log",action:"removeImportLog",name:"removeImportLog",style:"default",acl:"delete",title:this.translate("removeImportLog","messages","Import")},!0),this.addMenuItem("buttons",{label:"Revert Import",name:"revert",action:"revert",style:"danger",acl:"edit",title:this.translate("revert","messages","Import"),hidden:!this.model.get("importedCount")},!0),this.addMenuItem("buttons",{label:"Remove Duplicates",name:"removeDuplicates",action:"removeDuplicates",style:"default",acl:"edit",title:this.translate("removeDuplicates","messages","Import"),hidden:!this.model.get("duplicateCount")},!0),this.addMenuItem("dropdown",{label:"New import with same params",name:"createWithSameParams",action:"createWithSameParams"})}controlButtons(e){e&&!e.hasChanged("importedCount")||(this.model.get("importedCount")?this.showHeaderActionItem("revert"):this.hideHeaderActionItem("revert")),e&&!e.hasChanged("duplicateCount")||(this.model.get("duplicateCount")?this.showHeaderActionItem("removeDuplicates"):this.hideHeaderActionItem("removeDuplicates"))}actionRemoveImportLog(){this.confirm(this.translate("confirmRemoveImportLog","messages","Import"),()=>{this.disableMenuItem("removeImportLog"),Espo.Ui.notify(this.translate("pleaseWait","messages")),this.model.destroy({wait:!0}).then(()=>{Espo.Ui.notify(!1);var e=this.model.collection;e&&0<e.total&&e.total--,this.getRouter().navigate("#Import/list",{trigger:!0}),this.removeMenuItem("removeImportLog",!0)})})}actionRevert(){this.confirm(this.translate("confirmRevert","messages","Import"),()=>{this.disableMenuItem("revert"),Espo.Ui.notify(this.translate("pleaseWait","messages")),Espo.Ajax.postRequest(`Import/${this.model.id}/revert`).then(()=>{this.getRouter().navigate("#Import/list",{trigger:!0})})})}actionRemoveDuplicates(){this.confirm(this.translate("confirmRemoveDuplicates","messages","Import"),()=>{this.disableMenuItem("removeDuplicates"),Espo.Ui.notify(this.translate("pleaseWait","messages")),Espo.Ajax.postRequest(`Import/${this.model.id}/removeDuplicates`).then(()=>{this.removeMenuItem("removeDuplicates",!0),this.model.fetch(),this.model.trigger("update-all"),Espo.Ui.success(this.translate("duplicatesRemoved","messages","Import"))})})}actionCreateWithSameParams(){let e=this.model.get("params")||{};e.entityType=this.model.get("entityType"),e.attributeList=this.model.get("attributeList")||[],e=Espo.Utils.cloneDeep(e),this.getRouter().navigate("#Import",{trigger:!1}),this.getRouter().dispatch("Import","index",{formData:e})}}e.default=s}),define("views/import/record/list",["exports","views/record/list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{quickDetailDisabled=!0;quickEditDisabled=!0;checkAllResultDisabled=!0;massActionList=["remove"];rowActionsView="views/record/row-actions/remove-only"}e.default=s}),define("views/import/record/detail",["exports","views/record/detail"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{readOnly=!0;returnUrl="#Import/list";checkInterval=5;resultPanelFetchLimit=10;duplicateAction=!1;setup(){super.setup(),this.fetchCounter=0,this.setupChecking(),this.hideActionItem("delete")}setupChecking(){this.model.has("status")?~["In Process","Pending","Standby"].indexOf(this.model.get("status"))&&(setTimeout(this.runChecking.bind(this),1e3*this.checkInterval),this.on("remove",()=>{this.stopChecking=!0})):this.listenToOnce(this.model,"sync",this.setupChecking.bind(this))}runChecking(){this.stopChecking||(this.model.fetch().then(()=>{var e=!~["In Process","Pending","Standby"].indexOf(this.model.get("status"));this.fetchCounter<this.resultPanelFetchLimit&&!e&&this.fetchResultPanels(),e?this.fetchResultPanels():setTimeout(this.runChecking.bind(this),1e3*this.checkInterval)}),this.fetchCounter++)}fetchResultPanels(){const e=this.getView("bottom");if(e){const t=e.getView("imported"),i=(t&&t.collection&&t.collection.fetch(),e.getView("duplicates")),s=(i&&i.collection&&i.collection.fetch(),e.getView("updated"));s&&s.collection&&s.collection.fetch()}}}e.default=s}),define("views/import/record/row-actions/duplicates",["exports","views/record/row-actions/default"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){const e=super.getActionList();return e.push({action:"unmarkAsDuplicate",label:"Set as Not Duplicate",data:{id:this.model.id,type:this.model.entityType}}),e}}e.default=s}),define("views/import/record/panels/updated",["exports","views/import/record/panels/imported"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{link="updated";rowActionsView="views/record/row-actions/relationship-view-and-edit";setup(){this.title=this.title||this.translate("Updated","labels","Import"),super.setup()}}e.default=s}),define("views/import/record/panels/duplicates",["exports","views/import/record/panels/imported"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{link="duplicates";setup(){this.title=this.title||this.translate("Duplicates","labels","Import"),super.setup()}actionUnmarkAsDuplicate(e){const t=e.id,i=e.type;this.confirm(this.translate("confirmation","messages"),()=>{Espo.Ajax.postRequest(`Import/${this.model.id}/unmarkDuplicates`,{entityId:t,entityType:i}).then(()=>{this.collection.fetch()})})}}e.default=s}),define("views/group-email-folder/record/list",["views/record/list"],function(e){return e.extend({rowActionsView:"views/email-folder/record/row-actions/default",actionMoveUp:function(e){e=this.collection.get(e.id);e&&0!==this.collection.indexOf(e)&&Espo.Ajax.postRequest("GroupEmailFolder/action/moveUp",{id:e.id}).then(()=>{this.collection.fetch()})},actionMoveDown:function(e){e=this.collection.get(e.id);e&&(this.collection.indexOf(e)===this.collection.length-1&&this.collection.length===this.collection.total||Espo.Ajax.postRequest("GroupEmailFolder/action/moveDown",{id:e.id}).then(()=>{this.collection.fetch()}))}})}),define("views/email-folder/record/row-actions/default",["views/record/row-actions/default"],function(t){return t.extend({setup:function(){t.prototype.setup.call(this)},getActionList:function(){var e=t.prototype.getActionList.call(this);return this.options.acl.edit&&(e.unshift({action:"moveDown",label:"Move Down",data:{id:this.model.id}}),e.unshift({action:"moveUp",label:"Move Up",data:{id:this.model.id}})),e}})}),define("views/external-account/oauth2",["view","model"],function(e,t){return e.extend({template:"external-account/oauth2",data:function(){return{integration:this.integration,helpText:this.helpText,isConnected:this.isConnected}},isConnected:!1,events:{'click button[data-action="cancel"]':function(){this.getRouter().navigate("#ExternalAccount",{trigger:!0})},'click button[data-action="save"]':function(){this.save()},'click [data-action="connect"]':function(){this.connect()}},setup:function(){this.integration=this.options.integration,this.id=this.options.id,this.helpText=!1,this.getLanguage().has(this.integration,"help","ExternalAccount")&&(this.helpText=this.translate(this.integration,"help","ExternalAccount")),this.fieldList=[],this.dataFieldList=[],this.model=new t,this.model.id=this.id,this.model.entityType=this.model.name="ExternalAccount",this.model.urlRoot="ExternalAccount",this.model.defs={fields:{enabled:{required:!0,type:"bool"}}},this.wait(!0),this.model.populateDefaults(),this.listenToOnce(this.model,"sync",()=>{this.createFieldView("bool","enabled"),Espo.Ajax.getRequest("ExternalAccount/action/getOAuth2Info?id="+this.id).then(e=>{this.clientId=e.clientId,this.redirectUri=e.redirectUri,e.isConnected&&(this.isConnected=!0),this.wait(!1)})}),this.model.fetch()},hideField:function(e){this.$el.find('label[data-name="'+e+'"]').addClass("hide"),this.$el.find('div.field[data-name="'+e+'"]').addClass("hide");e=this.getView(e);e&&(e.disabled=!0)},showField:function(e){this.$el.find('label[data-name="'+e+'"]').removeClass("hide"),this.$el.find('div.field[data-name="'+e+'"]').removeClass("hide");e=this.getView(e);e&&(e.disabled=!1)},afterRender:function(){this.model.get("enabled")||this.$el.find(".data-panel").addClass("hidden"),this.listenTo(this.model,"change:enabled",()=>{this.model.get("enabled")?this.$el.find(".data-panel").removeClass("hidden"):this.$el.find(".data-panel").addClass("hidden")})},createFieldView:function(e,t,i,s){this.createView(t,this.getFieldManager().getViewName(e),{model:this.model,selector:'.field[data-name="'+t+'"]',defs:{name:t,params:s},mode:i?"detail":"edit",readOnly:i}),this.fieldList.push(t)},save:function(){this.fieldList.forEach(e=>{e=this.getView(e);e.readOnly||e.fetchToModel()});var t=!1;this.fieldList.forEach(e=>{t=this.getView(e).validate()||t}),t?this.notify("Not valid","error"):(this.listenToOnce(this.model,"sync",()=>{this.notify("Saved","success"),this.model.get("enabled")||this.setNotConnected()}),Espo.Ui.notify(this.translate("saving","messages")),this.model.save())},popup:function(e,t){e.windowName=e.windowName||"ConnectWithOAuth",e.windowOptions=e.windowOptions||"location=0,status=0,width=800,height=400",e.callback=e.callback||function(){window.location.reload()};var i,a=this,s=e.path,n=[],o=e.params||{};for(i in o)o[i]&&n.push(i+"="+encodeURI(o[i]));s+="?"+n.join("&");let l=window.open(s,e.windowName,e.windowOptions),r;r=window.setInterval(()=>{var e,i,s;l.closed?window.clearInterval(r):(e=l.location.href.toString(),s=i=null,(e=e.substr(e.indexOf("?")+1,e.length)).split("&").forEach(e=>{var e=e.split("="),t=decodeURI(e[0]),e=decodeURI(e[1]||"");"code"===t&&(i=e),"error"===t&&(s=e)}),(e=i?{code:i}:s?{error:s}:void 0)&&(t.call(a,e),l.close(),window.clearInterval(r)))},500)},connect:function(){this.popup({path:this.getMetadata().get("integrations."+this.integration+".params.endpoint"),params:{client_id:this.clientId,redirect_uri:this.redirectUri,scope:this.getMetadata().get("integrations."+this.integration+".params.scope"),response_type:"code",access_type:"offline",approval_prompt:"force"}},function(e){e.error?Espo.Ui.notify(!1):e.code?(this.$el.find('[data-action="connect"]').addClass("disabled"),Espo.Ajax.postRequest("ExternalAccount/action/authorizationCode",{id:this.id,code:e.code}).then(e=>{Espo.Ui.notify(!1),!0===e?this.setConnected():this.setNotConneted(),this.$el.find('[data-action="connect"]').removeClass("disabled")}).catch(()=>{this.$el.find('[data-action="connect"]').removeClass("disabled")})):this.notify("Error occurred","error")})},setConnected:function(){this.isConnected=!0,this.$el.find('[data-action="connect"]').addClass("hidden"),this.$el.find(".connected-label").removeClass("hidden")},setNotConnected:function(){this.isConnected=!1,this.$el.find('[data-action="connect"]').removeClass("hidden"),this.$el.find(".connected-label").addClass("hidden")}})}),define("views/external-account/index",["view"],function(e){return e.extend({template:"external-account/index",data:function(){return{externalAccountList:this.externalAccountList,id:this.id,externalAccountListCount:this.externalAccountList.length}},events:{"click #external-account-menu a.external-account-link":function(e){e=$(e.currentTarget).data("id")+"__"+this.userId;this.openExternalAccount(e)}},setup:function(){this.externalAccountList=this.collection.models.map(e=>e.getClonedAttributes()),this.userId=this.getUser().id,this.id=this.options.id||null,this.id&&(this.userId=this.id.split("__")[1]),this.on("after:render",function(){this.renderHeader(),this.id?this.openExternalAccount(this.id):this.renderDefaultPage()})},openExternalAccount:function(e){this.id=e;var t=this.integration=e.split("__")[0],i=(this.userId=e.split("__")[1],this.getRouter().navigate("#ExternalAccount/edit/"+e,{trigger:!1}),this.getMetadata().get(["integrations",t,"authMethod"])),i=this.getMetadata().get(["integrations",t,"userView"])||"views/external-account/"+Espo.Utils.camelCaseToHyphen(i);Espo.Ui.notify(" ... "),this.createView("content",i,{fullSelector:"#external-account-content",id:e,integration:t},e=>{this.renderHeader(),e.render(),Espo.Ui.notify(!1),$(window).scrollTop(0)})},renderDefaultPage:function(){$("#external-account-header").html("").hide(),$("#external-account-content").html("")},renderHeader:function(){this.id?$("#external-account-header").show().html(this.integration):$("#external-account-header").html("")},updatePageTitle:function(){this.setPageTitle(this.translate("ExternalAccount","scopeNamesPlural"))}})}),define("views/extension/record/row-actions",["views/record/row-actions/default"],function(e){return e.extend({getActionList:function(){return this.options.acl.edit?this.model.get("isInstalled")?[{action:"uninstall",label:"Uninstall",data:{id:this.model.id}}]:[{action:"install",label:"Install",data:{id:this.model.id}},{action:"quickRemove",label:"Remove",data:{id:this.model.id}}]:[]}})}),define("views/extension/record/list",["views/record/list"],function(e){return e.extend({rowActionsView:"views/extension/record/row-actions",checkboxes:!1,quickDetailDisabled:!0,quickEditDisabled:!0,massActionList:[]})}),define("views/export/record/record",["views/record/edit-for-modal"],function(t){return t.extend({formatList:null,customParams:null,setup:function(){t.prototype.setup.call(this)},setupBeforeFinal:function(){this.formatList=this.options.formatList,this.scope=this.options.scope;var e=this.getExportFieldsData();this.setupExportFieldDefs(e),this.setupExportLayout(e),this.setupExportDynamicLogic(),this.controlFormatField(),this.listenTo(this.model,"change:format",()=>this.controlFormatField()),this.controlAllFields(),this.listenTo(this.model,"change:exportAllFields",()=>this.controlAllFields()),t.prototype.setupBeforeFinal.call(this)},setupExportFieldDefs:function(e){let a={format:{type:"enum",options:this.formatList},fieldList:{type:"multiEnum",options:e.list,required:!0},exportAllFields:{type:"bool"}};this.customParams={},this.formatList.forEach(e=>{var t,i=this.getFormatParamsDefs(e).fields||{};for(t in this.customParams[e]=[],i){var s=this.modifyParamName(e,t);this.customParams[e].push(t),a[s]=Espo.Utils.cloneDeep(i[t])}}),this.model.setDefs({fields:a})},setupExportLayout:function(e){e={rows:[[{name:"format"},!(this.detailLayout=[])],[{name:"exportAllFields"},!1],[{name:"fieldList",options:{translatedOptions:e.translations}}]]};this.detailLayout.push(e),this.formatList.forEach(t=>{let e=this.getFormatParamsDefs(t).layout||[];e.forEach(e=>{e.forEach(e=>{e.name=this.modifyParamName(t,e.name)})}),this.detailLayout.push({name:t,rows:e})})},setupExportDynamicLogic:function(){this.dynamicLogicDefs={fields:{}},this.formatList.forEach(i=>{let s=this.getFormatParamsDefs(i).dynamicLogic||{};this.customParams[i].forEach(e=>{let t=s[e]||{};t.visible||(t.visible={}),t.visible.conditionGroup||(t.visible.conditionGroup=[]),t.visible.conditionGroup.push({type:"equals",attribute:"format",value:i});e=this.modifyParamName(i,e);this.dynamicLogicDefs.fields[e]=t})})},getFormatParamList:function(e){return Object.keys(this.getFormatParamsDefs(e).fields||{})},getFormatParamsDefs:function(e){e=this.getMetadata().get(["app","export","formatDefs",e])||{};return Espo.Utils.cloneDeep(e.params||{})},modifyParamName:function(e,t){return e+Espo.Utils.upperCaseFirst(t)},getExportFieldsData:function(){let s=this.getFieldManager().getEntityTypeFieldList(this.scope),t=this.getAcl().getScopeForbiddenFieldList(this.scope),a=(s=(s=s.filter(e=>!~t.indexOf(e))).filter(e=>{e=this.getMetadata().get(["entityDefs",this.scope,"fields",e])||{};return!e.disabled&&!e.exportDisabled&&"map"!==e.type}),this.getLanguage().sortFieldList(this.scope,s),s.unshift("id"),{}),e=(s.forEach(e=>{a[e]=this.getLanguage().translate(e,"fields",this.scope)}),this.model.get("fieldList")||[]);return e.forEach(e=>{var t,i;~s.indexOf(e)||~e.indexOf("_")&&(t=e.split("_"),s.push(e),(i=this.getMetadata().get(["entityDefs",this.scope,"links",t[0],"entity"]))&&(a[e]=this.getLanguage().translate(t[0],"links",this.scope)+"."+this.getLanguage().translate(t[1],"fields",i)))}),{list:s,translations:a}},controlAllFields:function(){this.model.get("exportAllFields")?this.hideField("fieldList"):this.showField("fieldList")},controlFormatField:function(){let t=this.model.get("format");this.formatList.filter(e=>e!==t).forEach(e=>{this.hidePanel(e)}),this.formatList.filter(e=>e===t).forEach(e=>{this.customParams[e].length?this.showPanel(e):this.hidePanel(e)})}})}),define("views/export/modals/idle",["views/modal","model"],function(e,t){return e.extend({className:"dialog dialog-record",template:"export/modals/idle",checkInterval:4e3,data:function(){return{infoText:this.translate("infoText","messages","Export")}},events:{'click [data-action="download"]':function(){this.actionDownload()}},setup:function(){this.action=this.options.action,this.id=this.options.id,this.status="Pending",this.headerText=this.translate("Export"),this.model=new t,this.model.name="Export",this.model.setDefs({fields:{status:{type:"enum",readOnly:!0,options:["Pending","Running","Success","Failed"],style:{Success:"success",Failed:"danger"}},attachmentId:{type:"varchar"}}}),this.model.set({status:this.status,processedCount:null}),this.createView("record","views/record/edit-for-modal",{scope:"None",model:this.model,selector:".record",detailLayout:[{rows:[[{name:"status",labelText:this.translate("status","fields","Export")}]]}]}),this.on("close",()=>{var e=this.model.get("status");"Pending"!==e&&"Running"!==e||Espo.Ajax.postRequest(`Export/${this.id}/subscribe`)}),this.checkStatus()},checkStatus:function(){Espo.Ajax.getRequest(`Export/${this.id}/status`).then(e=>{var t=e.status;this.model.set("status",t),"Pending"!==t&&"Running"!==t?(this.model.set({attachmentId:e.attachmentId}),"Success"===t&&(this.trigger("success",{attachmentId:e.attachmentId}),this.showDownload()),this.$el&&this.$el.find(".info-text").addClass("hidden")):setTimeout(()=>this.checkStatus(),this.checkInterval)})},showDownload:function(){this.$el.find(".download-container").removeClass("hidden");let e=this.$el.find('[data-action="download"]');e.removeClass("hidden")},actionDownload:function(){this.trigger("download",this.model.get("attachmentId")),this.close()}})}),define("views/export/modals/export",["views/modal","model"],function(e,t){return e.extend({cssName:"export-modal",className:"dialog dialog-record",template:"export/modals/export",shortcutKeys:{"Control+Enter":"export"},data:function(){return{}},setup:function(){this.buttonList=[{name:"export",label:"Export",style:"danger",title:"Ctrl+Enter"},{name:"cancel",label:"Cancel"}],this.model=new t,this.model.name="Export",this.scope=this.options.scope,this.options.fieldList?(this.model.set("fieldList",this.options.fieldList),this.model.set("exportAllFields",!1)):this.model.set("exportAllFields",!0);var e=this.getMetadata().get(["scopes",this.scope,"exportFormatList"])||this.getMetadata().get("app.export.formatList");this.model.set("format",e[0]),this.createView("record","views/export/record/record",{scope:this.scope,model:this.model,selector:".record",formatList:e})},getRecordView:function(){return this.getView("record")},actionExport:function(){let i=this.getRecordView(),a=i.fetch();if(this.model.set(a),!i.validate()){let s={exportAllFields:a.exportAllFields,format:a.format};if(!a.exportAllFields){let i=[];a.fieldList.forEach(e=>{var t;"id"!==e?((t=this.getMetadata().get(["entityDefs",this.scope,"fields",e,"type"]))&&this.getFieldManager().getAttributeList(t,e).forEach(e=>{i.push(e)}),~e.indexOf("_")&&i.push(e)):i.push("id")}),s.attributeList=i,s.fieldList=a.fieldList}s.params={},i.getFormatParamList(a.format).forEach(e=>{var t=i.modifyParamName(a.format,e),t=i.getFieldView(t);t&&!t.disabled&&this.getFieldManager().getActualAttributeList(t.type,e).forEach(e=>{var t=i.modifyParamName(a.format,e);s.params[e]=a[t]})}),this.trigger("proceed",s),this.close()}}})}),define("views/event/fields/name-for-history",["views/fields/varchar"],function(s){return s.extend({listLinkTemplate:"event/fields/name-for-history/list-link",data:function(){let e=s.prototype.data.call(this);var t=this.model.get("status");let i=this.getMetadata().get(["scopes",this.model.entityType,"canceledStatusList"])||[];return e.strikethrough=i.includes(t),e}})}),define("views/email-template/list",["views/list-with-categories"],function(e){return e.extend({quickCreate:!1})}),define("views/email-template/record/edit",["views/record/edit","views/email-template/record/detail"],function(e,t){return e.extend({saveAndContinueEditingAction:!0,setup:function(){e.prototype.setup.call(this),t.prototype.listenToInsertField.call(this)}})}),define("views/email-template/record/edit-quick",["views/record/edit","views/email-template/record/detail"],function(e,t){return e.extend({isWide:!0,sideView:!1,setup:function(){e.prototype.setup.call(this),t.prototype.listenToInsertField.call(this)}})}),define("views/email-template/record/panels/information",["views/record/panels/side"],function(e){return e.extend({templateContent:"{{{infoText}}}",data:function(){let e=this.getMetadata().get(["clientDefs","EmailTemplate","placeholderList"])||[];if(!e.length)return{infoText:""};var t=$("<h4>").text(this.translate("Available placeholders","labels","EmailTemplate")+":"),i=e.map(e=>$("<li>").append($("<code>").text("{"+e+"}")," &#8211; ",$("<span>").text(this.translate(e,"placeholderTexts","EmailTemplate")))),i=$("<ul>").append(i);return{infoText:$("<span>").addClass("complex-text").append(t,i)[0].outerHTML}}})}),define("views/email-template/fields/insert-field",["views/fields/base","ui/select"],function(e,s){return e.extend({inlineEditDisabled:!0,detailTemplate:"email-template/fields/insert-field/detail",editTemplate:"email-template/fields/insert-field/edit",data:function(){return{}},events:{'click [data-action="insert"]':function(){var e=this.$entityType.val(),t=this.$field.val();t&&this.insert(e,t)}},setup:function(){var t,e,a;this.mode!==this.MODE_LIST&&(e=[],t=this.getMetadata().get("scopes"),e=Object.keys(t).filter(e=>{if("Email"!==e&&this.getAcl().checkScope(e))return t[e].entity&&t[e].object}),this.translatedOptions={},a={},e.forEach(i=>{this.translatedOptions[i]={},a[i]=this.getScopeAttributeList(i),a[i].forEach(e=>{this.translatedOptions[i][e]=this.translatePlaceholder(i,e)});var s=this.getMetadata().get("entityDefs."+i+".links")||{};Object.keys(s).sort((e,t)=>this.translate(e,"links",i).localeCompare(this.translate(t,"links",i))).forEach(t=>{var e;"belongsTo"!==s[t].type||(e=s[t].entity)&&(s[t].disabled||s[t].utility||this.getMetadata().get(["entityAcl",i,"links",t,"onlyAdmin"])||this.getMetadata().get(["entityAcl",i,"links",t,"forbidden"])||this.getMetadata().get(["entityAcl",i,"links",t,"internal"])||this.getScopeAttributeList(e).forEach(e=>{a[i].push(t+"."+e),this.translatedOptions[i][t+"."+e]=this.translatePlaceholder(i,t+"."+e)}))})}),a.Person=["name","firstName","lastName","salutationName","emailAddress","assignedUserName"],this.translatedOptions.Person={},this.entityList=e,this.entityFields=a)},getScopeAttributeList:function(a){var e=this.getFieldManager().getEntityTypeFieldList(a),n=[],t=((e=e.sort((e,t)=>this.translate(e,"fields",a).localeCompare(this.translate(t,"fields",a)))).forEach(e=>{var t=this.getMetadata().get(["entityDefs",a,"fields",e,"type"]),i=this.getMetadata().get(["entityAcl",a,"fields",e])||{},s=this.getMetadata().get(["entityDefs",a,"fields",e])||{};if(i.onlyAdmin||i.forbidden||i.internal||s.disabled||s.utility||s.directAccessDisabled||s.templatePlaceholderDisabled)return!1;"map"!==t&&"linkMultiple"!==t&&"attachmentMultiple"!==t&&(this.getMetadata().get(["entityAcl",a,"fields",e,"onlyAdmin"])||this.getMetadata().get(["entityAcl",a,"fields",e,"forbidden"])||this.getMetadata().get(["entityAcl",a,"fields",e,"internal"])||this.getFieldManager().getAttributeList(t,e).forEach(e=>{~n.indexOf(e)||n.push(e)}))}),this.getAcl().getScopeForbiddenAttributeList(a));return(n=n.filter(e=>{if(!~t.indexOf(e))return!0})).push("id"),"personName"===this.getMetadata().get("entityDefs."+a+".fields.name.type")&&n.unshift("name"),n},translatePlaceholder:function(e,t){var i,s,a=t,n=e,o=!1,t=(~t.indexOf(".")&&(o=!0,a=t.split(".")[1],i=t.split(".")[0],n=this.getMetadata().get("entityDefs."+e+".links."+i+".entity")),this.translate(a,"fields",n));return a.indexOf("Id")===a.length-2?(s=a.substr(0,a.length-2),this.getMetadata().get(["entityDefs",n,"fields",s])&&(t=this.translate(s,"fields",n)+" ("+this.translate("id","fields")+")")):a.indexOf("Name")===a.length-4?(s=a.substr(0,a.length-4),this.getMetadata().get(["entityDefs",n,"fields",s])&&(t=this.translate(s,"fields",n)+" ("+this.translate("name","fields")+")")):a.indexOf("Type")===a.length-4&&(s=a.substr(0,a.length-4),this.getMetadata().get(["entityDefs",n,"fields",s])&&(t=this.translate(s,"fields",n)+" ("+this.translate("type","fields")+")")),a.indexOf("Ids")===a.length-3?(s=a.substr(0,a.length-3),this.getMetadata().get(["entityDefs",n,"fields",s])&&(t=this.translate(s,"fields",n)+" ("+this.translate("ids","fields")+")")):a.indexOf("Names")===a.length-5?(s=a.substr(0,a.length-5),this.getMetadata().get(["entityDefs",n,"fields",s])&&(t=this.translate(s,"fields",n)+" ("+this.translate("names","fields")+")")):a.indexOf("Types")===a.length-5&&(s=a.substr(0,a.length-5),this.getMetadata().get(["entityDefs",n,"fields",s])&&(t=this.translate(s,"fields",n)+" ("+this.translate("types","fields")+")")),t=o?this.translate(i,"links",e)+"."+t:t},afterRender:function(){var t,i;e.prototype.afterRender.call(this),this.mode===this.MODE_EDIT&&(t={},this.entityList.forEach(e=>{t[e]=this.translate(e,"scopeNames")}),this.entityList.sort((e,t)=>e.localeCompare(t)),i=this.$entityType=this.$el.find('[data-name="entityType"]'),this.$field=this.$el.find('[data-name="field"]'),i.on("change",()=>{this.changeEntityType()}),i.append($("<option>").val("Person").text(this.translate("Person"))),this.entityList.forEach(e=>{i.append($("<option>").val(e).text(t[e]))}),s.init(this.$field),this.changeEntityType(),s.init(this.$entityType))},changeEntityType:function(){var t=this.$entityType.val(),e=this.entityFields[t];s.setValue(this.$field,""),s.setOptions(this.$field,e.map(e=>({value:e,label:this.translateItem(t,e)})))},translateItem:function(e,t){return this.translatedOptions[e][t]||this.translate(t,"fields")},insert:function(e,t){this.model.trigger("insert-field",{entityType:e,field:t})}})}),define("views/email-template/fields/body",["views/fields/wysiwyg"],function(e){return e.extend({})}),define("views/email-folder/list",["views/list"],function(e){return e.extend({quickCreate:!0,setup:function(){e.prototype.setup.call(this),this.collection.data={boolFilterList:["onlyMy"]}}})}),define("views/email-folder/list-side",["view"],function(e){return e.extend({template:"email-folder/list-side",FOLDER_ALL:"all",FOLDER_INBOX:"inbox",FOLDER_DRAFTS:"drafts",events:{'click [data-action="selectFolder"]':function(e){e.preventDefault();e=$(e.currentTarget).data("id");this.actionSelectFolder(e)}},data:function(){let e={};return e.selectedFolderId=this.selectedFolderId,e.showEditLink=this.options.showEditLink,e.scope=this.scope,e},actionSelectFolder:function(e){this.$el.find("li.selected").removeClass("selected"),this.selectFolder(e),this.$el.find('li[data-id="'+e+'"]').addClass("selected")},setup:function(){this.scope="EmailFolder",this.selectedFolderId=this.options.selectedFolderId||this.FOLDER_ALL,this.emailCollection=this.options.emailCollection,this.loadNotReadCounts(),this.listenTo(this.emailCollection,"sync",this.loadNotReadCounts),this.listenTo(this.emailCollection,"folders-update",this.loadNotReadCounts),this.listenTo(this.emailCollection,"all-marked-read",()=>{for(var e in this.countsData=this.countsData||{},this.countsData)e!==this.FOLDER_DRAFTS&&(this.countsData[e]=0);this.renderCounts()}),this.listenTo(this.emailCollection,"draft-sent",()=>{this.decreaseNotReadCount(this.FOLDER_DRAFTS),this.renderCounts()}),this.listenTo(this.emailCollection,"change:isRead",e=>{this.countsIsBeingLoaded||this.manageCountsDataAfterModelChanged(e)}),this.listenTo(this.emailCollection,"model-removing",e=>{e=this.emailCollection.get(e);e&&(this.countsIsBeingLoaded||this.manageModelRemoving(e))}),this.listenTo(this.emailCollection,"moving-to-trash",(e,t)=>{(t=this.emailCollection.get(e)||t)&&(this.countsIsBeingLoaded||this.manageModelRemoving(t))}),this.listenTo(this.emailCollection,"retrieving-from-trash",(e,t)=>{(t=this.emailCollection.get(e)||t)&&(this.countsIsBeingLoaded||this.manageModelRetrieving(t))})},manageModelRemoving:function(e){if("Draft"===e.get("status"))return this.decreaseNotReadCount(this.FOLDER_DRAFTS),void this.renderCounts();e.get("isUsers")&&(e.get("isRead")||(e=e.get("groupFolderId")?"group:"+e.get("groupFolderId"):e.get("folderId")||this.FOLDER_INBOX,this.decreaseNotReadCount(e),this.renderCounts()))},manageModelRetrieving:function(e){e.get("isUsers")&&(e.get("isRead")||(e=e.get("groupFolderId")?"group:"+e.get("groupFolderId"):e.get("folderId")||this.FOLDER_INBOX,this.increaseNotReadCount(e),this.renderCounts()))},manageCountsDataAfterModelChanged:function(e){var t;e.get("isUsers")&&(t=e.get("groupFolderId")?"group:"+e.get("groupFolderId"):e.get("folderId")||this.FOLDER_INBOX,e.get("isRead")?this.decreaseNotReadCount(t):this.increaseNotReadCount(t),this.renderCounts())},increaseNotReadCount:function(e){this.countsData=this.countsData||{},this.countsData[e]=this.countsData[e]||0,this.countsData[e]++},decreaseNotReadCount:function(e){this.countsData=this.countsData||{},this.countsData[e]=this.countsData[e]||0,this.countsData[e]&&this.countsData[e]--},selectFolder:function(e){this.emailCollection.reset(),this.emailCollection.abortLastFetch(),this.selectedFolderId=e,this.trigger("select",e)},afterRender:function(){this.countsData&&this.renderCounts()},loadNotReadCounts:function(){this.countsIsBeingLoaded||(this.countsIsBeingLoaded=!0,Espo.Ajax.getRequest("Email/inbox/notReadCounts").then(e=>{if(this.countsData=e,this.isRendered())return this.renderCounts(),void(this.countsIsBeingLoaded=!1);this.once("after:render",()=>{this.renderCounts(),this.countsIsBeingLoaded=!1})}))},renderCounts:function(){let t=this.countsData;for(var i in t){let e="";t[i]&&(e=t[i].toString()),this.$el.find('li a.count[data-id="'+i+'"]').text(e)}}})}),define("views/email-folder/record/list",["views/record/list"],function(e){return e.extend({massUpdateDisabled:!0,massRemoveDisabled:!0,mergeDisabled:!0,exportDisabled:!0,removeDisabled:!0,rowActionsView:"views/email-folder/record/row-actions/default",actionMoveUp:function(e){e=this.collection.get(e.id);e&&0!==this.collection.indexOf(e)&&Espo.Ajax.postRequest("EmailFolder/action/moveUp",{id:e.id}).then(()=>{this.collection.fetch()})},actionMoveDown:function(e){e=this.collection.get(e.id);e&&(this.collection.indexOf(e)===this.collection.length-1&&this.collection.length===this.collection.total||Espo.Ajax.postRequest("EmailFolder/action/moveDown",{id:e.id}).then(()=>{this.collection.fetch()}))}})}),define("views/email-folder/record/row-actions/default",["views/record/row-actions/default"],function(t){return t.extend({setup:function(){t.prototype.setup.call(this)},getActionList:function(){var e=t.prototype.getActionList.call(this);return this.options.acl.edit&&(e.unshift({action:"moveDown",label:"Move Down",data:{id:this.model.id}}),e.unshift({action:"moveUp",label:"Move Up",data:{id:this.model.id}})),e}})}),define("views/email-folder/modals/select-folder",["views/modal"],function(e){return e.extend({cssName:"select-folder",template:"email-folder/modals/select-folder",fitHeight:!0,backdrop:!0,data:function(){return{folderDataList:this.folderDataList}},events:{'click a[data-action="selectFolder"]':function(e){let t=$(e.currentTarget);var e=t.attr("data-id"),i=t.attr("data-name");this.trigger("select",e,i),this.close()}},setup:function(){this.headerText=this.options.headerText||"",""===this.headerText&&this.buttonList.push({name:"cancel",label:"Cancel"}),Espo.Ui.notify(" ... "),this.wait(Espo.Ajax.getRequest("EmailFolder/action/listAll").then(e=>{Espo.Ui.notify(!1),this.folderDataList=e.list.filter(e=>-1===["inbox","important","sent","drafts","trash"].indexOf(e.id)).map(e=>({id:e.id,name:e.name,isGroup:0===e.id.indexOf("group:")})),this.folderDataList.unshift({id:"inbox",name:this.translate("inbox","presetFilters","Email")})}))}})}),define("views/email-filter/record/list",["views/record/list"],function(e){return e.extend({massActionList:["remove","export"]})}),define("views/email-filter/modals/edit",["views/modals/edit"],function(e){return e.extend({fullFormDisabled:!0})}),define("views/email-filter/fields/parent",["views/fields/link-parent"],function(e){return e.extend({getSelectPrimaryFilterName:function(){if(this.foreignScope)return{User:"active"}[this.foreignScope]}})}),define("views/email-filter/fields/email-folder",["views/fields/link"],function(e){return e.extend({createDisabled:!0,autocompleteDisabled:!0,getSelectFilters:function(){if(this.getUser().isAdmin()&&"User"===this.model.get("parentType")&&this.model.get("parentId"))return{assignedUser:{type:"equals",attribute:"assignedUserId",value:this.model.get("parentId"),data:{nameValue:this.model.get("parentName")}}}}})}),define("views/email-filter/fields/action",["views/fields/enum"],function(e){return e.extend({})}),define("views/email-account/list",["views/list"],function(t){return t.extend({keepCurrentRootUrl:!0,setup:function(){t.prototype.setup.call(this),this.options.params=this.options.params||{};var e=this.options.params||{};e.userId&&(this.collection.where=[{type:"equals",field:"assignedUserId",value:e.userId}])},getCreateAttributes:function(){var e={};return this.options.params.userId&&(e.assignedUserId=this.options.params.userId,e.assignedUserName=this.options.params.userName||this.options.params.userId),e}})}),define("views/email-account/record/list",["views/record/list"],function(e){return e.extend({quickDetailDisabled:!0,quickEditDisabled:!0,checkAllResultDisabled:!0,massActionList:["remove","massUpdate"]})}),define("views/email-account/record/edit",["views/record/edit","views/email-account/record/detail"],function(e,t){return e.extend({setup:function(){e.prototype.setup.call(this),t.prototype.setupFieldsBehaviour.call(this),t.prototype.initSslFieldListening.call(this),t.prototype.initSmtpFieldsControl.call(this),this.getUser().isAdmin()?this.setFieldNotReadOnly("assignedUser"):this.setFieldReadOnly("assignedUser")},modifyDetailLayout:function(e){t.prototype.modifyDetailLayout.call(this,e)},setupFieldsBehaviour:function(){t.prototype.setupFieldsBehaviour.call(this)},controlStatusField:function(){t.prototype.controlStatusField.call(this)},controlSmtpFields:function(){t.prototype.controlSmtpFields.call(this)},controlSmtpAuthField:function(){t.prototype.controlSmtpAuthField.call(this)},wasFetched:function(){t.prototype.wasFetched.call(this)}})}),define("views/email-account/modals/select-folder",["views/modal"],function(e){return e.extend({cssName:"select-folder-modal",template:"email-account/modals/select-folder",data:function(){return{folders:this.options.folders}},events:{'click [data-action="select"]':function(e){e=$(e.currentTarget).data("value");this.trigger("select",e)}},setup:function(){this.headerText=this.translate("Select")}})}),define("views/email-account/fields/email-folder",["views/fields/link"],function(e){return e.extend({createDisabled:!0,autocompleteDisabled:!0,getSelectFilters:function(){if(this.getUser().isAdmin()&&this.model.get("assignedUserId"))return{assignedUser:{type:"equals",attribute:"assignedUserId",value:this.model.get("assignedUserId"),data:{type:"is",nameValue:this.model.get("assignedUserName")}}}},setup:function(){e.prototype.setup.call(this),this.listenTo(this.model,"change:assignedUserId",(e,t,i)=>{i.ui&&this.model.set({emailFolderId:null,emailFolderName:null})})}})}),define("views/email-account/fields/email-address",["views/fields/email-address"],function(t){return t.extend({setup:function(){t.prototype.setup.call(this),this.on("change",()=>{var e=this.model.get("emailAddress");this.model.set("name",e)});var e=this.model.get("assignedUserId");this.getUser().isAdmin()&&e!==this.getUser().id&&Espo.Ajax.getRequest("User/"+e).then(t=>{var i=[];t.emailAddress&&(i.push(t.emailAddress),this.params.options=i,t.emailAddressData&&t.emailAddressData.forEach(e=>{e.emailAddress!==t.emailAddress&&i.push(e.emailAddress)}),this.reRender())})},setupOptions:function(){this.model.get("assignedUserId")===this.getUser().id&&(this.params.options=this.getUser().get("userEmailAddressList"))}})}),define("views/email/list",["exports","views/list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{createButton=!1;template="email/list";folderId=null;folderScope="EmailFolder";selectedFolderId=null;defaultFolderId="inbox";keepCurrentRootUrl=!0;stickableTop=null;FOLDER_ALL="all";FOLDER_INBOX="inbox";FOLDER_IMPORTANT="important";FOLDER_SENT="sent";FOLDER_DRAFTS="drafts";FOLDER_TRASH="trash";noDropFolderIdList=["sent","drafts"];createListRecordView(e){return super.createListRecordView(e).then(e=>{this.listenTo(e,"after:render",()=>this.initDraggable(null)),this.listenTo(e,"after:show-more",e=>this.initDraggable(e))})}initDroppable(){this.$el.find(".folders-container .folder-list > .droppable").droppable({accept:".list-row",tolerance:"pointer",over:t=>{if(this.isDroppable(t)){let e=$(t.target);e.removeClass("success"),e.addClass("active"),e.find("a").css("pointer-events","none")}},out:t=>{if(this.isDroppable(t)){let e=$(t.target);e.removeClass("active"),e.find("a").css("pointer-events","")}},drop:(s,a)=>{if(this.isDroppable(s)){let e=$(s.target),t=$(a.helper);e.find("a").css("pointer-events","");s=e.attr("data-id");let i=t.attr("data-id");i=""===i||i,this.onDrop(s,i),e.removeClass("active"),e.addClass("success"),setTimeout(()=>{e.removeClass("success")},1e3)}}})}initDraggable(e){if(e=e||0,!("ontouchstart"in window||0<navigator.maxTouchPoints)){let t=this.$el.find(".list-container > .list");const s=this.getEmailRecordView();this.collection.models.slice(e).forEach(i=>{let e=t.find(`.list-row[data-id="${i.id}"]`).first();e.draggable({cancel:"input,textarea,button,select,option,.dropdown-menu",helper:()=>{let e=this.translate("Moving to Folder","labels","Email"),t=(s.isIdChecked(i.id)&&!s.allResultIsChecked&&1<s.checkedList.length&&(e+=" · "+s.checkedList.length),i.id);return s.isIdChecked(i.id)&&!s.allResultIsChecked&&(t=""),$("<div>").attr("data-id",t).css("cursor","grabbing").addClass("draggable-helper").text(e)},distance:8,containment:this.$el,appendTo:"body",cursor:"grabbing",cursorAt:{top:0,left:0},start:e=>{let t=$(e.target);t.closest("tr").addClass("active")},stop:()=>{s.isIdChecked(i.id)||t.find(`.list-row[data-id="${i.id}"]`).first().removeClass("active")}})})}}isDroppable(e){let t=$(e.target),i=t.attr("data-id");return this.selectedFolderId!==this.FOLDER_DRAFTS&&((this.selectedFolderId!==this.FOLDER_SENT||i!==this.FOLDER_INBOX)&&(this.selectedFolderId===this.FOLDER_ALL?0===i.indexOf("group:"):i===this.FOLDER_ALL?0===this.selectedFolderId.indexOf("group:"):this.selectedFolderId!==this.FOLDER_DRAFTS||(0===i.indexOf("group:")||i!==this.FOLDER_TRASH)))}setup(){super.setup(),this.addMenuItem("dropdown",!1),this.getAcl().checkScope("EmailAccountScope")&&this.addMenuItem("dropdown",{name:"reply",label:"Email Accounts",link:"#EmailAccount/list/userId="+this.getUser().id+"&userName="+encodeURIComponent(this.getUser().get("name"))}),this.getUser().isAdmin()&&this.addMenuItem("dropdown",{link:"#InboundEmail",label:"Inbound Emails"}),this.foldersDisabled=this.foldersDisabled||this.getConfig().get("emailFoldersDisabled")||this.getMetadata().get(["scopes",this.folderScope,"disabled"])||!this.getAcl().checkScope(this.folderScope);var e=this.options.params||{};this.selectedFolderId=e.folder||this.defaultFolderId,this.foldersDisabled&&(this.selectedFolderId=null),this.applyFolder(),this.initEmailShortcuts(),this.on("remove",()=>{$(window).off("resize.email-folders"),$(window).off("scroll.email-folders")})}data(){let e={};return e.foldersDisabled=this.foldersDisabled,e}createSearchView(){let e=super.createSearchView();return e.then(e=>{this.listenTo(e,"update-ui",()=>{this.stickableTop=null,setTimeout(()=>{$(window).trigger("scroll"),this.stickableTop=null},100)})}),e}initEmailShortcuts(){this.shortcutKeys["Control+Delete"]=e=>{this.hasSelectedRecords()&&(e.preventDefault(),e.stopPropagation(),this.getEmailRecordView().massActionMoveToTrash())},this.shortcutKeys["Control+KeyI"]=e=>{this.hasSelectedRecords()&&(e.preventDefault(),e.stopPropagation(),this.getEmailRecordView().toggleMassMarkAsImportant())},this.shortcutKeys["Control+KeyM"]=e=>{this.hasSelectedRecords()&&(e.preventDefault(),e.stopPropagation(),this.getEmailRecordView().massActionMoveToFolder())}}hasSelectedRecords(){var e=this.getEmailRecordView();return e.checkedList&&e.checkedList.length&&!e.allResultIsChecked}setupReuse(e){this.applyRoutingParams(e),this.initDroppable(),this.initStickableFolders()}actionComposeEmail(e){e=e||{},Espo.Ui.notify(" ... ");var t=this.getMetadata().get("clientDefs.Email.modalViews.compose")||"views/modals/compose-email",e={attributes:{status:"Draft"},focusForCreate:e.focusForCreate};this.createView("quickCreate",t,e,e=>{e.render(),e.notify(!1),this.listenToOnce(e,"after:save",()=>{this.collection.fetch()})})}afterRender(){super.afterRender(),this.foldersDisabled||this.hasView("folders")||this.loadFolders()}getFolderCollection(t){this.getCollectionFactory().create(this.folderScope,e=>{e.url="EmailFolder/action/listAll",e.maxSize=200,this.listenToOnce(e,"sync",()=>{t.call(this,e)}),e.fetch()})}loadFolders(){var t=null;let i=[this.FOLDER_TRASH,this.FOLDER_DRAFTS,this.FOLDER_ALL,this.FOLDER_INBOX,this.FOLDER_IMPORTANT,this.FOLDER_SENT];this.getFolderCollection(e=>{e.forEach(e=>{-1===this.noDropFolderIdList.indexOf(e.id)&&(e.droppable=!0),0===e.id.indexOf("group:")?e.title=this.translate("groupFolder","fields","Email"):-1===i.indexOf(e.id)&&(e.title=this.translate("folder","fields","Email"))}),this.createView("folders","views/email-folder/list-side",{collection:e,emailCollection:this.collection,selector:".folders-container",showEditLink:this.getAcl().check(this.folderScope,"edit"),selectedFolderId:this.selectedFolderId},e=>{e.render().then(()=>this.initDroppable()).then(()=>this.initStickableFolders()),this.listenTo(e,"select",e=>{this.selectedFolderId=e,this.applyFolder(),t&&t.readyState<4&&t.abort(),Espo.Ui.notify(" ... "),t=this.collection.fetch().then(()=>Espo.Ui.notify(!1)),e!==this.defaultFolderId?this.getRouter().navigate("#Email/list/folder="+e):this.getRouter().navigate("#Email"),this.updateLastUrl()})})})}applyFolder(){this.collection.selectedFolderId=this.selectedFolderId,this.selectedFolderId?this.collection.whereFunction=()=>[{type:"inFolder",attribute:"folderId",value:this.selectedFolderId}]:this.collection.whereFunction=null}getFoldersView(){return this.getView("folders")}applyRoutingParams(e){let t;"folder"in e&&(t=e.folder||"inbox",e.isReturnThroughLink||t===this.selectedFolderId||(e=this.getFoldersView())&&(e.actionSelectFolder(t),e.reRender(),$(window).scrollTop(0)))}onDrop(e,t){let i=this.getEmailRecordView();if(e!==this.FOLDER_IMPORTANT)return this.selectedFolderId===this.FOLDER_TRASH?e===this.FOLDER_TRASH?void 0:void(!0===t?i.massRetrieveFromTrashMoveToFolder(e):i.actionRetrieveFromTrashMoveToFolder({id:t,folderId:e})):void(e!==this.FOLDER_TRASH?(0===this.selectedFolderId.indexOf("group:")&&e===this.FOLDER_ALL&&(e=this.FOLDER_INBOX),!0===t?i.massMoveToFolder(e):i.actionMoveToFolder({id:t,folderId:e})):!0===t?i.massActionMoveToTrash():i.actionMoveToTrash({id:t}));setTimeout(()=>{!0===t?i.massActionMarkAsImportant():i.actionMarkAsImportant({id:t})},10)}getEmailRecordView(){return this.getRecordView()}initStickableFolders(){let i=$(window),s=this.$el.find(".list-container"),a=this.$el.find(".folders-container"),n=this.$el.find(".left-container").first();var e=this.getThemeManager().getParam("screenWidthXs");let o=$(window.document).width()<e,l=this.getThemeManager().getParam("navbarHeight")+(this.getThemeManager().getParam("buttonsContainerHeight")||47),r=parseInt(window.getComputedStyle($("#content").get(0)).paddingBottom,10),d=e=>{let t=e.get(0),i=0;for(;t;)i+=isNaN(t.offsetTop)?0:t.offsetTop,t=t.offsetParent;return o?i:i-l},t=(this.stickableTop=d(s),()=>{let e=this.stickableTop;null===e&&(e=this.stickableTop=d(s));var t=i.scrollTop();if(t<=e||o)return a.removeClass("sticked").width("").scrollTop(0),void a.css({maxHeight:""});t>e&&(t=i.scrollTop()-e,a.addClass("sticked").width(n.outerWidth(!0)).scrollTop(t),t=parseInt(window.getComputedStyle(a.get(0)).top),t=i.height()-t-r,a.css({maxHeight:t}))});i.on("resize.email-folders",()=>t()),i.on("scroll.email-folders",()=>t())}handleShortcutKeyCtrlSpace(e){"TEXTAREA"!==e.target.tagName&&"INPUT"!==e.target.tagName&&this.getAcl().checkScope(this.scope,"create")&&(e.preventDefault(),e.stopPropagation(),this.actionComposeEmail({focusForCreate:!0}))}}e.default=s}),define("views/email/record/list-related",["views/record/list"],function(e){return e.extend({massActionList:["remove","massUpdate"]})}),define("views/email/record/list-expanded",["views/record/list-expanded","views/email/record/list"],function(e,t){return e.extend({actionMarkAsImportant:function(e){t.prototype.actionMarkAsImportant.call(this,e)},actionMarkAsNotImportant:function(e){t.prototype.actionMarkAsNotImportant.call(this,e)},actionMoveToTrash:function(e){t.prototype.actionMoveToTrash.call(this,e)}})}),define("views/email/record/edit-quick",["views/email/record/edit"],function(e){return e.extend({isWide:!0,sideView:!1})}),define("views/email/record/detail-side",["views/record/detail-side"],function(e){return e.extend({})}),define("views/email/record/detail-quick",["views/email/record/detail"],function(e){return e.extend({isWide:!0,sideView:!1})}),define("views/email/record/compose",["exports","views/record/edit","views/email/record/detail"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{isWide=!0;sideView=!1;setupBeforeFinal(){if(super.setupBeforeFinal(),this.initialBody=null,this.initialIsHtml=null,!this.model.get("isHtml")&&this.getPreferences().get("emailReplyForceHtml")&&(t=(this.model.get("body")||"").replace(/\n/g,"<br>"),this.model.set("body",t,{silent:!0}),this.model.set("isHtml",!0,{silent:!0})),this.model.get("body")&&(this.initialBody=this.model.get("body"),this.initialIsHtml=this.model.get("isHtml")),!this.options.signatureDisabled&&this.hasSignature()){let e="prependSignature";var t=this[e=this.options.appendSignature?"appendSignature":e](this.model.get("body")||"",this.model.get("isHtml"));this.model.set("body",t,{silent:!0})}}setup(){super.setup(),this.isBodyChanged=!1,this.listenTo(this.model,"change:body",()=>{this.isBodyChanged=!0}),this.options.removeAttachmentsOnSelectTemplate||(this.initialAttachmentsIds=this.model.get("attachmentsIds")||[],this.initialAttachmentsNames=this.model.get("attachmentsNames")||{}),this.initInsertTemplate(),this.options.selectTemplateDisabled&&this.hideField("selectTemplate")}initInsertTemplate(){this.listenTo(this.model,"insert-template",e=>{let t=this.model.get("body")||"",i=t.replace(/<br\s*\/?>/gm,""),s=(i=(i=(i=i.replace(/<\/p\s*\/?>/gm,"")).replace(/ /g,"")).replace(/\n/g,""),$("<div>").html(i));""!==(i=s.text())&&this.isBodyChanged?this.confirm({message:this.translate("confirmInsertTemplate","messages","Email"),confirmText:this.translate("Yes")}).then(()=>this.insertTemplate(e)):this.insertTemplate(e)})}insertTemplate(t){let i=t.body;if(this.hasSignature()&&(i=this.appendSignature(i||"",t.isHtml)),this.initialBody&&!this.isBodyChanged){let e=this.initialBody;t.isHtml!==this.initialIsHtml&&(e=t.isHtml?this.plainToHtml(e):this.htmlToPlain(e)),i+=e}this.model.set("isHtml",t.isHtml),t.subject&&this.model.set("name",t.subject),this.model.set("body",""),this.model.set("body",i),this.options.removeAttachmentsOnSelectTemplate||this.initialAttachmentsIds.forEach(e=>{t.attachmentsIds&&t.attachmentsIds.push(e),t.attachmentsNames&&(t.attachmentsNames[e]=this.initialAttachmentsNames[e]||e)}),this.model.set({attachmentsIds:t.attachmentsIds,attachmentsNames:t.attachmentsNames}),this.isBodyChanged=!1}prependSignature(t,e){if(e){let e=this.getSignature();return t&&(e+=""),"<p><br></p>"+e+t}let i=this.getPlainTextSignature();return t&&(i+="\n"),"\n\n"+i+t}appendSignature(e,t){return t?e+""+this.getSignature():e+"\n\n"+this.getPlainTextSignature()}hasSignature(){return!!this.getPreferences().get("signature")}getSignature(){return this.getPreferences().get("signature")||""}getPlainTextSignature(){var e=this.getSignature().replace(/<br\s*\/?>/gm,"\n");return $("<div>").html(e).text()}afterSave(){super.afterRender(),this.isSending&&"Sent"===this.model.get("status")&&Espo.Ui.success(this.translate("emailSent","messages","Email"))}send(){i.default.prototype.send.call(this)}saveDraft(e){let t=this.model,i=(t.set("status","Draft"),this.getFieldView("subject"));return i&&(i.fetchToModel(),t.get("name")||t.set("name",this.translate("No Subject","labels","Email"))),this.save(e)}htmlToPlain(e){let t=(e=e||"").replace(/<br\s*\/?>/gm,"\n"),i=(t=t.replace(/<\/p\s*\/?>/gm,"\n\n"),$("<div>").html(t));return i.find("style").remove(),i.find('link[ref="stylesheet"]').remove(),t=i.text()}plainToHtml(e){return(e=e||"").replace(/\n/g,"<br>")}errorHandlerSendingFail(e){i.default.prototype.errorHandlerSendingFail.call(this,e)}focusForCreate(){if(this.model.get("to"))if(this.model.get("subject")){if(this.model.get("isHtml")){let e=this.$el.find('.field[data-name="body"] .note-editable');return e.length?void e.focus():void 0}this.$el.find('.field[data-name="body"] textarea').prop("selectionEnd",0).focus()}else this.$el.find('.field[data-name="subject"] input').focus();else this.$el.find('.field[data-name="to"] input').focus()}}e.default=a}),define("views/email/record/row-actions/default",["views/record/row-actions/default"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.listenTo(this.model,"change",function(e){(e.hasChanged("isImportant")||e.hasChanged("inTrash"))&&setTimeout(function(){this.reRender()}.bind(this),10)},this)},getActionList:function(){var e=[{action:"quickView",label:"View",data:{id:this.model.id}}];return this.model.get("createdById")!==this.getUser().id||"Draft"!==this.model.get("status")||this.model.get("inTrash")||e.push({action:"send",label:"Send",data:{id:this.model.id}}),this.options.acl.edit&&(e=e.concat([{action:"quickEdit",label:"Edit",data:{id:this.model.id}}])),this.model.get("isUsers")&&"Draft"!==this.model.get("status")&&(this.model.get("inTrash")?e.push({action:"retrieveFromTrash",label:"Retrieve from Trash",data:{id:this.model.id}}):e.push({action:"moveToTrash",label:"Move to Trash",data:{id:this.model.id}})),this.model.get("isUsers")&&(this.model.get("isImportant")?e.push({action:"markAsNotImportant",label:"Unmark Importance",data:{id:this.model.id}}):this.model.get("inTrash")||e.push({action:"markAsImportant",label:"Mark as Important",data:{id:this.model.id}})),this.model.get("isUsers")&&"Draft"!==this.model.get("status")&&e.push({action:"moveToFolder",label:"Move to Folder",data:{id:this.model.id}}),this.options.acl.delete&&e.push({action:"quickRemove",label:"Remove",data:{id:this.model.id}}),e}})}),define("views/email/record/row-actions/dashlet",["views/record/row-actions/default"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.listenTo(this.model,"change:isImportant",()=>{setTimeout(()=>{this.reRender()},10)})},getActionList:function(){var e=[{action:"quickView",label:"View",data:{id:this.model.id}}];return this.options.acl.edit&&(e=e.concat([{action:"quickEdit",label:"Edit",data:{id:this.model.id}}])),this.model.get("isUsers")&&"Draft"!==this.model.get("status")&&(this.model.get("inTrash")?e.push({action:"retrieveFromTrash",label:"Retrieve from Trash",data:{id:this.model.id}}):e.push({action:"moveToTrash",label:"Move to Trash",data:{id:this.model.id}})),this.getAcl().checkModel(this.model,"delete")&&e.push({action:"quickRemove",label:"Remove",data:{id:this.model.id}}),this.model.get("isUsers")&&(this.model.get("isImportant")?e.push({action:"markAsNotImportant",label:"Unmark Importance",data:{id:this.model.id}}):e.push({action:"markAsImportant",label:"Mark as Important",data:{id:this.model.id}})),e}})}),define("views/email/record/panels/event",["views/record/panels/side"],function(e){return class extends e{setupFields(){super.setupFields(),this.fieldList.push({name:"icsEventDateStart",readOnly:!0,labelText:this.translate("dateStart","fields","Meeting")}),this.fieldList.push({name:"createdEvent",readOnly:!0}),this.fieldList.push({name:"createEvent",readOnly:!0,noLabel:!0}),this.controlEventField(),this.listenTo(this.model,"change:icsEventData",this.controlEventField,this),this.listenTo(this.model,"change:createdEventId",this.controlEventField,this)}controlEventField(){return!this.model.get("icsEventData")||this.model.get("icsEventData").createdEvent||this.model.get("createdEventId")?(this.recordViewObject.hideField("createEvent"),void this.recordViewObject.showField("createdEvent")):(this.recordViewObject.hideField("createdEvent"),void this.recordViewObject.showField("createEvent"))}}}),define("views/email/record/panels/default-side",["views/record/panels/default-side"],function(e){return e.extend({setupFields:function(){e.prototype.setupFields.call(this),this.fieldList.push({name:"hasAttachment",view:"views/email/fields/has-attachment",noLabel:!0}),this.controlHasAttachmentField(),this.listenTo(this.model,"change:hasAttachment",this.controlHasAttachmentField,this)},controlHasAttachmentField:function(){this.model.get("hasAttachment")?this.recordViewObject.showField("hasAttachment"):this.recordViewObject.hideField("hasAttachment")}})}),define("views/email/modals/insert-field",["views/modal","helpers/misc/field-language"],function(e,t){return e.extend({backdrop:!0,templateContent:`
            {{#each viewObject.dataList}}
                <div class="margin-bottom">
                <h5>{{label}}: {{translate entityType category='scopeNames'}}</h5>
                </div>
                <ul class="list-group no-side-margin">
                    {{#each dataList}}
                    <li class="list-group-item clearfix">
                        <a role="button"
                            data-action="insert" class="text-bold" data-name="{{name}}" data-type="{{../type}}">
                            {{label}}
                        </a>

                        <div class="pull-right"
                            style="width: 50%; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                            {{valuePreview}}
                        </div>
                    </li>
                    {{/each}}
                </ul>
            {{/each}}

            {{#unless viewObject.dataList.length}}
                {{translate 'No Data'}}
            {{/unless}}
        `,events:{'click [data-action="insert"]':function(e){var t=$(e.currentTarget).data("name"),e=$(e.currentTarget).data("type");this.insert(e,t)}},setup:function(){e.prototype.setup.call(this),this.headerText=this.translate("Insert Field","labels","Email"),this.fieldLanguage=new t(this.getMetadata(),this.getLanguage()),this.wait(Espo.Ajax.getRequest("Email/insertFieldData",{parentId:this.options.parentId,parentType:this.options.parentType,to:this.options.to}).then(e=>{this.fetchedData=e,this.prepareData()}))},prepareData:function(){this.dataList=[];var n=this.fetchedData;["parent","to"].forEach(e=>{if(n[e]){var t,i=n[e].entityType,s=n[e].id;for(t of this.dataList)if(t.id===s&&t.entityType===i)return;var a=this.prepareDisplayValueList(n[e].entityType,n[e].values);a.length&&this.dataList.push({type:e,entityType:i,id:s,name:n[e].name,dataList:a,label:this.translate(e,"fields","Email")})}})},prepareDisplayValueList:function(i,a){let n=[],e=Object.keys(a),o={},l=(e.forEach(e=>{o[e]=this.fieldLanguage.translateAttribute(i,e)}),e=e.sort((e,t)=>o[e].localeCompare(o[t])),["id","modifiedAt","modifiedByName"]),t=this.getFieldManager();return t.getEntityTypeFieldList(i).forEach(e=>{var t=this.getMetadata().get(["entityDefs",i,"fields",e,"type"]);~["link","linkOne","image","filed","linkParent"].indexOf(t)&&l.push(e+"Id"),"linkParent"===t&&l.push(e+"Type")}),e.forEach(t=>{if(!~l.indexOf(t)){let e=a[t];if(null!==e&&""!==e&&"boolean"!=typeof e){if(Array.isArray(e)){for(var i in e)if("string"!=typeof i)return;e=e.split(", ")}var s=(e=this.getHelper().sanitizeHtml(e)).replace(/<br( \/)?>/gm," ");e=(e=e.replace(/(?:\r\n|\r|\n)/g,"")).replace(/<br( \/)?>/gm,"\n"),n.push({name:t,label:o[t],value:e,valuePreview:s})}}}),n},insert:function(e,t){for(var i of this.dataList)if(i.type===e){for(var s of i.dataList)if(s.name===t){this.trigger("insert",s.value);break}break}this.close()}})}),define("views/email/modals/detail",["views/modals/detail","views/email/detail"],function(e,i){return e.extend({setup:function(){e.prototype.setup.call(this),this.addButton({name:"reply",label:"Reply",hidden:this.model&&"Draft"===this.model.get("status"),style:"danger",position:"right"},!0),this.model&&this.listenToOnce(this.model,"sync",()=>{setTimeout(()=>{this.model.set("isRead",!0)},50)})},controlRecordButtonsVisibility:function(){e.prototype.controlRecordButtonsVisibility.call(this),"Draft"!==this.model.get("status")&&this.getAcl().check("Email","create")?this.showActionItem("reply"):this.hideActionItem("reply")},actionReply:function(e,t){i.prototype.actionReply.call(this,{},t,this.getPreferences().get("emailReplyToAllByDefault"))}})}),define("views/email/modals/body-plain",["views/modal"],function(e){return e.extend({backdrop:!0,templateContent:'<div class="field" data-name="body-plain">{{{bodyPlain}}}</div>',setup:function(){e.prototype.setup.call(this),this.buttonList.push({name:"cancel",label:"Close"}),this.headerText=this.model.get("name"),this.createView("bodyPlain","views/fields/text",{selector:'.field[data-name="bodyPlain"]',model:this.model,defs:{name:"bodyPlain",params:{readOnly:!0,inlineEditDisabled:!0}}})}})}),define("views/email/modals/attachments",["views/modal"],function(e){return e.extend({backdrop:!0,templateContent:'<div class="record">{{{record}}}</div>',setup:function(){e.prototype.setup.call(this),this.headerText=this.translate("attachments","fields","Email"),this.createView("record","views/record/detail",{model:this.model,selector:".record",readOnly:!0,sideView:null,buttonsDisabled:!0,detailLayout:[{rows:[[{name:"attachments",noLabel:!0},!1]]}]}),this.model.has("attachmentsIds")||this.wait(this.model.fetch())}})}),define("views/email/fields/subject",["views/fields/varchar"],function(t){return t.extend({listLinkTemplate:"email/fields/subject/list-link",data:function(){let e=t.prototype.data.call(this);return e.isRead=this.model.get("sentById")===this.getUser().id||this.model.get("isRead"),e.isImportant=this.model.has("isImportant")&&this.model.get("isImportant"),e.hasAttachment=this.model.has("hasAttachment")&&this.model.get("hasAttachment"),e.isReplied=this.model.has("isReplied")&&this.model.get("isReplied"),e.inTrash=this.model.has("inTrash")&&this.model.get("inTrash"),e.isRead||this.model.has("isRead")||(e.isRead=!0),e.isNotEmpty||null!==this.model.get("name")&&""!==this.model.get("name")&&this.model.has("name")&&(e.isNotEmpty=!0),e},getValueForDisplay:function(){return this.model.get("name")},getAttributeList:function(){return["name","subject","isRead","isImportant","hasAttachment","inTrash"]},setup:function(){t.prototype.setup.call(this),this.events['click [data-action="showAttachments"]']=e=>{e.stopPropagation(),this.showAttachments()},this.listenTo(this.model,"change",()=>{"list"!==this.mode&&"listLink"!==this.mode||(this.model.hasChanged("isRead")||this.model.hasChanged("isImportant"))&&this.reRender()})},afterRender:function(){t.prototype.afterRender.call(this)},fetch:function(){var e=t.prototype.fetch.call(this);return e.name=e.subject,e},showAttachments:function(){Espo.Ui.notify(" ... "),this.createView("dialog","views/email/modals/attachments",{model:this.model}).then(e=>{e.render(),Espo.Ui.notify(!1)})}})}),define("views/email/fields/select-template",["views/fields/link"],function(e){return e.extend({type:"link",foreignScope:"EmailTemplate",editTemplate:"email/fields/select-template/edit",setup:function(){e.prototype.setup.call(this),this.on("change",()=>{var e=this.model.get(this.idName);e&&this.loadTemplate(e)})},getSelectPrimaryFilterName:function(){return"actual"},loadTemplate:function(e){let t=this.model.get("to")||"",i=null;(t=t.trim())&&(i=t.split(";")[0].trim()),Espo.Ajax.postRequest(`EmailTemplate/${e}/prepare`,{emailAddress:i,parentType:this.model.get("parentType"),parentId:this.model.get("parentId"),relatedType:this.model.get("relatedType"),relatedId:this.model.get("relatedId")}).then(e=>{this.model.trigger("insert-template",e),this.emptyField()}).catch(()=>{this.emptyField()})},emptyField:function(){this.model.set(this.idName,null),this.model.set(this.nameName,"")}})}),define("views/email/fields/replies",["views/fields/link-multiple"],function(i){return i.extend({getAttributeList:function(){let e=i.prototype.getAttributeList.call(this);return e.push(this.name+"Columns"),e},getDetailLinkHtml:function(e){var t=i.prototype.getDetailLinkHtml.call(this,e),e=((this.model.get(this.name+"Columns")||{})[e]||{}).status;return $("<div>").append($("<span>").addClass("fas fa-arrow-right fa-sm link-multiple-item-icon").addClass("Draft"===e?"text-warning":"text-success")).append(t).html()}})}),define("views/email/fields/replied",["views/fields/link"],function(t){return t.extend({afterRender:function(){var e;t.prototype.afterRender.call(this),"detail"!==this.mode||(e=this.$el.find("a")).get(0)&&$('<span class="fas fa-arrow-left fa-sm link-field-icon text-soft"></span>').insertBefore(e)}})}),define("views/email/fields/person-string-data-for-expanded",["views/email/fields/person-string-data"],function(e){return e.extend({listTemplate:"email/fields/person-string-data/list-for-expanded"})}),define("views/email/fields/icon",["views/fields/base"],function(e){return e.extend({listTemplate:"email/fields/icon/detail",detailTemplate:"email/fields/icon/detail"})}),define("views/email/fields/has-attachment",["views/fields/base"],function(t){return t.extend({listTemplate:"email/fields/has-attachment/detail",detailTemplate:"email/fields/has-attachment/detail",events:{'click [data-action="show"]':function(e){e.stopPropagation(),this.show()}},data:function(){let e=t.prototype.data.call(this);return e.isSmall=this.mode===this.MODE_LIST,e},show:function(){Espo.Ui.notify(" ... "),this.createView("dialog","views/email/modals/attachments",{model:this.model}).then(e=>{e.render(),Espo.Ui.notify(!1)})}})}),define("views/email/fields/from-email-address",["views/fields/link"],function(e){return e.extend({listTemplate:"email/fields/from-email-address/detail",detailTemplate:"email/fields/from-email-address/detail"})}),define("views/email/fields/email-address-varchar",["views/fields/base","views/email/fields/from-address-varchar","views/email/fields/email-address"],function(t,n,e){return t.extend({detailTemplate:"email/fields/email-address-varchar/detail",editTemplate:"email/fields/email-address-varchar/edit",emailAddressRegExp:new RegExp(/^[-!#$%&'*+/=?^_`{|}~A-Za-z0-9]+(?:\.[-!#$%&'*+/=?^_`{|}~A-Za-z0-9]+)*/.source+/@([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])?\.)+[A-Za-z0-9][A-Za-z0-9-]*[A-Za-z0-9]/.source),data:function(){let e=t.prototype.data.call(this);return e.valueIsSet=this.model.has(this.name),e.maxLength=254,e},events:{'click a[data-action="clearAddress"]':function(e){e=$(e.currentTarget).data("address").toString();this.deleteAddress(e)},"keyup input":function(i){if(this.isEditMode()){var e=Espo.Utils.getKeyFromKeyEvent(i);if("Comma"===e||"Semicolon"===e||"Enter"===e){let e=$(i.currentTarget),t=e.val().replace(",","").replace(";","").trim();-1!==t.indexOf("@")&&this.checkEmailAddressInString(t)&&(this.addAddress(t,""),e.val(""))}}},"change input":function(i){if(this.isEditMode()){let e=$(i.currentTarget),t=e.val().replace(",","").replace(";","").trim();-1!==t.indexOf("@")&&this.checkEmailAddressInString(t)&&(this.addAddress(t,""),e.val(""))}},'click [data-action="createContact"]':function(e){e=$(e.currentTarget).data("address");n.prototype.createPerson.call(this,"Contact",e)},'click [data-action="createLead"]':function(e){e=$(e.currentTarget).data("address");n.prototype.createPerson.call(this,"Lead",e)},'click [data-action="addToContact"]':function(e){e=$(e.currentTarget).data("address");n.prototype.addToPerson.call(this,"Contact",e)},'click [data-action="addToLead"]':function(e){e=$(e.currentTarget).data("address");n.prototype.addToPerson.call(this,"Lead",e)},"auxclick a[href][data-scope][data-id]":function(t){if(1===t.button&&(t.ctrlKey||t.metaKey)){let e=$(t.currentTarget);var i=e.attr("data-id"),s=e.attr("data-scope");t.preventDefault(),t.stopPropagation(),n.prototype.quickView.call(this,{id:i,scope:s})}}},getAutocompleteMaxCount:function(){return this.autocompleteMaxCount||this.getConfig().get("recordsPerPage")},parseNameFromStringAddress:function(e){return n.prototype.parseNameFromStringAddress.call(this,e)},getAttributeList:function(){var e=t.prototype.getAttributeList.call(this);return e.push("nameHash"),e.push("typeHash"),e.push("idHash"),e.push("accountId"),e.push(this.name+"EmailAddressesNames"),e.push(this.name+"EmailAddressesIds"),e},setup:function(){t.prototype.setup.call(this),this.on("render",()=>{this.initAddressList()})},initAddressList:function(){this.nameHash={},this.addressList=(this.model.get(this.name)||"").split(";").filter(e=>""!==e).map(e=>e.trim()),this.idHash=this.idHash||{},this.typeHash=this.typeHash||{},this.nameHash=this.nameHash||{},_.extend(this.typeHash,this.model.get("typeHash")||{}),_.extend(this.nameHash,this.model.get("nameHash")||{}),_.extend(this.idHash,this.model.get("idHash")||{}),this.nameHash=_.clone(this.nameHash),this.typeHash=_.clone(this.typeHash),this.idHash=_.clone(this.idHash)},afterRender:function(){t.prototype.afterRender.call(this),this.isEditMode()&&(this.$input=this.$element=this.$el.find("input"),this.addressList.forEach(e=>{this.addAddressHtml(e,this.nameHash[e]||"")}),this.$input.autocomplete({serviceUrl:()=>"EmailAddress/search?maxSize="+this.getAutocompleteMaxCount()+"&onlyActual=true",paramName:"q",minChars:1,autoSelectFirst:!0,noCache:!0,triggerSelectOnValidInput:!1,formatResult:e=>this.getHelper().escapeString(e.name)+" &#60;"+this.getHelper().escapeString(e.id)+"&#62;",transformResult:e=>{e=JSON.parse(e);var t=[];return e.forEach(e=>{t.push({id:e.emailAddress,name:e.entityName,emailAddress:e.emailAddress,entityId:e.entityId,entityName:e.entityName,entityType:e.entityType,data:e.emailAddress,value:e.emailAddress})}),{suggestions:t}},onSelect:e=>{this.addAddress(e.emailAddress,e.entityName,e.entityType,e.entityId),this.$input.val(""),this.$input.focus()}}),this.once("render",()=>{this.$input.autocomplete("dispose")}),this.once("remove",()=>{this.$input.autocomplete("dispose")})),"search"===this.mode&&this.getAcl().check("Email","create")&&e.prototype.initSearchAutocomplete.call(this),"search"===this.mode&&this.$input.on("input",()=>{this.trigger("change")})},checkEmailAddressInString:function(e){e=e.match(this.emailAddressRegExp);if(e&&e.length)return!0},addAddress:function(e,t,i,s){if(this.justAddedAddress&&this.deleteAddress(this.justAddedAddress),this.justAddedAddress=e,setTimeout(()=>{this.justAddedAddress=null},100),e=e.trim(),!i){var a=e.match(this.emailAddressRegExp);if(!a||!a.length)return;e=a[0]}~this.addressList.indexOf(e)||(this.addressList.push(e),this.nameHash[e]=t,i&&(this.typeHash[e]=i),s&&(this.idHash[e]=s),this.addAddressHtml(e,t),this.trigger("change"))},addAddressHtml:function(e,t){let i=this.$el.find(".link-container"),s=$("<span>");t&&s.append($("<span>").text(t)," ",$("<span>").addClass("text-muted chevron-right")," "),s.append($("<span>").text(e));t=$("<div>").attr("data-address",e).addClass("list-group-item").append($("<a>").attr("data-address",e).attr("role","button").attr("tabindex","0").attr("data-action","clearAddress").addClass("pull-right").append($("<span>").addClass("fas fa-times")),s);i.append(t)},deleteAddress:function(e){this.deleteAddressHtml(e);var t=this.addressList.indexOf(e);-1<t&&this.addressList.splice(t,1),delete this.nameHash[e],this.trigger("change")},deleteAddressHtml:function(e){this.$el.find('.list-group-item[data-address="'+e+'"]').remove()},fetch:function(){let e={};return e[this.name]=this.addressList.join(";"),e},fetchSearch:function(){var e=this.$element.val().trim();return e?{type:"equals",value:e}:null},getValueForDisplay:function(){if(this.isDetailMode()){let t=[];return this.addressList.forEach(e=>{t.push(this.getDetailAddressHtml(e))}),t.join("")}},getDetailAddressHtml:function(e){if(!e)return"";var t=this.nameHash[e]||null,i=this.typeHash[e]||null,s=this.idHash[e]||null;if(s)return $("<div>").append($("<a>").attr("href","#"+i+"/view/"+s).attr("data-scope",i).attr("data-id",s).text(t),' <span class="text-muted chevron-right"></span> ',$("<span>").text(e)).get(0).outerHTML;let a=$("<div>");return t?a.append($("<span>").addClass("email-address-line").text(t).append(' <span class="text-muted chevron-right"></span> ').append($("<span>").text(e))):a.append($("<span>").addClass("email-address-line").text(e)),(this.getAcl().check("Contact","create")||this.getAcl().check("Lead","create"))&&a.prepend(n.prototype.getCreateHtml.call(this,e)),a.get(0).outerHTML},validateRequired:function(){return"Draft"!==this.model.get("status")&&t.prototype.validateRequired.call(this)}})}),define("views/email/fields/created-event",["views/fields/link-parent"],function(e){return class extends e{data(){let e=super.data();var t=this.model.get("icsEventData")||{};return this.isReadMode()&&!e.idValue&&t.createdEvent&&(e.idValue=t.createdEvent.id,e.typeValue=t.createdEvent.entityType,e.nameValue=t.createdEvent.name),e}getAttributeList(){let e=super.getAttributeList();return e.push("icsEventData"),e}}}),define("views/email/fields/create-event",["views/fields/base"],function(e){return e.extend({detailTemplate:"email/fields/create-event/detail",eventEntityType:"Meeting",getAttributeList:function(){return["icsEventData","createdEventId"]},events:{'click [data-action="createEvent"]':function(){this.createEvent()}},createEvent:function(){var e=this.getMetadata().get(["clientDefs",this.eventEntityType,"modalViews","edit"])||"views/modals/edit",t=this.model.get("icsEventData")||{};let i=Espo.Utils.cloneDeep(t.valueMap||{});i.parentId=this.model.get("parentId"),i.parentType=this.model.get("parentType"),i.parentName=this.model.get("parentName"),this.addFromAddressToAttributes(i),this.createView("dialog",e,{attributes:i,scope:this.eventEntityType}).then(e=>{e.render(),this.listenToOnce(e,"after:save",()=>{this.model.fetch().then(()=>Espo.Ui.success(this.translate("Done")))})})},addFromAddressToAttributes:function(e){var t=this.model.get("from"),i=this.model.get("idHash")||{},s=this.model.get("typeHash")||{},a=this.model.get("nameHash")||{},n=null,o=null,l=null;t&&(n=i[t]||null,o=s[t]||null,l=a[t]||null,(i=this.getAttendeeLink(o))&&(e[i+"Ids"]=e[i+"Ids"]||[],e[i+"Names"]=e[i+"Names"]||{},~e[i+"Ids"].indexOf(n)||(e[i+"Ids"].push(n),e[i+"Names"][n]=l)))},getAttendeeLink:function(e){return"User"===e?"users":"Contact"===e?"contacts":"Lead"===e?"leads":null}})}),define("views/email/fields/compose-from-address",["views/fields/base","ui/select"],function(i,e){return i.extend({detailTemplate:"email/fields/email-address-varchar/detail",editTemplate:"email/fields/compose-from-address/edit",data:function(){let e=this.translate("noSmtpSetup","messages","Email");var t=$("<a>").attr("href","#EmailAccount").text(this.translate("EmailAccount","scopeNamesPlural")).get(0).outerHTML;return e=e.replace("{link}",t),{list:this.list,noSmtpMessage:e,...i.prototype.data.call(this)}},setup:function(){i.prototype.setup.call(this),this.nameHash={...this.model.get("nameHash")||{}},this.typeHash=this.model.get("typeHash")||{},this.idHash=this.model.get("idHash")||{},this.list=this.getUser().get("emailAddressList")||[]},afterRenderEdit:function(){this.$element.length&&e.init(this.$element)},getValueForDisplay:function(){var e;return this.isDetailMode()?(e=this.model.get(this.name),this.getDetailAddressHtml(e)):i.prototype.getValueForDisplay.call(this)},getDetailAddressHtml:function(e){if(!e)return"";var t=this.nameHash[e]||null,i=this.typeHash[e]||null,s=this.idHash[e]||null;if(s&&t)return $("<div>").append($("<a>").attr("href",`#${i}/view/`+s).attr("data-scope",i).attr("data-id",s).text(t)," ",$("<span>").addClass("text-muted chevron-right")," ",$("<span>").text(e)).get(0).outerHTML;let a=$("<div>");return t?a.append($("<span>").addClass("email-address-line").text(t).append(" ",$("<span>").addClass("text-muted chevron-right")," ",$("<span>").text(e))):a.append($("<span>").addClass("email-address-line").text(e)),a.get(0).outerHTML}})}),define("views/email/fields/body",["views/fields/wysiwyg"],function(e){return e.extend({useIframe:!0,getAttributeList:function(){return["body","bodyPlain"]},setupToolbar:function(){e.prototype.setupToolbar.call(this),this.toolbar.unshift(["insert-field",["insert-field"]]),this.buttons["insert-field"]=function(e){return $.summernote.ui.button({contents:'<i class="fas fa-plus"></i>',tooltip:this.translate("Insert Field","labels","Email"),click:function(){this.showInsertFieldModal()}.bind(this)}).render()}.bind(this),this.listenTo(this.model,"change",function(e){this.isRendered()&&(e.hasChanged("parentId")||e.hasChanged("to"))&&this.controInsertFieldButton()},this)},afterRender:function(){e.prototype.afterRender.call(this),this.controInsertFieldButton()},controInsertFieldButton:function(){var e=this.$el.find(".note-insert-field > button");this.model.get("to")&&this.model.get("to").length||this.model.get("parentId")?e.removeAttr("disabled").removeClass("disabled"):e.attr("disabled","disabled").addClass("disabled")},showInsertFieldModal:function(){var e=(e=this.model.get("to"))&&e.split(";")[0].trim(),t=this.model.get("parentId"),i=this.model.get("parentType");Espo.Ui.notify(" ... "),this.createView("insertFieldDialog","views/email/modals/insert-field",{parentId:t,parentType:i,to:e},function(e){e.render(),Espo.Ui.notify(),this.listenToOnce(e,"insert",function(e){this.$summernote&&(~e.indexOf("\n")?(e=e.replace(/(?:\r\n|\r|\n)/g,"<br>"),this.$summernote.summernote("editor.pasteHTML","<p>"+e+"</p>")):this.$summernote.summernote("editor.insertText",e)),this.clearView("insertFieldDialog")},this)})}})}),define("views/dashboard-template/detail",["views/detail"],function(e){return e.extend({actionDeployToUsers:function(){this.createView("dialog","views/dashboard-template/modals/deploy-to-users",{model:this.model},function(e){e.render()},this)},actionDeployToTeam:function(){this.createView("dialog","views/dashboard-template/modals/deploy-to-team",{model:this.model},function(e){e.render()},this)}})}),define("views/dashboard-template/record/list",["views/record/list"],function(e){return e.extend({massActionList:["remove","export"]})}),define("views/dashboard-template/modals/deploy-to-users",["views/modal","model"],function(e,t){return e.extend({className:"dialog dialog-record",templateContent:'<div class="record">{{{record}}}</div>',setup:function(){this.buttonList=[{name:"deploy",text:this.translate("Deploy for Users","labels","DashboardTemplate"),style:"danger"},{name:"cancel",label:"Cancel"}],this.headerText=this.model.get("name"),this.formModel=new t,this.formModel.name="None",this.formModel.setDefs({fields:{users:{type:"linkMultiple",view:"views/fields/users",entity:"User",required:!0},append:{type:"bool"}}}),this.createView("record","views/record/edit-for-modal",{scope:"None",model:this.formModel,selector:".record",detailLayout:[{rows:[[{name:"users",labelText:this.translate("users","links")},{name:"append",labelText:this.translate("append","fields","DashboardTemplate")}]]}]})},actionDeploy:function(){this.getView("record").processFetch()&&Espo.Ajax.postRequest("DashboardTemplate/action/deployToUsers",{id:this.model.id,userIdList:this.formModel.get("usersIds"),append:this.formModel.get("append")}).then(()=>{Espo.Ui.success(this.translate("Done")),this.close()})}})}),define("views/dashboard-template/modals/deploy-to-team",["views/modal","model"],function(e,t){return e.extend({className:"dialog dialog-record",templateContent:'<div class="record">{{{record}}}</div>',setup:function(){this.buttonList=[{name:"deploy",text:this.translate("Deploy for Team","labels","DashboardTemplate"),style:"danger"},{name:"cancel",label:"Cancel"}],this.headerText=this.model.get("name"),this.formModel=new t,this.formModel.name="None",this.formModel.setDefs({fields:{team:{type:"link",entity:"Team",required:!0},append:{type:"bool"}}}),this.createView("record","views/record/edit-for-modal",{scope:"None",model:this.formModel,selector:".record",detailLayout:[{rows:[[{name:"team",labelText:this.translate("team","links")},{name:"append",labelText:this.translate("append","fields","DashboardTemplate")}]]}]})},actionDeploy:function(){this.getView("record").processFetch()&&Espo.Ajax.postRequest("DashboardTemplate/action/deployToTeam",{id:this.model.id,teamId:this.formModel.get("teamId"),append:this.formModel.get("append")}).then(()=>{Espo.Ui.success(this.translate("Done")),this.close()})}})}),define("views/attachment/record/list",["views/record/list"],function(e){return e.extend({rowActionsView:"views/record/row-actions/view-and-remove",massActionList:["remove"]})}),define("views/attachment/record/detail",["views/record/detail"],function(e){return e.extend({readOnly:!0})}),define("views/attachment/modals/select-one",["views/modal"],function(e){return e.extend({backdrop:!0,templateContent:'<ul class="list-group no-side-margin">{{#each viewObject.options.dataList}}<li class="list-group-item"><a role="button" class="action" data-action="select" data-id="{{id}}">{{name}}</a></li>{{/each}}</ul>',setup:function(){this.headerText=this.translate("Select"),this.options.fieldLabel&&(this.headerText+=": "+this.options.fieldLabel)},actionSelect:function(e){this.trigger("select",e.id),this.remove()}})}),define("views/attachment/modals/detail",["views/modals/detail"],function(e){return e.extend({editDisabled:!0})}),define("views/attachment/fields/parent",["views/fields/link-parent"],function(e){return e.extend({ignoreScopeList:["Preferences","ExternalAccount","Notification","Note","ArrayValue","Attachment"],displayEntityType:!0,setup:function(){e.prototype.setup.call(this),this.foreignScopeList=this.getMetadata().getScopeEntityList().filter(e=>{if((this.getUser().isAdmin()||this.getAcl().checkScopeHasAcl(e))&&!~this.ignoreScopeList.indexOf(e)&&this.getAcl().checkScope(e))return!0}),this.getLanguage().sortEntityList(this.foreignScopeList),this.foreignScope=this.model.get(this.typeName)||this.foreignScopeList[0]}})}),define("views/attachment/fields/name",["views/fields/varchar"],function(i){return i.extend({detailTemplate:"attachment/fields/name/detail",data:function(){var e=i.prototype.data.call(this),t=this.getBasePath()+"?entryPoint=download&id="+this.model.id;return this.getUser().get("portalId")&&(t+="&portalId="+this.getUser().get("portalId")),e.url=t,e}})}),define("views/api-user/list",["views/list"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this)},getCreateAttributes:function(){return{type:"api"}}})}),define("views/address-map/view",["views/main"],function(e){return e.extend({templateContent:`
            <div class="header page-header">{{{header}}}</div>
            <div class="map-container">{{{map}}}</div>
        `,setup:function(){this.scope=this.model.entityType,this.createView("header","views/header",{model:this.model,fullSelector:"#main > .header",scope:this.model.entityType,fontSizeFlexible:!0})},afterRender:function(){var e=this.options.field,t=this.model.getFieldParam(e+"Map","view")||this.getFieldManager().getViewName("map");this.createView("map",t,{model:this.model,name:e+"Map",selector:".map-container",height:this.getHelper().calculateContentContainerHeight(this.$el.find(".map-container"))},e=>{e.render()})},getHeader:function(){let e=this.model.get("name");e=e||this.model.id;var t="#"+this.model.entityType+"/view/"+this.model.id,i=this.getLanguage().translate(this.model.entityType,"scopeNamesPlural"),s=this.translate(this.options.field,"fields",this.model.entityType),a=this.options.rootUrl||this.options.params.rootUrl||"#"+this.model.entityType;let n=$("<a>").attr("href",t).append($("<span>").addClass("font-size-flexible title").text(e)),o=(this.model.get("deleted")&&n.css("text-decoration","line-through"),$("<span>").append($("<a>").attr("href",a).addClass("action").attr("data-action","navigateToRoot").text(i)));t=this.getHeaderIconHtml(),t&&o.prepend(t),a=$("<span>").text(s);return this.buildHeaderHtml([o,n,a])}})}),define("views/action-history-record/record/list",["views/record/list"],function(e){return e.extend({rowActionsView:"views/record/row-actions/view-and-remove",massActionList:["remove","export"]})}),define("views/action-history-record/modals/detail",["views/modals/detail"],function(e){return e.extend({fullFormDisabled:!0,editDisabled:!0,sideDisabled:!0})}),define("views/action-history-record/fields/target",["views/fields/link-parent"],function(e){return e.extend({displayScopeColorInListMode:!0,ignoreScopeList:["Preferences","ExternalAccount","Notification","Note","ArrayValue"],setup:function(){e.prototype.setup.call(this),this.foreignScopeList=this.getMetadata().getScopeEntityList().filter(e=>{if((this.getUser().isAdmin()||this.getAcl().checkScopeHasAcl(e))&&!~this.ignoreScopeList.indexOf(e)&&this.getAcl().checkScope(e))return!0}),this.getLanguage().sortEntityList(this.foreignScopeList),this.foreignScope=this.model.get(this.typeName)||this.foreignScopeList[0]}})}),define("views/action-history-record/fields/target-type",["views/fields/enum"],function(e){return e.extend({setupOptions:function(){e.prototype.setupOptions.call(this),this.params.options=this.getMetadata().getScopeEntityList()}})}),define("helpers/misc/list-select-attributes",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t,i){this.scope=e,this.storage=t,this.key="textSearches",this.maxCount=i||100,this.list=null}match(e,t){var i;e=e.toLowerCase().trim();let s=[];for(i of this.get())if(i.toLowerCase().startsWith(e)&&s.push(i),void 0!==t&&s.length===t)break;return s}get(){return null===this.list&&(this.list=this.getFromStorage()),this.list}getFromStorage(){return this.storage.get(this.key,this.scope)||[]}store(e){e=e.trim();let t=this.getFromStorage();var i=t.indexOf(e);-1!==i&&t.splice(i,1),t.unshift(e),t.length>this.maxCount&&(t=t.slice(0,this.maxCount)),this.list=t,this.storage.set(this.key,this.scope,t)}remove(e){e=e.trim();let t=this.getFromStorage();e=t.indexOf(e);-1!==e&&(t.splice(e,1),this.list=t,this.storage.set(this.key,this.scope,t))}}}),define("handlers/working-time-range",["exports","bullbone"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i{constructor(e){this.view=e}process(){this.listenTo(this.view.model,"change:dateStart",(e,t,i)=>{i.ui&&!e.get("dateEnd")&&setTimeout(()=>e.set("dateEnd",t),50)})}}Object.assign(i.prototype,t.Events),e.default=i}),define("handlers/import",["exports","action-handler"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{actionErrorExport(){Espo.Ajax.postRequest(`Import/${this.view.model.id}/exportErrors`).then(e=>{var t;if(!e.attachmentId)return t=this.view.translate("noErrors","messages","Import"),void Espo.Ui.warning(t);window.location=this.view.getBasePath()+"?entryPoint=download&id="+e.attachmentId})}}e.default=s}),define("handlers/email-filter",["exports","dynamic-handler"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{init(){this.model.isNew()&&(this.recordView.getUser().isAdmin()||this.recordView.hideField("isGlobal")),this.model.isNew()||this.recordView.getUser().isAdmin()||this.model.get("isGlobal")||this.recordView.hideField("isGlobal"),this.model.isNew()&&!this.model.get("parentId")?(this.model.set("parentType","User"),this.model.set("parentId",this.recordView.getUser().id),this.model.set("parentName",this.recordView.getUser().get("name")),this.recordView.getUser().isAdmin()||this.recordView.setFieldReadOnly("parent")):this.model.get("parentType")&&!this.recordView.options.duplicateSourceId&&(this.recordView.setFieldReadOnly("parent"),this.recordView.setFieldReadOnly("isGlobal")),this.recordView.listenTo(this.model,"change:isGlobal",(e,t,i)=>{i.ui&&t&&this.model.set({action:"Skip",parentName:null,parentType:null,parentId:null,emailFolderId:null,groupEmailFolderId:null,markAsRead:!1})}),this.recordView.listenTo(this.model,"change:parentType",(e,t,i)=>{i.ui&&setTimeout(()=>("User"!==t&&this.model.set("markAsRead",!1),"EmailAccount"===t?(this.model.set("action","Skip"),this.model.set("emailFolderId",null),this.model.set("groupEmailFolderId",null),void this.model.set("markAsRead",!1)):"InboundEmail"!==t?("Move to Group Folder"===this.model.get("action")&&this.model.set("action","Skip"),void this.model.set("groupEmailFolderId",null)):void("User"!==t&&("Move to Folder"===this.model.get("action")&&this.model.set("action","Skip"),this.model.set("groupFolderId",null)))),40)})}}e.default=s}),define("handlers/select-related/same-account",["exports","handlers/select-related"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getFilters(e){let t={},i=null,s=null;return e.get("accountId")&&(i=e.get("accountId"),s=e.get("accountName")),!i&&"Account"===e.get("parentType")&&e.get("parentId")&&(i=e.get("parentId"),s=e.get("parentName")),i&&(t.account={attribute:"accountId",type:"equals",value:i,data:{type:"is",nameValue:s}}),Promise.resolve({advanced:t})}}e.default=s}),define("handlers/select-related/same-account-many",["exports","handlers/select-related"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getFilters(e){let t={},i=null,s=null;if(e.get("accountId")&&(i=e.get("accountId"),s=e.get("accountName")),!i&&"Account"===e.get("parentType")&&e.get("parentId")&&(i=e.get("parentId"),s=e.get("parentName")),i){let e={};e[i]=s,t.accounts={field:"accounts",type:"linkedWith",value:[i],data:{nameHash:e}}}return Promise.resolve({advanced:t})}}e.default=s}),define("handlers/login/oidc",["exports","handlers/login","js-base64"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{process(){return Espo.Ui.notify(" ... "),new Promise((i,t)=>{Espo.Ajax.getRequest("Oidc/authorizationData").then(e=>{Espo.Ui.notify(!1),this.processWithData(e).then(e=>{var t=e.code,e=e.nonce,t=s.default.encode("**oidc:"+t);i({"Espo-Authorization":t,Authorization:"Basic "+t,"X-Oidc-Authorization-Nonce":e})}).catch(()=>{t()})}).catch(()=>{Espo.Ui.notify(!1),t()})})}processWithData(e){var t=(Math.random()+1).toString(36).substring(7),i=(Math.random()+1).toString(36).substring(7);let s={client_id:e.clientId,redirect_uri:e.redirectUri,response_type:"code",scope:e.scopes.join(" "),state:t,nonce:i,prompt:e.prompt},a=(!e.maxAge&&0!==e.maxAge||(s.max_age=e.maxAge),e.claims&&(s.claims=e.claims),Object.entries(s).map(([e,t])=>e+"="+encodeURIComponent(t)));e=e.endpoint+"?"+a.join("&");return this.processWindow(e,t,i)}processWindow(e,n,o){let l=window.open(e,"ConnectWithOAuth","location=0,status=0,width=800,height=800");return new Promise((i,e)=>{let s=()=>{window.clearInterval(a),l.closed||l.close(),e()},a=window.setInterval(()=>{if(l.closed)s();else{let e;try{e=l.location.href}catch(e){return}var t;if(e)return(t=this.parseWindowUrl(e))?(t.error||t.code)&&t.state!==n?(s(),void Espo.Ui.error("State mismatch",!0)):t.error?(s(),void Espo.Ui.error(t.errorDescription||this.loginView.translate("Error"),!0)):void(t.code&&(window.clearInterval(a),l.close(),i({code:t.code,nonce:o}))):(s(),void Espo.Ui.error("Could not parse URL",!0))}},300)})}parseWindowUrl(t){try{let e=new URL(t).searchParams;return{code:e.get("code"),state:e.get("state"),error:e.get("error"),errorDescription:e.get("errorDescription")}}catch(e){return null}}}e.default=a}),define("acl-portal/preferences",["exports","acl-portal"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkIsOwner(e){return this.getUser().id===e.id}}e.default=s}),define("acl-portal/notification",["exports","acl-portal"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkIsOwner(e){return this.getUser().id===e.get("userId")}}e.default=s}),define("acl-portal/email",["exports","acl-portal"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkModelRead(e,t,i){var s=this.checkModel(e,t,"read",i);if(s)return!0;if(!1===t)return!1;if("no"===(t||{}).read)return!1;if(e.has("usersIds")){if(~(e.get("usersIds")||[]).indexOf(this.getUser().id))return!0}else if(i)return null;return s}}e.default=s});
//# sourceMappingURL=espo-extra.js.map