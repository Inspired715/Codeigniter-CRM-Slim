/*! espocrm 2023-09-18 */
define("views/admin/layouts/base",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{scope;type;events={'click button[data-action="save"]':function(){this.actionSave()},'click button[data-action="cancel"]':function(){this.cancel()},'click button[data-action="resetToDefault"]':function(){this.confirm(this.translate("confirmation","messages"),()=>{this.resetToDefault()})},'click button[data-action="remove"]':function(){this.actionDelete()}};buttonList=[{name:"save",label:"Save",style:"primary"},{name:"cancel",label:"Cancel"}];dataAttributes=null;dataAttributesDefs=null;dataAttributesDynamicLogicDefs=null;setup(){this.buttonList=_.clone(this.buttonList),this.events=_.clone(this.events),this.scope=this.options.scope,this.type=this.options.type,this.setId=this.options.setId,this.em=this.options.em;var e=this.getMetadata().get(["clientDefs",this.scope,"additionalLayouts",this.type])??{};this.typeDefs=e,this.dataAttributeList=Espo.Utils.clone(e.dataAttributeList||this.dataAttributeList),this.isCustom=!!e.isCustom,this.isCustom&&this.em&&this.buttonList.push({name:"remove",label:"Remove"}),this.isCustom||this.buttonList.push({name:"resetToDefault",label:"Reset to Default"})}actionSave(){this.disableButtons(),Espo.Ui.notify(this.translate("saving","messages")),this.save(this.enableButtons.bind(this))}disableButtons(){this.$el.find(".button-container button").attr("disabled","disabled")}enableButtons(){this.$el.find(".button-container button").removeAttr("disabled")}setConfirmLeaveOut(e){this.getRouter().confirmLeaveOut=e}setIsChanged(){this.isChanged=!0,this.setConfirmLeaveOut(!0)}setIsNotChanged(){this.isChanged=!1,this.setConfirmLeaveOut(!1)}save(e){var t=this.fetch();if(!this.validate(t))return this.enableButtons(),!1;this.getHelper().layoutManager.set(this.scope,this.type,t,()=>{Espo.Ui.success(this.translate("Saved")),this.setIsNotChanged(),"function"==typeof e&&e(),this.getHelper().broadcastChannel.postMessage("update:layout")},this.setId).catch(()=>this.enableButtons())}resetToDefault(){this.getHelper().layoutManager.resetToDefault(this.scope,this.type,()=>{this.loadLayout(()=>{this.setIsNotChanged(),this.prepareLayout().then(()=>this.reRender())})},this.options.setId)}prepareLayout(){return Promise.resolve()}reset(){this.render()}fetch(){}unescape(e){if(null===e)return"";var t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#x27;":"'"},i=new RegExp("("+_.keys(t).join("|")+")","g");return(""+e).replace(i,e=>t[e])}getEditAttributesModalViewOptions(e){return{name:e.name,scope:this.scope,attributeList:this.dataAttributeList,attributeDefs:this.dataAttributesDefs,dynamicLogicDefs:this.dataAttributesDynamicLogicDefs,attributes:e,languageCategory:this.languageCategory,headerText:" "}}openEditDialog(e){let s=e.name;e=this.getEditAttributesModalViewOptions(e);this.createView("editModal","views/admin/layouts/modals/edit-attributes",e,a=>{a.render(),this.listenToOnce(a,"after:save",e=>{this.trigger("update-item",s,e);let t=$("#layout ul > li[data-name='"+s+"']");for(var i in e)t.attr("data-"+i,e[i]),t.data(i,e[i]),t.find("."+i+"-value").text(e[i]);a.close(),this.setIsChanged()})})}cancel(){this.loadLayout(()=>{this.setIsNotChanged(),this.em?this.trigger("cancel"):this.prepareLayout().then(()=>this.reRender())})}validate(e){return!0}actionDelete(){this.confirm(this.translate("confirmation","messages")).then(()=>{this.disableButtons(),Espo.Ui.notify(" ... "),Espo.Ajax.postRequest("Layout/action/delete",{scope:this.scope,name:this.type}).then(()=>{Espo.Ui.success(this.translate("Removed"),{suppress:!0}),this.trigger("after-delete")}).catch(()=>{this.enableButtons()})})}}e.default=a}),define("views/admin/layouts/rows",["views/admin/layouts/base"],function(e){return e.extend({template:"admin/layouts/rows",dataAttributeList:null,dataAttributesDefs:{},editable:!1,data:function(){return{scope:this.scope,type:this.type,buttonList:this.buttonList,enabledFields:this.enabledFields,disabledFields:this.disabledFields,layout:this.rowLayout,dataAttributeList:this.dataAttributeList,dataAttributesDefs:this.dataAttributesDefs,editable:this.editable}},setup:function(){this.itemsData={},e.prototype.setup.call(this),this.events['click a[data-action="editItem"]']=e=>{e=$(e.target).closest("li").data("name");this.editRow(e)},this.on("update-item",(e,t)=>{this.itemsData[e]=Espo.Utils.cloneDeep(t)}),Espo.loader.require("res!client/css/misc/layout-manager-rows.css",e=>{this.$style=$("<style>").html(e).appendTo($("body"))})},onRemove:function(){this.$style&&this.$style.remove()},editRow:function(e){var t=Espo.Utils.cloneDeep(this.itemsData[e]||{});t.name=e,this.openEditDialog(t)},afterRender:function(){$("#layout ul.enabled, #layout ul.disabled").sortable({connectWith:"#layout ul.connected",update:e=>{$(e.target).hasClass("disabled")||(this.onDrop(e),this.setIsChanged())}}),this.$el.find(".enabled-well").focus()},onDrop:function(e){},fetch:function(){var s=[];return $("#layout ul.enabled > li").each((e,t)=>{var i={},t=$(t).data("name"),a=this.itemsData[t]||{};a.name=t,this.dataAttributeList.forEach(e=>{var t=a[e]||null;t&&(i[e]=t)}),s.push(i)}),s},validate:function(e){return 0!==e.length||(this.notify("Layout cannot be empty","error"),!1)}})}),define("views/admin/layouts/side-panels-detail",["views/admin/layouts/rows"],function(e){return e.extend({dataAttributeList:["name","dynamicLogicVisible","style","dynamicLogicStyled","sticked"],dataAttributesDefs:{dynamicLogicVisible:{type:"base",view:"views/admin/field-manager/fields/dynamic-logic-conditions",tooltip:"dynamicLogicVisible"},style:{type:"enum",options:["default","success","danger","warning"],default:"default",translation:"LayoutManager.options.style",tooltip:"panelStyle"},dynamicLogicStyled:{type:"base",view:"views/admin/field-manager/fields/dynamic-logic-conditions",tooltip:"dynamicLogicStyled"},sticked:{type:"bool",tooltip:"sticked"},name:{readOnly:!0}},dataAttributesDynamicLogicDefs:{fields:{dynamicLogicStyled:{visible:{conditionGroup:[{type:"and",value:[{attribute:"style",type:"notEquals",value:"default"},{attribute:"style",type:"isNotEmpty"}]}]}}}},editable:!0,ignoreList:[],ignoreTypeList:[],viewType:"detail",setup:function(){e.prototype.setup.call(this),this.dataAttributesDefs=Espo.Utils.cloneDeep(this.dataAttributesDefs),this.dataAttributesDefs.dynamicLogicVisible.scope=this.scope,this.dataAttributesDefs.dynamicLogicStyled.scope=this.scope,this.wait(!0),this.loadLayout(()=>{this.wait(!1)})},loadLayout:function(t){this.getHelper().layoutManager.getOriginal(this.scope,this.type,this.setId,e=>{this.readDataFromLayout(e),t&&t()})},readDataFromLayout:function(l){var t=[],r={},d={};l=Espo.Utils.cloneDeep(l),!1===this.getMetadata().get(["clientDefs",this.scope,"defaultSidePanel",this.viewType])||this.getMetadata().get(["clientDefs",this.scope,"defaultSidePanelDisabled"])||(t.push("default"),r.default="Default"),(this.getMetadata().get(["clientDefs",this.scope,"sidePanels",this.viewType])||[]).forEach(e=>{e.name&&(t.push(e.name),e.label&&(r[e.name]=e.label),d[e.name]=e)}),this.disabledFields=[],l=l||{},this.rowLayout=[],t.push("_delimiter_"),l._delimiter_||(l._delimiter_={disabled:!0}),t.forEach((t,e)=>{let i=!1;var a,s,n=l[t]||{};if(n.disabled&&(i=!0),l[t]||(d[t]||{}).disabled&&(i=!0),a=r[t]?this.getLanguage().translate(r[t],"labels",this.scope):this.getLanguage().translate(t,"panels",this.scope),i){let e={name:t,label:a};return"_"===e.name[0]&&(e.notEditable=!0,"_delimiter_"===e.name&&(e.label=". . .")),void this.disabledFields.push(e)}let o={name:t,label:a};for(s in"_"===o.name[0]&&(o.notEditable=!0,"_delimiter_"===o.name&&(o.label=". . .")),o.name in d&&this.dataAttributeList.forEach(e=>{var t;"name"===e||e in(t=d[o.name]||{})&&(o[e]=t[e])}),n)o[s]=n[s];o.index="index"in n?n.index:e,this.rowLayout.push(o),this.itemsData[o.name]=Espo.Utils.cloneDeep(o)}),this.rowLayout.sort((e,t)=>e.index-t.index)},fetch:function(){let n={};return $("#layout ul.disabled > li").each((e,t)=>{t=$(t).attr("data-name");n[t]={disabled:!0}}),$("#layout ul.enabled > li").each((e,t)=>{let i=$(t),a={};t=i.attr("data-name");let s=this.itemsData[t]||{};s.name=t,this.dataAttributeList.forEach(e=>{"name"!==e&&e in s&&(a[e]=s[e])}),a.index=e,n[t]=a}),n}})}),define("views/admin/dynamic-logic/conditions-string/item-base",["view"],function(e){return e.extend({template:"admin/dynamic-logic/conditions-string/item-base",data:function(){return{valueViewKey:this.getValueViewKey(),scope:this.scope,operator:this.operator,operatorString:this.operatorString,field:this.field}},setup:function(){this.itemData=this.options.itemData,this.level=this.options.level||0,this.number=this.options.number||0,this.scope=this.options.scope,this.operator=this.options.operator||this.operator,this.operatorString=this.options.operatorString||this.operatorString,this.additionalData=this.itemData.data||{},this.field=(this.itemData.data||{}).field||this.itemData.attribute,this.wait(!0),this.getModelFactory().create(this.scope,function(e){this.model=e,this.populateValues(),this.createValueFieldView(),this.wait(!1)},this)},populateValues:function(){this.itemData.attribute&&this.model.set(this.itemData.attribute,this.itemData.value),this.model.set(this.additionalData.values||{})},getValueViewKey:function(){return"view-"+this.level.toString()+"-"+this.number.toString()+"-0"},createValueFieldView:function(){var e=this.getValueViewKey(),t=this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"type"])||"base",t=this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"view"])||this.getFieldManager().getViewName(t);this.createView("value",t,{model:this.model,name:this.field,selector:'[data-view-key="'+e+'"]'})}})}),define("views/admin/layouts/grid",["views/admin/layouts/base"],function(e){return e.extend({template:"admin/layouts/grid",dataAttributeList:null,panels:null,columnCount:2,panelDataAttributeList:["panelName","style"],panelDataAttributesDefs:{},panelDynamicLogicDefs:null,data:function(){return{scope:this.scope,type:this.type,buttonList:this.buttonList,enabledFields:this.enabledFields,disabledFields:this.disabledFields,panels:this.panels,columnCount:this.columnCount,panelDataList:this.getPanelDataList()}},emptyCellTemplate:'<li class="empty disabled cell"><a role="button" data-action="minusCell" class="remove-field"><i class="fas fa-minus"></i></a></li>',additionalEvents:{'click #layout a[data-action="addPanel"]':function(){this.addPanel(),this.setIsChanged(),this.makeDraggable()},'click #layout a[data-action="removePanel"]':function(e){$(e.target).closest("ul.panels > li").find("ul.cells > li").each((e,t)=>{$(t).attr("data-name")&&$(t).appendTo($("#layout ul.disabled"))}),$(e.target).closest("ul.panels > li").remove();var i=$(e.currentTarget).data("number"),a=(this.clearView("panels-"+i),-1);this.panels.forEach((e,t)=>{e.number===i&&(a=t)}),~a&&this.panels.splice(a,1),this.normalizeDisabledItemList(),this.setIsChanged()},'click #layout a[data-action="addRow"]':function(e){var t=this.unescape($("#layout-row-tpl").html()),t=_.template(t);$(e.target).closest("ul.panels > li").find("ul.rows").append(t),this.setIsChanged(),this.makeDraggable()},'click #layout a[data-action="removeRow"]':function(e){$(e.target).closest("ul.rows > li").find("ul.cells > li").each((e,t)=>{$(t).attr("data-name")&&$(t).appendTo($("#layout ul.disabled"))}),$(e.target).closest("ul.rows > li").remove(),this.normalizeDisabledItemList(),this.setIsChanged()},'click #layout a[data-action="removeField"]':function(e){var e=$(e.target).closest("li"),t=e.index(),i=e.parent(),a=(e.appendTo($("ul.disabled")),$($("#empty-cell-tpl").html()));if(1===parseInt(i.attr("data-cell-count")))for(var s=0;s<this.columnCount;s++)i.append(a.clone());else 0==t?i.prepend(a):a.insertAfter(i.children(":nth-child("+t+")"));e=i.children().length;i.attr("data-cell-count",e.toString()),i.closest("li").attr("data-cell-count",e.toString()),this.setIsChanged(),this.makeDraggable()},'click #layout a[data-action="minusCell"]':function(e){var t;this.columnCount<2||(t=(e=$(e.currentTarget).closest("li")).parent(),e.remove(),e=parseInt(t.children().length||2),this.setIsChanged(),this.makeDraggable(),t.attr("data-cell-count",e.toString()),t.closest("li").attr("data-cell-count",e.toString()))},'click #layout a[data-action="plusCell"]':function(e){let t=$(e.currentTarget).closest("li"),i=t.find("ul");e=$($("#empty-cell-tpl").html());i.append(e);let a=i.children().length;i.attr("data-cell-count",a.toString()),i.closest("li").attr("data-cell-count",a.toString()),this.setIsChanged(),this.makeDraggable()},'click #layout a[data-action="edit-panel-label"]':function(e){let t=$(e.target).closest("header"),i=t.children("label");e=i.text();let a=t.closest("li").data("number").toString(),s={panelName:e};this.panelDataAttributeList.forEach(e=>{"panelName"!==e&&(s[e]=this.panelsData[a][e])});var e=this.panelDataAttributeList,n=this.panelDataAttributesDefs;this.createView("dialog","views/admin/layouts/modals/panel-attributes",{attributeList:e,attributeDefs:n,attributes:s,dynamicLogicDefs:this.panelDynamicLogicDefs},e=>{e.render(),this.listenTo(e,"after:save",t=>{i.text(t.panelName),i.attr("data-is-custom","true"),this.panelDataAttributeList.forEach(e=>{"panelName"!==e&&(this.panelsData[a][e]=t[e])}),e.close(),this.$el.find(".well").focus(),this.setIsChanged()})})}},normalizeDisabledItemList:function(){},setup:function(){e.prototype.setup.call(this),this.events={...this.additionalEvents,...this.events},this.panelsData={},Espo.loader.require("res!client/css/misc/layout-manager-grid.css",e=>{this.$style=$("<style>").html(e).appendTo($("body"))})},onRemove:function(){this.$style&&this.$style.remove()},addPanel:function(){this.lastPanelNumber++;let e=this.lastPanelNumber;var t,i={customLabel:null,rows:[[]],number:e};this.panels.push(i);let a={};for(t in this.panelDataAttributesDefs){var s=this.panelDataAttributesDefs[t];"default"in s&&(a[t]=s.default)}this.panelsData[e.toString()]=a;var n=$('<li class="panel-layout"></li>');n.attr("data-number",e),this.$el.find("ul.panels").append(n),this.createPanelView(i,!0,e=>{e.render()})},getPanelDataList:function(){var i=[];return this.panels.forEach(e=>{var t={};t.viewKey="panel-"+e.number,t.number=e.number,i.push(t)}),i},prepareLayout:function(){return new Promise(e=>{let t=0;this.setupPanels(()=>{++t===this.panels.length&&e()})})},setupPanels:function(i){this.lastPanelNumber=-1,this.panels=Espo.Utils.cloneDeep(this.panels),this.panels.forEach((e,t)=>{e.number=t,this.lastPanelNumber++,this.createPanelView(e,!1,i),this.panelsData[t.toString()]=e})},createPanelView:function(e,a,t){e.label=e.label||"",e.isCustomLabel=!1,e.customLabel?(e.labelTranslated=e.customLabel,e.isCustomLabel=!0):e.labelTranslated=this.translate(e.label,"labels",this.scope),e.style=e.style||null,e.rows.forEach(t=>{var e,i=this.columnCount-t.length;if(a)for(let e=0;e<i;e++)t.push(!1);for(e in t)!1!==t[e]&&(t[e].label=this.getLanguage().translate(t[e].name,"fields",this.scope),"customLabel"in t[e]&&(t[e].hasCustomLabel=!0))}),this.createView("panel-"+e.number,"view",{selector:'li.panel-layout[data-number="'+e.number+'"]',template:"admin/layouts/grid-panel",data:()=>{var t=Espo.Utils.clone(e);return t.dataAttributeList=[],this.panelDataAttributeList.forEach(e=>{"panelName"!==e&&t.dataAttributeList.push(e)}),t}},t)},makeDraggable:function(){var s=this;$("#layout ul.panels").sortable({distance:4,update:()=>{this.setIsChanged()}}),$("#layout ul.panels").disableSelection(),$("#layout ul.rows").sortable({distance:4,connectWith:".rows",update:()=>{this.setIsChanged()}}),$("#layout ul.rows").disableSelection(),$("#layout ul.cells > li").draggable({revert:"invalid",revertDuration:200,zIndex:10}).css("cursor","pointer"),$("#layout ul.cells > li").droppable().droppable("destroy"),$("#layout ul.cells:not(.disabled) > li").droppable({accept:".cell",zIndex:10,hoverClass:"ui-state-hover",drop:function(e,t){var i=t.draggable.index(),a=t.draggable.parent();a.get(0)==$(this).parent().get(0)?$(this).index()<t.draggable.index()?$(this).before(t.draggable):$(this).after(t.draggable):(t.draggable.insertAfter($(this)),0==i?$(this).prependTo(a):$(this).insertAfter(a.children(":nth-child("+i+")"))),$(this),$(t.draggable);t.draggable.css({top:0,left:0}),$(this).parent().hasClass("disabled")&&!$(this).data("name")&&$(this).remove(),s.makeDraggable(),s.setIsChanged()}})},afterRender:function(){this.makeDraggable();let e=this.$el.find(".enabled-well").get(0);e.focus({preventScroll:!0})},fetch:function(){var o=[];return $("#layout ul.panels > li").each((e,t)=>{var i=$(t).find("header label"),a=$(t).data("number").toString(),n={rows:[]},s=(this.panelDataAttributeList.forEach(e=>{"panelName"!==e&&(n[e]=this.panelsData[a][e])}),n.style=n.style||"default",$(t).find("header").data("name"));s&&(n.name=s),i.attr("data-is-custom")?n.customLabel=i.text():n.label=i.data("label"),$(t).find("ul.rows > li").each((e,t)=>{var s=[];$(t).find("ul.cells > li").each((e,i)=>{var a=!1;$(i).hasClass("empty")||(a={},this.dataAttributeList.forEach(e=>{var t;"customLabel"!==e?(t=$(i).data(Espo.Utils.toDom(e))||null)&&(a[e]=t):$(i).get(0).hasAttribute("data-custom-label")&&(a[e]=$(i).attr("data-custom-label"))})),s.push(a)}),n.rows.push(s)}),o.push(n)}),o},validate:function(e){let t=0;return e.forEach(e=>{e.rows.forEach(e=>{e.forEach(e=>{!1!==e&&null!==e&&t++})})}),0!==t||(Espo.Ui.error(this.translate("cantBeEmpty","messages","LayoutManager")),!1)}})}),define("views/admin/layouts/default-page",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{templateContent=`
        <div class="margin-bottom">{{translate 'selectLayout' category='messages' scope='Admin'}}</div>
        <div class="button-container">
            <button data-action="createLayout" class="btn btn-link">{{translate 'Create'}}</button>
        </div>
    `}e.default=a}),define("views/admin/layouts/bottom-panels-detail",["views/admin/layouts/side-panels-detail"],function(s){return s.extend({hasStream:!0,hasRelationships:!0,TAB_BREAK_KEY:"_tabBreak_{n}",setup:function(){s.prototype.setup.call(this),this.on("update-item",(t,i)=>{if(this.isTabName(t)){let e=$("#layout ul > li[data-name='"+t+"']");e.find(".left > span").text(this.composeTabBreakLabel(i))}})},composeTabBreakLabel:function(e){let t=". . . "+this.translate("tabBreak","fields","LayoutManager");return e.tabLabel&&(t+=" : "+e.tabLabel),t},readDataFromLayout:function(l){let t=[],r={},d={};for(var e in l=Espo.Utils.cloneDeep(l),this.hasStream&&this.getMetadata().get(["scopes",this.scope,"stream"])&&(t.push("stream"),r.stream=this.translate("Stream"),d.stream={name:"stream",sticked:!0,index:2}),(this.getMetadata().get(["clientDefs",this.scope,"bottomPanels",this.viewType])||[]).forEach(e=>{e.name&&(t.push(e.name),e.label&&(r[e.name]=e.label),d[e.name]=Espo.Utils.clone(e),"order"in e&&(d[e.name].index=e.order))}),l){var i=l[e];i.tabBreak&&(t.push(e),r[e]=this.composeTabBreakLabel(i),d[e]={name:i.name,index:i.index,tabBreak:!0,tabLabel:i.tabLabel||null})}var a;this.links={},this.hasRelationships&&(a=this.getMetadata().get(["entityDefs",this.scope,"links"])||{},Object.keys(a).forEach(e=>{var i;a[e].disabled||a[e].utility||a[e].layoutRelationshipsDisabled||~["hasMany","hasChildren"].indexOf(a[e].type)&&(t.push(e),r[e]=this.translate(e,"links",this.scope),i={name:e,index:5},this.dataAttributeList.forEach(e=>{var t;e in i||null!==(t=this.getMetadata().get(["clientDefs",this.scope,"relationshipPanels",i.name,e]))&&(i[e]=t)}),this.links[e]=!0,d[i.name]=i)})),this.disabledFields=[],l=l||{},this.rowLayout=[],(t=t.sort((e,t)=>d[e].index-d[t].index)).push("_delimiter_"),l._delimiter_||(l._delimiter_={disabled:!0}),r[this.TAB_BREAK_KEY]=". . . "+this.translate("tabBreak","fields","LayoutManager"),t.push(this.TAB_BREAK_KEY),t.forEach((t,e)=>{var i,a=!1,s=l[t]||{};if(s.disabled&&(a=!0),l[t]||(d[t]||{}).disabled&&(a=!0),this.links[t]&&(l[t]||(a=!0)),t===this.TAB_BREAK_KEY&&(a=!0),i=r[t]?this.getLanguage().translate(r[t],"labels",this.scope):this.getLanguage().translate(t,"panels",this.scope),a){let e={name:t,label:i};return"_"===e.name[0]&&"_delimiter_"===e.name&&(e.notEditable=!0,e.label=". . ."),void this.disabledFields.push(e)}var n,o={name:t,label:i};for(n in"_"===o.name[0]&&"_delimiter_"===o.name&&(o.notEditable=!0,o.label=". . ."),o.name in d&&this.dataAttributeList.forEach(e=>{var t;"name"===e||e in(t=d[o.name]||{})&&(o[e]=t[e])}),s)o[n]=s[n];o.index="index"in s?s.index:e,this.rowLayout.push(o),this.itemsData[o.name]=Espo.Utils.cloneDeep(o)}),this.rowLayout.sort((e,t)=>(e.index||0)-(t.index||0))},onDrop:function(){let s=-1,a=null;this.$el.find("ul.enabled").children().each((e,t)=>{let i=$(t),a=i.attr("data-name");this.isTabName(a)&&(a===this.TAB_BREAK_KEY||(t=parseInt(a.split("_")[2]))>s&&(s=t))}),s++,this.$el.find("ul.enabled").children().each((e,t)=>{let i=$(t);var t=i.attr("data-name");this.isTabName(t)&&t===this.TAB_BREAK_KEY&&(a=i.clone(),t=this.TAB_BREAK_KEY.slice(0,-3)+s,i.attr("data-name",t),delete this.itemsData[t])}),a||this.$el.find("ul.disabled").children().each((e,t)=>{let i=$(t);t=i.attr("data-name");this.isTabName(t)&&t!==this.TAB_BREAK_KEY&&i.remove()}),a&&a.appendTo(this.$el.find("ul.disabled"))},isTabName:function(e){return e.substring(0,this.TAB_BREAK_KEY.length-3)===this.TAB_BREAK_KEY.slice(0,-3)},getEditAttributesModalViewOptions:function(e){let t=s.prototype.getEditAttributesModalViewOptions.call(this,e);return this.isTabName(e.name)&&(t.attributeList=["tabLabel"],t.attributeDefs={tabLabel:{type:"varchar"}}),t},fetch:function(){var e,t,i=s.prototype.fetch.call(this);let a={};for(e in i)i[e].disabled&&this.links[e]||(a[e]=i[e],this.isTabName(e)&&e!==this.TAB_BREAK_KEY?(t=this.itemsData[e]||{},a[e].tabBreak=!0,a[e].tabLabel=t.tabLabel):(delete a[e].tabBreak,delete a[e].tabLabel));return delete a[this.TAB_BREAK_KEY],a}})}),define("views/admin/layouts/modals/create",["exports","views/modal","views/record/edit-for-modal","model","views/fields/enum","views/fields/varchar"],function(e,t,i,a,s,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=o(t),i=o(i),a=o(a),s=o(s),n=o(n);class l extends t.default{templateContent=`
        <div class="complex-text-container">{{complexText info}}</div>
        <div class="record no-side-margin">{{{record}}}</div>
    `;className="dialog dialog-record";constructor(e){super(),this.scope=e.scope}data(){return{info:this.translate("createInfo","messages","LayoutManager")}}setup(){this.headerText=this.translate("Create"),this.buttonList=[{name:"create",style:"danger",label:"Create",onClick:()=>this.actionCreate()},{name:"cancel",label:"Cancel"}],this.model=new a.default({type:"list",name:"listForMyEntityType",label:"List (for MyEntityType)"}),this.recordView=new i.default({model:this.model,detailLayout:[{columns:[[{view:new s.default({name:"type",params:{readOnly:!0,translation:"Admin.layouts",options:["list"]},labelText:this.translate("type","fields","Admin")})},{view:new n.default({name:"name",params:{required:!0,noSpellCheck:!0,pattern:"$latinLetters"},labelText:this.translate("name","fields")})},{view:new n.default({name:"label",params:{required:!0,pattern:"$noBadCharacters"},labelText:this.translate("label","fields","Admin")})}],[]]}]}),this.assignView("record",this.recordView,".record")}actionCreate(){this.recordView.fetch(),this.recordView.validate()||(this.disableButton("create"),Espo.Ui.notify(" ... "),Espo.Ajax.postRequest("Layout/action/create",{scope:this.scope,type:this.model.get("type"),name:this.model.get("name"),label:this.model.get("label")}).then(()=>{this.reRender(),Espo.Ui.success("Created",{suppress:!0}),this.trigger("done"),this.close()}).catch(()=>{this.enableButton("create")}))}}e.default=l}),define("views/admin/dynamic-logic/conditions-string/item-operator-only-base",["views/admin/dynamic-logic/conditions-string/item-base"],function(e){return e.extend({template:"admin/dynamic-logic/conditions-string/item-operator-only-base",createValueFieldView:function(){}})}),define("views/outbound-email/fields/test-send",["views/fields/base"],function(e){return e.extend({templateContent:'<button class="btn btn-default hidden" data-action="sendTestEmail">'+"{{translate 'Send Test Email' scope='Email'}}</button>",events:{'click [data-action="sendTestEmail"]':function(){this.send()}},fetch:function(){return{}},checkAvailability:function(){this.model.get("smtpServer")?this.$el.find("button").removeClass("hidden"):this.$el.find("button").addClass("hidden")},afterRender:function(){this.checkAvailability(),this.stopListening(this.model,"change:smtpServer"),this.listenTo(this.model,"change:smtpServer",()=>{this.checkAvailability()})},getSmtpData:function(){return{server:this.model.get("smtpServer"),port:this.model.get("smtpPort"),auth:this.model.get("smtpAuth"),security:this.model.get("smtpSecurity"),username:this.model.get("smtpUsername"),password:this.model.get("smtpPassword")||null,fromName:this.model.get("outboundEmailFromName"),fromAddress:this.model.get("outboundEmailFromAddress"),type:"outboundEmail"}},send:function(){var i=this.getSmtpData();this.createView("popup","views/outbound-email/modals/test-send",{emailAddress:this.getUser().get("emailAddress")},t=>{t.render(),this.listenToOnce(t,"send",e=>{this.$el.find("button").addClass("disabled"),i.emailAddress=e,this.notify("Sending..."),t.close(),Espo.Ajax.postRequest("Email/sendTest",i).then(()=>{this.$el.find("button").removeClass("disabled"),Espo.Ui.success(this.translate("testEmailSent","messages","Email"))}).catch(e=>{i=(i=e.getResponseHeader("X-Status-Reason")||"").replace(/ $/,"").replace(/,$/,"");var t=this.translate("Error");if(200!==e.status&&(t+=" "+e.status),e.responseText)try{var i=JSON.parse(e.responseText).message||i}catch(e){return void console.error("Could not parse error response body.")}i&&(t+=": "+i),Espo.Ui.error(t,!0),console.error(t),e.errorIsHandled=!0,this.$el.find("button").removeClass("disabled")})})})}})}),define("views/role/record/table",["view"],function(e){return e.extend({template:"role/table",scopeList:null,actionList:["create","read","edit","delete","stream"],accessList:["not-set","enabled","disabled"],fieldLevelList:["yes","no"],fieldActionList:["read","edit"],levelListMap:{recordAllTeamOwnNo:["all","team","own","no"],recordAllTeamNo:["all","team","no"],recordAllOwnNo:["all","own","no"],recordAllNo:["all","no"],record:["all","team","own","no"]},type:"acl",levelList:["yes","all","team","own","no"],booleanLevelList:["yes","no"],booleanActionList:["create"],defaultLevels:{delete:"no"},colors:{yes:"#6BC924",all:"#6BC924",account:"#999900",contact:"#999900",team:"#999900",own:"#CC9900",no:"#F23333",enabled:"#6BC924",disabled:"#F23333","not-set":"#A8A8A8"},mode:"detail",tableData:null,data:function(){var e={},t=(e.editMode="edit"===this.mode,e.actionList=this.actionList,e.accessList=this.accessList,e.fieldActionList=this.fieldActionList,e.fieldLevelList=this.fieldLevelList,e.colors=this.colors,e.tableDataList=this.getTableDataList(),e.fieldTableDataList=this.fieldTableDataList,!1);return this.fieldTableDataList.forEach(e=>{e.list.length&&(t=!0)}),e.hasFieldLevelData=t,e},events:{'click .action[data-action="addField"]':function(e){e=$(e.currentTarget).data().scope;this.showAddFieldModal(e)},'click .action[data-action="removeField"]':function(e){var t=$(e.currentTarget).data().scope,e=$(e.currentTarget).data().field;this.removeField(t,e)},'change select[data-type="access"]':function(e){var t=$(e.currentTarget).attr("name"),t=this.$el.find('select[data-scope="'+t+'"]');"enabled"===$(e.currentTarget).val()?(t.removeAttr("disabled"),t.removeClass("hidden"),t.each((e,t)=>{let i=$(t);var a,s;this.lowestLevelByDefault?i.find("option").last().prop("selected",!0):(t=!0,a=null,!(a=(s=i.data("role-action"))?this.defaultLevels[s]:a)||(s=i.find('option[value="'+a+'"]')).length&&(s.prop("selected",!0),t=!1),t&&i.find("option").first().prop("selected",!0)),i.trigger("change"),this.controlSelectColor(i)})):(t.attr("disabled","disabled"),t.addClass("hidden")),this.controlSelectColor($(e.currentTarget))},"change select.scope-action":function(e){this.controlSelectColor($(e.currentTarget))},"change select.field-action":function(e){this.controlSelectColor($(e.currentTarget))}},getTableDataList:function(){var l=this.acl.data,e=[];return this.scopeList.forEach(a=>{var s="not-set",n=(this.final&&(s="enabled"),a in l&&(s=!1===l[a]?"disabled":"enabled"),[]),o=this.aclTypeMap[a];"boolean"!==this.aclTypeMap[a]&&this.actionList.forEach(e=>{var t,i=this.getMetadata().get(["scopes",a,this.type+"ActionList"]);!i||~i.indexOf(e)?"stream"!==e||this.getMetadata().get("scopes."+a+".stream")?(i="no",~this.booleanActionList.indexOf(e)&&(i="no"),a in l&&("enabled"===s?!0!==l[a]&&e in l[a]&&(i=l[a][e]):i="no"),t=this.getMetadata().get(["scopes",a,this.type+"ActionLevelListMap",e])||this.getMetadata().get(["scopes",a,this.type+"LevelList"])||this.levelListMap[o]||[],~this.booleanActionList.indexOf(e)&&(t=this.booleanLevelList),n.push({level:i,name:a+"-"+e,action:e,levelList:t})):n.push({action:"stream",levelList:!1,level:null}):n.push({action:e,levelList:!1,level:null})}),e.push({list:n,access:s,name:a,type:o})}),e},setup:function(){this.mode=this.options.mode||"detail",this.final=this.options.final||!1,this.setupData(),this.listenTo(this.model,"change",()=>{(this.model.hasChanged("data")||this.model.hasChanged("fieldData"))&&this.setupData()}),this.listenTo(this.model,"sync",()=>{this.setupData(),this.isRendered()&&this.reRender()}),this.template="role/table","edit"===this.mode&&(this.template="role/table-edit"),this.once("remove",()=>{$(window).off("scroll.scope-"+this.cid),$(window).off("resize.scope-"+this.cid),$(window).off("scroll.field-"+this.cid),$(window).off("resize.field-"+this.cid)})},setupData:function(){this.acl={},this.options.acl?this.acl.data=this.options.acl.data:this.acl.data=Espo.Utils.cloneDeep(this.model.get("data")||{}),this.options.acl?this.acl.fieldData=this.options.acl.fieldData:this.acl.fieldData=Espo.Utils.cloneDeep(this.model.get("fieldData")||{}),this.setupScopeList(),this.setupFieldTableDataList()},setupScopeList:function(){this.aclTypeMap={},this.scopeList=[],Object.keys(this.getMetadata().get("scopes")).sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural"))).forEach(e=>{var t;this.getMetadata().get("scopes."+e+".disabled")||(t=this.getMetadata().get("scopes."+e+".acl"))&&(this.scopeList.push(e),!0===(this.aclTypeMap[e]=t)&&(this.aclTypeMap[e]="record"))})},setupFieldTableDataList:function(){this.fieldTableDataList=[],this.scopeList.forEach(e=>{if((this.getMetadata().get("scopes."+e)||{}).entity){if(!(e in this.acl.fieldData))return"edit"===this.mode?void this.fieldTableDataList.push({name:e,list:[]}):void 0;var a=this.acl.fieldData[e],t=this.getFieldManager().getEntityTypeFieldList(e),s=(this.getLanguage().sortFieldList(e,t),[]);t.forEach(t=>{var i;t in a&&(i=[],this.fieldActionList.forEach(e=>{i.push({name:e,value:a[t][e]||"yes"})}),"detail"===this.mode&&!i.length||s.push({name:t,list:i}))}),this.fieldTableDataList.push({name:e,list:s})}})},fetchScopeData:function(){var e,t={},i=this.scopeList,a=this.actionList,s=this.aclTypeMap;for(e in i){var n=i[e];if("not-set"!==this.$el.find('select[name="'+n+'"]').val())if("disabled"===this.$el.find('select[name="'+n+'"]').val())t[n]=!1;else{var o=!0;if("boolean"!==s[n])for(var l in o={},a){l=a[l];o[l]=this.$el.find('select[name="'+n+"-"+l+'"]').val()}t[n]=o}}return t},fetchFieldData:function(){var i={};return this.fieldTableDataList.forEach(e=>{var t={},s=e.name;e.list.forEach(e=>{var i=e.name,a={};this.fieldActionList.forEach(e=>{var t=this.$el.find('select[data-scope="'+s+'"][data-field="'+i+'"][data-action="'+e+'"]');t.length&&(a[e]=t.val())}),t[i]=a}),i[s]=t}),i},afterRender:function(){"edit"===this.mode&&(this.scopeList.forEach(t=>{var i=this.$el.find('select[name="'+t+'-read"]'),a=(i.on("change",()=>{var e=i.val();this.controlEditSelect(t,e),this.controlDeleteSelect(t,e),this.controlStreamSelect(t,e)}),this.$el.find('select[name="'+t+'-edit"]'));a.on("change",()=>{var e=a.val();this.controlDeleteSelect(t,e)}),this.controlEditSelect(t,i.val(),!0),this.controlStreamSelect(t,i.val(),!0),this.controlDeleteSelect(t,a.val(),!0)}),this.fieldTableDataList.forEach(e=>{var a=e.name;e.list.forEach(e=>{var t=e.name,i=this.$el.find('select[data-scope="'+a+'"][data-field="'+t+'"][data-action="read"]');i.on("change",()=>{var e=i.val();this.controlFieldEditSelect(a,t,e)}),this.controlFieldEditSelect(a,t,i.val(),!0)})}),this.setSelectColors()),"edit"!==this.mode&&"detail"!==this.mode||(this.initStickyHeader("scope"),this.initStickyHeader("field"))},controlFieldEditSelect:function(e,t,i,a){e=this.$el.find('select[data-scope="'+e+'"][data-field="'+t+'"][data-action="edit"]');a||this.fieldLevelList.indexOf(e.val())<this.fieldLevelList.indexOf(i)&&e.val(i),e.find("option").each((e,t)=>{t=$(t);this.fieldLevelList.indexOf(t.val())<this.fieldLevelList.indexOf(i)?t.attr("disabled","disabled"):t.removeAttr("disabled")}),this.controlSelectColor(e)},controlEditSelect:function(e,i,t){e=this.$el.find('select[name="'+e+'-edit"]');t||this.levelList.indexOf(e.val())<this.levelList.indexOf(i)&&e.val(i),e.find("option").each((e,t)=>{t=$(t);this.levelList.indexOf(t.val())<this.levelList.indexOf(i)?t.attr("disabled","disabled"):t.removeAttr("disabled")}),this.controlSelectColor(e)},controlStreamSelect:function(e,i,t){e=this.$el.find('select[name="'+e+'-stream"]');t||this.levelList.indexOf(e.val())<this.levelList.indexOf(i)&&e.val(i),e.find("option").each((e,t)=>{t=$(t);this.levelList.indexOf(t.val())<this.levelList.indexOf(i)?t.attr("disabled","disabled"):t.removeAttr("disabled")}),this.controlSelectColor(e)},controlDeleteSelect:function(e,i,t){e=this.$el.find('select[name="'+e+'-delete"]');t||this.levelList.indexOf(e.val())<this.levelList.indexOf(i)&&e.val(i),e.find("option").each((e,t)=>{t=$(t);this.levelList.indexOf(t.val())<this.levelList.indexOf(i)?t.attr("disabled","disabled"):t.removeAttr("disabled")}),this.controlSelectColor(e)},showAddFieldModal:function(a){this.trigger("change");var e=Object.keys(this.acl.fieldData[a]||{});this.createView("addField","views/role/modals/add-field",{scope:a,ignoreFieldList:e,type:this.type},e=>{e.render(),this.listenTo(e,"add-field",i=>{e.close(),this.fieldTableDataList.forEach(e=>{var t;e.name===a&&(t=!1,e.list.forEach(e=>{e.name===i&&(t=!0)}),t||e.list.unshift({name:i,list:[{name:"read",value:"yes"},{name:"edit",value:"yes"}]}))}),this.reRender()})})},removeField:function(t,a){this.trigger("change"),this.fieldTableDataList.forEach(e=>{var i;e.name===t&&(i=-1,e.list.forEach((e,t)=>{e.name===a&&(i=t)}),~i&&(e.list.splice(i,1),this.reRender()))})},initStickyHeader:function(e){var t,n=this.$el.find(".sticky-header-"+e),o=$(window),l=this.getThemeManager().getParam("screenWidthXs"),r=$(".detail-button-container"),d=this.$el.find("table."+e+"-level");d.length&&r.length&&(t=()=>{var e,t,i,a,s;$(window.document).width()<l?n.addClass("hidden"):(e=r.get(0).getBoundingClientRect().top+r.outerHeight(),t=d.position().top,i=(t=(t=(t-=r.height())+d.find("tr > th").height())-this.getThemeManager().getParam("navbarHeight"))+d.outerHeight(!0)-r.height(),a=o.scrollTop(),s=d.width(),t<a&&a<i?(n.css({position:"fixed",marginTop:e+"px",top:0,width:s+"px",marginLeft:"1px"}),n.removeClass("hidden")):n.addClass("hidden"))},o.off("scroll."+e+"-"+this.cid),o.on("scroll."+e+"-"+this.cid,t),o.off("resize."+e+"-"+this.cid),o.on("resize."+e+"-"+this.cid,t))},setSelectColors:function(){this.$el.find('select[data-type="access"]').each((e,t)=>{t=$(t);this.controlSelectColor(t)}),this.$el.find("select.scope-action").each((e,t)=>{t=$(t);this.controlSelectColor(t)}),this.$el.find("select.field-action").each((e,t)=>{t=$(t);this.controlSelectColor(t)})},controlSelectColor:function(e){var t=e.val(),i=this.colors[t]||"";e.css("color",i="not-set"===t?"":i),e.children().each((e,t)=>{var t=$(t),i=t.val(),a=this.colors[i]||"";"not-set"===i&&(a=""),t.attr("disabled")&&(a=""),t.css("color",a)})}})}),define("views/role/record/list",["views/record/list"],function(e){return e.extend({quickDetailDisabled:!0,quickEditDisabled:!0,massActionList:["remove","export"],checkAllResultDisabled:!0})}),define("views/role/record/edit",["views/record/edit"],function(r){return r.extend({tableView:"views/role/record/table",sideView:!1,isWide:!0,stickButtonsContainerAllTheWay:!0,fetch:function(){var e,t=r.prototype.fetch.call(this),i=(t.data={},this.getView("extra").scopeList),a=this.getView("extra").actionList,s=this.getView("extra").aclTypeMap;for(e in i){var n=i[e];if("not-set"!==this.$el.find('select[name="'+n+'"]').val())if("disabled"===this.$el.find('select[name="'+n+'"]').val())t.data[n]=!1;else{var o=!0;if("boolean"!==s[n])for(var l in o={},a){l=a[l];o[l]=this.$el.find('select[name="'+n+"-"+l+'"]').val()}t.data[n]=o}}return t.data=this.getView("extra").fetchScopeData(),t.fieldData=this.getView("extra").fetchFieldData(),t},getDetailLayout:function(e){e({type:"record",layout:this._convertSimplifiedLayout([{label:"",cells:[{name:"name",type:"varchar"}]}])})},setup:function(){r.prototype.setup.call(this),this.createView("extra",this.tableView,{mode:"edit",selector:".extra",model:this.model},e=>{this.listenTo(e,"change",()=>{var e=this.fetch();this.model.set(e)})})}})}),define("views/role/record/detail",["views/record/detail"],function(e){return e.extend({tableView:"views/role/record/table",sideView:!1,isWide:!0,editModeDisabled:!0,stickButtonsContainerAllTheWay:!0,setup:function(){e.prototype.setup.call(this),this.createView("extra",this.tableView,{selector:".extra",model:this.model})}})}),define("views/inbound-email/record/detail",["views/record/detail"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.setupFieldsBehaviour(),this.initSslFieldListening()},modifyDetailLayout:function(e){e.filter(e=>"$label:SMTP"===e.tabLabel).forEach(e=>{e.rows.forEach(e=>{e.forEach(e=>{let t=this.translate(e.name,"fields","InboundEmail");t&&0===t.indexOf("SMTP ")&&(e.labelText=Espo.Utils.upperCaseFirst(t.substring(5)))})})})},wasFetched:function(){return!this.model.isNew()&&!!(this.model.get("fetchData")||{}).lastUID},initSmtpFieldsControl:function(){this.controlSmtpFields(),this.controlSentFolderField(),this.listenTo(this.model,"change:useSmtp",this.controlSmtpFields,this),this.listenTo(this.model,"change:smtpAuth",this.controlSmtpFields,this),this.listenTo(this.model,"change:storeSentEmails",this.controlSentFolderField,this)},controlSmtpFields:function(){if(this.model.get("useSmtp"))return this.showField("smtpHost"),this.showField("smtpPort"),this.showField("smtpAuth"),this.showField("smtpSecurity"),this.showField("smtpTestSend"),this.showField("fromName"),this.showField("smtpIsShared"),this.showField("smtpIsForMassEmail"),this.showField("storeSentEmails"),this.setFieldRequired("smtpHost"),this.setFieldRequired("smtpPort"),void this.controlSmtpAuthField();this.hideField("smtpHost"),this.hideField("smtpPort"),this.hideField("smtpAuth"),this.hideField("smtpUsername"),this.hideField("smtpPassword"),this.hideField("smtpAuthMechanism"),this.hideField("smtpSecurity"),this.hideField("smtpTestSend"),this.hideField("fromName"),this.hideField("smtpIsShared"),this.hideField("smtpIsForMassEmail"),this.hideField("storeSentEmails"),this.hideField("sentFolder"),this.setFieldNotRequired("smtpHost"),this.setFieldNotRequired("smtpPort"),this.setFieldNotRequired("smtpUsername")},controlSentFolderField:function(){if(this.model.get("useSmtp")&&this.model.get("storeSentEmails"))return this.showField("sentFolder"),void this.setFieldRequired("sentFolder");this.hideField("sentFolder"),this.setFieldNotRequired("sentFolder")},controlSmtpAuthField:function(){if(this.model.get("smtpAuth"))return this.showField("smtpUsername"),this.showField("smtpPassword"),this.showField("smtpAuthMechanism"),void this.setFieldRequired("smtpUsername");this.hideField("smtpUsername"),this.hideField("smtpPassword"),this.hideField("smtpAuthMechanism"),this.setFieldNotRequired("smtpUsername")},controlStatusField:function(){let e=["username","port","host","monitoredFolders"];"Active"===this.model.get("status")&&this.model.get("useImap")?e.forEach(e=>{this.setFieldRequired(e)}):e.forEach(e=>{this.setFieldNotRequired(e)})},setupFieldsBehaviour:function(){this.controlStatusField(),this.listenTo(this.model,"change:status",(e,t,i)=>{i.ui&&this.controlStatusField()}),this.listenTo(this.model,"change:useImap",(e,t,i)=>{i.ui&&this.controlStatusField()}),this.wasFetched()?this.setFieldReadOnly("fetchSince"):this.setFieldNotReadOnly("fetchSince"),this.initSmtpFieldsControl();let a=e=>{e.get("createCase")?this.showField("caseDistribution"):this.hideField("caseDistribution"),e.get("createCase")&&-1!==["Round-Robin","Least-Busy"].indexOf(e.get("caseDistribution"))?(this.setFieldRequired("team"),this.showField("targetUserPosition")):(this.setFieldNotRequired("team"),this.hideField("targetUserPosition")),e.get("createCase")&&"Direct-Assignment"===e.get("caseDistribution")?(this.setFieldRequired("assignToUser"),this.showField("assignToUser")):(this.setFieldNotRequired("assignToUser"),this.hideField("assignToUser")),e.get("createCase")&&""!==e.get("createCase")?this.showField("team"):this.hideField("team")};this.listenTo(this.model,"change:createCase",(e,t,i)=>{a(e),i.ui&&(e.get("createCase")||this.model.set({caseDistribution:"",teamId:null,teamName:null,assignToUserId:null,assignToUserName:null,targetUserPosition:""}))}),a(this.model),this.listenTo(this.model,"change:caseDistribution",(e,t,i)=>{a(e),i.ui&&setTimeout(()=>{this.model.get("caseDistribution")?("Direct-Assignment"===this.model.get("caseDistribution")&&this.model.set({targetUserPosition:""}),this.model.set({assignToUserId:null,assignToUserName:null})):this.model.set({assignToUserId:null,assignToUserName:null,targetUserPosition:""})},10)})},initSslFieldListening:function(){this.listenTo(this.model,"change:security",(e,t,i)=>{i.ui&&(t?this.model.set("port",993):this.model.set("port",143))}),this.listenTo(this.model,"change:smtpSecurity",(e,t,i)=>{i.ui&&("SSL"===t?this.model.set("smtpPort",465):"TLS"===t?this.model.set("smtpPort",587):this.model.set("smtpPort",25))})}})}),define("views/admin/index",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="admin/index";events={"click [data-action]":function(e){Espo.Utils.handleAction(this,e.originalEvent,e.currentTarget)},'keyup input[data-name="quick-search"]':function(e){this.processQuickSearch(e.currentTarget.value)}};data(){return{panelDataList:this.panelDataList,iframeUrl:this.iframeUrl,iframeHeight:this.getConfig().get("adminPanelIframeHeight")||1330,iframeDisabled:this.getConfig().get("adminPanelIframeDisabled")||!1}}afterRender(){let e=this.$el.find('input[data-name="quick-search"]');this.quickSearchText&&(e.val(this.quickSearchText),this.processQuickSearch(this.quickSearchText)),e.get(0).focus({preventScroll:!0})}setup(){this.panelDataList=[];var e,i=this.getMetadata().get("app.adminPanel")||{};for(e in i){let t=Espo.Utils.cloneDeep(i[e]);t.name=e,t.itemList=t.itemList||[],t.label=this.translate(t.label,"labels","Admin"),t.itemList&&t.itemList.forEach(e=>{e.label=this.translate(e.label,"labels","Admin"),e.description?e.keywords=(this.getLanguage().get("Admin","keywords",e.description)||"").split(","):e.keywords=[]}),t.items&&t.items.forEach(e=>{e.label=this.translate(e.label,"labels","Admin"),t.itemList.push(e),e.keywords=[]}),this.panelDataList.push(t)}this.panelDataList.sort((e,t)=>("order"in e||!("order"in t))&&"order"in t?e.order-t.order:0);let t=["version="+encodeURIComponent(this.getConfig().get("version")),"css="+encodeURIComponent(this.getConfig().get("siteUrl")+"/"+this.getThemeManager().getStylesheet())];this.iframeUrl=this.getConfig().get("adminPanelIframeUrl")||"https://s.espocrm.com/",~this.iframeUrl.indexOf("?")?this.iframeUrl+="&"+t.join("&"):this.iframeUrl+="?"+t.join("&"),this.getConfig().get("adminNotificationsDisabled")||this.createView("notificationsPanel","views/admin/panels/notifications",{selector:".notifications-panel-container"})}processQuickSearch(o){o=o.trim(),this.quickSearchText=o;let e=this.$noData||this.$el.find(".no-data");if(e.addClass("hidden"),!o)return this.$el.find(".admin-content-section").removeClass("hidden"),void this.$el.find(".admin-content-row").removeClass("hidden");o=o.toLowerCase(),this.$el.find(".admin-content-section").addClass("hidden"),this.$el.find(".admin-content-row").addClass("hidden");let l=!1;this.panelDataList.forEach((e,a)=>{let s=!1,n=!1;e.label&&0===e.label.toLowerCase().indexOf(o)&&(s=!0,n=!0),e.itemList.forEach((i,e)=>{if(i.label){let t=!1;if(!(t=(t=n?!0:t)||0===i.label.toLowerCase().indexOf(o))){let e=i.label.split(" ");e.forEach(e=>{0===e.toLowerCase().indexOf(o)&&(t=!0)}),(t=t||~i.keywords.indexOf(o))||3<o.length&&i.keywords.forEach(e=>{0===e.indexOf(o)&&(t=!0)})}t&&(s=!0,this.$el.find('.admin-content-section[data-index="'+a.toString()+'"] .admin-content-row[data-index="'+e.toString()+'"]').removeClass("hidden"),l=!0)}}),s&&(this.$el.find('.admin-content-section[data-index="'+a.toString()+'"]').removeClass("hidden"),l=!0)}),l||e.removeClass("hidden")}updatePageTitle(){this.setPageTitle(this.getLanguage().translate("Administration"))}actionClearCache(){this.trigger("clear-cache")}actionRebuild(){this.trigger("rebuild")}}e.default=a}),define("views/admin/link-manager/index",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="admin/link-manager/index";scope=null;data(){return{linkDataList:this.linkDataList,scope:this.scope}}events={'click a[data-action="editLink"]':function(e){e=$(e.currentTarget).data("link");this.editLink(e)},'click button[data-action="createLink"]':function(e){this.createLink()},'click [data-action="removeLink"]':function(e){var t=$(e.currentTarget).data("link");this.confirm(this.translate("confirmation","messages"),function(){this.removeLink(t)},this)},'keyup input[data-name="quick-search"]':function(e){this.processQuickSearch(e.currentTarget.value)}};computeRelationshipType(e,t){if("hasMany"==e)return"hasMany"==t?"manyToMany":"belongsTo"==t?"oneToMany":void 0;if("belongsTo"==e)return"hasMany"==t?"manyToOne":"hasOne"==t?"oneToOneRight":void 0;if("belongsToParent"==e){if("hasChildren"==t)return"childrenToParent"}else if("hasChildren"==e){if("belongsToParent"==t)return"parentToChildren"}else if("hasOne"===e&&"belongsTo"==t)return"oneToOneLeft"}setupLinkData(){this.linkDataList=[];var n=this.getMetadata().get("entityDefs."+this.scope+".links");Object.keys(n).sort((e,t)=>e.localeCompare(t)).forEach(e=>{var t=n[e],i=t.foreign;if("belongsToParent"===t.type)var a="childrenToParent";else{if(!t.entity)return;if(!i)return;var s=this.getMetadata().get("entityDefs."+t.entity+".links."+t.foreign+".type"),a=this.computeRelationshipType(t.type,s)}a&&this.linkDataList.push({link:e,isCustom:t.isCustom,isRemovable:t.isCustom,customizable:t.customizable,type:a,entityForeign:t.entity,entity:this.scope,labelEntityForeign:this.getLanguage().translate(t.entity,"scopeNames"),linkForeign:i,label:this.getLanguage().translate(e,"links",this.scope),labelForeign:this.getLanguage().translate(t.foreign,"links",t.entity)})})}setup(){this.scope=this.options.scope||null,this.setupLinkData(),this.on("after:render",()=>{this.renderHeader()})}afterRender(){this.$noData=this.$el.find(".no-data"),this.$el.find('input[data-name="quick-search"]').focus()}createLink(){this.createView("edit","views/admin/link-manager/modals/edit",{scope:this.scope},e=>{e.render(),this.listenTo(e,"after:save",()=>{this.clearView("edit"),this.setupLinkData(),this.render()}),this.listenTo(e,"close",()=>{this.clearView("edit")})})}editLink(e){this.createView("edit","views/admin/link-manager/modals/edit",{scope:this.scope,link:e},e=>{e.render(),this.listenTo(e,"after:save",()=>{this.clearView("edit"),this.setupLinkData(),this.render()}),this.listenTo(e,"close",()=>{this.clearView("edit")})})}removeLink(e){Espo.Ajax.postRequest("EntityManager/action/removeLink",{entity:this.scope,link:e}).then(()=>{this.$el.find('table tr[data-link="'+e+'"]').remove(),this.getMetadata().loadSkipCache().then(()=>{this.setupLinkData(),Espo.Ui.success(this.translate("Removed"),{suppress:!0}),this.reRender()})})}renderHeader(){this.scope?$("#scope-header").show().html(this.getLanguage().translate(this.scope,"scopeNames")):$("#scope-header").html("")}updatePageTitle(){this.setPageTitle(this.getLanguage().translate("Entity Manager","labels","Admin"))}processQuickSearch(e){e=e.trim();let t=this.$noData;if(t.addClass("hidden"),e){let o=[],l=e.toLowerCase();if(this.linkDataList.forEach(e=>{let t=!1,i=e.label||"",a=e.link||"",s=e.entityForeign||"",n=e.labelEntityForeign||"";if(!(t=0!==i.toLowerCase().indexOf(l)&&0!==a.toLowerCase().indexOf(l)&&0!==s.toLowerCase().indexOf(l)&&0!==n.toLowerCase().indexOf(l)?t:!0)){let e=a.split(" ").concat(i.split(" ")).concat(s.split(" ")).concat(n.split(" "));e.forEach(e=>{0===e.toLowerCase().indexOf(l)&&(t=!0)})}t&&o.push(a)}),0===o.length)return this.$el.find("table tr.link-row").addClass("hidden"),void t.removeClass("hidden");this.linkDataList.map(e=>e.link).forEach(e=>{~o.indexOf(e)?this.$el.find('table tr.link-row[data-link="'+e+'"]').removeClass("hidden"):this.$el.find('table tr.link-row[data-link="'+e+'"]').addClass("hidden")})}else this.$el.find("table tr.link-row").removeClass("hidden")}}e.default=a}),define("views/admin/layouts/list",["views/admin/layouts/rows"],function(e){return e.extend({dataAttributeList:["name","width","widthPx","link","notSortable","noLabel","align","view","customLabel","label"],dataAttributesDefs:{link:{type:"bool",tooltip:!0},width:{type:"float",min:0,max:100,tooltip:!0},widthPx:{type:"int",min:0,max:720,tooltip:!0},notSortable:{type:"bool",tooltip:!0},align:{type:"enum",options:["left","right"]},view:{type:"varchar",readOnly:!0},noLabel:{type:"bool",tooltip:!0},customLabel:{type:"varchar",readOnly:!0},name:{type:"varchar",readOnly:!0},label:{type:"varchar",readOnly:!0}},dataAttributesDynamicLogicDefs:{fields:{widthPx:{visible:{conditionGroup:[{attribute:"width",type:"isEmpty"}]}}}},editable:!0,languageCategory:"fields",ignoreList:[],ignoreTypeList:[],setup:function(){e.prototype.setup.call(this),this.wait(!0),this.loadLayout(()=>{this.wait(!1)})},loadLayout:function(i){this.getModelFactory().create(Espo.Utils.hyphenToUpperCamelCase(this.scope),t=>{this.getHelper().layoutManager.getOriginal(this.scope,this.type,this.setId,e=>{this.readDataFromLayout(t,e),i&&i()})})},readDataFromLayout:function(h,e){var t,i=[];for(t in h.defs.fields)this.checkFieldType(h.getFieldParam(t,"type"))&&this.isFieldEnabled(h,t)&&i.push(t);i.sort((e,t)=>this.translate(e,"fields",this.scope).localeCompare(this.translate(t,"fields",this.scope))),this.enabledFieldsList=[],this.enabledFields=[],this.disabledFields=[];var a,s,n=[],o=[];for(a in e){var l=this.getLanguage().translate(e[a].name,"fields",this.scope);~n.indexOf(l)&&o.push(l),n.push(l),this.enabledFields.push({name:e[a].name,label:l}),this.enabledFieldsList.push(e[a].name)}for(s in i)if(!_.contains(this.enabledFieldsList,i[s])){var r=this.getLanguage().translate(i[s],"fields",this.scope),d=(~n.indexOf(r)&&o.push(r),n.push(r),i[s]);let e={name:d,label:r};r=this.getMetadata().get(["entityDefs",this.scope,"fields",d,"type"]);r&&this.getMetadata().get(["fields",r,"notSortable"])&&(e.notSortable=!0,this.itemsData[d]=this.itemsData[d]||{},this.itemsData[d].notSortable=!0),this.disabledFields.push(e)}this.enabledFields.forEach(e=>{~o.indexOf(e.label)&&(e.label+=" ("+e.name+")")}),this.disabledFields.forEach(e=>{~o.indexOf(e.label)&&(e.label+=" ("+e.name+")")}),this.rowLayout=e;for(let i in this.rowLayout){let t=this.getLanguage().translate(this.rowLayout[i].name,"fields",this.scope);this.enabledFields.forEach(e=>{e.name===this.rowLayout[i].name&&(t=e.label)}),this.rowLayout[i].label=t,this.itemsData[this.rowLayout[i].name]=Espo.Utils.cloneDeep(this.rowLayout[i])}},checkFieldType:function(e){return!0},isFieldEnabled:function(e,t){if(-1!==this.ignoreList.indexOf(t))return!1;if(-1!==this.ignoreTypeList.indexOf(e.getFieldParam(t,"type")))return!1;var i=e.getFieldParam(t,"layoutAvailabilityList");return!i||~i.indexOf(this.type)?!e.getFieldParam(t,"disabled")&&!e.getFieldParam(t,"utility")&&!e.getFieldParam(t,"layoutListDisabled"):void 0}})}),define("views/admin/layouts/index",["exports","view","views/admin/layouts/default-page","views/admin/layouts/modals/create"],function(e,t,i,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i),a=s(a);class n extends t.default{template="admin/layouts/index";scopeList=null;baseUrl="#Admin/layouts";typeList=["list","detail","listSmall","detailSmall","bottomPanelsDetail","filters","massUpdate","sidePanelsDetail","sidePanelsEdit","sidePanelsDetailSmall","sidePanelsEditSmall"];scope=null;type=null;data(){return{scopeList:this.scopeList,typeList:this.typeList,scope:this.scope,layoutScopeDataList:this.getLayoutScopeDataList(),headerHtml:this.getHeaderHtml(),em:this.em}}setup(){this.addHandler("click","#layouts-menu a.layout-link","onLayoutLinkClick"),this.addHandler("click","a.accordion-toggle","onItemHeaderClick"),this.addHandler("keydown.shortcuts","","onKeyDown"),this.addActionHandler("createLayout",()=>this.actionCreateLayout()),this.em=this.options.em||!1,this.scope=this.options.scope||null,this.type=this.options.type||null,this.scopeList=[];let e=this.getMetadata().getScopeList().sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural")));e.forEach(e=>{this.getMetadata().get("scopes."+e+".entity")&&this.getMetadata().get("scopes."+e+".layouts")&&this.scopeList.push(e)}),this.em&&this.scope&&(this.scopeList=[this.scope]),this.on("after:render",()=>{$("#layouts-menu a[data-scope='"+this.options.scope+"'][data-type='"+this.options.type+"']").addClass("disabled"),this.renderLayoutHeader(),this.options.scope&&this.options.type||this.renderDefaultPage(),this.scope&&this.options.type&&this.openLayout(this.options.scope,this.options.type)})}afterRender(){this.controlActiveButton()}controlActiveButton(){if(this.scope){let e=this.$el.find(`.accordion-toggle[data-scope="${this.scope}"]`);this.undisableLinks(),this.em&&this.scope&&!this.type?e.addClass("disabled"):(e.removeClass("disabled"),this.$el.find(`a.layout-link[data-scope="${this.scope}"][data-type="${this.type}"]`).addClass("disabled"))}}onLayoutLinkClick(e){e.preventDefault();let t=$(e.target).data("scope"),i=$(e.target).data("type");this.getContentView()&&this.scope===t&&this.type===i||this.getRouter().checkConfirmLeaveOut(()=>{this.openLayout(t,i),this.controlActiveButton()})}openDefaultPage(){this.clearView("content"),this.type=null,this.renderDefaultPage(),this.controlActiveButton(),this.navigate(this.scope)}onItemHeaderClick(e){if(e.preventDefault(),this.em)return this.getContentView()?void this.getRouter().checkConfirmLeaveOut(()=>{this.openDefaultPage()}):void 0;let t=$(e.target);e=t.data("scope");let i=$('.collapse[data-scope="'+e+'"]');i.hasClass("in")?i.collapse("hide"):i.collapse("show")}onKeyDown(e){var t=Espo.Utils.getKeyFromKeyEvent(e);this.hasView("content")&&("Control+Enter"!==t&&"Control+KeyS"!==t||(e.stopPropagation(),e.preventDefault(),this.getContentView().actionSave()))}undisableLinks(){$("#layouts-menu a.layout-link").removeClass("disabled")}getContentView(){return this.getView("content")}openLayout(e,t){this.scope=e,this.type=t,this.navigate(e,t),Espo.Ui.notify(" ... ");var i=this.getMetadata().get("clientDefs."+e+".additionalLayouts."+t+".type")||t;this.createView("content","views/admin/layouts/"+Espo.Utils.camelCaseToHyphen(i),{fullSelector:"#layout-content",scope:e,type:t,setId:this.setId,em:this.em},e=>{this.renderLayoutHeader(),e.render(),Espo.Ui.notify(!1),$(window).scrollTop(0),this.em&&(this.listenToOnce(e,"cancel",()=>{this.openDefaultPage()}),this.listenToOnce(e,"after-delete",()=>{this.openDefaultPage(),Promise.all([this.getMetadata().loadSkipCache(),this.getLanguage().loadSkipCache()]).then(()=>{this.reRender()})}))})}navigate(e,t){let i="#Admin/layouts/scope="+e;t&&(i+="&type="+t),this.em&&(i+="&em=true"),this.getRouter().navigate(i,{trigger:!1})}renderDefaultPage(){$("#layout-header").html("").hide(),this.em?this.assignView("default",new i.default,"#layout-content").then(e=>{e.render()}):(this.clearView("default"),$("#layout-content").html(this.translate("selectLayout","messages","Admin")))}renderLayoutHeader(){let t=$("#layout-header");if(this.scope){let e=[];this.em||e.push($("<span>").text(this.translate(this.scope,"scopeNames"))),e.push($("<span>").text(this.translateLayoutName(this.type,this.scope)));var i=e.map(e=>e.get(0).outerHTML).join(' <span class="breadcrumb-separator"><span class="chevron-right"></span></span> ');t.show().html(i)}else t.html("")}updatePageTitle(){this.setPageTitle(this.getLanguage().translate("Layout Manager","labels","Admin"))}getHeaderHtml(){let e=[];var t=$("<a>").attr("href","#Admin").text(this.translate("Administration"));return e.push(t),this.em?(e.push($("<a>").attr("href","#Admin/entityManager").text(this.translate("Entity Manager","labels","Admin"))),this.scope&&(e.push($("<a>").attr("href","#Admin/entityManager/scope="+this.scope).text(this.translate(this.scope,"scopeNames"))),e.push($("<span>").text(this.translate("Layouts","labels","EntityManager"))))):e.push($("<span>").text(this.translate("Layout Manager","labels","Admin"))),e.map(e=>e.get(0).outerHTML).join(' <span class="breadcrumb-separator"><span class="chevron-right"></span></span> ')}translateLayoutName(e,t){return this.getLanguage().get(t,"layouts",e)?this.getLanguage().translate(e,"layouts",t):this.getLanguage().translate(e,"layouts","Admin")}getLayoutScopeDataList(){let n=[];return this.scopeList.forEach(i=>{let e={},t=Espo.Utils.clone(this.typeList);for(var a in e.scope=i,e.url=this.baseUrl+"/scope="+i,this.em&&(e.url+="&em=true"),this.getMetadata().get(["clientDefs",i,"bottomPanels","edit"])&&t.push("bottomPanelsEdit"),this.getMetadata().get(["clientDefs",i,"defaultSidePanelDisabled"])||this.getMetadata().get(["clientDefs",i,"defaultSidePanelFieldList"])||t.push("defaultSidePanel"),this.getMetadata().get(["clientDefs",i,"kanbanViewMode"])&&t.push("kanban"),this.getMetadata().get(["clientDefs",i,"additionalLayouts"])||{})t.push(a);t=t.filter(e=>!this.getMetadata().get(["clientDefs",i,"layout"+Espo.Utils.upperCaseFirst(e)+"Disabled"]));let s=[];t.forEach(e=>{let t=this.baseUrl+"/scope="+i+"&type="+e;this.em&&(t+="&em=true"),s.push({type:e,url:t,label:this.translateLayoutName(e,i)})}),e.typeList=t,e.typeDataList=s,n.push(e)}),n}actionCreateLayout(){var e=new a.default({scope:this.scope});this.assignView("dialog",e).then(e=>{e.render(),this.listenToOnce(e,"done",()=>{Promise.all([this.getMetadata().loadSkipCache(),this.getLanguage().loadSkipCache()]).then(()=>{this.reRender()})})})}}e.default=n}),define("views/admin/layouts/detail",["views/admin/layouts/grid"],function(t){return t.extend({dataAttributeList:["name","fullWidth","customLabel","noLabel"],panelDataAttributeList:["panelName","dynamicLogicVisible","style","dynamicLogicStyled","tabBreak","tabLabel","hidden"],dataAttributesDefs:{fullWidth:{type:"bool"},name:{readOnly:!0},label:{type:"varchar",readOnly:!0},customLabel:{type:"varchar",readOnly:!0},noLabel:{type:"bool",readOnly:!0}},panelDataAttributesDefs:{panelName:{type:"varchar"},style:{type:"enum",options:["default","success","danger","warning"],default:"default",translation:"LayoutManager.options.style",tooltip:"panelStyle"},dynamicLogicVisible:{type:"base",view:"views/admin/field-manager/fields/dynamic-logic-conditions"},dynamicLogicStyled:{type:"base",view:"views/admin/field-manager/fields/dynamic-logic-conditions",tooltip:"dynamicLogicStyled"},hidden:{type:"bool",tooltip:"hiddenPanel"},tabBreak:{type:"bool",tooltip:"tabBreak"},tabLabel:{type:"varchar"}},defaultPanelFieldList:["modifiedAt","createdAt","modifiedBy","createdBy"],panelDynamicLogicDefs:{fields:{tabLabel:{visible:{conditionGroup:[{attribute:"tabBreak",type:"isTrue"}]}},dynamicLogicStyled:{visible:{conditionGroup:[{attribute:"style",type:"notEquals",value:"default"}]}}}},setup:function(){t.prototype.setup.call(this),this.panelDataAttributesDefs=Espo.Utils.cloneDeep(this.panelDataAttributesDefs),this.panelDataAttributesDefs.dynamicLogicVisible.scope=this.scope,this.panelDataAttributesDefs.dynamicLogicStyled.scope=this.scope,this.wait(!0),this.loadLayout(()=>{this.setupPanels(),this.wait(!1)})},loadLayout:function(e){var a,s,t=[];t.push(new Promise(i=>{this.getModelFactory().create(this.scope,t=>{this.getHelper().layoutManager.getOriginal(this.scope,this.type,this.setId,e=>{a=e,s=t,i()})})})),["detail","detailSmall"].includes(this.type)&&t.push(new Promise(t=>{this.getHelper().layoutManager.getOriginal(this.scope,"sidePanels"+Espo.Utils.upperCaseFirst(this.type),this.setId,e=>{this.sidePanelsLayout=e,t()})})),t.push(new Promise(t=>{this.getMetadata().get(["clientDefs",this.scope,"layoutDefaultSidePanelDisabled"])||this.typeDefs.allFields?t():this.getHelper().layoutManager.getOriginal(this.scope,"defaultSidePanel",this.setId,e=>{this.defaultPanelFieldList=Espo.Utils.clone(this.defaultPanelFieldList),e.forEach(e=>{e=e.name;e&&(this.defaultPanelFieldList.includes(e=":assignedUser"===e?"assignedUser":e)||this.defaultPanelFieldList.push(e))}),t()})})),Promise.all(t).then(()=>{this.readDataFromLayout(s,a),e&&e()})},readDataFromLayout:function(e,t){var i,a,s=[];for(i in e.defs.fields)this.isFieldEnabled(e,i)&&s.push(i);for(a in this.enabledFields=[],this.disabledFields=[],(this.panels=t).forEach(e=>{e.rows.forEach(e=>{e.forEach((e,t)=>{this.enabledFields.push(e.name)})})}),s.sort((e,t)=>this.translate(e,"fields",this.scope).localeCompare(this.translate(t,"fields",this.scope))),s)_.contains(this.enabledFields,s[a])||this.disabledFields.push(s[a])},isFieldEnabled:function(e,t){if(this.hasDefaultPanel()&&this.defaultPanelFieldList.includes(t))return!1;var i=e.getFieldParam(t,"layoutAvailabilityList");return!i||i.includes(this.type)?!e.getFieldParam(t,"disabled")&&!e.getFieldParam(t,"utility")&&!e.getFieldParam(t,"layoutDetailDisabled"):void 0},hasDefaultPanel:function(){if(!1===this.getMetadata().get(["clientDefs",this.scope,"defaultSidePanel",this.viewType]))return!1;if(this.getMetadata().get(["clientDefs",this.scope,"defaultSidePanelDisabled"]))return!1;if(this.sidePanelsLayout)for(var e in this.sidePanelsLayout)if("default"===e&&this.sidePanelsLayout[e].disabled)return!1;return!0},validate:function(e){if(!t.prototype.validate.call(this,e))return!1;let a=[],s=(e.forEach(e=>{e.rows.forEach(e=>{e.forEach(e=>{!1!==e&&null!==e&&e.name&&a.push(e.name)})})}),[]),n=!1;return a.forEach(i=>{if(!n){let t=(this.getMetadata().get(["entityDefs",this.scope,"fields",i])||{}).detailLayoutIncompatibleFieldList||[];t.forEach(e=>{n||~a.indexOf(e)&&(n=!0,s=[i].concat(t))})}}),!n||(Espo.Ui.error(this.translate("fieldsIncompatible","messages","LayoutManager").replace("{fields}",s.map(e=>this.translate(e,"fields",this.scope)).join(", "))),!1)}})}),define("views/admin/layouts/bottom-panels-edit",["views/admin/layouts/bottom-panels-detail"],function(e){return e.extend({hasStream:!1,hasRelationships:!1,viewType:"edit"})}),define("views/admin/integrations/edit",["view","model"],function(e,t){return e.extend({template:"admin/integrations/edit",data:function(){return{integration:this.integration,dataFieldList:this.dataFieldList,helpText:this.helpText}},events:{'click button[data-action="cancel"]':function(){this.getRouter().navigate("#Admin/integrations",{trigger:!0})},'click button[data-action="save"]':function(){this.save()}},setup:function(){this.integration=this.options.integration,this.helpText=!1,this.getLanguage().has(this.integration,"help","Integration")&&(this.helpText=this.translate(this.integration,"help","Integration")),this.fieldList=[],this.dataFieldList=[],this.model=new t,this.model.id=this.integration,this.model.name="Integration",this.model.urlRoot="Integration",this.model.defs={fields:{enabled:{required:!0,type:"bool"}}},this.wait(!0),this.fields=this.getMetadata().get("integrations."+this.integration+".fields"),Object.keys(this.fields).forEach(e=>{this.model.defs.fields[e]=this.fields[e],this.dataFieldList.push(e)}),this.model.populateDefaults(),this.listenToOnce(this.model,"sync",()=>{this.createFieldView("bool","enabled"),Object.keys(this.fields).forEach(e=>{this.createFieldView(this.fields[e].type,e,null,this.fields[e])}),this.wait(!1)}),this.model.fetch()},hideField:function(e){this.$el.find('label[data-name="'+e+'"]').addClass("hide"),this.$el.find('div.field[data-name="'+e+'"]').addClass("hide");e=this.getView(e);e&&(e.disabled=!0)},showField:function(e){this.$el.find('label[data-name="'+e+'"]').removeClass("hide"),this.$el.find('div.field[data-name="'+e+'"]').removeClass("hide");e=this.getView(e);e&&(e.disabled=!1)},afterRender:function(){this.model.get("enabled")||this.dataFieldList.forEach(e=>{this.hideField(e)}),this.listenTo(this.model,"change:enabled",()=>{this.model.get("enabled")?this.dataFieldList.forEach(e=>{this.showField(e)}):this.dataFieldList.forEach(e=>{this.hideField(e)})})},createFieldView:function(e,t,i,a){e=this.model.getFieldParam(t,"view")||this.getFieldManager().getViewName(e);this.createView(t,e,{model:this.model,selector:'.field[data-name="'+t+'"]',defs:{name:t,params:a},mode:i?"detail":"edit",readOnly:i}),this.fieldList.push(t)},save:function(){this.fieldList.forEach(e=>{e=this.getView(e);e.readOnly||e.fetchToModel()});var t=!1;this.fieldList.forEach(e=>{e=this.getView(e);e&&!e.disabled&&(t=e.validate()||t)}),t?this.notify("Not valid","error"):(this.listenToOnce(this.model,"sync",()=>{this.notify("Saved","success")}),Espo.Ui.notify(this.translate("saving","messages")),this.model.save())}})}),define("views/admin/field-manager/fields/options",["views/fields/array"],function(t){return t.extend({maxItemLength:100,setup:function(){t.prototype.setup.call(this),this.translatedOptions={};let e=this.model.get(this.name)||[];e.forEach(e=>{this.translatedOptions[e]=this.getLanguage().translateOption(e,this.options.field,this.options.scope)}),this.model.fetchedAttributes.translatedOptions=this.translatedOptions},getItemHtml:function(e){var t=this.translatedOptions[e]||e;let i=$("<div>").addClass("list-group-item link-with-role form-inline").attr("data-value",e).append($("<div>").addClass("pull-left item-content").css("width","92%").css("display","inline-block").append($("<input>").attr("type","text").attr("data-name","translatedValue").attr("data-value",e).addClass("role form-control input-sm pull-right").attr("value",t).css("width","auto")).append($("<div>").addClass("item-text").text(e))).append($("<div>").css("width","8%").css("display","inline-block").css("vertical-align","top").append($("<a>").attr("role","button").attr("tabindex","0").addClass("pull-right").attr("data-value",e).attr("data-action","removeValue").append($("<span>").addClass("fas fa-times")))).append($("<br>").css("clear","both"));return i.get(0).outerHTML},fetch:function(){let a=t.prototype.fetch.call(this);return a[this.name].length?(a.translatedOptions={},(a[this.name]||[]).forEach(e=>{var t=e.replace(/"/g,'\\"');let i=this.$el.find('input[data-name="translatedValue"][data-value="'+t+'"]').val()||e;a.translatedOptions[e]=i.toString()})):(a[this.name]=null,a.translatedOptions={}),a}})}),define("views/admin/entity-manager/record/edit-formula",["exports","views/record/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="admin/entity-manager/record/edit-formula";data(){return{field:this.field,fieldKey:this.field+"Field"}}setup(){super.setup(),this.field=this.options.type;let e=null;"beforeSaveApiScript"===this.options.type&&(e=this.getRecordServiceFunctionDataList()),this.createField(this.field,"views/fields/formula",{targetEntityType:this.options.targetEntityType,height:500},"edit",!1,{additionalFunctionDataList:e})}getRecordServiceFunctionDataList(){return[{name:"recordService\\skipDuplicateCheck",insertText:"recordService\\skipDuplicateCheck()",returnType:"bool"},{name:"recordService\\throwDuplicateConflict",insertText:"recordService\\throwDuplicateConflict(RECORD_ID)"},{name:"recordService\\throwBadRequest",insertText:"recordService\\throwBadRequest(MESSAGE)"},{name:"recordService\\throwForbidden",insertText:"recordService\\throwForbidden(MESSAGE)"},{name:"recordService\\throwConflict",insertText:"recordService\\throwConflict(MESSAGE)"}]}}e.default=a}),define("views/admin/entity-manager/modals/export",["exports","views/modal","model","views/record/edit-for-modal","views/fields/varchar"],function(e,t,i,a,s){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=n(t),i=n(i),a=n(a),s=n(s);class o extends t.default{templateContent=`
        <div class="record-container no-side-margin">{{{record}}}</div>
    `;setup(){this.headerText=this.translate("Export"),this.buttonList=[{name:"export",label:"Export",style:"danger",onClick:()=>this.export()},{name:"cancel",label:"Cancel"}];var e=this.getConfig().get("customExportManifest")||{};this.model=new i.default({name:e.name??null,module:e.module??null,version:e.version??"0.0.1",author:e.author??null,description:e.description??null}),this.recordView=new a.default({model:this.model,detailLayout:[{rows:[[{view:new s.default({name:"name",labelText:this.translate("name","fields"),params:{pattern:"$latinLettersDigitsWhitespace",required:!0}})},{view:new s.default({name:"module",labelText:this.translate("module","fields","EntityManager"),params:{pattern:"[A-Z][a-z][A-Za-z]+",required:!0}})}],[{view:new s.default({name:"version",labelText:this.translate("version","fields","EntityManager"),params:{pattern:"[0-9]+\\.[0-9]+\\.[0-9]+",required:!0}})},!1],[{view:new s.default({name:"author",labelText:this.translate("author","fields","EntityManager"),params:{required:!0}})},{view:new s.default({name:"description",labelText:this.translate("description","fields"),params:{}})}]]}]}),this.assignView("record",this.recordView)}export(){const t=this.recordView.fetch();this.recordView.validate()||(this.disableButton("export"),Espo.Ui.notify(" ... "),Espo.Ajax.postRequest("EntityManager/action/exportCustom",t).then(e=>{this.close(),this.getConfig().set("customExportManifest",t),Espo.Ui.success(this.translate("Done")),window.location=this.getBasePath()+"?entryPoint=download&id="+e.id}).catch(()=>this.enableButton("create")))}}e.default=o}),define("views/admin/dynamic-logic/conditions-string/item-operator-only-date",["views/admin/dynamic-logic/conditions-string/item-operator-only-base"],function(t){return t.extend({template:"admin/dynamic-logic/conditions-string/item-operator-only-date",data:function(){var e=t.prototype.data.call(this);return e.dateValue=this.dateValue,e}})}),define("views/admin/dynamic-logic/conditions-string/group-base",["view"],function(e){return e.extend({template:"admin/dynamic-logic/conditions-string/group-base",data:function(){return this.conditionList.length?{viewDataList:this.viewDataList,operator:this.operator,level:this.level}:{isEmpty:!0}},setup:function(){this.level=this.options.level||0,this.number=this.options.number||0,this.scope=this.options.scope,this.operator=this.options.operator||this.operator,this.itemData=this.options.itemData||{},this.viewList=[];var a=this.conditionList=this.itemData.value||[];this.viewDataList=[],a.forEach(function(e,t){var i="view-"+this.level.toString()+"-"+this.number.toString()+"-"+t.toString();this.createItemView(t,i,e),this.viewDataList.push({key:i,isEnd:t===a.length-1})},this)},getFieldType:function(e){return this.getMetadata().get(["entityDefs",this.scope,"fields",e.attribute,"type"])||"base"},createItemView:function(e,t,i){this.viewList.push(t);var a,s,n=((i=i||{}).data||{}).type||i.type||"equals",o=this.getFieldType(i),o=this.getMetadata().get(["clientDefs","DynamicLogic","fieldTypes",o,"conditionTypes",n,"itemView"])||this.getMetadata().get(["clientDefs","DynamicLogic","itemTypes",n,"view"]);o&&(a=this.getMetadata().get(["clientDefs","DynamicLogic","itemTypes",n,"operator"]),s=(s=this.getMetadata().get(["clientDefs","DynamicLogic","itemTypes",n,"operatorString"]))||'<i class="small">'+(s=this.getLanguage().translateOption(n,"operators","DynamicLogic").toLowerCase())+"</i>",this.createView(t,o,{itemData:i,scope:this.scope,level:this.level+1,selector:'[data-view-key="'+t+'"]',number:e,operator:a,operatorString:s}))}})}),define("views/admin/dynamic-logic/conditions/group-base",["view"],function(e){return e.extend({template:"admin/dynamic-logic/conditions/group-base",data:function(){return{viewDataList:this.viewDataList,operator:this.operator,level:this.level,groupOperator:this.getGroupOperator()}},events:{'click > div.group-head > [data-action="remove"]':function(e){e.stopPropagation(),this.trigger("remove-item")},'click > div.group-bottom [data-action="addField"]':function(e){this.actionAddField()},'click > div.group-bottom [data-action="addAnd"]':function(e){this.actionAddGroup("and")},'click > div.group-bottom [data-action="addOr"]':function(e){this.actionAddGroup("or")},'click > div.group-bottom [data-action="addNot"]':function(e){this.actionAddGroup("not")}},setup:function(){this.level=this.options.level||0,this.number=this.options.number||0,this.scope=this.options.scope,this.itemData=this.options.itemData||{},this.viewList=[];var e=this.conditionList=this.itemData.value||[];this.viewDataList=[],e.forEach(function(e,t){var i=this.getKey(t);this.createItemView(t,i,e),this.addViewDataListItem(t,i)},this)},getGroupOperator:function(){return"or"===this.operator?"or":"and"},getKey:function(e){return"view-"+this.level.toString()+"-"+this.number.toString()+"-"+e.toString()},createItemView:function(t,e,i){this.viewList.push(e);var a,s,n=(i=i||{}).data||{},o=n.type||i.type||"equals",n=n.field||i.attribute;~["and","or","not"].indexOf(o)?a="views/admin/dynamic-logic/conditions/"+o:(s=this.getMetadata().get(["entityDefs",this.scope,"fields",n,"type"]),(s="id"===n?"id":s)&&(a=this.getMetadata().get(["clientDefs","DynamicLogic","fieldTypes",s,"view"]))),a&&this.createView(e,a,{itemData:i,scope:this.scope,level:this.level+1,selector:'[data-view-key="'+e+'"]',number:t,type:o,field:n,fieldType:s},function(e){this.isRendered()&&e.render(),this.controlAddItemVisibility(),this.listenToOnce(e,"remove-item",function(){this.removeItem(t)},this)},this)},fetch:function(){var t=[];return this.viewDataList.forEach(function(e){e=this.getView(e.key);t.push(e.fetch())},this),{type:this.operator,value:t}},removeItem:function(i){var e=this.getKey(i),a=(this.clearView(e),this.$el.find('[data-view-key="'+e+'"]').remove(),this.$el.find('[data-view-ref-key="'+e+'"]').remove(),-1);this.viewDataList.forEach(function(e,t){e.index===i&&(a=t)},this),~a&&this.viewDataList.splice(a,1),this.controlAddItemVisibility()},actionAddField:function(){this.createView("modal","views/admin/dynamic-logic/modals/add-field",{scope:this.scope},function(t){t.render(),this.listenToOnce(t,"add-field",function(e){this.addField(e),t.close()},this)},this)},addField:function(e){var t=this.getMetadata().get(["entityDefs",this.scope,"fields",e,"type"]);if(t||"id"!=e||(t="id"),!this.getMetadata().get(["clientDefs","DynamicLogic","fieldTypes",t]))throw new Error;var t=this.getMetadata().get(["clientDefs","DynamicLogic","fieldTypes",t,"typeList"])[0],i=this.getIndexForNewItem(),a=this.getKey(i);this.addItemContainer(i),this.addViewDataListItem(i,a),this.createItemView(i,a,{data:{field:e,type:t}})},getIndexForNewItem:function(){return this.viewDataList.length?this.viewDataList[this.viewDataList.length-1].index+1:0},addViewDataListItem:function(e,t){this.viewDataList.push({index:e,key:t})},addItemContainer:function(e){var t=$('<div data-view-key="'+this.getKey(e)+'"></div>'),t=(this.$el.find("> .item-list").append(t),this.translate(this.getGroupOperator(),"logicalOperators","Admin")),e=$('<div class="group-operator" data-view-ref-key="'+this.getKey(e)+'">'+t+"</div>");this.$el.find("> .item-list").append(e)},actionAddGroup:function(e){var t=this.getIndexForNewItem(),i=this.getKey(t);this.addItemContainer(t),this.addViewDataListItem(t,i),this.createItemView(t,i,{type:e,value:[]})},afterRender:function(){this.controlAddItemVisibility()},controlAddItemVisibility:function(){}})}),define("views/admin/dynamic-logic/conditions/field-types/base",["view"],function(e){return e.extend({template:"admin/dynamic-logic/conditions/field-types/base",data:function(){return{type:this.type,field:this.field,scope:this.scope,typeList:this.typeList}},events:{'click > div > div > [data-action="remove"]':function(e){e.stopPropagation(),this.trigger("remove-item")}},setup:function(){this.type=this.options.type,this.field=this.options.field,this.scope=this.options.scope,this.fieldType=this.options.fieldType,this.itemData=this.options.itemData,this.additionalData=this.itemData.data||{},this.typeList=this.getMetadata().get(["clientDefs","DynamicLogic","fieldTypes",this.fieldType,"typeList"]),this.wait(!0),this.getModelFactory().create(this.scope,function(e){this.model=e,this.populateValues(),this.manageValue(),this.wait(!1)},this)},afterRender:function(){this.$type=this.$el.find('select[data-name="type"]'),this.$type.on("change",function(){this.type=this.$type.val(),this.manageValue()}.bind(this))},populateValues:function(){this.itemData.attribute&&this.model.set(this.itemData.attribute,this.itemData.value),this.model.set(this.additionalData.values||{})},getValueViewName:function(){var e=this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"type"])||"base";return this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"view"])||this.getFieldManager().getViewName(e)},getValueFieldName:function(){return this.field},manageValue:function(){var e,t,i=this.getMetadata().get(["clientDefs","DynamicLogic","fieldTypes",this.fieldType,"conditionTypes",this.type,"valueType"])||this.getMetadata().get(["clientDefs","DynamicLogic","conditionTypes",this.type,"valueType"]);"field"===i?(e=this.getValueViewName(),t=this.getValueFieldName(),this.createView("value",e,{model:this.model,name:t,selector:".value-container",mode:"edit",readOnlyDisabled:!0},function(e){this.isRendered()&&e.render()},this)):"custom"===i?(this.clearView("value"),this["createValueView"+Espo.Utils.upperCaseFirst(this.type)]()):"varchar"===i?this.createView("value","views/fields/varchar",{model:this.model,name:this.getValueFieldName(),selector:".value-container",mode:"edit",readOnlyDisabled:!0},function(e){this.isRendered()&&e.render()},this):this.clearView("value")},fetch:function(){var e=this.getView("value"),t={type:this.type,attribute:this.field};return e&&(e.fetchToModel(),t.value=this.model.get(this.field)),t}})}),define("views/email-account/fields/test-send",["views/outbound-email/fields/test-send"],function(e){return e.extend({checkAvailability:function(){this.model.get("smtpHost")?this.$el.find("button").removeClass("hidden"):this.$el.find("button").addClass("hidden")},afterRender:function(){this.checkAvailability(),this.stopListening(this.model,"change:smtpHost"),this.listenTo(this.model,"change:smtpHost",()=>{this.checkAvailability()})},getSmtpData:function(){return{server:this.model.get("smtpHost"),port:this.model.get("smtpPort"),auth:this.model.get("smtpAuth"),security:this.model.get("smtpSecurity"),username:this.model.get("smtpUsername"),password:this.model.get("smtpPassword")||null,authMechanism:this.model.get("smtpAuthMechanism"),fromName:this.getUser().get("name"),fromAddress:this.model.get("emailAddress"),type:"emailAccount",id:this.model.id,userId:this.model.get("assignedUserId")}}})}),define("views/email-account/fields/test-connection",["views/fields/base"],function(e){return e.extend({readOnly:!0,templateContent:'<button class="btn btn-default disabled" data-action="testConnection">'+"{{translate 'Test Connection' scope='EmailAccount'}}</button>",url:"EmailAccount/action/testConnection",events:{'click [data-action="testConnection"]':function(){this.test()}},fetch:function(){return{}},checkAvailability:function(){this.model.get("host")?this.$el.find("button").removeClass("disabled").removeAttr("disabled"):this.$el.find("button").addClass("disabled").attr("disabled","disabled")},afterRender:function(){this.checkAvailability(),this.stopListening(this.model,"change:host"),this.listenTo(this.model,"change:host",()=>{this.checkAvailability()})},getData:function(){return{host:this.model.get("host"),port:this.model.get("port"),security:this.model.get("security"),username:this.model.get("username"),password:this.model.get("password")||null,id:this.model.id,emailAddress:this.model.get("emailAddress"),userId:this.model.get("assignedUserId")}},test:function(){var e=this.getData();let a=this.$el.find("button");a.addClass("disabled"),Espo.Ui.notify(this.translate("pleaseWait","messages")),Espo.Ajax.postRequest(this.url,e).then(()=>{a.removeClass("disabled"),Espo.Ui.success(this.translate("connectionIsOk","messages","EmailAccount"))}).catch(e=>{let t=e.getResponseHeader("X-Status-Reason")||"",i=(t=(t=t.replace(/ $/,"")).replace(/,$/,""),this.translate("Error"));200!==parseInt(e.status)&&(i+=" "+e.status),t&&(i+=": "+t),Espo.Ui.error(i,!0),console.error(i),e.errorIsHandled=!0,a.removeClass("disabled")})}})}),define("views/email-account/fields/folders",["views/fields/array"],function(e){return e.extend({getFoldersUrl:"EmailAccount/action/getFolders",setupOptions:function(){this.params.options=["INBOX"]},fetchFolders:function(){return new Promise(t=>{var e={host:this.model.get("host"),port:this.model.get("port"),security:this.model.get("security"),username:this.model.get("username"),emailAddress:this.model.get("emailAddress"),userId:this.model.get("assignedUserId")};this.model.has("password")&&(e.password=this.model.get("password")),this.model.isNew()||(e.id=this.model.id),Espo.Ajax.postRequest(this.getFoldersUrl,e).then(e=>{t(e)}).catch(e=>{Espo.Ui.error(this.translate("couldNotConnectToImap","messages","EmailAccount")),e.errorIsHandled=!0,t(["INBOX"])})})},actionAddItem:function(){Espo.Ui.notify(" ... "),this.fetchFolders().then(e=>{Espo.Ui.notify(!1),this.createView("addModal",this.addItemModalView,{options:e}).then(t=>{t.render(),t.once("add",e=>{this.addValue(e),t.close()}),t.once("add-mass",e=>{e.forEach(e=>{this.addValue(e)}),t.close()})})})}})}),define("views/email-account/fields/folder",["views/fields/base"],function(e){return e.extend({editTemplate:"email-account/fields/folder/edit",getFoldersUrl:"EmailAccount/action/getFolders",events:{'click [data-action="selectFolder"]':function(){Espo.Ui.notify(this.translate("pleaseWait","messages"));var e={host:this.model.get("host"),port:this.model.get("port"),security:this.model.get("security"),username:this.model.get("username"),emailAddress:this.model.get("emailAddress"),userId:this.model.get("assignedUserId")};this.model.has("password")&&(e.password=this.model.get("password")),this.model.isNew()||(e.id=this.model.id),Espo.Ajax.postRequest(this.getFoldersUrl,e).then(e=>{this.createView("modal","views/email-account/modals/select-folder",{folders:e},t=>{Espo.Ui.notify(!1),t.render(),this.listenToOnce(t,"select",e=>{t.close(),this.addFolder(e)})})}).catch(e=>{Espo.Ui.error(this.translate("couldNotConnectToImap","messages","EmailAccount")),e.errorIsHandled=!0})}},addFolder:function(e){this.$element.val(e)}})}),define("helpers/misc/authentication-provider",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e){this.view=e,this.metadata=e.getMetadata(),this.model=e.model;let t=e.getMetadata().get(["authenticationMethods"])||{};this.methodList=Object.keys(t).filter(e=>{return(t[e].provider||{}).isAvailable}),this.authFields={},this.dynamicLogicDefs={fields:{},panels:{}}}setupPanelsVisibility(e){this.handlePanelsVisibility(e),this.view.listenTo(this.model,"change:method",()=>this.handlePanelsVisibility(e))}getFromMetadata(e,t){return this.metadata.get(["authenticationMethods",e,"provider",t])||this.metadata.get(["authenticationMethods",e,"settings",t])}setupMethods(){return this.methodList.forEach(e=>this.setupMethod(e)),this.dynamicLogicDefs}setupMethod(e){let t=this.getFromMetadata(e,"fieldList")||[];t=t.filter(e=>this.model.hasField(e)),this.authFields[e]=t;var i,a,s=(this.getFromMetadata(e,"dynamicLogic")||{}).fields||{};for(i in s)t.includes(i)&&(a=this.modifyDynamicLogic(s[i]),this.dynamicLogicDefs.fields[i]=Espo.Utils.cloneDeep(a))}modifyDynamicLogic(i){if(i=Espo.Utils.clone(i),Array.isArray(i))return i.map(e=>this.modifyDynamicLogic(e));if("object"!=typeof i)return i;{let t={};for(var a in i){let e=i[a];"attribute"===a&&"authenticationMethod"===e&&(e="method"),t[a]=this.modifyDynamicLogic(e)}return t}}modifyDetailLayout(i){this.methodList.forEach(e=>{let t=this.getFromMetadata(e,"layout");t&&((t=Espo.Utils.cloneDeep(t)).name=e,this.prepareLayout(t,e),i.push(t))})}prepareLayout(e,i){e.rows.forEach(e=>{e.filter(e=>!e.noLabel&&!e.labelText&&e.name).forEach(t=>{if(null!==t){let e=this.view.translate(t.name,"fields","Settings");t.options=t.options||{},e&&0===e.toLowerCase().indexOf(i.toLowerCase()+" ")&&(t.labelText=e.substring(i.length+1)),t.options.tooltipText=this.view.translate(t.name,"tooltips","Settings")}})}),e.rows=e.rows.map(e=>e=e.map(e=>!(e&&e.name&&!this.model.hasField(e.name))&&e))}handlePanelsVisibility(i){let a=this.model.get("method");this.methodList.forEach(e=>{let t=this.authFields[e]||[];if(e!==a)return this.view.hidePanel(e),void t.forEach(e=>{this.view.hideField(e)});this.view.showPanel(e),t.forEach(e=>this.view.showField(e)),i()})}}}),define("views/settings/record/edit",["views/record/edit"],function(e){return e.extend({saveAndContinueEditingAction:!1,sideView:null,layoutName:"settings",setup:function(){e.prototype.setup.call(this),this.listenTo(this.model,"after:save",()=>{this.getConfig().set(this.model.getClonedAttributes())})},afterRender:function(){e.prototype.afterRender.call(this)},exit:function(e){"cancel"===e&&this.getRouter().navigate("#Admin",{trigger:!0})}})}),define("views/settings/edit",["exports","views/edit"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{scope="Settings";setupHeader(){this.createView("header",this.headerView,{model:this.model,fullSelector:"#main > .header",template:this.options.headerTemplate,label:this.options.label})}}e.default=a}),define("views/templates/event/record/detail",["views/record/detail"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.getAcl().checkModel(this.model,"edit")&&-1===["Held","Not Held"].indexOf(this.model.get("status"))&&(this.dropdownItemList.push({html:this.translate("Set Held","labels",this.scope),name:"setHeld"}),this.dropdownItemList.push({html:this.translate("Set Not Held","labels",this.scope),name:"setNotHeld"}))},actionSetHeld:function(){this.model.save({status:"Held"},{patch:!0}).then(()=>{Espo.Ui.success(this.translate("Saved","labels","Meeting")),this.removeButton("setHeld"),this.removeButton("setNotHeld")})},actionSetNotHeld:function(){this.model.save({status:"Not Held"},{patch:!0}).then(()=>{Espo.Ui.success(this.translate("Saved","labels","Meeting")),this.removeButton("setHeld"),this.removeButton("setNotHeld")})}})}),define("views/scheduled-job/list",["views/list"],function(e){return e.extend({searchPanel:!1,setup:function(){e.prototype.setup.call(this),this.menu.buttons.push({link:"#Admin/jobs",text:this.translate("Jobs","labels","Admin")}),this.createView("search","views/base",{fullSelector:"#main > .search-container",template:"scheduled-job/cronjob"})},afterRender:function(){e.prototype.afterRender.call(this),Espo.Ajax.getRequest("Admin/action/cronMessage").then(e=>{this.$el.find(".cronjob .message").html(e.message),this.$el.find(".cronjob .command").html("<strong>"+e.command+"</strong>")})},getHeader:function(){return this.buildHeaderHtml([$("<a>").attr("href","#Admin").text(this.translate("Administration","labels","Admin")),this.getLanguage().translate(this.scope,"scopeNamesPlural")])}})}),define("views/scheduled-job/record/list",["views/record/list"],function(e){return e.extend({quickDetailDisabled:!0,quickEditDisabled:!0,massActionList:["remove","massUpdate"]})}),define("views/scheduled-job/record/detail",["views/record/detail"],function(e){return e.extend({duplicateAction:!1})}),define("views/scheduled-job/record/panels/log",["views/record/panels/relationship"],function(e){return e.extend({setupListLayout:function(){~(this.getMetadata().get(["clientDefs","ScheduledJob","jobWithTargetList"])||[]).indexOf(this.model.get("job"))&&(this.listLayoutName="listSmallWithTarget")}})}),define("views/scheduled-job/fields/scheduling",["views/fields/varchar"],function(t){return t.extend({setup:function(){t.prototype.setup.call(this),(this.isEditMode()||this.isDetailMode())&&this.wait(Espo.loader.requirePromise("lib!cronstrue").then(e=>{this.Cronstrue=e,this.listenTo(this.model,"change:"+this.name,()=>this.showText())}))},afterRender:function(){var e;t.prototype.afterRender.call(this),(this.isEditMode()||this.isDetailMode())&&(e=this.$text=$('<div class="small text-success"/>'),this.$el.append(e),this.showText())},showText:function(){if(this.$text&&this.$text.length&&this.Cronstrue){var e=this.model.get(this.name);if(e)if("* * * * *"!==e){var t="en",i=Object.keys(this.Cronstrue.default.locales),a=this.getLanguage().name;~i.indexOf(a)?t=a:~i.indexOf(a.split("_")[0])&&(t=a.split("_")[0]);try{var s=this.Cronstrue.toString(e,{use24HourTimeFormat:!this.getDateTime().hasMeridian(),locale:t})}catch(e){s=this.translate("Not valid")}this.$text.text(s)}else this.$text.text(this.translate("As often as possible","labels","ScheduledJob"));else this.$text.text("")}}})}),define("views/scheduled-job/fields/job",["views/fields/enum"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),(this.isEditMode()||this.isDetailMode())&&(this.wait(!0),Espo.Ajax.getRequest("Admin/jobs").then(e=>{this.params.options=e.filter(e=>!this.getMetadata().get(["entityDefs","ScheduledJob","jobs",e,"isSystem"])),this.params.options.unshift(""),this.wait(!1)})),this.model.isNew()&&this.on("change",()=>{var e,t=this.model.get("job");if(t)return e=this.getLanguage().translateOption(t,"job","ScheduledJob"),t=this.getMetadata().get("entityDefs.ScheduledJob.jobSchedulingMap."+t)||"*/10 * * * *",this.model.set("name",e),void this.model.set("scheduling",t);this.model.set("name",""),this.model.set("scheduling","")})}})}),define("views/role/list",["views/list"],function(e){return e.extend({searchPanel:!1})}),define("views/role/record/detail-side",["views/record/detail-side"],function(e){return e.extend({panelList:[{name:"default",label:!1,view:"views/role/record/panels/side"}]})}),define("views/role/record/panels/side",["views/record/panels/side"],function(e){return e.extend({template:"role/record/panels/side"})}),define("views/role/modals/add-field",["views/modal"],function(e){return e.extend({template:"role/modals/add-field",events:{'click a[data-action="addField"]':function(e){this.trigger("add-field",$(e.currentTarget).data().name)}},data:function(){var i=[];return this.fieldList.forEach((e,t)=>{t%4==0&&i.push([]),i[i.length-1].push(e)}),{dataList:i,scope:this.scope}},setup:function(){this.headerText=this.translate("Add Field");var e=this.scope=this.options.scope,i=this.getMetadata().get("entityDefs."+e+".fields")||{},a=[];Object.keys(i).forEach(e=>{var t=i[e];e in this.options.ignoreFieldList||t.disabled||null===this.getMetadata().get(["app",this.options.type,"mandatory","scopeFieldLevel",this.scope,e])&&a.push(e)}),this.fieldList=this.getLanguage().sortFieldList(e,a)}})}),define("views/portal-role/list",["views/list"],function(e){return e.extend({searchPanel:!1})}),define("views/portal-role/record/table",["views/role/record/table"],function(e){return e.extend({levelListMap:{recordAllAccountContactOwnNo:["all","account","contact","own","no"],recordAllAccountOwnNo:["all","account","own","no"],recordAllContactOwnNo:["all","contact","own","no"],recordAllAccountNo:["all","account","no"],recordAllContactNo:["all","contact","no"],recordAllAccountContactNo:["all","account","contact","no"],recordAllOwnNo:["all","own","no"],recordAllNo:["all","no"],record:["all","own","no"]},levelList:["all","account","contact","own","no"],type:"aclPortal",lowestLevelByDefault:!0,setupScopeList:function(){this.aclTypeMap={},this.scopeList=[],Object.keys(this.getMetadata().get("scopes")).sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural"))).forEach(e=>{var t;this.getMetadata().get("scopes."+e+".disabled")||this.getMetadata().get("scopes."+e+".disabledPortal")||(t=this.getMetadata().get("scopes."+e+".aclPortal"))&&(this.scopeList.push(e),!0===(this.aclTypeMap[e]=t)&&(this.aclTypeMap[e]="record"))})}})}),define("views/portal-role/record/list",["views/role/record/list"],function(e){return e.extend({})}),define("views/portal-role/record/edit",["views/role/record/edit"],function(e){return e.extend({tableView:"views/portal-role/record/table",stickButtonsContainerAllTheWay:!0})}),define("views/portal-role/record/detail",["views/role/record/detail"],function(e){return e.extend({tableView:"views/portal-role/record/table",stickButtonsContainerAllTheWay:!0})}),define("views/lead-capture-log-record/modals/detail",["views/modals/detail"],function(e){return e.extend({editDisabled:!0,fullFormDisabled:!0})}),define("views/lead-capture/opt-in-confirmation-success",["view","model"],function(e,t){return e.extend({template:"lead-capture/opt-in-confirmation-success",setup:function(){let e=new t;this.resultData=this.options.resultData,this.resultData.message&&(e.set("message",this.resultData.message),this.createView("messageField","views/fields/text",{selector:'.field[data-name="message"]',mode:"detail",inlineEditDisabled:!0,model:e,name:"message"}))},data:function(){return{resultData:this.options.resultData,defaultMessage:this.getLanguage().translate("optInIsConfirmed","messages","LeadCapture")}}})}),define("views/lead-capture/opt-in-confirmation-expired",["view","model"],function(e,t){return e.extend({template:"lead-capture/opt-in-confirmation-expired",setup:function(){this.resultData=this.options.resultData},data:function(){return{defaultMessage:this.getLanguage().translate("optInConfirmationExpired","messages","LeadCapture")}}})}),define("views/lead-capture/record/list",["views/record/list"],function(e){return e.extend({massActionList:["remove","massUpdate","export"]})}),define("views/lead-capture/record/detail",["views/record/detail"],function(e){return e.extend({setupActionItems:function(){e.prototype.setupActionItems.call(this),this.dropdownItemList.push({label:"Generate New API Key",name:"generateNewApiKey"})},actionGenerateNewApiKey:function(){this.confirm(this.translate("confirmation","messages"),()=>{Espo.Ajax.postRequest("LeadCapture/action/generateNewApiKey",{id:this.model.id}).then(e=>{this.model.set(e)})})}})}),define("views/lead-capture/record/panels/request",["views/record/panels/side"],function(e){return e.extend({fieldList:["exampleRequestUrl","exampleRequestMethod","exampleRequestHeaders","exampleRequestPayload"]})}),define("views/lead-capture/fields/smtp-account",["views/fields/enum"],function(t){return t.extend({dataUrl:"LeadCapture/action/smtpAccountDataList",getAttributeList:function(){return[this.name,"inboundEmailId"]},data:function(){var e=t.prototype.data.call(this);return e.valueIsSet=!0,e.isNotEmpty=!0,e},setupOptions:function(){var e;t.prototype.setupOptions.call(this),this.params.options=[],this.translatedOptions={},this.params.options.push("system"),this.loadedOptionList?this.loadedOptionList.forEach(e=>{this.params.options.push(e),this.translatedOptions[e]=(this.loadedOptionTranslations[e]||e)+" ("+this.translate("group","labels","MassEmail")+")"}):this.model.get("inboundEmailId")&&(e="inboundEmail:"+this.model.get("inboundEmailId"),this.params.options.push(e),this.translatedOptions[e]=(this.model.get("inboundEmailName")||this.model.get("inboundEmailId"))+" ("+this.translate("group","labels","MassEmail")+")"),this.translatedOptions.system=this.getConfig().get("outboundEmailFromAddress")+" ("+this.translate("system","labels","MassEmail")+")"},getValueForDisplay:function(){return!this.model.has(this.name)&&this.isReadMode()?this.model.has("inboundEmailId")?this.model.get("inboundEmailId")?"inboundEmail:"+this.model.get("inboundEmailId"):"system":"...":this.model.get(this.name)},setup:function(){t.prototype.setup.call(this),(this.getAcl().checkScope("MassEmail","create")||this.getAcl().checkScope("MassEmail","edit"))&&Espo.Ajax.getRequest(this.dataUrl).then(e=>{e.length&&(this.loadedOptionList=[],this.loadedOptionTranslations={},this.loadedOptionAddresses={},this.loadedOptionFromNames={},e.forEach(e=>{this.loadedOptionList.push(e.key),this.loadedOptionTranslations[e.key]=e.emailAddress,this.loadedOptionAddresses[e.key]=e.emailAddress,this.loadedOptionFromNames[e.key]=e.fromName||""}),this.setupOptions(),this.reRender())})},fetch:function(){var e={},t=this.$element.val();return(e[this.name]=t)&&"system"!==t?1<(t=t.split(":")).length&&(e.inboundEmailId=t[1],e.inboundEmailName=this.translatedOptions[e.inboundEmailId]||e.inboundEmailId):(e.inboundEmailId=null,e.inboundEmailName=null),e}})}),define("views/lead-capture/fields/field-list",["views/fields/multi-enum"],function(e){return e.extend({setupOptions:function(){this.params.options=[],this.translatedOptions={};var e,t=this.getMetadata().get(["entityDefs","Lead","fields"])||{},i=this.getMetadata().get(["entityDefs","LeadCapture","fields","fieldList","ignoreFieldList"])||[];for(e in t){var a=t[e];a.disabled||a.readOnly||~i.indexOf(e)||(this.params.options.push(e),this.translatedOptions[e]=this.translate(e,"fields","Lead"))}}})}),define("views/lead-capture/fields/api-key",["views/fields/varchar"],function(e){return e.extend({})}),define("views/layout-set/layouts",["exports","views/admin/layouts/index"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setup(){let t=this.setId=this.options.layoutSetId;this.baseUrl="#LayoutSet/editLayouts/id="+t,super.setup(),this.wait(this.getModelFactory().create("LayoutSet").then(e=>((this.sModel=e).id=t,e.fetch())))}getLayoutScopeDataList(){let e=[],s=this.sModel.get("layoutList")||[],t=[];return s.forEach(e=>{e=e.split(".")[0];~t.indexOf(e)||t.push(e)}),t.forEach(t=>{let i={},a=(i.scope=t,i.url=this.baseUrl+"&scope="+t,i.typeDataList=[],[]);s.forEach(e=>{var[e,t]=e.split(".");e===i.scope&&a.push(t)}),a.forEach(e=>{i.typeDataList.push({type:e,url:this.baseUrl+"&scope="+t+"&type="+e,label:this.translateLayoutName(e,t)})}),i.typeList=a,e.push(i)}),e}getHeaderHtml(){var e=' <span class="breadcrumb-separator"><span class="chevron-right"></span></span> ';return $("<span>").append($("<a>").attr("href","#LayoutSet").text(this.translate("LayoutSet","scopeNamesPlural")),e,$("<a>").attr("href","#LayoutSet/view/"+this.sModel.id).text(this.sModel.get("name")),e,$("<span>").text(this.translate("Edit Layouts","labels","LayoutSet"))).get(0).outerHTML}navigate(e,t){e="#LayoutSet/editLayouts/id="+this.setId+"&scope="+e+"&type="+t;this.getRouter().navigate(e,{trigger:!1})}}e.default=a}),define("views/layout-set/record/list",["views/record/list"],function(e){return e.extend({massActionList:["remove","export"]})}),define("views/layout-set/fields/layout-list",["views/fields/multi-enum","views/admin/layouts/index"],function(e,i){return e.extend({typeList:["list","detail","listSmall","detailSmall","bottomPanelsDetail","filters","massUpdate","sidePanelsDetail","sidePanelsEdit","sidePanelsDetailSmall","sidePanelsEditSmall"],setupOptions:function(){this.params.options=[],this.translatedOptions={},this.scopeList=Object.keys(this.getMetadata().get("scopes")).filter(e=>this.getMetadata().get(["scopes",e,"layouts"])).sort((e,t)=>this.translate(e,"scopeNames").localeCompare(this.translate(t,"scopeNames")));let e=i.prototype.getLayoutScopeDataList.call(this);e.forEach(i=>{i.typeList.forEach(e=>{var t=i.scope+"."+e;"Portal"!==e.substr(-6)&&(this.params.options.push(t),this.translatedOptions[t]=this.translate(i.scope,"scopeNames")+"."+this.translate(e,"layouts","Admin"))})})},translateLayoutName:function(e,t){return i.prototype.translateLayoutName.call(this,e,t)}})}),define("views/layout-set/fields/edit",["views/fields/base"],function(e){return e.extend({detailTemplateContent:'<a class="btn btn-default" href="#LayoutSet/editLayouts/id={{model.id}}">'+"{{translate 'Edit Layouts' scope='LayoutSet'}}</a>",editTemplateContent:""})}),define("views/inbound-email/record/list",["views/record/list"],function(e){return e.extend({quickDetailDisabled:!0,quickEditDisabled:!0,massActionList:["remove","massUpdate"],checkAllResultDisabled:!0})}),define("views/inbound-email/record/edit",["views/record/edit","views/inbound-email/record/detail"],function(e,t){return e.extend({setup:function(){e.prototype.setup.call(this),t.prototype.setupFieldsBehaviour.call(this),t.prototype.initSslFieldListening.call(this),t.prototype.wasFetched.call(this)&&this.setFieldReadOnly("fetchSince")},modifyDetailLayout:function(e){t.prototype.modifyDetailLayout.call(this,e)},controlStatusField:function(){t.prototype.controlStatusField.call(this)},initSmtpFieldsControl:function(){t.prototype.initSmtpFieldsControl.call(this)},controlSmtpFields:function(){t.prototype.controlSmtpFields.call(this)},controlSentFolderField:function(){t.prototype.controlSentFolderField.call(this)},controlSmtpAuthField:function(){t.prototype.controlSmtpAuthField.call(this)},wasFetched:function(){t.prototype.wasFetched.call(this)}})}),define("views/inbound-email/fields/test-send",["views/email-account/fields/test-send"],function(e){return e.extend({getSmtpData:function(){return{server:this.model.get("smtpHost"),port:this.model.get("smtpPort"),auth:this.model.get("smtpAuth"),security:this.model.get("smtpSecurity"),username:this.model.get("smtpUsername"),password:this.model.get("smtpPassword")||null,authMechanism:this.model.get("smtpAuthMechanism"),fromName:this.model.get("fromName"),fromAddress:this.model.get("emailAddress"),type:"inboundEmail",id:this.model.id}}})}),define("views/inbound-email/fields/test-connection",["views/email-account/fields/test-connection"],function(e){return e.extend({url:"InboundEmail/action/testConnection"})}),define("views/inbound-email/fields/target-user-position",["views/fields/enum"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.translatedOptions={"":"--"+this.translate("All")+"--"},this.params.options=[""],this.model.get("targetUserPosition")&&this.model.get("teamId")&&this.params.options.push(this.model.get("targetUserPosition")),this.loadRoleList(()=>{"edit"===this.mode&&this.isRendered()&&this.render()}),this.listenTo(this.model,"change:teamId",()=>{this.loadRoleList(()=>{this.render()})})},loadRoleList:function(t,i){var a=this.model.get("teamId");a||(this.params.options=[""]),this.getModelFactory().create("Team",e=>{e.id=a,this.listenToOnce(e,"sync",()=>{this.params.options=e.get("positionList")||[],this.params.options.unshift(""),t.call(i)}),e.fetch()})}})}),define("views/inbound-email/fields/folders",["views/email-account/fields/folders"],function(e){return e.extend({getFoldersUrl:"InboundEmail/action/getFolders"})}),define("views/inbound-email/fields/folder",["views/email-account/fields/folder"],function(e){return e.extend({getFoldersUrl:"InboundEmail/action/getFolders"})}),define("views/inbound-email/fields/email-address",["views/fields/email-address"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.on("change",()=>{var e=this.model.get("emailAddress");this.model.set("name",e),!this.model.isNew()&&this.model.get("replyToAddress")||this.model.set("replyToAddress",e)})}})}),define("views/authentication-provider/record/edit",["views/record/edit","helpers/misc/authentication-provider"],function(e,t){return e.extend({saveAndNewAction:!1,helper:null,setup:function(){this.helper=new t(this),e.prototype.setup.call(this)},setupBeforeFinal:function(){this.dynamicLogicDefs=this.helper.setupMethods(),e.prototype.setupBeforeFinal.call(this),this.helper.setupPanelsVisibility(()=>{this.processDynamicLogic()})},modifyDetailLayout:function(e){this.helper.modifyDetailLayout(e)}})}),define("views/authentication-provider/record/detail",["views/record/detail","helpers/misc/authentication-provider"],function(e,t){return e.extend({editModeDisabled:!0,helper:null,setup:function(){this.helper=new t(this),e.prototype.setup.call(this)},setupBeforeFinal:function(){this.dynamicLogicDefs=this.helper.setupMethods(),e.prototype.setupBeforeFinal.call(this),this.helper.setupPanelsVisibility(()=>{this.processDynamicLogic()})},modifyDetailLayout:function(e){this.helper.modifyDetailLayout(e)}})}),define("views/authentication-provider/fields/method",["views/fields/enum"],function(e){return e.extend({setupOptions:function(){let t=this.getMetadata().get(["authenticationMethods"])||{},e=Object.keys(t).filter(e=>{return(t[e].provider||{}).isAvailable});e.unshift(""),this.params.options=e}})}),define("views/admin/user-interface",["views/settings/record/edit"],function(e){return e.extend({layoutName:"userInterface",saveAndContinueEditingAction:!1,setup:function(){e.prototype.setup.call(this),this.controlColorsField(),this.listenTo(this.model,"change:scopeColorsDisabled",this.controlColorsField,this),this.on("save",e=>{this.model.get("theme")===e.theme&&(this.model.get("themeParams").navbar||{})===e.themeParams.navbar||(this.setConfirmLeaveOut(!1),window.location.reload())})},controlColorsField:function(){this.model.get("scopeColorsDisabled")?this.hideField("tabColorsDisabled"):this.showField("tabColorsDisabled")}})}),define("views/admin/sms",["views/settings/record/edit"],function(e){return e.extend({layoutName:"sms"})}),define("views/admin/settings",["views/settings/record/edit"],function(e){return e.extend({layoutName:"settings",saveAndContinueEditingAction:!1,setup:function(){e.prototype.setup.call(this),this.getHelper().getAppParam("isRestrictedMode")&&!this.getUser().isSuperAdmin()&&(this.hideField("cronDisabled"),this.hideField("maintenanceMode"),this.setFieldReadOnly("useWebSocket"),this.setFieldReadOnly("siteUrl"))}})}),define("views/admin/outbound-emails",["views/settings/record/edit"],function(e){return e.extend({layoutName:"outboundEmails",saveAndContinueEditingAction:!1,dynamicLogicDefs:{fields:{smtpUsername:{visible:{conditionGroup:[{type:"isNotEmpty",attribute:"smtpServer"},{type:"isTrue",attribute:"smtpAuth"}]},required:{conditionGroup:[{type:"isNotEmpty",attribute:"smtpServer"},{type:"isTrue",attribute:"smtpAuth"}]}},smtpPassword:{visible:{conditionGroup:[{type:"isNotEmpty",attribute:"smtpServer"},{type:"isTrue",attribute:"smtpAuth"}]}},smtpPort:{visible:{conditionGroup:[{type:"isNotEmpty",attribute:"smtpServer"}]},required:{conditionGroup:[{type:"isNotEmpty",attribute:"smtpServer"}]}},smtpSecurity:{visible:{conditionGroup:[{type:"isNotEmpty",attribute:"smtpServer"}]}},smtpAuth:{visible:{conditionGroup:[{type:"isNotEmpty",attribute:"smtpServer"}]}}}},setup:function(){e.prototype.setup.call(this)},afterRender:function(){e.prototype.afterRender.call(this);var t=this.getFieldView("smtpSecurity");this.listenTo(t,"change",function(){var e=t.fetch().smtpSecurity;"SSL"==e?this.model.set("smtpPort","465"):"TLS"==e?this.model.set("smtpPort","587"):this.model.set("smtpPort","25")}.bind(this))}})}),define("views/admin/notifications",["views/settings/record/edit"],function(e){return e.extend({layoutName:"notifications",saveAndContinueEditingAction:!1,dynamicLogicDefs:{fields:{assignmentEmailNotificationsEntityList:{visible:{conditionGroup:[{type:"isTrue",attribute:"assignmentEmailNotifications"}]}},adminNotificationsNewVersion:{visible:{conditionGroup:[{type:"isTrue",attribute:"adminNotifications"}]}},adminNotificationsNewExtensionVersion:{visible:{conditionGroup:[{type:"isTrue",attribute:"adminNotifications"}]}}}},setup:function(){e.prototype.setup.call(this),this.controlStreamEmailNotificationsEntityList(),this.listenTo(this.model,"change",function(e){(e.hasChanged("streamEmailNotifications")||e.hasChanged("portalStreamEmailNotifications"))&&this.controlStreamEmailNotificationsEntityList()},this)},controlStreamEmailNotificationsEntityList:function(){this.model.get("streamEmailNotifications")||this.model.get("portalStreamEmailNotifications")?(this.showField("streamEmailNotificationsEntityList"),this.showField("streamEmailNotificationsTypeList")):(this.hideField("streamEmailNotificationsEntityList"),this.hideField("streamEmailNotificationsTypeList"))}})}),define("views/admin/jobs-settings",["views/settings/record/edit"],function(e){return e.extend({layoutName:"jobsSettings",saveAndContinueEditingAction:!1,dynamicLogicDefs:{fields:{jobPoolConcurrencyNumber:{visible:{conditionGroup:[{type:"isTrue",attribute:"jobRunInParallel"}]}}}},setup:function(){e.prototype.setup.call(this),this.getHelper().getAppParam("isRestrictedMode")&&!this.getUser().isSuperAdmin()&&(this.setFieldReadOnly("jobRunInParallel"),this.setFieldReadOnly("jobMaxPortion"),this.setFieldReadOnly("jobPoolConcurrencyNumber"),this.setFieldReadOnly("daemonInterval"),this.setFieldReadOnly("daemonMaxProcessNumber"),this.setFieldReadOnly("daemonProcessTimeout"))}})}),define("views/admin/inbound-emails",["views/settings/record/edit"],function(e){return e.extend({layoutName:"inboundEmails",saveAndContinueEditingAction:!1,setup:function(){e.prototype.setup.call(this)},afterRender:function(){e.prototype.afterRender.call(this)}})}),define("views/admin/currency",["views/settings/record/edit"],function(e){return e.extend({layoutName:"currency",saveAndContinueEditingAction:!1,setup:function(){e.prototype.setup.call(this),this.listenTo(this.model,"change:currencyList",function(e,t,i){i.ui&&(i=Espo.Utils.clone(e.get("currencyList")),this.setFieldOptionList("defaultCurrency",i),this.setFieldOptionList("baseCurrency",i),this.controlCurrencyRatesVisibility())},this),this.listenTo(this.model,"change",function(e,t){t.ui&&(!e.hasChanged("currencyList")&&!e.hasChanged("baseCurrency")||(t=this.getFieldView("currencyRates"))&&t.reRender())},this),this.controlCurrencyRatesVisibility()},controlCurrencyRatesVisibility:function(){this.model.get("currencyList").length<2?this.hideField("currencyRates"):this.showField("currencyRates")}})}),define("views/admin/authentication",["views/settings/record/edit"],function(i){return i.extend({layoutName:"authentication",saveAndContinueEditingAction:!1,setup:function(){this.methodList=[];var e,t=this.getMetadata().get(["authenticationMethods"])||{};for(e in t)t[e].settings&&t[e].settings.isAvailable&&this.methodList.push(e);this.authFields={},i.prototype.setup.call(this),this.handlePanelsVisibility(),this.listenTo(this.model,"change:authenticationMethod",()=>{this.handlePanelsVisibility()}),this.manage2FAFields(),this.listenTo(this.model,"change:auth2FA",()=>{this.manage2FAFields()}),this.managePasswordRecoveryFields(),this.listenTo(this.model,"change:passwordRecoveryDisabled",()=>{this.managePasswordRecoveryFields()})},setupBeforeFinal:function(){this.dynamicLogicDefs={fields:{},panels:{}},this.methodList.forEach(e=>{var t=this.getMetadata().get(["authenticationMethods",e,"settings","fieldList"]),i=(t&&(this.authFields[e]=t),this.getMetadata().get(["authenticationMethods",e,"settings","dynamicLogic","fields"]));if(i)for(var a in i)this.dynamicLogicDefs.fields[a]=Espo.Utils.cloneDeep(i[a])}),i.prototype.setupBeforeFinal.call(this)},modifyDetailLayout:function(i){this.methodList.forEach(e=>{let t=this.getMetadata().get(["authenticationMethods",e,"settings","layout"]);t&&((t=Espo.Utils.cloneDeep(t)).name=e,this.prepareLayout(t,e),i.push(t))})},prepareLayout:function(e,i){e.rows.forEach(e=>{e.filter(e=>!e.noLabel&&!e.labelText&&e.name).forEach(e=>{let t=this.translate(e.name,"fields","Settings");t&&0===t.toLowerCase().indexOf(i.toLowerCase()+" ")&&(e.labelText=t.substring(i.length+1))})})},handlePanelsVisibility:function(){var i=this.model.get("authenticationMethod");this.methodList.forEach(e=>{var t=this.authFields[e]||[];if(e!==i)return this.hidePanel(e),void t.forEach(e=>{this.hideField(e)});this.showPanel(e),t.forEach(e=>{this.showField(e)}),this.processDynamicLogic()})},manage2FAFields:function(){if(this.model.get("auth2FA"))return this.showField("auth2FAForced"),this.showField("auth2FAMethodList"),this.showField("auth2FAInPortal"),void this.setFieldRequired("auth2FAMethodList");this.hideField("auth2FAForced"),this.hideField("auth2FAMethodList"),this.hideField("auth2FAInPortal"),this.setFieldNotRequired("auth2FAMethodList")},managePasswordRecoveryFields:function(){if(!this.model.get("passwordRecoveryDisabled"))return this.showField("passwordRecoveryForAdminDisabled"),this.showField("passwordRecoveryForInternalUsersDisabled"),void this.showField("passwordRecoveryNoExposure");this.hideField("passwordRecoveryForAdminDisabled"),this.hideField("passwordRecoveryForInternalUsersDisabled"),this.hideField("passwordRecoveryNoExposure")}})}),define("views/admin/upgrade/ready",["views/modal"],function(e){return e.extend({cssName:"ready-modal",header:!1,template:"admin/upgrade/ready",createButton:!0,data:function(){return{version:this.upgradeData.version,text:this.translate("upgradeVersion","messages","Admin").replace("{version}",this.upgradeData.version)}},setup:function(){this.buttonList=[{name:"run",label:this.translate("Run Upgrade","labels","Admin"),style:"danger"},{name:"cancel",label:"Cancel"}],this.upgradeData=this.options.upgradeData,this.header=this.getLanguage().translate("Ready for upgrade","labels","Admin")},actionRun:function(){this.trigger("run"),this.remove()}})}),define("views/admin/upgrade/index",["view"],function(e){return e.extend({template:"admin/upgrade/index",packageContents:null,data:function(){return{versionMsg:this.translate("Current version")+": "+this.getConfig().get("version"),infoMsg:this.translate("upgradeInfo","messages","Admin").replace("{url}","https://www.espocrm.com/documentation/administration/upgrading/"),backupsMsg:this.translate("upgradeBackup","messages","Admin"),upgradeRecommendation:this.translate("upgradeRecommendation","messages","Admin"),downloadMsg:this.translate("downloadUpgradePackage","messages","Admin").replace("{url}","https://www.espocrm.com/download/upgrades")}},afterRender:function(){this.$el.find(".panel-body a").attr("target","_BLANK")},events:{'change input[name="package"]':function(e){this.$el.find('button[data-action="upload"]').addClass("disabled").attr("disabled","disabled"),this.$el.find(".message-container").html("");e=e.currentTarget.files;e.length&&this.selectFile(e[0])},'click button[data-action="upload"]':function(){this.upload()}},setup:function(){},selectFile:function(e){var t=new FileReader;t.onload=e=>{this.packageContents=e.target.result,this.$el.find('button[data-action="upload"]').removeClass("disabled").removeAttr("disabled")},t.readAsDataURL(e)},showError:function(e){e=this.translate(e,"errors","Admin"),this.$el.find(".message-container").html(e)},upload:function(){this.$el.find('button[data-action="upload"]').addClass("disabled").attr("disabled","disabled"),this.notify("Uploading..."),Espo.Ajax.postRequest("Admin/action/uploadUpgradePackage",this.packageContents,{contentType:"application/zip",timeout:0}).then(t=>{t.id?(Espo.Ui.notify(!1),this.createView("popup","views/admin/upgrade/ready",{upgradeData:t},e=>{e.render(),this.$el.find('button[data-action="upload"]').removeClass("disabled").removeAttr("disabled"),e.once("run",()=>{e.close(),this.$el.find(".panel.upload").addClass("hidden"),this.run(t.id,t.version)})})):this.showError(this.translate("Error occurred"))}).catch(e=>{this.showError(e.getResponseHeader("X-Status-Reason")),Espo.Ui.notify(!1)})},textNotification:function(e){this.$el.find(".notify-text").html(e)},run:function(e,t){var i=this.translate("Upgrading...","labels","Admin");Espo.Ui.notify(this.translate("pleaseWait","messages")),this.textNotification(i),Espo.Ajax.postRequest("Admin/action/runUpgrade",{id:e},{timeout:0,bypassAppReload:!0}).then(()=>{let e=this.getCache();e&&e.clear(),this.createView("popup","views/admin/upgrade/done",{version:t},e=>{Espo.Ui.notify(!1),e.render()})}).catch(e=>{this.$el.find(".panel.upload").removeClass("hidden");e=e.getResponseHeader("X-Status-Reason");this.textNotification(this.translate("Error")+": "+e)})}})}),define("views/admin/upgrade/done",["views/modal"],function(e){return e.extend({cssName:"done-modal",header:!1,createButton:!0,template:"admin/upgrade/done",data:function(){return{version:this.options.version,text:this.translate("upgradeDone","messages","Admin").replace("{version}",this.options.version)}},setup:function(){this.on("remove",()=>{window.location.reload()}),this.buttonList=[{name:"close",label:"Close",onClick:e=>{setTimeout(()=>{this.getRouter().navigate("#Admin",{trigger:!0})},500),e.close()}}],this.header=this.getLanguage().translate("Upgraded successfully","labels","Admin")}})}),define("views/admin/template-manager/index",["view"],function(e){return e.extend({template:"admin/template-manager/index",data:function(){return{templateDataList:this.templateDataList}},events:{'click [data-action="selectTemplate"]':function(e){var t=$(e.currentTarget).data("name");this.getRouter().checkConfirmLeaveOut(()=>{this.selectTemplate(t)})}},setup:function(){this.templateDataList=[];var e=Object.keys(this.getMetadata().get(["app","templates"])||{});e.sort((e,t)=>this.translate(e,"templates","Admin").localeCompare(this.translate(t,"templates","Admin"))),e.forEach(t=>{var e=this.getMetadata().get(["app","templates",t]);if(e.scopeListConfigParam||e.scopeList)return(e=Espo.Utils.clone(e.scopeList||this.getConfig().get(e.scopeListConfigParam)||[])).sort((e,t)=>this.translate(e,"scopeNames").localeCompare(this.translate(t,"scopeNames"))),void e.forEach(e=>{e={name:t+"_"+e,text:this.translate(t,"templates","Admin")+" :: "+this.translate(e,"scopeNames")};this.templateDataList.push(e)});e={name:t,text:this.translate(t,"templates","Admin")};this.templateDataList.push(e)}),this.selectedTemplate=this.options.name,this.selectedTemplate&&this.once("after:render",()=>{this.selectTemplate(this.selectedTemplate,!0)})},selectTemplate:function(e){this.selectedTemplate=e,this.getRouter().navigate("#Admin/templateManager/name="+this.selectedTemplate,{trigger:!1}),this.createRecordView(),this.$el.find('[data-action="selectTemplate"]').removeClass("disabled").removeAttr("disabled"),this.$el.find('[data-name="'+e+'"][data-action="selectTemplate"]').addClass("disabled").attr("disabled","disabled")},createRecordView:function(){Espo.Ui.notify(" ... "),this.createView("record","views/admin/template-manager/edit",{selector:".template-record",name:this.selectedTemplate},e=>{e.render(),Espo.Ui.notify(!1),$(window).scrollTop(0)})},updatePageTitle:function(){this.setPageTitle(this.getLanguage().translate("Template Manager","labels","Admin"))}})}),define("views/admin/template-manager/edit",["view","model"],function(e,i){return e.extend({template:"admin/template-manager/edit",data:function(){return{title:this.title,hasSubject:this.hasSubject}},events:{'click [data-action="save"]':function(){this.actionSave()},'click [data-action="cancel"]':function(){this.actionCancel()},'click [data-action="resetToDefault"]':function(){this.actionResetToDefault()},"keydown.form":function(e){var t=Espo.Utils.getKeyFromKeyEvent(e);"Control+KeyS"!==t&&"Control+Enter"!==t||(this.actionSave(),e.preventDefault(),e.stopPropagation())}},setup:function(){this.wait(!0),this.fullName=this.options.name,this.name=this.fullName,this.scope=null;var e=this.fullName.split("_");1<e.length&&(this.scope=e[1],this.name=e[0]),this.hasSubject=!this.getMetadata().get(["app","templates",this.name,"noSubject"]),this.title=this.translate(this.name,"templates","Admin"),this.scope&&(this.title+=" :: "+this.translate(this.scope,"scopeNames")),this.attributes={},Espo.Ajax.getRequest("TemplateManager/action/getTemplate",{name:this.name,scope:this.scope}).then(function(e){var t=this.model=new i;t.name="TemplateManager",t.set("body",e.body),this.attributes.body=e.body,this.hasSubject&&(t.set("subject",e.subject),this.attributes.subject=e.subject),this.listenTo(t,"change",function(){this.setConfirmLeaveOut(!0)},this),this.createView("bodyField","views/fields/wysiwyg",{name:"body",model:t,selector:".body-field",mode:"edit"}),this.hasSubject&&this.createView("subjectField","views/fields/varchar",{name:"subject",model:t,selector:".subject-field",mode:"edit"}),this.wait(!1)}.bind(this))},setConfirmLeaveOut:function(e){this.getRouter().confirmLeaveOut=e},afterRender:function(){this.$save=this.$el.find('button[data-action="save"]'),this.$cancel=this.$el.find('button[data-action="cancel"]'),this.$resetToDefault=this.$el.find('button[data-action="resetToDefault"]')},actionSave:function(){this.$save.addClass("disabled").attr("disabled"),this.$cancel.addClass("disabled").attr("disabled"),this.$resetToDefault.addClass("disabled").attr("disabled"),this.getView("bodyField").fetchToModel();var e={name:this.name,body:this.model.get("body")};this.scope&&(e.scope=this.scope),this.hasSubject&&(this.getView("subjectField").fetchToModel(),e.subject=this.model.get("subject")),Espo.Ui.notify(this.translate("saving","messages")),Espo.Ajax.postRequest("TemplateManager/action/saveTemplate",e).then(()=>{this.setConfirmLeaveOut(!1),this.attributes.body=e.body,this.attributes.subject=e.subject,this.$save.removeClass("disabled").removeAttr("disabled"),this.$cancel.removeClass("disabled").removeAttr("disabled"),this.$resetToDefault.removeClass("disabled").removeAttr("disabled"),Espo.Ui.success(this.translate("Saved"))}).catch(()=>{this.$save.removeClass("disabled").removeAttr("disabled"),this.$cancel.removeClass("disabled").removeAttr("disabled"),this.$resetToDefault.removeClass("disabled").removeAttr("disabled")})},actionCancel:function(){this.model.set("subject",this.attributes.subject),this.model.set("body",this.attributes.body),this.setConfirmLeaveOut(!1)},actionResetToDefault:function(){this.confirm(this.translate("confirmation","messages"),()=>{this.$save.addClass("disabled").attr("disabled"),this.$cancel.addClass("disabled").attr("disabled"),this.$resetToDefault.addClass("disabled").attr("disabled");var e={name:this.name,body:this.model.get("body")};this.scope&&(e.scope=this.scope),Espo.Ui.notify(this.translate("pleaseWait","messages")),Espo.Ajax.postRequest("TemplateManager/action/resetTemplate",e).then(e=>{this.$save.removeClass("disabled").removeAttr("disabled"),this.$cancel.removeClass("disabled").removeAttr("disabled"),this.$resetToDefault.removeClass("disabled").removeAttr("disabled"),this.attributes.body=e.body,this.attributes.subject=e.subject,this.model.set("subject",e.subject),this.model.set("body",e.body),this.setConfirmLeaveOut(!1),Espo.Ui.notify(!1)}).catch(()=>{this.$save.removeClass("disabled").removeAttr("disabled"),this.$cancel.removeClass("disabled").removeAttr("disabled"),this.$resetToDefault.removeClass("disabled").removeAttr("disabled")})})}})}),define("views/admin/system-requirements/index",["view"],function(e){return e.extend({template:"admin/system-requirements/index",data:function(){return{phpRequirementList:this.requirementList.php,databaseRequirementList:this.requirementList.database,permissionRequirementList:this.requirementList.permission}},setup:function(){this.requirementList=[],Espo.Ajax.getRequest("Admin/action/systemRequirementList").then(e=>{this.requirementList=e,(this.isRendered()||this.isBeingRendered())&&this.reRender()})}})}),define("views/admin/panels/notifications",["view"],function(e){return e.extend({template:"admin/panels/notifications",data:function(){return{notificationList:this.notificationList}},setup:function(){this.notificationList=[],Espo.Ajax.getRequest("Admin/action/adminNotificationList").then(e=>{this.notificationList=e,(this.isRendered()||this.isBeingRendered())&&this.reRender()})}})}),define("views/admin/link-manager/modals/edit",["exports","views/modal","model","views/admin/link-manager/index","views/fields/enum"],function(e,t,g,y,b){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),g=i(g),y=i(y),b=i(b);class a extends t.default{template="admin/link-manager/modals/edit";cssName="edit";className="dialog dialog-record";shortcutKeys={"Control+KeyS":function(e){this.save({noClose:!0}),e.preventDefault(),e.stopPropagation()},"Control+Enter":function(e){this.save(),e.preventDefault(),e.stopPropagation()}};setup(){this.buttonList=[{name:"save",label:"Save",style:"danger",onClick:()=>{this.save()}},{name:"cancel",label:"Cancel",onClick:()=>{this.close()}}];var e=this.scope=this.options.scope,i=this.link=this.options.link||!1,a=e,t=this.isNew=!1===i;let h=t?"Create Link":"Edit Link",s=(this.headerText=this.translate(h,"labels","Admin"),this.model=new g.default);s.name="EntityManager",this.model.set("entity",e);var n=this.getMetadata().getScopeEntityList().filter(e=>this.getMetadata().get(["scopes",e,"customizable"])).sort((e,t)=>{e=this.translate(e,"scopeNames"),t=this.translate(t,"scopeNames");return e.localeCompare(t)});let c=!0,f;if(!t){var o=this.getMetadata().get("entityDefs."+e+".links."+i+".entity"),l=this.getMetadata().get("entityDefs."+e+".links."+i+".foreign"),r=this.getLanguage().translate(i,"links",e);let t=this.getLanguage().translate(l,"links",o);var d=this.getMetadata().get("entityDefs."+a+".links."+i+".type"),u=this.getMetadata().get("entityDefs."+o+".links."+l+".type");if("belongsToParent"===d){f="childrenToParent",t=null;let e=this.getMetadata().get(["entityDefs",a,"fields",i,"entityList"])||[];null===this.getMetadata().get(["entityDefs",a,"fields",i,"entityList"])&&(e=n,this.noParentEntityTypeList=!0),this.model.set("parentEntityTypeList",e);n=this.getForeignLinkEntityTypeList(a,i,e);this.model.set("foreignLinkEntityTypeList",n)}else f=y.default.prototype.computeRelationshipType.call(this,d,u);this.model.set("linkType",f),this.model.set("entityForeign",o),this.model.set("link",i),this.model.set("linkForeign",l),this.model.set("label",r),this.model.set("labelForeign",t);n="linkMultiple"===this.getMetadata().get(["entityDefs",e,"fields",i,"type"])&&!this.getMetadata().get(["entityDefs",e,"fields",i,"noLoad"]),d="linkMultiple"===this.getMetadata().get(["entityDefs",o,"fields",l,"type"])&&!this.getMetadata().get(["entityDefs",o,"fields",l,"noLoad"]),r=(this.model.set("linkMultipleField",n),this.model.set("linkMultipleFieldForeign",d),"manyToMany"===f&&(u=this.getMetadata().get("entityDefs."+a+".links."+i+".relationName"),this.model.set("relationName",u)),this.getMetadata().get(["entityDefs",e,"links",i,"audited"])||!1),n=this.getMetadata().get(["entityDefs",o,"links",l,"audited"])||!1,d=(this.model.set("audited",r),this.model.set("auditedForeign",n),this.getMetadata().get(["clientDefs",e,"relationshipPanels",i,"layout"])),u=this.getMetadata().get(["clientDefs",o,"relationshipPanels",l,"layout"]);this.model.set("layout",d),this.model.set("layoutForeign",u),c=this.getMetadata().get("entityDefs."+a+".links."+i+".isCustom")}let p=this.getMetadata().get("scopes")||null,m=(Object.keys(p)||[]).filter(e=>{e=p[e];return e.customizable&&e.entity}).sort((e,t)=>{let i=this.translate(e,"scopeNames");e=this.translate(t,"scopeNames");return i.localeCompare(e)});m.unshift(""),this.createView("entity","views/fields/varchar",{model:s,mode:"edit",selector:'.field[data-name="entity"]',defs:{name:"entity"},readOnly:!0}),this.createView("entityForeign","views/fields/enum",{model:s,mode:"edit",selector:'.field[data-name="entityForeign"]',defs:{name:"entityForeign",params:{required:!0,options:m,translation:"Global.scopeNames"}},readOnly:!t}),this.createView("linkType","views/fields/enum",{model:s,mode:"edit",selector:'.field[data-name="linkType"]',defs:{name:"linkType",params:{required:!0,options:["","oneToMany","manyToOne","manyToMany","oneToOneRight","oneToOneLeft","childrenToParent"]}},readOnly:!t}),this.createView("link","views/fields/varchar",{model:s,mode:"edit",selector:'.field[data-name="link"]',defs:{name:"link",params:{required:!0,trim:!0,maxLength:61}},readOnly:!t}),this.createView("linkForeign","views/fields/varchar",{model:s,mode:"edit",selector:'.field[data-name="linkForeign"]',defs:{name:"linkForeign",params:{required:!0,trim:!0,maxLength:61}},readOnly:!t}),this.createView("label","views/fields/varchar",{model:s,mode:"edit",selector:'.field[data-name="label"]',defs:{name:"label",params:{required:!0,trim:!0}}}),this.createView("labelForeign","views/fields/varchar",{model:s,mode:"edit",selector:'.field[data-name="labelForeign"]',defs:{name:"labelForeign",params:{required:!0,trim:!0}}}),(t||this.model.get("relationName"))&&this.createView("relationName","views/fields/varchar",{model:s,mode:"edit",selector:'.field[data-name="relationName"]',defs:{name:"relationName",params:{required:!0,trim:!0,maxLength:61}},readOnly:!t}),this.createView("linkMultipleField","views/fields/bool",{model:s,mode:"edit",selector:'.field[data-name="linkMultipleField"]',defs:{name:"linkMultipleField"},readOnly:!c,tooltip:!0,tooltipText:this.translate("linkMultipleField","tooltips","EntityManager")}),this.createView("linkMultipleFieldForeign","views/fields/bool",{model:s,mode:"edit",selector:'.field[data-name="linkMultipleFieldForeign"]',defs:{name:"linkMultipleFieldForeign"},readOnly:!c,tooltip:!0,tooltipText:this.translate("linkMultipleField","tooltips","EntityManager")}),this.createView("audited","views/fields/bool",{model:s,mode:"edit",selector:'.field[data-name="audited"]',defs:{name:"audited"},tooltip:!0,tooltipText:this.translate("linkAudited","tooltips","EntityManager")}),this.createView("auditedForeign","views/fields/bool",{model:s,mode:"edit",selector:'.field[data-name="auditedForeign"]',defs:{name:"auditedForeign"},tooltip:!0,tooltipText:this.translate("linkAudited","tooltips","EntityManager")});r=["",...this.getEntityTypeLayouts(this.scope)],n=this.getEntityTypeLayoutsTranslations(this.scope);this.layoutFieldView=new b.default({model:s,mode:"edit",defs:{name:"layout"},params:{options:[""]}}),this.layoutForeignFieldView=new b.default({model:s,mode:"edit",defs:{name:"layoutForeign"},params:{options:r},translatedOptions:n}),this.assignView("layout",this.layoutFieldView,'.field[data-name="layout"]'),this.assignView("layoutForeign",this.layoutForeignFieldView,'.field[data-name="layoutForeign"]'),this.createView("parentEntityTypeList","views/fields/entity-type-list",{model:s,mode:"edit",selector:'.field[data-name="parentEntityTypeList"]',defs:{name:"parentEntityTypeList"}}),this.createView("foreignLinkEntityTypeList","views/admin/link-manager/fields/foreign-link-entity-type-list",{model:s,mode:"edit",selector:'.field[data-name="foreignLinkEntityTypeList"]',defs:{name:"foreignLinkEntityTypeList",params:{options:this.model.get("parentEntityTypeList")||[]}}}),this.model.fetchedAttributes=this.model.getClonedAttributes(),this.listenTo(this.model,"change",()=>{if(this.model.hasChanged("parentEntityTypeList")||this.model.hasChanged("linkForeign")||this.model.hasChanged("link")){let e=this.getView("foreignLinkEntityTypeList"),t=(e&&(this.noParentEntityTypeList||e.setOptionList(this.model.get("parentEntityTypeList")||[])),Espo.Utils.clone(this.model.get("foreignLinkEntityTypeList")||[]));this.getForeignLinkEntityTypeList(this.model.get("entity"),this.model.get("link"),this.model.get("parentEntityTypeList")||[],!0).forEach(e=>{~t.indexOf(e)||t.push(e)}),this.model.set("foreignLinkEntityTypeList",t)}}),this.controlLayoutField(),this.listenTo(this.model,"change:entityForeign",()=>this.controlLayoutField())}getEntityTypeLayouts(e){let t=this.getMetadata().get(["clientDefs",e,"additionalLayouts"],{});return Object.keys(t).filter(e=>["list","listSmall"].includes(t[e].type))}getEntityTypeLayoutsTranslations(t){let i={};return this.getEntityTypeLayouts(t).forEach(e=>{i[e]=this.getLanguage().has(e,"layouts",t)?this.getLanguage().translate(e,"layouts",t):this.getLanguage().translate(e,"layouts","Admin")}),i}controlLayoutField(){var e=this.model.get("entityForeign"),t=e?["",...this.getEntityTypeLayouts(e)]:[""];this.layoutFieldView.translatedOptions=e?this.getEntityTypeLayoutsTranslations(e):{},this.layoutFieldView.setOptionList(t)}toPlural(e){return"y"===e.slice(-1)?e.substr(0,e.length-1)+"ies":"s"===e.slice(-1)?e.substr(0,e.length)+"es":e+"s"}populateFields(){var t=this.model.get("entityForeign"),i=this.model.get("linkType");let a,s;if("childrenToParent"===i)return this.model.set("link","parent"),this.model.set("label","Parent"),s=this.toPlural(Espo.Utils.lowerCaseFirst(this.scope)),this.getMetadata().get(["entityDefs",this.scope,"links","parent"])&&(this.model.set("link","parentAnother"),this.model.set("label","Parent Another"),s+="Another"),this.model.set("linkForeign",s),this.model.set("labelForeign",""),void this.model.set("entityForeign",null);if(!t||!i)return this.model.set("link",""),this.model.set("linkForeign",""),this.model.set("label",""),void this.model.set("labelForeign","");switch(i){case"oneToMany":s=Espo.Utils.lowerCaseFirst(this.scope),a=this.toPlural(Espo.Utils.lowerCaseFirst(t)),t===this.scope&&s===Espo.Utils.lowerCaseFirst(this.scope)&&(s+="Parent");break;case"manyToOne":s=this.toPlural(Espo.Utils.lowerCaseFirst(this.scope)),a=Espo.Utils.lowerCaseFirst(t),t===this.scope&&a===Espo.Utils.lowerCaseFirst(this.scope)&&(a+="Parent");break;case"manyToMany":s=this.toPlural(Espo.Utils.lowerCaseFirst(this.scope)),(a=this.toPlural(Espo.Utils.lowerCaseFirst(t)))===s&&(a+="Right",s+="Left");let e;e=this.scope.localeCompare(t)?Espo.Utils.lowerCaseFirst(this.scope)+t:Espo.Utils.lowerCaseFirst(t)+this.scope,this.model.set("relationName",e);break;case"oneToOneLeft":s=Espo.Utils.lowerCaseFirst(this.scope),a=Espo.Utils.lowerCaseFirst(t),t===this.scope&&s===Espo.Utils.lowerCaseFirst(this.scope)&&(a+="Parent");break;case"oneToOneRight":s=Espo.Utils.lowerCaseFirst(this.scope),a=Espo.Utils.lowerCaseFirst(t),t===this.scope&&s===Espo.Utils.lowerCaseFirst(this.scope)&&(s+="Parent")}let e=1;for(;this.getMetadata().get(["entityDefs",this.scope,"links",a]);)a+=e.toString(),e++;for(e=1;this.getMetadata().get(["entityDefs",t,"links",s]);)s+=e.toString(),e++;this.model.set("link",a),this.model.set("linkForeign",s);var i=Espo.Utils.upperCaseFirst(a.replace(/([a-z])([A-Z])/g,"$1 $2")),n=Espo.Utils.upperCaseFirst(s.replace(/([a-z])([A-Z])/g,"$1 $2"));this.model.set("label",i),this.model.set("labelForeign",n)}handleLinkChange(e){let t=this.model.get(e);t&&(t=t.replace(/-/g," ").replace(/_/g," ").replace(/[^\w\s]/gi,"").replace(/ (.)/g,(e,t)=>t.toUpperCase()).replace(" ","")).length&&(t=Espo.Utils.lowerCaseFirst(t)),this.model.set(e,t)}hideField(e){let t=this.getView(e);t&&(t.disabled=!0),this.$el.find(".cell[data-name="+e+"]").addClass("hidden-cell")}showField(e){let t=this.getView(e);t&&(t.disabled=!1),this.$el.find(".cell[data-name="+e+"]").removeClass("hidden-cell")}handleLinkTypeChange(){var e=this.model.get("linkType");this.showField("entityForeign"),this.showField("labelForeign"),this.hideField("parentEntityTypeList"),this.hideField("foreignLinkEntityTypeList"),"manyToMany"===e?(this.showField("relationName"),this.showField("linkMultipleField"),this.showField("linkMultipleFieldForeign"),this.showField("audited"),this.showField("auditedForeign"),this.showField("layout"),this.showField("layoutForeign")):(this.hideField("relationName"),"oneToMany"===e?(this.showField("linkMultipleField"),this.hideField("linkMultipleFieldForeign"),this.showField("audited"),this.hideField("auditedForeign"),this.showField("layout"),this.hideField("layoutForeign")):"manyToOne"===e?(this.hideField("linkMultipleField"),this.showField("linkMultipleFieldForeign"),this.hideField("audited"),this.showField("auditedForeign"),this.hideField("layout"),this.showField("layoutForeign")):(this.hideField("linkMultipleField"),this.hideField("linkMultipleFieldForeign"),this.hideField("audited"),this.hideField("auditedForeign"),this.hideField("layout"),this.hideField("layoutForeign"),"parentToChildren"===e?(this.showField("audited"),this.hideField("auditedForeign"),this.showField("layout"),this.hideField("layoutForeign")):"childrenToParent"===e?(this.hideField("audited"),this.showField("auditedForeign"),this.hideField("layout"),this.showField("layoutForeign"),this.hideField("entityForeign"),this.hideField("labelForeign"),this.noParentEntityTypeList||this.showField("parentEntityTypeList"),this.model.get("linkForeign")?this.showField("foreignLinkEntityTypeList"):this.hideField("foreignLinkEntityTypeList")):(this.hideField("audited"),this.hideField("auditedForeign"),this.hideField("layout"),this.hideField("layoutForeign")))),this.getMetadata().get(["scopes",this.scope,"stream"])||this.hideField("audited"),this.getMetadata().get(["scopes",this.model.get("entityForeign"),"stream"])||this.hideField("auditedForeign")}afterRender(){this.handleLinkTypeChange(),this.getView("linkType").on("change",()=>{this.handleLinkTypeChange(),this.populateFields()}),this.getView("entityForeign").on("change",()=>{this.populateFields()}),this.getView("link").on("change",()=>{this.handleLinkChange("link")}),this.getView("linkForeign").on("change",()=>{this.handleLinkChange("linkForeign")})}save(i){i=i||{};let e=["link","linkForeign","label","labelForeign","linkType","entityForeign","relationName","linkMultipleField","linkMultipleFieldForeign","audited","auditedForeign","layout","layoutForeign","parentEntityTypeList","foreignLinkEntityTypeList"],a=!1;if(e.forEach(e=>{this.hasView(e)&&"edit"===this.getView(e).mode&&this.getView(e).fetchToModel()}),e.forEach(t=>{if(this.hasView(t)){let e=this.getView(t);"edit"===e.mode&&(e.disabled||(a=e.validate()||a))}}),!a){this.$el.find('button[data-name="save"]').addClass("disabled").attr("disabled");let e="EntityManager/action/createLink";this.isNew||(e="EntityManager/action/updateLink");var s=this.scope,n=this.model.get("entityForeign"),o=this.model.get("link"),l=this.model.get("linkForeign"),r=this.model.get("label"),d=this.model.get("labelForeign"),c=this.model.get("relationName"),f=this.model.get("linkMultipleField"),u=this.model.get("linkMultipleFieldForeign"),p=this.model.get("audited"),m=this.model.get("auditedForeign"),g=this.model.get("layout"),y=this.model.get("layoutForeign"),h=this.model.get("linkType");let t={entity:s,entityForeign:n,link:o,linkForeign:l,label:r,labelForeign:d,linkType:h,relationName:c,linkMultipleField:f,linkMultipleFieldForeign:u,audited:p,auditedForeign:m,layout:g,layoutForeign:y};this.isNew||(t.label===this.model.fetchedAttributes.label&&delete t.label,t.labelForeign===this.model.fetchedAttributes.labelForeign&&delete t.labelForeign),"childrenToParent"===h&&(delete t.entityForeign,delete t.labelForeign,t.parentEntityTypeList=this.model.get("parentEntityTypeList"),t.foreignLinkEntityTypeList=this.model.get("foreignLinkEntityTypeList"),this.noParentEntityTypeList&&(t.parentEntityTypeList=null)),Espo.Ajax.postRequest(e,t).then(()=>{this.isNew?Espo.Ui.success(this.translate("Created")):Espo.Ui.success(this.translate("Saved")),this.model.fetchedAttributes=this.model.getClonedAttributes(),Promise.all([this.getMetadata().loadSkipCache(),this.getLanguage().loadSkipCache()]).then(()=>{this.broadcastUpdate(),this.trigger("after:save"),i.noClose||this.close(),i.noClose&&this.$el.find('button[data-name="save"]').removeClass("disabled").removeAttr("disabled")})}).catch(e=>{var t,i;409===e.status&&(t=this.translate("linkConflict","messages","EntityManager"),(i=e.getResponseHeader("X-Status-Reason"))&&console.error(i),Espo.Ui.error(t),e.errorIsHandled=!0),this.$el.find('button[data-name="save"]').removeClass("disabled").removeAttr("disabled")})}}getForeignLinkEntityTypeList(s,n,e,o){let l=[];return e.forEach(e=>{var t,i=this.getMetadata().get(["entityDefs",e,"links"])||{};let a=!1;for(t in i)if(!(i[t].foreign!==n||i[t].entity!==s||"hasChildren"!==i[t].type||o&&i[t].isCustom)){a=!0;break}a&&l.push(e)}),l}broadcastUpdate(){this.getHelper().broadcastChannel.postMessage("update:metadata"),this.getHelper().broadcastChannel.postMessage("update:language")}}e.default=a}),define("views/admin/link-manager/fields/foreign-link-entity-type-list",["views/fields/checklist"],function(e){return e.extend({setup:function(){this.params.translation="Global.scopeNames",e.prototype.setup.call(this)},afterRender:function(){e.prototype.afterRender.call(this),this.controlOptionsAvailability()},controlOptionsAvailability:function(){this.params.options.forEach(e=>{var t,i=this.model.get("link"),a=this.model.get("linkForeign"),s=this.model.get("entity"),n=this.getMetadata().get(["entityDefs",e,"links"])||{},o=!1;for(t in n)(n[t].foreign===i&&!n[t].isCustom&&n[t].entity===s||t===a&&"hasChildren"!==n[t].type)&&(o=!0);o&&this.$el.find('input[data-name="checklistItem-foreignLinkEntityTypeList-'+e+'"]').attr("disabled","disabled")})}})}),define("views/admin/layouts/side-panels-edit",["views/admin/layouts/side-panels-detail"],function(e){return e.extend({viewType:"edit"})}),define("views/admin/layouts/side-panels-edit-small",["views/admin/layouts/side-panels-detail"],function(e){return e.extend({viewType:"editSmall"})}),define("views/admin/layouts/side-panels-detail-small",["views/admin/layouts/side-panels-detail"],function(e){return e.extend({viewType:"detailSmall"})}),define("views/admin/layouts/relationships",["views/admin/layouts/rows"],function(e){return e.extend({dataAttributeList:["name","dynamicLogicVisible","style","dynamicLogicStyled"],editable:!0,dataAttributesDefs:{style:{type:"enum",options:["default","success","danger","warning"],translation:"LayoutManager.options.style"},dynamicLogicVisible:{type:"base",view:"views/admin/field-manager/fields/dynamic-logic-conditions",tooltip:"dynamicLogicVisible"},dynamicLogicStyled:{type:"base",view:"views/admin/field-manager/fields/dynamic-logic-conditions",tooltip:"dynamicLogicStyled"},name:{readOnly:!0}},languageCategory:"links",setup:function(){e.prototype.setup.call(this),this.dataAttributesDefs=Espo.Utils.cloneDeep(this.dataAttributesDefs),this.dataAttributesDefs.dynamicLogicVisible.scope=this.scope,this.dataAttributesDefs.dynamicLogicStyled.scope=this.scope,this.wait(!0),this.loadLayout(()=>{this.wait(!1)})},loadLayout:function(l){this.getModelFactory().create(this.scope,o=>{this.getHelper().layoutManager.getOriginal(this.scope,this.type,this.setId,e=>{let t=[];for(var i in o.defs.links)-1!==["hasMany","hasChildren"].indexOf(o.defs.links[i].type)&&this.isLinkEnabled(o,i)&&t.push(i);for(var a in t.sort((e,t)=>this.translate(e,"links",this.scope).localeCompare(this.translate(t,"links",this.scope))),t.push("_delimiter_"),this.enabledFieldsList=[],this.enabledFields=[],this.disabledFields=[],e){a=e[a];let i;"string"==typeof a||a instanceof String?i={name:a,label:this.getLanguage().translate(a,"links",this.scope)}:(i=a).label=this.getLanguage().translate(i.name,"links",this.scope),"_"===i.name[0]&&(i.notEditable=!0,"_delimiter_"===i.name&&(i.label=". . .")),this.dataAttributeList.forEach(e=>{var t;"name"!==e&&(e in i||null!==(t=this.getMetadata().get(["clientDefs",this.scope,"relationshipPanels",i.name,e]))&&(i[e]=t))}),this.enabledFields.push(i),this.enabledFieldsList.push(i.name)}for(var s in t)if(!_.contains(this.enabledFieldsList,t[s])){s=t[s];let e={name:s,label:this.getLanguage().translate(s,"links",this.scope)};"_"===e.name[0]&&(e.notEditable=!0,"_delimiter_"===e.name&&(e.label=". . .")),this.disabledFields.push(e)}for(var n in this.rowLayout=this.enabledFields,this.rowLayout){let e=this.rowLayout[n];e.label=this.getLanguage().translate(this.rowLayout[n].name,"links",this.scope),"_delimiter_"===e.name&&(e.label=". . ."),this.itemsData[this.rowLayout[n].name]=Espo.Utils.cloneDeep(this.rowLayout[n])}l()})})},validate:function(){return!0},isLinkEnabled:function(e,t){return!e.getLinkParam(t,"disabled")&&!e.getLinkParam(t,"utility")&&!e.getLinkParam(t,"layoutRelationshipsDisabled")}})}),define("views/admin/layouts/mass-update",["views/admin/layouts/rows"],function(e){return e.extend({dataAttributeList:["name"],editable:!1,ignoreList:[],ignoreTypeList:["duration"],dataAttributesDefs:{name:{readOnly:!0}},setup:function(){e.prototype.setup.call(this),this.wait(!0),this.loadLayout(()=>{this.wait(!1)})},loadLayout:function(l){this.getModelFactory().create(this.scope,o=>{this.getHelper().layoutManager.getOriginal(this.scope,this.type,this.setId,e=>{var t,i,a,s,n=[];for(t in o.defs.fields)!o.getFieldParam(t,"readOnly")&&this.isFieldEnabled(o,t)&&n.push(t);for(i in n.sort((e,t)=>this.translate(e,"fields",this.scope).localeCompare(this.translate(t,"fields",this.scope))),this.enabledFieldsList=[],this.enabledFields=[],this.disabledFields=[],e)this.enabledFields.push({name:e[i],label:this.getLanguage().translate(e[i],"fields",this.scope)}),this.enabledFieldsList.push(e[i]);for(a in n)_.contains(this.enabledFieldsList,n[a])||this.disabledFields.push({name:n[a],label:this.getLanguage().translate(n[a],"fields",this.scope)});for(s in this.rowLayout=this.enabledFields,this.rowLayout)this.rowLayout[s].label=this.getLanguage().translate(this.rowLayout[s].name,"fields",this.scope),this.itemsData[this.rowLayout[s].name]=Espo.Utils.cloneDeep(this.rowLayout[s]);l()})})},fetch:function(){var i=[];return $("#layout ul.enabled > li").each((e,t)=>{i.push($(t).data("name"))}),i},validate:function(){return!0},isFieldEnabled:function(e,t){if(-1!==this.ignoreList.indexOf(t))return!1;if(-1!==this.ignoreTypeList.indexOf(e.getFieldParam(t,"type")))return!1;var i=e.getFieldParam(t,"layoutAvailabilityList");return!i||~i.indexOf(this.type)?!(e.getFieldParam(t,"disabled")||e.getFieldParam(t,"utility")||e.getFieldParam(t,"layoutMassUpdateDisabled")||e.getFieldParam(t,"readOnly")):void 0}})}),define("views/admin/layouts/list-small",["views/admin/layouts/list"],function(e){return e.extend({})}),define("views/admin/layouts/kanban",["views/admin/layouts/list"],function(e){return e.extend({dataAttributeList:["name","link","align","view","isLarge"],dataAttributesDefs:{link:{type:"bool"},isLarge:{type:"bool"},width:{type:"float"},align:{type:"enum",options:["left","right"]},view:{type:"varchar",readOnly:!0},name:{type:"varchar",readOnly:!0}},editable:!0,ignoreList:[],ignoreTypeList:[]})}),define("views/admin/layouts/filters",["views/admin/layouts/rows"],function(e){return e.extend({dataAttributeList:["name"],editable:!1,ignoreList:[],setup:function(){e.prototype.setup.call(this),this.wait(!0),this.loadLayout(()=>{this.wait(!1)})},loadLayout:function(l){this.getModelFactory().create(this.scope,o=>{this.getHelper().layoutManager.getOriginal(this.scope,this.type,this.setId,e=>{let t=[];for(var i in o.defs.fields)this.checkFieldType(o.getFieldParam(i,"type"))&&this.isFieldEnabled(o,i)&&t.push(i);for(var a in t.sort((e,t)=>this.translate(e,"fields",this.scope).localeCompare(this.translate(t,"fields",this.scope))),this.enabledFieldsList=[],this.enabledFields=[],this.disabledFields=[],e)this.enabledFields.push({name:e[a],label:this.getLanguage().translate(e[a],"fields",this.scope)}),this.enabledFieldsList.push(e[a]);for(var s in t)_.contains(this.enabledFieldsList,t[s])||this.disabledFields.push({name:t[s],label:this.getLanguage().translate(t[s],"fields",this.scope)});for(var n in this.rowLayout=this.enabledFields,this.rowLayout)this.rowLayout[n].label=this.getLanguage().translate(this.rowLayout[n].name,"fields",this.scope);l()})})},fetch:function(){var i=[];return $("#layout ul.enabled > li").each((e,t)=>{i.push($(t).data("name"))}),i},checkFieldType:function(e){return this.getFieldManager().checkFilter(e)},validate:function(){return!0},isFieldEnabled:function(e,t){return-1===this.ignoreList.indexOf(t)&&(!e.getFieldParam(t,"disabled")&&!e.getFieldParam(t,"utility")&&!e.getFieldParam(t,"layoutFiltersDisabled"))}})}),define("views/admin/layouts/detail-small",["views/admin/layouts/detail"],function(e){return e.extend({columnCount:2})}),define("views/admin/layouts/detail-convert",["views/admin/layouts/detail"],function(e){return e.extend({})}),define("views/admin/layouts/default-side-panel",["views/admin/layouts/rows"],function(e){return e.extend({dataAttributeList:["name","view","customLabel"],dataAttributesDefs:{view:{type:"varchar",readOnly:!0},customLabel:{type:"varchar",readOnly:!0},name:{type:"varchar",readOnly:!0}},editable:!1,languageCategory:"fields",setup:function(){e.prototype.setup.call(this),this.wait(!0),this.loadLayout(function(){this.wait(!1)}.bind(this))},validate:function(){return!0},loadLayout:function(i){this.getModelFactory().create(Espo.Utils.hyphenToUpperCamelCase(this.scope),t=>{this.getHelper().layoutManager.getOriginal(this.scope,this.type,this.setId,e=>{this.readDataFromLayout(t,e),i&&i()})})},readDataFromLayout:function(e,s){var t,n=[];for(t in e.defs.fields)this.checkFieldType(e.getFieldParam(t,"type"))&&this.isFieldEnabled(e,t)&&n.push(t);n.sort((e,t)=>this.translate(e,"fields",this.scope).localeCompare(this.translate(t,"fields",this.scope))),~n.indexOf("assignedUser")&&n.unshift(":assignedUser"),this.enabledFieldsList=[],this.enabledFields=[],this.disabledFields=[];var o=[],l=[];for(let a=0;a<s.length;a++){let e=s[a],t=(e="object"!=typeof e?{name:e}:e).name,i=(0===t.indexOf(":")&&(t=t.substr(1)),this.getLanguage().translate(t,"fields",this.scope));t!==e.name&&(i+=" *"),~o.indexOf(i)&&l.push(i),o.push(i),this.enabledFields.push({name:e.name,label:i}),this.enabledFieldsList.push(e.name)}for(let a=0;a<n.length;a++)if(!_.contains(this.enabledFieldsList,n[a])){let e=this.getLanguage().translate(n[a],"fields",this.scope);~o.indexOf(e)&&l.push(e),o.push(e);var r=n[a];let t=r,i=(0===t.indexOf(":")&&(t=t.substr(1)),e=this.getLanguage().translate(t,"fields",this.scope),t!==r&&(e+=" *"),{name:r,label:e});r=this.getMetadata().get(["entityDefs",this.scope,"fields",r,"type"]);r&&this.getMetadata().get(["fields",r,"notSortable"])&&(i.notSortable=!0),this.disabledFields.push(i)}this.enabledFields.forEach(e=>{~l.indexOf(e.label)&&(e.label+=" ("+e.name+")")}),this.disabledFields.forEach(e=>{~l.indexOf(e.label)&&(e.label+=" ("+e.name+")")}),this.rowLayout=s;for(let t in this.rowLayout){var i=this.getLanguage().translate(this.rowLayout[t].name,"fields",this.scope);this.enabledFields.forEach(e=>{e.name===this.rowLayout[t].name&&(i=e.label)}),this.rowLayout[t].label=i,this.itemsData[this.rowLayout[t].name]=Espo.Utils.cloneDeep(this.rowLayout[t])}},checkFieldType:function(e){return!0},isFieldEnabled:function(e,t){if(~["modifiedAt","createdAt","modifiedBy","createdBy"].indexOf(t))return!1;let i=e.getFieldParam(t,"layoutAvailabilityList");return!(i&&!~i.indexOf(this.type))&&(!e.getFieldParam(t,"disabled")&&!e.getFieldParam(t,"utility")&&(!e.getFieldParam(t,"layoutDefaultSidePanelDisabled")&&!e.getFieldParam(t,"layoutDetailDisabled")))}})}),define("views/admin/layouts/bottom-panels-edit-small",["views/admin/layouts/bottom-panels-edit"],function(e){return e.extend({viewType:"editSmall"})}),define("views/admin/layouts/record/edit-attributes",["views/record/base"],function(e){return e.extend({template:"admin/layouts/record/edit-attributes",mode:"edit",data:function(){return{attributeDataList:this.getAttributeDataList()}},getAttributeDataList:function(){var i=[];return this.attributeList.forEach(e=>{var t=(this.attributeDefs[e]||{}).type,t=!["enum","bool","int","float","varchar"].includes(t);i.push({name:e,viewKey:e+"Field",isWide:t})}),i},setup:function(){e.prototype.setup.call(this),this.attributeList=this.options.attributeList||[],this.attributeDefs=this.options.attributeDefs||{},this.attributeList.forEach(e=>{var t=this.attributeDefs[e]||{},i=t.type||"base",i=t.view||this.getFieldManager().getViewName(i);this.createField(e,i,t)})}})}),define("views/admin/layouts/modals/panel-attributes",["views/modal","model"],function(e,a){return e.extend({templateContent:`
            <div class="panel panel-default no-side-margin">
                <div class="panel-body">
                    <div class="edit-container">{{{edit}}}</div>
                </div>
            </div>
        `,className:"dialog dialog-record",shortcutKeys:{"Control+Enter":function(e){this.actionSave(),e.preventDefault(),e.stopPropagation()}},setup:function(){this.buttonList=[{name:"save",text:this.translate("Apply"),style:"primary"},{name:"cancel",text:"Cancel"}];let e=new a;e.name="LayoutManager",e.set(this.options.attributes||{});var t=this.options.attributeList,i=this.options.attributeDefs;this.createView("edit","views/admin/layouts/record/edit-attributes",{selector:".edit-container",attributeList:t,attributeDefs:i,model:e,dynamicLogicDefs:this.options.dynamicLogicDefs})},actionSave:function(){let e=this.getView("edit");var t=e.fetch();if(e.model.set(t,{silent:!0}),!e.validate())return t=e.model.attributes,this.trigger("after:save",t),!0}})}),define("views/admin/layouts/modals/edit-attributes",["views/modal","model"],function(e,a){return e.extend({templateContent:`
            <div class="panel panel-default no-side-margin">
                <div class="panel-body">
                    <div class="edit-container">{{{edit}}}</div>
                </div>
            </div>
        `,className:"dialog dialog-record",shortcutKeys:{"Control+Enter":function(e){this.actionSave(),e.preventDefault(),e.stopPropagation()}},setup:function(){this.buttonList=[{name:"save",text:this.translate("Apply"),style:"primary"},{name:"cancel",text:this.translate("Cancel")}];let e=new a,t=(e.name="LayoutManager",e.set(this.options.attributes||{}),this.headerText=null,this.options.languageCategory&&(this.headerText=this.translate(this.options.name,this.options.languageCategory,this.options.scope)),Espo.Utils.clone(this.options.attributeList||[])),i=[];t.forEach(e=>{(this.options.attributeDefs[e]||{}).readOnly||i.push(e)}),t=i,this.createView("edit","views/admin/layouts/record/edit-attributes",{selector:".edit-container",attributeList:t,attributeDefs:this.options.attributeDefs,dynamicLogicDefs:this.options.dynamicLogicDefs,model:e})},actionSave:function(){let e=this.getView("edit");var t=e.fetch();if(e.model.set(t,{silent:!0}),!e.validate())return t=e.model.attributes,this.trigger("after:save",t),!0}})}),define("views/admin/label-manager/index",["exports","view","ui/select"],function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),i=a(i);class s extends t.default{template="admin/label-manager/index";scopeList=null;scope=null;language=null;languageList=null;events={'click [data-action="selectScope"]':function(e){let t=$(e.currentTarget).data("name");this.getRouter().checkConfirmLeaveOut(()=>{this.selectScope(t)})},'change select[data-name="language"]':function(e){let t=$(e.currentTarget).val();this.getRouter().checkConfirmLeaveOut(()=>{this.selectLanguage(t)})}};data(){return{scopeList:this.scopeList,languageList:this.languageList,scope:this.scope,language:this.language}}setup(){this.languageList=this.getMetadata().get(["app","language","list"])||["en_US"],this.languageList.sort((e,t)=>this.getLanguage().translateOption(e,"language").localeCompare(this.getLanguage().translateOption(t,"language"))),this.wait(!0),Espo.Ajax.postRequest("LabelManager/action/getScopeList").then(e=>{this.scopeList=e,this.scopeList.sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural"))),this.scopeList=this.scopeList.filter(e=>{if(!("Global"===e||this.getMetadata().get(["scopes",e])&&this.getMetadata().get(["scopes",e,"disabled"])))return!0}),this.scopeList.unshift("Global"),this.wait(!1)}),this.scope=this.options.scope||"Global",this.language=this.options.language||this.getConfig().get("language"),this.once("after:render",()=>{this.selectScope(this.scope,!0)})}afterRender(){i.default.init(this.element.querySelector('select[data-name="language"]'))}selectLanguage(e){this.language=e,this.scope?this.getRouter().navigate("#Admin/labelManager/scope="+this.scope+"&language="+this.language,{trigger:!1}):this.getRouter().navigate("#Admin/labelManager/language="+this.language,{trigger:!1}),this.createRecordView()}selectScope(e,t){this.scope=e,t||this.getRouter().navigate("#Admin/labelManager/scope="+e+"&language="+this.language,{trigger:!1}),this.$el.find('[data-action="selectScope"]').removeClass("disabled").removeAttr("disabled"),this.$el.find('[data-name="'+e+'"][data-action="selectScope"]').addClass("disabled").attr("disabled","disabled"),this.createRecordView()}createRecordView(){Espo.Ui.notify(" ... "),this.createView("record","views/admin/label-manager/edit",{selector:".language-record",scope:this.scope,language:this.language},e=>{e.render(),Espo.Ui.notify(!1),$(window).scrollTop(0)})}updatePageTitle(){this.setPageTitle(this.getLanguage().translate("Label Manager","labels","Admin"))}}e.default=s}),define("views/admin/label-manager/edit",["view"],function(e){return e.extend({template:"admin/label-manager/edit",data:function(){return{categoryList:this.getCategoryList(),scope:this.scope}},events:{'click [data-action="showCategory"]':function(e){e=$(e.currentTarget).data("name");this.showCategory(e)},'click [data-action="hideCategory"]':function(e){e=$(e.currentTarget).data("name");this.hideCategory(e)},'click [data-action="cancel"]':function(e){this.actionCancel()},'click [data-action="save"]':function(e){this.actionSave()},"change input.label-value":function(e){var t=$(e.currentTarget).data("name"),e=$(e.currentTarget).val();this.setLabelValue(t,e)}},setup:function(){this.scope=this.options.scope,this.language=this.options.language,this.dirtyLabelList=[],this.wait(!0),Espo.Ajax.postRequest("LabelManager/action/getScopeData",{scope:this.scope,language:this.language}).then(e=>{this.scopeData=e,this.scopeDataInitial=Espo.Utils.cloneDeep(this.scopeData),this.wait(!1)})},getCategoryList:function(){return Object.keys(this.scopeData).sort((e,t)=>e.localeCompare(t))},setLabelValue:function(e,t){var i=e.split("[.]")[0];t=(t=t.replace(/\\\\n/i,"\n")).trim(),this.scopeData[i][e]=t,this.dirtyLabelList.push(e),this.setConfirmLeaveOut(!0),this.hasView(i)&&(this.getView(i).categoryData[e]=t)},setConfirmLeaveOut:function(e){this.getRouter().confirmLeaveOut=e},afterRender:function(){this.$save=this.$el.find('button[data-action="save"]'),this.$cancel=this.$el.find('button[data-action="cancel"]')},actionSave:function(){this.$save.addClass("disabled").attr("disabled"),this.$cancel.addClass("disabled").attr("disabled");var i={};this.dirtyLabelList.forEach(e=>{var t=e.split("[.]")[0],t=this.scopeData[t][e];i[e]=t}),Espo.Ui.notify(this.translate("saving","messages")),Espo.Ajax.postRequest("LabelManager/action/saveLabels",{scope:this.scope,language:this.language,labels:i}).then(e=>{for(var t in this.scopeDataInitial=Espo.Utils.cloneDeep(this.scopeData),this.dirtyLabelList=[],this.setConfirmLeaveOut(!1),this.$save.removeClass("disabled").removeAttr("disabled"),this.$cancel.removeClass("disabled").removeAttr("disabled"),e){var i=t.split("[.]").splice(1).join("[.]");this.$el.find('input.label-value[data-name="'+i+'"]').val(e[t])}Espo.Ui.success(this.translate("Saved")),this.getHelper().broadcastChannel.postMessage("update:language"),this.getLanguage().loadSkipCache()}).catch(()=>{this.$save.removeClass("disabled").removeAttr("disabled"),this.$cancel.removeClass("disabled").removeAttr("disabled")})},actionCancel:function(){this.scopeData=Espo.Utils.cloneDeep(this.scopeDataInitial),this.dirtyLabelList=[],this.setConfirmLeaveOut(!1),this.getCategoryList().forEach(e=>{this.hasView(e)&&(this.getView(e).categoryData=this.scopeData[e],this.getView(e).reRender())})},showCategory:function(t){if(this.$el.find('a[data-action="showCategory"][data-name="'+t+'"]').addClass("hidden"),this.hasView(t))return this.$el.find('a[data-action="hideCategory"][data-name="'+t+'"]').removeClass("hidden"),void this.$el.find('.panel-body[data-name="'+t+'"]').removeClass("hidden");this.createView(t,"views/admin/label-manager/category",{selector:'.panel-body[data-name="'+t+'"]',categoryData:this.getCategoryData(t),scope:this.scope,language:this.language},e=>{this.$el.find('.panel-body[data-name="'+t+'"]').removeClass("hidden"),this.$el.find('a[data-action="hideCategory"][data-name="'+t+'"]').removeClass("hidden"),e.render()})},hideCategory:function(e){this.clearView(e),this.$el.find('.panel-body[data-name="'+e+'"]').addClass("hidden"),this.$el.find('a[data-action="showCategory"][data-name="'+e+'"]').removeClass("hidden"),this.$el.find('a[data-action="hideCategory"][data-name="'+e+'"]').addClass("hidden")},getCategoryData:function(e){return this.scopeData[e]||{}}})}),define("views/admin/label-manager/category",["view"],function(e){return e.extend({template:"admin/label-manager/category",data:function(){return{categoryDataList:this.getCategoryDataList()}},events:{},setup:function(){this.scope=this.options.scope,this.language=this.options.language,this.categoryData=this.options.categoryData},getCategoryDataList:function(){var e=Object.keys(this.categoryData),i=(e.sort((e,t)=>e.localeCompare(t)),[]);return e.forEach(e=>{var t=this.categoryData[e],t={name:e,value:t=(t=null===t?"":t).replace?t.replace(/\n/i,"\\n"):t},e=e.split("[.]");t.label=e.slice(1).join(" . "),i.push(t)}),i}})}),define("views/admin/job/list",["views/list"],function(e){return e.extend({createButton:!1,setup:function(){e.prototype.setup.call(this),this.getHelper().getAppParam("isRestrictedMode")&&!this.getUser().isSuperAdmin()||this.addMenuItem("buttons",{link:"#Admin/jobsSettings",text:this.translate("Settings","labels","Admin")})},getHeader:function(){return this.buildHeaderHtml([$("<a>").attr("href","#Admin").text(this.translate("Administration")),$("<span>").text(this.getLanguage().translate("Jobs","labels","Admin"))])},updatePageTitle:function(){this.setPageTitle(this.getLanguage().translate("Jobs","labels","Admin"))}})}),define("views/admin/job/record/list",["views/record/list"],function(e){return e.extend({rowActionsView:"views/record/row-actions/view-and-remove",massActionList:["remove"],rowActionsColumnWidth:"5%"})}),define("views/admin/job/record/detail-small",["views/record/detail-small"],function(e){return e.extend({sideView:null,isWide:!0})}),define("views/admin/job/modals/detail",["views/modals/detail"],function(e){return e.extend({editDisabled:!0,fullFormDisabled:!0})}),define("views/admin/job/fields/name",["views/fields/varchar"],function(e){return e.extend({getValueForDisplay:function(){if("list"===this.mode||"detail"===this.mode||"listLink"===this.mode)return this.model.get("name")?this.model.get("name"):this.model.get("serviceName")+": "+this.model.get("methodName")}})}),define("views/admin/integrations/oauth2",["views/admin/integrations/edit"],function(t){return t.extend({template:"admin/integrations/oauth2",data:function(){var e=this.redirectUri||this.getConfig().get("siteUrl")+"?entryPoint=oauthCallback";return _.extend({redirectUri:e},t.prototype.data.call(this))}})}),define("views/admin/integrations/index",["view"],function(e){return e.extend({template:"admin/integrations/index",integrationList:null,integration:null,data:function(){return{integrationList:this.integrationList,integration:this.integration}},events:{"click #integrations-menu a.integration-link":function(e){e=$(e.currentTarget).data("name");this.openIntegration(e)}},setup:function(){this.integrationList=Object.keys(this.getMetadata().get("integrations")||{}).sort((e,t)=>this.translate(e,"titles","Integration").localeCompare(this.translate(t,"titles","Integration"))),this.integration=this.options.integration||null,this.on("after:render",()=>{this.renderHeader(),this.integration?this.openIntegration(this.integration):this.renderDefaultPage()})},openIntegration:function(e){this.integration=e,this.getRouter().navigate("#Admin/integrations/name="+e,{trigger:!1});var t=this.getMetadata().get("integrations."+e+".view")||"views/admin/integrations/"+Espo.Utils.camelCaseToHyphen(this.getMetadata().get("integrations."+e+".authMethod"));Espo.Ui.notify(" ... "),this.createView("content",t,{fullSelector:"#integration-content",integration:e},e=>{this.renderHeader(),e.render(),Espo.Ui.notify(!1),$(window).scrollTop(0)})},renderDefaultPage:function(){$("#integration-header").html("").hide();let e;e=this.integrationList.length?this.translate("selectIntegration","messages","Integration"):'<p class="lead">'+this.translate("noIntegrations","messages","Integration")+"</p>",$("#integration-content").html(e)},renderHeader:function(){this.integration?$("#integration-header").show().html(this.translate(this.integration,"titles","Integration")):$("#integration-header").html("")},updatePageTitle:function(){this.setPageTitle(this.getLanguage().translate("Integrations","labels","Admin"))}})}),define("views/admin/integrations/google-maps",["views/admin/integrations/edit"],function(e){return e.extend({})}),define("views/admin/formula-sandbox/index",["view","model"],function(e,s){return e.extend({template:"admin/formula-sandbox/index",targetEntityType:null,storageKey:"formulaSandbox",data:function(){return{}},setup:function(){var e,t=[""].concat(this.getMetadata().getScopeEntityList().filter(e=>this.getMetadata().get(["scopes",e,"object"])));let i={script:null,targetId:null,targetType:null,output:null},a=(this.getSessionStorage().has(this.storageKey)&&(e=this.getSessionStorage().get(this.storageKey),i.script=e.script||null,i.targetId=e.targetId||null,i.targetName=e.targetName||null,i.targetType=e.targetType||null),this.model=new s);a.name="Formula",a.setDefs({fields:{targetType:{type:"enum",options:t,translation:"Global.scopeNames",view:"views/fields/entity-type"},target:{type:"link",entity:i.targetType},script:{type:"formula",view:"views/fields/formula"},output:{type:"text",readOnly:!0,displayRawText:!0,tooltip:!0},errorMessage:{type:"text",readOnly:!0,displayRawText:!0}}}),a.set(i),this.createRecordView(),this.listenTo(this.model,"change:targetType",(e,t,i)=>{i.ui&&setTimeout(()=>{this.targetEntityType=this.model.get("targetType"),this.model.set({targetId:null,targetName:null},{silent:!0});var e=Espo.Utils.cloneDeep(this.model.attributes);this.clearView("record"),this.model.set(e,{silent:!0}),this.model.defs.fields.target.entity=this.targetEntityType,this.createRecordView().then(e=>e.render())},10)}),this.listenTo(this.model,"run",()=>this.run()),this.listenTo(this.model,"change",(e,t)=>{t.ui&&(t={script:this.model.get("script"),targetType:this.model.get("targetType"),targetId:this.model.get("targetId"),targetName:this.model.get("targetName")},this.getSessionStorage().set(this.storageKey,t))})},createRecordView:function(){return this.createView("record","views/admin/formula-sandbox/record/edit",{selector:".record",model:this.model,targetEntityType:this.targetEntityType,confirmLeaveDisabled:!0,shortcutKeysEnabled:!0})},updatePageTitle:function(){this.setPageTitle(this.getLanguage().translate("Formula Sandbox","labels","Admin"))},run:function(){var e=this.model.get("script");if(this.model.set({output:null,errorMessage:null}),""===e||null===e)return this.model.set("output",null),void Espo.Ui.warning(this.translate("emptyScript","messages","Formula"));Espo.Ajax.postRequest("Formula/action/run",{expression:e,targetId:this.model.get("targetId"),targetType:this.model.get("targetType")}).then(t=>{this.model.set("output",t.output||null),console.log(this.model.get("script"));let e=null;if(t.isSuccess||(e=t.message||null),this.model.set("errorMessage",e),t.isSuccess)Espo.Ui.success(this.translate("runSuccess","messages","Formula"));else{if(t.isSyntaxError){let e=this.translate("checkSyntaxError","messages","Formula");return t.message&&(e+=" "+t.message),void Espo.Ui.error(e)}let e=this.translate("runError","messages","Formula");t.message&&(e+=" "+t.message),Espo.Ui.error(e)}})}})}),define("views/admin/formula-sandbox/record/edit",["views/record/edit"],function(e){return e.extend({scriptAreaHeight:400,bottomView:null,sideView:null,buttonList:[{name:"run",label:"Run",style:"danger",title:"Ctrl+Enter"}],dropdownItemList:[],isWide:!0,accessControlDisabled:!0,saveAndContinueEditingAction:!1,saveAndNewAction:!1,shortcutKeyCtrlEnterAction:"run",setup:function(){this.scope="Formula";this.detailLayout=[{rows:[[!1,{name:"targetType",labelText:this.translate("targetType","fields","Formula")},{name:"target",labelText:this.translate("target","fields","Formula")}]]},{rows:[[{name:"script",noLabel:!0,options:{targetEntityType:this.model.get("targetType"),height:this.scriptAreaHeight,additionalFunctionDataList:[{name:"output\\print",insertText:"output\\print(VALUE)"},{name:"output\\printLine",insertText:"output\\printLine(VALUE)"}]}}]]},{name:"output",rows:[[{name:"errorMessage",labelText:this.translate("error","fields","Formula")}],[{name:"output",labelText:this.translate("output","fields","Formula")}]]}],e.prototype.setup.call(this),this.model.get("targetType")?this.showField("target"):this.hideField("target"),this.controlTargetTypeField(),this.listenTo(this.model,"change:targetId",()=>this.controlTargetTypeField()),this.controlOutputField(),this.listenTo(this.model,"change",()=>this.controlOutputField())},controlTargetTypeField:function(){this.model.get("targetId")?this.setFieldReadOnly("targetType"):this.setFieldNotReadOnly("targetType")},controlOutputField:function(){this.model.get("errorMessage")?this.showField("errorMessage"):this.hideField("errorMessage")},actionRun:function(){this.model.trigger("run")}})}),define("views/admin/formula/modals/add-function",["views/modal","model"],function(e,t){return e.extend({template:"admin/formula/modals/add-function",fitHeight:!0,backdrop:!0,events:{'click [data-action="add"]':function(e){this.trigger("add",$(e.currentTarget).data("value"))}},data:function(){var e=this.translate("formulaFunctions","messages","Admin").replace("{documentationUrl}",this.documentationUrl),e=this.getHelper().transformMarkdownText(e,{linksInNewTab:!0}).toString();return{functionDataList:this.functionDataList,text:e}},setup:function(){this.header=this.translate("Function"),this.documentationUrl="https://docs.espocrm.com/administration/formula/",this.functionDataList=this.options.functionDataList||this.getMetadata().get("app.formula.functionList")||[]}})}),define("views/admin/formula/modals/add-attribute",["views/modal","model"],function(e,i){return e.extend({templateContent:'<div class="attribute" data-name="attribute">{{{attribute}}}</div>',backdrop:!0,setup:function(){this.header=this.translate("Attribute"),this.scope=this.options.scope;var t=new i;this.createView("attribute","views/admin/formula/fields/attribute",{selector:'[data-name="attribute"]',model:t,mode:"edit",scope:this.scope,defs:{name:"attribute",params:{}},attributeList:this.options.attributeList},e=>{this.listenTo(e,"change",()=>{var e=t.get("attribute")||[];e.length&&this.trigger("add",e[0])})})}})}),define("views/admin/formula/fields/attribute",["views/fields/multi-enum","ui/multi-select"],function(e,t){return e.extend({setupOptions:function(){if(e.prototype.setupOptions.call(this),this.options.attributeList)this.params.options=this.options.attributeList;else{let i=this.getFieldManager().getEntityTypeAttributeList(this.options.scope).concat(["id"]).sort(),a=this.getMetadata().get(["entityDefs",this.options.scope,"links"])||{},s=[];Object.keys(a).forEach(e=>{var t=a[e].type,i=a[e].entity;t&&i&&(a[e].disabled||a[e].utility||~["belongsToParent","hasOne","belongsTo"].indexOf(t)&&s.push(e))}),s.sort(),s.forEach(t=>{let e=this.getFieldManager().getEntityTypeAttributeList(scope).sort();e.forEach(e=>{i.push(t+"."+e)})}),this.params.options=i}},afterRender:function(){e.prototype.afterRender.call(this),this.$element&&t.focus(this.$element)}})}),define("views/admin/field-manager/list",["view"],function(e){return e.extend({template:"admin/field-manager/list",data:function(){return{scope:this.scope,fieldDefsArray:this.fieldDefsArray,typeList:this.typeList,hasAddField:this.hasAddField}},events:{'click [data-action="removeField"]':function(e){e=$(e.currentTarget).data("name");this.removeField(e)},'keyup input[data-name="quick-search"]':function(e){this.processQuickSearch(e.currentTarget.value)}},setup:function(){this.scope=this.options.scope,this.hasAddField=!0;var e=this.getMetadata().get(["scopes",this.scope,"entityManager"])||{};"addField"in e&&(this.hasAddField=e.addField),this.wait(this.buildFieldDefs())},afterRender:function(){this.$noData=this.$el.find(".no-data"),this.$el.find('input[data-name="quick-search"]').focus()},buildFieldDefs:function(){return this.getModelFactory().create(this.scope).then(e=>{this.fields=e.defs.fields,this.fieldList=Object.keys(this.fields).sort(),this.fieldDefsArray=[],this.fieldList.forEach(e=>{var t=this.fields[e];this.fieldDefsArray.push({name:e,isCustom:t.isCustom||!1,type:t.type,label:this.translate(e,"fields",this.scope),isEditable:!t.customizationDisabled})})})},removeField:function(e){this.confirm(this.translate("confirmation","messages"),()=>{Espo.Ui.notify(" ... "),Espo.Ajax.request("Admin/fieldManager/"+this.scope+"/"+e,"delete").then(()=>{Espo.Ui.success(this.translate("Removed")),this.$el.find('tr[data-name="'+e+'"]').remove(),delete this.getMetadata().data.entityDefs[this.scope].fields[e],this.getMetadata().loadSkipCache().then(()=>this.buildFieldDefs().then(()=>(this.broadcastUpdate(),this.reRender())).then(()=>Espo.Ui.success(this.translate("Removed"))))})})},broadcastUpdate:function(){this.getHelper().broadcastChannel.postMessage("update:metadata"),this.getHelper().broadcastChannel.postMessage("update:language")},processQuickSearch:function(e){e=e.trim();let t=this.$noData;if(t.addClass("hidden"),e){let a=[],s=e.toLowerCase();if(this.fieldDefsArray.forEach(t=>{let i=!1;if(!(i=0!==t.label.toLowerCase().indexOf(s)&&0!==t.name.toLowerCase().indexOf(s)?i:!0)){let e=t.label.split(" ").concat(t.label.split(" "));e.forEach(e=>{0===e.toLowerCase().indexOf(s)&&(i=!0)})}i&&a.push(t.name)}),0===a.length)return this.$el.find("table tr.field-row").addClass("hidden"),void t.removeClass("hidden");this.fieldDefsArray.map(e=>e.name).forEach(e=>{let t=this.$el.find(`table tr.field-row[data-name="${e}"]`);~a.indexOf(e)?t.removeClass("hidden"):t.addClass("hidden")})}else this.$el.find("table tr.field-row").removeClass("hidden")}})}),define("views/admin/field-manager/index",["view"],function(e){return e.extend({template:"admin/field-manager/index",scopeList:null,scope:null,type:null,data:function(){return{scopeList:this.scopeList,scope:this.scope}},events:{"click #scopes-menu a.scope-link":function(e){e=$(e.currentTarget).data("scope");this.openScope(e)},"click #fields-content a.field-link":function(e){e.preventDefault();var t=$(e.currentTarget).data("scope"),e=$(e.currentTarget).data("field");this.openField(t,e)},'click [data-action="addField"]':function(){this.createView("dialog","views/admin/field-manager/modals/add-field",{},e=>{e.render(),this.listenToOnce(e,"add-field",e=>{this.createField(this.scope,e)})})}},setup:function(){this.scopeList=[],Object.keys(this.getMetadata().get("scopes")).sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural"))).forEach(e=>{this.getMetadata().get("scopes."+e+".entity")&&this.getMetadata().get("scopes."+e+".customizable")&&this.scopeList.push(e)}),this.scope=this.options.scope||null,this.field=this.options.field||null,this.on("after:render",()=>{this.scope?this.field?this.openField(this.scope,this.field):this.openScope(this.scope):this.renderDefaultPage()}),this.createView("header","views/admin/field-manager/header",{selector:"> .page-header",scope:this.scope,field:this.field})},openScope:function(e){this.scope=e,this.field=null,this.getView("header").setField(null),this.getRouter().navigate("#Admin/fieldManager/scope="+e,{trigger:!1}),Espo.Ui.notify(" ... "),this.createView("content","views/admin/field-manager/list",{fullSelector:"#fields-content",scope:e},e=>{e.render(),Espo.Ui.notify(!1),$(window).scrollTop(0)})},openField:function(e,t){this.scope=e,this.field=t,this.getView("header").setField(t),this.getRouter().navigate("#Admin/fieldManager/scope="+e+"&field="+t,{trigger:!1}),Espo.Ui.notify(" ... "),this.createView("content","views/admin/field-manager/edit",{fullSelector:"#fields-content",scope:e,field:t},e=>{e.render(),Espo.Ui.notify(!1),$(window).scrollTop(0),this.listenTo(e,"after:save",()=>{this.notify("Saved","success")})})},createField:function(e,t){this.scope=e,this.type=t,this.getRouter().navigate("#Admin/fieldManager/scope="+e+"&type="+t+"&create=true",{trigger:!1}),Espo.Ui.notify(" ... "),this.createView("content","Admin.FieldManager.Edit",{fullSelector:"#fields-content",scope:e,type:t},e=>{e.render(),Espo.Ui.notify(!1),$(window).scrollTop(0),e.once("after:save",()=>{this.openScope(this.scope),this.notify("Created","success")})})},renderDefaultPage:function(){$("#fields-content").html(this.translate("selectEntityType","messages","Admin"))},updatePageTitle:function(){this.setPageTitle(this.getLanguage().translate("Field Manager","labels","Admin"))}})}),define("views/admin/field-manager/header",["view"],function(e){return e.extend({template:"admin/field-manager/header",data:function(){return{scope:this.scope,field:this.field}},setup:function(){this.scope=this.options.scope,this.field=this.options.field},setField:function(e){this.field=e,this.isRendered()&&this.reRender()}})}),define("views/admin/field-manager/edit",["view","model"],function(e,t){return e.extend({template:"admin/field-manager/edit",entityTypeWithTranslatedOptionsList:["enum","multiEnum","array","phone"],paramWithTooltipList:["audited","required","default","min","max","maxLength","after","before","readOnly"],globalRestriction:null,hasAnyGlobalRestriction:!1,globalRestrictionTypeList:["forbidden","internal","onlyAdmin","readOnly","nonAdminReadOnly"],data:function(){return{scope:this.scope,field:this.field,defs:this.defs,paramList:this.paramList,type:this.type,fieldList:this.fieldList,isCustom:this.defs.isCustom,isNew:this.isNew,hasDynamicLogicPanel:this.hasDynamicLogicPanel,hasResetToDefault:!this.defs.isCustom&&!this.entityTypeIsCustom&&!this.isNew}},events:{'click button[data-action="close"]':function(){this.actionClose()},'click button[data-action="save"]':function(){this.save()},'click button[data-action="resetToDefault"]':function(){this.resetToDefault()},"keydown.form":function(e){var t=Espo.Utils.getKeyFromKeyEvent(e);"Control+KeyS"!==t&&"Control+Enter"!==t||(this.save(),e.preventDefault(),e.stopPropagation())}},setupFieldData:function(i){var e;this.defs={},this.fieldList=[],this.model=new t,this.model.name="Admin",this.model.urlRoot="Admin/fieldManager/"+this.scope,this.model.defs={fields:{name:{required:!0,maxLength:50},label:{required:!0},tooltipText:{}}},this.entityTypeIsCustom=!!this.getMetadata().get(["scopes",this.scope,"isCustom"]),this.globalRestriction={},this.isNew?(this.model.scope=this.scope,this.model.set("type",this.type)):(this.model.id=this.field,this.model.scope=this.scope,this.model.set("name",this.field),this.model.set("label",this.getLanguage().translate(this.field,"fields",this.scope)),this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"tooltip"])&&this.model.set("tooltipText",this.getLanguage().translate(this.field,"tooltips",this.scope)),this.globalRestriction=this.getMetadata().get(["entityAcl",this.scope,"fields",this.field])||{},(e=this.globalRestrictionTypeList.filter(e=>this.globalRestriction[e])).length&&(this.model.set("globalRestrictions",e),this.hasAnyGlobalRestriction=!0)),this.listenTo(this.model,"change:readOnly",()=>{this.readOnlyControl()});let s=!1;this.getModelFactory().create(this.scope,e=>{this.isNew||(this.type=e.getFieldType(this.field)),this.getMetadata().get(["scopes",this.scope,"hasPersonalData"])&&this.getMetadata().get(["fields",this.type,"personalData"])&&(this.hasPersonalData=!0),this.hasInlineEditDisabled=!["foreign","autoincrement"].includes(this.type)&&!this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"customizationInlineEditDisabledDisabled"]),this.hasTooltipText=!this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"customizationTooltipTextDisabled"]),new Promise(t=>{this.isNew?t():Espo.Ajax.getRequest("Admin/fieldManager/"+this.scope+"/"+this.field).then(e=>{this.defs=e,t()})}).then(()=>{let e=[],t=(this.paramList=[],Espo.Utils.clone(this.getFieldManager().getParamList(this.type)||[]));if(!this.isNew){let e=this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"fieldManagerAdditionalParamList"])||[];e.forEach(e=>{t.push(e)})}let a=this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"fieldManagerParamList"]);t.forEach(e=>{var t,i=e.name;a&&-1===a.indexOf(i)||"readOnly"===i&&this.globalRestriction&&this.globalRestriction.readOnly||("required"===i&&(s=!0),t="customization"+Espo.Utils.upperCaseFirst(i)+"Disabled",this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,t])||(t="customization"+Espo.Utils.upperCaseFirst(i)+"View",(i=this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,t]))&&(e.view=i),this.paramList.push(e)))}),this.hasPersonalData&&this.paramList.push({name:"isPersonalData",type:"bool"}),this.hasInlineEditDisabled&&!this.globalRestriction.readOnly&&this.paramList.push({name:"inlineEditDisabled",type:"bool"}),this.hasTooltipText&&this.paramList.push({name:"tooltipText",type:"text",rowsMin:1,trim:!0}),a&&(this.paramList=this.paramList.filter(e=>-1!==a.indexOf(e.name))),this.paramList=this.paramList.filter(e=>!(this.globalRestriction.readOnly&&"required"===e.name)),(this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"customizationDisabled"])||this.globalRestriction.forbidden)&&(this.paramList=[]),this.hasAnyGlobalRestriction&&this.paramList.push({name:"globalRestrictions",type:"array",readOnly:!0,displayAsList:!0,translation:"FieldManager.options.globalRestrictions",options:this.globalRestrictionTypeList}),this.paramList.forEach(e=>{this.model.defs.fields[e.name]=e}),this.model.set(this.defs),this.isNew&&this.model.populateDefaults(),e.push(this.createFieldView("varchar","name",!this.isNew,{trim:!0})),e.push(this.createFieldView("varchar","label",null,{trim:!0})),this.hasDynamicLogicPanel=!1,e.push(this.setupDynamicLogicFields(s)),this.model.fetchedAttributes=this.model.getClonedAttributes(),this.paramList.forEach(i=>{if(!i.hidden){let t={};if(i.tooltip||~this.paramWithTooltipList.indexOf(i.name)){t.tooltip=!0;let e=i.name;"string"==typeof i.tooltip&&(e=i.tooltip),t.tooltipText=this.translate(e,"tooltips","FieldManager")}i.readOnlyNotNew&&!this.isNew&&(t.readOnly=!0),e.push(this.createFieldView(i.type,i.name,null,i,t))}}),Promise.all(e).then(()=>i())})}),this.listenTo(this.model,"change",(e,t)=>{t.ui&&this.setIsChanged()})},setup:function(){this.scope=this.options.scope,this.field=this.options.field,this.type=this.options.type,this.isNew=!this.field,this.wait(!0),this.setupFieldData(()=>{this.wait(!1)})},setupDynamicLogicFields:function(e){var t=this.getMetadata().get(["entityDefs",this.scope,"fields",this.field])||{};if(t.disabled||t.dynamicLogicDisabled||t.layoutDetailDisabled||t.utility)return Promise.resolve();let i=[];t.dynamicLogicVisibleDisabled||(a=this.getMetadata().get(["clientDefs",this.scope,"dynamicLogic","fields",this.field,"visible"]),this.model.set("dynamicLogicVisible",a),i.push(this.createFieldView(null,"dynamicLogicVisible",null,{view:"views/admin/field-manager/fields/dynamic-logic-conditions",scope:this.scope})),this.hasDynamicLogicPanel=!0);var a=this.getMetadata().get(["fields",this.type,"readOnly"]),e=(t.dynamicLogicRequiredDisabled||a||!e||(e=this.getMetadata().get(["clientDefs",this.scope,"dynamicLogic","fields",this.field,"required"]),this.model.set("dynamicLogicRequired",e),i.push(this.createFieldView(null,"dynamicLogicRequired",null,{view:"views/admin/field-manager/fields/dynamic-logic-conditions",scope:this.scope})),this.hasDynamicLogicPanel=!0),t.dynamicLogicReadOnlyDisabled||a||(e=this.getMetadata().get(["clientDefs",this.scope,"dynamicLogic","fields",this.field,"readOnly"]),this.model.set("dynamicLogicReadOnly",e),i.push(this.createFieldView(null,"dynamicLogicReadOnly",null,{view:"views/admin/field-manager/fields/dynamic-logic-conditions",scope:this.scope})),this.hasDynamicLogicPanel=!0),this.getMetadata().get(["fields",this.type,"dynamicLogicOptions"]));return e&&!t.dynamicLogicOptionsDisabled&&(e=this.getMetadata().get(["clientDefs",this.scope,"dynamicLogic","options",this.field]),this.model.set("dynamicLogicOptions",e),i.push(this.createFieldView(null,"dynamicLogicOptions",null,{view:"views/admin/field-manager/fields/dynamic-logic-options",scope:this.scope})),this.hasDynamicLogicPanel=!0),t.dynamicLogicInvalidDisabled||a||(e=this.getMetadata().get(["clientDefs",this.scope,"dynamicLogic","fields",this.field,"invalid"]),this.model.set("dynamicLogicInvalid",e),i.push(this.createFieldView(null,"dynamicLogicInvalid",null,{view:"views/admin/field-manager/fields/dynamic-logic-conditions",scope:this.scope})),this.hasDynamicLogicPanel=!0),Promise.all(i)},afterRender:function(){this.getView("name").on("change",()=>{let e=this.model.get("name"),t=e;t.length&&(t=t.charAt(0).toUpperCase()+t.slice(1)),this.model.set("label",t),e&&(e=e.replace(/-/g,"").replace(/_/g,"").replace(/[^\w\s]/gi,"").replace(/ (.)/g,(e,t)=>t.toUpperCase()).replace(" ","")).length&&(e=e.charAt(0).toLowerCase()+e.slice(1)),this.model.set("name",e)})},readOnlyControl:function(){this.model.get("readOnly")?(this.hideField("dynamicLogicReadOnly"),this.hideField("dynamicLogicRequired"),this.hideField("dynamicLogicOptions"),this.hideField("dynamicLogicInvalid")):(this.showField("dynamicLogicReadOnly"),this.showField("dynamicLogicRequired"),this.showField("dynamicLogicOptions"),this.showField("dynamicLogicInvalid"))},hideField:function(t){var e=()=>{let e=this.getView(t);e&&(this.$el.find('.cell[data-name="'+t+'"]').addClass("hidden"),e.setDisabled())};this.isRendered()?e():this.once("after:render",e)},showField:function(t){var e=()=>{let e=this.getView(t);e&&(this.$el.find('.cell[data-name="'+t+'"]').removeClass("hidden"),e.setNotDisabled())};this.isRendered()?e():this.once("after:render",e)},createFieldView:function(e,t,i,a,s,n){e=(a||{}).view||this.getFieldManager().getViewName(e),a={model:this.model,selector:'.field[data-name="'+t+'"]',defs:{name:t,params:a},mode:i?"detail":"edit",readOnly:i,scope:this.scope,field:this.field},_.extend(a,s||{}),i=this.createView(t,e,a,n);return this.fieldList.push(t),i},disableButtons:function(){this.$el.find('[data-action="save"]').attr("disabled","disabled").addClass("disabled"),this.$el.find('[data-action="resetToDefault"]').attr("disabled","disabled").addClass("disabled")},enableButtons:function(){this.$el.find('[data-action="save"]').removeAttr("disabled").removeClass("disabled"),this.$el.find('[data-action="resetToDefault"]').removeAttr("disabled").removeClass("disabled")},save:function(){this.disableButtons(),this.fieldList.forEach(e=>{let t=this.getView(e);t.readOnly||t.fetchToModel()});let t=!1;if(this.fieldList.forEach(e=>{t=this.getView(e).validate()||t}),t)return this.notify("Not valid","error"),void this.enableButtons();if(this.model.get("tooltipText")&&""!==this.model.get("tooltipText")?this.model.set("tooltip",!0):this.model.set("tooltip",!1),this.listenToOnce(this.model,"sync",()=>{Espo.Ui.notify(!1),this.setIsNotChanged(),this.enableButtons(),this.updateLanguage(),Promise.all([this.getMetadata().loadSkipCache(),this.getLanguage().loadSkipCache()]).then(()=>this.trigger("after:save")),this.model.fetchedAttributes=this.model.getClonedAttributes(),this.broadcastUpdate()}),Espo.Ui.notify(this.translate("saving","messages")),this.isNew)this.model.save().catch(()=>this.enableButtons());else{let e=this.model.getClonedAttributes();this.model.fetchedAttributes.label===e.label&&delete e.label,this.model.fetchedAttributes.tooltipText!==e.tooltipText&&(this.model.fetchedAttributes.tooltipText||e.tooltipText)||delete e.tooltipText,"translatedOptions"in e&&_.isEqual(this.model.fetchedAttributes.translatedOptions,e.translatedOptions)&&delete e.translatedOptions,this.model.save(e,{patch:!0}).catch(()=>this.enableButtons())}},updateLanguage:function(){let e=this.getLanguage().data;this.scope in e&&("fields"in e[this.scope]||(e[this.scope].fields={}),e[this.scope].fields[this.model.get("name")]=this.model.get("label"),"tooltips"in e[this.scope]||(e[this.scope].tooltips={}),e[this.scope].tooltips[this.model.get("name")]=this.model.get("tooltipText"),this.getMetadata().get(["fields",this.model.get("type"),"translatedOptions"])&&this.model.get("translatedOptions")&&(e[this.scope].options=e[this.scope].options||{},e[this.scope].options[this.model.get("name")]=this.model.get("translatedOptions")||{}))},resetToDefault:function(){this.confirm(this.translate("confirmation","messages"),()=>{Espo.Ui.notify(this.translate("pleaseWait","messages")),Espo.Ajax.postRequest("FieldManager/action/resetToDefault",{scope:this.scope,name:this.field}).then(()=>{Promise.all([this.getMetadata().loadSkipCache(),this.getLanguage().loadSkipCache()]).then(()=>{this.setIsNotChanged(),this.setupFieldData(()=>{this.notify("Done","success"),this.reRender(),this.broadcastUpdate()})})})})},broadcastUpdate:function(){this.getHelper().broadcastChannel.postMessage("update:metadata"),this.getHelper().broadcastChannel.postMessage("update:language"),this.getHelper().broadcastChannel.postMessage("update:settings")},actionClose:function(){this.setIsNotChanged(),this.getRouter().navigate("#Admin/fieldManager/scope="+this.scope,{trigger:!0})},setConfirmLeaveOut:function(e){this.getRouter().confirmLeaveOut=e},setIsChanged:function(){this.isChanged=!0,this.setConfirmLeaveOut(!0)},setIsNotChanged:function(){this.isChanged=!1,this.setConfirmLeaveOut(!1)}})}),define("views/admin/field-manager/modals/add-field",["views/modal"],function(e){return e.extend({backdrop:!0,template:"admin/field-manager/modals/add-field",events:{'click a[data-action="addField"]':function(e){e=$(e.currentTarget).data("type");this.addField(e)},'keyup input[data-name="quick-search"]':function(e){this.processQuickSearch(e.currentTarget.value)}},data:function(){return{typeList:this.typeList}},setup:function(){this.headerText=this.translate("Add Field","labels","Admin"),this.typeList=[];let t=this.getMetadata().get("fields");Object.keys(this.getMetadata().get("fields")).forEach(e=>{e in t&&(t[e].notCreatable||this.typeList.push(e))}),this.typeDataList=this.typeList.map(e=>({type:e,label:this.translate(e,"fieldTypes","Admin")})),this.typeList.sort((e,t)=>this.translate(e,"fieldTypes","Admin").localeCompare(this.translate(t,"fieldTypes","Admin")))},addField:function(e){this.trigger("add-field",e),this.remove()},afterRender:function(){this.$noData=this.$el.find(".no-data"),this.typeList.forEach(e=>{var t=this.translate(e,"fieldInfo","FieldManager");let i=this.$el.find('a.info[data-name="'+e+'"]');t!==e?(t=this.getHelper().transformMarkdownText(t,{linksInNewTab:!0}).toString(),Espo.Ui.popover(i,{content:t,placement:"left"},this)):i.addClass("hidden")}),setTimeout(()=>this.$el.find('input[data-name="quick-search"]').focus(),50)},processQuickSearch:function(e){e=e.trim();let a=this.$noData;if(a.addClass("hidden"),e){let i=[],t=e.toLowerCase();if(this.typeDataList.forEach(e=>{0!==e.label.toLowerCase().indexOf(t)&&0!==e.type.toLowerCase().indexOf(t)||i.push(e.type)}),0===i.length)return this.$el.find("ul .list-group-item").addClass("hidden"),void a.removeClass("hidden");this.typeDataList.forEach(e=>{let t=this.$el.find(`ul .list-group-item[data-name="${e.type}"]`);~i.indexOf(e.type)?t.removeClass("hidden"):t.addClass("hidden")})}else this.$el.find("ul .list-group-item").removeClass("hidden")}})}),define("views/admin/field-manager/fields/source-list",["views/fields/multi-enum"],function(e){return e.extend({setupOptions:function(){this.params.options=Espo.Utils.clone(this.getMetadata().get("entityDefs.Attachment.sourceList")||[]),this.translatedOptions={},this.params.options.forEach(e=>{this.translatedOptions[e]=this.translate(e,"scopeNamesPlural")})}})}),define("views/admin/field-manager/fields/pattern",["views/fields/varchar"],function(e){return e.extend({noSpellCheck:!0,setupOptions:function(){let t=this.getMetadata().get(["app","regExpPatterns"])||{};var e=Object.keys(t).filter(e=>!t[e].isSystem).map(e=>"$"+e);this.setOptionList(e)}})}),define("views/admin/field-manager/fields/options-with-style",["views/admin/field-manager/fields/options"],function(r){return r.extend({setup:function(){r.prototype.setup.call(this),this.optionsStyleMap=this.model.get("style")||{},this.styleList=["default","success","danger","warning","info","primary"],this.events['click [data-action="selectOptionItemStyle"]']=e=>{let t=$(e.currentTarget);var e=t.data("style"),i=t.data("value").toString();this.changeStyle(i,e)}},changeStyle:function(e,t){var i=e.replace(/"/g,'\\"');this.$el.find('[data-action="selectOptionItemStyle"][data-value="'+i+'"] .check-icon').addClass("hidden"),this.$el.find('[data-action="selectOptionItemStyle"][data-value="'+i+'"][data-style="'+t+'"] .check-icon').removeClass("hidden");let a=this.$el.find('.list-group-item[data-value="'+i+'"]').find(".item-text");this.styleList.forEach(e=>{a.removeClass("text-"+e)}),a.addClass("text-"+t),this.optionsStyleMap[e]=t="default"===t?null:t},getItemHtml:function(a){var e=r.prototype.getItemHtml.call(this,a);let t=this.styleList,s=this.optionsStyleMap,n="default",o=[];t.forEach(e=>{let t=!0;s[a]===e?(n=e,t=!1):"default"!==e||s[a]||(t=!1);var i=this.getLanguage().translateOption(e,"style","LayoutManager"),e=$("<li>").append($("<a>").attr("role","button").attr("tabindex","0").attr("data-action","selectOptionItemStyle").attr("data-style",e).attr("data-value",a).append($("<span>").addClass("check-icon fas fa-check pull-right").addClass(t?"hidden":""),$("<div>").addClass("text-"+e).text(i)));o.push(e)});var i=$("<div>").addClass("btn-group pull-right").append($("<button>").addClass("btn btn-link btn-sm dropdown-toggle").attr("type","button").attr("data-toggle","dropdown").append($("<span>").addClass("caret")),$("<ul>").addClass("dropdown-menu pull-right").append(o));let l=$(e);return l.find(".item-content > input").after(i),l.find(".item-text").addClass("text-"+n),l.addClass("link-group-item-with-columns"),l.get(0).outerHTML},fetch:function(){let t=r.prototype.fetch.call(this);return t.style={},(t.options||[]).forEach(e=>{t.style[e]=this.optionsStyleMap[e]||null}),t}})}),define("views/admin/field-manager/fields/options-reference",["views/fields/enum"],function(e){return e.extend({enumFieldTypeList:["enum","multiEnum","array","checklist","varchar"],setupOptions:function(){this.params.options=[""];let e=Object.keys(this.getMetadata().get(["entityDefs"])).filter(e=>this.getMetadata().get(["scopes",e,"object"])).sort((e,t)=>this.getLanguage().translate(e,"scopesName").localeCompare(this.getLanguage().translate(t,"scopesName")));this.translatedOptions={},e.forEach(n=>{let e=Object.keys(this.getMetadata().get(["entityDefs",n,"fields"])||[]).filter(e=>n!==this.model.scope||e!==this.model.get("name")).sort((e,t)=>this.getLanguage().translate(e,"fields",n).localeCompare(this.getLanguage().translate(t,"fields",n)));e.forEach(e=>{var{type:t,options:i,optionsPath:a,optionsReference:s}=this.getMetadata().get(["entityDefs",n,"fields",e])||{};this.enumFieldTypeList.includes(t)&&(a||s||i&&(this.params.options.push(t=n+"."+e),this.translatedOptions[t]=this.translate(n,"scopeName")+" · "+this.translate(e,"fields",n)))})})}})}),define("views/admin/field-manager/fields/not-actual-options",["views/fields/multi-enum"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.params.options=Espo.Utils.clone(this.model.get("options"))||[],this.listenTo(this.model,"change:options",(e,t,i)=>{this.params.options=Espo.Utils.clone(e.get("options"))||[],this.reRender()})}})}),define("views/admin/field-manager/fields/entity-list",["views/fields/entity-type-list"],function(e){return e.extend({})}),define("views/admin/field-manager/fields/dynamic-logic-options",["views/fields/base","model"],function(e,a){return e.extend({editTemplate:"admin/field-manager/fields/dynamic-logic-options/edit",events:{'click [data-action="editConditions"]':function(e){e=parseInt($(e.currentTarget).data("index"));this.edit(e)},'click [data-action="addOptionList"]':function(e){this.addOptionList()},'click [data-action="removeOptionList"]':function(e){e=parseInt($(e.currentTarget).data("index"));this.removeItem(e)}},data:function(){return{itemDataList:this.itemDataList}},setup:function(){this.optionsDefsList=Espo.Utils.cloneDeep(this.model.get(this.name))||[],this.scope=this.options.scope,this.setupItems(),this.setupItemViews()},setupItems:function(){this.itemDataList=[],this.optionsDefsList.forEach((e,t)=>{this.itemDataList.push({conditionGroupViewKey:"conditionGroup"+t.toString(),optionsViewKey:"options"+t.toString(),index:t})})},setupItemViews:function(){this.optionsDefsList.forEach((e,t)=>{this.createStringView(t),this.createOptionsView(t)})},createOptionsView:function(t){var i,e="options"+t.toString();this.optionsDefsList[t]&&((i=new a).set("options",this.optionsDefsList[t].optionList||[]),this.createView(e,"views/fields/multi-enum",{selector:'.options-container[data-key="'+e+'"]',model:i,name:"options",mode:"edit",params:{options:this.model.get("options"),translatedOptions:this.model.get("translatedOptions")}},e=>{this.isRendered()&&e.render(),this.listenTo(this.model,"change:options",()=>{e.setTranslatedOptions(this.getTranslatedOptions()),e.setOptionList(this.model.get("options"))}),this.listenTo(i,"change",()=>{this.optionsDefsList[t].optionList=i.get("options")||[]})}))},getTranslatedOptions:function(){if(this.model.get("translatedOptions"))return this.model.get("translatedOptions");var t={};return(this.model.get("options")||[]).forEach(e=>{t[e]=this.getLanguage().translateOption(e,this.options.field,this.options.scope)}),t},createStringView:function(e){var t="conditionGroup"+e.toString();this.optionsDefsList[e]&&this.createView(t,"views/admin/dynamic-logic/conditions-string/group-base",{selector:'.string-container[data-key="'+t+'"]',itemData:{value:this.optionsDefsList[e].conditionGroup},operator:"and",scope:this.scope},e=>{this.isRendered()&&e.render()})},edit:function(t){this.createView("modal","views/admin/dynamic-logic/modals/edit",{conditionGroup:this.optionsDefsList[t].conditionGroup,scope:this.options.scope},e=>{e.render(),this.listenTo(e,"apply",e=>{this.optionsDefsList[t].conditionGroup=e,this.trigger("change"),this.createStringView(t)})})},addOptionList:function(){this.itemDataList.length;this.optionsDefsList.push({optionList:this.model.get("options")||[],conditionGroup:null}),this.setupItems(),this.reRender(),this.setupItemViews(),this.trigger("change")},removeItem:function(e){this.optionsDefsList.splice(e,1),this.setupItems(),this.reRender(),this.setupItemViews(),this.trigger("change")},fetch:function(){var e={};return e[this.name]=this.optionsDefsList,this.optionsDefsList.length||(e[this.name]=null),e}})}),define("views/admin/field-manager/fields/dynamic-logic-conditions",["views/fields/base"],function(e){return e.extend({detailTemplate:"admin/field-manager/fields/dynamic-logic-conditions/detail",editTemplate:"admin/field-manager/fields/dynamic-logic-conditions/edit",events:{'click [data-action="editConditions"]':function(){this.edit()}},data:function(){},setup:function(){this.conditionGroup=Espo.Utils.cloneDeep((this.model.get(this.name)||{}).conditionGroup||[]),this.scope=this.params.scope||this.options.scope,this.createStringView()},createStringView:function(){this.createView("conditionGroup","views/admin/dynamic-logic/conditions-string/group-base",{selector:".top-group-string-container",itemData:{value:this.conditionGroup},operator:"and",scope:this.scope},e=>{this.isRendered()&&e.render()})},edit:function(){this.createView("modal","views/admin/dynamic-logic/modals/edit",{conditionGroup:this.conditionGroup,scope:this.scope},e=>{e.render(),this.listenTo(e,"apply",e=>{this.conditionGroup=e,this.trigger("change"),this.createStringView()})})},fetch:function(){var e={};return e[this.name]={conditionGroup:this.conditionGroup},0===this.conditionGroup.length&&(e[this.name]=null),e}})}),define("views/admin/field-manager/fields/currency-default",["views/fields/enum"],function(e){return e.extend({fetchEmptyValueAsNull:!0,setupOptions:function(){this.params.options=[""],(this.getConfig().get("currencyList")||[]).forEach(e=>{this.params.options.push(e)})}})}),define("views/admin/field-manager/fields/phone/default",["views/fields/enum"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.setOptionList(this.model.get("typeList")||[""]),this.listenTo(this.model,"change:typeList",()=>{this.setOptionList(this.model.get("typeList")||[""])})}})}),define("views/admin/field-manager/fields/options/default",["views/fields/enum"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.validations.push("listed"),this.setOptionList(this.model.get("options")||[""]),this.listenTo(this.model,"change:options",()=>{this.setOptionList(this.model.get("options")||[""])})},validateListed:function(){var e=this.model.get(this.name)??"";if(!this.params.options)return!1;let t=this.model.get("options")||[""];return-1===t.indexOf(e)&&(e=this.translate("fieldInvalid","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0)}})}),define("views/admin/field-manager/fields/link-multiple/default",["views/fields/link-multiple"],function(a){return a.extend({data:function(){var e=this.model.get("defaultAttributes")||{},t=e[this.options.field+"Names"]||{},e=e[this.options.field+"Ids"]||[],i=a.prototype.data.call(this);return i.nameHash=t,i.idValues=e,i},setup:function(){a.prototype.setup.call(this),this.foreignScope=this.getMetadata().get(["entityDefs",this.options.scope,"links",this.options.field,"entity"])},fetch:function(){var e=a.prototype.fetch.call(this),t={};return t[this.options.field+"Ids"]=e[this.idsName],t[this.options.field+"Names"]=e[this.nameHashName],{defaultAttributes:t=null!==e[this.idsName]&&0!==e[this.idsName].length?t:null}},copyValuesFromModel:function(){var e=this.model.get("defaultAttributes")||{},t=e[this.options.field+"Ids"]||[],e=e[this.options.field+"Names"]||{};this.ids=t,this.nameHash=e}})}),define("views/admin/field-manager/fields/link/default",["views/fields/link"],function(a){return a.extend({data:function(){var e=this.model.get("defaultAttributes")||{},t=e[this.options.field+"Name"]||null,e=e[this.options.field+"Id"]||null,i=a.prototype.data.call(this);return i.nameValue=t,i.idValue=e,i},setup:function(){a.prototype.setup.call(this),this.foreignScope=this.getMetadata().get(["entityDefs",this.options.scope,"links",this.options.field,"entity"])},fetch:function(){var e=a.prototype.fetch.call(this),t={};return t[this.options.field+"Id"]=e[this.idName],t[this.options.field+"Name"]=e[this.nameName],{defaultAttributes:t=null===e[this.idName]?null:t}}})}),define("views/admin/field-manager/fields/foreign/link",["views/fields/enum"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.model.isNew()||this.setReadOnly(!0)},setupOptions:function(){var t=this.getMetadata().get(["entityDefs",this.options.scope,"links"])||{},i=(this.params.options=Object.keys(Espo.Utils.clone(t)).filter(e=>{if(!("belongsTo"!==t[e].type&&"hasOne"!==t[e].type||t[e].noJoin||t[e].disabled))return!0}),this.options.scope);this.translatedOptions={},this.params.options.forEach(e=>{this.translatedOptions[e]=this.translate(e,"links",i)}),this.params.options=this.params.options.sort((e,t)=>this.translate(e,"links",i).localeCompare(this.translate(t,"links",i))),this.params.options.unshift("")}})}),define("views/admin/field-manager/fields/foreign/field",["views/fields/enum"],function(t){return t.extend({setup:function(){t.prototype.setup.call(this),this.model.isNew()||this.setReadOnly(!0),this.listenTo(this.model,"change:field",()=>{this.manageField()}),this.viewValue=this.model.get("view")},setupOptions:function(){this.listenTo(this.model,"change:link",()=>{this.setupOptionsByLink(),this.reRender()}),this.setupOptionsByLink()},setupOptionsByLink:function(){this.typeList=this.getMetadata().get(["fields","foreign","fieldTypeList"]);var i,a,e=this.model.get("link");e&&(i=this.getMetadata().get(["entityDefs",this.options.scope,"links",e,"entity"]))?(a=this.getMetadata().get(["entityDefs",i,"fields"])||{},this.params.options=Object.keys(Espo.Utils.clone(a)).filter(e=>{var t=a[e].type;if(~this.typeList.indexOf(t)&&!(a[e].disabled||a[e].utility||a[e].directAccessDisabled||a[e].notStorable))return!0}),this.translatedOptions={},this.params.options.forEach(e=>{this.translatedOptions[e]=this.translate(e,"fields",i)}),this.params.options=this.params.options.sort((e,t)=>this.translate(e,"fields",i).localeCompare(this.translate(t,"fields",i))),this.params.options.unshift("")):this.params.options=[""]},manageField:function(){var e,t;this.model.isNew()&&(t=this.model.get("link"),e=this.model.get("field"),t&&e&&((t=this.getMetadata().get(["entityDefs",this.options.scope,"links",t,"entity"]))&&(t=this.getMetadata().get(["entityDefs",t,"fields",e,"type"]),this.viewValue=this.getMetadata().get(["fields","foreign","fieldTypeViewMap",t]))))},fetch:function(){var e=t.prototype.fetch.call(this);return this.model.isNew()&&this.viewValue&&(e.view=this.viewValue),e}})}),define("views/admin/field-manager/fields/date/default",["views/fields/enum"],function(t){return t.extend({fetch:function(){var e=t.prototype.fetch.call(this);return""===e[this.name]&&(e[this.name]=null),e},setupOptions:function(){t.prototype.setupOptions.call(this);var e=this.model.get(this.name);this.params.options&&e&&!~this.params.options.indexOf(e)&&this.params.options.push(e)}})}),define("views/admin/field-manager/fields/date/after-before",["views/fields/varchar"],function(t){return t.extend({setupOptions:function(){var e;t.prototype.setupOptions.call(this),this.model.scope&&(e=this.getFieldManager().getEntityTypeFieldList(this.model.scope,{typeList:["date","datetime","datetimeOptional"]}),this.model.get("name")&&(e=e.filter(function(e){return e!==this.model.get("name")},this)),this.params.options=e)}})}),define("views/admin/extensions/ready",["views/modal"],function(e){return e.extend({cssName:"ready-modal",header:!1,template:"admin/extensions/ready",createButton:!0,data:function(){return{version:this.upgradeData.version,text:this.translate("installExtension","messages","Admin").replace("{version}",this.upgradeData.version).replace("{name}",this.upgradeData.name)}},setup:function(){this.buttonList=[{name:"run",text:this.translate("Install","labels","Admin"),style:"danger"},{name:"cancel",label:"Cancel"}],this.upgradeData=this.options.upgradeData,this.header=this.getLanguage().translate("Ready for installation","labels","Admin")},actionRun:function(){this.trigger("run"),this.remove()}})}),define("views/admin/extensions/index",["exports","view","helpers/list/select-provider"],function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),i=a(i);t=t.default.extend({template:"admin/extensions/index",packageContents:null,events:{'change input[name="package"]':function(e){this.$el.find('button[data-action="upload"]').addClass("disabled").attr("disabled","disabled"),this.$el.find(".message-container").html("");e=e.currentTarget.files;e.length&&this.selectFile(e[0])},'click button[data-action="upload"]':function(){this.upload()},'click [data-action="install"]':function(e){var e=$(e.currentTarget).data("id"),t=this.collection.get(e).get("name"),i=this.collection.get(e).get("version");this.run(e,t,i)},'click [data-action="uninstall"]':function(e){let t=$(e.currentTarget).data("id");this.confirm(this.translate("uninstallConfirmation","messages","Admin"),()=>{Espo.Ui.notify(this.translate("Uninstalling...","labels","Admin")),Espo.Ajax.postRequest("Extension/action/uninstall",{id:t},{timeout:0,bypassAppReload:!0}).then(()=>{window.location.reload()}).catch(e=>{e=e.getResponseHeader("X-Status-Reason");this.showErrorNotification(this.translate("Error")+": "+e)})})}},setup:function(){const e=new i.default(this.getHelper().layoutManager,this.getHelper().metadata,this.getHelper().fieldManager);this.wait(this.getCollectionFactory().create("Extension").then(e=>{this.collection=e,this.collection.maxSize=this.getConfig().get("recordsPerPage")}).then(()=>e.get("Extension")).then(e=>{this.collection.data.select=e.join(",")}).then(()=>this.collection.fetch()).then(()=>{this.createView("list","views/extension/record/list",{collection:this.collection,selector:"> .list-container"}),0===this.collection.length&&this.once("after:render",()=>{this.$el.find(".list-container").addClass("hidden")})}))},selectFile:function(e){var t=new FileReader;t.onload=e=>{this.packageContents=e.target.result,this.$el.find('button[data-action="upload"]').removeClass("disabled").removeAttr("disabled")},t.readAsDataURL(e)},showError:function(e){e=this.translate(e,"errors","Admin"),this.$el.find(".message-container").html(e)},showErrorNotification:function(e){e?(e=this.translate(e,"errors","Admin"),this.$el.find(".notify-text").html(e),this.$el.find(".notify-text").removeClass("hidden")):this.$el.find(".notify-text").addClass("hidden")},upload:function(){this.$el.find('button[data-action="upload"]').addClass("disabled").attr("disabled","disabled"),this.notify("Uploading..."),Espo.Ajax.postRequest("Extension/action/upload",this.packageContents,{timeout:0,contentType:"application/zip"}).then(t=>{t.id?(Espo.Ui.notify(!1),this.createView("popup","views/admin/extensions/ready",{upgradeData:t},e=>{e.render(),this.$el.find('button[data-action="upload"]').removeClass("disabled").removeAttr("disabled"),e.once("run",()=>{e.close(),this.$el.find(".panel.upload").addClass("hidden"),this.run(t.id,t.version,t.name)})})):this.showError(this.translate("Error occurred"))}).catch(e=>{this.showError(e.getResponseHeader("X-Status-Reason")),Espo.Ui.notify(!1)})},run:function(e,t,i){Espo.Ui.notify(this.translate("pleaseWait","messages")),this.showError(!1),this.showErrorNotification(!1),Espo.Ajax.postRequest("Extension/action/install",{id:e},{timeout:0,bypassAppReload:!0}).then(()=>{let e=this.getCache();e&&e.clear(),this.createView("popup","views/admin/extensions/done",{version:t,name:i},e=>{this.collection.length&&this.collection.fetch({bypassAppReload:!0}),this.$el.find(".list-container").removeClass("hidden"),this.$el.find(".panel.upload").removeClass("hidden"),Espo.Ui.notify(!1),e.render()})}).catch(e=>{this.$el.find(".panel.upload").removeClass("hidden");e=e.getResponseHeader("X-Status-Reason");this.showErrorNotification(this.translate("Error")+": "+e)})}});e.default=t}),define("views/admin/extensions/done",["views/modal"],function(e){return e.extend({cssName:"done-modal",header:!1,template:"admin/extensions/done",createButton:!0,data:function(){return{version:this.options.version,name:this.options.name,text:this.translate("extensionInstalled","messages","Admin").replace("{version}",this.options.version).replace("{name}",this.options.name)}},setup:function(){this.on("remove",()=>{window.location.reload()}),this.buttonList=[{name:"close",label:"Close"}],this.header=this.getLanguage().translate("Installed successfully","labels","Admin")}})}),define("views/admin/entity-manager/scope",["view"],function(e){return e.extend({template:"admin/entity-manager/scope",scope:null,data:function(){return{scope:this.scope,isEditable:this.isEditable,isRemovable:this.isRemovable,isCustomizable:this.isCustomizable,type:this.type,hasLayouts:this.hasLayouts,label:this.label,hasFormula:this.hasFormula,hasFields:this.hasFields,hasRelationships:this.hasRelationships}},events:{'click [data-action="editEntity"]':function(){this.getRouter().navigate("#Admin/entityManager/edit&scope="+this.scope,{trigger:!0})},'click [data-action="removeEntity"]':function(){this.removeEntity()},'click [data-action="editFormula"]':function(){this.editFormula()}},setup:function(){this.scope=this.options.scope,this.setupScopeData()},setupScopeData:function(){var e=this.getMetadata().get(["scopes",this.scope]),t=this.getMetadata().get(["scopes",this.scope,"entityManager"])||{};if(!e)throw new Espo.Exceptions.NotFound;this.isRemovable=!!e.isCustom,e.isNotRemovable&&(this.isRemovable=!1),this.isCustomizable=!!e.customizable,this.type=e.type,this.isEditable=!0,this.hasLayouts=e.layouts,this.hasFormula=this.isCustomizable,this.hasFields=this.isCustomizable,this.hasRelationships=this.isCustomizable,"edit"in t&&(this.isEditable=t.edit),"layouts"in t&&(this.hasLayouts=t.layouts),"formula"in t&&(this.hasFormula=t.formula),"fields"in t&&(this.hasFields=t.fields),"relationships"in t&&(this.hasRelationships=t.relationships),this.label=this.getLanguage().translate(this.scope,"scopeNames")},editFormula:function(){Espo.Ui.notify(" ... "),Espo.loader.requirePromise("views/admin/entity-manager/modals/select-formula").then(e=>{let t=new e({scope:this.scope});this.assignView("dialog",t).then(()=>{Espo.Ui.notify(!1),t.render()})})},removeEntity:function(){var e=this.scope;this.confirm(this.translate("confirmRemove","messages","EntityManager"),()=>{Espo.Ui.notify(this.translate("pleaseWait","messages")),this.disableButtons(),Espo.Ajax.postRequest("EntityManager/action/removeEntity",{name:e}).then(()=>{this.getMetadata().loadSkipCache().then(()=>{this.getConfig().load().then(()=>{Espo.Ui.notify(!1),this.broadcastUpdate(),this.getRouter().navigate("#Admin/entityManager",{trigger:!0})})})}).catch(()=>this.enableButtons())})},updatePageTitle:function(){this.setPageTitle(this.getLanguage().translate("Entity Manager","labels","Admin"))},disableButtons:function(){this.$el.find(".btn.action").addClass("disabled").attr("disabled","disabled"),this.$el.find(".item-dropdown-button").addClass("disabled").attr("disabled","disabled")},enableButtons:function(){this.$el.find(".btn.action").removeClass("disabled").removeAttr("disabled"),this.$el.find('.item-dropdown-button"]').removeClass("disabled").removeAttr("disabled")},broadcastUpdate:function(){this.getHelper().broadcastChannel.postMessage("update:metadata"),this.getHelper().broadcastChannel.postMessage("update:settings")}})}),define("views/admin/entity-manager/index",["exports","view","views/admin/entity-manager/modals/export"],function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),i=a(i);class s extends t.default{template="admin/entity-manager/index";scopeDataList=null;scope=null;data(){return{scopeDataList:this.scopeDataList}}events={'click button[data-action="createEntity"]':function(){this.getRouter().navigate("#Admin/entityManager/create&",{trigger:!0})},'keyup input[data-name="quick-search"]':function(e){this.processQuickSearch(e.currentTarget.value)}};setupScopeData(){this.scopeDataList=[];let e=Object.keys(this.getMetadata().get("scopes")).sort((e,t)=>e.localeCompare(t)),i=[];e.forEach(e=>{var t=this.getMetadata().get("scopes."+e);t.entity&&t.customizable&&i.push(e)}),e.forEach(e=>{var t=this.getMetadata().get("scopes."+e);t.entity&&!t.customizable&&i.push(e)}),(e=i).forEach(e=>{var t=this.getMetadata().get("scopes."+e);let i=!!t.isCustom;t.isNotRemovable&&(i=!1);var a=t.customizable;this.scopeDataList.push({name:e,isCustom:t.isCustom,isRemovable:i,hasView:a,type:t.type,label:this.getLanguage().translate(e,"scopeNames"),layouts:t.layouts})})}setup(){this.setupScopeData(),this.addActionHandler("export",()=>this.actionExport())}afterRender(){this.$noData=this.$el.find(".no-data"),this.$el.find('input[data-name="quick-search"]').focus()}updatePageTitle(){this.setPageTitle(this.getLanguage().translate("Entity Manager","labels","Admin"))}processQuickSearch(e){e=e.trim();let t=this.$noData;if(t.addClass("hidden"),e){let a=[],s=e.toLowerCase();if(this.scopeDataList.forEach(t=>{let i=!1;if(!(i=0!==t.label.toLowerCase().indexOf(s)&&0!==t.name.toLowerCase().indexOf(s)?i:!0)){let e=t.label.split(" ").concat(t.label.split(" "));e.forEach(e=>{0===e.toLowerCase().indexOf(s)&&(i=!0)})}i&&a.push(t.name)}),0===a.length)return this.$el.find("table tr.scope-row").addClass("hidden"),void t.removeClass("hidden");this.scopeDataList.map(e=>e.name).forEach(e=>{~a.indexOf(e)?this.$el.find('table tr.scope-row[data-scope="'+e+'"]').removeClass("hidden"):this.$el.find('table tr.scope-row[data-scope="'+e+'"]').addClass("hidden")})}else this.$el.find("table tr.scope-row").removeClass("hidden")}actionExport(){const e=new i.default;this.assignView("dialog",e).then(()=>{e.render()})}}e.default=s}),define("views/admin/entity-manager/formula",["exports","view","model","views/admin/entity-manager/record/edit-formula","underscore"],function(e,t,i,a,s){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=n(t),i=n(i),a=n(a),s=n(s);class o extends t.default{template="admin/entity-manager/formula";scope;attributes;data(){return{scope:this.scope,type:this.type}}setup(){if(this.addActionHandler("save",()=>this.actionSave()),this.addActionHandler("close",()=>this.actionClose()),this.addActionHandler("resetToDefault",()=>this.actionResetToDefault()),this.addHandler("keydown.form","","onKeyDown"),this.scope=this.options.scope,this.type=this.options.type,!this.scope||!this.type)throw Error("No scope or type.");if(!["beforeSaveCustomScript","beforeSaveApiScript"].includes(this.type))throw Espo.Ui.error("No allowed formula type.",!0),new Espo.Exceptions.NotFound("No allowed formula type specified.");this.model=new i.default,this.model.name="EntityManager",this.wait(this.loadFormula().then(()=>{this.recordView=new a.default({model:this.model,targetEntityType:this.scope,type:this.type}),this.assignView("record",this.recordView,".record")})),this.listenTo(this.model,"change",(e,t)=>{t.ui&&this.setIsChanged()})}async loadFormula(){await Espo.Ajax.getRequest("Metadata/action/get",{key:"formula."+this.scope}).then(e=>{this.model.set(this.type,(e=e||{})[this.type]||null),this.updateAttributes()})}afterRender(){this.$save=this.$el.find('[data-action="save"]')}disableButtons(){this.$save.addClass("disabled").attr("disabled","disabled")}enableButtons(){this.$save.removeClass("disabled").removeAttr("disabled")}updateAttributes(){this.attributes=Espo.Utils.clone(this.model.attributes)}actionSave(){var e=this.recordView.fetch();s.default.isEqual(e,this.attributes)?Espo.Ui.warning(this.translate("notModified","messages")):this.recordView.validate()||(this.disableButtons(),Espo.Ui.notify(" ... "),Espo.Ajax.postRequest("EntityManager/action/formula",{data:e,scope:this.scope}).then(()=>{Espo.Ui.success(this.translate("Saved")),this.enableButtons(),this.setIsNotChanged(),this.updateAttributes()}).catch(()=>this.enableButtons()))}actionClose(){this.setIsNotChanged(),this.getRouter().navigate("#Admin/entityManager/scope="+this.scope,{trigger:!0})}async actionResetToDefault(){await this.confirm(this.translate("confirmation","messages")),this.disableButtons(),Espo.Ui.notify(" ... ");try{await Espo.Ajax.postRequest("EntityManager/action/resetFormulaToDefault",{scope:this.scope,type:this.type})}catch(e){return void this.enableButtons()}await this.loadFormula(),await this.recordView.reRender(),this.enableButtons(),this.setIsNotChanged(),Espo.Ui.success(this.translate("Done"))}setConfirmLeaveOut(e){this.getRouter().confirmLeaveOut=e}setIsChanged(){this.isChanged=!0,this.setConfirmLeaveOut(!0)}setIsNotChanged(){this.isChanged=!1,this.setConfirmLeaveOut(!1)}updatePageTitle(){this.setPageTitle(this.getLanguage().translate("Formula","labels","EntityManager"))}onKeyDown(e){var t=Espo.Utils.getKeyFromKeyEvent(e);"Control+KeyS"!==t&&"Control+Enter"!==t||(this.actionSave(),e.preventDefault(),e.stopPropagation())}}e.default=o}),define("views/admin/entity-manager/edit",["exports","view","model"],function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),i=a(i);class s extends t.default{template="admin/entity-manager/edit";additionalParams;defaultParamLocation="scopes";data(){return{isNew:this.isNew,scope:this.scope}}setupData(){let s=this.scope;var e=this.getMetadata().get(["scopes",s,"type"])||null;if(this.hasStreamField=!0,s&&(this.hasStreamField=this.getMetadata().get(["scopes",s,"customizable"])&&this.getMetadata().get(["scopes",s,"object"])||!1),"User"===s&&(this.hasStreamField=!1),this.hasColorField=!this.getConfig().get("scopeColorsDisabled"),s)for(var t in this.additionalParams=Espo.Utils.cloneDeep({...this.getMetadata().get(["app","entityManagerParams","Global"]),...this.getMetadata().get(["app","entityManagerParams","@"+(e||"_")]),...this.getMetadata().get(["app","entityManagerParams",s])}),this.model.set("name",s),this.model.set("labelSingular",this.translate(s,"scopeNames")),this.model.set("labelPlural",this.translate(s,"scopeNamesPlural")),this.model.set("type",this.getMetadata().get("scopes."+s+".type")||""),this.model.set("stream",this.getMetadata().get("scopes."+s+".stream")||!1),this.model.set("disabled",this.getMetadata().get("scopes."+s+".disabled")||!1),this.model.set("sortBy",this.getMetadata().get("entityDefs."+s+".collection.orderBy")),this.model.set("sortDirection",this.getMetadata().get("entityDefs."+s+".collection.order")),this.model.set("textFilterFields",this.getMetadata().get(["entityDefs",s,"collection","textFilterFields"])||["name"]),this.model.set("fullTextSearch",this.getMetadata().get(["entityDefs",s,"collection","fullTextSearch"])||!1),this.model.set("countDisabled",this.getMetadata().get(["entityDefs",s,"collection","countDisabled"])||!1),this.model.set("statusField",this.getMetadata().get("scopes."+s+".statusField")||null),this.hasColorField&&this.model.set("color",this.getMetadata().get(["clientDefs",s,"color"])||null),this.model.set("iconClass",this.getMetadata().get(["clientDefs",s,"iconClass"])||null),this.model.set("kanbanViewMode",this.getMetadata().get(["clientDefs",s,"kanbanViewMode"])||!1),this.model.set("kanbanStatusIgnoreList",this.getMetadata().get(["scopes",s,"kanbanStatusIgnoreList"])||[]),this.additionalParams){var i=this.additionalParams[t],a=i.location||this.defaultParamLocation,i="bool"!==i.fieldDefs.type&&null,a=this.getMetadata().get([a,s,t])||i;this.model.set(t,a)}if(s){let t=this.getMetadata().get("entityDefs."+s+".fields")||{};this.orderableFieldList=Object.keys(t).filter(e=>!!this.getFieldManager().isEntityTypeFieldAvailable(s,e)&&!t[e].notStorable).sort((e,t)=>this.translate(e,"fields",s).localeCompare(this.translate(t,"fields",s))),this.sortByTranslation={},this.orderableFieldList.forEach(e=>{this.sortByTranslation[e]=this.translate(e,"fields",s)}),this.filtersOptionList=this.getTextFiltersOptionList(s),this.textFilterFieldsTranslation={},this.filtersOptionList.forEach(e=>{var t,i,a;if(~e.indexOf("."))return t=e.split(".")[0],i=e.split(".")[1],a=this.getMetadata().get(["entityDefs",s,"links",t,"entity"]),void(this.textFilterFieldsTranslation[e]=this.translate(t,"links",s)+"."+this.translate(i,"fields",a));this.textFilterFieldsTranslation[e]=this.translate(e,"fields",s)}),this.enumFieldList=Object.keys(t).filter(e=>{if(!t[e].disabled)return"enum"===t[e].type||void 0}).sort((e,t)=>this.translate(e,"fields",s).localeCompare(this.translate(t,"fields",s))),this.translatedStatusFields={},this.enumFieldList.forEach(e=>{this.translatedStatusFields[e]=this.translate(e,"fields",s)}),this.enumFieldList.unshift(""),this.translatedStatusFields[""]="-"+this.translate("None")+"-",this.statusOptionList=[],this.translatedStatusOptions={}}if(this.detailLayout=[{rows:[[{name:"name"},{name:"type",options:{tooltipText:this.translate("entityType","tooltips","EntityManager")}}],[{name:"labelSingular"},{name:"labelPlural"}],[{name:"iconClass"},{name:"color"}],[{name:"disabled"},{name:"stream"}],[{name:"sortBy",options:{translatedOptions:this.sortByTranslation}},{name:"sortDirection"}],[{name:"textFilterFields",options:{translatedOptions:this.textFilterFieldsTranslation}},{name:"statusField",options:{translatedOptions:this.translatedStatusFields}}],[{name:"fullTextSearch"},{name:"countDisabled"}],[{name:"kanbanViewMode"},{name:"kanbanStatusIgnoreList",options:{translatedOptions:this.translatedStatusOptions}}]]}],this.scope){var e=[],n=[];let t=Object.keys(this.additionalParams).filter(e=>!!this.getMetadata().get(["app","entityManagerParams","Global",e]));var o=Object.keys(this.additionalParams).filter(e=>!t.includes(e)),l=function(a,s){s.forEach((e,t)=>{t%2==0&&a.push([]);let i=a[a.length-1];i.push({name:e}),t===s.length-1&&1===i.length&&i.push(!1)})};l(e,t),l(n,o),e.length&&this.detailLayout.push({rows:e}),n.length&&this.detailLayout.push({rows:n})}}setup(){var e=this.scope=this.options.scope||!1;this.isNew=!e;let t=this.model=new i.default;t.name="EntityManager",this.isNew||(this.isCustom=this.getMetadata().get(["scopes",e,"isCustom"])),this.setupData(),this.setupDefs(),this.model.fetchedAttributes=this.model.getClonedAttributes(),this.createRecordView()}setupDefs(){var e,t=this.scope;let i={fields:{type:{type:"enum",required:!0,options:this.getMetadata().get("app.entityTemplateList")||["Base"],readOnly:!1!==t,tooltip:!0},stream:{type:"bool",required:!0,tooltip:!0},disabled:{type:"bool",tooltip:!0},name:{type:"varchar",required:!0,trim:!0,maxLength:64,readOnly:!1!==t},labelSingular:{type:"varchar",required:!0,trim:!0},labelPlural:{type:"varchar",required:!0,trim:!0},color:{type:"varchar",view:"views/fields/colorpicker"},iconClass:{type:"varchar",view:"views/admin/entity-manager/fields/icon-class"},sortBy:{type:"enum",options:this.orderableFieldList},sortDirection:{type:"enum",options:["asc","desc"]},fullTextSearch:{type:"bool",tooltip:!0},countDisabled:{type:"bool",tooltip:!0},kanbanViewMode:{type:"bool"},textFilterFields:{type:"multiEnum",options:this.filtersOptionList,tooltip:!0},statusField:{type:"enum",options:this.enumFieldList,tooltip:!0},kanbanStatusIgnoreList:{type:"multiEnum",options:this.statusOptionList}}};for(e in this.getMetadata().get(["scopes",this.scope,"statusFieldLocked"])&&(i.fields.statusField.readOnly=!0),this.additionalParams)i.fields[e]=this.additionalParams[e].fieldDefs;this.model.setDefs(i)}createRecordView(){return this.createView("record","views/admin/entity-manager/record/edit",{selector:".record",model:this.model,detailLayout:this.detailLayout,isNew:this.isNew,hasColorField:this.hasColorField,hasStreamField:this.hasStreamField,isCustom:this.isCustom,subjectEntityType:this.scope,shortcutKeysEnabled:!0}).then(e=>{this.listenTo(e,"save",()=>this.actionSave()),this.listenTo(e,"cancel",()=>this.actionCancel()),this.listenTo(e,"reset-to-default",()=>this.actionResetToDefault())})}hideField(e){this.getRecordView().hideField(e)}showField(e){this.getRecordView().showField(e)}toPlural(e){return"y"===e.slice(-1)?e.substr(0,e.length-1)+"ies":"s"===e.slice(-1)?e+"es":e+"s"}afterRender(){this.getFieldView("name").on("change",()=>{let e=this.model.get("name");e=e.charAt(0).toUpperCase()+e.slice(1),this.model.set("labelSingular",e),this.model.set("labelPlural",this.toPlural(e)),e&&(e=e.replace(/-/g," ").replace(/_/g," ").replace(/[^\w\s]/gi,"").replace(/ (.)/g,(e,t)=>t.toUpperCase()).replace(" ","")).length&&(e=e.charAt(0).toUpperCase()+e.slice(1)),this.model.set("name",e)})}actionSave(){let e=["name","type","labelSingular","labelPlural","disabled","statusField","iconClass"],a=(this.hasStreamField&&e.push("stream"),this.scope&&(e.push("sortBy"),e.push("sortDirection"),e.push("kanbanViewMode"),e.push("kanbanStatusIgnoreList"),e=e.concat(Object.keys(this.additionalParams))),this.hasColorField&&e.push("color"),Espo.Utils.cloneDeep(this.model.fetchedAttributes)||{}),t=!1;if(e.forEach(e=>{this.getFieldView(e)&&"edit"===this.getFieldView(e).mode&&this.getFieldView(e).fetchToModel()}),e.forEach(e=>{this.getFieldView(e)&&"edit"===this.getFieldView(e).mode&&(t=this.getFieldView(e).validate()||t)}),!t){this.disableButtons();let e="EntityManager/action/createEntity",t=(this.scope&&(e="EntityManager/action/updateEntity"),this.model.get("name")),i={name:t,labelSingular:this.model.get("labelSingular"),labelPlural:this.model.get("labelPlural"),type:this.model.get("type"),stream:this.model.get("stream"),disabled:this.model.get("disabled"),textFilterFields:this.model.get("textFilterFields"),fullTextSearch:this.model.get("fullTextSearch"),countDisabled:this.model.get("countDisabled"),statusField:this.model.get("statusField"),iconClass:this.model.get("iconClass")};if(this.hasColorField&&(i.color=this.model.get("color")||null),""===i.statusField&&(i.statusField=null),this.scope)for(var s in i.sortBy=this.model.get("sortBy"),i.sortDirection=this.model.get("sortDirection"),i.kanbanViewMode=this.model.get("kanbanViewMode"),i.kanbanStatusIgnoreList=this.model.get("kanbanStatusIgnoreList"),this.additionalParams){var n=this.additionalParams[s].fieldDefs.type;this.getFieldManager().getAttributeList(n,s).forEach(e=>{i[e]=this.model.get(e)})}this.isNew||(this.model.fetchedAttributes.labelPlural===i.labelPlural&&delete i.labelPlural,this.model.fetchedAttributes.labelSingular===i.labelSingular&&delete i.labelSingular),Espo.Ui.notify(this.translate("pleaseWait","messages")),Espo.Ajax.postRequest(e,i).then(()=>{this.model.fetchedAttributes=this.model.getClonedAttributes(),this.scope?Espo.Ui.success(this.translate("Saved")):Espo.Ui.success(this.translate("entityCreated","messages","EntityManager")),this.getMetadata().loadSkipCache().then(()=>Promise.all([this.getConfig().load(),this.getLanguage().loadSkipCache()])).then(()=>{var e=i.fullTextSearch&&!a.fullTextSearch;this.broadcastUpdate(),e&&this.createView("dialog","views/modal",{templateContent:"{{complexText viewObject.options.msg}}{{complexText viewObject.options.msgRebuild}}",headerText:this.translate("rebuildRequired","strings","Admin"),backdrop:"static",msg:this.translate("rebuildRequired","messages","Admin"),msgRebuild:"```php rebuild.php```",buttonList:[{name:"close",label:this.translate("Close")}]}).then(e=>e.render()),this.enableButtons(),this.getRecordView().setIsNotChanged(),this.isNew&&this.getRouter().navigate("#Admin/entityManager/scope="+t,{trigger:!0})})}).catch(()=>{this.enableButtons()})}}actionCancel(){this.getRecordView().setConfirmLeaveOut(!1),this.isNew?this.getRouter().navigate("#Admin/entityManager",{trigger:!0}):this.getRouter().navigate("#Admin/entityManager/scope="+this.scope,{trigger:!0})}actionResetToDefault(){this.confirm(this.translate("confirmation","messages"),()=>{Espo.Ui.notify(this.translate("pleaseWait","messages")),this.disableButtons(),Espo.Ajax.postRequest("EntityManager/action/resetToDefault",{scope:this.scope}).then(()=>{this.getMetadata().loadSkipCache().then(()=>this.getLanguage().loadSkipCache()).then(()=>{this.setupData(),this.model.fetchedAttributes=this.model.getClonedAttributes(),Espo.Ui.notify(this.translate("Done"),"success"),this.enableButtons(),this.broadcastUpdate(),this.getRecordView().setIsNotChanged()})})})}getRecordView(){return this.getView("record")}getTextFiltersOptionList(s){let i=this.getMetadata().get(["entityDefs",s,"fields"])||{},n=Object.keys(i).filter(e=>{var t=i[e].type;return!!this.getMetadata().get(["fields",t,"textFilter"])&&(!!this.getFieldManager().isEntityTypeFieldAvailable(s,e)&&!this.getMetadata().get(["entityDefs",s,"fields",e,"textFilterDisabled"]))}),e=(n.unshift("id"),Object.keys(this.getMetadata().get(["entityDefs",s,"links"])||{}));return e.sort((e,t)=>this.translate(e,"links",s).localeCompare(this.translate(t,"links",s))),e.forEach(t=>{if("belongsTo"===this.getMetadata().get(["entityDefs",s,"links",t,"type"])){let i=this.getMetadata().get(["entityDefs",s,"links",t,"entity"]);if(i&&"Attachment"!==i){var a=this.getMetadata().get(["entityDefs",i,"fields"])||{};let e=Object.keys(a);e.sort((e,t)=>this.translate(e,"fields",i).localeCompare(this.translate(t,"fields",i))),e.filter(e=>{var t=this.getMetadata().get(["entityDefs",i,"fields",e,"type"]);return!!this.getMetadata().get(["fields",t,"textFilter"])&&(!!this.getMetadata().get(["fields",t,"textFilterForeign"])&&(!!this.getFieldManager().isEntityTypeFieldAvailable(i,e)&&(!this.getMetadata().get(["entityDefs",i,"fields",e,"textFilterDisabled"])&&!this.getMetadata().get(["entityDefs",i,"fields",e,"foreignAccessDisabled"]))))}).forEach(e=>{n.push(t+"."+e)})}}}),n}getFieldView(e){return this.getRecordView().getFieldView(e)}disableButtons(){this.getRecordView().disableActionItems()}enableButtons(){this.getRecordView().enableActionItems()}broadcastUpdate(){this.getHelper().broadcastChannel.postMessage("update:metadata"),this.getHelper().broadcastChannel.postMessage("update:language"),this.getHelper().broadcastChannel.postMessage("update:config")}}e.default=s}),define("views/admin/entity-manager/record/edit",["views/record/edit"],function(e){return e.extend({bottomView:null,sideView:null,dropdownItemList:[],accessControlDisabled:!0,saveAndContinueEditingAction:!1,saveAndNewAction:!1,shortcutKeys:{"Control+Enter":"save","Control+KeyS":"save"},setup:function(){this.isCreate=this.options.isNew,this.scope="EntityManager",this.subjectEntityType=this.options.subjectEntityType,this.isCreate?this.buttonList=[{name:"save",style:"danger",label:"Create"},{name:"cancel",label:"Cancel"}]:this.buttonList=[{name:"save",style:"danger",label:"Save"},{name:"cancel",label:"Cancel"}],this.isCreate||this.options.isCustom||this.buttonList.push({name:"resetToDefault",text:this.translate("Reset to Default","labels","Admin")}),e.prototype.setup.call(this),this.isCreate&&(this.hideField("sortBy"),this.hideField("sortDirection"),this.hideField("textFilterFields"),this.hideField("statusField"),this.hideField("fullTextSearch"),this.hideField("countDisabled"),this.hideField("kanbanViewMode"),this.hideField("kanbanStatusIgnoreList"),this.hideField("disabled")),this.options.hasColorField||this.hideField("color"),this.options.hasStreamField||this.hideField("stream"),this.isCreate||(this.manageKanbanFields({}),this.listenTo(this.model,"change:statusField",(e,t,i)=>{this.manageKanbanFields(i)}),this.manageKanbanViewModeField(),this.listenTo(this.model,"change:kanbanViewMode",()=>{this.manageKanbanViewModeField()}))},actionSave:function(){this.trigger("save")},actionCancel:function(){this.trigger("cancel")},actionResetToDefault:function(){this.trigger("reset-to-default")},manageKanbanViewModeField:function(){this.model.get("kanbanViewMode")?this.showField("kanbanStatusIgnoreList"):this.hideField("kanbanStatusIgnoreList")},manageKanbanFields:function(e){e.ui&&this.model.set("kanbanStatusIgnoreList",[]),this.model.get("statusField")?(this.setKanbanStatusIgnoreListOptions(),this.showField("kanbanViewMode"),this.model.get("kanbanViewMode")?this.showField("kanbanStatusIgnoreList"):this.hideField("kanbanStatusIgnoreList")):(this.hideField("kanbanViewMode"),this.hideField("kanbanStatusIgnoreList"))},setKanbanStatusIgnoreListOptions:function(){var e=this.model.get("statusField"),e=this.getMetadata().get(["entityDefs",this.subjectEntityType,"fields",e,"options"])||[],e=(this.setFieldOptionList("kanbanStatusIgnoreList",e),this.getFieldView("kanbanStatusIgnoreList"));e?this.setKanbanStatusIgnoreListTranslation():this.once("after:render",()=>this.setKanbanStatusIgnoreListTranslation())},setKanbanStatusIgnoreListTranslation:function(){var e=this.getFieldView("kanbanStatusIgnoreList"),t=this.model.get("statusField"),t=this.getMetadata().get(["entityDefs",this.subjectEntityType,"fields",t,"translation"])||this.subjectEntityType+".options."+t;e.params.translation=t,e.setupTranslation()}})}),define("views/admin/entity-manager/modals/select-icon",["views/modal","model"],function(e,t){return e.extend({template:"admin/entity-manager/modals/select-icon",buttonList:[{name:"cancel",label:"Cancel"}],data:function(){return{iconDataList:this.getIconDataList()}},setup:function(){this.events['keyup input[data-name="quick-search"]']=function(e){this.processQuickSearch(e.currentTarget.value)},this.itemCache={},this.iconList=["fas fa-ad","fas fa-address-book","fas fa-address-card","fas fa-adjust","fas fa-air-freshener","fas fa-align-center","fas fa-align-justify","fas fa-align-left","fas fa-align-right","fas fa-allergies","fas fa-ambulance","fas fa-american-sign-language-interpreting","fas fa-anchor","fas fa-angle-double-down","fas fa-angle-double-left","fas fa-angle-double-right","fas fa-angle-double-up","fas fa-angle-down","fas fa-angle-left","fas fa-angle-right","fas fa-angle-up","fas fa-angry","fas fa-ankh","fas fa-apple-alt","fas fa-archive","fas fa-archway","fas fa-arrow-alt-circle-down","fas fa-arrow-alt-circle-left","fas fa-arrow-alt-circle-right","fas fa-arrow-alt-circle-up","fas fa-arrow-circle-down","fas fa-arrow-circle-left","fas fa-arrow-circle-right","fas fa-arrow-circle-up","fas fa-arrow-down","fas fa-arrow-left","fas fa-arrow-right","fas fa-arrow-up","fas fa-arrows-alt","fas fa-arrows-alt-h","fas fa-arrows-alt-v","fas fa-assistive-listening-systems","fas fa-asterisk","fas fa-at","fas fa-atlas","fas fa-atom","fas fa-audio-description","fas fa-award","fas fa-baby","fas fa-baby-carriage","fas fa-backspace","fas fa-backward","fas fa-balance-scale","fas fa-ban","fas fa-band-aid","fas fa-barcode","fas fa-bars","fas fa-baseball-ball","fas fa-basketball-ball","fas fa-bath","fas fa-battery-empty","fas fa-battery-full","fas fa-battery-half","fas fa-battery-quarter","fas fa-battery-three-quarters","fas fa-bed","fas fa-beer","fas fa-bell","fas fa-bell-slash","fas fa-bezier-curve","fas fa-bible","fas fa-bicycle","fas fa-binoculars","fas fa-biohazard","fas fa-birthday-cake","fas fa-blender","fas fa-blender-phone","fas fa-blind","fas fa-blog","fas fa-bold","fas fa-bolt","fas fa-bomb","fas fa-bone","fas fa-bong","fas fa-book","fas fa-book-dead","fas fa-book-open","fas fa-book-reader","fas fa-bookmark","fas fa-bowling-ball","fas fa-box","fas fa-box-open","fas fa-boxes","fas fa-braille","fas fa-brain","fas fa-briefcase","fas fa-briefcase-medical","fas fa-broadcast-tower","fas fa-broom","fas fa-brush","fas fa-bug","fas fa-building","fas fa-bullhorn","fas fa-bullseye","fas fa-burn","fas fa-bus","fas fa-bus-alt","fas fa-business-time","fas fa-calculator","fas fa-calendar","fas fa-calendar-alt","fas fa-calendar-check","fas fa-calendar-day","fas fa-calendar-minus","fas fa-calendar-plus","fas fa-calendar-times","fas fa-calendar-week","fas fa-camera","fas fa-camera-retro","fas fa-campground","fas fa-candy-cane","fas fa-cannabis","fas fa-capsules","fas fa-car","fas fa-car-alt","fas fa-car-battery","fas fa-car-crash","fas fa-car-side","fas fa-caret-down","fas fa-caret-left","fas fa-caret-right","fas fa-caret-square-down","fas fa-caret-square-left","fas fa-caret-square-right","fas fa-caret-square-up","fas fa-caret-up","fas fa-carrot","fas fa-cart-arrow-down","fas fa-cart-plus","fas fa-cash-register","fas fa-cat","fas fa-certificate","fas fa-chair","fas fa-chalkboard","fas fa-chalkboard-teacher","fas fa-charging-station","fas fa-chart-area","fas fa-chart-bar","fas fa-chart-line","fas fa-chart-pie","fas fa-check","fas fa-check-circle","fas fa-check-double","fas fa-check-square","fas fa-chess","fas fa-chess-bishop","fas fa-chess-board","fas fa-chess-king","fas fa-chess-knight","fas fa-chess-pawn","fas fa-chess-queen","fas fa-chess-rook","fas fa-chevron-circle-down","fas fa-chevron-circle-left","fas fa-chevron-circle-right","fas fa-chevron-circle-up","fas fa-chevron-down","fas fa-chevron-left","fas fa-chevron-right","fas fa-chevron-up","fas fa-child","fas fa-church","fas fa-circle","fas fa-circle-notch","fas fa-city","fas fa-clipboard","fas fa-clipboard-check","fas fa-clipboard-list","fas fa-clock","fas fa-clone","fas fa-closed-captioning","fas fa-cloud","fas fa-cloud-download-alt","fas fa-cloud-meatball","fas fa-cloud-moon","fas fa-cloud-moon-rain","fas fa-cloud-rain","fas fa-cloud-showers-heavy","fas fa-cloud-sun","fas fa-cloud-sun-rain","fas fa-cloud-upload-alt","fas fa-cocktail","fas fa-code","fas fa-code-branch","fas fa-coffee","fas fa-cog","fas fa-cogs","fas fa-coins","fas fa-columns","fas fa-comment","fas fa-comment-alt","fas fa-comment-dollar","fas fa-comment-dots","fas fa-comment-slash","fas fa-comments","fas fa-comments-dollar","fas fa-compact-disc","fas fa-compass","fas fa-compress","fas fa-compress-arrows-alt","fas fa-concierge-bell","fas fa-cookie","fas fa-cookie-bite","fas fa-copy","fas fa-copyright","fas fa-couch","fas fa-credit-card","fas fa-crop","fas fa-crop-alt","fas fa-cross","fas fa-crosshairs","fas fa-crow","fas fa-crown","fas fa-cube","fas fa-cubes","fas fa-cut","fas fa-database","fas fa-deaf","fas fa-democrat","fas fa-desktop","fas fa-dharmachakra","fas fa-diagnoses","fas fa-dice","fas fa-dice-d20","fas fa-dice-d6","fas fa-dice-five","fas fa-dice-four","fas fa-dice-one","fas fa-dice-six","fas fa-dice-three","fas fa-dice-two","fas fa-digital-tachograph","fas fa-directions","fas fa-divide","fas fa-dizzy","fas fa-dna","fas fa-dog","fas fa-dollar-sign","fas fa-dolly","fas fa-dolly-flatbed","fas fa-donate","fas fa-door-closed","fas fa-door-open","fas fa-dot-circle","fas fa-dove","fas fa-download","fas fa-drafting-compass","fas fa-dragon","fas fa-draw-polygon","fas fa-drum","fas fa-drum-steelpan","fas fa-drumstick-bite","fas fa-dumbbell","fas fa-dumpster","fas fa-dumpster-fire","fas fa-dungeon","fas fa-edit","fas fa-eject","fas fa-ellipsis-h","fas fa-ellipsis-v","fas fa-envelope","fas fa-envelope-open","fas fa-envelope-open-text","fas fa-envelope-square","fas fa-equals","fas fa-eraser","fas fa-ethernet","fas fa-euro-sign","fas fa-exchange-alt","fas fa-exclamation","fas fa-exclamation-circle","fas fa-exclamation-triangle","fas fa-expand","fas fa-expand-arrows-alt","fas fa-external-link-alt","fas fa-external-link-square-alt","fas fa-eye","fas fa-eye-dropper","fas fa-eye-slash","fas fa-fast-backward","fas fa-fast-forward","fas fa-fax","fas fa-feather","fas fa-feather-alt","fas fa-female","fas fa-fighter-jet","fas fa-file","fas fa-file-alt","fas fa-file-archive","fas fa-file-audio","fas fa-file-code","fas fa-file-contract","fas fa-file-csv","fas fa-file-download","fas fa-file-excel","fas fa-file-export","fas fa-file-image","fas fa-file-import","fas fa-file-invoice","fas fa-file-invoice-dollar","fas fa-file-medical","fas fa-file-medical-alt","fas fa-file-pdf","fas fa-file-powerpoint","fas fa-file-prescription","fas fa-file-signature","fas fa-file-upload","fas fa-file-video","fas fa-file-word","fas fa-fill","fas fa-fill-drip","fas fa-film","fas fa-filter","fas fa-fingerprint","fas fa-fire","fas fa-fire-extinguisher","fas fa-first-aid","fas fa-fish","fas fa-fist-raised","fas fa-flag","fas fa-flag-checkered","fas fa-flag-usa","fas fa-flask","fas fa-flushed","fas fa-folder","fas fa-folder-minus","fas fa-folder-open","fas fa-folder-plus","fas fa-font","fas fa-football-ball","fas fa-forward","fas fa-frog","fas fa-frown","fas fa-frown-open","fas fa-funnel-dollar","fas fa-futbol","fas fa-gamepad","fas fa-gas-pump","fas fa-gavel","fas fa-gem","fas fa-genderless","fas fa-ghost","fas fa-gift","fas fa-gifts","fas fa-glass-cheers","fas fa-glass-martini","fas fa-glass-martini-alt","fas fa-glass-whiskey","fas fa-glasses","fas fa-globe","fas fa-globe-africa","fas fa-globe-americas","fas fa-globe-asia","fas fa-globe-europe","fas fa-golf-ball","fas fa-gopuram","fas fa-graduation-cap","fas fa-greater-than","fas fa-greater-than-equal","fas fa-grimace","fas fa-grin","fas fa-grin-alt","fas fa-grin-beam","fas fa-grin-beam-sweat","fas fa-grin-hearts","fas fa-grin-squint","fas fa-grin-squint-tears","fas fa-grin-stars","fas fa-grin-tears","fas fa-grin-tongue","fas fa-grin-tongue-squint","fas fa-grin-tongue-wink","fas fa-grin-wink","fas fa-grip-horizontal","fas fa-grip-lines","fas fa-grip-lines-vertical","fas fa-grip-vertical","fas fa-guitar","fas fa-h-square","fas fa-hammer","fas fa-hamsa","fas fa-hand-holding","fas fa-hand-holding-heart","fas fa-hand-holding-usd","fas fa-hand-lizard","fas fa-hand-paper","fas fa-hand-peace","fas fa-hand-point-down","fas fa-hand-point-left","fas fa-hand-point-right","fas fa-hand-point-up","fas fa-hand-pointer","fas fa-hand-rock","fas fa-hand-scissors","fas fa-hand-spock","fas fa-hands","fas fa-hands-helping","fas fa-handshake","fas fa-hanukiah","fas fa-hashtag","fas fa-hat-wizard","fas fa-haykal","fas fa-hdd","fas fa-heading","fas fa-headphones","fas fa-headphones-alt","fas fa-headset","fas fa-heart","fas fa-heart-broken","fas fa-heartbeat","fas fa-helicopter","fas fa-highlighter","fas fa-hiking","fas fa-hippo","fas fa-history","fas fa-hockey-puck","fas fa-holly-berry","fas fa-home","fas fa-horse","fas fa-horse-head","fas fa-hospital","fas fa-hospital-alt","fas fa-hospital-symbol","fas fa-hot-tub","fas fa-hotel","fas fa-hourglass","fas fa-hourglass-end","fas fa-hourglass-half","fas fa-hourglass-start","fas fa-house-damage","fas fa-hryvnia","fas fa-i-cursor","fas fa-icicles","fas fa-id-badge","fas fa-id-card","fas fa-id-card-alt","fas fa-igloo","fas fa-image","fas fa-images","fas fa-inbox","fas fa-indent","fas fa-industry","fas fa-infinity","fas fa-info","fas fa-info-circle","fas fa-italic","fas fa-jedi","fas fa-joint","fas fa-journal-whills","fas fa-kaaba","fas fa-key","fas fa-keyboard","fas fa-khanda","fas fa-kiss","fas fa-kiss-beam","fas fa-kiss-wink-heart","fas fa-kiwi-bird","fas fa-landmark","fas fa-language","fas fa-laptop","fas fa-laptop-code","fas fa-laugh","fas fa-laugh-beam","fas fa-laugh-squint","fas fa-laugh-wink","fas fa-layer-group","fas fa-leaf","fas fa-lemon","fas fa-less-than","fas fa-less-than-equal","fas fa-level-down-alt","fas fa-level-up-alt","fas fa-life-ring","fas fa-lightbulb","fas fa-link","fas fa-lira-sign","fas fa-list","fas fa-list-alt","fas fa-list-ol","fas fa-list-ul","fas fa-location-arrow","fas fa-lock","fas fa-lock-open","fas fa-long-arrow-alt-down","fas fa-long-arrow-alt-left","fas fa-long-arrow-alt-right","fas fa-long-arrow-alt-up","fas fa-low-vision","fas fa-luggage-cart","fas fa-magic","fas fa-magnet","fas fa-mail-bulk","fas fa-male","fas fa-map","fas fa-map-marked","fas fa-map-marked-alt","fas fa-map-marker","fas fa-map-marker-alt","fas fa-map-pin","fas fa-map-signs","fas fa-marker","fas fa-mars","fas fa-mars-double","fas fa-mars-stroke","fas fa-mars-stroke-h","fas fa-mars-stroke-v","fas fa-mask","fas fa-medal","fas fa-medkit","fas fa-meh","fas fa-meh-blank","fas fa-meh-rolling-eyes","fas fa-memory","fas fa-menorah","fas fa-mercury","fas fa-meteor","fas fa-microchip","fas fa-microphone","fas fa-microphone-alt","fas fa-microphone-alt-slash","fas fa-microphone-slash","fas fa-microscope","fas fa-minus","fas fa-minus-circle","fas fa-minus-square","fas fa-mitten","fas fa-mobile","fas fa-mobile-alt","fas fa-money-bill","fas fa-money-bill-alt","fas fa-money-bill-wave","fas fa-money-bill-wave-alt","fas fa-money-check","fas fa-money-check-alt","fas fa-monument","fas fa-moon","fas fa-mortar-pestle","fas fa-mosque","fas fa-motorcycle","fas fa-mountain","fas fa-mouse-pointer","fas fa-mug-hot","fas fa-music","fas fa-network-wired","fas fa-neuter","fas fa-newspaper","fas fa-not-equal","fas fa-notes-medical","fas fa-object-group","fas fa-object-ungroup","fas fa-oil-can","fas fa-om","fas fa-otter","fas fa-outdent","fas fa-paint-brush","fas fa-paint-roller","fas fa-palette","fas fa-pallet","fas fa-paper-plane","fas fa-paperclip","fas fa-parachute-box","fas fa-paragraph","fas fa-parking","fas fa-passport","fas fa-pastafarianism","fas fa-paste","fas fa-pause","fas fa-pause-circle","fas fa-paw","fas fa-peace","fas fa-pen","fas fa-pen-alt","fas fa-pen-fancy","fas fa-pen-nib","fas fa-pen-square","fas fa-pencil-alt","fas fa-pencil-ruler","fas fa-people-carry","fas fa-percent","fas fa-percentage","fas fa-person-booth","fas fa-phone","fas fa-phone-slash","fas fa-phone-square","fas fa-phone-volume","fas fa-piggy-bank","fas fa-pills","fas fa-place-of-worship","fas fa-plane","fas fa-plane-arrival","fas fa-plane-departure","fas fa-play","fas fa-play-circle","fas fa-plug","fas fa-plus","fas fa-plus-circle","fas fa-plus-square","fas fa-podcast","fas fa-poll","fas fa-poll-h","fas fa-poo","fas fa-poo-storm","fas fa-poop","fas fa-portrait","fas fa-pound-sign","fas fa-power-off","fas fa-pray","fas fa-praying-hands","fas fa-prescription","fas fa-prescription-bottle","fas fa-prescription-bottle-alt","fas fa-print","fas fa-procedures","fas fa-project-diagram","fas fa-puzzle-piece","fas fa-qrcode","fas fa-question","fas fa-question-circle","fas fa-quidditch","fas fa-quote-left","fas fa-quote-right","fas fa-quran","fas fa-radiation","fas fa-radiation-alt","fas fa-rainbow","fas fa-random","fas fa-receipt","fas fa-recycle","fas fa-redo","fas fa-redo-alt","fas fa-registered","fas fa-reply","fas fa-reply-all","fas fa-republican","fas fa-restroom","fas fa-retweet","fas fa-ribbon","fas fa-ring","fas fa-road","fas fa-robot","fas fa-rocket","fas fa-route","fas fa-rss","fas fa-rss-square","fas fa-ruble-sign","fas fa-ruler","fas fa-ruler-combined","fas fa-ruler-horizontal","fas fa-ruler-vertical","fas fa-running","fas fa-rupee-sign","fas fa-sad-cry","fas fa-sad-tear","fas fa-satellite","fas fa-satellite-dish","fas fa-save","fas fa-school","fas fa-screwdriver","fas fa-scroll","fas fa-sd-card","fas fa-search","fas fa-search-dollar","fas fa-search-location","fas fa-search-minus","fas fa-search-plus","fas fa-seedling","fas fa-server","fas fa-shapes","fas fa-share","fas fa-share-alt","fas fa-share-alt-square","fas fa-share-square","fas fa-shekel-sign","fas fa-shield-alt","fas fa-ship","fas fa-shipping-fast","fas fa-shoe-prints","fas fa-shopping-bag","fas fa-shopping-basket","fas fa-shopping-cart","fas fa-shower","fas fa-shuttle-van","fas fa-sign","fas fa-sign-in-alt","fas fa-sign-language","fas fa-sign-out-alt","fas fa-signal","fas fa-signature","fas fa-sim-card","fas fa-sitemap","fas fa-skating","fas fa-skiing","fas fa-skiing-nordic","fas fa-skull","fas fa-skull-crossbones","fas fa-slash","fas fa-sleigh","fas fa-sliders-h","fas fa-smile","fas fa-smile-beam","fas fa-smile-wink","fas fa-smog","fas fa-smoking","fas fa-smoking-ban","fas fa-sms","fas fa-snowboarding","fas fa-snowflake","fas fa-snowman","fas fa-snowplow","fas fa-socks","fas fa-solar-panel","fas fa-sort","fas fa-sort-alpha-down","fas fa-sort-alpha-up","fas fa-sort-amount-down","fas fa-sort-amount-up","fas fa-sort-down","fas fa-sort-numeric-down","fas fa-sort-numeric-up","fas fa-sort-up","fas fa-spa","fas fa-space-shuttle","fas fa-spider","fas fa-spinner","fas fa-splotch","fas fa-spray-can","fas fa-square","fas fa-square-full","fas fa-square-root-alt","fas fa-stamp","fas fa-star","fas fa-star-and-crescent","fas fa-star-half","fas fa-star-half-alt","fas fa-star-of-david","fas fa-star-of-life","fas fa-step-backward","fas fa-step-forward","fas fa-stethoscope","fas fa-sticky-note","fas fa-stop","fas fa-stop-circle","fas fa-stopwatch","fas fa-store","fas fa-store-alt","fas fa-stream","fas fa-street-view","fas fa-strikethrough","fas fa-stroopwafel","fas fa-subscript","fas fa-subway","fas fa-suitcase","fas fa-suitcase-rolling","fas fa-sun","fas fa-superscript","fas fa-surprise","fas fa-swatchbook","fas fa-swimmer","fas fa-swimming-pool","fas fa-synagogue","fas fa-sync","fas fa-sync-alt","fas fa-syringe","fas fa-table","fas fa-table-tennis","fas fa-tablet","fas fa-tablet-alt","fas fa-tablets","fas fa-tachometer-alt","fas fa-tag","fas fa-tags","fas fa-tape","fas fa-tasks","fas fa-taxi","fas fa-teeth","fas fa-teeth-open","fas fa-temperature-high","fas fa-temperature-low","fas fa-tenge","fas fa-terminal","fas fa-text-height","fas fa-text-width","fas fa-th","fas fa-th-large","fas fa-th-list","fas fa-theater-masks","fas fa-thermometer","fas fa-thermometer-empty","fas fa-thermometer-full","fas fa-thermometer-half","fas fa-thermometer-quarter","fas fa-thermometer-three-quarters","fas fa-thumbs-down","fas fa-thumbs-up","fas fa-thumbtack","fas fa-ticket-alt","fas fa-times","fas fa-times-circle","fas fa-tint","fas fa-tint-slash","fas fa-tired","fas fa-toggle-off","fas fa-toggle-on","fas fa-toilet","fas fa-toilet-paper","fas fa-toolbox","fas fa-tools","fas fa-tooth","fas fa-torah","fas fa-torii-gate","fas fa-tractor","fas fa-trademark","fas fa-traffic-light","fas fa-train","fas fa-tram","fas fa-transgender","fas fa-transgender-alt","fas fa-trash","fas fa-trash-alt","fas fa-tree","fas fa-trophy","fas fa-truck","fas fa-truck-loading","fas fa-truck-monster","fas fa-truck-moving","fas fa-truck-pickup","fas fa-tshirt","fas fa-tty","fas fa-tv","fas fa-umbrella","fas fa-umbrella-beach","fas fa-underline","fas fa-undo","fas fa-undo-alt","fas fa-universal-access","fas fa-university","fas fa-unlink","fas fa-unlock","fas fa-unlock-alt","fas fa-upload","fas fa-user","fas fa-user-alt","fas fa-user-alt-slash","fas fa-user-astronaut","fas fa-user-check","fas fa-user-circle","fas fa-user-clock","fas fa-user-cog","fas fa-user-edit","fas fa-user-friends","fas fa-user-graduate","fas fa-user-injured","fas fa-user-lock","fas fa-user-md","fas fa-user-minus","fas fa-user-ninja","fas fa-user-plus","fas fa-user-secret","fas fa-user-shield","fas fa-user-slash","fas fa-user-tag","fas fa-user-tie","fas fa-user-times","fas fa-users","fas fa-users-cog","fas fa-utensil-spoon","fas fa-utensils","fas fa-vector-square","fas fa-venus","fas fa-venus-double","fas fa-venus-mars","fas fa-vial","fas fa-vials","fas fa-video","fas fa-video-slash","fas fa-vihara","fas fa-volleyball-ball","fas fa-volume-down","fas fa-volume-mute","fas fa-volume-off","fas fa-volume-up","fas fa-vote-yea","fas fa-vr-cardboard","fas fa-walking","fas fa-wallet","fas fa-warehouse","fas fa-water","fas fa-weight","fas fa-weight-hanging","fas fa-wheelchair","fas fa-wifi","fas fa-wind","fas fa-window-close","fas fa-window-maximize","fas fa-window-minimize","fas fa-window-restore","fas fa-wine-bottle","fas fa-wine-glass","fas fa-wine-glass-alt","fas fa-won-sign","fas fa-wrench","fas fa-x-ray","fas fa-yen-sign","fas fa-yin-yang","far fa-address-book","far fa-address-card","far fa-angry","far fa-arrow-alt-circle-down","far fa-arrow-alt-circle-left","far fa-arrow-alt-circle-right","far fa-arrow-alt-circle-up","far fa-bell","far fa-bell-slash","far fa-bookmark","far fa-building","far fa-calendar","far fa-calendar-alt","far fa-calendar-check","far fa-calendar-minus","far fa-calendar-plus","far fa-calendar-times","far fa-caret-square-down","far fa-caret-square-left","far fa-caret-square-right","far fa-caret-square-up","far fa-chart-bar","far fa-check-circle","far fa-check-square","far fa-circle","far fa-clipboard","far fa-clock","far fa-clone","far fa-closed-captioning","far fa-comment","far fa-comment-alt","far fa-comment-dots","far fa-comments","far fa-compass","far fa-copy","far fa-copyright","far fa-credit-card","far fa-dizzy","far fa-dot-circle","far fa-edit","far fa-envelope","far fa-envelope-open","far fa-eye","far fa-eye-slash","far fa-file","far fa-file-alt","far fa-file-archive","far fa-file-audio","far fa-file-code","far fa-file-excel","far fa-file-image","far fa-file-pdf","far fa-file-powerpoint","far fa-file-video","far fa-file-word","far fa-flag","far fa-flushed","far fa-folder","far fa-folder-open","far fa-frown","far fa-frown-open","far fa-futbol","far fa-gem","far fa-grimace","far fa-grin","far fa-grin-alt","far fa-grin-beam","far fa-grin-beam-sweat","far fa-grin-hearts","far fa-grin-squint","far fa-grin-squint-tears","far fa-grin-stars","far fa-grin-tears","far fa-grin-tongue","far fa-grin-tongue-squint","far fa-grin-tongue-wink","far fa-grin-wink","far fa-hand-lizard","far fa-hand-paper","far fa-hand-peace","far fa-hand-point-down","far fa-hand-point-left","far fa-hand-point-right","far fa-hand-point-up","far fa-hand-pointer","far fa-hand-rock","far fa-hand-scissors","far fa-hand-spock","far fa-handshake","far fa-hdd","far fa-heart","far fa-hospital","far fa-hourglass","far fa-id-badge","far fa-id-card","far fa-image","far fa-images","far fa-keyboard","far fa-kiss","far fa-kiss-beam","far fa-kiss-wink-heart","far fa-laugh","far fa-laugh-beam","far fa-laugh-squint","far fa-laugh-wink","far fa-lemon","far fa-life-ring","far fa-lightbulb","far fa-list-alt","far fa-map","far fa-meh","far fa-meh-blank","far fa-meh-rolling-eyes","far fa-minus-square","far fa-money-bill-alt","far fa-moon","far fa-newspaper","far fa-object-group","far fa-object-ungroup","far fa-paper-plane","far fa-pause-circle","far fa-play-circle","far fa-plus-square","far fa-question-circle","far fa-registered","far fa-sad-cry","far fa-sad-tear","far fa-save","far fa-share-square","far fa-smile","far fa-smile-beam","far fa-smile-wink","far fa-snowflake","far fa-square","far fa-star","far fa-star-half","far fa-sticky-note","far fa-stop-circle","far fa-sun","far fa-surprise","far fa-thumbs-down","far fa-thumbs-up","far fa-times-circle","far fa-tired","far fa-trash-alt","far fa-user","far fa-user-circle","far fa-window-close","far fa-window-maximize","far fa-window-minimize","far fa-window-restore"]},actionSelect:function(e){this.trigger("select",e.value)},getIconDataList:function(){var i=[];return this.iconList.forEach(function(e,t){t%12==0&&i.push([]),i[i.length-1].push(e)},this),i},processQuickSearch:function(i){var a;i?(a=this.$el.find(".icons"),this.iconList.forEach(function(e){var t=this.itemCache[e];t||(t=a.find('> .icon-container[data-name="'+e+'"]'),this.itemCache[e]=t),~e.indexOf(i)?t.removeClass("hidden"):t.addClass("hidden")}.bind(this))):this.$el.find(".icon-container").removeClass("hidden")}})}),define("views/admin/entity-manager/modals/select-formula",["views/modal"],function(e){return e.extend({templateContent:`
            <div class="no-side-margin">
                <table class="table table-bordered table-panel">
                    {{#each typeList}}
                    <tr>
                        <td style="width: 40%">
                            <a
                                class="btn btn-default btn-lg btn-full-wide"
                                href="#Admin/entityManager/formula&scope={{../scope}}&type={{this}}"
                            >
                            {{translate this category='fields' scope='EntityManager'}}
                            </a>
                        </td>
                        <td style="width: 60%">
                            <div class="complex-text">{{complexText (translate this category='messages' scope='EntityManager')}}
                        </td>
                    </tr>
                    {{/each}}
                </table>
            </div>
        `,backdrop:!0,data:function(){return{typeList:this.typeList,scope:this.scope}},setup:function(){this.scope=this.options.scope,this.typeList=["beforeSaveCustomScript","beforeSaveApiScript"],this.headerText=this.translate("Formula","labels","EntityManager")}})}),define("views/admin/entity-manager/fields/icon-class",["views/fields/base"],function(e){return e.extend({editTemplate:"admin/entity-manager/fields/icon-class/edit",setup:function(){e.prototype.setup.call(this),this.events['click [data-action="selectIcon"]']=function(){this.selectIcon()}},selectIcon:function(){this.createView("dialog","views/admin/entity-manager/modals/select-icon",{},t=>{t.render(),this.listenToOnce(t,"select",e=>{this.model.set(this.name,e=""===e?null:e),t.close()})})},fetch:function(){let e={};return e[this.name]=this.model.get(this.name),e}})}),define("views/admin/entity-manager/fields/duplicate-check-field-list",["exports","views/fields/multi-enum"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{fieldTypeList=["varchar","personName","email","phone","url","barcode"];setupOptions(){let t=this.model.get("name"),e=this.getFieldManager().getEntityTypeFieldList(t,{typeList:this.fieldTypeList,onlyAvailable:!0}).sort((e,t)=>this.getLanguage().translate(e,"fields",this.entityType).localeCompare(this.getLanguage().translate(t,"fields",this.entityType)));this.translatedOptions={},e.forEach(e=>{this.translatedOptions[e]=this.translate(e,"fields",t)}),this.params.options=e}}e.default=a}),define("views/admin/dynamic-logic/modals/edit",["views/modal"],function(e){return e.extend({template:"admin/dynamic-logic/modals/edit",className:"dialog dialog-record",data:function(){return{}},events:{},buttonList:[{name:"apply",label:"Apply",style:"primary"},{name:"cancel",label:"Cancel"}],setup:function(){this.conditionGroup=Espo.Utils.cloneDeep(this.options.conditionGroup||[]),this.scope=this.options.scope,this.createView("conditionGroup","views/admin/dynamic-logic/conditions/and",{selector:".top-group-container",itemData:{value:this.conditionGroup},scope:this.options.scope})},actionApply:function(){var e=this.getView("conditionGroup").fetch().value;this.trigger("apply",e),this.close()}})}),define("views/admin/dynamic-logic/modals/add-field",["views/modal","model"],function(e,i){return e.extend({templateContent:'<div class="field" data-name="field">{{{field}}}</div>',events:{'click a[data-action="addField"]':function(e){this.trigger("add-field",$(e.currentTarget).data().name)}},setup:function(){this.header=this.translate("Add Field"),this.scope=this.options.scope;var t=new i;this.createView("field","views/admin/dynamic-logic/fields/field",{selector:'[data-name="field"]',model:t,mode:"edit",scope:this.scope,defs:{name:"field",params:{}}},function(e){this.listenTo(e,"change",function(){var e=t.get("field")||[];e.length&&this.trigger("add-field",e[0])},this)})}})}),define("views/admin/dynamic-logic/fields/field",["views/fields/multi-enum","ui/multi-select"],function(e,t){return e.extend({getFieldList:function(){let i=this.getMetadata().get("entityDefs."+this.options.scope+".fields"),e=Object.keys(i).filter(e=>{var t=i[e].type||null;if(!i[e].disabled&&!i[e].utility&&t&&this.getMetadata().get(["clientDefs","DynamicLogic","fieldTypes",t]))return!0});return e.push("id"),e.sort((e,t)=>this.translate(e,"fields",this.options.scope).localeCompare(this.translate(t,"fields",this.options.scope))),e},setupTranslatedOptions:function(){this.translatedOptions={},this.params.options.forEach(e=>{this.translatedOptions[e]=this.translate(e,"fields",this.options.scope)})},setupOptions:function(){e.prototype.setupOptions.call(this),this.params.options=this.getFieldList(),this.setupTranslatedOptions()},afterRender:function(){e.prototype.afterRender.call(this),this.$element&&t.focus(this.$element)}})}),define("views/admin/dynamic-logic/conditions-string/item-value-varchar",["views/admin/dynamic-logic/conditions-string/item-base"],function(e){return e.extend({template:"admin/dynamic-logic/conditions-string/item-base",createValueFieldView:function(){var e=this.getValueViewKey();this.createView("value","views/fields/varchar",{model:this.model,name:this.field,selector:'[data-view-key="'+e+'"]'})}})}),define("views/admin/dynamic-logic/conditions-string/item-value-link",["views/admin/dynamic-logic/conditions-string/item-base"],function(e){return e.extend({template:"admin/dynamic-logic/conditions-string/item-base",createValueFieldView:function(){var e=this.getValueViewKey();this.createView("value","views/fields/link",{model:this.model,name:"link",selector:'[data-view-key="'+e+'"]',foreignScope:this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"entity"])||this.getMetadata().get(["entityDefs",this.scope,"links",this.field,"entity"])})}})}),define("views/admin/dynamic-logic/conditions-string/item-value-enum",["views/admin/dynamic-logic/conditions-string/item-base"],function(e){return e.extend({template:"admin/dynamic-logic/conditions-string/item-base",createValueFieldView:function(){var e=this.getValueViewKey();this.createView("value","views/fields/enum",{model:this.model,name:this.field,selector:'[data-view-key="'+e+'"]',params:{options:this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"options"])||[]}})}})}),define("views/admin/dynamic-logic/conditions-string/item-multiple-values-base",["views/admin/dynamic-logic/conditions-string/item-base"],function(e){return e.extend({template:"admin/dynamic-logic/conditions-string/item-multiple-values-base",data:function(){return{valueViewDataList:this.valueViewDataList,scope:this.scope,operator:this.operator,operatorString:this.operatorString,field:this.field}},populateValues:function(){},getValueViewKey:function(e){return"view-"+this.level.toString()+"-"+this.number.toString()+"-"+e.toString()},createValueFieldView:function(){var a=this.itemData.value||[],e=this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"type"])||"base",s=this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"view"])||this.getFieldManager().getViewName(e);this.valueViewDataList=[],a.forEach(function(e,t){var i=this.model.clone(),e=(i.set(this.itemData.attribute,e),this.getValueViewKey(t));this.valueViewDataList.push({key:e,isEnd:t===a.length-1}),this.createView(e,s,{model:i,name:this.field,selector:'[data-view-key="'+e+'"]'})},this)}})}),define("views/admin/dynamic-logic/conditions-string/item-is-today",["views/admin/dynamic-logic/conditions-string/item-operator-only-date"],function(e){return e.extend({dateValue:"today"})}),define("views/admin/dynamic-logic/conditions-string/item-in-past",["views/admin/dynamic-logic/conditions-string/item-operator-only-date"],function(e){return e.extend({dateValue:"past"})}),define("views/admin/dynamic-logic/conditions-string/item-in-future",["views/admin/dynamic-logic/conditions-string/item-operator-only-date"],function(e){return e.extend({dateValue:"future"})}),define("views/admin/dynamic-logic/conditions-string/group-not",["views/admin/dynamic-logic/conditions-string/group-base"],function(e){return e.extend({template:"admin/dynamic-logic/conditions-string/group-not",data:function(){return{viewKey:this.viewKey,operator:this.operator}},setup:function(){this.level=this.options.level||0,this.number=this.options.number||0,this.scope=this.options.scope,this.operator=this.options.operator||this.operator,this.itemData=this.options.itemData||{},this.viewList=[];var e="view-"+this.level.toString()+"-"+this.number.toString()+"-"+0..toString();this.createItemView(0,e,this.itemData.value),this.viewKey=e}})}),define("views/admin/dynamic-logic/conditions/or",["views/admin/dynamic-logic/conditions/group-base"],function(e){return e.extend({operator:"or"})}),define("views/admin/dynamic-logic/conditions/not",["views/admin/dynamic-logic/conditions/group-base"],function(e){return e.extend({template:"admin/dynamic-logic/conditions/not",operator:"not",data:function(){return{viewKey:this.viewKey,operator:this.operator,hasItem:this.hasView(this.viewKey),level:this.level,groupOperator:this.getGroupOperator()}},setup:function(){this.level=this.options.level||0,this.number=this.options.number||0,this.scope=this.options.scope,this.itemData=this.options.itemData||{},this.viewList=[];var e=this.getKey();this.createItemView(0,e,this.itemData.value),this.viewKey=e},removeItem:function(){var e=this.getKey();this.clearView(e),this.controlAddItemVisibility()},getKey:function(){return"view-"+this.level.toString()+"-"+this.number.toString()+"-"+0..toString()},getIndexForNewItem:function(){return 0},addItemContainer:function(){},addViewDataListItem:function(){},fetch:function(){var e=this.getView(this.viewKey);if(!e)return{type:"and",value:[]};e=e.fetch();return{type:this.operator,value:e}},controlAddItemVisibility:function(){this.getView(this.getKey())?this.$el.find(" > .group-bottom").addClass("hidden"):this.$el.find(" > .group-bottom").removeClass("hidden")}})}),define("views/admin/dynamic-logic/conditions/and",["views/admin/dynamic-logic/conditions/group-base"],function(e){return e.extend({operator:"and"})}),define("views/admin/dynamic-logic/conditions/field-types/multi-enum",["views/admin/dynamic-logic/conditions/field-types/base"],function(t){return t.extend({fetch:function(){var e=this.getView("value"),t={type:this.type,attribute:this.field};return e&&(e.fetchToModel(),t.value=this.model.get(this.field)),t},getValueViewName:function(){var e=t.prototype.getValueViewName.call(this);return e=~["has","notHas"].indexOf(this.type)?"views/fields/enum":e}})}),define("views/admin/dynamic-logic/conditions/field-types/link",["views/admin/dynamic-logic/conditions/field-types/base"],function(e){return e.extend({fetch:function(){var e=this.getView("value"),t={type:this.type,attribute:this.field+"Id",data:{field:this.field}};return e&&(e.fetchToModel(),t.value=this.model.get(this.field+"Id"),(e={})[this.field+"Name"]=this.model.get(this.field+"Name"),t.data.values=e),t}})}),define("views/admin/dynamic-logic/conditions/field-types/link-parent",["views/admin/dynamic-logic/conditions/field-types/base"],function(e){return e.extend({fetch:function(){var e,t=this.getView("value");return t&&t.fetchToModel(),"equals"===this.type||"notEquals"===this.type?((e={})[this.field+"Id"]=t.model.get(this.field+"Id"),e[this.field+"Name"]=t.model.get(this.field+"Name"),e[this.field+"Type"]=t.model.get(this.field+"Type"),"equals"===this.type?{type:"and",value:[{type:"equals",attribute:this.field+"Id",value:t.model.get(this.field+"Id")},{type:"equals",attribute:this.field+"Type",value:t.model.get(this.field+"Type")}],data:{field:this.field,type:"equals",values:e}}:{type:"or",value:[{type:"notEquals",attribute:this.field+"Id",value:t.model.get(this.field+"Id")},{type:"notEquals",attribute:this.field+"Type",value:t.model.get(this.field+"Type")}],data:{field:this.field,type:"notEquals",values:e}}):{type:this.type,attribute:this.field+"Id",data:{field:this.field}}}})}),define("views/admin/dynamic-logic/conditions/field-types/link-multiple",["views/admin/dynamic-logic/conditions/field-types/base"],function(e){return e.extend({getValueFieldName:function(){return this.name},getValueViewName:function(){return"views/fields/link"},createValueViewContains:function(){this.createLinkValueField()},createValueViewNotContains:function(){this.createLinkValueField()},createLinkValueField:function(){this.createView("value","views/fields/link",{model:this.model,name:"link",selector:".value-container",mode:"edit",readOnlyDisabled:!0,foreignScope:this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"entity"])||this.getMetadata().get(["entityDefs",this.scope,"links",this.field,"entity"])},function(e){this.isRendered()&&e.render()},this)},fetch:function(){var e=this.getView("value"),t={type:this.type,attribute:this.field+"Ids",data:{field:this.field}};return e&&(e.fetchToModel(),t.value=this.model.get("linkId"),(e={}).linkName=this.model.get("linkName"),e.linkId=this.model.get("linkId"),t.data.values=e),t}})}),define("views/admin/dynamic-logic/conditions/field-types/enum",["views/admin/dynamic-logic/conditions/field-types/base"],function(t){return t.extend({fetch:function(){var e=this.getView("value"),t={type:this.type,attribute:this.field};return e&&(e.fetchToModel(),t.value=this.model.get(this.field)),t},getValueViewName:function(){var e=t.prototype.getValueViewName.call(this);return e=~["in","notIn"].indexOf(this.type)?"views/fields/multi-enum":e}})}),define("views/admin/dynamic-logic/conditions/field-types/date",["views/admin/dynamic-logic/conditions/field-types/base"],function(e){return e.extend({})}),define("views/admin/complex-expression/modals/add-function",["views/modal","model"],function(e,t){return e.extend({template:"admin/formula/modals/add-function",fitHeight:!0,backdrop:!0,events:{'click [data-action="add"]':function(e){this.trigger("add",$(e.currentTarget).data("value"))}},data:function(){var e=this.translate("formulaFunctions","messages","Admin").replace("{documentationUrl}",this.documentationUrl),e=this.getHelper().transformMarkdownText(e,{linksInNewTab:!0}).toString();return{functionDataList:this.functionDataList,text:e}},setup:function(){this.header=this.translate("Function"),this.documentationUrl="https://docs.espocrm.com/user-guide/complex-expressions/",this.functionDataList=this.options.functionDataList||this.getMetadata().get("app.complexExpression.functionList")||[]}})}),define("views/admin/authentication/fields/test-connection",["views/fields/base"],function(e){return e.extend({templateContent:`
            <button
                class="btn btn-default"
                data-action="testConnection"
            >{{translate 'Test Connection' scope='Settings'}}</button>
        `,events:{'click [data-action="testConnection"]':function(){this.testConnection()}},fetch:function(){return{}},getConnectionData:function(){return{host:this.model.get("ldapHost"),port:this.model.get("ldapPort"),useSsl:this.model.get("ldapSecurity"),useStartTls:this.model.get("ldapSecurity"),username:this.model.get("ldapUsername"),password:this.model.get("ldapPassword"),bindRequiresDn:this.model.get("ldapBindRequiresDn"),accountDomainName:this.model.get("ldapAccountDomainName"),accountDomainNameShort:this.model.get("ldapAccountDomainNameShort"),accountCanonicalForm:this.model.get("ldapAccountCanonicalForm")}},testConnection:function(){var e=this.getConnectionData();this.$el.find("button").prop("disabled",!0),this.notify("Connecting",null,null,"Settings"),Espo.Ajax.postRequest("Ldap/action/testConnection",e).then(()=>{this.$el.find("button").prop("disabled",!1),Espo.Ui.success(this.translate("ldapTestConnection","messages","Settings"))}).catch(e=>{let t=e.getResponseHeader("X-Status-Reason")||"",i=(t=(t=t.replace(/ $/,"")).replace(/,$/,""),this.translate("Error")+" "+e.status);t&&(i+=": "+t),Espo.Ui.error(i,!0),console.error(i),e.errorIsHandled=!0,this.$el.find("button").prop("disabled",!1)})}})}),define("views/admin/auth-token/list",["views/list"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.menu.buttons=[]},getHeader:function(){return'<a href="#Admin">'+this.translate("Administration")+'</a> <span class="chevron-right"></span> '+this.getLanguage().translate("Auth Tokens","labels","Admin")},updatePageTitle:function(){this.setPageTitle(this.getLanguage().translate("Auth Tokens","labels","Admin"))}})}),define("views/admin/auth-token/record/list",["views/record/list"],function(e){return e.extend({rowActionsView:"views/admin/auth-token/record/row-actions/default",massActionList:["remove","setInactive"],checkAllResultMassActionList:["remove","setInactive"],massActionSetInactive:function(){let e=null;this.allResultIsChecked||(e=this.checkedList);Espo.Ajax.postRequest("MassAction",{action:"update",entityType:this.entityType,params:{ids:e||null,where:e&&0!==e.length?null:this.collection.getWhere(),searchParams:e&&0!==e.length?null:this.collection.data},data:{isActive:!1}}).then(()=>{this.collection.fetch().then(()=>{Espo.Ui.success(this.translate("Done")),e&&e.forEach(e=>{this.checkRecord(e)})})})},actionSetInactive:function(e){!e.id||(e=this.collection.get(e.id))&&(Espo.Ui.notify(this.translate("pleaseWait","messages")),e.save({isActive:!1},{patch:!0}).then(()=>{Espo.Ui.notify(!1)}))}})}),define("views/admin/auth-token/record/detail",["views/record/detail"],function(e){return e.extend({sideDisabled:!0,readOnly:!0})}),define("views/admin/auth-token/record/detail-small",["views/record/detail-small"],function(e){return e.extend({sideDisabled:!0,isWide:!0,bottomView:"views/record/detail-bottom"})}),define("views/admin/auth-token/record/row-actions/default",["views/record/row-actions/default"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.listenTo(this.model,"change:isActive",()=>{setTimeout(()=>{this.reRender()},10)})},getActionList:function(){var e=[];return e.push({action:"quickView",label:"View",data:{id:this.model.id}}),this.model.get("isActive")&&e.push({action:"setInactive",label:"Set Inactive",data:{id:this.model.id}}),e.push({action:"quickRemove",label:"Remove",data:{id:this.model.id}}),e}})}),define("views/admin/auth-token/modals/detail",["views/modals/detail"],function(e){return e.extend({sideDisabled:!0,editDisabled:!0})}),define("views/admin/auth-log-record/list",["views/list"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this)},getHeader:function(){return this.buildHeaderHtml([$("<a>").attr("href","#Admin").text(this.translate("Administration")),$("<span>").text(this.getLanguage().translate("Auth Log","labels","Admin"))])},updatePageTitle:function(){this.setPageTitle(this.getLanguage().translate("Auth Log","labels","Admin"))}})}),define("views/admin/auth-log-record/record/list",["views/record/list"],function(e){return e.extend({rowActionsView:"views/record/row-actions/view-and-remove",massActionList:["remove"],checkAllResultMassActionList:["remove"]})}),define("views/admin/auth-log-record/record/detail",["views/record/detail"],function(e){return e.extend({sideDisabled:!0,readOnly:!0})}),define("views/admin/auth-log-record/record/detail-small",["views/record/detail-small"],function(e){return e.extend({sideDisabled:!0,isWide:!0,bottomView:"views/record/detail-bottom"})}),define("views/admin/auth-log-record/modals/detail",["views/modals/detail"],function(e){return e.extend({sideDisabled:!0,editDisabled:!0})}),define("controllers/role",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkAccess(e){return!!this.getUser().isAdmin()}}e.default=a}),define("controllers/portal-role",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkAccess(e){return!!this.getUser().isAdmin()}}e.default=a}),define("controllers/layout-set",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{actionEditLayouts(e){var t=e.id;if(!t)throw new Error("ID not passed.");this.main("views/layout-set/layouts",{layoutSetId:t,scope:e.scope,type:e.type})}}e.default=a}),define("controllers/inbound-email",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkAccess(e){return!!this.getUser().isAdmin()}}e.default=a}),define("controllers/api-user",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class a extends(t=(i=t)&&i.__esModule?i:{default:i}).default{entityType="User";getCollection(e){return super.getCollection().then(e=>(e.data.userType="api",e))}createViewView(e,t,i){if(!t.isApi())return t.isPortal()?void this.getRouter().dispatch("PortalUser","view",{id:t.id,model:t}):void this.getRouter().dispatch("User","view",{id:t.id,model:t});super.createViewView(e,t,i)}actionCreate(e){(e=e||{}).attributes=e.attributes||{},e.attributes.type="api",super.actionCreate(e)}}e.default=a}),define("controllers/admin",["exports","controller","search-manager","views/settings/edit","views/admin/index"],function(e,t,i,s,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=n(t),i=n(i),s=n(s),a=n(a);class o extends t.default{checkAccessGlobal(){return!!this.getUser().isAdmin()}actionPage(e){let a=e.page;if(e.options&&delete(e={...Espo.Utils.parseUrlOptionsParam(e.options),...e}).options,!a)throw new Error;var t="action"+Espo.Utils.upperCaseFirst(a);if(this[t])this[t](e);else{let i=this.getPageDefs(a);if(!i)throw new Espo.Exceptions.NotFound;if(i.view)this.main(i.view,e);else{if(!i.recordView)throw new Espo.Exceptions.NotFound;let t=this.getSettingsModel();t.fetch().then(()=>{t.id="1";var e=new s.default({model:t,headerTemplate:"admin/settings/headers/page",recordView:i.recordView,page:a,label:i.label,optionsToPass:["page","label"]});this.main(e)})}}}actionIndex(e){let t=e.isReturn;var e=this.name+"Index",i=(!(t=this.getRouter().backProcessed?!0:t)&&this.getStoredMainView(e)&&this.clearStoredMainView(e),new a.default);this.main(i,null,e=>{e.render(),this.listenTo(e,"clear-cache",this.clearCache),this.listenTo(e,"rebuild",this.rebuild)},{useStored:t,key:e})}actionUsers(){this.getRouter().dispatch("User","list",{fromAdmin:!0})}actionPortalUsers(){this.getRouter().dispatch("PortalUser","list",{fromAdmin:!0})}actionApiUsers(){this.getRouter().dispatch("ApiUser","list",{fromAdmin:!0})}actionTeams(){this.getRouter().dispatch("Team","list",{fromAdmin:!0})}actionRoles(){this.getRouter().dispatch("Role","list",{fromAdmin:!0})}actionPortalRoles(){this.getRouter().dispatch("PortalRole","list",{fromAdmin:!0})}actionPortals(){this.getRouter().dispatch("Portal","list",{fromAdmin:!0})}actionLeadCapture(){this.getRouter().dispatch("LeadCapture","list",{fromAdmin:!0})}actionEmailFilters(){this.getRouter().dispatch("EmailFilter","list",{fromAdmin:!0})}actionGroupEmailFolders(){this.getRouter().dispatch("GroupEmailFolder","list",{fromAdmin:!0})}actionEmailTemplates(){this.getRouter().dispatch("EmailTemplate","list",{fromAdmin:!0})}actionPdfTemplates(){this.getRouter().dispatch("Template","list",{fromAdmin:!0})}actionDashboardTemplates(){this.getRouter().dispatch("DashboardTemplate","list",{fromAdmin:!0})}actionWebhooks(){this.getRouter().dispatch("Webhook","list",{fromAdmin:!0})}actionLayoutSets(){this.getRouter().dispatch("LayoutSet","list",{fromAdmin:!0})}actionWorkingTimeCalendar(){this.getRouter().dispatch("WorkingTimeCalendar","list",{fromAdmin:!0})}actionAttachments(){this.getRouter().dispatch("Attachment","list",{fromAdmin:!0})}actionAuthenticationProviders(){this.getRouter().dispatch("AuthenticationProvider","list",{fromAdmin:!0})}actionEmailAddresses(){this.getRouter().dispatch("EmailAddress","list",{fromAdmin:!0})}actionPhoneNumbers(){this.getRouter().dispatch("PhoneNumber","list",{fromAdmin:!0})}actionPersonalEmailAccounts(){this.getRouter().dispatch("EmailAccount","list",{fromAdmin:!0})}actionGroupEmailAccounts(){this.getRouter().dispatch("InboundEmail","list",{fromAdmin:!0})}actionActionHistory(){this.getRouter().dispatch("ActionHistoryRecord","list",{fromAdmin:!0})}actionImport(){this.getRouter().dispatch("Import","index",{fromAdmin:!0})}actionLayouts(e){var t=e.scope||null,i=e.type||null,e=e.em||!1;this.main("views/admin/layouts/index",{scope:t,type:i,em:e})}actionLabelManager(e){var t=e.scope||null,e=e.language||null;this.main("views/admin/label-manager/index",{scope:t,language:e})}actionTemplateManager(e){e=e.name||null;this.main("views/admin/template-manager/index",{name:e})}actionFieldManager(e){var t=e.scope||null,e=e.field||null;this.main("views/admin/field-manager/index",{scope:t,field:e})}actionEntityManager(e){var t=e.scope||null;t&&e.edit?this.main("views/admin/entity-manager/edit",{scope:t}):e.create?this.main("views/admin/entity-manager/edit"):t&&e.formula?this.main("views/admin/entity-manager/formula",{scope:t,type:e.type}):t?this.main("views/admin/entity-manager/scope",{scope:t}):this.main("views/admin/entity-manager/index")}actionLinkManager(e){e=e.scope||null;this.main("views/admin/link-manager/index",{scope:e})}actionSystemRequirements(){this.main("views/admin/system-requirements/index")}getSettingsModel(){let e=this.getConfig().clone();return e.defs=this.getConfig().defs,this.listenTo(e,"after:save",()=>{this.getConfig().load(),this._broadcastChannel.postMessage("update:config")}),e}actionAuthTokens(){this.collectionFactory.create("AuthToken",e=>{const t=new i.default(e,"list",this.getStorage(),this.getDateTime());t.loadStored(),e.where=t.getWhere(),e.maxSize=this.getConfig().get("recordsPerPage")||e.maxSize,this.main("views/admin/auth-token/list",{scope:"AuthToken",collection:e,searchManager:t})})}actionAuthLog(){this.collectionFactory.create("AuthLogRecord",e=>{const t=new i.default(e,"list",this.getStorage(),this.getDateTime());t.loadStored(),e.where=t.getWhere(),e.maxSize=this.getConfig().get("recordsPerPage")||e.maxSize,this.main("views/admin/auth-log-record/list",{scope:"AuthLogRecord",collection:e,searchManager:t})})}actionJobs(){this.collectionFactory.create("Job",e=>{const t=new i.default(e,"list",this.getStorage(),this.getDateTime());t.loadStored(),e.where=t.getWhere(),e.maxSize=this.getConfig().get("recordsPerPage")||e.maxSize,this.main("views/admin/job/list",{scope:"Job",collection:e,searchManager:t})})}actionIntegrations(e){e=e.name||null;this.main("views/admin/integrations/index",{integration:e})}actionExtensions(){this.main("views/admin/extensions/index")}rebuild(){if(!this.rebuildRunning){this.rebuildRunning=!0;let t=this.get("master");Espo.Ui.notify(t.translate("pleaseWait","messages")),Espo.Ajax.postRequest("Admin/rebuild").then(()=>{var e=t.translate("Rebuild has been done","labels","Admin");Espo.Ui.success(e),this.rebuildRunning=!1}).catch(()=>{this.rebuildRunning=!1})}}clearCache(){if(!this.clearCacheRunning){this.clearCacheRunning=!0;const t=this.get("master");Espo.Ui.notify(t.translate("pleaseWait","messages")),Espo.Ajax.postRequest("Admin/clearCache").then(()=>{var e=t.translate("Cache has been cleared","labels","Admin");Espo.Ui.success(e),this.clearCacheRunning=!1}).catch(()=>{this.clearCacheRunning=!1})}}getPageDefs(e){var t,i,a=this.getMetadata().get(["app","adminPanel"])||{};let s=null;for(t in a){for(i of a[t].itemList||[])if(i.url==="#Admin/"+e){s=i;break}if(s)break}return s}}e.default=o});
//# sourceMappingURL=espo-admin.js.map