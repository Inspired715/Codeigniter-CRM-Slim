/*! espocrm 2023-09-18 */
define("view",["exports","bullbone"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends t.View{addActionHandler(e,t){this.events[`click [data-action="${e}"]`]=e=>{t.call(this,e.originalEvent,e.currentTarget)}}escapeString(e){return Handlebars.Utils.escapeExpression(e)}notify(e,t,i,s){e?(s=s||null,i=t?i||2e3:void 0,e=this.getLanguage().translate(e,"labels",s),Espo.Ui.notify(e,t,i)):Espo.Ui.notify(!1)}getHelper(){return this._helper}getUser(){return this._helper.user}getPreferences(){return this._helper.preferences}getConfig(){return this._helper.settings}getAcl(){return this._helper.acl}getModelFactory(){return this._helper.modelFactory}getCollectionFactory(){return this._helper.collectionFactory}getRouter(){return this._helper.router}getStorage(){return this._helper.storage}getSessionStorage(){return this._helper.sessionStorage}getLanguage(){return this._helper.language}getMetadata(){return this._helper.metadata}getCache(){return this._helper.cache}getDateTime(){return this._helper.dateTime}getNumberUtil(){return this._helper.numberUtil}getFieldManager(){return this._helper.fieldManager}getBaseController(){return this._helper.baseController}getThemeManager(){return this._helper.themeManager}updatePageTitle(){var e=this.getConfig().get("applicationName")||"EspoCRM";this.setPageTitle(e)}setPageTitle(e){this.getHelper().pageTitle.setTitle(e)}translate(e,t,i){return this.getLanguage().translate(e,t,i)}getBasePath(){return this._helper.basePath||""}ajaxRequest(e,t,i,s){return Espo.Ajax.request(e,t,i,s)}ajaxPostRequest(e,t,i){return Espo.Ajax.postRequest(e,t,i)}ajaxGetRequest(e,t,i){return Espo.Ajax.getRequest(e,t,i)}confirm(e,t,i){let s;"string"==typeof e||e instanceof String?(s=e,e={}):(e=e||{},s=e.message),s=s&&this.getHelper().transformMarkdownText(s,{linksInNewTab:!0}).toString();var a=e.confirmText||this.translate("Yes"),l=e.confirmStyle||null,r=e.cancelText||this.translate("Cancel");return Espo.Ui.confirm(s,{confirmText:a,cancelText:r,confirmStyle:l,backdrop:!("backdrop"in e)||e.backdrop,isHtml:!0},t,i)}}e.default=i}),define("ui/select",["exports","lib!selectize"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=(i=t)&&i.__esModule?i:{default:i};const n={init:function(e,t){let i=$(e),s=(t=n.applyDefaultOptions(t||{}),[]),a=(n.loadEspoSelectPlugin(),s.push("espo_select"),{}),l=i.children().toArray().map(e=>{var t=e.getAttributeNode("value").value;return e.classList&&(a[t]=e.classList.toString()),t}),r=null;e=i.closest(".modal-body");e.length&&(r=e);let o={sortField:[{field:t.sortBy,direction:t.sortDirection}],load:t.load,loadThrottle:1,plugins:s,highlight:!1,selectOnTab:t.selectOnTab,copyClassesToDropdown:!1,allowEmptyOption:l.includes(""),showEmptyOptionInDropdown:!0,$relativeParent:r,render:{item:function(e){return $("<div>").addClass("item").addClass(a[e.value]||"").text(e.text).get(0).outerHTML},option:function(e){let t=$("<div>").addClass("option").addClass(""===e.value?"selectize-dropdown-emptyoptionlabel":"").addClass(a[e.value]||"").val(e.value).text(e.text);return""===e.text&&t.html("&nbsp;"),t.get(0).outerHTML}},onDelete:function(e){for(;e.length;)this.removeItem(e.pop(),!0);this.showInput(),this.positionDropdown(),this.refreshOptions(!0)}};if(t.matchAnyWord||(o.score=function(t){let i=this.getScoreFunction(t);return t=t.toLowerCase(),function(e){return 0===e.text.toLowerCase().indexOf(t)?i(e):0}}),t.matchAnyWord&&(o.score=function(i){let s=this.getScoreFunction(i);return i=i.toLowerCase(),function(e){let t=e.text.toLowerCase();return t.split(" ").find(e=>e.startsWith(i))||t.startsWith(i)?s(e):0}}),t.score){let i=t.score;o.score=function(t){return function(e){return i(t,e)}}}i.selectize(o)},focus:function(t,i){t=$(t);if(i=i||{},t[0]&&t[0].selectize){let e=t[0].selectize;i.noTrigger&&(e.focusNoTrigger=!0),e.focus(),i.noTrigger&&setTimeout(()=>e.focusNoTrigger=!1,100)}},setOptions:function(e,t){let i=$(e),s=i.get(0).selectize;s.clearOptions(!0),s.load(e=>{e(t.map(e=>({value:e.value,text:e.text||e.label})))})},setValue:function(e,t){let i=e.get(0).selectize;i.setValue(t,!0)},destroy:function(e){e.length&&e[0].selectize&&e[0].selectize.destroy()},applyDefaultOptions:function(e){e=Espo.Utils.clone(e);var t,i={selectOnTab:!1,matchAnyWord:!1,sortBy:"$order",sortDirection:"asc"};for(t in i)t in e||(e[t]=i[t]);return e},loadEspoSelectPlugin:function(){if(!("espo_select"in t.default.plugins)){const s=/Mac/.test(navigator.userAgent);t.default.define("espo_select",function(){let n=this;this.setup=function(){let e=n.setup;return function(){e.apply(this,arguments),n.selectedValue=n.items[0],n.$dropdown.on("mouseup","[data-selectable]",function(){return $(document).off("mouseup.select"),n.onOptionSelect.apply(n,arguments)}),n.$dropdown.on("mousedown","[data-selectable]",function(){$(document).one("mouseup.select",function(){n.focusOnControlSilently()})}),n.$control_input.css({width:"4px"})}}(),this.focusOnControlSilently=function(){n.preventReOpenOnFocus=!0,n.$control_input[0].focus(),n.preventReOpenOnFocus=!1},this.refreshOptions=function(){let e=n.refreshOptions;return function(){n.focusNoTrigger?e.apply(this,[!1]):e.apply(this,arguments)}}(),this.blur=function(){let e=n.blur;return function(){n.preventClose||e.apply(this,arguments)}}(),this.close=function(){let e=n.close;return function(){n.preventClose||e.apply(this,arguments)}}(),this.onOptionSelect=function(){let t=n.onOptionSelect;return function(e){if("mousedown"===e.type||"click"===e.type)return n.preventClose=!0,void setTimeout(()=>n.preventClose=!1,100);n.preventClose=!1,"mouseup"===e.type&&setTimeout(()=>n.focusOnControlSilently(),50),t.apply(this,arguments),n.selectedValue=$(e.currentTarget).attr("data-value")}}(),this.open=function(){let t=n.open;return function(){var e=!(n.isLocked||n.isOpen);if(t.apply(this,arguments),e){let t=n.$dropdown.children().first(),i=t.find(".selected");if(i.length){let e=i.get(0).offsetTop-t.get(0).clientHeight;e=0<=e?e:0,t.find(".selectize-dropdown-content").scrollTop(e)}}}}(),this.onMouseDown=function(){let t=n.onMouseDown;return function(e){if(n.isOpen||n.isInputHidden||!n.$control_input.val())return n.isOpen&&(n.closedByMouseDown=!0),t.apply(this,arguments)}}(),this.onFocus=function(){let t=n.onFocus;return function(e){if(!n.preventReOpenOnFocus){if(!n.closedByMouseDown)return n.closedByMouseDown=!1,t.apply(this,arguments);n.closedByMouseDown=!1}}}(),this.restoreSelectedValue=function(){this.preventRevertLoop||(this.preventRevertLoop=!0,setTimeout(()=>this.preventRevertLoop=!1,10),this.setValue(this.selectedValue,!0))},this.onBlur=function(){let e=n.onBlur;return function(){if(!n.preventClose)return n.restoreSelectedValue(),n.$control_input.css({width:"4px"}),e.apply(this,arguments)}}(),this.onKeyDown=function(){let i=n.onKeyDown;return function(e){var t;if(s?!e.metaKey:!e.ctrlKey)return"Escape"===e.code&&(!n.isOpen&&n.isInputHidden||e.stopPropagation(),n.isOpen&&n.close(),n.isInputHidden||n.hideInput(),n.addItem(this.selectedValue,!0)),(n.isFull()||n.isInputHidden)&&1===e.key.length&&(e.code.match(/Key[A-Z]/i)||e.key.match(/[0-9]/)||RegExp(/^\p{L}/,"u").test(e.key))&&(t=e.keyCode,e.keyCode=8,n.deleteSelection(e),e.keyCode=t,n.$control_input.width(15)),i.apply(this,arguments);n.items.length||(n.restoreSelectedValue(),n.focus())}}(),this.positionDropdown=function(){const o={top:"top",bottom:"bottom"};return function(){let e=n.$control,t="body"===this.settings.dropdownParent?e.offset():e.position();t.top+=e.outerHeight(!0);var i=n.$dropdown.prop("scrollHeight")+5,s=n.$control.get(0).getBoundingClientRect().top,a=n.$wrapper.height(),l=n.$control.get(0).getBoundingClientRect().bottom,r=this.settings.$relativeParent?this.settings.$relativeParent.get(0).getBoundingClientRect().top:0,s=s+i+a>window.innerHeight&&r<=l-i-a?o.top:o.bottom,r={width:e.outerWidth(),left:t.left};s===o.top?(Object.assign(r,{bottom:t.top,top:"unset",margin:"0 0 0 0"}),n.$dropdown.addClass("selectize-position-top")):(Object.assign(r,{top:t.top,bottom:"unset",margin:"0 0 0 0"}),n.$dropdown.removeClass("selectize-position-top")),n.$dropdown.css(r)}}()})}}};var i=n;e.default=i}),define("view-record-helper",["exports","bullbone"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i{constructor(e,t){this.defaultFieldStates=e||{},this.defaultPanelStates=t||{},this.fieldStateMap={},this.panelStateMap={},this.hiddenFields={},this.hiddenPanels={},this.fieldOptionListMap={}}getHiddenFields(){return this.hiddenFields}getHiddenPanels(){return this.hiddenPanels}setFieldStateParam(e,t,i){"hidden"===t&&(i?this.hiddenFields[e]=!0:delete this.hiddenFields[e]),this.fieldStateMap[e]=this.fieldStateMap[e]||{},this.fieldStateMap[e][t]=i}getFieldStateParam(e,t){return e in this.fieldStateMap&&t in this.fieldStateMap[e]?this.fieldStateMap[e][t]:t in this.defaultFieldStates?this.defaultFieldStates[t]:null}setPanelStateParam(e,t,i){"hidden"===t&&(i?this.hiddenPanels[e]=!0:delete this.hiddenPanels[e]),this.panelStateMap[e]=this.panelStateMap[e]||{},this.panelStateMap[e][t]=i}getPanelStateParam(e,t){return e in this.panelStateMap&&t in this.panelStateMap[e]?this.panelStateMap[e][t]:t in this.defaultPanelStates?this.defaultPanelStates[t]:null}setFieldOptionList(e,t){this.fieldOptionListMap[e]=t}clearFieldOptionList(e){delete this.fieldOptionListMap[e]}getFieldOptionList(e){return this.fieldOptionListMap[e]||null}hasFieldOptionList(e){return e in this.fieldOptionListMap}}Object.assign(i.prototype,t.Events),e.default=i}),define("dynamic-logic",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t){this.defs=e||{},this.recordView=t,this.fieldTypeList=["visible","required","readOnly"],this.panelTypeList=["visible","styled"]}process(){let t=this.defs.fields||{};Object.keys(t).forEach(s=>{var e=t[s]||{};this.fieldTypeList.forEach(t=>{if(t in e&&e[t]){var i=e[t]||{};if(i.conditionGroup){i=this.checkConditionGroup(i.conditionGroup);let e;this[e=i?"makeField"+Espo.Utils.upperCaseFirst(t)+"True":"makeField"+Espo.Utils.upperCaseFirst(t)+"False"](s)}}})});var e=this.defs.panels||{};Object.keys(e).forEach(t=>{this.panelTypeList.forEach(e=>{this.processPanel(t,e)})});let a=this.defs.options||{};Object.keys(a).forEach(t=>{var i=a[t];if(a[t]){let e=!1;for(var s in i){s=i[s];if(this.checkConditionGroup(s.conditionGroup)){this.setOptionList(t,s.optionList||[]),e=!0;break}}e||this.resetOptionList(t)}})}processPanel(t,i){var s=(this.defs.panels||{})[t]||{};if(i in s){s=s[i]||{};if(s.conditionGroup){s=this.checkConditionGroup(s.conditionGroup);let e;this[e=s?"makePanel"+Espo.Utils.upperCaseFirst(i)+"True":"makePanel"+Espo.Utils.upperCaseFirst(i)+"False"](t)}}}checkConditionGroup(e,t){let i,s=!1;if("and"===(t=t||"and")){for(var a in i=e||[],s=!0,i)if(!this.checkCondition(i[a])){s=!1;break}}else if("or"===t){for(var l in i=e||[])if(this.checkCondition(i[l])){s=!0;break}}else"not"===t&&e&&(s=!this.checkCondition(e));return s}checkCondition(t){var e=(t=t||{}).type||"equals";if(["or","and","not"].includes(e))return this.checkConditionGroup(t.value,e);var i=t.attribute;let s=t.value;if(!i)return!1;t=this.recordView.model.get(i);if("equals"===e)return!!s&&t===s;if("notEquals"===e)return!!s&&t!==s;if("isEmpty"===e)return Array.isArray(t)?!t.length:null===t||""===t||void 0===t;if("isNotEmpty"===e)return Array.isArray(t)?!!t.length:null!==t&&""!==t&&void 0!==t;if("isTrue"===e)return!!t;if("isFalse"===e)return!t;if("contains"===e||"has"===e)return!!t&&!!~t.indexOf(s);if("notContains"===e||"notHas"===e)return!t||!~t.indexOf(s);if("startsWith"===e)return!!t&&0===t.indexOf(s);if("endsWith"===e)return!!t&&t.indexOf(s)===t.length-s.length;if("matches"===e){if(!t)return!1;i=/^\/(.*)\/([a-z]*)$/.exec(s);return!i||i.length<2?!1:new RegExp(i[1],i[2]).test(t)}if("greaterThan"===e)return t>s;if("lessThan"===e)return t<s;if("greaterThanOrEquals"===e)return t>=s;if("lessThanOrEquals"===e)return t<=s;if("in"===e)return!!~s.indexOf(t);if("notIn"===e)return!~s.indexOf(t);if("isToday"===e){let e=this.recordView.getDateTime();return t?(10<t.length?e.toMoment(t):e.toMomentDate(t)).isSame(e.getNowMoment(),"day"):!1}if("inFuture"===e){let e=this.recordView.getDateTime();return t?(10<t.length?e.toMoment(t):e.toMomentDate(t)).isAfter(e.getNowMoment(),"day"):!1}if("inPast"!==e)return!1;{let e=this.recordView.getDateTime();return t?(10<t.length?e.toMoment(t):e.toMomentDate(t)).isBefore(e.getNowMoment(),"day"):!1}}setOptionList(e,t){this.recordView.setFieldOptionList(e,t)}resetOptionList(e){this.recordView.resetFieldOptionList(e)}makeFieldVisibleTrue(e){this.recordView.showField(e)}makeFieldVisibleFalse(e){this.recordView.hideField(e)}makeFieldRequiredTrue(e){this.recordView.setFieldRequired(e)}makeFieldRequiredFalse(e){this.recordView.setFieldNotRequired(e)}makeFieldReadOnlyTrue(e){this.recordView.setFieldReadOnly(e)}makeFieldReadOnlyFalse(e){this.recordView.setFieldNotReadOnly(e)}makePanelVisibleTrue(e){this.recordView.showPanel(e,"dynamicLogic")}makePanelVisibleFalse(e){this.recordView.hidePanel(e,!1,"dynamicLogic")}makePanelStyledTrue(e){this.recordView.stylePanel(e)}makePanelStyledFalse(e){this.recordView.unstylePanel(e)}addPanelVisibleCondition(e,t){this.defs.panels=this.defs.panels||{},this.defs.panels[e]=this.defs.panels[e]||{},this.defs.panels[e].visible=t,this.processPanel(e,"visible")}addPanelStyledCondition(e,t){this.defs.panels=this.defs.panels||{},this.defs.panels[e]=this.defs.panels[e]||{},this.defs.panels[e].styled=t,this.processPanel(e,"styled")}}}),define("views/fields/base",["exports","view","ui/select","jquery"],function(e,t,i,l){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i),l=s(l);class a extends t.default{constructor(e){super(e),this.name=e.name,this.labelText=e.labelText}type="base";listTemplate="fields/base/list";listLinkTemplate="fields/base/list-link";detailTemplate="fields/base/detail";editTemplate="fields/base/edit";searchTemplate="fields/base/search";listTemplateContent;detailTemplateContent;editTemplateContent;validations=["required"];MODE_LIST="list";MODE_LIST_LINK="listLink";MODE_DETAIL="detail";MODE_EDIT="edit";MODE_SEARCH="search";name;defs=null;params=null;mode="detail";searchParams=null;_timeout=null;inlineEditDisabled=!1;disabled=!1;readOnly=!1;labelText;attributeList=null;initialAttributes=null;VALIDATION_POPOVER_TIMEOUT=3e3;validateCallback;validationElementSelector;recordHelper;$label=null;$element=null;initialSearchIsNotIdle=!1;entityType=null;lastValidationMessage=null;dataObject;isRequired(){return this.params.required}get$cell(){return this.$el.parent()}getCellElement(){return this.get$cell()}isInlineEditMode(){return!!this._isInlineEditMode}setDisabled(e){this.disabled=!0,e&&(this.disabledLocked=!0)}setNotDisabled(){this.disabledLocked||(this.disabled=!1)}setRequired(){this.params.required=!0,this.isEditMode()&&(this.isRendered()?this.showRequiredSign():this.once("after:render",()=>{this.showRequiredSign()}))}setNotRequired(){this.params.required=!1,this.get$cell().removeClass("has-error"),this.isEditMode()&&(this.isRendered()?this.hideRequiredSign():this.once("after:render",()=>{this.hideRequiredSign()}))}setReadOnly(e){return this.readOnlyLocked?Promise.reject():(this.readOnly=!0,e&&(this.readOnlyLocked=!0),this.isEditMode()?this.isInlineEditMode()?this.inlineEditClose():this.setDetailMode().then(()=>this.reRender()):Promise.resolve())}setNotReadOnly(){this.readOnlyLocked||(this.readOnly=!1)}getLabelElement(){return this.$label&&this.$label.get(0)&&!document.contains(this.$label.get(0))&&(this.$label=void 0),this.$label&&this.$label.length||(this.$label=this.$el.parent().children("label")),this.$label}hide(){this.$el.addClass("hidden");let e=this.get$cell();e.children("label").addClass("hidden"),e.addClass("hidden-cell")}show(){this.$el.removeClass("hidden");let e=this.get$cell();e.children("label").removeClass("hidden"),e.removeClass("hidden-cell")}data(){let e={scope:this.model.entityType||this.model.name,name:this.name,defs:this.defs,params:this.params,value:this.getValueForDisplay()};return this.isSearchMode()&&(e.searchParams=this.searchParams,e.searchData=this.searchData,e.searchValues=this.getSearchValues(),e.searchType=this.getSearchType(),e.searchTypeList=this.getSearchTypeList()),e}getValueForDisplay(){return this.model.get(this.name)}isReadMode(){return this.mode===this.MODE_LIST||this.mode===this.MODE_DETAIL||this.mode===this.MODE_LIST_LINK}isListMode(){return this.mode===this.MODE_LIST||this.mode===this.MODE_LIST_LINK}isDetailMode(){return this.mode===this.MODE_DETAIL}isEditMode(){return this.mode===this.MODE_EDIT}isSearchMode(){return this.mode===this.MODE_SEARCH}setDetailMode(){return this.setMode(this.MODE_DETAIL)||Promise.resolve()}setEditMode(){return this.setMode(this.MODE_EDIT)||Promise.resolve()}setMode(e){var t=this.mode!==e&&this.mode,i=this.mode,s=(this.mode=e)+"Template",s=(s in this||(this[s]="fields/"+Espo.Utils.camelCaseToHyphen(this.type)+"/"+this.mode),this._hasTemplateContent||this.setTemplate(this[s]),e+"TemplateContent");return this._hasTemplateContent||s in this&&null!=this[s]&&this.setTemplateContent(this[s]),t?(i&&this.trigger("mode-changed"),this._onModeSet()):Promise.resolve()}prepare(){}_onModeSet(){return this.isListMode()?this.onListModeSet()||Promise.resolve():this.isDetailMode()?this.onDetailModeSet()||Promise.resolve():this.isEditMode()&&this.onEditModeSet()||Promise.resolve()}onDetailModeSet(){return this.prepare()}onEditModeSet(){return this.prepare()}onListModeSet(){return this.prepare()}init(){this.validations=Espo.Utils.clone(this.validations),this._hasTemplateContent=!!this.templateContent,this.defs=this.options.defs||{},this.name=this.options.name||this.defs.name,this.params=this.options.params||this.defs.params||{},this.validateCallback=this.options.validateCallback,this.fieldType=this.model.getFieldParam(this.name,"type")||this.type,this.entityType=this.model.entityType||this.model.name,this.recordHelper=this.options.recordHelper,this.dataObject=Espo.Utils.clone(this.options.dataObject||{}),this.labelText||(this.labelText=this.translate(this.name,"fields",this.entityType)),this.getFieldManager().getParamList(this.type).forEach(e=>{e=e.name;e in this.params||(this.params[e]=this.model.getFieldParam(this.name,e),void 0===this.params[e]&&(this.params[e]=null))});["inlineEditDisabled"].forEach(e=>{this.params[e]=this.model.getFieldParam(this.name,e)||null}),this.readOnly=this.readOnly||this.params.readOnly||this.model.getFieldParam(this.name,"readOnly")||this.model.getFieldParam(this.name,"clientReadOnly"),this.readOnlyLocked=this.options.readOnlyLocked||this.readOnly,this.inlineEditDisabled=this.options.inlineEditDisabled||this.params.inlineEditDisabled||this.inlineEditDisabled,this.readOnly=this.readOnlyLocked||this.options.readOnly||!1,this.tooltip=this.options.tooltip||this.params.tooltip||this.model.getFieldParam(this.name,"tooltip")||this.tooltip,this.options.readOnlyDisabled&&(this.readOnly=!1),this.disabledLocked=this.options.disabledLocked||!1,this.disabled=this.disabledLocked||this.options.disabled||this.disabled;let e=this.options.mode||this.mode||this.MODE_DETAIL;e===this.MODE_EDIT&&this.readOnly&&(e=this.MODE_DETAIL),this.mode=void 0,this.wait(this.setMode(e)),this.isSearchMode()&&(this.searchParams=_.clone(this.options.searchParams||{}),this.searchData={},this.setupSearch(),this.events["keydown."+this.cid]=e=>{"Control+Enter"===Espo.Utils.getKeyFromKeyEvent(e)&&this.trigger("search")}),this.on("highlight",()=>{let e=this.get$cell();e.addClass("highlighted"),e.addClass("transition"),setTimeout(()=>{e.removeClass("highlighted")},3e3),setTimeout(()=>{e.removeClass("transition")},5e3)}),this.on("invalid",()=>{let e=this.get$cell();e.addClass("has-error"),this.$el.one("click",()=>{e.removeClass("has-error")}),this.once("render",()=>{e.removeClass("has-error")})}),this.on("after:render",()=>{if(this.isEditMode())return this.hasRequiredMarker()?void this.showRequiredSign():void this.hideRequiredSign();var e;this.hasRequiredMarker()&&this.hideRequiredSign(),!this.isSearchMode()||(e=this.$el.find("select.search-type")).length&&i.default.init(e,{matchAnyWord:!0})}),(this.isDetailMode()||this.isEditMode())&&this.tooltip&&this.initTooltip(),this.isDetailMode()&&(this.inlineEditDisabled||this.listenToOnce(this,"after:render",()=>this.initInlineEdit())),this.isSearchMode()||(this.attributeList=this.getAttributeList(),this.listenTo(this.model,"change",(t,i)=>{if(!i.ui){let e=!1;for(var s of this.getAttributeList())if(t.hasChanged(s)){e=!0;break}if(e&&!(i.skipReRenderInEditMode&&this.isEditMode()||i.skipReRender)){let e=()=>{(this.isRendered()||this.isBeingRendered())&&(this.reRender(),i.highlight&&this.trigger("highlight"))},t=this.prepare();t?t.then(()=>e()):e()}}}),this.listenTo(this,"change",()=>{var e=this.fetch();this.model.set(e,{ui:!0})}))}setupFinal(){this.wait(this._onModeSet())}initTooltip(){let a;this.once("after:render",()=>{a=(0,l.default)("<a>").attr("role","button").attr("tabindex","-1").addClass("text-muted field-info").append((0,l.default)("<span>").addClass("fas fa-info-circle"));let e=this.getLabelElement(),t=(e.append(" "),this.getLabelElement().append(a),this.options.tooltipText||this.tooltipText);var i,s;t||"string"!=typeof this.tooltip||([i,s]=this.tooltip.includes(".")?this.tooltip.split("."):[this.entityType,this.tooltip],t=this.translate(s,"tooltips",i)),t=t||this.translate(this.name,"tooltips",this.entityType)||"",t=this.getHelper().transformMarkdownText(t,{linksInNewTab:!0}).toString(),Espo.Ui.popover(a,{placement:"bottom",content:t,preventDestroyOnRender:!0},this)})}showRequiredSign(){let e=this.getLabelElement(),t=e.find("span.required-sign");var i;e.length&&!t.length&&(i=e.find("span.label-text"),(0,l.default)('<span class="required-sign"> *</span>').insertAfter(i),t=e.find("span.required-sign")),t.show()}hideRequiredSign(){let e=this.getLabelElement(),t=e.find("span.required-sign");t.hide()}getSearchParamsData(){return this.searchParams.data||{}}getSearchValues(){return this.getSearchParamsData().values||{}}getSearchType(){return this.getSearchParamsData().type||this.searchParams.type}getSearchTypeList(){return this.searchTypeList}initInlineEdit(){let e=this.get$cell(),t=(0,l.default)("<a>").attr("role","button").addClass("pull-right inline-edit-link hidden").append((0,l.default)("<span>").addClass("fas fa-pencil-alt fa-sm"));0!==e.length?(e.prepend(t),t.on("click",()=>this.inlineEdit()),e.on("mouseenter",e=>{e.stopPropagation(),this.disabled||this.readOnly||this.isDetailMode()&&t.removeClass("hidden")}).on("mouseleave",e=>{e.stopPropagation(),this.isDetailMode()&&t.addClass("hidden")}),this.on("after:render",()=>{this.isDetailMode()||t.addClass("hidden")})):this.listenToOnce(this,"after:render",()=>this.initInlineEdit())}initElement(){this.$element=this.$el.find('[data-name="'+this.name+'"]'),this.$element.length||(this.$element=this.$el.find('[name="'+this.name+'"]')),this.$element.length||(this.$element=this.$el.find(".main-element")),this.isEditMode()&&this.$element.on("change",()=>{this.trigger("change")})}afterRender(){(this.isEditMode()||this.isSearchMode())&&this.initElement(),this.isReadMode()&&this.afterRenderRead(),this.isListMode()&&this.afterRenderList(),this.isDetailMode()&&this.afterRenderDetail(),this.isEditMode()&&this.afterRenderEdit(),this.isSearchMode()&&this.afterRenderSearch()}afterRenderRead(){}afterRenderList(){}afterRenderDetail(){}afterRenderEdit(){}afterRenderSearch(){}setup(){}setupSearch(){}getAttributeList(){return this.getFieldManager().getAttributeList(this.fieldType,this.name)}inlineEditSave(s){if(s=s||{},this.recordHelper)this.recordHelper.trigger("inline-edit-save",this.name,s);else{var a,l=this.fetch();let e=this.model,t=this.initialAttributes,i=(e.set(l,{silent:!0}),!1);for(a in l=e.attributes)_.isEqual(t[a],l[a])||((i=i||{})[a]=l[a]);if(i||this.inlineEditClose(),this.validateCallback?this.validateCallback():this.validate())return Espo.Ui.error(this.translate("Not valid")),void e.set(t,{silent:!0});Espo.Ui.notify(this.translate("saving","messages")),e.save(i,{patch:!0}).then(()=>{this.trigger("after:inline-save"),this.trigger("after:save"),e.trigger("after:save"),Espo.Ui.success(this.translate("Saved"))}).catch(()=>{Espo.Ui.error(this.translate("Error occurred")),e.set(t,{silent:!0}),this.reRender()}),s.bypassClose||this.inlineEditClose(!0)}}removeInlineEditLinks(){let e=this.get$cell();e.find(".inline-save-link").remove(),e.find(".inline-cancel-link").remove(),e.find(".inline-edit-link").addClass("hidden")}addInlineEditLinks(){let e=this.get$cell(),t=(0,l.default)("<a>").attr("role","button").attr("tabindex","-1").addClass("pull-right inline-save-link").attr("title","Ctrl+Enter").text(this.translate("Update")),i=(0,l.default)("<a>").attr("role","button").attr("tabindex","-1").addClass("pull-right inline-cancel-link").attr("title","Esc").text(this.translate("Cancel"));e.prepend(t),e.prepend(i),e.find(".inline-edit-link").addClass("hidden"),t.click(()=>{this.inlineEditSave()}),i.click(()=>{this.inlineEditClose()})}setIsInlineEditMode(e){this._isInlineEditMode=e}inlineEditClose(e){if(this.trigger("inline-edit-off",{noReset:e}),this.$el.off("keydown.inline-edit"),this._isInlineEditMode=!1,!this.isEditMode())return Promise.resolve();e||this.model.set(this.initialAttributes,{skipReRenderInEditMode:!0});var t=this.setDetailMode().then(()=>this.reRender(!0)).then(()=>this.removeInlineEditLinks());return this.trigger("after:inline-edit-off",{noReset:e}),t}inlineEdit(){this.trigger("edit",this),this.initialAttributes=this.model.getClonedAttributes(),this._isInlineEditMode=!0;var e=this.setEditMode().then(()=>this.reRender(!0)).then(()=>this.addInlineEditLinks()).then(()=>{this.$el.on("keydown.inline-edit",e=>{var t=Espo.Utils.getKeyFromKeyEvent(e);return"Control+Enter"===t?(e.stopPropagation(),this.inlineEditSave(),void setTimeout(()=>{this.get$cell().focus()},100)):"Escape"===t?(e.stopPropagation(),void this.inlineEditClose().then(()=>{this.get$cell().focus()})):void("Control+KeyS"===t&&(e.preventDefault(),e.stopPropagation(),this.inlineEditSave({bypassClose:!0})))}),setTimeout(()=>this.focusOnInlineEdit(),10)});return this.trigger("inline-edit-on"),e}focusOnInlineEdit(){let e=this.$element&&this.$element.length?this.$element:this.$el.find(".form-control").first();e&&e.first().focus()}suspendValidationMessage(e){this.validationMessageSuspended=!0,setTimeout(()=>this.validationMessageSuspended=!1,e||200)}showValidationMessage(i,s){if(!this.validationMessageSuspended){let e;if(s=s||this.validationElementSelector||".main-element",(e=(e=!(e="string"==typeof s||s instanceof String?this.$el.find(s):(0,l.default)(s)).length&&this.$element?this.$element:e).length?e:this.$el).length){s=e.get(0).getBoundingClientRect();if(this.lastValidationMessage=i,0===s.top&&0===s.bottom&&0===s.left)return}e.popover({placement:"bottom",container:"body",content:this.getHelper().transformMarkdownText(i).toString(),html:!0,trigger:"manual"}).popover("show");let t=!1;e.closest(".field").one("mousedown click",()=>{t||(e.popover("destroy"),t=!0)}),this.once("render remove",()=>{t||e&&(e.popover("destroy"),t=!0)}),this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(()=>{t||(e.popover("destroy"),t=!0)},this.VALIDATION_POPOVER_TIMEOUT)}}validate(){for(var e in this.lastValidationMessage=null,this.validations)if(this["validate"+Espo.Utils.upperCaseFirst(this.validations[e])].call(this))return this.trigger("invalid"),!0;return!1}getLabelText(){return this.labelText}validateRequired(){var e;if(this.isRequired()&&(""===this.model.get(this.name)||null===this.model.get(this.name)))return e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0}hasRequiredMarker(){return this.isRequired()}fetchToModel(){this.model.set(this.fetch(),{silent:!0})}fetch(){if(!this.$element.length)return{};let e={};return e[this.name]=this.$element.val().trim(),e}fetchSearch(){var e=this.$element.val().toString().trim();return e?{type:"equals",value:e}:null}fetchSearchType(){return this.$el.find("select.search-type").val()}}e.default=a}),define("helpers/model/defaults-populator",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t,i,s){this.user=e,this.preferences=t,this.acl=i,this.config=s}populate(e){e.populateDefaults();let t={};for(var i in this.user.isPortal()||this.prepare(e,t),this.user.isPortal()&&this.prepareForPortal(e,t),t)e.has(i)&&delete t[i];e.set(t,{silent:!0})}prepare(i,s){var a=i.hasField("assignedUsers")&&"User"===i.getLinkParam("assignedUsers","entity");if(i.hasField("assignedUser")||a){let e="assignedUser",t=(a&&(e="assignedUsers"),!0);this.preferences.get("doNotFillAssignedUserIfNotRequired")&&(t=!1,(i.getFieldParam(e,"required")||"no"===this.acl.getPermissionLevel("assignmentPermission")||"team"===this.acl.getPermissionLevel("assignmentPermission")&&!this.user.get("defaultTeamId")||this.acl.getScopeForbiddenFieldList(i.entityType,"edit").includes(e))&&(t=!0)),t&&(a?(s.assignedUsersIds=[this.user.id],s.assignedUsersNames={},s.assignedUsersNames[this.user.id]=this.user.get("name")):(s.assignedUserId=this.user.id,s.assignedUserName=this.user.get("name")))}a=this.user.get("defaultTeamId");a&&i.hasField("teams")&&!i.getFieldParam("teams","default")&&"entityTeam"===Espo.Utils.lowerCaseFirst(i.getLinkParam("teams","relationName")||"")&&(s.teamsIds=[a],s.teamsNames={},s.teamsNames[a]=this.user.get("defaultTeamName"))}prepareForPortal(e,t){if(e.hasField("account")&&["belongsTo","hasOne"].includes(e.getLinkType("account"))&&"Account"===e.getLinkParam("account","entity")&&this.user.get("accountId")&&(t.accountId=this.user.get("accountId"),t.accountName=this.user.get("accountName")),e.hasField("contact")&&["belongsTo","hasOne"].includes(e.getLinkType("contact"))&&"Contact"===e.getLinkParam("contact","entity")&&this.user.get("contactId")&&(t.contactId=this.user.get("contactId"),t.contactName=this.user.get("contactName")),e.hasField("parent")&&"belongsToParent"===e.getLinkType("parent")&&(this.config.get("b2cMode")?this.user.get("contactId")&&(e.getFieldParam("parent","entityList")||[]).includes("Contact")&&(t.contactId=this.user.get("contactId"),t.parentName=this.user.get("contactName"),t.parentType="Contact"):this.user.get("accountId")&&(e.getFieldParam("parent","entityList")||[]).includes("Account")&&(t.parentId=this.user.get("accountId"),t.parentName=this.user.get("accountName"),t.parentType="Account")),e.hasField("accounts")&&"hasMany"===e.getLinkType("accounts")&&"Account"===e.getLinkParam("accounts","entity")&&this.user.get("accountsIds")&&(t.accountsIds=this.user.get("accountsIds"),t.accountsNames=this.user.get("accountsNames")),e.hasField("contacts")&&"hasMany"===e.getLinkType("contacts")&&"Contact"===e.getLinkParam("contacts","entity")&&this.user.get("contactId")){t.contactsIds=[this.user.get("contactId")];let e={};e[this.user.get("contactId")]=this.user.get("contactName"),t.contactsNames=e}}}}),define("exceptions",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,Espo.Exceptions=Espo.Exceptions||{},Espo.Exceptions.AccessDenied=function(e){this.message=e,Error.apply(this,arguments)},Espo.Exceptions.AccessDenied.prototype=new Error,Espo.Exceptions.AccessDenied.prototype.name="AccessDenied",Espo.Exceptions.NotFound=function(e){this.message=e,Error.apply(this,arguments)},Espo.Exceptions.NotFound.prototype=new Error,Espo.Exceptions.NotFound.prototype.name="NotFound";var t=Espo.Exceptions;e.default=t}),define("views/record/base",["exports","view","view-record-helper","dynamic-logic","underscore","jquery","helpers/model/defaults-populator"],function(e,t,i,s,u,a,l){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=r(t),i=r(i),s=r(s),u=r(u),a=r(a),l=r(l);class o extends t.default{type="edit";entityType=null;scope=null;isNew=!1;dependencyDefs={};dynamicLogicDefs={};fieldList=null;mode=null;lastSaveCancelReason=null;recordHelper=null;MODE_DETAIL="detail";MODE_EDIT="edit";TYPE_DETAIL="detail";TYPE_EDIT="edit";hideField(a,e){this.recordHelper.setFieldStateParam(a,"hidden",!0),e&&this.recordHelper.setFieldStateParam(a,"hiddenLocked",!0);let t=()=>{var s=this.getFieldView(a);if(s){let e=s.$el,t=e.closest('.cell[data-name="'+a+'"]'),i=t.find('label.control-label[data-name="'+a+'"]');e.addClass("hidden"),i.addClass("hidden"),t.addClass("hidden-cell")}else this.$el.find('.cell[data-name="'+a+'"]').addClass("hidden-cell"),this.$el.find('.field[data-name="'+a+'"]').addClass("hidden"),this.$el.find('label.control-label[data-name="'+a+'"]').addClass("hidden")},i=(this.isRendered()?t():this.once("after:render",()=>{t()}),this.getFieldView(a));i&&i.setDisabled(e)}showField(a){if(!this.recordHelper.getFieldStateParam(a,"hiddenLocked")){this.recordHelper.setFieldStateParam(a,"hidden",!1);let e=()=>{var s=this.getFieldView(a);if(s){let e=s.$el,t=e.closest('.cell[data-name="'+a+'"]'),i=t.find('label.control-label[data-name="'+a+'"]');return e.removeClass("hidden"),i.removeClass("hidden"),void t.removeClass("hidden-cell")}this.$el.find('.cell[data-name="'+a+'"]').removeClass("hidden-cell"),this.$el.find('.field[data-name="'+a+'"]').removeClass("hidden"),this.$el.find('label.control-label[data-name="'+a+'"]').removeClass("hidden")},t=(this.isRendered()?e():this.once("after:render",()=>{e()}),this.getFieldView(a));t&&(t.disabledLocked||t.setNotDisabled())}}setFieldReadOnly(e,t){var i=this.recordHelper.getFieldStateParam(e,"readOnly");this.recordHelper.setFieldStateParam(e,"readOnly",!0),t&&this.recordHelper.setFieldStateParam(e,"readOnlyLocked",!0);let s=this.getFieldView(e);s&&s.setReadOnly(t),i||this.trigger("set-field-read-only",e)}setFieldNotReadOnly(e){var t=this.recordHelper.getFieldStateParam(e,"readOnly");this.recordHelper.setFieldStateParam(e,"readOnly",!1);let i=this.getFieldView(e);i&&i.readOnly&&(i.setNotReadOnly(),this.mode===this.MODE_EDIT&&!i.readOnlyLocked&&i.isDetailMode()&&i.setEditMode().then(()=>i.reRender())),t&&this.trigger("set-field-not-read-only",e)}setFieldRequired(e){var t=this.recordHelper.getFieldStateParam(e,"required");this.recordHelper.setFieldStateParam(e,"required",!0);let i=this.getFieldView(e);i&&i.setRequired(),t||this.trigger("set-field-required",e)}setFieldNotRequired(e){var t=this.recordHelper.getFieldStateParam(e,"required");this.recordHelper.setFieldStateParam(e,"required",!1);let i=this.getFieldView(e);i&&i.setNotRequired(),t&&this.trigger("set-field-not-required",e)}setFieldOptionList(e,t){var i=this.recordHelper.hasFieldOptionList(e),s=this.recordHelper.getFieldOptionList(e);this.recordHelper.setFieldOptionList(e,t);let a=this.getFieldView(e);a&&"setOptionList"in a&&a.setOptionList(t),i&&(0,u.default)(s).isEqual(t)||this.trigger("set-field-option-list",e,t)}resetFieldOptionList(e){var t=this.recordHelper.hasFieldOptionList(e);this.recordHelper.clearFieldOptionList(e);let i=this.getFieldView(e);i&&"resetOptionList"in i&&i.resetOptionList(),t&&this.trigger("reset-field-option-list",e)}showPanel(e,t){this.recordHelper.setPanelStateParam(e,"hidden",!1),this.isRendered()&&this.$el.find('.panel[data-name="'+e+'"]').removeClass("hidden")}hidePanel(e,t,i){this.recordHelper.setPanelStateParam(e,"hidden",!0),this.isRendered()&&this.$el.find('.panel[data-name="'+e+'"]').addClass("hidden")}stylePanel(s){this.recordHelper.setPanelStateParam(s,"styled",!0);let e=()=>{let e=this.$el.find('.panel[data-name="'+s+'"]'),t=e.find("> .panel-heading .btn");var i=e.attr("data-style");i&&(e.removeClass("panel-default"),e.addClass("panel-"+i),t.removeClass("btn-default"),t.addClass("btn-"+i))};this.isRendered()?e():this.once("after:render",()=>{e()})}unstylePanel(s){this.recordHelper.setPanelStateParam(s,"styled",!1);let e=()=>{let e=this.$el.find('.panel[data-name="'+s+'"]'),t=e.find("> .panel-heading .btn");var i=e.attr("data-style");i&&(e.removeClass("panel-"+i),e.addClass("panel-default"),t.removeClass("btn-"+i),t.addClass("btn-default"))};this.isRendered()?e():this.once("after:render",()=>{e()})}setConfirmLeaveOut(e){this.getRouter()&&(this.getRouter().confirmLeaveOut=e)}getFieldViews(e){let i={};return this.fieldList.forEach(e=>{var t=this.getFieldView(e);t&&(i[e]=t)}),i}getFields(){return this.getFieldViews()}getFieldView(e){let t=this.getView(e+"Field")||null;return t=t||(this.getView(e)||null)}getField(e){return this.getFieldView(e)}getFieldList(){return Object.keys(this.getFieldViews())}getFieldViewList(){return this.getFieldList().map(e=>this.getFieldView(e)).filter(e=>null!==e)}data(){return{scope:this.scope,entityType:this.entityType,hiddenPanels:this.recordHelper.getHiddenPanels(),hiddenFields:this.recordHelper.getHiddenFields()}}handleDataBeforeRender(t){this.getFieldList().forEach(e=>{t[e]=t[e+"Field"]})}setup(){if(void 0===this.model)throw new Error("Model has not been injected into record view.");this.recordHelper=new i.default,this.dynamicLogicDefs=this.options.dynamicLogicDefs||this.dynamicLogicDefs,this.on("remove",()=>{this.isChanged&&this.resetModelChanges(),this.setIsNotChanged()}),this.entityType=this.model.entityType||this.model.name||"Common",this.scope=this.options.scope||this.entityType,this.fieldList=this.options.fieldList||this.fieldList||[],this.numId=Math.floor(1e4*Math.random()+1),this.id=Espo.Utils.toDom(this.entityType)+"-"+Espo.Utils.toDom(this.type)+"-"+this.numId,this.model.isNew()&&(this.isNew=!0),this.setupBeforeFinal()}setupBeforeFinal(){this.attributes=this.model.getClonedAttributes(),this.listenTo(this.model,"change",(e,t)=>{if(t.sync)for(var i in e.attributes)e.hasChanged(i)&&(this.attributes[i]=Espo.Utils.cloneDeep(e.get(i)));else this.mode===this.MODE_EDIT&&this.setIsChanged()}),this.options.attributes&&this.model.set(this.options.attributes),this.listenTo(this.model,"sync",()=>{this.attributes=this.model.getClonedAttributes()}),this.initDependency(),this.initDynamicLogic()}setInitialAttributeValue(e,t){this.attributes[e]=t}checkAttributeIsChanged(e){return!u.default.isEqual(this.attributes[e],this.model.get(e))}resetModelChanges(){for(var e in this.updatedAttributes&&(this.attributes=this.updatedAttributes,this.updatedAttributes=null),this.model.attributes)e in this.attributes||this.model.unset(e);this.model.set(this.attributes,{skipReRender:!0})}setModelAttributes(e,t){for(var i in this.model.attributes)i in e||this.model.unset(i);this.model.set(e,t||{})}initDynamicLogic(){this.dynamicLogicDefs=Espo.Utils.clone(this.dynamicLogicDefs||{}),this.dynamicLogicDefs.fields=Espo.Utils.clone(this.dynamicLogicDefs.fields),this.dynamicLogicDefs.panels=Espo.Utils.clone(this.dynamicLogicDefs.panels),this.dynamicLogic=new s.default(this.dynamicLogicDefs,this),this.listenTo(this.model,"change",()=>this.processDynamicLogic()),this.processDynamicLogic()}processDynamicLogic(){this.dynamicLogic.process()}initDependency(){Object.keys(this.dependencyDefs||{}).forEach(e=>{this.listenTo(this.model,"change:"+e,()=>{this._handleDependencyAttribute(e)})}),this._handleDependencyAttributes()}initDependancy(){this.initDependency()}setupFieldLevelSecurity(){let e=this.getAcl().getScopeForbiddenFieldList(this.entityType,"read"),t=(e.forEach(e=>{this.hideField(e,!0)}),this.getAcl().getScopeForbiddenFieldList(this.entityType,"edit"));t.forEach(e=>{this.setFieldReadOnly(e,!0)})}setIsChanged(){this.isChanged=!0}setIsNotChanged(){this.isChanged=!1}validate(){let t=[];return this.getFieldList().forEach(e=>{this.validateField(e)&&t.push(e)}),t.length&&this.onInvalid(t),!!t.length}onInvalid(e){}validateField(t){let i=this.getFieldView(t);if(!i)return!1;let e=!1;var s;return(e=i.isEditMode()&&!i.disabled&&!i.readOnly&&i.validate()||e)?(!i.$el||0===(s=i.$el.get(0).getBoundingClientRect()).top&&0===s.bottom&&0===s.left&&i.$el.closest(".panel.hidden").length&&setTimeout(()=>{var e=this.translate("Not valid")+": "+(i.lastValidationMessage||this.translate(t,"fields",this.entityType));Espo.Ui.error(e,!0)},10),!0):(this.dynamicLogic&&this.dynamicLogicDefs&&this.dynamicLogicDefs.fields&&this.dynamicLogicDefs.fields[t]&&this.dynamicLogicDefs.fields[t].invalid&&this.dynamicLogicDefs.fields[t].invalid.conditionGroup&&(s=this.dynamicLogicDefs.fields[t].invalid.conditionGroup,s=this.dynamicLogic.checkConditionGroup(s),e=s||e,s&&(s=this.translate("fieldInvalid","messages").replace("{field}",this.translate(t,"fields",this.entityType)),i.showValidationMessage(s),i.trigger("invalid"))),e)}afterSave(){this.isNew?Espo.Ui.success(this.translate("Created")):Espo.Ui.success(this.translate("Saved")),this.setIsNotChanged()}beforeBeforeSave(){}beforeSave(){Espo.Ui.notify(this.translate("saving","messages"))}afterSaveError(){}afterNotModified(){Espo.Ui.warning(this.translate("notModified","messages")),this.setIsNotChanged()}afterNotValid(){Espo.Ui.error(this.translate("Not valid"))}save(s){let e=(s=s||{}).headers||{},a=this.model;this.lastSaveCancelReason=null,this.beforeBeforeSave();var t=this.fetch();let l=this.attributes,r=this.model.getClonedAttributes();var i=u.default.extend(Espo.Utils.cloneDeep(r),t);let o={};if(a.isNew()&&(o=i),!a.isNew()){for(var n in i)u.default.isEqual(l[n],i[n])||(o[n]=i[n]);var d,h=this.forcePatchAttributeDependencyMap||{};for(d in h)if(!(d in o)&&d in t){let e=h[d];!!e.find(e=>e in o)&&(o[d]=i[d])}}if(0===Object.keys(o).length)return s.skipNotModifiedWarning||this.afterNotModified(),this.lastSaveCancelReason="notModified",this.trigger("cancel:save",{reason:"notModified"}),Promise.reject("notModified");if(a.set(o,{silent:!0}),this.validate())return a.attributes=r,this.afterNotValid(),this.lastSaveCancelReason="invalid",this.trigger("cancel:save",{reason:"invalid"}),Promise.reject("invalid");s.afterValidate&&s.afterValidate(),this.getMetadata().get(["entityDefs",this.entityType,"optimisticConcurrencyControl"])&&null!==this.model.get("versionNumber")&&(e["X-Version-Number"]=this.model.get("versionNumber")),this.model.isNew()&&this.options.duplicateSourceId&&(e["X-Duplicate-Source-Id"]=this.options.duplicateSourceId),this.beforeSave(),this.trigger("before:save"),a.trigger("before:save");let c=(e,t,i)=>{this.handleSaveError(e,s,i).then(e=>{e||t("error")}),this.afterSaveError(),this.setModelAttributes(r),this.lastSaveCancelReason="error",this.trigger("error:save"),this.trigger("cancel:save",{reason:"error"})};return new Promise((t,i)=>{a.save(o,{patch:!a.isNew(),headers:e}).then(()=>{this.trigger("save",l),this.afterSave(),this.isNew&&(this.isNew=!1),this.trigger("after:save"),a.trigger("after:save"),t()}).catch(e=>{c(e,i,t)})})}handleSaveError(t,s,a){let l=null;if(~[409,500].indexOf(t.status)){let e=t.getResponseHeader("X-Status-Reason");if(!e)return Promise.resolve(!1);try{l=JSON.parse(e)}catch(e){}if(!l&&(l={reason:e.toString()},t.responseText)){let e;try{e=JSON.parse(t.responseText)}catch(e){return console.error("Could not parse error response body."),Promise.resolve(!1)}l.data=e}}if(!l||!l.reason)return Promise.resolve(!1);let r=l.reason,o=this.getMetadata().get(["clientDefs",this.scope,"saveErrorHandlers",r])||this.getMetadata().get(["clientDefs","Global","saveErrorHandlers",r]);return new Promise(i=>{return o?(Espo.loader.require(o,e=>{let t=new e(this);t.process(l.data,s),i(!1)}),void(t.errorIsHandled=!0)):(e="errorHandler"+Espo.Utils.upperCaseFirst(r))in this?(t.errorIsHandled=!0,e=this[e](l.data,s,a),void i(e||!1)):void i(!1);var e})}fetch(){let t={};var i,s=this.getFieldViews();for(i in s){let e=s[i];e.isEditMode()&&(e.disabled||e.readOnly||!e.isFullyRendered()||(t={...t,...e.fetch()}))}return t}processFetch(){var e=this.fetch();return this.model.set(e),this.validate()?null:e}populateDefaults(){const e=new l.default(this.getUser(),this.getPreferences(),this.getAcl(),this.getConfig());e.populate(this.model)}errorHandlerDuplicate(e){}_handleDependencyAttributes(){Object.keys(this.dependencyDefs||{}).forEach(e=>{this._handleDependencyAttribute(e)})}_handleDependencyAttribute(e){let t=this.dependencyDefs[e];e=this.model.get(e);e in(t.map||{})?(t.map[e]||[]).forEach(e=>{this._doDependencyAction(e)}):"default"in t&&(t.default||[]).forEach(e=>{this._doDependencyAction(e)})}_doDependencyAction(i){var s=i.action;if("dependencyAction"+Espo.Utils.upperCaseFirst(s)in this&&"function"==typeof this.methodName)this.methodName(i);else{let e=i.fieldList||i.fields||[],t=i.panelList||i.panels||[];switch(s){case"hide":t.forEach(e=>{this.hidePanel(e)}),e.forEach(e=>{this.hideField(e)});break;case"show":t.forEach(e=>{this.showPanel(e)}),e.forEach(e=>{this.showField(e)});break;case"setRequired":e.forEach(e=>{this.setFieldRequired(e)});break;case"setNotRequired":e.forEach(e=>{this.setFieldNotRequired(e)});break;case"setReadOnly":e.forEach(e=>{this.setFieldReadOnly(e)});break;case"setNotReadOnly":e.forEach(e=>{this.setFieldNotReadOnly(e)})}}}createField(e,t,i,s,a,l){let r={model:this.model,mode:s||"edit",selector:'.field[data-name="'+e+'"]',defs:{name:e,params:i||{}}};if(a&&(r.readOnly=!0),(t=t||this.model.getFieldParam(e,"view"))||(s=this.model.getFieldType(e)||"base",t=this.getFieldManager().getViewName(s)),l)for(var o in l)r[o]=l[o];this.recordHelper.getFieldStateParam(e,"hidden")&&(r.disabled=!0),this.recordHelper.getFieldStateParam(e,"readOnly")&&(r.readOnly=!0),null!==this.recordHelper.getFieldStateParam(e,"required")&&(r.defs.params.required=this.recordHelper.getFieldStateParam(e,"required")),this.recordHelper.hasFieldOptionList(e)&&(r.customOptionList=this.recordHelper.getFieldOptionList(e)),this.createView(e+"Field",t,r),~this.fieldList.indexOf(e)||this.fieldList.push(e)}getFocusedFieldView(){let e=(0,a.default)(window.document.activeElement);if(!e.length)return null;let t=e.closest(".field");if(!t.length)return null;var i=t.attr("data-name");return i?this.getFieldView(i):null}exit(e){}}e.default=o}),define("views/fields/int",["exports","views/fields/base","autonumeric"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{type="int";listTemplate="fields/int/list";detailTemplate="fields/int/detail";editTemplate="fields/int/edit";searchTemplate="fields/int/search";validations=["required","int","range"];thousandSeparator=",";searchTypeList=["isNotEmpty","isEmpty","equals","notEquals","greaterThan","lessThan","greaterThanOrEquals","lessThanOrEquals","between"];autoNumericOptions=null;autoNumericInstance=null;setup(){super.setup(),this.setupMaxLength(),this.getPreferences().has("thousandSeparator")?this.thousandSeparator=this.getPreferences().get("thousandSeparator"):this.getConfig().has("thousandSeparator")&&(this.thousandSeparator=this.getConfig().get("thousandSeparator")),this.params.disableFormatting&&(this.disableFormatting=!0)}setupFinal(){super.setupFinal(),this.setupAutoNumericOptions()}setupAutoNumericOptions(){var e=(this.disableFormatting?null:this.thousandSeparator)||"";let t="."===e?",":".";this.autoNumericOptions={digitGroupSeparator:e,decimalCharacter:t,modifyValueOnWheel:!1,decimalPlaces:0,selectOnFocus:!1,formulaMode:!0}}afterRender(){if(super.afterRender(),this.mode===this.MODE_EDIT&&this.autoNumericOptions&&(this.autoNumericInstance=new i.default(this.$element.get(0),this.autoNumericOptions)),this.mode===this.MODE_SEARCH){let e=this.$el.find("select.search-type"),t=(this.handleSearchType(e.val()),this.$el.find("select.search-type").on("change",()=>{this.trigger("change")}),this.$element.on("input",()=>{this.trigger("change")}),this.$el.find("input.additional"));t.on("input",()=>{this.trigger("change")}),this.autoNumericOptions&&(new i.default(this.$element.get(0),this.autoNumericOptions),new i.default(t.get(0),this.autoNumericOptions))}}data(){let e=super.data();return null!==this.model.get(this.name)&&void 0!==this.model.get(this.name)&&(e.isNotEmpty=!0),e.valueIsSet=this.model.has(this.name),this.isSearchMode()&&(e.value=this.searchParams.value,"between"===this.getSearchType()&&(e.value=this.getSearchParamsData().value1||this.searchParams.value1,e.value2=this.getSearchParamsData().value2||this.searchParams.value2)),this.isEditMode()&&(e.value=this.model.get(this.name)),e}getValueForDisplay(){var e=isNaN(this.model.get(this.name))?null:this.model.get(this.name);return this.formatNumber(e)}formatNumber(e){return this.disableFormatting?e:this.formatNumberDetail(e)}formatNumberDetail(e){if(null===e)return"";let t=e.toString();return t=t.replace(/\B(?=(\d{3})+(?!\d))/g,this.thousandSeparator)}setupSearch(){this.events["change select.search-type"]=e=>{this.handleSearchType($(e.currentTarget).val())}}handleSearchType(e){var t=this.$el.find("input.additional"),i=this.$el.find('input[data-name="'+this.name+'"]');"between"===e?(t.removeClass("hidden"),i.removeClass("hidden")):~["isEmpty","isNotEmpty"].indexOf(e)?(t.addClass("hidden"),i.addClass("hidden")):(t.addClass("hidden"),i.removeClass("hidden"))}getMaxValue(){var e=this.model.getFieldParam(this.name,"max")||null;return e||0===e||(e=null),e="max"in this.params?this.params.max:e}getMinValue(){var e=this.model.getFieldParam(this.name,"min");return e||0===e||(e=null),e="min"in this.params?this.params.min:e}setupMaxLength(){var e=this.getMaxValue();"undefined"!=typeof max&&null!==max&&(e=this.formatNumber(e),this.params.maxLength=e.toString().length)}validateInt(){var e=this.model.get(this.name);if(isNaN(e))return e=this.translate("fieldShouldBeInt","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0}validateRange(){var e=this.model.get(this.name);if(null===e)return!1;var t,i=this.getMinValue(),s=this.getMaxValue();if(null!==i&&null!==s){if(e<i||s<e)return t=this.translate("fieldShouldBeBetween","messages").replace("{field}",this.getLabelText()).replace("{min}",i).replace("{max}",s),this.showValidationMessage(t),!0}else if(null!==i){if(e<i)return t=this.translate("fieldShouldBeGreater","messages").replace("{field}",this.getLabelText()).replace("{value}",i),this.showValidationMessage(t),!0}else if(null!==s)if(s<e)return i=this.translate("fieldShouldBeLess","messages").replace("{field}",this.getLabelText()).replace("{value}",s),this.showValidationMessage(i),!0}validateRequired(){if(this.isRequired()){var e=this.model.get(this.name);if(null===e||!1===e)return e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0}}parse(e){return null===(e=""!==e?e:null)?null:-1!==(e=e.split(this.thousandSeparator).join("")).indexOf(".")||-1!==e.indexOf(",")?NaN:parseInt(e)}fetch(){var e=this.$element.val(),e=this.parse(e);let t={};return t[this.name]=e,t}fetchSearch(){var e=this.parse(this.$element.val()),t=this.fetchSearchType();let i;if(isNaN(e))return!1;if("between"===t){var s=this.parse(this.$el.find("input.additional").val());if(isNaN(s))return!1;i={type:t,value:[e,s],data:{value1:e,value2:s}}}else i="isEmpty"===t?{type:"isNull",typeFront:"isEmpty"}:"isNotEmpty"===t?{type:"isNotNull",typeFront:"isNotEmpty"}:{type:t,value:e,data:{value1:e}};return i}getSearchType(){return this.searchParams.typeFront||this.searchParams.type}}e.default=a}),define("helpers/record-modal",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t){this.metadata=e,this.acl=t}showDetail(t,e){var i=e.id,s=e.scope,a=e.model;if(!i||!s)return console.error("Bad data."),Promise.reject();if(a&&!this.acl.checkScope(a.entityType,"read"))return Promise.reject();var l=this.metadata.get(["clientDefs",s,"modalViews","detail"])||"views/modals/detail",s=(Espo.Ui.notify(" ... "),{scope:s,model:a,id:i,quickEditDisabled:e.editDisabled,rootUrl:e.rootUrl});return t.createView("modal",l,s,e=>{e.render().then(()=>Espo.Ui.notify(!1)),t.listenToOnce(e,"remove",()=>{t.clearView("modal")})})}}}),define("helpers/action-item-setup",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t,i,s){this.metadata=e,this.viewHelper=t,this.acl=i,this.language=s}setup(a,e,i,l,t,r,s){s=s||{};let o=[],n=a.scope||a.model.entityType;if(!n)throw new Error;let d=[...this.metadata.get(["clientDefs","Global",e+"ActionList"])||[],...this.metadata.get(["clientDefs",n,e+"ActionList"])||[]];if(d.forEach(s=>{"string"==typeof s&&(s={name:s});var e=(s=Espo.Utils.cloneDeep(s)).name;s.label||(s.html=this.language.translate(e,"actions",n)),s.data=s.data||{};let t=s.handler||s.data.handler;t&&!s.data.handler&&(s.data.handler=t),l(s),Espo.Utils.checkActionAvailability(this.viewHelper,s)&&(Espo.Utils.checkActionAccess(this.acl,a.model,s,!0)||(s.hidden=!0),o.push(s),t&&(s.initFunction||s.checkVisibilityFunction)&&i(new Promise(i=>{Espo.loader.require(t,e=>{let t=new e(a);s.initFunction&&t[s.initFunction].call(t),s.checkVisibilityFunction&&!t[s.checkVisibilityFunction].call(t)&&r(s.name),s.handlerInstance=t,i()})})))}),o.length){let e=()=>{o.forEach(e=>{if(e.handlerInstance&&e.checkVisibilityFunction&&!e.handlerInstance[e.checkVisibilityFunction].call(e.handlerInstance))return void r(e.name);(Espo.Utils.checkActionAccess(this.acl,a.model,e,!0)?t:r)(e.name)})};s.listenToViewModelSync?a.listenTo(a,"model-sync",()=>e()):a.listenTo(a.model,"sync",()=>e())}}}}),define("utils",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;const i=/Mac/.test(navigator.userAgent),s=(Espo.Utils={handleAction:function(i,s,e,t){t=t||{};const a=$(e);var l=t.action||a.data("action");const r=a.data("name")||l;if(r&&t.actionItems&&(!t.className||e.classList.contains(t.className))){const o=t.actionItems.find(e=>e.name===r||e.action===r);if(o&&o.onClick)return o.onClick(),!0}if(!l)return!1;if(s.ctrlKey||s.metaKey||s.shiftKey){e=a.attr("href");if(e&&"javascript:"!==e)return!1}const o=a.data(),n="action"+Espo.Utils.upperCaseFirst(l);e=t.handler||o.handler;let d=!1;return e?(s.preventDefault(),s.stopPropagation(),d=!0,Espo.loader.require(e,e=>{let t=new e(i);t[n].call(t,o,s)})):"function"==typeof i[n]&&(i[n].call(i,o,s),s.preventDefault(),s.stopPropagation(),d=!0),!!d&&(this._processAfterActionDropdown(a),!0)},_processAfterActionDropdown:function(e){let i=e.closest(".dropdown-menu");if(i.length){let t=i.parent().find('[data-toggle="dropdown"]');if(t.length){let e=!1;t.attr("disabled")&&(e=!0,t.removeAttr("disabled").removeClass("disabled")),t.dropdown("toggle"),t.focus(),e&&t.attr("disabled","disabled").addClass("disabled")}}},checkActionAvailability:function(e,s){let a=e.config;if(s.configCheck){let e=s.configCheck,t=!1,i=("!"===e.substring(0,1)&&(t=!0,e=e.substring(1)),a.getByPath(e.split(".")));if(!(i=t?!i:i))return!1}return!0},checkActionAccess:function(e,t,i,s){let a=!0;return i.acl?a=i.aclScope?e.check(i.aclScope,i.acl):t?"string"==typeof t||t instanceof String?e.check(t,i.acl):e.checkModel(t,i.acl,s):e.check(i.scope,i.acl):i.aclScope&&(a=e.checkScope(i.aclScope)),a},checkAccessDataList:function(e,t,i,s,a){if(!e||!e.length)return!0;for(var l in e){var r=e[l];if(r.scope){if(r.action){if(!t.check(r.scope,r.action))return!1}else if(!t.checkScope(r.scope))return!1}else if(r.action&&s&&!t.check(s,r.action))return!1;if(r.teamIdList&&i&&(!a||!i.isAdmin())){var o=!1;if(i.getLinkMultipleIdList("teams").forEach(e=>{~r.teamIdList.indexOf(e)&&(o=!0)}),!o)return!1}if(r.portalIdList&&i&&(!a||!i.isAdmin())){var n=!1;if(i.getLinkMultipleIdList("portals").forEach(e=>{~r.portalIdList.indexOf(e)&&(n=!0)}),!n)return!1}if(r.isPortalOnly){if(i&&(!a||!i.isAdmin())&&!i.isPortal())return!1}else if(r.inPortalDisabled&&i&&(!a||!i.isAdmin())&&i.isPortal())return!1;if(r.isAdminOnly&&i&&!i.isAdmin())return!1}return!0},convert:function(e,t){if(null===e)return e;var i=e;switch(t){case"c-h":case"C-h":i=Espo.Utils.camelCaseToHyphen(e);break;case"h-c":i=Espo.Utils.hyphenToCamelCase(e);break;case"h-C":i=Espo.Utils.hyphenToUpperCamelCase(e)}return i},isObject:function(e){return null!==e&&"object"==typeof e},clone:function(e){return Espo.Utils.isObject(e)?_.isArray(e)?e.slice():_.extend({},e):e},cloneDeep:function(e){if(e=Espo.Utils.clone(e),Espo.Utils.isObject(e)||_.isArray(e))for(var t in e)e[t]=this.cloneDeep(e[t]);return e},composeClassName:function(e,t,i){return e?(e=this.camelCaseToHyphen(e),t=this.camelCaseToHyphen(t).split(".").join("/"),e+":"+(i=this.camelCaseToHyphen(i||""))+"/"+t):i+"/"+(t=this.camelCaseToHyphen(t).split(".").join("/"))},composeViewClassName:function(e){return e&&e[0]===e[0].toLowerCase()?e:-1!==e.indexOf(":")?(t=(i=e.split(":"))[0],i=i[1],(t=this.camelCaseToHyphen(t))+":views/"+(i=this.camelCaseToHyphen(i).split(".").join("/"))):"views/"+(e=this.camelCaseToHyphen(e).split(".").join("/"));var t,i},toDom:function(e){return Espo.Utils.convert(e,"c-h").split(".").join("-")},lowerCaseFirst:function(e){return null===e?e:e.charAt(0).toLowerCase()+e.slice(1)},upperCaseFirst:function(e){return null===e?e:e.charAt(0).toUpperCase()+e.slice(1)},hyphenToUpperCamelCase:function(e){return null===e?e:this.upperCaseFirst(e.replace(/-([a-z])/g,function(e){return e[1].toUpperCase()}))},hyphenToCamelCase:function(e){return null===e?e:e.replace(/-([a-z])/g,function(e){return e[1].toUpperCase()})},camelCaseToHyphen:function(e){return null===e?e:e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()},trimSlash:function(e){return"/"===e.slice(-1)?e.slice(0,-1):e},parseUrlOptionsParam:function(e){if(!e)return{};if(-1===e.indexOf("&")&&-1===e.indexOf("="))return{};let t={};return void 0!==e&&e.split("&").forEach(e=>{e=e.split("=");t[e[0]]=!0,1<e.length&&(t[e[0]]=e[1])}),t},getKeyFromKeyEvent:function(e){let t=e.code;return t=s[t]||t,e.shiftKey&&(t="Shift+"+t),e.altKey&&(t="Alt+"+t),t=(i?e.metaKey:e.ctrlKey)?"Control+"+t:t},generateId:function(){return Math.floor(10000001*Math.random()).toString()}},{NumpadEnter:"Enter"});Espo.utils=Espo.Utils;var t=Espo.Utils;e.default=t}),define("search-manager",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t,i,s,a,l){if(this.collection=e,this.scope=e.entityType,this.storage=i,this.type=t||"list",this.dateTime=s,this.emptyOnReset=l,this.emptyData={textFilter:"",bool:{},advanced:{},primary:null},a)for(var r in this.defaultData=a,this.emptyData)r in a||(a[r]=Espo.Utils.clone(this.emptyData[r]));this.data=Espo.Utils.clone(a)||this.emptyData,this.sanitizeData()}sanitizeData(){"advanced"in this.data||(this.data.advanced={}),"bool"in this.data||(this.data.bool={}),"textFilter"in this.data||(this.data.textFilter="")}getWhere(){let t=[];if(this.data.textFilter&&""!==this.data.textFilter&&t.push({type:"textFilter",value:this.data.textFilter}),this.data.bool){let e={type:"bool",value:[]};for(var i in this.data.bool)this.data.bool[i]&&e.value.push(i);e.value.length&&t.push(e)}var e;if(!this.data.primary||(e={type:"primary",value:this.data.primary}).value.length&&t.push(e),this.data.advanced)for(var s in this.data.advanced){var a=this.data.advanced[s];a&&(s=this.getWherePart(s,a),t.push(s))}return t}getWherePart(t,i){let e=t;if("object"!=typeof i)return console.error("Bad where clause"),{};if("where"in i)return i.where;t=i.type;let s;if("or"!==t&&"and"!==t)return"field"in i&&(e=i.field),"attribute"in i&&(e=i.attribute),i.dateTime?{type:t,attribute:e,value:i.value,dateTime:!0,timeZone:this.dateTime.timeZone||"UTC"}:(s=i.value,{type:t,attribute:e,value:s});{let e=[];for(var a in s=i.value||{})e.push(this.getWherePart(a,s[a]));return{type:t,value:e}}}loadStored(){return this.data=this.storage.get(this.type+"Search",this.scope)||Espo.Utils.clone(this.defaultData)||Espo.Utils.clone(this.emptyData),this.sanitizeData(),this}get(){return this.data}setAdvanced(e){this.data=Espo.Utils.clone(this.data),this.data.advanced=e}setBool(e){this.data=Espo.Utils.clone(this.data),this.data.bool=e}setPrimary(e){this.data=Espo.Utils.clone(this.data),this.data.primary=e}set(e){this.data=e,this.storage&&(delete(e=Espo.Utils.clone(e)).textFilter,this.storage.set(this.type+"Search",this.scope,e))}empty(){this.data=Espo.Utils.clone(this.emptyData),this.storage&&this.storage.clear(this.type+"Search",this.scope)}reset(){this.emptyOnReset?this.empty():(this.data=Espo.Utils.clone(this.defaultData)||Espo.Utils.clone(this.emptyData),this.storage&&this.storage.clear(this.type+"Search",this.scope))}}}),define("model",["exports","bullbone","underscore"],function(e,t,d){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,d=(i=d)&&i.__esModule?i:{default:i};class s{urlRoot=null;url=null;name=null;entityType=null;lastSyncPromise=null;_pending;_changing;constructor(e,t){t=t||{},this.idAttribute="id",this.id=null,this.cid=d.default.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),this.set(e||{}),this.defs=t.defs||{},this.defs.fields||(this.defs.fields={}),t.entityType&&(this.entityType=t.entityType,this.name=t.entityType,this.urlRoot=t.entityType),this.urlRoot=t.urlRoot||this.urlRoot,this.url=t.url||this.url,this.dateTime=t.dateTime||null,this.changed={},this._previousAttributes=null}sync(e,t,s){var i={create:"POST",update:"PUT",patch:"PUT",delete:"DELETE",read:"GET"}[e];if(!i)throw new Error(`Bad request method '${e}'.`);s=s||{};var a=this.composeSyncUrl();if(!a)throw new Error("No 'url'.");e=t&&["create","update","patch"].includes(e)?s.attributes||t.getClonedAttributes():null;let l=s.error;s.error=(e,t,i)=>{s.textStatus=t,s.errorThrown=i,l&&l.call(s.context,e,t,i)};var r=e?JSON.stringify(e):null,r=s.bypassRequest?Promise.resolve():Espo.Ajax.request(a,i,r,s);return s.xhr=r.xhr,t.trigger("request",a,i,e,r,s),r}set(e,t,i){if(null==e)return this;let s;return"object"==typeof e?this.setMultiple(e,t):((s={})[e]=t,this.setMultiple(s,i))}setMultiple(e,t){this.idAttribute in e&&(this.id=e[this.idAttribute]),t=t||{};let i=[];var s=this._changing;this._changing=!0,s||(this._previousAttributes=d.default.clone(this.attributes),this.changed={});let a=this.attributes,l=this.changed;var r,o=this._previousAttributes;for(r in e){var n=e[r];d.default.isEqual(a[r],n)||i.push(r),d.default.isEqual(o[r],n)?delete l[r]:l[r]=n,t.unset?delete a[r]:a[r]=n}if(!t.silent){i.length&&(this._pending=t);for(let e=0;e<i.length;e++)this.trigger("change:"+i[e],this,a[i[e]],t)}if(s)return this;if(!t.silent)for(;this._pending;)t=this._pending,this._pending=!1,this.trigger("change",this,t);return this._pending=!1,this._changing=!1,this}unset(e,t){t={...t,unset:!0};let i={};return i[e]=null,this.setMultiple(i,t)}get(e){return e===this.idAttribute&&this.id?this.id:this.attributes[e]}has(e){return void 0!==this.get(e)}clear(e){let t={};for(var i in this.attributes)t[i]=void 0;return e={...e,unset:!0},this.set(t,e)}isNew(){return!this.id}hasChanged(e){return e?d.default.has(this.changed,e):!d.default.isEmpty(this.changed)}changedAttributes(){return this.hasChanged()?d.default.clone(this.changed):{}}previousAttributes(){return d.default.clone(this._previousAttributes)}previous(e){return this._previousAttributes?this._previousAttributes[e]:null}fetch(i){let s=(i={...i}).success;return i.success=e=>{var t=this.prepareAttributes(e,i);this.set(t,i),s&&s.call(i.context,this,e,i),this.trigger("sync",this,e,i)},this.lastSyncPromise=this.sync("read",this,i),this.lastSyncPromise}save(e,i){i={...i},e&&!i.wait&&this.setMultiple(e,i);const s=i.success,a=this.attributes,t=(i.success=e=>{this.attributes=a;let t=this.prepareAttributes(e,i);(t=i.wait?{...a,...t}:t)&&this.setMultiple(t,i),s&&s.call(i.context,this,e,i),this.trigger("sync",this,e,i)},i.error);i.error=e=>{t&&t.call(i.context,this,e,i),this.trigger("error",this,e,i)},e&&i.wait&&(this.attributes={...a,...e});var l=this.isNew()?"create":i.patch?"patch":"update",e=("patch"==l&&(i.attributes=e),this.sync(l,this,i));return this.attributes=a,e}destroy(t){let i=(t=d.default.clone(t||{})).success;const s=()=>{this.stopListening(),this.trigger("destroy",this,this.collection,t)};if(t.success=e=>{t.wait&&s(),i&&i.call(t.context,this,e,t),this.isNew()||this.trigger("sync",this,e,t)},this.isNew())return d.default.defer(t.success),t.wait||s(),Promise.resolve();let a=t.error;t.error=e=>{a&&a.call(t.context,this,e,t),this.trigger("error",this,e,t)};var e=this.sync("delete",this,t);return t.wait||s(),e}composeSyncUrl(){if(this.url)return this.url;let e=this.urlRoot;if(!(e=!e&&this.collection?this.collection.urlRoot:e))throw new Error("No urlRoot.");if(this.isNew())return e;var t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)}prepareAttributes(e,t){return e}clone(){return new this.constructor(Espo.Utils.cloneDeep(this.attributes),{entityType:this.entityType,urlRoot:this.urlRoot,url:this.url,defs:this.defs,dateTime:this.dateTime})}setDefs(e){this.defs=e||{},this.defs.fields||(this.defs.fields={})}getClonedAttributes(){return Espo.Utils.cloneDeep(this.attributes)}populateDefaults(){let e={};var t,i;for(t in this.defs.fields){var s=this.getFieldParam(t,"default");if(null!==s)try{s=this.parseDefaultValue(s),e[t]=s}catch(e){console.error(e)}var a=this.getFieldParam(t,"defaultAttributes");if(a)for(var l in a)e[l]=a[l]}for(i in e=Espo.Utils.cloneDeep(e))this.has(i)&&delete e[i];this.set(e,{silent:!0})}parseDefaultValue(e){var t;return"string"==typeof e&&0===e.indexOf("javascript:")&&(t=e.substring(11),e=new Function("with(this) { "+t+"}").call(this)),e}getLinkMultipleColumn(e,t,i){return((this.get(e+"Columns")||{})[i]||{})[t]}setRelate(e){let t=e=>{var i=e.link;let s=e.model;if(!i||!s)throw new Error("Bad related options");switch(this.defs.links[i].type){case"belongsToParent":this.set(i+"Id",s.id),this.set(i+"Type",s.entityType),this.set(i+"Name",s.get("name"));break;case"belongsTo":this.set(i+"Id",s.id),this.set(i+"Name",s.get("name"));break;case"hasMany":let e=[],t=(e.push(s.id),{});t[s.id]=s.get("name"),this.set(i+"Ids",e),this.set(i+"Names",t)}};"[object Array]"!==Object.prototype.toString.call(e)?t(e):e.forEach(e=>{t(e)})}getFieldType(e){return this.defs&&this.defs.fields&&e in this.defs.fields&&this.defs.fields[e].type||null}getFieldParam(e,t){return this.defs&&this.defs.fields&&e in this.defs.fields&&t in this.defs.fields[e]?this.defs.fields[e][t]:null}getLinkType(e){return this.defs&&this.defs.links&&e in this.defs.links&&this.defs.links[e].type||null}getLinkParam(e,t){return this.defs&&this.defs.links&&e in this.defs.links&&t in this.defs.links[e]?this.defs.links[e][t]:null}isFieldReadOnly(e){return this.getFieldParam(e,"readOnly")||!1}isRequired(e){return this.getFieldParam(e,"required")||!1}getLinkMultipleIdList(e){return this.get(e+"Ids")||[]}getTeamIdList(){return this.get("teamsIds")||[]}hasField(e){return"defs"in this&&"fields"in this.defs&&e in this.defs.fields}hasLink(e){return"defs"in this&&"links"in this.defs&&e in this.defs.links}isEditable(){return!0}isRemovable(){return!0}getEntityType(){return this.name}abortLastFetch(){this.lastSyncPromise&&this.lastSyncPromise.getReadyState()<4&&this.lastSyncPromise.abort()}toJSON(){return console.warn("model.toJSON is deprecated. Use 'getClonedAttributes' instead."),this.getClonedAttributes()}}Object.assign(s.prototype,t.Events),s.extend=t.View.extend,e.default=s}),define("controller",["exports","exceptions","bullbone","jquery"],function(e,a,t,l){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a=i(a),l=i(l);class s{constructor(e,t){this.params=e||{},this.baseController=t.baseController,this.viewFactory=t.viewFactory,this.modelFactory=t.modelFactory,this.collectionFactory=t.collectionFactory,this._settings=t.settings||null,this._user=t.user||null,this._preferences=t.preferences||null,this._acl=t.acl||null,this._cache=t.cache||null,this._router=t.router||null,this._storage=t.storage||null,this._metadata=t.metadata||null,this._dateTime=t.dateTime||null,this._broadcastChannel=t.broadcastChannel||null,this.baseController||this.on("logout",()=>this.clearAllStoredMainViews()),this.set("masterRendered",!1)}defaultAction="index";name=null;params=null;viewFactory=null;modelFactory=null;masterView=null;setRouter(e){this._router=e,this.trigger("router-set",e)}getConfig(){return this._settings}getUser(){return this._user}getPreferences(){return this._preferences}getAcl(){return this._acl}getCache(){return this._cache}getRouter(){return this._router}getStorage(){return this._storage}getMetadata(){return this._metadata}getDateTime(){return this._dateTime}get(e){return e in this.params?this.params[e]:null}set(e,t){this.params[e]=t}unset(e){delete this.params[e]}has(e){return e in this.params}getStoredMainView(e){return this.get("storedMainView-"+e)}hasStoredMainView(e){return this.has("storedMainView-"+e)}clearStoredMainView(e){let t=this.getStoredMainView(e);t&&t.remove(!0),this.unset("storedMainView-"+e)}storeMainView(t,i){this.set("storedMainView-"+t,i),this.listenTo(i,"remove",e=>{(e=e||{}).ignoreCleaning||(this.stopListening(i,"remove"),this.clearStoredMainView(t))})}clearAllStoredMainViews(){for(var e in this.params)0===e.indexOf("storedMainView-")&&(e=e.slice(15),this.clearStoredMainView(e))}checkAccess(e){return!0}handleAccessGlobal(){if(!this.checkAccessGlobal())throw new a.default.AccessDenied("Denied access to '"+this.name+"'")}checkAccessGlobal(){return!0}handleCheckAccess(e){if(!this.checkAccess(e))throw e=e?"Denied access to action '"+this.name+"#"+e+"'":"Denied access to scope '"+this.name+"'",new a.default.AccessDenied(e)}doAction(e,t){this.handleAccessGlobal(),e=e||this.defaultAction;var i="action"+Espo.Utils.upperCaseFirst(e);if(!(i in this))throw new a.default.NotFound("Action '"+this.name+"#"+e+"' is not found");var s="before"+Espo.Utils.upperCaseFirst(e),e="after"+Espo.Utils.upperCaseFirst(e);s in this&&this[s].call(this,t||{}),this[i].call(this,t||{}),e in this&&this[e].call(this,t||{})}master(t){const e=this.get("entire");e&&(e.remove(),this.set("entire",null));var i=this.get("master");i?t.call(this,i):(i=this.masterView||"views/site/master",this.viewFactory.create(i,{fullSelector:"body"},e=>{this.set("master",e),this.get("masterRendered")?t.call(this,e):e.render().then(()=>{this.set("masterRendered",!0),t.call(this,e)})}))}main(e,s,t,i={}){const a={isCanceled:!1,key:i.key,useStored:i.useStored,callback:t},l=i.useStored||!1,r=i.key,o=(this.listenToOnce(this.baseController,"action",()=>a.isCanceled=!0),e&&"object"==typeof e?e:void 0),n=o?void 0:e||"views/base";this.master(t=>{if(!a.isCanceled){if((s=s||{}).fullSelector="#main",l&&this.hasStoredMainView(r)){const o=this.getStoredMainView(r);let e=!0;o&&"isActualForReuse"in o&&"function"==typeof o.isActualForReuse&&(e=o.isActualForReuse());var i=o&&"lastUrl"in o?o.lastUrl:null;if(e&&(!i||i===this.getRouter().getCurrentUrl()))return this._processMain(o,t,a),void("setupReuse"in o&&"function"==typeof o.setupReuse&&o.setupReuse(s.params||{}));this.clearStoredMainView(r)}o?t.assignView("main",o,"#main").then(()=>{a.isSet=!0,this._processMain(e,t,a)}):this.viewFactory.create(n,s,e=>{this._processMain(e,t,a)})}})}_processMain(e,t,i){if(!i.isCanceled){const s=i.key,a=(s&&this.storeMainView(s,e),()=>{e.cancelRender(),i.isCanceled=!0});if(e.listenToOnce(this.baseController,"action",a),t.currentViewKey&&(this.set("storedScrollTop-"+t.currentViewKey,(0,l.default)(window).scrollTop()),this.hasStoredMainView(t.currentViewKey))){let e=t.getView("main");e&&e.propagateEvent("remove",{ignoreCleaning:!0}),t.unchainView("main")}t.currentViewKey=s,i.isSet||t.setView("main",e);t=()=>{setTimeout(()=>e.stopListening(this.baseController,"action",a),500),e.updatePageTitle(),i.useStored&&this.has("storedScrollTop-"+s)?(0,l.default)(window).scrollTop(this.get("storedScrollTop-"+s)):(0,l.default)(window).scrollTop(0)};if(i.callback)return this.listenToOnce(e,"after:render",t),void i.callback.call(this,e);e.render().then(t)}}showLoadingNotification(){let e=this.get("master");e&&e.showLoadingNotification()}hideLoadingNotification(){let e=this.get("master");e&&e.hideLoadingNotification()}entire(e,t,i){const s=this.get("master");if(s&&s.remove(),this.set("master",null),this.set("masterRendered",!1),"object"==typeof e)return e.setElement("body"),void this.viewFactory.prepare(e,()=>{i?i(e):e.render()});(t=t||{}).fullSelector="body",this.viewFactory.create(e,t,e=>{this.set("entire",e),i?i(e):e.render()})}}Object.assign(s.prototype,t.Events),s.extend=t.View.extend,e.default=s}),define("acl",["exports","bullbone"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i{constructor(e,t,i){this.user=e||null,this.scope=t,this.aclAllowDeleteCreated=(i=i||{}).aclAllowDeleteCreated,this.teamsFieldIsForbidden=i.teamsFieldIsForbidden,this.forbiddenFieldList=i.forbiddenFieldList}getUser(){return this.user}checkScope(e,t,i,s){var a=(s=s||{}).inTeam,s=s.isOwner;if(this.getUser().isAdmin())return!1!==e;if(!1===e)return!1;if(!0===e)return!0;if("string"==typeof e)return!0;if(null===e)return!1;if(null===(t=t||null))return!0;if(!(t in e))return!1;e=e[t];if("all"===e)return!0;if("yes"===e)return!0;if("no"===e)return!1;if(void 0===s)return!0;if(s&&("own"===e||"team"===e))return!0;let l=!1;if("team"===e)if(null===(l=a)){if(!i)return!0;l=null}else if(a)return!0;if(null===s){if(!i)return!0;l=null}return l}checkModel(e,t,i,s){if(this.getUser().isAdmin())return!0;e={isOwner:this.checkIsOwner(e),inTeam:this.checkInTeam(e)};return this.checkScope(t,i,s,e)}checkModelDelete(e,t,i){i=this.checkModel(e,t,"delete",i);if(i)return!0;if(!1===t)return!1;if("no"===(t||{}).read)return!1;if(e.has("createdById")&&e.get("createdById")===this.getUser().id&&this.aclAllowDeleteCreated){if(!e.has("assignedUserId"))return!0;if(!e.get("assignedUserId"))return!0;if(e.get("assignedUserId")===this.getUser().id)return!0}return i}checkIsOwner(e){let t=!1;if(e.hasField("assignedUser")){if(this.getUser().id===e.get("assignedUserId"))return!0;e.has("assignedUserId")||(t=null)}else if(e.hasField("createdBy")){if(this.getUser().id===e.get("createdById"))return!0;e.has("createdById")||(t=null)}if(e.hasField("assignedUsers")){if(!e.has("assignedUsersIds"))return null;if(~(e.get("assignedUsersIds")||[]).indexOf(this.getUser().id))return!0;t=!1}return t}checkInTeam(e){var t=this.getUser().getTeamIdList();if(!e.has("teamsIds"))return!!this.teamsFieldIsForbidden||null;let i=e.getTeamIdList(),s=!1;return t.forEach(e=>{~i.indexOf(e)&&(s=!0)}),s}}i.extend=t.View.extend,e.default=i}),define("views/main",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{scope="";name="";menu={};$headerActionsContainer=null;shortcutKeys=null;events={"click .action":function(e){Espo.Utils.handleAction(this,e.originalEvent,e.currentTarget,{actionItems:[...this.menu.buttons,...this.menu.dropdown],className:"main-header-manu-action"})}};lastUrl;init(){var e;this.scope=this.options.scope||this.scope,this.menu={},this.options.params=this.options.params||{},this.name&&this.scope&&(e=this.name.charAt(0).toLowerCase()+this.name.slice(1),this.menu=this.getMetadata().get(["clientDefs",this.scope,"menu",e])||{}),this.headerActionItemTypeList=["buttons","dropdown","actions"],this.menu=Espo.Utils.cloneDeep(this.menu);let i={};this.name&&(i=Espo.Utils.cloneDeep(this.getMetadata().get(["clientDefs","Global","menu",this.name.charAt(0).toLowerCase()+this.name.slice(1)])||{})),this.headerActionItemTypeList.forEach(e=>{this.menu[e]=this.menu[e]||[],this.menu[e]=this.menu[e].concat(i[e]||[]);let t=this.menu[e];t.forEach(s=>{let a=this;s.initFunction&&s.data.handler&&this.wait(new Promise(i=>{Espo.loader.require(s.data.handler,e=>{let t=new e(a);t[s.initFunction].call(t),i()})}))})}),this.updateLastUrl(),this.on("after:render-internal",()=>{this.$headerActionsContainer=this.$el.find(".page-header .header-buttons")}),this.on("header-rendered",()=>{this.$headerActionsContainer=this.$el.find(".page-header .header-buttons"),this.adjustButtons()}),this.on("after:render",()=>this.adjustButtons()),this.shortcutKeys&&(this.shortcutKeys=Espo.Utils.cloneDeep(this.shortcutKeys))}setupFinal(){this.shortcutKeys&&(this.events["keydown.main"]=e=>{var t,i,s=Espo.Utils.getKeyFromKeyEvent(e);"function"!=typeof this.shortcutKeys[s]?(t=this.shortcutKeys[s])&&(e.preventDefault(),e.stopPropagation(),"function"!=typeof this[i="action"+Espo.Utils.upperCaseFirst(t)]?this[t]():this[i]()):this.shortcutKeys[s].call(this,e.originalEvent)})}updateLastUrl(){this.lastUrl=this.getRouter().getCurrentUrl()}getMenu(){if(this.menuDisabled||!this.menu)return{};let i={};return this.headerActionItemTypeList.forEach(t=>{(this.menu[t]||[]).forEach(e=>{!1!==e?(e=Espo.Utils.clone(e),i[t]=i[t]||[],Espo.Utils.checkActionAvailability(this.getHelper(),e)&&Espo.Utils.checkActionAccess(this.getAcl(),this.model||this.scope,e)&&(e.accessDataList&&!Espo.Utils.checkAccessDataList(e.accessDataList,this.getAcl(),this.getUser())||(e.name=e.name||e.action,e.action=e.action||null,e.labelTranslation&&(e.html=this.getHelper().escapeString(this.getLanguage().translatePath(e.labelTranslation))),i[t].push(e)))):i[t].push(!1)})}),i}getHeader(){return""}buildHeaderHtml(e){let i=e.map(e=>$("<div>").addClass("breadcrumb-item").append(e)),s=$("<div>").addClass("header-breadcrumbs");return i.forEach((e,t)=>{s.append(e),t!==i.length-1&&s.append($("<div>").addClass("breadcrumb-separator").append($("<span>").addClass("chevron-right")))}),s.get(0).outerHTML}getHeaderIconHtml(){return this.getHelper().getScopeColorIconHtml(this.scope)}actionShowModal(e){e=e.view;e&&this.createView("modal",e,{model:this.model,collection:this.collection},e=>{e.render(),this.listenTo(e,"after:save",()=>{this.model&&this.model.fetch(),this.collection&&this.collection.fetch()})})}addMenuItem(e,t,i,s){if(t){t.name=t.name||t.action||Espo.Utils.generateId();let i=t.name,s=-1;this.menu[e].forEach((e,t)=>{(e=e||{}).name===i&&(s=t)}),~s&&this.menu[e].splice(s,1)}let a=i?"unshift":"push";this.menu[e][a](t),s||!this.isRendered()?!s&&this.isBeingRendered()&&this.once("after:render",()=>{this.getHeaderView().reRender()}):this.getHeaderView().reRender()}removeMenuItem(s,e){let a=-1,l=!1;this.headerActionItemTypeList.forEach(i=>{(this.menu[i]||[]).forEach((e,t)=>{(e=e||{}).name===s&&(a=t,l=i)})}),~a&&l&&this.menu[l].splice(a,1),e||!this.isRendered()?e||!this.isBeingRendered()?e&&this.isRendered()&&this.$headerActionsContainer.find('[data-name="'+s+'"]').remove():this.once("after:render",()=>{this.getHeaderView().reRender()}):this.getHeaderView().reRender()}disableMenuItem(e){this.$headerActionsContainer.find('[data-name="'+e+'"]').addClass("disabled").attr("disabled")}enableMenuItem(e){this.$headerActionsContainer.find('[data-name="'+e+'"]').removeClass("disabled").removeAttr("disabled")}actionNavigateToRoot(e,t){t.stopPropagation(),this.getRouter().checkConfirmLeaveOut(()=>{var e=this.options.rootUrl||this.options.params.rootUrl||"#"+this.scope;this.getRouter().navigate(e,{trigger:!1}),this.getRouter().dispatch(this.scope,null,{isReturn:!0})})}hideHeaderActionItem(t){this.headerActionItemTypeList.forEach(e=>{(this.menu[e]||[]).forEach(e=>{(e=e||{}).name===t&&(e.hidden=!0)})}),this.isRendered()&&(this.$headerActionsContainer.find('li > .action[data-name="'+t+'"]').parent().addClass("hidden"),this.$headerActionsContainer.find('a.action[data-name="'+t+'"]').addClass("hidden"),this.controlMenuDropdownVisibility(),this.adjustButtons())}showHeaderActionItem(t){this.headerActionItemTypeList.forEach(e=>{(this.menu[e]||[]).forEach(e=>{(e=e||{}).name===t&&(e.hidden=!1)})});let e=()=>{this.$headerActionsContainer.find('li > .action[data-name="'+t+'"]').parent().removeClass("hidden"),this.$headerActionsContainer.find('a.action[data-name="'+t+'"]').removeClass("hidden"),this.controlMenuDropdownVisibility(),this.adjustButtons()};this.isRendered()?e():this.isBeingRendered()&&this.whenRendered().then(()=>e())}hasMenuVisibleDropdownItems(){let t=!1;return(this.menu.dropdown||[]).forEach(e=>{e.hidden||(t=!0)}),t}controlMenuDropdownVisibility(){let e=this.$headerActionsContainer.find(".dropdown-group");if(this.hasMenuVisibleDropdownItems())return e.removeClass("hidden"),void e.find("> button").removeClass("hidden");e.addClass("hidden"),e.find("> button").addClass("hidden")}getHeaderView(){return this.getView("header")}adjustButtons(){let e=this.$headerActionsContainer.find(".btn"),t=(e.removeClass("radius-left").removeClass("radius-right"),e.filter(":not(.hidden)"));t.first().addClass("radius-left"),t.last().addClass("radius-right")}setupReuse(e){}}e.default=s}),define("views/base",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{constructor(e){super(e)}}e.default=s}),define("views/record/detail",["exports","views/record/base","view-record-helper","helpers/action-item-setup"],function(e,t,i,s){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),i=a(i),s=a(s);class l extends t.default{constructor(e){super(e)}template="record/detail";type="detail";layoutName="detail";detailLayout=null;fieldsMode="detail";mode="detail";gridLayout=null;buttonsDisabled=!1;isNew=!1;buttonList=[{name:"edit",label:"Edit",title:"Ctrl+Space"}];dropdownItemList=[{name:"delete",label:"Remove"}];buttonEditList=[{name:"save",label:"Save",style:"primary",edit:!0,title:"Ctrl+Enter"},{name:"cancelEdit",label:"Cancel",edit:!0,title:"Esc"}];dropdownEditItemList=[];allActionItemsDisabled=!1;id=null;returnUrl=null;returnDispatchParams=null;middleView="views/record/detail-middle";sideView="views/record/detail-side";bottomView="views/record/detail-bottom";sideDisabled=!1;bottomDisabled=!1;gridLayoutType="record";editModeDisabled=!1;navigateButtonsDisabled=!1;readOnly=!1;isWide=!1;duplicateAction=!0;selfAssignAction=!1;printPdfAction=!0;convertCurrencyAction=!0;saveAndContinueEditingAction=!0;inlineEditDisabled=!1;portalLayoutDisabled=!1;panelSoftLockedTypeList=["default","acl","delimiter","dynamicLogic"];dynamicLogicDefs={};confirmLeaveDisabled=!1;setupHandlerType="record/detail";currentTab=0;middlePanelDefs=null;middlePanelDefsList=null;$middle=null;$bottom=null;$detailButtonContainer=null;blockUpdateWebSocketPeriod=500;stickButtonsFormBottomSelector;dynamicHandlerClassName;accessControlDisabled;inlineEditModeIsOn=!1;shortcutKeyCtrlEnterAction="save";shortcutKeys={"Control+Enter":function(e){this.handleShortcutKeyCtrlEnter(e)},"Control+Alt+Enter":function(e){this.handleShortcutKeyCtrlAltEnter(e)},"Control+KeyS":function(e){this.handleShortcutKeyCtrlS(e)},"Control+Space":function(e){this.handleShortcutKeyCtrlSpace(e)},Escape:function(e){this.handleShortcutKeyEscape(e)},"Control+Backslash":function(e){this.handleShortcutKeyControlBackslash(e)},"Control+ArrowLeft":function(e){this.handleShortcutKeyControlArrowLeft(e)},"Control+ArrowRight":function(e){this.handleShortcutKeyControlArrowRight(e)}};events={"click .button-container .action":function(e){const t=e.currentTarget;let i=void 0;t.classList.contains("detail-action-item")?i=[...this.buttonList,...this.dropdownItemList]:t.classList.contains("edit-action-item")&&(i=[...this.buttonEditList,...this.dropdownEditItemList]),Espo.Utils.handleAction(this,e.originalEvent,t,{actionItems:i})},'click [data-action="showMoreDetailPanels"]':function(){this.showMoreDetailPanels()},"click .middle-tabs > button":function(e){e=parseInt($(e.currentTarget).attr("data-tab"));this.selectTab(e)}};actionEdit(){if(!this.editModeDisabled)return this.setEditMode(),this.focusOnFirstDiv(),void $(window).scrollTop(0);let e={id:this.model.id,model:this.model};this.options.rootUrl&&(e.rootUrl=this.options.rootUrl),this.getRouter().navigate("#"+this.scope+"/edit/"+this.model.id,{trigger:!1}),this.getRouter().dispatch(this.scope,"edit",e)}actionDelete(){this.delete()}actionSave(e){let t=this.mode;e=this.save((e=e||{}).options).catch(e=>{t===this.MODE_EDIT&&"error"===e&&this.setEditMode()});return this.lastSaveCancelReason&&"notModified"!==this.lastSaveCancelReason||(this.setDetailMode(),this.focusOnFirstDiv(),$(window).scrollTop(0)),e}actionCancelEdit(){this.cancelEdit(),this.focusOnFirstDiv(),$(window).scrollTop(0)}focusOnFirstDiv(){let e=this.$el.find("> div").get(0);e&&e.focus({preventScroll:!0})}actionSaveAndContinueEditing(e){this.save((e=e||{}).options).catch(()=>{})}actionSelfAssign(){let e={assignedUserId:this.getUser().id,assignedUserName:this.getUser().get("name")};if("getSelfAssignAttributes"in this){var t=this.getSelfAssignAttributes();if(t)for(var i in t)e[i]=t[i]}this.model.save(e,{patch:!0}).then(()=>{Espo.Ui.success(this.translate("Self-Assigned"))})}actionConvertCurrency(){this.createView("modalConvertCurrency","views/modals/convert-currency",{entityType:this.entityType,model:this.model},e=>{e.render(),this.listenToOnce(e,"after:update",e=>{let t=!1;for(var i in e)if(e[i]!==this.model.get(i)){t=!0;break}t?this.model.fetch().then(()=>{Espo.Ui.success(this.translate("done","messages"))}):Espo.Ui.warning(this.translate("notUpdated","messages"))})})}getSelfAssignAttributes(){return null}setupActionItems(){if(this.model.isNew()?(this.isNew=!0,this.removeActionItem("delete")):this.getMetadata().get(["clientDefs",this.scope,"removeDisabled"])&&this.removeActionItem("delete"),this.duplicateAction&&this.getAcl().check(this.entityType,"create")&&!this.getMetadata().get(["clientDefs",this.scope,"duplicateDisabled"])&&this.addDropdownItem({label:"Duplicate",name:"duplicate"}),this.selfAssignAction&&(!this.getAcl().check(this.entityType,"edit")||~this.getAcl().getScopeForbiddenFieldList(this.entityType).indexOf("assignedUser")||this.getUser().isPortal()||this.model.has("assignedUserId")&&(this.dropdownItemList.push({label:"Self-Assign",name:"selfAssign",hidden:!!this.model.get("assignedUserId")}),this.listenTo(this.model,"change:assignedUserId",()=>{this.model.get("assignedUserId")?this.hideActionItem("selfAssign"):this.showActionItem("selfAssign")}))),this.type===this.TYPE_DETAIL&&this.printPdfAction){let e=!0;(e=~(this.getHelper().getAppParam("templateEntityTypeList")||[]).indexOf(this.entityType)?e:!1)&&this.dropdownItemList.push({label:"Print to PDF",name:"printPdf"})}if(this.type===this.TYPE_DETAIL&&this.convertCurrencyAction&&this.getAcl().check(this.entityType,"edit")&&!this.getMetadata().get(["clientDefs",this.scope,"convertCurrencyDisabled"])&&this.getFieldManager().getEntityTypeFieldList(this.entityType,{type:"currency",acl:"edit"}).length&&this.addDropdownItem({label:"Convert Currency",name:"convertCurrency"}),this.type===this.TYPE_DETAIL&&this.getMetadata().get(["scopes",this.scope,"hasPersonalData"])&&"yes"===this.getAcl().getPermissionLevel("dataPrivacyPermission")&&this.dropdownItemList.push({label:"View Personal Data",name:"viewPersonalData"}),this.type===this.TYPE_DETAIL&&this.getMetadata().get(["scopes",this.scope,"stream"])&&this.addDropdownItem({label:"View Followers",name:"viewFollowers"}),this.type===this.TYPE_DETAIL){let e=new s.default(this.getMetadata(),this.getHelper(),this.getAcl(),this.getLanguage());e.setup(this,this.type,e=>this.wait(e),e=>this.addDropdownItem(e),e=>this.showActionItem(e),e=>this.hideActionItem(e)),this.saveAndContinueEditingAction&&this.dropdownEditItemList.push({name:"saveAndContinueEditing",label:"Save & Continue Editing",title:"Ctrl+S"})}}disableActionItems(){this.disableButtons()}enableActionItems(){this.enableButtons()}hideActionItem(e){for(var t of this.buttonList)if(t.name===e){t.hidden=!0;break}for(var i of this.dropdownItemList)if(i.name===e){i.hidden=!0;break}for(var s of this.dropdownEditItemList)if(s.name===e){s.hidden=!0;break}for(var a of this.buttonEditList)if(a.name===e){a.hidden=!0;break}this.isRendered()&&(this.$detailButtonContainer.find('li > .action[data-action="'+e+'"]').parent().addClass("hidden"),this.$detailButtonContainer.find('button.action[data-action="'+e+'"]').addClass("hidden"),this.isDropdownItemListEmpty()&&this.$dropdownItemListButton.addClass("hidden"),this.isDropdownEditItemListEmpty()&&this.$dropdownEditItemListButton.addClass("hidden"),this.adjustButtons())}showActionItem(e){for(var t of this.buttonList)if(t.name===e){t.hidden=!1;break}for(var i of this.dropdownItemList)if(i.name===e){i.hidden=!1;break}for(var s of this.dropdownEditItemList)if(s.name===e){s.hidden=!1;break}for(var a of this.buttonEditList)if(a.name===e){a.hidden=!1;break}this.isRendered()&&(this.$detailButtonContainer.find('li > .action[data-action="'+e+'"]').parent().removeClass("hidden"),this.$detailButtonContainer.find('button.action[data-action="'+e+'"]').removeClass("hidden"),this.isDropdownItemListEmpty()||this.$dropdownItemListButton.removeClass("hidden"),this.isDropdownEditItemListEmpty()||this.$dropdownEditItemListButton.removeClass("hidden"),this.adjustButtons())}disableActionItem(e){for(var t of this.buttonList)if(t.name===e){t.disabled=!0;break}for(var i of this.dropdownItemList)if(i.name===e){i.disabled=!0;break}for(var s of this.dropdownEditItemList)if(s.name===e){s.disabled=!0;break}for(var a of this.buttonEditList)if(a.name===e){a.disabled=!0;break}this.isRendered()&&(this.$detailButtonContainer.find('li > .action[data-action="'+e+'"]').parent().addClass("disabled").attr("disabled","disabled"),this.$detailButtonContainer.find('button.action[data-action="'+e+'"]').addClass("disabled").attr("disabled","disabled"))}enableActionItem(e){for(var t of this.buttonList)if(t.name===e){t.disabled=!1;break}for(var i of this.dropdownItemList)if(i.name===e){i.disabled=!1;break}for(var s of this.dropdownEditItemList)if(s.name===e){s.disabled=!1;break}for(var a of this.buttonEditList)if(a.name===e){a.disabled=!1;break}this.isRendered()&&(this.$detailButtonContainer.find('li > .action[data-action="'+e+'"]').parent().removeClass("disabled").removeAttr("disabled"),this.$detailButtonContainer.find('button.action[data-action="'+e+'"]').removeClass("disabled").removeAttr("disabled"))}hasAvailableActionItem(t){return!this.allActionItemsDisabled&&(this.type===this.TYPE_DETAIL&&this.mode===this.MODE_EDIT?-1!==this.buttonEditList.findIndex(e=>e.name===t&&!e.disabled&&!e.hidden)||-1!==this.dropdownEditItemList.findIndex(e=>e.name===t&&!e.disabled&&!e.hidden):-1!==this.buttonList.findIndex(e=>e.name===t&&!e.disabled&&!e.hidden)||-1!==this.dropdownItemList.findIndex(e=>e.name===t&&!e.disabled&&!e.hidden))}showPanel(s,a){if(!this.recordHelper.getPanelStateParam(s,"hiddenLocked")&&(a=a||"default",this.recordHelper.setPanelStateParam(s,"hidden"+Espo.Utils.upperCaseFirst(a)+"Locked",!1),"dynamicLogic"!==a||!1!==this.recordHelper.getPanelStateParam(s,"hidden"))){for(let e=0;e<this.panelSoftLockedTypeList.length;e++){var l=this.panelSoftLockedTypeList[e];if(l!==a){l="hidden"+Espo.Utils.upperCaseFirst(l)+"Locked";if(this.recordHelper.getPanelStateParam(s,l))return}}let e=this.getMiddleView(),t=(e&&e.showPanelInternal(s),this.getBottomView()),i=(t?"showPanel"in t&&t.showPanel(s):this.bottomView&&this.once("ready",()=>{let e=this.getBottomView();e&&("processShowPanel"in e?e.processShowPanel(s):"showPanel"in e&&e.showPanel(s))}),this.getSideView());i?"showPanel"in i&&i.showPanel(s):this.sideView&&this.once("ready",()=>{let e=this.getSideView();e&&("processShowPanel"in e?e.processShowPanel(s):"showPanel"in e&&e.showPanel(s))}),this.recordHelper.setPanelStateParam(s,"hidden",!1),this.middlePanelDefs[s]&&(this.controlTabVisibilityShow(this.middlePanelDefs[s].tabNumber),this.adjustMiddlePanels()),this.recordHelper.trigger("panel-show")}}hidePanel(s,e,t){if(t=t||"default",e&&this.recordHelper.setPanelStateParam(s,"hiddenLocked",!0),t&&this.recordHelper.setPanelStateParam(s,"hidden"+Espo.Utils.upperCaseFirst(t)+"Locked",!0),"dynamicLogic"!==t||!0!==this.recordHelper.getPanelStateParam(s,"hidden")){let e=this.getMiddleView(),t=(e&&e.hidePanelInternal(s),this.getBottomView()),i=(t?"hidePanel"in t&&t.hidePanel(s):this.bottomView&&this.once("ready",()=>{let e=this.getBottomView();e&&("processHidePanel"in e?e.processHidePanel(s):"hidePanel"in e&&e.hidePanel(s))}),this.getSideView());i?"hidePanel"in i&&i.hidePanel(s):this.sideView&&this.once("ready",()=>{let e=this.getSideView();e&&("processHidePanel"in e?e.processHidePanel(s):"hidePanel"in e&&e.hidePanel(s))}),this.recordHelper.setPanelStateParam(s,"hidden",!0),this.middlePanelDefs[s]&&(this.controlTabVisibilityHide(this.middlePanelDefs[s].tabNumber),this.adjustMiddlePanels())}}afterRender(){this.$middle=this.$el.find(".middle"),this.bottomView&&(this.$bottom=this.$el.find(".bottom")),this.initElementReferences(),this.adjustMiddlePanels(),this.adjustButtons(),this.initStickableButtonsContainer(),this.initFieldsControlBehaviour()}initFieldsControlBehaviour(){var e,t=this.getFieldViews();let i=null;for(e in t){var s=t[e];this.listenTo(s,"edit",e=>{i&&i.isEditMode()&&i.inlineEditClose(),i=e}),this.listenTo(s,"inline-edit-on",()=>{this.inlineEditModeIsOn=!0}),this.listenTo(s,"inline-edit-off",e=>{(e=e||{}).all||(this.inlineEditModeIsOn=!1,this.setIsNotChanged())}),this.listenTo(s,"after:inline-edit-off",e=>{this.updatedAttributes&&!e.noReset&&this.resetModelChanges()})}}initStickableButtonsContainer(){let h=this.$el.find(".detail-button-container"),e=this.$el.find(".detail-button-container.record-buttons");if(e.length){let s=this.getThemeManager().getParam("navbarHeight");var t=this.getThemeManager().getParam("screenWidthXs");let a=$(window.document).width()<t;let i=(e=>{let t=e.get(0),i=0;for(;t;)i+=isNaN(t.offsetTop)?0:t.offsetTop,t=t.offsetParent;return a?i:i-s})(e),l=e.outerHeight(),r=(i-=5,$("<div>").css("height",l+"px").html("&nbsp;").hide().insertAfter(e)),o=this.getMiddleView().$el,n=$(window),d=$("#navbar .navbar-right");!this.stickButtonsFormBottomSelector||(t=this.$el.find(this.stickButtonsFormBottomSelector)).length&&(o=t),n.off("scroll.detail-"+this.numId),n.on("scroll.detail-"+this.numId,()=>{var e=o.position().top+o.outerHeight(!1)-l,t=n.scrollTop();if(e<=t&&!this.stickButtonsContainerAllTheWay)return h.hide(),d.removeClass("has-sticked-bar"),void r.show();if(!a||!$("#navbar .navbar-body").hasClass("in")){if(t>i)return h.hasClass("stick-sub")||(h.addClass("stick-sub"),r.show()),d.addClass("has-sticked-bar"),void h.show();h.hasClass("stick-sub")&&(h.removeClass("stick-sub"),d.removeClass("has-sticked-bar"),r.hide()),h.show()}})}}fetch(){let t=super.fetch();if(this.hasView("side")){let e=this.getSideView();"fetch"in e&&(t=_.extend(t,e.fetch()))}if(this.hasView("bottom")){let e=this.getBottomView();"fetch"in e&&(t=_.extend(t,e.fetch()))}return t}setEditMode(){return this.trigger("before:set-edit-mode"),this.inlineEditModeIsOn=!1,this.$el.find(".record-buttons").addClass("hidden"),this.$el.find(".edit-buttons").removeClass("hidden"),new Promise(e=>{var t,i=this.getFieldViews(!0);let s=[];for(t in i){let e=i[t];e.readOnly||(e.isEditMode()&&(e.fetchToModel(),e.removeInlineEditLinks(),e.setIsInlineEditMode(!1)),s.push(e.setEditMode().then(()=>e.render())))}this.mode=this.MODE_EDIT,this.trigger("after:set-edit-mode"),this.trigger("after:mode-change"),Promise.all(s).then(()=>e())})}setDetailMode(){return this.trigger("before:set-detail-mode"),this.$el.find(".edit-buttons").addClass("hidden"),this.$el.find(".record-buttons").removeClass("hidden"),this.inlineEditModeIsOn=!1,new Promise(e=>{var t,i=this.getFieldViews(!0);let s=[];for(t in i){let e=i[t];e.isDetailMode()||(e.isEditMode()&&e.trigger("inline-edit-off",{all:!0}),s.push(e.setDetailMode().then(()=>e.render())))}this.mode=this.MODE_DETAIL,this.trigger("after:set-detail-mode"),this.trigger("after:mode-change"),Promise.all(s).then(()=>e())})}cancelEdit(){this.resetModelChanges(),this.setDetailMode(),this.setIsNotChanged()}resetModelChanges(){let e=!0;for(var t in this.updatedAttributes&&(this.attributes=this.updatedAttributes,this.updatedAttributes=null,e=!1),this.model.attributes)t in this.attributes||this.model.unset(t);this.model.set(this.attributes,{skipReRender:e})}delete(){this.confirm({message:this.translate("removeRecordConfirmation","messages",this.scope),confirmText:this.translate("Remove")},()=>{this.trigger("before:delete"),this.trigger("delete"),Espo.Ui.notify(" ... ");let e=this.model.collection;this.model.destroy({wait:!0}).then(()=>{e&&0<e.total&&e.total--,this.model.set("deleted",!0,{silent:!0}),Espo.Ui.success(this.translate("Removed"),{suppress:!0}),this.trigger("after:delete"),this.exit("delete")})})}getFieldViews(e){var t={};return this.hasView("middle")&&"getFieldViews"in this.getMiddleView()&&_.extend(t,Espo.Utils.clone(this.getMiddleView().getFieldViews())),this.hasView("side")&&"getFieldViews"in this.getSideView()&&_.extend(t,this.getSideView().getFieldViews(e)),this.hasView("bottom")&&"getFieldViews"in this.getBottomView()&&_.extend(t,this.getBottomView().getFieldViews(e)),t}getFieldView(e){let t;return(t=!(t=!(t=this.hasView("middle")?(this.getMiddleView().getFieldViews()||{})[e]:t)&&this.hasView("side")?(this.getSideView().getFieldViews(!0)||{})[e]:t)&&this.hasView("bottom")?(this.getBottomView().getFieldViews(!0)||{})[e]:t)||null}handleDataBeforeRender(e){}data(){let e=!this.navigateButtonsDisabled&&!!this.model.collection,t=!1,i=!1;e&&(0<this.indexOfRecord&&(t=!0),(this.indexOfRecord<this.model.collection.total-1||-1===this.model.collection.total||-2===this.model.collection.total&&this.indexOfRecord<this.model.collection.length-1)&&(i=!0),t||i||(e=!1));var s=this.hasTabs(),a=s?this.getMiddleTabDataList():[];return{scope:this.scope,entityType:this.entityType,buttonList:this.buttonList,buttonEditList:this.buttonEditList,dropdownItemList:this.dropdownItemList,dropdownEditItemList:this.dropdownEditItemList,dropdownItemListEmpty:this.isDropdownItemListEmpty(),dropdownEditItemListEmpty:this.isDropdownEditItemListEmpty(),buttonsDisabled:this.buttonsDisabled,id:this.id,isWide:this.isWide,isSmall:"editSmall"===this.type||"detailSmall"===this.type,navigateButtonsEnabled:e,previousButtonEnabled:t,nextButtonEnabled:i,hasMiddleTabs:s,middleTabDataList:a}}init(){this.entityType=this.model.entityType||this.model.name||"Common",this.scope=this.options.scope||this.entityType,this.layoutName=this.options.layoutName||this.layoutName,this.detailLayout=this.options.detailLayout||this.detailLayout,this.type=this.options.type||this.type,this.buttonList=this.options.buttonList||this.buttonList,this.dropdownItemList=this.options.dropdownItemList||this.dropdownItemList,this.buttonList=Espo.Utils.cloneDeep(this.buttonList),this.buttonEditList=Espo.Utils.cloneDeep(this.buttonEditList),this.dropdownItemList=Espo.Utils.cloneDeep(this.dropdownItemList),this.dropdownEditItemList=Espo.Utils.cloneDeep(this.dropdownEditItemList),this.returnAfterCreate=this.options.returnAfterCreate,this.returnUrl=this.options.returnUrl||this.returnUrl,this.returnDispatchParams=this.options.returnDispatchParams||this.returnDispatchParams,this.exit=this.options.exit||this.exit,this.shortcutKeys&&(this.shortcutKeys=Espo.Utils.cloneDeep(this.shortcutKeys))}isDropdownItemListEmpty(){if(0===this.dropdownItemList.length)return!0;let t=!0;return this.dropdownItemList.forEach(e=>{e.hidden||(t=!1)}),t}isDropdownEditItemListEmpty(){if(0===this.dropdownEditItemList.length)return!0;let t=!0;return this.dropdownEditItemList.forEach(e=>{e.hidden||(t=!1)}),t}setup(){if(void 0===this.model)throw new Error("Model has not been injected into record view.");this.recordHelper=new i.default(this.defaultFieldStates,this.defaultFieldStates),this._initInlineEditSave();let e=this.collection=this.model.collection;e&&(this.listenTo(this.model,"destroy",()=>{e.remove(this.model.id),e.trigger("sync",{})}),"indexOfRecord"in this.options?this.indexOfRecord=this.options.indexOfRecord:this.indexOfRecord=e.indexOf(this.model)),this.middlePanelDefs={},this.middlePanelDefsList=[],this.getUser().isPortal()&&!this.portalLayoutDisabled&&this.getMetadata().get(["clientDefs",this.scope,"additionalLayouts",this.layoutName+"Portal"])&&(this.layoutName+="Portal"),this.numId=Math.floor(1e4*Math.random()+1),$(window).on("fetch-record."+this.cid,()=>this.handleRecordUpdate()),this.once("remove",()=>{this.isChanged&&this.resetModelChanges(),this.setIsNotChanged(),$(window).off("scroll.detail-"+this.numId),$(window).off("fetch-record."+this.cid)}),this.id=Espo.Utils.toDom(this.entityType)+"-"+Espo.Utils.toDom(this.type)+"-"+this.numId,this.isNew=this.model.isNew(),this.editModeDisabled||"editModeDisabled"in this.options&&(this.editModeDisabled=this.options.editModeDisabled),this.confirmLeaveDisabled=this.options.confirmLeaveDisabled||this.confirmLeaveDisabled,this.buttonsDisabled=this.options.buttonsDisabled||this.buttonsDisabled,"buttonsPosition"in this.options&&!this.options.buttonsPosition&&(this.buttonsDisabled=!0),"isWide"in this.options&&(this.isWide=this.options.isWide),"sideView"in this.options&&(this.sideView=this.options.sideView),"bottomView"in this.options&&(this.bottomView=this.options.bottomView),this.sideDisabled=this.options.sideDisabled||this.sideDisabled,this.bottomDisabled=this.options.bottomDisabled||this.bottomDisabled,this.readOnly=this.options.readOnly||this.readOnly,this.readOnly||this.isNew||(this.readOnly=this.getMetadata().get(["clientDefs",this.scope,"editDisabled"])||!1),this.getMetadata().get(["clientDefs",this.scope,"createDisabled"])&&(this.duplicateAction=!1),(this.getConfig().get("currencyList")||[]).length<=1&&(this.convertCurrencyAction=!1),this.readOnlyLocked=this.readOnly,this.inlineEditDisabled=this.inlineEditDisabled||this.getMetadata().get(["clientDefs",this.scope,"inlineEditDisabled"])||!1,this.inlineEditDisabled=this.options.inlineEditDisabled||this.inlineEditDisabled,this.navigateButtonsDisabled=this.options.navigateButtonsDisabled||this.navigateButtonsDisabled,this.portalLayoutDisabled=this.options.portalLayoutDisabled||this.portalLayoutDisabled,this.dynamicLogicDefs=this.options.dynamicLogicDefs||this.dynamicLogicDefs,this.accessControlDisabled=this.options.accessControlDisabled||this.accessControlDisabled,this.setupActionItems(),this.setupBeforeFinal(),this.on("after:render",()=>{this.initElementReferences()}),!this.isNew&&this.getHelper().webSocketManager&&this.getMetadata().get(["scopes",this.entityType,"object"])&&(this.subscribeToWebSocket(),this.once("remove",()=>{this.isSubscribedToWebSocket&&this.unsubscribeFromWebSocket()})),this.wait(this.getHelper().processSetupHandlers(this,this.setupHandlerType)),this.initInlineEditDynamicWithLogicInteroperability(),this.forcePatchAttributeDependencyMap=this.getMetadata().get(["clientDefs",this.scope,"forcePatchAttributeDependencyMap"])||{}}setupBeforeFinal(){this.accessControlDisabled||this.manageAccess(),this.attributes=this.model.getClonedAttributes(),this.options.attributes&&this.model.set(this.options.attributes),this.listenTo(this.model,"sync",()=>{this.attributes=this.model.getClonedAttributes()}),this.listenTo(this.model,"change",(e,t)=>{if(t.sync)for(var i in e.attributes)e.hasChanged(i)&&(this.attributes[i]=Espo.Utils.cloneDeep(e.get(i)));else this.mode!==this.MODE_EDIT&&!this.inlineEditModeIsOn||this.setIsChanged()});var e=Espo.Utils.clone(this.getMetadata().get(["clientDefs",this.entityType,"formDependency"])||{}),e=(this.dependencyDefs=_.extend(e,this.dependencyDefs),this.initDependency(),Espo.Utils.clone(this.getMetadata().get(["clientDefs",this.entityType,"dynamicLogic"])||{}));this.dynamicLogicDefs=_.extend(e,this.dynamicLogicDefs),this.initDynamicLogic(),this.setupFieldLevelSecurity(),this.initDynamicHandler()}_initInlineEditSave(){this.listenTo(this.recordHelper,"inline-edit-save",(e,t)=>{this.inlineEditSave(e,t)})}inlineEditSave(e,t){let i=this.getFieldView(e);if(!i)throw new Error(`No field '${e}'.`);t=_.extend({inline:!0,field:e,afterValidate:()=>{t.bypassClose||i.inlineEditClose(!0)}},t||{}),this.save(t).then(()=>{i.trigger("after:inline-save"),i.trigger("after:save"),t.bypassClose&&(i.initialAttributes=this.model.getClonedAttributes())}).catch(e=>{if("notModified"===e)return t.bypassClose?void 0:void i.inlineEditClose(!0);"error"===e&&(t.bypassClose||i.inlineEdit())})}initInlineEditDynamicWithLogicInteroperability(){let i=!1,t=(e,t)=>{if(this.inlineEditModeIsOn&&!this.editModeDisabled&&!i){if("required"===e){let e=this.getFieldView(t);if(e.validateRequired){e.suspendValidationMessage();try{if(!e.validateRequired())return}catch(e){}}}i=!0,setTimeout(()=>i=!1,300),setTimeout(()=>{this.setEditMode(),this.getFieldViewList().forEach(e=>e.removeInlineEditLinks())},10)}};this.on("set-field-required",e=>t("required",e)),this.on("set-field-option-list",e=>t("options",e)),this.on("reset-field-option-list",e=>t("options",e))}initDynamicHandler(){let e=this.dynamicHandlerClassName||this.getMetadata().get(["clientDefs",this.scope,"dynamicHandler"]),s=l=>{this.listenTo(this.model,"change",(e,t)=>{"onChange"in l&&l.onChange.call(l,e,t);var i,s=e.changedAttributes();for(i in s){var a="onChange"+Espo.Utils.upperCaseFirst(i);a in l&&l[a].call(l,e,s[i],t)}}),"init"in l&&l.init()},a=(e&&this.wait(new Promise(t=>{Espo.loader.require(e,e=>{e=this.dynamicHandler=new e(this);s(e),t()})})),this.getMetadata().get(["clientDefs",this.scope,"dynamicHandlerList"])||[]);if(a.length){let i=this,t=[];a.forEach(e=>{t.push(new Promise(t=>{Espo.loader.require(e,e=>{t(new e(i))})}))}),this.wait(Promise.all(t).then(e=>{e.forEach(e=>{s(e)})}))}}setupFinal(){this.build(),this.shortcutKeys&&this.options.shortcutKeysEnabled&&(this.events["keydown.record-detail"]=e=>{var t,i,s=Espo.Utils.getKeyFromKeyEvent(e);"function"!=typeof this.shortcutKeys[s]?(t=this.shortcutKeys[s])&&(e.preventDefault(),e.stopPropagation(),"function"!=typeof this[i="action"+Espo.Utils.upperCaseFirst(t)]?this[t]():this[i]()):this.shortcutKeys[s].call(this,e.originalEvent)}),this.options.focusForCreate||this.once("after:render",()=>this.focusOnFirstDiv())}setIsChanged(){this.isChanged=!0,this.confirmLeaveDisabled||this.setConfirmLeaveOut(!0)}setIsNotChanged(){this.isChanged=!1,this.confirmLeaveDisabled||this.setConfirmLeaveOut(!1)}switchToModelByIndex(e){let t=this.model.collection||this.collection;if(t){var i=t.at(e);if(!i)throw new Error("Model is not found in collection by index.");var s=i.id,a=this.entityType||this.scope;this.getRouter().navigate("#"+a+"/view/"+s,{trigger:!1}),this.getRouter().dispatch(a,"view",{id:s,model:i,indexOfRecord:e,rootUrl:this.options.rootUrl})}}actionPrevious(){var e;if(this.model.abortLastFetch(),!this.model.collection){if(!this.collection)return;this.indexOfRecord--,this.indexOfRecord<0&&(this.indexOfRecord=0)}0<this.indexOfRecord&&(e=this.indexOfRecord-1,this.switchToModelByIndex(e))}actionNext(){this.model.abortLastFetch();let t;if(this.model.collection)t=this.model.collection;else{if(!(t=this.collection))return;this.indexOfRecord--,this.indexOfRecord<0&&(this.indexOfRecord=0)}if(!(!(this.indexOfRecord<t.total-1)&&0<=t.total||-2===t.total&&this.indexOfRecord>=t.length-1)){let e=this.indexOfRecord+1;e<=t.length-1?this.switchToModelByIndex(e):t.fetch({more:!0,remove:!1}).then(()=>{this.switchToModelByIndex(e)})}}actionViewPersonalData(){this.createView("viewPersonalData","views/personal-data/modals/personal-data",{model:this.model},e=>{e.render(),this.listenToOnce(e,"erase",()=>{this.clearView("viewPersonalData"),this.model.fetch()})})}actionViewFollowers(e){var t=this.getMetadata().get(["clientDefs",this.entityType,"relationshipPanels","followers","viewModalView"])||this.getMetadata().get(["clientDefs","User","modalViews","relatedList"])||"views/modals/followers-list",i=!this.getUser().isAdmin()&&"no"===this.getAcl().getPermissionLevel("followerManagementPermission")&&"no"===this.getAcl().getPermissionLevel("portalPermission");let s={model:this.model,link:"followers",scope:"User",title:this.translate("Followers"),filtersDisabled:!0,url:this.entityType+"/"+this.model.id+"/followers",createDisabled:!0,selectDisabled:i,rowActionsView:"views/user/record/row-actions/relationship-followers"};if(e.viewOptions)for(var a in e.viewOptions)s[a]=e.viewOptions[a];Espo.Ui.notify(" ... "),this.createView("modalRelatedList",t,s,e=>{Espo.Ui.notify(!1),e.render(),this.listenTo(e,"action",(e,t)=>{Espo.Utils.handleAction(this,e,t)}),this.listenToOnce(e,"close",()=>{this.clearView("modalRelatedList")}),e.listenTo(this.model,"after:relate:followers",()=>{this.model.fetch()}),e.listenTo(this.model,"after:unrelate:followers",()=>{this.model.fetch()})})}actionPrintPdf(){this.createView("pdfTemplate","views/modals/select-template",{entityType:this.entityType},e=>{e.render(),this.listenToOnce(e,"select",e=>{this.clearView("pdfTemplate"),window.open("?entryPoint=pdf&entityType="+this.entityType+"&entityId="+this.model.id+"&templateId="+e.id,"_blank")})})}afterSave(){this.isNew?Espo.Ui.success(this.translate("Created")):Espo.Ui.success(this.translate("Saved")),this.enableActionItems(),this.setIsNotChanged(),setTimeout(()=>{this.unblockUpdateWebSocket()},this.blockUpdateWebSocketPeriod)}beforeSave(){Espo.Ui.notify(this.translate("saving","messages")),this.blockUpdateWebSocket()}beforeBeforeSave(){this.disableActionItems()}afterSaveError(){this.enableActionItems()}afterNotModified(){var e=this.translate("notModified","messages");Espo.Ui.warning(e),this.enableActionItems(),this.setIsNotChanged()}afterNotValid(){Espo.Ui.error(this.translate("Not valid")),this.enableActionItems()}errorHandlerDuplicate(e,t,i){return Espo.Ui.notify(!1),this.createView("duplicate","views/modals/duplicate",{scope:this.entityType,duplicates:e,model:this.model},e=>{e.render(),this.listenToOnce(e,"save",()=>{this.actionSave({options:{headers:{"X-Skip-Duplicate-Check":"true"}}}).then(()=>i())})}),!0}errorHandlerModified(e,t){Espo.Ui.notify(!1);let i=e.versionNumber,s=e.values||{},a=Object.keys(s),l=[];a.forEach(e=>{this.attributes[e]!==s[e]&&l.push(e)}),0!==l.length?this.createView("dialog","views/modals/resolve-save-conflict",{model:this.model,attributeList:l,currentAttributes:Espo.Utils.cloneDeep(this.model.attributes),originalAttributes:Espo.Utils.cloneDeep(this.attributes),actualAttributes:Espo.Utils.cloneDeep(s)}).then(e=>{e.render(),this.listenTo(e,"resolve",()=>{for(var e in this.model.set("versionNumber",i,{silent:!0}),this.attributes.versionNumber=i,s)this.setInitialAttributeValue(e,s[e])})}):setTimeout(()=>{this.model.set("versionNumber",i,{silent:!0}),this.attributes.versionNumber=i,t.inline&&t.field?this.inlineEditSave(t.field):this.actionSave()},5)}getMiddleView(){return this.getView("middle")}getSideView(){return this.getView("side")}getBottomView(){return this.getView("bottom")}setReadOnly(){this.readOnlyLocked||(this.readOnly=!0);let e=this.getBottomView(),t=(e&&"setReadOnly"in e&&e.setReadOnly(),this.getSideView());t&&"setReadOnly"in t&&t.setReadOnly(),this.getFieldList().forEach(e=>{this.setFieldReadOnly(e)})}setNotReadOnly(t){this.readOnlyLocked||(this.readOnly=!1);let e=this.getBottomView(),i=(e&&"setNotReadOnly"in e&&e.setNotReadOnly(t),this.getSideView());i&&"setNotReadOnly"in i&&i.setNotReadOnly(t),this.getFieldList().forEach(e=>{t&&this.recordHelper.getFieldStateParam(e,"readOnly")||this.setFieldNotReadOnly(e)})}manageAccessEdit(e){var t;this.isNew||(!(t=this.getAcl().checkModel(this.model,"edit",!0))||this.readOnlyLocked?(this.readOnly=!0,this.hideActionItem("edit"),this.selfAssignAction&&this.hideActionItem("selfAssign")):(this.showActionItem("edit"),this.selfAssignAction&&(this.hideActionItem("selfAssign"),this.model.has("assignedUserId")&&(this.model.get("assignedUserId")||this.showActionItem("selfAssign"))),this.readOnlyLocked||(this.readOnly&&e&&(this.isReady?this.setNotReadOnly(!0):this.on("ready",()=>this.setNotReadOnly(!0))),this.readOnly=!1)),null===t&&this.listenToOnce(this.model,"sync",()=>{this.manageAccessEdit(!0)}))}manageAccessDelete(){var e;this.isNew||((e=this.getAcl().checkModel(this.model,"delete",!0))?this.showActionItem("delete"):this.hideActionItem("delete"),null===e&&this.listenToOnce(this.model,"sync",()=>{this.manageAccessDelete(!0)}))}manageAccessStream(){var e;this.isNew||(~["no","own"].indexOf(this.getAcl().getLevel("User","read"))&&"no"===this.getAcl().getPermissionLevel("portalPermission")?this.hideActionItem("viewFollowers"):((e=this.getAcl().checkModel(this.model,"stream",!0))?this.showActionItem("viewFollowers"):this.hideActionItem("viewFollowers"),null===e&&this.listenToOnce(this.model,"sync",()=>{this.manageAccessStream(!0)})))}manageAccess(){this.manageAccessEdit(),this.manageAccessDelete(),this.manageAccessStream()}addButton(e,t){var i=e.name;if(i){for(var s of this.buttonList)if(s.name===i)return;t?this.buttonList.unshift(e):this.buttonList.push(e)}}addDropdownItem(e,t){if(e){var i=e.name;if(i){for(var s of this.dropdownItemList)if(s.name===i)return;t?this.dropdownItemList.unshift(e):this.dropdownItemList.push(e)}}else t?this.dropdownItemList.unshift(!1):this.dropdownItemList.push(!1)}addButtonEdit(e,t){var i=e.name;if(i){for(var s of this.buttonEditList)if(s.name===i)return;t?this.buttonEditList.unshift(e):this.buttonEditList.push(e)}}enableButtons(){this.allActionItemsDisabled=!1,this.$el.find(".button-container .actions-btn-group .action").removeAttr("disabled").removeClass("disabled"),this.$el.find(".button-container .actions-btn-group .dropdown-toggle").removeAttr("disabled").removeClass("disabled"),this.buttonList.filter(e=>e.disabled).forEach(e=>{this.$detailButtonContainer.find(`button.action[data-action="${e.name}"]`).addClass("disabled").attr("disabled","disabled")}),this.buttonEditList.filter(e=>e.disabled).forEach(e=>{this.$detailButtonContainer.find(`button.action[data-action="${e.name}"]`).addClass("disabled").attr("disabled","disabled")}),this.dropdownItemList.filter(e=>e.disabled).forEach(e=>{this.$detailButtonContainer.find(`li > .action[data-action="${e.name}"]`).parent().addClass("disabled").attr("disabled","disabled")}),this.dropdownEditItemList.filter(e=>e.disabled).forEach(e=>{this.$detailButtonContainer.find(`li > .action[data-action="${e.name}"]`).parent().addClass("disabled").attr("disabled","disabled")})}disableButtons(){this.allActionItemsDisabled=!0,this.$el.find(".button-container .actions-btn-group .action").attr("disabled","disabled").addClass("disabled"),this.$el.find(".button-container .actions-btn-group .dropdown-toggle").attr("disabled","disabled").addClass("disabled")}removeActionItem(e){this.removeButton(e)}removeButton(e){for(var[t,i]of this.buttonList.entries())if(i.name===e){this.buttonList.splice(t,1);break}for(var[s,a]of this.dropdownItemList.entries())if(a.name===e){this.dropdownItemList.splice(s,1);break}this.isRendered()&&this.$el.find('.detail-button-container .action[data-action="'+e+'"]').remove()}convertDetailLayout(t){let i=[];var h=this.getSelector()||"#"+this.id;this.panelFieldListMap={};let s=-1;for(let e=0;e<t.length;e++){let o=t[e],n={};var c,a,l=o.tabBreak||0===e;l&&s++,"customLabel"in o?(n.label=o.customLabel,n.label&&(n.label=this.getLanguage().translate(n.label,"panelCustomLabels",this.entityType))):(n.label=o.label||null,n.label&&(n.label=this.getLanguage().translate(n.label,"labels",this.entityType))),n.name=o.name||"panel-"+e.toString(),n.style=o.style||"default",n.rows=[],n.tabNumber=s,this.middlePanelDefs[n.name]={name:n.name,style:n.style,tabNumber:n.tabNumber,tabBreak:l,tabLabel:o.tabLabel},this.middlePanelDefsList.push(this.middlePanelDefs[n.name]),o.dynamicLogicVisible&&this.dynamicLogic&&this.dynamicLogic.addPanelVisibleCondition(n.name,o.dynamicLogicVisible),o.dynamicLogicStyled&&this.dynamicLogic&&this.dynamicLogic.addPanelStyledCondition(n.name,o.dynamicLogicStyled),o.hidden&&0===s&&(n.hidden=!0,this.hidePanel(n.name),this.underShowMoreDetailPanelList=this.underShowMoreDetailPanelList||[],this.underShowMoreDetailPanelList.push(n.name));let d="rows";o.columns&&(d="columns",n.columns=[]),n.name&&(this.panelFieldListMap[n.name]=[]);for([c,a]of o[d].entries()){let r=[];for(const p of a)if(!1!==p){let a=p.view,l=p.name;if(l=!l&&a&&"object"==typeof a?a.name:l){let e;a&&"object"==typeof a&&(a.model=this.model,a.mode=this.fieldsMode,e=`.field[data-name="${l}"]`),n.name&&this.panelFieldListMap[n.name].push(l);var u=p.type||this.model.getFieldType(l)||"base";a=a||this.model.getFieldParam(l,"view")||this.getFieldManager().getViewName(u);let t={fullSelector:h+' .middle .field[data-name="'+l+'"]',defs:{name:l,params:p.params||{}},mode:this.fieldsMode},i=(this.readOnly&&(t.readOnly=!0),p.readOnly&&(t.readOnly=!0,t.readOnlyLocked=!0),this.readOnlyLocked&&(t.readOnlyLocked=!0),(this.inlineEditDisabled||p.inlineEditDisabled)&&(t.inlineEditDisabled=!0),p.fullWidth||!1);if(i||1===o[d][c].length&&(i=!0),this.recordHelper.getFieldStateParam(l,"hidden")&&(t.disabled=!0),this.recordHelper.getFieldStateParam(l,"hiddenLocked")&&(t.disabledLocked=!0),this.recordHelper.getFieldStateParam(l,"readOnly")&&(t.readOnly=!0),!t.readOnlyLocked&&this.recordHelper.getFieldStateParam(l,"readOnlyLocked")&&(t.readOnlyLocked=!0),null!==this.recordHelper.getFieldStateParam(l,"required")&&(t.defs.params=t.defs.params||{},t.defs.params.required=this.recordHelper.getFieldStateParam(l,"required")),this.recordHelper.hasFieldOptionList(l)&&(t.customOptionList=this.recordHelper.getFieldOptionList(l)),t.validateCallback=()=>this.validateField(l),t.recordHelper=this.recordHelper,t.dataObject=this.options.dataObject||{},p.options)for(var m in p.options)void 0===t[m]&&(t[m]=p.options[m]);let s={name:l+"Field",view:a,field:l,fullSelector:h+' .middle .field[data-name="'+l+'"]',fullWidth:i,options:t};e&&(s.selector=e),"labelText"in p&&(t.labelText=p.labelText,s.customLabel=p.labelText),"customLabel"in p&&(s.customLabel=p.customLabel),"label"in p&&(s.label=p.label),a&&"object"==typeof a&&!s.customLabel&&!s.label&&a.getLabelText()&&(s.customLabel=a.getLabelText()),"customCode"in p&&(s.customCode=p.customCode),"noLabel"in p&&(s.noLabel=p.noLabel),"span"in p&&(s.span=p.span),r.push(s)}else console.warn("No 'name' specified in detail layout cell.")}else r.push(!1);n[d].push(r)}i.push(n)}return i}getGridLayout(t){if(null===this.gridLayout)return this.detailLayout?(this.gridLayout={type:this.gridLayoutType,layout:this.convertDetailLayout(this.detailLayout)},void t(this.gridLayout)):void this.getHelper().layoutManager.get(this.entityType,this.layoutName,e=>{"function"==typeof this.modifyDetailLayout&&(e=Espo.Utils.cloneDeep(e),this.modifyDetailLayout(e)),this.detailLayout=e,this.gridLayout={type:this.gridLayoutType,layout:this.convertDetailLayout(this.detailLayout)},t(this.gridLayout)});t(this.gridLayout)}createSideView(){var e=this.getSelector()||"#"+this.id;this.createView("side",this.sideView,{model:this.model,scope:this.scope,fullSelector:e+" .side",type:this.type,readOnly:this.readOnly,inlineEditDisabled:this.inlineEditDisabled,recordHelper:this.recordHelper,recordViewObject:this,isReturn:this.options.isReturn,dataObject:this.options.dataObject})}createMiddleView(t){let i=this.getSelector()||"#"+this.id;this.waitForView("middle"),this.getGridLayout(e=>{this.hasTabs()&&this.options.isReturn&&this.isStoredTabForThisRecord()&&this.selectStoredTab(),this.createView("middle",this.middleView,{model:this.model,scope:this.scope,type:this.type,layoutDefs:e,fullSelector:i+" .middle",layoutData:{model:this.model},recordHelper:this.recordHelper,recordViewObject:this,panelFieldListMap:this.panelFieldListMap},t)})}createBottomView(){var e=this.getSelector()||"#"+this.id;this.createView("bottom",this.bottomView,{model:this.model,scope:this.scope,fullSelector:e+" .bottom",readOnly:this.readOnly,type:this.type,inlineEditDisabled:this.inlineEditDisabled,recordHelper:this.recordHelper,recordViewObject:this,portalLayoutDisabled:this.portalLayoutDisabled,isReturn:this.options.isReturn,dataObject:this.options.dataObject})}build(e){!this.sideDisabled&&this.sideView&&this.createSideView(),this.middleView&&this.createMiddleView(e),!this.bottomDisabled&&this.bottomView&&this.createBottomView()}exitAfterCreate(){var e;return!(this.returnAfterCreate||!this.model.id)&&(e="#"+this.scope+"/view/"+this.model.id,this.getRouter().navigate(e,{trigger:!1}),this.getRouter().dispatch(this.scope,"view",{id:this.model.id,rootUrl:this.options.rootUrl,model:this.model,isAfterCreate:!0}),!0)}exit(e){if(e){var t="exitAfter"+Espo.Utils.upperCaseFirst(e);if(t in this)if(this[t]())return}let i,s;if(this.returnUrl)i=this.returnUrl;else{if("delete"===e)return i=this.options.rootUrl||"#"+this.scope,this.getRouter().navigate(i,{trigger:!1}),void this.getRouter().dispatch(this.scope,null,{isReturn:!0});this.model.id?(i="#"+this.scope+"/view/"+this.model.id,this.returnDispatchParams||(this.getRouter().navigate(i,{trigger:!1}),s={id:this.model.id,model:this.model},this.options.rootUrl&&(s.rootUrl=this.options.rootUrl),this.getRouter().dispatch(this.scope,"view",s))):i=this.options.rootUrl||"#"+this.scope}if(this.returnDispatchParams)return t=this.returnDispatchParams.controller,e=this.returnDispatchParams.action,s=this.returnDispatchParams.options||{},this.getRouter().navigate(i,{trigger:!1}),void this.getRouter().dispatch(t,e,s);this.getRouter().navigate(i,{trigger:!0})}subscribeToWebSocket(){var e="recordUpdate."+this.entityType+"."+this.model.id;this.recordUpdateWebSocketTopic=e,this.isSubscribedToWebSocket=!0,this.getHelper().webSocketManager.subscribe(e,()=>{this.handleRecordUpdate()})}unsubscribeFromWebSocket(){this.isSubscribedToWebSocket&&this.getHelper().webSocketManager.unsubscribe(this.recordUpdateWebSocketTopic)}handleRecordUpdate(){if(!this.updateWebSocketIsBlocked)if(this.inlineEditModeIsOn||this.mode===this.MODE_EDIT){let e=this.model.clone();void e.fetch().then(()=>{!this.inlineEditModeIsOn&&this.mode!==this.MODE_EDIT||(this.updatedAttributes=Espo.Utils.cloneDeep(e.attributes))})}else this.model.fetch({highlight:!0})}blockUpdateWebSocket(e){this.updateWebSocketIsBlocked=!0,e&&setTimeout(()=>{this.unblockUpdateWebSocket()},this.blockUpdateWebSocketPeriod)}unblockUpdateWebSocket(){this.updateWebSocketIsBlocked=!1}showMoreDetailPanels(){this.hidePanel("showMoreDelimiter"),this.underShowMoreDetailPanelList.forEach(e=>{this.showPanel(e)})}getTabCount(){if(!this.hasTabs())return 0;let t=1;return(this.detailLayout||[]).forEach(e=>{e.tabBreak&&t++}),t}hasTabs(){if(void 0!==this._hasMiddleTabs)return this._hasMiddleTabs;if(!this.detailLayout)return!1;for(var e of this.detailLayout)if(e.tabBreak)return this._hasMiddleTabs=!0;return this._hasMiddleTabs=!1}getMiddleTabDataList(){let a=this.currentTab,l=this.middlePanelDefsList;return l.filter((e,t)=>0===t||e.tabBreak).map((e,t)=>{let i=e.tabLabel,s=!1;return 0<t&&(s=-1===l.filter(e=>e.tabNumber===t).findIndex(e=>!this.recordHelper.getPanelStateParam(e.name,"hidden"))),i?"$label:"===i.substring(0,7)?i=this.translate(i.substring(7),"labels",this.scope):"$"===i[0]&&(i=this.translate(i.substring(1),"tabs",this.scope)):i=0===t?this.translate("Overview"):(t+1).toString(),{label:i,isActive:a===t,hidden:s}})}selectTab(e){this.currentTab=e,$(".popover.in").removeClass("in"),this.whenRendered().then(()=>{this.$el.find(".middle-tabs > button").removeClass("active"),this.$el.find(`.middle-tabs > button[data-tab="${e}"]`).addClass("active"),this.$el.find(".middle > .panel[data-tab]").addClass("tab-hidden"),this.$el.find(`.middle > .panel[data-tab="${e}"]`).removeClass("tab-hidden"),this.adjustMiddlePanels(),this.recordHelper.trigger("panel-show")}),this.storeTab()}storeTab(){this.getSessionStorage().set("tab_middle",this.currentTab),this.getSessionStorage().set("tab_middle_record",this.entityType+"_"+this.model.id)}selectStoredTab(){var e=this.getSessionStorage().get("tab_middle");0<e&&this.selectTab(e)}isStoredTabForThisRecord(){return this.getSessionStorage().get("tab_middle_record")===this.entityType+"_"+this.model.id}onInvalid(e){if(this.hasTabs()){let t=[];for(var i of e){let e=this.getMiddleView().getFieldView(i);e&&(i=e.$el.closest(".panel.tab-hidden").attr("data-tab"),i=parseInt(i),-1===t.indexOf(i)&&t.push(i))}if(t.length){let i=this.$el.find(".middle-tabs");t.forEach(e=>{let t=i.find(`> [data-tab="${e.toString()}"]`);t.addClass("invalid"),t.one("click",()=>{t.removeClass("invalid")})})}}}controlTabVisibilityShow(e){this.hasTabs()&&0!==e&&(this.isBeingRendered()?this.once("after:render",()=>this.controlTabVisibilityShow(e)):this.$el.find(`.middle-tabs > [data-tab="${e.toString()}"]`).removeClass("hidden"))}controlTabVisibilityHide(t){if(this.hasTabs()&&0!==t)if(this.isBeingRendered())this.once("after:render",()=>this.controlTabVisibilityHide(t));else{let e=this.middlePanelDefsList.filter(e=>e.tabNumber===t);if(-1===e.findIndex(e=>!this.recordHelper.getPanelStateParam(e.name,"hidden"))){let e=this.$el.find(`.middle-tabs > [data-tab="${t.toString()}"]`);e.addClass("hidden"),this.currentTab===t&&this.selectTab(0)}}}adjustMiddlePanels(){if(this.isRendered()&&this.$middle.length){let e=this.$middle.find("> .panel"),s=this.$bottom?this.$bottom.find("> .panel"):null,a=(e.removeClass("first").removeClass("last").removeClass("in-middle"),e.filter(":not(.tab-hidden):not(.hidden)"));a.each((e,t)=>{let i=$(t);if(e===a.length-1)return s&&s.first().hasClass("sticked")?0===e?void i.addClass("first"):void i.addClass("in-middle"):0===e?void 0:void i.addClass("last");0<e&&e<a.length-1?i.addClass("in-middle"):0===e&&i.addClass("first")})}}adjustButtons(){let e=this.$detailButtonContainer.filter(".record-buttons").find("button.btn"),t=(e.removeClass("radius-left").removeClass("radius-right"),e.filter("button:not(.hidden)"));t.first().addClass("radius-left"),t.last().addClass("radius-right"),this.adjustEditButtons()}adjustEditButtons(){let e=this.$detailButtonContainer.filter(".edit-buttons").find("button.btn"),t=(e.removeClass("radius-left").removeClass("radius-right"),e.filter("button:not(.hidden)"));t.first().addClass("radius-left"),t.last().addClass("radius-right")}initElementReferences(){this.$detailButtonContainer&&this.$detailButtonContainer.length||(this.$detailButtonContainer=this.$el.find(".detail-button-container"),this.$dropdownItemListButton=this.$detailButtonContainer.find(".dropdown-item-list-button"),this.$dropdownEditItemListButton=this.$detailButtonContainer.find(".dropdown-edit-item-list-button"))}focusForEdit(){this.$el.find(".field:not(.hidden) .form-control:not([disabled])").first().focus()}focusForCreate(){this.$el.find(".form-control:not([disabled])").first().focus()}handleShortcutKeyCtrlEnter(e){var t=this.shortcutKeyCtrlEnterAction;this.inlineEditModeIsOn||this.buttonsDisabled||!t||this.mode===this.MODE_EDIT&&this.hasAvailableActionItem(t)&&(e.preventDefault(),e.stopPropagation(),this["action"+Espo.Utils.upperCaseFirst(t)]())}handleShortcutKeyCtrlS(e){this.inlineEditModeIsOn||this.buttonsDisabled||(e.preventDefault(),e.stopPropagation(),this.mode===this.MODE_EDIT&&this.saveAndContinueEditingAction&&this.hasAvailableActionItem("saveAndContinueEditing")&&this.actionSaveAndContinueEditing())}handleShortcutKeyCtrlSpace(e){this.inlineEditModeIsOn||this.buttonsDisabled||this.type===this.TYPE_DETAIL&&this.mode===this.MODE_DETAIL&&"TEXTAREA"!==e.target.tagName&&"INPUT"!==e.target.tagName&&this.hasAvailableActionItem("edit")&&($(e.currentTarget),e.preventDefault(),e.stopPropagation(),this.actionEdit(),this.editModeDisabled||setTimeout(()=>this.focusForEdit(),200))}handleShortcutKeyEscape(e){this.inlineEditModeIsOn||this.buttonsDisabled||this.type===this.TYPE_DETAIL&&this.mode===this.MODE_EDIT&&(e.preventDefault(),e.stopPropagation(),this.model.set(this.fetch()),this.isChanged?this.confirm(this.translate("confirmLeaveOutMessage","messages")).then(()=>this.actionCancelEdit()):this.actionCancelEdit())}handleShortcutKeyCtrlAltEnter(e){}handleShortcutKeyControlBackslash(a){if(this.hasTabs()){let s=this.$el.find(".middle-tabs > button:not(.hidden)");if(1!==s.length){a.preventDefault(),a.stopPropagation();let e=s.toArray().findIndex(e=>$(e).hasClass("active")),t=(++e>=s.length&&(e=0),$(s.get(e))),i=parseInt(t.attr("data-tab"));this.selectTab(i),this.mode!==this.MODE_EDIT?this.$el.find(`.middle-tabs button[data-tab="${i}"]`).focus():setTimeout(()=>{this.$middle.find(`.panel[data-tab="${i}"] .cell:not(.hidden)`).first().focus()},50)}}}handleShortcutKeyControlArrowLeft(t){if(!this.inlineEditModeIsOn&&!this.buttonsDisabled&&!this.navigateButtonsDisabled&&this.type===this.TYPE_DETAIL&&this.mode===this.MODE_DETAIL&&"TEXTAREA"!==t.target.tagName&&"INPUT"!==t.target.tagName){let e=this.$el.find('button[data-action="previous"]');e.length&&!e.hasClass("disabled")&&(t.preventDefault(),t.stopPropagation(),this.actionPrevious())}}handleShortcutKeyControlArrowRight(t){if(!this.inlineEditModeIsOn&&!this.buttonsDisabled&&!this.navigateButtonsDisabled&&this.type===this.TYPE_DETAIL&&this.mode===this.MODE_DETAIL&&"TEXTAREA"!==t.target.tagName&&"INPUT"!==t.target.tagName){let e=this.$el.find('button[data-action="next"]');e.length&&!e.hasClass("disabled")&&(t.preventDefault(),t.stopPropagation(),this.actionNext())}}getMode(){return this.mode}}e.default=l}),define("views/fields/link",["exports","views/fields/base","helpers/record-modal"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{type="link";listTemplate="fields/link/list";detailTemplate="fields/link/detail";editTemplate="fields/link/edit";searchTemplate="fields/link/search";nameName;idName;foreignScope=null;selectRecordsView="views/modals/select-records";autocompleteDisabled=!1;createDisabled=!1;forceCreateButton=!1;searchTypeList=["is","isEmpty","isNotEmpty","isNot","isOneOf","isNotOneOf"];selectFilterList=null;selectPrimaryFilterName=null;selectBoolFilterList=null;autocompleteMaxCount=null;forceSelectAllAttributes=!1;mandatorySelectAttributeList=null;getEmptyAutocompleteResult=null;events={'auxclick a[href]:not([role="button"])':function(e){this.isReadMode()&&1===e.button&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),e.stopPropagation(),this.quickView())}};data(){let e=this.model.has(this.nameName)?this.model.get(this.nameName):this.model.get(this.idName),t=(null===e&&(e=this.model.get(this.idName)),this.isReadMode()&&!e&&this.model.get(this.idName)&&(e=this.translate(this.foreignScope,"scopeNames")),null);return this.isDetailMode()&&(t=this.getHelper().getScopeColorIconHtml(this.foreignScope)),{...super.data(),idName:this.idName,nameName:this.nameName,idValue:this.model.get(this.idName),nameValue:e,foreignScope:this.foreignScope,valueIsSet:this.model.has(this.idName),iconHtml:t,url:this.getUrl()}}getUrl(){var e=this.model.get(this.idName);return e?"#"+this.foreignScope+"/view/"+e:null}getSelectFilters(){return null}getSelectBoolFilterList(){return this.selectBoolFilterList}getSelectPrimaryFilterName(){return this.selectPrimaryFilterName}getSelectFilterList(){return this.selectFilterList}getCreateAttributes(){let t=this.getMetadata().get(["clientDefs",this.entityType,"relationshipPanels",this.name,"createAttributeMap"])||{},i={};return Object.keys(t).forEach(e=>i[t[e]]=this.model.get(e)),i}setup(){this.nameName=this.name+"Name",this.idName=this.name+"Id",this.foreignScope=this.options.foreignScope||this.foreignScope,this.foreignScope=this.foreignScope||this.model.getFieldParam(this.name,"entity")||this.model.getLinkParam(this.name,"entity"),"createDisabled"in this.options&&(this.createDisabled=this.options.createDisabled),this.isListMode()||(this.addActionHandler("selectLink",()=>this.actionSelect()),this.addActionHandler("clearLink",()=>this.clearLink())),this.isSearchMode()&&(this.addActionHandler("selectLinkOneOf",()=>this.actionSelectOneOf()),this.events['click a[data-action="clearLinkOneOf"]']=e=>{e=$(e.currentTarget).data("id").toString();this.deleteLinkOneOf(e)}),this.panelDefs=this.getMetadata().get(["clientDefs",this.entityType,"relationshipPanels",this.name])||{}}select(t){this.$elementName.val(t.get("name")||t.id),this.$elementId.val(t.get("id")),this.mode===this.MODE_SEARCH&&(this.searchData.idValue=t.get("id"),this.searchData.nameValue=t.get("name")||t.id),this.trigger("change"),this.getSelectFieldHandler().then(e=>{e.getAttributes(t).then(e=>{this.model.set(e)})})}clearLink(){this.$elementName.val(""),this.$elementId.val(""),this.trigger("change"),this.getSelectFieldHandler().then(e=>{e.getClearAttributes().then(e=>{this.model.set(e)})})}getSelectFieldHandler(){return this.panelDefs.selectFieldHandler?new Promise(t=>{Espo.loader.requirePromise(this.panelDefs.selectFieldHandler).then(e=>{e=new e(this.getHelper());t(e)})}):Promise.resolve({getClearAttributes:()=>Promise.resolve({}),getAttributes:()=>Promise.resolve({})})}setupSearch(){this.searchData.oneOfIdList=this.getSearchParamsData().oneOfIdList||this.searchParams.oneOfIdList||[],this.searchData.oneOfNameHash=this.getSearchParamsData().oneOfNameHash||this.searchParams.oneOfNameHash||{},~["is","isNot","equals"].indexOf(this.getSearchType())&&(this.searchData.idValue=this.getSearchParamsData().idValue||this.searchParams.idValue||this.searchParams.value,this.searchData.nameValue=this.getSearchParamsData().nameValue||this.searchParams.nameValue||this.searchParams.valueName),this.events["change select.search-type"]=e=>{e=$(e.currentTarget).val();this.handleSearchType(e)}}handleSearchType(e){~["is","isNot","isNotAndIsNotEmpty"].indexOf(e)?this.$el.find("div.primary").removeClass("hidden"):this.$el.find("div.primary").addClass("hidden"),~["isOneOf","isNotOneOf","isNotOneOfAndIsNotEmpty"].indexOf(e)?this.$el.find("div.one-of-container").removeClass("hidden"):this.$el.find("div.one-of-container").addClass("hidden")}getAutocompleteMaxCount(){return this.autocompleteMaxCount||this.getConfig().get("recordsPerPage")}getAutocompleteUrl(){let t=this.foreignScope+"?maxSize="+this.getAutocompleteMaxCount();if(!this.forceSelectAllAttributes){var i=this.mandatorySelectAttributeList||this.panelDefs.selectMandatoryAttributeList;let e=["id","name"];i&&(e=e.concat(i)),t+="&select="+e.join(",")}i=this.getSelectBoolFilterList(),i&&(t+="&"+$.param({boolFilterList:i})),i=this.getSelectPrimaryFilterName();return i&&(t+="&"+$.param({primaryFilter:i})),t}afterRender(){if(this.isEditMode()||this.isSearchMode()){this.$elementId=this.$el.find('input[data-name="'+this.idName+'"]'),this.$elementName=this.$el.find('input[data-name="'+this.nameName+'"]'),this.$elementName.on("change",()=>{""===this.$elementName.val()&&this.clearLink()}),this.$elementName.on("blur",e=>{setTimeout(()=>{this.mode===this.MODE_EDIT&&this.model.has(this.nameName)&&(e.currentTarget.value=this.model.get(this.nameName))},100),this.autocompleteDisabled||setTimeout(()=>this.$elementName.autocomplete("clear"),300)});let e=this.$elementName;if(!this.autocompleteDisabled){let i=!1;if(this.getEmptyAutocompleteResult&&this.$elementName.on("keydown",e=>{"Tab"===e.code&&i&&e.stopImmediatePropagation()}),this.$elementName.autocomplete({beforeRender:e=>{this.$elementName.hasClass("input-sm")&&e.addClass("small")},serviceUrl:e=>this.getAutocompleteUrl(e),lookup:(e,t)=>{if(0===e.length)return i=!0,void(this.getEmptyAutocompleteResult&&t(this._transformAutocompleteResult(this.getEmptyAutocompleteResult())));i=!1,Espo.Ajax.getRequest(this.getAutocompleteUrl(e),{q:e}).then(e=>{t(this._transformAutocompleteResult(e))})},minChars:0,triggerSelectOnValidInput:!1,autoSelectFirst:!0,noCache:!0,formatResult:e=>this.getHelper().escapeString(e.name),onSelect:t=>{this.getModelFactory().create(this.foreignScope,e=>{e.set(t.attributes),this.select(e),this.$elementName.focus()})}}),this.$elementName.off("focus.autocomplete"),this.$elementName.on("focus",()=>{this.$elementName.val()?this.$elementName.get(0).select():this.$elementName.autocomplete("onFocus")}),this.$elementName.attr("autocomplete","espo-"+this.name),this.once("render",()=>{e.autocomplete("dispose")}),this.once("remove",()=>{e.autocomplete("dispose")}),this.isSearchMode()){let t=this.$el.find("input.element-one-of");t.autocomplete({serviceUrl:()=>this.getAutocompleteUrl(),minChars:1,paramName:"q",noCache:!0,formatResult:e=>this.getHelper().escapeString(e.name),transformResult:e=>this._transformAutocompleteResult(JSON.parse(e)),onSelect:e=>{this.addLinkOneOf(e.id,e.name),t.val(""),setTimeout(()=>t.focus(),50)}}),t.attr("autocomplete","espo-"+this.name),this.once("render",()=>{t.autocomplete("dispose")}),this.once("remove",()=>{t.autocomplete("dispose")}),this.$el.find("select.search-type").on("change",()=>{this.trigger("change")})}}e.on("change",()=>{this.isSearchMode()||this.model.get(this.idName)||e.val(this.model.get(this.nameName))})}var e;this.isSearchMode()&&(e=this.$el.find("select.search-type").val(),this.handleSearchType(e),~["isOneOf","isNotOneOf","isNotOneOfAndIsNotEmpty"].indexOf(e)&&this.searchData.oneOfIdList.forEach(e=>{this.addLinkOneOfHtml(e,this.searchData.oneOfNameHash[e])}))}_transformAutocompleteResult(e){let t=[];return e.list.forEach(e=>{t.push({id:e.id,name:e.name||e.id,data:e.id,value:e.name||e.id,attributes:e})}),{suggestions:t}}getValueForDisplay(){return this.model.get(this.nameName)}validateRequired(){var e;if(this.isRequired()&&null==this.model.get(this.idName))return e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0}deleteLinkOneOf(e){this.deleteLinkOneOfHtml(e);var t=this.searchData.oneOfIdList.indexOf(e);-1<t&&this.searchData.oneOfIdList.splice(t,1),delete this.searchData.oneOfNameHash[e],this.trigger("change")}addLinkOneOf(e,t){~this.searchData.oneOfIdList.indexOf(e)||(this.searchData.oneOfIdList.push(e),this.searchData.oneOfNameHash[e]=t,this.addLinkOneOfHtml(e,t),this.trigger("change"))}deleteLinkOneOfHtml(e){this.$el.find(".link-one-of-container .link-"+e).remove()}addLinkOneOfHtml(e,t){let i=this.$el.find(".link-one-of-container"),s=$("<div>").addClass("link-"+e).addClass("list-group-item");return s.append($("<a>").attr("role","button").addClass("pull-right").attr("data-id",e).attr("data-action","clearLinkOneOf").append($("<span>").addClass("fas fa-times")),$("<span>").text(t)," "),i.append(s),s}fetch(){var e={};return e[this.nameName]=this.$el.find('[data-name="'+this.nameName+'"]').val()||null,e[this.idName]=this.$el.find('[data-name="'+this.idName+'"]').val()||null,e}fetchSearch(){var e=this.$el.find("select.search-type").val(),t=this.$el.find('[data-name="'+this.idName+'"]').val();if(~["isOneOf","isNotOneOf"].indexOf(e)&&!this.searchData.oneOfIdList.length)return{type:"isNotNull",attribute:"id",data:{type:e}};if("isEmpty"===e)return{type:"isNull",attribute:this.idName,data:{type:e}};if("isNotEmpty"===e)return{type:"isNotNull",attribute:this.idName,data:{type:e}};if("isOneOf"===e)return{type:"in",attribute:this.idName,value:this.searchData.oneOfIdList,data:{type:e,oneOfIdList:this.searchData.oneOfIdList,oneOfNameHash:this.searchData.oneOfNameHash}};if("isNotOneOf"===e)return{type:"or",value:[{type:"notIn",attribute:this.idName,value:this.searchData.oneOfIdList},{type:"isNull",attribute:this.idName}],data:{type:e,oneOfIdList:this.searchData.oneOfIdList,oneOfNameHash:this.searchData.oneOfNameHash}};if("isNotOneOfAndIsNotEmpty"===e)return{type:"notIn",attribute:this.idName,value:this.searchData.oneOfIdList,data:{type:e,oneOfIdList:this.searchData.oneOfIdList,oneOfNameHash:this.searchData.oneOfNameHash}};if("isNot"===e){if(!t)return!1;var i=this.$el.find('[data-name="'+this.nameName+'"]').val();return{type:"or",value:[{type:"notEquals",attribute:this.idName,value:t},{type:"isNull",attribute:this.idName}],data:{type:e,idValue:t,nameValue:i}}}if("isNotAndIsNotEmpty"===e){if(!t)return!1;i=this.$el.find('[data-name="'+this.nameName+'"]').val();return{type:"notEquals",attribute:this.idName,value:t,data:{type:e,idValue:t,nameValue:i}}}if(!t)return!1;i=this.$el.find('[data-name="'+this.nameName+'"]').val();return{type:"equals",attribute:this.idName,value:t,data:{type:e,idValue:t,nameValue:i}}}getSearchType(){return this.getSearchParamsData().type||this.searchParams.typeFront||this.searchParams.type}quickView(){var t=this.model.get(this.idName);if(t){var i=this.foreignScope;let e=new s.default(this.getMetadata(),this.getAcl());e.showDetail(this,{id:t,scope:i})}}actionSelect(){Espo.Ui.notify(" ... ");const s=this.panelDefs,a=s.selectModalView||this.getMetadata().get(["clientDefs",this.foreignScope,"modalViews","select"])||this.selectRecordsView,l=this.mandatorySelectAttributeList||s.selectMandatoryAttributeList,e=s.selectHandler||null,r=this.isEditMode()&&(!this.createDisabled&&!s.createDisabled||this.forceCreateButton);let o=null;r&&(o=()=>{let i=this.getCreateAttributes()||{};return s.createHandler?new Promise(t=>{Espo.loader.requirePromise(s.createHandler).then(e=>new e(this.getHelper())).then(e=>{e.getAttributes(this.model).then(e=>{t({...i,...e})})})}):Promise.resolve(i)}),new Promise(t=>{e&&!this.isSearchMode()?Espo.loader.requirePromise(e).then(e=>new e(this.getHelper())).then(e=>{e.getFilters(this.model).then(e=>t(e))}):t({})}).then(e=>{var t={...this.getSelectFilters()||{},...e.advanced||{}},i=[...this.getSelectBoolFilterList()||[],...e.bool||[],...s.selectBoolFilterList||[]],e=this.getSelectPrimaryFilterName()||e.primary||s.selectPrimaryFilter;this.createView("dialog",a,{scope:this.foreignScope,createButton:r,filters:t,boolFilterList:i,primaryFilterName:e,mandatorySelectAttributeList:l,forceSelectAllAttributes:this.forceSelectAllAttributes,filterList:this.getSelectFilterList(),createAttributesProvider:o},e=>{e.render(),Espo.Ui.notify(!1),this.listenToOnce(e,"select",e=>{this.clearView("dialog"),this.select(e)})})})}actionSelectOneOf(){Espo.Ui.notify(" ... ");var e=this.getMetadata().get(["clientDefs",this.foreignScope,"modalViews","select"])||this.selectRecordsView;this.createView("dialog",e,{scope:this.foreignScope,createButton:!1,filters:this.getSelectFilters(),boolFilterList:this.getSelectBoolFilterList(),primaryFilterName:this.getSelectPrimaryFilterName(),multiple:!0},e=>{e.render(),Espo.Ui.notify(!1),this.listenToOnce(e,"select",e=>{this.clearView("dialog"),(e="[object Array]"!==Object.prototype.toString.call(e)?[e]:e).forEach(e=>{this.addLinkOneOf(e.id,e.get("name"))})})})}}e.default=a}),define("views/fields/float",["exports","views/fields/int"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="float";editTemplate="fields/float/edit";decimalMark=".";validations=["required","float","range"];decimalPlacesRawValue=10;setup(){super.setup(),this.getPreferences().has("decimalMark")?this.decimalMark=this.getPreferences().get("decimalMark"):this.getConfig().has("decimalMark")&&(this.decimalMark=this.getConfig().get("decimalMark")),this.decimalMark||(this.decimalMark="."),this.decimalMark===this.thousandSeparator&&(this.thousandSeparator="")}setupAutoNumericOptions(){this.autoNumericOptions={digitGroupSeparator:this.thousandSeparator||"",decimalCharacter:this.decimalMark,modifyValueOnWheel:!1,selectOnFocus:!1,decimalPlaces:this.decimalPlacesRawValue,decimalPlacesRawValue:this.decimalPlacesRawValue,allowDecimalPadding:!1,showWarnings:!1,formulaMode:!0}}getValueForDisplay(){var e=isNaN(this.model.get(this.name))?null:this.model.get(this.name);return this.formatNumber(e)}formatNumber(e){return this.disableFormatting?e:this.formatNumberDetail(e)}formatNumberDetail(e){if(null===e)return"";var t=this.params.decimalPlaces;0===t?e=Math.round(e):t&&(e=Math.round(e*Math.pow(10,t))/Math.pow(10,t));let i=e.toString().split(".");if(i[0]=i[0].replace(/\B(?=(\d{3})+(?!\d))/g,this.thousandSeparator),0===t)return i[0];if(t){e=0;if(1<i.length?e=i[1].length:i[1]="",t&&e<t)for(var s=t-e,a=0;a<s;a++)i[1]+="0"}return i.join(this.decimalMark)}setupMaxLength(){}validateFloat(){var e=this.model.get(this.name);if(isNaN(e))return e=this.translate("fieldShouldBeFloat","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0}parse(e){return null===(e=""!==e?e:null)?null:(e=e.split(this.thousandSeparator).join("").split(this.decimalMark).join("."),parseFloat(e))}fetch(){var e=this.$element.val(),e=this.parse(e);let t={};return t[this.name]=e,t}}e.default=s}),define("ui/multi-select",["exports","lib!selectize"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=(i=t)&&i.__esModule?i:{default:i};const l={init:function(e,t){let i=$(e),s=[],a=((t=l.applyDefaultOptions(t)).removeButton&&s.push("remove_button"),t.draggable&&s.push("drag_drop"),t.restoreOnBackspace&&(l.loadRestoreOnBackspacePlugin(),s.push("restore_on_backspace_espo")),l.loadBypassCtrlEnterPlugin(),s.push("bypass_ctrl_enter"),{options:t.items,plugins:s,delimiter:t.delimiter,labelField:"text",valueField:"value",searchField:["text"],highlight:!1,selectOnTab:t.selectOnTab});t.matchAnyWord||(a.score=function(t){let i=this.getScoreFunction(t);return t=t.toLowerCase(),function(e){return 0===e.text.toLowerCase().indexOf(t)?i(e):0}}),t.matchAnyWord&&(a.score=function(i){let s=this.getScoreFunction(i);return i=i.toLowerCase(),function(e){let t=e.text.toLowerCase();return t.split(" ").find(e=>e.startsWith(i))||t.startsWith(i)?s(e):0}}),t.allowCustomOptions&&(a.persist=!1,a.create=t.create,a.render={option_create:e=>$("<div>").addClass("create").append($("<span>").text(e.input).addClass("text-bold")).append("&hellip;").get(0).outerHTML}),i.selectize(a)},focus:function(t){t=$(t);if(t[0]&&t[0].selectize){let e=t[0].selectize;e.focus()}},applyDefaultOptions:function(e){e=Espo.Utils.clone(e);var t,i={removeButton:!0,draggable:!1,selectOnTab:!1,delimiter:":,:",matchAnyWord:!1,allowCustomOptions:!1};for(t in i)t in e||(e[t]=i[t]);return e},loadBypassCtrlEnterPlugin:function(){if(!("bypass_ctrl_enter"in t.default.plugins)){const i=/Mac/.test(navigator.userAgent);t.default.define("bypass_ctrl_enter",function(){let e=this;this.onKeyDown=function(){let t=e.onKeyDown;return function(e){if("Enter"!==e.code||(i?!e.metaKey:!e.ctrlKey))return t.apply(this,arguments)}}()})}},loadRestoreOnBackspacePlugin:function(){"restore_on_backspace_espo"in t.default.plugins||t.default.define("restore_on_backspace_espo",function(s){s.text=s.text||function(e){return e[this.settings.labelField]};let e=this;this.onKeyDown=function(){let i=e.onKeyDown;return function(e){var t;return"Backspace"===e.code&&""===this.$control_input.val()&&!this.$activeItems.length&&0<=(t=this.caretPos-1)&&t<this.items.length?(t={value:(t=this.options[this.items[t]]).value,$order:t.$order,text:t.value},this.deleteSelection(e)&&(this.setTextboxValue(s.text.apply(this,[t])),this.refreshOptions(!0)),void e.preventDefault()):i.apply(this,arguments)}}()})}};var i=l;e.default=i}),define("helpers/mass-action",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e){this.view=e,this.config=e.getConfig()}checkIsIdle(e){return!this.view.getUser().isPortal()&&(-1===(e=void 0===(e=void 0===e?this.view.options.totalCount:e)&&this.view.collection?this.view.collection.total:e)||e>this.config.get("massActionIdleCountThreshold"))}process(e,t){return Espo.Ui.notify(!1),new Promise(i=>{this.view.createView("dialog","views/modals/mass-action",{id:e,action:t,scope:this.view.scope||this.view.entityType}).then(t=>{t.render(),i(t),this.view.listenToOnce(t,"success",e=>{i(e),this.view.listenToOnce(t,"close",()=>{t.trigger("close:success",e)})})})})}}}),define("helpers/export",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e){this.view=e,this.config=e.getConfig()}checkIsIdle(e){return!this.view.getUser().isPortal()&&(-1===(e=void 0===e?this.view.options.totalCount:e)||e>this.config.get("exportIdleCountThreshold"))}process(e){return Espo.Ui.notify(!1),new Promise(i=>{this.view.createView("dialog","views/export/modals/idle",{id:e}).then(t=>{t.render(),i(t),this.view.listenToOnce(t,"success",e=>{i(e),this.view.listenToOnce(t,"close",()=>{t.trigger("close:success",e)})})})})}}}),define("helpers/list/select-provider",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t,i){this.layoutManager=e,this.metadata=t,this.fieldManager=i}get(i,e){return new Promise(t=>{this.layoutManager.get(i,e||"list",e=>{e=this.getFromLayout(i,e);t(e)})})}getFromLayout(t,e){let i=[];return e.forEach(e=>{e.name&&(e=e.name,this.metadata.get(["entityDefs",t,"fields",e,"type"])&&(i=[this.fieldManager.getEntityTypeFieldAttributeList(t,e),...i]))}),i}}}),define("helpers/reg-exp-pattern",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t){this.metadata=e,this.language=t}validate(e,t,i,s){if(""===t||null===t)return null;let a="fieldNotMatchingPattern";var l,r;"$"===e[0]&&(l=e.slice(1),(r=this.metadata.get(["app","regExpPatterns",l,"pattern"]))&&(a+="$"+l,e=r));let o=new RegExp("^"+e+"$");if(o.test(t))return null;let n=this.language.translate(a,"messages").replace("{pattern}",e);return{message:n=i&&s?n.replace("{field}",this.language.translate(i,"fields",s)):n}}}}),define("web-socket-manager",["exports","js-base64"],function(e,a){"use strict";var t;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a=(t=a)&&t.__esModule?t:{default:t};e.default=class{constructor(t){this.config=t,this.subscribeQueue=[],this.isConnected=!1,this.connection=null,this.url="",this.protocolPart="";let e=this.config.get("webSocketUrl");if(e)0===e.indexOf("wss://")?(this.url=e.substring(6),this.protocolPart="wss://"):(this.url=e.substring(5),this.protocolPart="ws://");else{let e=this.config.get("siteUrl")||"";0===e.indexOf("https://")?(this.url=e.substring(8),this.protocolPart="wss://"):(this.url=e.substring(7),this.protocolPart="ws://"),~this.url.indexOf("/")&&(this.url=this.url.replace(/\/$/,""));var t="wss://"===this.protocolPart?443:8080,i=this.url.indexOf("/");~i?this.url=this.url.substring(0,i)+":"+t:this.url+=":"+t,"wss://"===this.protocolPart&&(this.url+="/wss")}}connect(t,i){var e=a.default.decode(t).split(":")[1],s=this.protocolPart+this.url;s+="?authToken="+e+"&userId="+i;try{this.connection=new ab.Session(s,()=>{this.isConnected=!0,this.subscribeQueue.forEach(e=>{this.subscribe(e.category,e.callback)}),this.subscribeQueue=[]},e=>{e===ab.CONNECTION_CLOSED&&(this.subscribeQueue=[]),e!==ab.CONNECTION_LOST&&e!==ab.CONNECTION_UNREACHABLE||setTimeout(()=>this.connect(t,i),3e3)},{skipSubprotocolCheck:!0})}catch(e){console.error(e.message),this.connection=null}}subscribe(t,e){if(this.connection)if(this.isConnected)try{this.connection.subscribe(t,e)}catch(e){e.message?console.error(e.message):console.error("WebSocket: Could not subscribe to "+t+".")}else this.subscribeQueue.push({category:t,callback:e})}unsubscribe(t,i){if(this.connection){this.subscribeQueue=this.subscribeQueue.filter(e=>e.category!==t&&e.callback!==i);try{this.connection.unsubscribe(t,i)}catch(e){e.message?console.error(e.message):console.error("WebSocket: Could not unsubscribe from "+t+".")}}}close(){if(this.connection){try{this.connection.close()}catch(e){console.error(e.message)}this.isConnected=!1}}}}),define("view-helper",["exports","marked","dompurify","handlebars"],function(e,i,s,v){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,s=t(s),v=t(v);e.default=class{constructor(){this._registerHandlebarsHelpers(),this.mdBeforeList=[{regex:/&#x60;&#x60;&#x60;\n?([\s\S]*?)&#x60;&#x60;&#x60;/g,value:function(e,t){return"<pre><code>"+t.replace(/\*/g,"&#42;").replace(/~/g,"&#126;")+"</code></pre>"}},{regex:/&#x60;([\s\S]*?)&#x60;/g,value:function(e,t){return"<code>"+t.replace(/\*/g,"&#42;").replace(/~/g,"&#126;")+"</code>"}}],i.marked.setOptions({breaks:!0,tables:!1}),s.default.addHook("beforeSanitizeAttributes",function(e){e instanceof HTMLAnchorElement&&(e.getAttribute("target")?e.targetBlank=!0:e.targetBlank=!1)}),s.default.addHook("afterSanitizeAttributes",function(e){e instanceof HTMLAnchorElement&&(e.targetBlank?(e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer")):e.removeAttribute("rel"))})}layoutManager=null;settings=null;config=null;user=null;preferences=null;acl=null;modelFactory=null;collectionFactory=null;router=null;storage=null;sessionStorage=null;dateTime=null;language=null;metadata=null;fieldManager=null;cache=null;themeManager=null;webSocketManager=null;numberUtil=null;pageTitle=null;broadcastChannel=null;basePath="";appParams=null;_registerHandlebarsHelpers(){v.default.registerHelper("img",e=>new v.default.SafeString(`<img src="img/${e}" alt="img">`)),v.default.registerHelper("prop",(e,t)=>{if(t in e)return e[t]}),v.default.registerHelper("var",(e,t,i)=>{if(void 0===t)return null;let s=t[e];return i.hash.trim&&(s=s.trim()),new v.default.SafeString(s)}),v.default.registerHelper("concat",function(e,t){return e+t}),v.default.registerHelper("ifEqual",function(e,t,i){return e==t?i.fn(this):i.inverse(this)}),v.default.registerHelper("ifNotEqual",function(e,t,i){return e!=t?i.fn(this):i.inverse(this)}),v.default.registerHelper("ifPropEquals",function(e,t,i,s){return e[t]==i?s.fn(this):s.inverse(this)}),v.default.registerHelper("ifAttrEquals",function(e,t,i,s){return e.get(t)==i?s.fn(this):s.inverse(this)}),v.default.registerHelper("ifAttrNotEmpty",function(e,t,i){e=e.get(t);return null!=e?i.fn(this):i.inverse(this)}),v.default.registerHelper("ifNotEmptyHtml",function(e,t){return(e=e.replace(/\s/g,""))?t.fn(this):t.inverse(this)}),v.default.registerHelper("get",(e,t)=>e.get(t)),v.default.registerHelper("length",e=>e.length),v.default.registerHelper("translate",(e,t)=>{var i=t.hash.scope||null,t=t.hash.category||null;return"null"===e?"":this.language.translate(e,t,i)}),v.default.registerHelper("dropdownItem",(e,t)=>{var h=t.hash.scope||null,c=t.hash.label,i=t.hash.labelTranslation,s=t.hash.data,u=t.hash.hidden,a=t.hash.disabled,l=t.hash.title,m=t.hash.link,p=t.hash.action||e;let r=t.hash.iconHtml;var f=t.hash.iconClass;let o=t.hash.html||t.hash.text||(i?this.language.translatePath(i):this.language.translate(c,"labels",h));if(t.hash.html||(o=this.escapeString(o)),r)o=r+" "+o;else if(f){const r=$("<span>").addClass(f).get(0).outerHTML;o=r+" "+o}let n=$("<li>").addClass(u?"hidden":"").addClass(a?"disabled":""),d=$("<a>").attr("role","button").attr("tabindex","0").attr("data-name",e).addClass(t.hash.className||"").addClass("action").html(o);if(p&&d.attr("data-action",p),n.append(d),m?d.attr("href",m):d.attr("role","button"),s)for(var g in s)d.attr("data-"+Espo.Utils.camelCaseToHyphen(g),s[g]);return a&&n.attr("disabled","disabled"),l&&d.attr("title",l),new v.default.SafeString(n.get(0).outerHTML)}),v.default.registerHelper("button",(e,t)=>{var i=t.hash.style||"default",s=t.hash.scope||null,h=t.hash.label||e,a=t.hash.labelTranslation,l=t.hash.link;let r=t.hash.iconHtml;var o=t.hash.iconClass;let n=t.hash.html||t.hash.text||(a?this.language.translatePath(a):this.language.translate(h,"labels",s));if(t.hash.html||(n=this.escapeString(n)),r)n=r+" "+n;else if(o){const r=$("<span>").addClass(o).get(0).outerHTML;n=r+" "+n}let d=$(l?"<a>":"<button>").addClass("btn action").addClass(t.hash.className||"").addClass(t.hash.hidden?"hidden":"").addClass(t.hash.disabled?"disabled":"").attr("data-action",e).attr("data-name",e).addClass("btn-"+i).html(n);return l?d.href(l):d.attr("type","button"),t.hash.disabled&&d.attr("disabled","disabled"),t.hash.title&&d.attr("title",t.hash.title),new v.default.SafeString(d.get(0).outerHTML)}),v.default.registerHelper("hyphen",e=>Espo.Utils.convert(e,"c-h")),v.default.registerHelper("toDom",e=>Espo.Utils.toDom(e)),v.default.registerHelper("breaklines",e=>(e=(e=v.default.Utils.escapeExpression(e||"")).replace(/(\r\n|\n|\r)/gm,"<br>"),new v.default.SafeString(e))),v.default.registerHelper("complexText",(e,t)=>this.transformMarkdownText(e,t.hash)),v.default.registerHelper("translateOption",(e,t)=>{var i=t.hash.scope||null,s=t.hash.field||null;if(!s)return"";let a=t.hash.translatedOptions||null;return null===e&&(e=""),(a=null===a&&"object"!=typeof(a=this.language.translate(s,"options",i)||{})?{}:a)[e]||e}),v.default.registerHelper("options",(t,i,e)=>{void 0===i&&(i=!1),t=t||[];let s="",a="[object Array]"===Object.prototype.toString.call(i);e.hash=e.hash||{};let l=e.hash.scope||!1,r=e.hash.category||!1;var h=e.hash.field||!1,c=e.hash.styleMap||{};a||!e.hash.includeMissingOption||!i&&""!==i||~t.indexOf(i)||(t=Espo.Utils.clone(t)).push(i);let o=e.hash.translationHash||e.hash.translatedOptions||null;null!==o||!r&&h&&"object"==typeof(o=this.language.translate(h,"options",l)||{})||(o={});var n,u=e=>r?this.language.translate(e,r,l):o[e]||e;for(n in t){var d=t[n],m=u(d);let e=$("<option>").attr("value",d).addClass(c[d]?"text-"+c[d]:"").text(m);d=t[n],(a?-1!==i.indexOf(d):i===d||!i&&!d)&&e.attr("selected","selected"),s+=e.get(0).outerHTML}return new v.default.SafeString(s)}),v.default.registerHelper("basePath",()=>this.basePath||"")}getAppParam(e){return(this.appParams||{})[e]}escapeString(e){return v.default.Utils.escapeExpression(e)}getAvatarHtml(e,t,i,s){if(this.config.get("avatarsDisabled"))return"";var a=this.cache?this.cache.get("app","timestamp"):Date.now(),l=this.basePath||"";t=t||"small",i=i||16;let r="avatar";return s&&(r+=" "+s),$("<img>").attr("src",l+`?entryPoint=avatar&size=${t}&id=${e}&t=`+a).attr("alt","avatar").addClass(r).attr("width",i.toString()).get(0).outerHTML}transformMarkdownInlineText(e){return this.transformMarkdownText(e,{inline:!0})}transformMarkdownText(t,e){return t=t||"",t=v.default.Utils.escapeExpression(t).replace(/&gt;+/g,">"),this.mdBeforeList.forEach(e=>{t=t.replace(e.regex,e.value)}),t=(e=e||{}).inline?i.marked.parseInline(t):i.marked.parse(t),t=s.default.sanitize(t,{}).toString(),t=(t=e.linksInNewTab?t.replace(/<a href=/gm,'<a target="_blank" rel="noopener noreferrer" href='):t).replace(/<a href="mailto:(.*)"/gm,'<a role="button" class="selectable" data-email-address="$1" data-action="mailTo"'),new v.default.SafeString(t)}getScopeColorIconHtml(t,e,i){if(this.config.get("scopeColorsDisabled")||this.preferences.get("scopeColorsDisabled"))return"";t=this.metadata.get(["clientDefs",t,"color"]);let s="";if(t){let e=$('<span class="color-icon fas fa-square">');e.css("color",t),i&&e.addClass(i),s=e.get(0).outerHTML}return e||s&&(s+='<span style="user-select: none;">&nbsp;</span>'),s}sanitizeHtml(e,t){return s.default.sanitize(e,t)}moderateSanitizeHtml(e){return e=(e=(e=(e=(e=(e=(e=(e=e||"").replace(/<\/?(base)[^><]*>/gi,"")).replace(/<\/?(object)[^><]*>/gi,"")).replace(/<\/?(embed)[^><]*>/gi,"")).replace(/<\/?(applet)[^><]*>/gi,"")).replace(/<\/?(iframe)[^><]*>/gi,"")).replace(/<\/?(script)[^><]*>/gi,"")).replace(/<[^><]*([^a-z]on[a-z]+)=[^><]*>/gi,function(e){return e.replace(/[^a-z]on[a-z]+=/gi," data-handler-stripped=")}),e=(e=(e=(e=(e=this.stripEventHandlersInHtml(e)).replace(/href=" *javascript:(.*?)"/gi,()=>'removed=""')).replace(/href=' *javascript:(.*?)'/gi,()=>'removed=""')).replace(/src=" *javascript:(.*?)"/gi,()=>'removed=""')).replace(/src=' *javascript:(.*?)'/gi,()=>'removed=""')}stripEventHandlersInHtml(i){let e;function s(){i=i.slice(0,a)+i.slice(e),e=a,a=!1}let a=!1,l=!1;for(let t=0;t<i.length;t++)if("<"===i[t]&&i[t+1]&&i[t+1].match(/[a-z?\\\/!]/i))for(let e=++t;e<i.length;e++){if(!l&&">"===i[e]){a&&s(),t=e;break}l!==i[e]?(l||"="!==i[e-1]||"'"!==i[e]&&'"'!==i[e]||(l=i[e]),(a=l||" "!==i[e-2]||"o"!==i[e-1]||"n"!==i[e]?a:e-2)&&" "===i[e]&&!l&&s()):l=!1}return i}calculateContentContainerHeight(e){var t=this.themeManager.getParam("screenWidthXs");let i=$(window);var s=$("#footer").height()||26;let a=0,l=e.get(0);if(l&&(a=l.getBoundingClientRect().top,i.width()<t)){let e=$("#navbar .navbar-body");(e.hasClass("in")||e.hasClass("collapsing"))&&(a-=e.height())}e=a+s;return i.height()-e-20}processSetupHandlers(s,e,t){t=t||s.scope||s.entityType;let i=this.metadata.get(["clientDefs","Global","viewSetupHandlers",e])||[];if(0===(i=t?i.concat(this.metadata.get(["clientDefs",t,"viewSetupHandlers",e])||[]):i).length)return Promise.resolve();let a=[];for(let e of i){var l=new Promise(i=>{Espo.loader.require(e,e=>{let t=new e(s).process(s);t&&"[object Promise]"===Object.prototype.toString.call(t)?t.then(()=>i()):i()})});a.push(l)}return Promise.all(a)}_isXsScreen;isXsScreen(){return null==this._isXsScreen&&(this._isXsScreen=window.innerWidth<this.themeManager.getParam("screenWidthXs")),this._isXsScreen}}}),define("ui",["exports","marked","dompurify","jquery"],function(e,r,o,n){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,o=t(o),n=t(n);class c{height;fitHeight;onRemove;onClose;onBackdropClick;buttons;screenWidthXs;constructor(a){a=a||{},this.className="dialog",this.backdrop="static",this.closeButton=!0,this.collapseButton=!1,this.header=null,this.body="",this.width=null,this.buttonList=[],this.dropdownItemList=[],this.removeOnClose=!0,this.draggable=!1,this.container="body",this.options=a,this.keyboard=!0,this.activeElement=document.activeElement;["className","backdrop","keyboard","closeButton","collapseButton","header","body","width","height","fitHeight","buttons","buttonList","dropdownItemList","removeOnClose","draggable","container","onRemove","onClose","onBackdropClick"].forEach(e=>{e in a&&(this[e]=a[e])}),this.onCloseIsCalled=!1,this.buttons&&this.buttons.length&&(this.buttonList=this.buttons),this.id="dialog-"+Math.floor(1e5*Math.random()),void 0===this.backdrop&&(this.backdrop="static");var e=this.getHeader(),t=this.getFooter(),i=(0,n.default)("<div>").addClass("modal-body body").html(this.body);let s=(0,n.default)("<div>").addClass("modal-content");e&&s.append(e),t&&this.options.footerAtTheTop&&s.append(t),s.append(i),t&&!this.options.footerAtTheTop&&s.append(t);e=(0,n.default)("<div>").addClass("modal-dialog").append(s),i=(0,n.default)(this.container);(0,n.default)("<div>").attr("id",this.id).attr("class",this.className+" modal").attr("role","dialog").attr("tabindex","-1").append(e).appendTo(i),this.$el=(0,n.default)("#"+this.id),this.el=this.$el.get(0),this.$el.find("header a.close").on("click",()=>{}),this.initButtonEvents(),this.draggable&&(this.$el.find("header").css("cursor","pointer"),this.$el.draggable({handle:"header"}));let l=this.$el.find(".modal-content"),r=(this.width&&(l.css("width",this.width),l.css("margin-left","-"+parseInt(this.width.replace("px",""))/5+"px")),this.removeOnClose&&this.$el.on("hidden.bs.modal",e=>{this.$el.get(0)===e.target&&(this.onCloseIsCalled||this.close(),this.skipRemove||this.remove())}),(0,n.default)(window)),o=(this.$el.on("shown.bs.modal",()=>{var e;(0,n.default)(".modal-backdrop").not(".stacked").addClass("stacked");let s=(this.$el.find(".modal-header").outerHeight()||0)+(this.$el.find(".modal-footer").outerHeight()||0);a.fullHeight||(s+=a.bodyDiffHeight),(this.fitHeight||a.fullHeight)&&(e=()=>{var t=window.innerHeight,i=r.width();if(!a.fullHeight&&t<512)this.$el.find("div.modal-body").css({maxHeight:"none",overflow:"auto",height:"none"});else{let e={overflow:"auto"};a.fullHeight?(e.height=t-s+"px",this.$el.css("paddingRight",0)):i<=a.screenWidthXs?e.maxHeight="none":e.maxHeight=t-s+"px",this.$el.find("div.modal-body").css(e)}},r.off("resize.modal-height"),r.on("resize.modal-height",e),e())}),(0,n.default)(document.body));this.$el.on("hidden.bs.modal",()=>{0<(0,n.default)(".modal:visible").length&&o.addClass("modal-open")})}callOnClose(){this.onClose&&this.onClose()}callOnBackdropClick(){this.onBackdropClick&&this.onBackdropClick()}callOnRemove(){this.onRemove&&this.onRemove()}setActionItems(e,t){this.buttonList=e,this.dropdownItemList=t}initButtonEvents(){this.buttonList.forEach(t=>{if("function"==typeof t.onClick){let e=(0,n.default)("#"+this.id+' .modal-footer button[data-name="'+t.name+'"]');e.on("click",e=>t.onClick(this,e))}}),this.dropdownItemList.forEach(t=>{if("function"==typeof t.onClick){let e=(0,n.default)("#"+this.id+' .modal-footer a[data-name="'+t.name+'"]');e.on("click",e=>t.onClick(this,e))}})}getHeader(){if(!this.header)return null;let e=(0,n.default)("<header />").addClass("modal-header").addClass(this.options.fixedHeaderHeight?"fixed-height":"").append((0,n.default)("<h4 />").addClass("modal-title").append((0,n.default)("<span />").addClass("modal-title-text").html(this.header)));return this.collapseButton&&e.prepend((0,n.default)("<a>").addClass("collapse-button").attr("role","button").attr("tabindex","-1").attr("data-action","collapseModal").append((0,n.default)("<span />").addClass("fas fa-minus"))),this.closeButton&&e.prepend((0,n.default)("<a>").addClass("close").attr("data-dismiss","modal").attr("role","button").attr("tabindex","-1").append((0,n.default)("<span />").attr("aria-hidden","true").html("&times;"))),e}getFooter(){if(!this.buttonList.length&&!this.dropdownItemList.length)return null;let e=(0,n.default)("<footer>").addClass("modal-footer"),s=(0,n.default)("<div>").addClass("btn-group").addClass("main-btn-group"),a=(0,n.default)("<div>").addClass("btn-group").addClass("additional-btn-group");this.buttonList.forEach(e=>{var t=e.style||"default";let i=(0,n.default)("<button>").attr("type","button").attr("data-name",e.name).addClass("btn").addClass("btn-"+t).addClass(e.className||"btn-xs-wide");e.disabled&&(i.attr("disabled","disabled"),i.addClass("disabled")),e.hidden&&i.addClass("hidden"),e.title&&i.attr("title",e.title),e.text&&i.text(e.text),e.html&&i.html(e.html),(e.pullLeft||"right"===e.position?a:s).append(i)});var t=0===this.dropdownItemList.filter(e=>!e.hidden).length;let i=(0,n.default)("<div>").addClass("btn-group").addClass(t?"hidden":"").append((0,n.default)("<button>").attr("type","button").addClass("btn btn-default dropdown-toggle").addClass(t?"hidden":"").attr("data-toggle","dropdown").append((0,n.default)("<span>").addClass("fas fa-ellipsis-h"))),l=(0,n.default)("<ul>").addClass("dropdown-menu pull-right");return i.append(l),this.dropdownItemList.forEach(e=>{let t=(0,n.default)("<a>").attr("role","button").attr("tabindex","0").attr("data-name",e.name);e.text&&t.text(e.text),e.title&&t.attr("title",e.title),e.html&&t.html(e.html);e=(0,n.default)("<li>").addClass(e.hidden?" hidden":"").append(t);l.append(e)}),l.children().length&&s.append(i),a.children().length&&e.append(a),e.append(s),e}show(){this.$el.modal({backdrop:this.backdrop,keyboard:this.keyboard}),this.$el.find(".modal-content").removeClass("hidden");let i=(0,n.default)(".modal-backdrop"),s=(i.each((e,t)=>{e<i.length-1&&(0,n.default)(t).addClass("hidden")}),(0,n.default)(".modal-container"));s.each((e,t)=>{e<s.length-1&&(0,n.default)(t).addClass("overlaid")}),this.$el.off("click.dismiss.bs.modal"),this.$el.on("click.dismiss.bs.modal",'> div.modal-dialog > div.modal-content > header [data-dismiss="modal"]',()=>this.close()),this.$el.on("mousedown",e=>{this.$mouseDownTarget=(0,n.default)(e.target)}),this.$el.on("click.dismiss.bs.modal",e=>{e.target===e.currentTarget&&(this.$mouseDownTarget&&this.$mouseDownTarget.closest(".modal-content").length||(this.callOnBackdropClick(),"static"!==this.backdrop&&this.close()))}),(0,n.default)("body > .popover").addClass("hidden")}hide(){this.$el.find(".modal-content").addClass("hidden")}hideWithBackdrop(){let e=(0,n.default)(".modal-backdrop"),t=(e.last().addClass("hidden"),(0,n.default)(e.get(e.length-2)).removeClass("hidden"),(0,n.default)(".modal-container"));(0,n.default)(t.get(t.length-2)).removeClass("overlaid"),this.skipRemove=!0,setTimeout(()=>{this.skipRemove=!1},50),this.$el.modal("hide"),this.$el.find(".modal-content").addClass("hidden")}_close(){let e=(0,n.default)(".modal-backdrop"),t=(e.last().removeClass("hidden"),(0,n.default)(".modal-container"));(0,n.default)(t.get(t.length-2)).removeClass("overlaid")}_findClosestFocusableElement(e){if(!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length))return e.focus({preventScroll:!0}),e;let t=(0,n.default)(e);if(t.closest(".dropdown-menu").length){let e=t.closest(".btn-group").find('[data-toggle="dropdown"]');if(e.length)return e.get(0).focus({preventScroll:!0}),e.get(0)}return null}close(){this.onCloseIsCalled||(this.callOnClose(),this.onCloseIsCalled=!0,this.activeElement&&setTimeout(()=>{let e=this._findClosestFocusableElement(this.activeElement);e&&e.focus({preventScroll:!0})},50)),this._close(),this.$el.modal("hide"),(0,n.default)(this).trigger("dialog:close")}remove(){this.callOnRemove(),this._close(),this.$el.remove(),(0,n.default)(this).off(),(0,n.default)(window).off("resize.modal-height")}}let d=!(Espo.Ui={Dialog:c,confirm:function(i,e,s,a){let l=(e=e||{}).confirmText,r=e.cancelText,o=e.confirmStyle||"danger",n=e.backdrop,d=(void 0===n&&(n=!1),!1),h=()=>{e.cancelCallback&&(a?e.cancelCallback.call(a):e.cancelCallback())};return e.isHtml||(i=Handlebars.Utils.escapeExpression(i)),new Promise(e=>{let t=new c({backdrop:n,header:null,className:"dialog-confirm",body:'<span class="confirm-message">'+i+"</a>",buttonList:[{text:" "+l+" ",name:"confirm",className:"btn-s-wide",onClick:()=>{d=!0,s&&(a?s.call(a):s()),e(),t.close()},style:o,position:"right"},{text:r,name:"cancel",className:"btn-s-wide",onClick:()=>{d=!0,t.close(),h()},position:"left"}],onClose:()=>{d||h()}});t.show(),t.$el.find('button[data-name="confirm"]').focus()})},dialog:function(e){return new c(e)},popover:function(e,i,s){let a=(0,n.default)(e),l=(0,n.default)("body");var t,e=i.content||Handlebars.Utils.escapeExpression(i.text||"");let r=!1,o=i.container;if(o||(t=a.closest(".modal-body"),o=t.length?t:"body"),a.popover({placement:i.placement||"bottom",container:o,viewport:o,html:!0,content:e,trigger:i.trigger||"manual"}).on("shown.bs.popover",()=>{r=!0,s&&(l.off("click.popover-"+s.cid),l.on("click.popover-"+s.cid,e=>{(0,n.default)(e.target).closest(".popover-content").get(0)||n.default.contains(a.get(0),e.target)||a.get(0)!==e.target&&(l.off("click.popover-"+s.cid),a.popover("hide"))}),i.onShow&&i.onShow())}).on("hidden.bs.popover",()=>{r=!1,i.onHide&&i.onHide()}),i.noToggleInit||a.on("click",()=>{a.popover("toggle")}),s){let e=()=>{r&&a.popover("hide")},t=()=>{a.popover("destroy"),l.off("click.popover-"+s.cid),s.off("remove",t),s.off("render",t),s.off("render",e)};s.once("remove",t),i.preventDestroyOnRender||s.once("render",t),i.preventDestroyOnRender&&s.on("render",e)}},notify:function(i,s,a,l){if(s=s||"warning",l={...l},("warning"!==s||!d)&&((0,n.default)("#notification").remove(),i)){l.suppress&&a&&(d=!0,setTimeout(()=>d=!1,a));i=-1!==i.indexOf("\n")?r.marked.parse(i):r.marked.parseInline(i);let e=o.default.sanitize(i,{}).toString();i=l.closeButton||!1,l=("error"===s&&(s="danger")," ... "===e&&(e=' <span class="fas fa-spinner fa-spin"> '),i?" alert-closable":"");let t=(0,n.default)("<div>").addClass("alert alert-"+s+l+" fade in").attr("id","notification").css({position:"fixed",top:"0",left:"50vw",transform:"translate(-50%, 0)","z-index":2e3}).append((0,n.default)("<div>").addClass("message").html(e));if(i){let e=(0,n.default)("<button>").attr("type","button").attr("data-dismiss","modal").attr("aria-hidden","true").addClass("close").html("&times;");t.append((0,n.default)("<div>").addClass("close-container").append(e)),e.on("click",()=>t.alert("close"))}a&&setTimeout(()=>t.alert("close"),a),t.appendTo("body")}},warning:function(e,t){Espo.Ui.notify(e,"warning",2e3,t)},success:function(e,t){Espo.Ui.notify(e,"success",2e3,t)},error:function(e,t){var i=(t="boolean"==typeof t?{closeButton:t}:{...t}).closeButton?0:4e3;Espo.Ui.notify(e,"danger",i,t)},info:function(e,t){Espo.Ui.notify(e,"info",2e3,t)}});Espo.ui=Espo.Ui;var i=Espo.Ui;e.default=i}),define("theme-manager",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t,i,s){this.config=e,this.preferences=t,this.metadata=i,this.name=s||null}defaultParams={screenWidthXs:768,dashboardCellHeight:155,dashboardCellMargin:19};getName(){if(this.name)return this.name;if(!this.config.get("userThemesDisabled")){var e=this.preferences.get("theme");if(e&&""!==e)return e}return this.config.get("theme")}getAppliedName(){let e=window.getComputedStyle(document.body).getPropertyValue("--theme-name");return e?e.trim():null}isApplied(){var e=this.getAppliedName();return!e||this.getName()===e}getStylesheet(){let e=this.getParam("stylesheet")||"client/css/espo/espo.css";return this.config.get("cacheTimestamp")&&(e+="?r="+this.config.get("cacheTimestamp").toString()),e}getIframeStylesheet(){let e=this.getParam("stylesheetIframe")||"client/css/espo/espo-iframe.css";return this.config.get("cacheTimestamp")&&(e+="?r="+this.config.get("cacheTimestamp").toString()),e}getIframeFallbackStylesheet(){let e=this.getParam("stylesheetIframeFallback")||"client/css/espo/espo-iframe.css";return this.config.get("cacheTimestamp")&&(e+="?r="+this.config.get("cacheTimestamp").toString()),e}getParam(e){if("params"!==e&&"mappedParams"!==e){var t=this.getVarParam(e);if(null!==t)return t;t=this.getMappedParam(e);if(null!==t)return t}let i=this.metadata.get(["themes",this.getName(),e]);return null!==i||null!==(i=this.metadata.get(["themes",this.getParentName(),e]))?i:this.defaultParams[e]||null}getVarParam(e){var t=this.getParam("params")||{};if(!(e in t))return null;let i=null;return(i=(i=!this.config.get("userThemesDisabled")&&this.preferences.get("theme")?this.preferences.get("themeParams"):i)||this.config.get("themeParams"))&&e in i?i[e]:"default"in t[e]?t[e].default:null}getMappedParam(e){var t=this.getParam("mappedParams")||{};if(!(e in t))return null;var i=t[e].param,t=t[e].valueMap;return i&&t?t[this.getParam(i)]:null}getParentName(){return this.metadata.get(["themes",this.getName(),"parent"])||"Espo"}isUserTheme(){if(this.config.get("userThemesDisabled"))return!1;var e=this.preferences.get("theme");return!(!e||""===e)&&e!==this.config.get("theme")}}}),define("storage",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(){}prefix="espo";storageObject=localStorage;composeFullPrefix(e){return this.prefix+"-"+e}composeKey(e,t){return this.composeFullPrefix(e)+"-"+t}checkType(e){if(void 0===e&&"[object String]"!==toString.call(e)||"cache"===e)throw new TypeError('Bad type "'+e+'" passed to Espo.Storage.')}has(e,t){this.checkType(e);e=this.composeKey(e,t);return null!==this.storageObject.getItem(e)}get(e,i){this.checkType(e);e=this.composeKey(e,i);try{var s=this.storageObject.getItem(e)}catch(e){return console.error(e),null}if(s){let t=s;if(9<s.length&&"__JSON__:"===s.substring(0,9)){i=s.slice(9);try{t=JSON.parse(i)}catch(e){t=s}}else if("{"===s[0]||"["===s[0])try{t=JSON.parse(s)}catch(e){t=s}return t}return null}set(e,t,i){if(this.checkType(e),null!==i){var s=this.composeKey(e,t);(i instanceof Object||Array.isArray(i)||!0===i||!1===i||"number"==typeof i)&&(i="__JSON__:"+JSON.stringify(i));try{this.storageObject.setItem(s,i)}catch(e){return console.error(e),null}}else this.clear(e,t)}clear(e,t){let i,s=(i=void 0!==e?void 0===t?"^"+this.composeFullPrefix(e):"^"+this.composeKey(e,t):"^"+this.prefix+"-",new RegExp(i));for(var a in this.storageObject)s.test(a)&&delete this.storageObject[a]}}}),define("session-storage",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{storageObject=sessionStorage;get(e){try{var i=this.storageObject.getItem(e)}catch(e){return console.error(e),null}if(i){let t=i;if(9<i.length&&"__JSON__:"===i.substring(0,9)){e=i.slice(9);try{t=JSON.parse(e)}catch(e){t=i}}return t}return null}set(e,t){if(null!==t){(t instanceof Object||Array.isArray(t)||!0===t||!1===t||"number"==typeof t)&&(t="__JSON__:"+JSON.stringify(t));try{this.storageObject.setItem(e,t)}catch(e){console.error(e)}}else this.clear(e)}has(e){return null!==this.storageObject.getItem(e)}clear(e){for(var t in this.storageObject)t===e&&delete this.storageObject[t]}}}),define("router",["exports","backbone"],function(e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=(n=(t=n)&&t.__esModule?t:{default:t}).default.Router.extend({routeList:[{route:"clearCache",resolution:"clearCache"},{route:":controller/view/:id/:options",resolution:"view"},{route:":controller/view/:id",resolution:"view"},{route:":controller/edit/:id/:options",resolution:"edit"},{route:":controller/edit/:id",resolution:"edit"},{route:":controller/create",resolution:"create"},{route:":controller/related/:id/:link",resolution:"related"},{route:":controller/:action/:options",resolution:"action",order:100},{route:":controller/:action",resolution:"action",order:200},{route:":controller",resolution:"defaultAction",order:300},{route:"*actions",resolution:"home",order:500}],_bindRoutes:function(){},setupRoutes:function(){if(this.routeParams={},this.options.routes){let i=[];Object.keys(this.options.routes).forEach(e=>{var t=this.options.routes[e];i.push({route:e,resolution:t.resolution||"defaultRoute",order:t.order||0}),this.routeParams[e]=t.params||{}}),this.routeList=Espo.Utils.clone(this.routeList),i.forEach(e=>{this.routeList.push(e)}),this.routeList=this.routeList.sort((e,t)=>(e.order||0)-(t.order||0))}this.routeList.reverse().forEach(e=>{this.route(e.route,e.resolution)})},_last:null,confirmLeaveOut:!1,backProcessed:!1,confirmLeaveOutMessage:"Are you sure?",confirmLeaveOutConfirmText:"Yes",confirmLeaveOutCancelText:"No",initialize:function(e){this.options=e||{},this.setupRoutes(),this.history=[];let t=[window.location.hash];window.addEventListener("hashchange",()=>{var e=window.location.hash;if(1<t.length&&t[t.length-2]===e)return t=t.slice(0,-1),this.backProcessed=!0,void setTimeout(()=>this.backProcessed=!1,50);t.push(e)}),this.on("route",()=>{this.history.push(n.default.history.fragment)}),window.addEventListener("beforeunload",e=>{if(e=e||window.event,this.confirmLeaveOut)return e.preventDefault(),e.returnValue=this.confirmLeaveOutMessage,this.confirmLeaveOutMessage})},getCurrentUrl:function(){return"#"+n.default.history.fragment},checkConfirmLeaveOut:function(e,t,i){return this.confirmLeaveOutDisplayed?(this.navigateBack({trigger:!1}),void(this.confirmLeaveOutCanceled=!0)):(t=t||this,this.confirmLeaveOut?(this.confirmLeaveOutDisplayed=!0,this.confirmLeaveOutCanceled=!1,void Espo.Ui.confirm(this.confirmLeaveOutMessage,{confirmText:this.confirmLeaveOutConfirmText,cancelText:this.confirmLeaveOutCancelText,backdrop:!0,cancelCallback:()=>{this.confirmLeaveOutDisplayed=!1,i&&this.navigateBack({trigger:!1})}},()=>{this.confirmLeaveOutDisplayed=!1,this.confirmLeaveOut=!1,this.confirmLeaveOutCanceled||e.call(t)})):void e.call(t))},route:function(t,a){let l=t;_.isRegExp(t)||(t=this._routeToRegExp(t));let r,o=(r=this["_"+a],this);return n.default.history.route(t,function(e){let i=o._extractParameters(t,e),s={};if("defaultRoute"===a){let t=[];l.split("/").forEach(e=>{e&&0===e.indexOf(":")&&t.push(e.substr(1))}),t.forEach((e,t)=>{s[e]=i[t]})}o.execute(r,i,a,l,s),o.trigger.apply(o,["route:"+a].concat(i)),o.trigger("route",a,i),n.default.history.trigger("route",o,a,i)}),this},execute:function(e,t,i,s,a){this.checkConfirmLeaveOut(()=>{"defaultRoute"!==i?n.default.Router.prototype.execute.call(this,e,t,i):this._defaultRoute(this.routeParams[s],a)},null,!0)},navigate:function(e,t){return this.history.push(e),n.default.Router.prototype.navigate.call(this,e,t)},navigateBack:function(e){let t;t=1<this.history.length?this.history[this.history.length-2]:this.history[0],this.navigate(t,e)},_parseOptionsParams:function(e){if(!e)return{};if(-1===e.indexOf("&")&&-1===e.indexOf("="))return e;let t={};return void 0!==e&&e.split("&").forEach(e=>{e=e.split("=");t[e[0]]=!0,1<e.length&&(t[e[0]]=e[1])}),t},_defaultRoute:function(e,t){var i=e.controller||t.controller,e=e.action||t.action;this.dispatch(i,e,t)},_record:function(e,t,i,s){(s=this._parseOptionsParams(s)).id=i,this.dispatch(e,t,s)},_view:function(e,t,i){this._record(e,"view",t,i)},_edit:function(e,t,i){this._record(e,"edit",t,i)},_related:function(e,t,i,s){(s=this._parseOptionsParams(s)).id=t,s.link=i,this.dispatch(e,"related",s)},_create:function(e,t){this._record(e,"create",null,t)},_action:function(e,t,i){this.dispatch(e,t,this._parseOptionsParams(i))},_defaultAction:function(e){this.dispatch(e,null)},_home:function(){this.dispatch("Home",null)},_clearCache:function(){this.dispatch(null,"clearCache")},logout:function(){this.dispatch(null,"logout"),this.navigate("",{trigger:!1})},dispatch:function(e,t,i){e={controller:e,action:t,options:i};this._last=e,this.trigger("routed",e)},getLast:function(){return this._last}});e.default=t,n.default.history.getHash=function(e){e=(e||this).location.href.match(/#(.*)$/);return e?this.decodeFragment(e[1]):""},e=window.navigator.userAgent,/(iPhone|iPad|iPod).* OS 9_\d/.test(e)&&!/Version\/9\./.test(e)&&(n.default.history.loadUrl=function(i,s){return i=this.fragment=this.getFragment(i),_.any(this.handlers,function(t){if(t.route.test(i))return function e(){s===location.hash?window.setTimeout(e,50):t.callback(i)}(),!0})},n.default.history.navigate=function(e,t){if(!n.default.History.started)return!1;t&&!0!==t||(t={trigger:!!t});let i=this.root+"#"+(e=this.getFragment(e||""));if(e=e.replace(/#.*$/,""),this.fragment!==e){""===(this.fragment=e)&&"/"!==i&&(i=i.slice(0,-1));var s=location.hash;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}return t.trigger?this.loadUrl(e,s):void 0}})}),define("page-title",["exports","jquery"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=(i=t)&&i.__esModule?i:{default:i};e.default=class{constructor(e){this.displayNotificationNumber=e.get("newNotificationCountInTitle")||!1,this.title=(0,t.default)("head title").text()||"",this.notificationNumber=0}setTitle(e){this.title=e,this.update()}setNotificationNumber(e){this.notificationNumber=e,this.displayNotificationNumber&&this.update()}update(){let e="";this.displayNotificationNumber&&this.notificationNumber&&(e="("+this.notificationNumber.toString()+")",this.title&&(e+=" ")),e+=this.title,(0,t.default)("head title").text(e)}}}),define("number-util",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t){this.config=e,this.preferences=t,this.thousandSeparator=null,this.decimalMark=null,this.config.on("change",()=>{this.thousandSeparator=null,this.decimalMark=null}),this.preferences.on("change",()=>{this.thousandSeparator=null,this.decimalMark=null}),this.maxDecimalPlaces=10}formatInt(e){if(null==e)return"";let t=e.toString();return t=t.replace(/\B(?=(\d{3})+(?!\d))/g,this.getThousandSeparator())}formatFloat(e,t){if(null==e)return"";let i=(e=0===t?Math.round(e):t?Math.round(e*Math.pow(10,t))/Math.pow(10,t):Math.round(e*Math.pow(10,this.maxDecimalPlaces))/Math.pow(10,this.maxDecimalPlaces)).toString().split(".");if(i[0]=i[0].replace(/\B(?=(\d{3})+(?!\d))/g,this.getThousandSeparator()),0===t)return i[0];if(t){let e=0;if(1<i.length?e=i[1].length:i[1]="",t&&e<t){var s=t-e;for(let e=0;e<s;e++)i[1]+="0"}}return i.join(this.getDecimalMark())}getThousandSeparator(){if(null!==this.thousandSeparator)return this.thousandSeparator;let e=".";return this.preferences.has("thousandSeparator")?e=this.preferences.get("thousandSeparator"):this.config.has("thousandSeparator")&&(e=this.config.get("thousandSeparator")),this.thousandSeparator=e}getDecimalMark(){if(null!==this.decimalMark)return this.decimalMark;let e=".";return this.preferences.has("decimalMark")?e=this.preferences.get("decimalMark"):this.config.has("decimalMark")&&(e=this.config.get("decimalMark")),this.decimalMark=e}}}),define("model-factory",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e){this.metadata=e}dateTime=null;create(i,s,a){return new Promise(t=>{a=a||this,this.getSeed(i,e=>{e=new e({},{entityType:i,defs:this.metadata.get(["entityDefs",i])||{},dateTime:this.dateTime});s&&s.call(a,e),t(e)})})}getSeed(e,t){e=this.metadata.get(["clientDefs",e,"model"])||"model";Espo.loader.require(e,e=>t(e))}}}),define("metadata",["exports","bullbone"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i{constructor(e){this.cache=e||null,this.data={}}url="Metadata";load(e,t){return this.off("sync"),e&&this.once("sync",e),!t&&this.loadFromCache()?(this.trigger("sync"),new Promise(e=>e())):new Promise(e=>{this.fetch().then(()=>e())})}loadSkipCache(){return this.load(null,!0)}fetch(){return Espo.Ajax.getRequest(this.url).then(e=>{this.data=e,this.storeToCache(),this.trigger("sync")})}get(e,t){t=t||null;let i,s=(i=Array&&Array.isArray&&Array.isArray(e)?e:e.split("."),this.data),a=t;for(var l=0;l<i.length;l++){var r=i[l];if(!(r in s)){a=t;break}i.length-1===l&&(a=s[r]),s=s[r]}return a}loadFromCache(){if(this.cache){var e=this.cache.get("app","metadata");if(e)return this.data=e,!0}return null}storeToCache(){this.cache&&this.cache.set("app","metadata",this.data)}clearCache(){this.cache&&this.cache.clear("app","metadata")}getScopeList(){var e,t=this.get("scopes")||{};let i=[];for(e in t)t[e].disabled||i.push(e);return i}getScopeObjectList(){var e,t=this.get("scopes")||{};let i=[];for(e in t){var s=t[e];s.disabled||s.object&&i.push(e)}return i}getScopeEntityList(){var e,t=this.get("scopes")||{};let i=[];for(e in t){var s=t[e];s.disabled||s.entity&&i.push(e)}return i}}Object.assign(i.prototype,t.Events),e.default=i}),define("layout-manager",["exports","bullbone"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i{constructor(e,t,i){this.cache=e||null,this.applicationId=t||"default-id",this.userId=i||null,this.data={},this.ajax=Espo.Ajax}setUserId(e){this.userId=e}getKey(e,t){return this.userId?this.applicationId+"-"+this.userId+"-"+e+"-"+t:this.applicationId+"-"+e+"-"+t}getUrl(e,t,i){let s=e+"/layout/"+t;return i&&(s+="/"+i),s}get(e,t,i,s){void 0===s&&(s=!0);let a=this.getKey(e,t);if(s&&a in this.data)"function"==typeof i&&i(this.data[a]);else{if(this.cache&&s){s=this.cache.get("app-layout",a);if(s)return"function"==typeof i&&i(s),void(this.data[a]=s)}this.ajax.getRequest(this.getUrl(e,t)).then(e=>{"function"==typeof i&&i(e),this.data[a]=e,this.cache&&this.cache.set("app-layout",a,e)})}}getOriginal(e,t,i,s){let a="Layout/action/getOriginal?scope="+e+"&name="+t;i&&(a+="&setId="+i),Espo.Ajax.getRequest(a).then(e=>{"function"==typeof s&&s(e)})}set(t,i,e,s,a){return Espo.Ajax.putRequest(this.getUrl(t,i,a),e).then(()=>{var e=this.getKey(t,i);this.cache&&e&&this.cache.clear("app-layout",e),delete this.data[e],this.trigger("sync"),"function"==typeof s&&s()})}resetToDefault(t,i,s,e){Espo.Ajax.postRequest("Layout/action/resetToDefault",{scope:t,name:i,setId:e}).then(()=>{var e=this.getKey(t,i);this.cache&&this.cache.clear("app-layout",e),delete this.data[e],this.trigger("sync"),"function"==typeof s&&s()})}clearLoadedData(){this.data={}}}Object.assign(i.prototype,t.Events),e.default=i}),define("language",["exports","bullbone"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i{url="I18n";constructor(e){this.cache=e||null,this.data={},this.name="default"}has(e,t,i){return i in this.data&&t in this.data[i]&&e in this.data[i][t]}get(e,t,i){return e in this.data&&t in this.data[e]&&i in this.data[e][t]?this.data[e][t][i]:"Global"===e&&i}translate(e,t,i){let s=this.get(i=i||"Global",t=t||"labels",e);return s=!1===s&&"Global"!==i?this.get("Global",t,e):s}translateOption(e,t,i){let s=this.translate(t,"options",i);return(s="object"!=typeof s?{}:s)[e]||e}loadFromCache(e){let t=this.name;if(e&&(t="default"),this.cache){e=this.cache.get("app","language-"+t);if(e)return this.data=e,!0}return null}clearCache(){this.cache&&this.cache.clear("app","language-"+this.name)}storeToCache(e){let t=this.name;e&&(t="default"),this.cache&&this.cache.set("app","language-"+t,this.data)}load(e,t,i){return e&&this.once("sync",e),!t&&this.loadFromCache(i)?(this.trigger("sync"),new Promise(e=>e())):new Promise(e=>{this.fetch(i).then(()=>e())})}loadDefault(){return this.load(null,!1,!0)}loadSkipCache(){return this.load(null,!0)}loadDefaultSkipCache(){return this.load(null,!0,!0)}fetch(t){return Espo.Ajax.getRequest(this.url,{default:t}).then(e=>{this.data=e,this.storeToCache(t),this.trigger("sync")})}sortFieldList(i,e){return e.sort((e,t)=>this.translate(e,"fields",i).localeCompare(this.translate(t,"fields",i)))}sortEntityList(e,t){let i="scopeNames";return t&&(i+="Plural"),e.sort((e,t)=>this.translate(e,i).localeCompare(this.translate(t,i)))}translatePath(e){("string"==typeof e||e instanceof String)&&(e=e.split("."));let t=this.data;return e.forEach(e=>{e in t&&(t=t[e])}),t}}Object.assign(i.prototype,t.Events),e.default=i}),define("field-manager",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t,i){this.defs=e||{},this.metadata=t,this.acl=i}getParamList(e){return e in this.defs&&this.defs[e].params||[]}checkFilter(e){return e in this.defs&&("filter"in this.defs[e]&&this.defs[e].filter)}isMergeable(e){return e in this.defs&&!this.defs[e].notMergeable}getEntityTypeAttributeList(e){let t=[],i=this.metadata.get("entityDefs."+e+".fields")||{};return Object.keys(i).forEach(e=>{this.getAttributeList(i[e].type,e).forEach(e=>{~t.indexOf(e)||t.push(e)})}),t}getActualAttributeList(i,s){let a=[];if(i in this.defs)if("actualFields"in this.defs[i]){let e=this.defs[i].actualFields,t="suffix";"prefix"===(t="naming"in this.defs[i]?this.defs[i].naming:t)?e.forEach(e=>{a.push(e+Espo.Utils.upperCaseFirst(s))}):e.forEach(e=>{a.push(s+Espo.Utils.upperCaseFirst(e))})}else a.push(s);return a}getNotActualAttributeList(i,s){let a=[];if(i in this.defs&&"notActualFields"in this.defs[i]){let e=this.defs[i].notActualFields,t="suffix";"prefix"===(t="naming"in this.defs[i]?this.defs[i].naming:t)?e.forEach(e=>{""===e?a.push(s):a.push(e+Espo.Utils.upperCaseFirst(s))}):e.forEach(e=>{a.push(s+Espo.Utils.upperCaseFirst(e))})}return a}getEntityTypeFieldAttributeList(e,t){var i=this.metadata.get(["entityDefs",e,"fields",t,"type"]);return i?_.union(this.getAttributeList(i,t),this._getEntityTypeFieldAdditionalAttributeList(e,t)):[]}getEntityTypeFieldActualAttributeList(e,t){var i=this.metadata.get(["entityDefs",e,"fields",t,"type"]);return i?_.union(this.getActualAttributeList(i,t),this._getEntityTypeFieldAdditionalAttributeList(e,t)):[]}_getEntityTypeFieldAdditionalAttributeList(e,t){var i=this.metadata.get(["entityDefs",e,"fields",t,"type"]);if(!i)return[];let s=this.metadata.get(["entityDefs",e,"fields",t,"additionalAttributeList"])||[];if(0===s.length)return[];let a="prefix"===(this.defs[i]||{}).naming,l=[];return s.forEach(e=>{a?l.push(e+Espo.Utils.upperCaseFirst(t)):l.push(t+Espo.Utils.upperCaseFirst(e))}),l}getAttributeList(e,t){return _.union(this.getActualAttributeList(e,t),this.getNotActualAttributeList(e,t))}getEntityTypeFieldList(i,e){let s=Object.keys(this.metadata.get(["entityDefs",i,"fields"])||{}),t=(e=e||{}).typeList;if((t=!t&&e.type?[e.type]:t)&&(s=s.filter(e=>{e=this.metadata.get(["entityDefs",i,"fields",e,"type"]);return~t.indexOf(e)})),(e.onlyAvailable||e.acl)&&(s=s.filter(e=>this.isEntityTypeFieldAvailable(i,e))),e.acl){e=e.acl||"read";let t=this.acl.getScopeForbiddenFieldList(i,e);s=s.filter(e=>!~t.indexOf(e))}return s}getScopeFieldList(e){return this.getEntityTypeFieldList(e)}getEntityTypeFieldParam(e,t,i){return this.metadata.get(["entityDefs",e,"fields",t,i])}getViewName(e){return e in this.defs&&"view"in this.defs[e]?this.defs[e].view:"views/fields/"+Espo.Utils.camelCaseToHyphen(e)}getParams(e){return this.getParamList(e)}getAttributes(e,t){return this.getAttributeList(e,t)}getActualAttributes(e,t){return this.getActualAttributeList(e,t)}getNotActualAttributes(e,t){return this.getNotActualAttributeList(e,t)}isEntityTypeFieldAvailable(e,t){var i=this.metadata.get(["entityDefs",e,"fields",t])||{};if(i.disabled||i.utility)return!1;i=this.metadata.get(["entityAcl",e,"fields",t])||{};return!(i.onlyAdmin||i.forbidden||i.internal)}isScopeFieldAvailable(e,t){return this.isEntityTypeFieldAvailable(e,t)}}}),define("date-time",["exports","moment"],function(e,a){"use strict";var t;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a=(t=a)&&t.__esModule?t:{default:t};e.default=class{constructor(){}internalDateFormat="YYYY-MM-DD";internalDateTimeFormat="YYYY-MM-DD HH:mm";internalDateTimeFullFormat="YYYY-MM-DD HH:mm:ss";dateFormat="MM/DD/YYYY";timeFormat="HH:mm";timeZone=null;weekStart=1;readableDateFormatMap={"DD.MM.YYYY":"DD MMM","DD/MM/YYYY":"DD MMM"};readableShortDateFormatMap={"DD.MM.YYYY":"D MMM","DD/MM/YYYY":"D MMM"};hasMeridian(){return new RegExp("A","i").test(this.timeFormat)}getDateFormat(){return this.dateFormat}getTimeFormat(){return this.timeFormat}getDateTimeFormat(){return this.dateFormat+" "+this.timeFormat}getReadableDateFormat(){return this.readableDateFormatMap[this.getDateFormat()]||"MMM DD"}getReadableShortDateFormat(){return this.readableShortDateFormatMap[this.getDateFormat()]||"MMM D"}getReadableDateTimeFormat(){return this.getReadableDateFormat()+" "+this.timeFormat}getReadableShortDateTimeFormat(){return this.getReadableShortDateFormat()+" "+this.timeFormat}fromDisplayDate(e){let t=(0,a.default)(e,this.dateFormat);return t.isValid()?t.format(this.internalDateFormat):-1}getTimeZone(){return this.timeZone||"UTC"}toDisplayDate(e){if(!e||"string"!=typeof e)return"";let t=(0,a.default)(e,this.internalDateFormat);return t.isValid()?t.format(this.dateFormat):""}fromDisplay(e){let t;return(t=this.timeZone?a.default.tz(e,this.getDateTimeFormat(),this.timeZone).utc():a.default.utc(e,this.getDateTimeFormat())).isValid()?t.format(this.internalDateTimeFormat)+":00":-1}toDisplay(e){return e?this.toMoment(e).format(this.getDateTimeFormat()):""}getNowMoment(){return(0,a.default)().tz(this.getTimeZone())}toMomentDate(e){return a.default.utc(e,this.internalDateFormat)}toMoment(e){let t=a.default.utc(e,this.internalDateTimeFullFormat);return t=this.timeZone?t.tz(this.timeZone):t}fromIso(e){if(!e)return"";let t=(0,a.default)(e).utc();return t.format(this.internalDateTimeFormat)}toIso(e){return this.toMoment(e).format()}getToday(){return(0,a.default)().tz(this.getTimeZone()).format(this.internalDateFormat)}getDateTimeShiftedFromNow(e,t,i){if(!i)return a.default.utc().add(e,t).format(this.internalDateTimeFormat);var s=(0,a.default)().unix();return a.default.unix(s-=s%(60*i)).utc().add(e,t).format(this.internalDateTimeFormat)}getDateShiftedFromToday(e,t){return a.default.tz(this.getTimeZone()).add(e,t).format(this.internalDateFormat)}getNow(e){if(!e)return a.default.utc().format(this.internalDateTimeFormat);var t=(0,a.default)().unix();return a.default.unix(t-=t%(60*e)).utc().format(this.internalDateTimeFormat)}setSettingsAndPreferences(e,t){e.has("dateFormat")&&(this.dateFormat=e.get("dateFormat")),e.has("timeFormat")&&(this.timeFormat=e.get("timeFormat")),e.has("timeZone")&&(this.timeZone=e.get("timeZone")||null,"UTC"===this.timeZone&&(this.timeZone=null)),e.has("weekStart")&&(this.weekStart=e.get("weekStart")),t.on("change",e=>{e.has("dateFormat")&&e.get("dateFormat")&&(this.dateFormat=e.get("dateFormat")),e.has("timeFormat")&&e.get("timeFormat")&&(this.timeFormat=e.get("timeFormat")),e.has("timeZone")&&e.get("timeZone")&&(this.timeZone=e.get("timeZone")),e.has("weekStart")&&-1!==e.get("weekStart")&&(this.weekStart=e.get("weekStart")),"UTC"===this.timeZone&&(this.timeZone=null)})}setLanguage(e){a.default.updateLocale("en",{months:e.translatePath(["Global","lists","monthNames"]),monthsShort:e.translatePath(["Global","lists","monthNamesShort"]),weekdays:e.translatePath(["Global","lists","dayNames"]),weekdaysShort:e.translatePath(["Global","lists","dayNamesShort"]),weekdaysMin:e.translatePath(["Global","lists","dayNamesMin"])}),a.default.locale("en")}}}),define("collection-factory",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t,i){this.modelFactory=e,this.metadata=i,this.recordListMaxSizeLimit=t.get("recordListMaxSizeLimit")||200}create(o,n,d){return new Promise(r=>{d=d||this,this.modelFactory.getSeed(o,i=>{let s=this.modelFactory.metadata.get(["entityDefs",o,"collection","orderBy"]),a=this.modelFactory.metadata.get(["entityDefs",o,"collection","order"]);var e=this.modelFactory.metadata.get(["clientDefs",o,"collection"])||"collection";let l=this.metadata.get(["entityDefs",o])||{};Espo.loader.require(e,e=>{let t=new e(null,{entityType:o,orderBy:s,order:a,defs:l});t.model=i,t.entityType=o,t.maxMaxSize=this.recordListMaxSizeLimit,n&&n.call(d,t),r(t)})})})}}}),define("cache",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e){this.basePrefix=this.prefix,e&&(this.prefix=this.basePrefix+"-"+e),this.get("app","timestamp")||this.storeTimestamp()}prefix="cache";handleActuality(e){var t=this.getCacheTimestamp();t&&t===e||(this.clear(),this.set("app","cacheTimestamp",e),this.storeTimestamp())}getCacheTimestamp(){return parseInt(this.get("app","cacheTimestamp")||0)}storeTimestamp(){var e=Date.now();this.set("app","timestamp",e)}composeFullPrefix(e){return this.prefix+"-"+e}composeKey(e,t){return this.composeFullPrefix(e)+"-"+t}checkType(e){if(void 0===e&&"[object String]"!==toString.call(e))throw new TypeError('Bad type "'+e+'" passed to Cache().')}get(e,i){this.checkType(e);e=this.composeKey(e,i);let s;try{s=localStorage.getItem(e)}catch(e){return console.error(e),null}if(s){let t=s;if(9<s.length&&"__JSON__:"===s.substring(0,9)){i=s.slice(9);try{t=JSON.parse(i)}catch(e){t=s}}return t}return null}set(e,t,i){this.checkType(e);e=this.composeKey(e,t);(i instanceof Object||Array.isArray(i))&&(i="__JSON__:"+JSON.stringify(i));try{localStorage.setItem(e,i)}catch(e){console.log("Local storage limit exceeded.")}}clear(e,t){let i,s=(i=void 0!==e?void 0===t?"^"+this.composeFullPrefix(e):"^"+this.composeKey(e,t):"^"+this.basePrefix+"-",new RegExp(i));for(var a in localStorage)s.test(a)&&delete localStorage[a]}}}),define("broadcast-channel",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(){this.object=null,window.BroadcastChannel&&(this.object=new window.BroadcastChannel("app"))}postMessage(e){this.object&&this.object.postMessage(e)}subscribe(e){this.object&&this.object.addEventListener("message",e)}}}),define("ajax",["exports","jquery"],function(e,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,c=(i=c)&&i.__esModule?i:{default:i};let t=!1,u,m,p,v,f,g;const y=window.location.origin+window.location.pathname,s=Espo.Ajax={request:function(e,t,i,a){var h="timeout"in(a=a||{})?a.timeout:u,s=a.contentType||"application/json";let l;a.data&&!i&&(i=a.data),m&&(e=Espo.Utils.trimSlash(m)+"/"+e),!["GET","OPTIONS"].includes(t)&&i&&(l=i,"application/json"===s&&"string"!=typeof i&&(l=JSON.stringify(i))),"GET"===t&&i&&(i=c.default.param(i),e.includes("?")?e+="&":e+="?",e+=i);i=new URL(y+e);let r=new w;if(r.timeout=h,r.open(t,i),r.setRequestHeader("Content-Type",s),a.headers)for(var o in a.headers)r.setRequestHeader(o,a.headers[o]);p&&p(r,a);let n={},d=new b((t,i)=>{const s=e=>{a.error&&a.error(r,a),i(r,a),e?g&&g(r,a):f&&f(r,a)};r.ontimeout=()=>s(!0),r.onerror=()=>s(),r.onload=()=>{if(400<=r.status)s();else{let e=r.responseText;if("json"===(a.dataType||"json"))try{e=JSON.parse(r.responseText)}catch(e){console.error("Could not parse API response."),s()}a.success&&a.success(e),v(r,a),a.resolveWithXhr&&(e=r),t(e)}},r.send(l),n.promise?n.promise.xhr=r:n.xhr=r});return(n.promise=d).xhr=d.xhr||n.xhr,d},postRequest:function(e,t,i){return t=t&&JSON.stringify(t),s.request(e,"POST",t,i)},patchRequest:function(e,t,i){return t=t&&JSON.stringify(t),s.request(e,"PATCH",t,i)},putRequest:function(e,t,i){return t=t&&JSON.stringify(t),s.request(e,"PUT",t,i)},deleteRequest:function(e,t,i){return t=t&&JSON.stringify(t),s.request(e,"DELETE",t,i)},getRequest:function(e,t,i){return s.request(e,"GET",t,i)},configure:function(e){if(t)throw new Error("Ajax is already configured.");m=e.apiUrl,u=e.timeout,p=e.beforeSend,v=e.onSuccess,f=e.onError,g=e.onTimeout,t=!0}};class b extends Promise{xhr=null;isAborted=!1;fail(...e){return this.catch(e[0])}done(...e){return this.then(e[0])}abort(){this.isAborted=!0,this.xhr&&this.xhr.abort()}getReadyState(){return this.xhr&&this.xhr.readyState||0}getStatus(){return this.xhr?this.xhr.status:0}}class w extends XMLHttpRequest{errorIsHandled=!1}var i=s;e.default=i}),define("acl-portal",["exports","acl"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkScope(e,t,i,s){var a=(s=s||{}).inAccount,l=s.isOwnContact,s=s.isOwner;if(this.getUser().isAdmin())return!0;if(!1===e)return!1;if(!0===e)return!0;if("string"==typeof e)return!0;if(null===e)return!1;if(null===(t=t||null))return!0;if(!(t in e))return!1;e=e[t];if("all"===e)return!0;if("yes"===e)return!0;if("no"===e)return!1;if(void 0===s)return!0;if(s&&("own"===e||"account"===e||"contact"===e))return!0;t=!1;if("account"===e)if(null===(t=a)){if(!i)return!0;t=null}else if(a)return!0;if("contact"===e)if(null===(t=l)){if(!i)return!0;t=null}else if(l)return!0;if(null===s){if(!i)return!0;t=null}return t}checkModel(e,t,i,s){if(this.getUser().isAdmin())return!0;e={isOwner:this.checkIsOwner(e),inAccount:this.checkInAccount(e),isOwnContact:this.checkIsOwnContact(e)};return this.checkScope(t,i,s,e)}checkIsOwner(e){return!(!e.hasField("createdBy")||this.getUser().id!==e.get("createdById"))}checkInAccount(e){let t=this.getUser().getLinkMultipleIdList("accounts");if(!t.length)return!1;if(e.hasField("account")&&e.get("accountId")&&~t.indexOf(e.get("accountId")))return!0;var i=!1;return e.hasField("accounts")&&e.hasLink("accounts")&&(e.has("accountsIds")||(i=null),e.getLinkMultipleIdList("accounts").forEach(e=>{~t.indexOf(e)&&(i=!0)})),!(!e.hasField("parent")||!e.hasLink("parent")||"Account"!==e.get("parentType")||t.indexOf(e.get("parentId")))||(!(!1!==i||e.hasField("accounts")||!e.hasLink("accounts"))||i)}checkIsOwnContact(e){let t=this.getUser().get("contactId");if(!t)return!1;if(e.hasField("contact")&&e.get("contactId")&&t===e.get("contactId"))return!0;let i=!1;return e.hasField("contacts")&&e.hasLink("contacts")&&(e.has("contactsIds")||(i=null),e.getLinkMultipleIdList("contacts").forEach(e=>{t===e&&(i=!0)})),!(!e.hasField("parent")||!e.hasLink("parent")||"Contact"!==e.get("parentType")||e.get("parentId")!==t)||(!(!1!==i||e.hasField("contacts")||!e.hasLink("contacts"))||i)}}e.default=s}),define("acl-manager",["exports","acl","utils","bullbone"],function(e,a,o,t){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a=i(a),o=i(o);class s{data=null;fieldLevelList=["yes","no"];constructor(e,t,i){this.setEmpty(),this.user=e||null,this.implementationClassMap=t||{},this.aclAllowDeleteCreated=i}setEmpty(){this.data={table:{},fieldTable:{},fieldTableQuickAccess:{}},this.implementationHash={},this.forbiddenFieldsCache={},this.implementationClassMap={},this.forbiddenAttributesCache={}}getImplementation(i){if(!(i in this.implementationHash)){let e=a.default,t=(i in this.implementationClassMap&&(e=this.implementationClassMap[i]),this.getScopeForbiddenFieldList(i));var s={aclAllowDeleteCreated:this.aclAllowDeleteCreated,teamsFieldIsForbidden:!!~t.indexOf("teams"),forbiddenFieldList:t};this.implementationHash[i]=new e(this.getUser(),i,s)}return this.implementationHash[i]}getUser(){return this.user}set(e){this.data=e=e||{},this.data.table=this.data.table||{},this.data.fieldTable=this.data.fieldTable||{},this.data.attributeTable=this.data.attributeTable||{}}get(e){return this.data[e]||null}getPermissionLevel(e){let t=e;return"Permission"!==e.slice(-10)&&(t=e+"Permission"),this.data[t]||"no"}getLevel(e,t){return e in this.data.table&&"object"==typeof this.data.table[e]&&t in this.data.table[e]?this.data.table[e][t]:null}clear(){this.setEmpty()}checkScopeHasAcl(e){return void 0!==(this.data.table||{})[e]}checkScope(e,t,i){let s=(this.data.table||{})[e];return void 0===s&&(s=null),this.getImplementation(e).checkScope(s,t,i)}checkModel(e,t,i){var s=e.entityType;if("edit"===t&&!e.isEditable())return!1;if("delete"===t&&!e.isRemovable())return!1;let a=(this.data.table||{})[s],l=(void 0===a&&(a=null),this.getImplementation(s));if(t){s="checkModel"+o.default.upperCaseFirst(t);if(s in l)return l[s](e,a,i)}return l.checkModel(e,a,t,i)}check(e,t,i){return"string"==typeof e?this.checkScope(e,t,i):this.checkModel(e,t,i)}checkIsOwner(e){return this.getImplementation(e.entityType).checkIsOwner(e)}checkInTeam(e){return this.getImplementation(e.entityType).checkInTeam(e)}checkAssignmentPermission(e){return this.checkPermission("assignmentPermission",e)}checkUserPermission(e){return this.checkPermission("userPermission",e)}checkPermission(e,i){if(this.getUser().isAdmin())return!0;e=this.getPermissionLevel(e);if("no"===e)return i.id===this.getUser().id;if("team"!==e)return"all"===e||"yes"===e;{if(!i.has("teamsIds"))return!1;let t=!1,e=i.get("teamsIds")||[];return e.forEach(e=>{~(this.getUser().get("teamsIds")||[]).indexOf(e)&&(t=!0)}),t}}getScopeForbiddenFieldList(e,t,i){var s=e+"_"+(t=t||"read")+"_"+(i=i||"no");if(s in this.forbiddenFieldsCache)return o.default.clone(this.forbiddenFieldsCache[s]);let a=this.fieldLevelList.slice(this.fieldLevelList.indexOf(i)),l=(((this.data.fieldTableQuickAccess||{})[e]||{}).fields||{})[t]||{},r=[];return a.forEach(e=>{let t=l[e]||[];t.forEach(e=>{~r.indexOf(e)||r.push(e)})}),this.forbiddenFieldsCache[s]=r,o.default.clone(r)}getScopeForbiddenAttributeList(e,t,i){var s=e+"_"+(t=t||"read")+"_"+(i=i||"no");if(s in this.forbiddenAttributesCache)return o.default.clone(this.forbiddenAttributesCache[s]);let a=this.fieldLevelList.slice(this.fieldLevelList.indexOf(i)),l=(((this.data.fieldTableQuickAccess||{})[e]||{}).attributes||{})[t]||{},r=[];return a.forEach(e=>{let t=l[e]||[];t.forEach(e=>{~r.indexOf(e)||r.push(e)})}),this.forbiddenAttributesCache[s]=r,o.default.clone(r)}checkTeamAssignmentPermission(e){return"all"===this.getPermissionLevel("assignmentPermission")||!!~this.getUser().getLinkMultipleIdList("teams").indexOf(e)}checkField(e,t,i){return!~this.getScopeForbiddenFieldList(e,i).indexOf(t)}}s.extend=t.View.extend,e.default=s}),define("views/modal",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{constructor(e){super(e)}cssName="modal-dialog";className="dialog";header;headerHtml;$header;headerElement;headerText;dialog;containerSelector="";scope=null;backdrop="static";buttonList=[];dropdownItemList=[];buttons=[];width=null;fitHeight=!1;noFullHeight=!1;escapeDisabled=!1;isDraggable=!1;isCollapsable=!1;isCollapsed=!1;events={"click .action":function(e){Espo.Utils.handleAction(this,e.originalEvent,e.currentTarget)},'click [data-action="collapseModal"]':function(){this.collapse()}};footerAtTheTop=null;shortcutKeys=null;init(){const s=this.cssName+"-container-"+Math.floor(1e4*Math.random()+1).toString();this.containerSelector="#"+s,this.header=this.options.header||this.header,this.headerHtml=this.options.headerHtml||this.headerHtml,this.$header=this.options.$header||this.$header,this.headerElement=this.options.headerElement||this.headerElement,this.headerText=this.options.headerText||this.headerText,this.backdrop=this.options.backdrop||this.backdrop,this.setSelector(this.containerSelector),this.buttonList=this.options.buttonList||this.buttonList,this.dropdownItemList=this.options.dropdownItemList||this.dropdownItemList,this.buttonList=Espo.Utils.cloneDeep(this.buttonList),this.dropdownItemList=Espo.Utils.cloneDeep(this.dropdownItemList),this.buttons=Espo.Utils.cloneDeep(this.buttons),this.shortcutKeys&&(this.shortcutKeys=Espo.Utils.cloneDeep(this.shortcutKeys)),this.on("render",()=>{this.dialog&&this.dialog.close(),this.isCollapsed=!1,$(this.containerSelector).remove(),$("<div />").css("display","none").attr("id",s).addClass("modal-container").appendTo("body");let e=92,t=(null!==this.getThemeManager().getParam("modalBodyDiffHeight")&&(e=this.getThemeManager().getParam("modalBodyDiffHeight")),this.headerHtml||this.header);this.$header&&this.$header.length&&(t=this.$header.get(0).outerHTML),this.headerElement&&(t=this.headerElement.outerHTML),this.headerText&&(t=Handlebars.Utils.escapeExpression(this.headerText));var i=null!==this.footerAtTheTop?this.footerAtTheTop:this.getThemeManager().getParam("modalFooterAtTheTop");this.dialog=new Espo.Ui.Dialog({backdrop:this.backdrop,header:t,container:this.containerSelector,body:"",buttonList:this.getDialogButtonList(),dropdownItemList:this.getDialogDropdownItemList(),width:this.width,keyboard:!this.escapeDisabled,fitHeight:this.fitHeight,draggable:this.isDraggable,className:this.className,bodyDiffHeight:e,footerAtTheTop:i,fullHeight:!this.noFullHeight&&this.getThemeManager().getParam("modalFullHeight"),screenWidthXs:this.getThemeManager().getParam("screenWidthXs"),fixedHeaderHeight:this.fixedHeaderHeight,closeButton:!this.noCloseButton,collapseButton:this.isCollapsable,onRemove:()=>this.onDialogClose(),onBackdropClick:()=>this.onBackdropClick()}),this.setElement(this.containerSelector+" .body")}),this.on("after:render",()=>{$(this.containerSelector).show(),this.dialog.show(),this.fixedHeaderHeight&&this.flexibleHeaderFontSize&&this.adjustHeaderFontSize(),this.adjustButtons(),this.noFullHeight||this.initBodyScrollListener()}),this.once("remove",()=>{this.dialog&&this.dialog.close(),$(this.containerSelector).remove()})}setupFinal(){this.shortcutKeys&&(this.events["keydown.modal-base"]=e=>{var t,i,s=Espo.Utils.getKeyFromKeyEvent(e);"function"!=typeof this.shortcutKeys[s]?(t=this.shortcutKeys[s])&&(this.hasActionItem(t)&&!this.hasAvailableActionItem(t)||(e.preventDefault(),e.stopPropagation(),"function"!=typeof this[i="action"+Espo.Utils.upperCaseFirst(t)]?this[t]():this[i]())):this.shortcutKeys[s].call(this,e.originalEvent)})}getDialogButtonList(){let i=[];return this.buttons.forEach(e=>{let t=Espo.Utils.clone(e);!("text"in t)&&"label"in t&&(t.text=this.getLanguage().translate(t.label)),i.push(t)}),this.buttonList.forEach(e=>{let s={};if("string"==typeof e)s.name=e;else{if("object"!=typeof e)return;s=e}s.text||(s.labelTranslation?s.text=this.getLanguage().translatePath(s.labelTranslation):"label"in s?s.text=this.translate(s.label,"labels",this.scope):s.text=this.translate(s.name,"modalActions",this.scope)),s.onClick=s.onClick||((e,t)=>{var i=s.handler||(s.data||{}).handler;Espo.Utils.handleAction(this,t.originalEvent,t.currentTarget,{action:s.name,handler:i})}),i.push(s)}),i}getDialogDropdownItemList(){let t=[];return this.dropdownItemList.forEach(e=>{let s={};if("string"==typeof e)s.name=e;else{if("object"!=typeof e)return;s=e}s.text||(s.labelTranslation?s.text=this.getLanguage().translatePath(s.labelTranslation):"label"in s?s.text=this.translate(s.label,"labels",this.scope):s.text=this.translate(s.name,"modalActions",this.scope)),s.onClick=s.onClick||((e,t)=>{var i=s.handler||(s.data||{}).handler;Espo.Utils.handleAction(this,t.originalEvent,t.currentTarget,{action:s.name,handler:i})}),t.push(s)}),t}updateDialog(){this.dialog&&this.dialog.setActionItems(this.getDialogButtonList(),this.getDialogDropdownItemList())}onDialogClose(){this.isBeingRendered()||this.isCollapsed||(this.trigger("close"),this.remove())}onBackdropClick(){}actionCancel(){this.trigger("cancel"),this.dialog.close()}actionClose(){this.trigger("cancel"),this.dialog.close()}close(){this.dialog.close()}disableButton(t){this.buttonList.forEach(e=>{e.name===t&&(e.disabled=!0)}),this.isRendered()&&this.$el.find('footer button[data-name="'+t+'"]').addClass("disabled").attr("disabled","disabled")}enableButton(t){this.buttonList.forEach(e=>{e.name===t&&(e.disabled=!1)}),this.isRendered()&&this.$el.find('footer button[data-name="'+t+'"]').removeClass("disabled").removeAttr("disabled")}addButton(i,s,e){let a=-1;this.buttonList.forEach((e,t)=>{e.name===i.name&&(a=t)}),~a||(!0===s?this.buttonList.unshift(i):"string"==typeof s?(a=-1,this.buttonList.forEach((e,t)=>{e.name===s&&(a=t)}),~a?this.buttonList.splice(a,0,i):this.buttonList.push(i)):this.buttonList.push(i),!e&&this.isRendered()&&this.reRenderFooter())}addDropdownItem(e,t,i){if(e){var s=e.name;if(s){for(var a of this.dropdownItemList)if(a.name===s)return;t?this.dropdownItemList.unshift(e):this.dropdownItemList.push(e),!i&&this.isRendered()&&this.reRenderFooter()}}else t?this.dropdownItemList.unshift(!1):this.dropdownItemList.push(!1)}reRenderFooter(){var e;this.dialog&&(this.updateDialog(),e=this.dialog.getFooter(),this.$el.find("footer.modal-footer").empty().append(e),this.dialog.initButtonEvents())}removeButton(e,t){let i=-1;for(var[s,a]of this.buttonList.entries())if(a.name===e){i=s;break}~i&&this.buttonList.splice(i,1);for(var[l,r]of this.dropdownItemList.entries())if(r.name===e){this.dropdownItemList.splice(l,1);break}this.isRendered()&&this.$el.find('.modal-footer [data-name="'+e+'"]').remove(),!t&&this.isRendered()&&this.reRender()}showButton(e){for(var t of this.buttonList)if(t.name===e){t.hidden=!1;break}this.isRendered()&&(this.$el.find('footer button[data-name="'+e+'"]').removeClass("hidden"),this.adjustButtons())}hideButton(e){for(var t of this.buttonList)if(t.name===e){t.hidden=!0;break}this.isRendered()&&(this.$el.find('footer button[data-name="'+e+'"]').addClass("hidden"),this.adjustButtons())}showActionItem(e){for(var t of this.buttonList)if(t.name===e){t.hidden=!1;break}for(var i of this.dropdownItemList)if(i.name===e){i.hidden=!1;break}if(this.isRendered()){if(this.$el.find('footer button[data-name="'+e+'"]').removeClass("hidden"),this.$el.find('footer li > a[data-name="'+e+'"]').parent().removeClass("hidden"),!this.isDropdownItemListEmpty()){let e=this.$el.find("footer .main-btn-group > .btn-group");e.removeClass("hidden"),e.find("> button").removeClass("hidden")}this.adjustButtons()}}hideActionItem(e){for(var t of this.buttonList)if(t.name===e){t.hidden=!0;break}for(var i of this.dropdownItemList)if(i.name===e){i.hidden=!0;break}if(this.isRendered()){if(this.$el.find('footer button[data-name="'+e+'"]').addClass("hidden"),this.$el.find('footer li > a[data-name="'+e+'"]').parent().addClass("hidden"),this.isDropdownItemListEmpty()){let e=this.$el.find("footer .main-btn-group > .btn-group");e.addClass("hidden"),e.find("> button").addClass("hidden")}this.adjustButtons()}}hasActionItem(t){return-1!==this.buttonList.findIndex(e=>e.name===t)||-1!==this.dropdownItemList.findIndex(e=>e.name===t)}hasAvailableActionItem(t){return-1!==this.buttonList.findIndex(e=>e.name===t&&!e.disabled&&!e.hidden)||-1!==this.dropdownItemList.findIndex(e=>e.name===t&&!e.disabled&&!e.hidden)}isDropdownItemListEmpty(){if(0===this.dropdownItemList.length)return!0;let t=!0;return this.dropdownItemList.forEach(e=>{e.hidden||(t=!1)}),t}adjustHeaderFontSize(e){(e=e||0)||(this.fontSizePercentage=100);let t=this.$el.find(".modal-title > .modal-title-text");var i=t.parent().width();let s=0;if(t.children().each((e,t)=>{s+=$(t).outerWidth(!0)}),i<s){if(5<e){let e=this.$el.find(".modal-title");return e.attr("title",t.text()),e.addClass("overlapped"),void t.children().each((e,t)=>{$(t).removeAttr("title")})}this.fontSizePercentage-=4,this.$el.find(".modal-title .font-size-flexible").css("font-size",this.fontSizePercentage+"%"),this.adjustHeaderFontSize(e+1)}}collapse(){this.beforeCollapse().then(e=>{if(!this.getParentView())throw new Error("Can't collapse w/o parent view.");this.isCollapsed=!0;let t;if((e=e||{}).title)t=e.title;else{let e=this.$el.find(".modal-header .modal-title .modal-title-text");t=e.text()}this.dialog.close();let i=this;for(;i.getParentView();)i=i.getParentView();this.unchainFromParent(),new Promise(t=>{i.hasView("collapsedModalBar")?t(i.getView("collapsedModalBar")):i.createView("collapsedModalBar","views/collapsed-modal-bar",{fullSelector:"body > .collapsed-modal-bar"}).then(e=>t(e))}).then(e=>{e.addModalView(this,{title:t})})})}unchainFromParent(){var e=this.getParentView().getViewKey(this);this.getParentView().unchainView(e)}beforeCollapse(){return new Promise(e=>e())}adjustButtons(){this.adjustLeftButtons(),this.adjustRightButtons()}adjustLeftButtons(){let e=this.$el.find("footer.modal-footer > .main-btn-group button.btn"),t=(e.removeClass("radius-left").removeClass("radius-right"),e.filter("button:not(.hidden)"));t.first().addClass("radius-left"),t.last().addClass("radius-right")}adjustRightButtons(){let e=this.$el.find("footer.modal-footer > .additional-btn-group button.btn:not(.btn-text)"),t=(e.removeClass("radius-left").removeClass("radius-right").removeClass("margin-right"),e.filter("button:not(.hidden)"));t.first().addClass("radius-left"),t.last().addClass("radius-right"),t.last().next().hasClass("btn-text")&&t.last().addClass("margin-right")}initBodyScrollListener(){let e=this.$el.find("> .dialog > .modal-dialog > .modal-content > .modal-body"),t=e.parent().find("> .modal-footer");t.length&&(e.off("scroll.footer-shadow"),e.on("scroll.footer-shadow",()=>{e.scrollTop()?t.addClass("shadowed"):t.removeClass("shadowed")}))}}e.default=s}),define("views/list",["exports","views/main","search-manager"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{template="list";name="List";optionsToPass=[];headerView="views/header";searchView="views/record/search";recordView="views/record/list";recordKanbanView="views/record/kanban";searchPanel=!0;searchManager=null;createButton=!0;quickCreate=!1;storeViewAfterCreate=!1;storeViewAfterUpdate=!0;keepCurrentRootUrl=!1;viewMode="";viewModeList=null;defaultViewMode="list";MODE_LIST="list";MODE_KANBAN="kanban";shortcutKeys={"Control+Space":function(e){this.handleShortcutKeyCtrlSpace(e)},"Control+Slash":function(e){this.handleShortcutKeyCtrlSlash(e)},"Control+Comma":function(e){this.handleShortcutKeyCtrlComma(e)},"Control+Period":function(e){this.handleShortcutKeyCtrlPeriod(e)}};setup(){this.collection.maxSize=this.getConfig().get("recordsPerPage")||this.collection.maxSize,this.collectionUrl=this.collection.url,this.collectionMaxSize=this.collection.maxSize,this.setupModes(),this.setViewMode(this.viewMode),this.getMetadata().get(["clientDefs",this.scope,"searchPanelDisabled"])&&(this.searchPanel=!1),this.getUser().isPortal()&&this.getMetadata().get(["clientDefs",this.scope,"searchPanelInPortalDisabled"])&&(this.searchPanel=!1),this.getMetadata().get(["clientDefs",this.scope,"createDisabled"])&&(this.createButton=!1),this.entityType=this.collection.entityType,this.headerView=this.options.headerView||this.headerView,this.recordView=this.options.recordView||this.recordView,this.searchView=this.options.searchView||this.searchView,this.setupHeader(),this.defaultOrderBy=this.defaultOrderBy||this.collection.orderBy,this.defaultOrder=this.defaultOrder||this.collection.order,this.collection.setOrder(this.defaultOrderBy,this.defaultOrder,!0),this.searchPanel&&this.setupSearchManager(),this.setupSorting(),this.searchPanel&&this.setupSearchPanel(),this.createButton&&this.setupCreateButton(),this.options.params&&this.options.params.fromAdmin&&(this.keepCurrentRootUrl=!0)}setupFinal(){super.setupFinal(),this.wait(this.getHelper().processSetupHandlers(this,"list"))}setupModes(){this.defaultViewMode=this.options.defaultViewMode||this.getMetadata().get(["clientDefs",this.scope,"listDefaultViewMode"])||this.defaultViewMode,this.viewMode=this.viewMode||this.defaultViewMode;var t=this.options.viewModeList||this.viewModeList||this.getMetadata().get(["clientDefs",this.scope,"listViewModeList"]);if(t?this.viewModeList=t:(this.viewModeList=[this.MODE_LIST],this.getMetadata().get(["clientDefs",this.scope,"kanbanViewMode"])&&(~this.viewModeList.indexOf(this.MODE_KANBAN)||this.viewModeList.push(this.MODE_KANBAN))),1<this.viewModeList.length){let e=null;var t="listViewMode"+this.scope;!this.getStorage().has("state",t)||(t=this.getStorage().get("state",t))&&this.viewModeList.includes(t)&&(e=t),e=e||this.defaultViewMode,this.viewMode=e}}setupHeader(){this.createView("header",this.headerView,{collection:this.collection,fullSelector:"#main > .page-header",scope:this.scope,isXsSingleRow:!0})}setupCreateButton(){this.quickCreate?this.menu.buttons.unshift({action:"quickCreate",iconHtml:'<span class="fas fa-plus fa-sm"></span>',text:this.translate("Create "+this.scope,"labels",this.scope),style:"default",acl:"create",aclScope:this.entityType||this.scope,title:"Ctrl+Space"}):this.menu.buttons.unshift({link:"#"+this.scope+"/create",action:"create",iconHtml:'<span class="fas fa-plus fa-sm"></span>',text:this.translate("Create "+this.scope,"labels",this.scope),style:"default",acl:"create",aclScope:this.entityType||this.scope,title:"Ctrl+Space"})}setupSearchPanel(){this.createSearchView()}createSearchView(){return this.createView("search",this.searchView,{collection:this.collection,fullSelector:"#main > .search-container",searchManager:this.searchManager,scope:this.scope,viewMode:this.viewMode,viewModeList:this.viewModeList,isWide:!0},e=>{this.listenTo(e,"reset",()=>this.resetSorting()),1<this.viewModeList.length&&this.listenTo(e,"change-view-mode",e=>this.switchViewMode(e))})}switchViewMode(e){this.clearView("list"),this.collection.isFetched=!1,this.collection.reset(),this.applyStoredSorting(),this.setViewMode(e,!0),this.loadList()}setViewMode(e,t){this.viewMode=e,this.collection.url=this.collectionUrl,this.collection.maxSize=this.collectionMaxSize,t&&(t="listViewMode"+this.scope,this.getStorage().set("state",t,e)),this.searchView&&this.getView("search")&&this.getSearchView().setViewMode(e),this.viewMode!==this.MODE_KANBAN?this[t="setViewMode"+Espo.Utils.upperCaseFirst(this.viewMode)]&&this[t]():this.setViewModeKanban()}setViewModeKanban(){this.collection.url="Kanban/"+this.scope,this.collection.maxSize=this.getConfig().get("recordsPerPageKanban"),this.collection.resetOrderToDefault()}resetSorting(){this.getStorage().clear("listSorting",this.collection.entityType)}getSearchDefaultData(){return this.getMetadata().get("clientDefs."+this.scope+".defaultFilterData")}setupSearchManager(){let e=this.collection;const t=new i.default(e,"list",this.getStorage(),this.getDateTime(),this.getSearchDefaultData());t.scope=this.scope,t.loadStored(),e.where=t.getWhere(),this.searchManager=t}setupSorting(){this.searchPanel&&this.applyStoredSorting()}applyStoredSorting(){var e=this.getStorage().get("listSorting",this.collection.entityType)||{};"orderBy"in e&&(this.collection.orderBy=e.orderBy),"order"in e&&(this.collection.order=e.order)}getSearchView(){return this.getView("search")}getRecordView(){return this.getView("list")}getRecordViewName(){let e=this.getMetadata().get(["clientDefs",this.scope,"recordViews",this.viewMode]);if(e)return e;if(this.viewMode===this.MODE_LIST)return this.recordView;if(this.viewMode===this.MODE_KANBAN)return this.recordKanbanView;var t="record"+Espo.Utils.upperCaseFirst(this.viewMode)+"View";if(!(e=this[t]))throw new Error("No record view.");return e}cancelRender(){this.hasView("list")&&(this.getRecordView(),this.getRecordView().isBeingRendered()&&this.getRecordView().cancelRender()),super.cancelRender()}afterRender(){Espo.Ui.notify(!1),this.hasView("list")||this.loadList(),this.$el.get(0).focus({preventScroll:!0})}loadList(){"isFetched"in this.collection&&this.collection.isFetched?this.createListRecordView(!1):(Espo.Ui.notify(" ... "),this.createListRecordView(!0))}prepareRecordViewOptions(e){}createListRecordView(t){let i={collection:this.collection,selector:".list-container",scope:this.scope,skipBuildRows:!0,shortcutKeysEnabled:!0,forceDisplayTopBar:!0};this.getHelper().isXsScreen()&&(i.type="listSmall"),this.optionsToPass.forEach(e=>{i[e]=this.options[e]}),this.keepCurrentRootUrl&&(i.keepCurrentRootUrl=!0),(this.getConfig().get("listPagination")||this.getMetadata().get(["clientDefs",this.scope,"listPagination"]))&&(console.warn("'listPagination' parameter is deprecated and will be removed in the future."),i.pagination=!0),this.prepareRecordViewOptions(i);var e=this.getRecordViewName();return this.createView("list",e,i,e=>{this.hasParentView()?(this.listenToOnce(e,"after:render",()=>{this.hasParentView()||(e.undelegateEvents(),this.clearView("list"))}),t||Espo.Ui.notify(!1),this.searchPanel&&this.listenTo(e,"sort",e=>{this.getStorage().set("listSorting",this.collection.entityType,e)}),t?e.getSelectAttributeList(e=>{this.options.mediator&&this.options.mediator.abort||(e&&(this.collection.data.select=e.join(",")),Espo.Ui.notify(" ... "),this.collection.fetch({main:!0}).then(()=>Espo.Ui.notify(!1)))}):e.render()):e.undelegateEvents()})}getHeader(){var e;if(this.options.params&&this.options.params.fromAdmin)return i=$("<a>").attr("href","#Admin").text(this.translate("Administration","labels","Admin")),e=$("<span>").text(this.getLanguage().translate(this.scope,"scopeNamesPlural")),this.buildHeaderHtml([i,e]);let t=$("<span>").text(this.getLanguage().translate(this.scope,"scopeNamesPlural"));var i=this.getHeaderIconHtml();return i&&t.prepend(i),this.buildHeaderHtml([t])}updatePageTitle(){this.setPageTitle(this.getLanguage().translate(this.scope,"scopeNamesPlural"))}getCreateAttributes(){}prepareCreateReturnDispatchParams(e){}actionQuickCreate(e){e=e||{};var t=this.getCreateAttributes()||{},i=(Espo.Ui.notify(" ... "),this.getMetadata().get("clientDefs."+this.scope+".modalViews.edit")||"views/modals/edit");let s={scope:this.scope,attributes:t};this.keepCurrentRootUrl&&(s.rootUrl=this.getRouter().getCurrentUrl()),e.focusForCreate&&(s.focusForCreate=!0);t={controller:this.scope,action:null,options:{isReturn:!0}};return this.prepareCreateReturnDispatchParams(t),s={...s,returnUrl:this.getRouter().getCurrentUrl(),returnDispatchParams:t},this.createView("quickCreate",i,s,e=>{e.render(),e.notify(!1),this.listenToOnce(e,"after:save",()=>{this.collection.fetch()})})}actionCreate(e){e=e||{};let t=this.getRouter();var i="#"+this.scope+"/create";let s={attributes:this.getCreateAttributes()||{}};this.keepCurrentRootUrl&&(s.rootUrl=this.getRouter().getCurrentUrl()),e.focusForCreate&&(s.focusForCreate=!0);e={controller:this.scope,action:null,options:{isReturn:!0}};this.prepareCreateReturnDispatchParams(e),s={...s,returnUrl:this.getRouter().getCurrentUrl(),returnDispatchParams:e},t.navigate(i,{trigger:!1}),t.dispatch(this.scope,"create",s)}isActualForReuse(){return"isFetched"in this.collection&&this.collection.isFetched}handleShortcutKeyCtrlSpace(e){this.createButton&&this.getAcl().checkScope(this.scope,"create")&&(e.preventDefault(),e.stopPropagation(),this.quickCreate?this.actionQuickCreate({focusForCreate:!0}):this.actionCreate({focusForCreate:!0}))}handleShortcutKeyCtrlSlash(t){if(this.searchPanel){let e=this.$el.find("input.text-filter").first();e.length&&(t.preventDefault(),t.stopPropagation(),e.focus())}}handleShortcutKeyCtrlComma(e){this.getSearchView()&&this.getSearchView().selectPreviousPreset()}handleShortcutKeyCtrlPeriod(e){this.getSearchView()&&this.getSearchView().selectNextPreset()}}e.default=a}),define("views/stream/note",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{messageName=null;messageTemplate=null;messageData=null;isEditable=!1;isRemovable=!1;isSystemAvatar=!1;data(){return{isUserStream:this.isUserStream,noEdit:this.options.noEdit,acl:this.options.acl,onlyContent:this.options.onlyContent,avatar:this.getAvatarHtml()}}init(){this.createField("createdAt",null,null,"views/fields/datetime-short"),this.isUserStream=this.options.isUserStream,this.isThis=!this.isUserStream,this.parentModel=this.options.parentModel,this.isUserStream||this.parentModel&&(this.parentModel.entityType===this.model.get("parentType")&&this.parentModel.id===this.model.get("parentId")||(this.isThis=!1)),this.getUser().isAdmin()&&(this.isRemovable=!0),this.messageName&&this.isThis&&(this.messageName+="This"),this.isThis||this.createField("parent");var e=this.translateEntityType(this.model.get("parentType"));this.messageData={user:"field:createdBy",entity:"field:parent",entityType:e},this.options.noEdit||!this.isEditable&&!this.isRemovable||this.createView("right","views/stream/row-actions/default",{selector:".right-container",acl:this.options.acl,model:this.model,isEditable:this.isEditable,isRemovable:this.isRemovable})}translateEntityType(e,t){let i=t?this.translate(e,"scopeNamesPlural")||"":this.translate(e,"scopeNames")||"";i=i.toLowerCase();t=this.getPreferences().get("language")||this.getConfig().get("language");return i=~["de_DE","nl_NL"].indexOf(t)?Espo.Utils.upperCaseFirst(i):i}createField(e,t,i,s,a){t=t||this.model.getFieldType(e)||"base";let l={model:this.model,defs:{name:e,params:i||{}},selector:".cell-"+e,mode:"list"};if(a)for(var r in a)l[r]=a[r];this.createView(e,s||this.getFieldManager().getViewName(t),l)}isMale(){return"Male"===this.model.get("createdByGender")}isFemale(){return"Female"===this.model.get("createdByGender")}createMessage(){if(!this.messageTemplate){let e=!1;var t=this.model.get("parentType")||null;this.isMale()?(this.messageTemplate=this.translate(this.messageName,"streamMessagesMale",t)||"",this.messageTemplate!==this.messageName&&(e=!0)):this.isFemale()&&(this.messageTemplate=this.translate(this.messageName,"streamMessagesFemale",t)||"",this.messageTemplate!==this.messageName&&(e=!0)),e||(this.messageTemplate=this.translate(this.messageName,"streamMessages",t)||"")}0===this.messageTemplate.indexOf("{entityType}")&&"string"==typeof this.messageData.entityType&&(this.messageData.entityTypeUcFirst=Espo.Utils.upperCaseFirst(this.messageData.entityType),this.messageTemplate=this.messageTemplate.replace("{entityType}","{entityTypeUcFirst}")),this.createView("message","views/stream/message",{messageTemplate:this.messageTemplate,selector:".message",model:this.model,messageData:this.messageData})}getAvatarHtml(){let e=this.model.get("createdById");return this.isSystemAvatar&&(e=this.getHelper().getAppParam("systemUserId")),this.getHelper().getAvatarHtml(e,"small",20)}getIconHtml(e,t){if(!this.isThis||e!==this.parentModel.entityType){var i=this.getMetadata().get(["clientDefs",e,"iconClass"]);if(i)return $("<span>").addClass(i).addClass("action text-muted icon").css("cursor","pointer").attr("title",this.translate("View")).attr("data-action","quickView").attr("data-id",t).attr("data-scope",e).get(0).outerHTML}}}e.default=s}),define("views/record/panels-container",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{panelSoftLockedTypeList=["default","acl","delimiter","dynamicLogic"];panelList=null;hasTabs=!1;tabDataList=null;currentTab=0;scope="";entityType="";name="";mode="detail";data(){var e=this.hasTabs?this.getTabDataList():[];return{panelList:this.panelList,scope:this.scope,entityType:this.entityType,tabDataList:e}}events={"click .action":function(i){let e=$(i.currentTarget);var s=e.data("panel");if(s){let t=this.getView(s);if(t){let e;"function"==typeof t.getButtonList&&"function"==typeof t.getActionList&&(e=[...t.getButtonList(),...t.getActionList()]),Espo.Utils.handleAction(t,i.originalEvent,i.currentTarget,{actionItems:e,className:"panel-action"})}}},'click .panels-show-more-delimiter [data-action="showMorePanels"]':"actionShowMorePanels","click .tabs > button":function(e){e=parseInt($(e.currentTarget).attr("data-tab"));this.selectTab(e)}};afterRender(){this.adjustPanels()}adjustPanels(){if(this.isRendered()){let e=this.$el.find("> .panel"),a=(e.removeClass("first").removeClass("last").removeClass("in-middle"),e.filter(":not(.tab-hidden):not(.hidden)")),l=[],r=[],o=!1;a.each((e,t)=>{let i=$(t),s=!1;s||!this.hasTabs||o||"-1"===i.attr("data-tab")||(o=!0,s=!0),(s=s||i.hasClass("sticked")?s:!0)&&(0!==e&&l.push(r),r=[]),r.push(i),e===a.length-1&&l.push(r)}),l.forEach(i=>{i.forEach((e,t)=>{if(t===i.length-1)return 0===t?void 0:void e.addClass("last");0===t&&i.length?e.addClass("first"):e.addClass("in-middle")})})}}setReadOnly(){this.readOnly=!0}setNotReadOnly(e){this.readOnly=!1,e&&this.panelList.forEach(t=>{if(this.applyAccessToActions(t.buttonList),this.applyAccessToActions(t.actionList),this.isRendered()){let e=this.getView(t.actionsViewKey);e&&e.reRender()}})}applyAccessToActions(e){e&&e.forEach(e=>{Espo.Utils.checkActionAvailability(this.getHelper(),e)?Espo.Utils.checkActionAccess(this.getAcl(),this.model,e,!0)?e.isHiddenByAcl&&(e.isHiddenByAcl=!1,e.hidden=!1):e.hidden||(e.isHiddenByAcl=!0,e.hidden=!0):e.hidden=!0})}setupPanelViews(){this.panelList.forEach(t=>{let i=t.name;var e={model:this.model,panelName:i,selector:'.panel[data-name="'+i+'"] > .panel-body',defs:t,mode:this.mode,recordHelper:this.recordHelper,inlineEditDisabled:this.inlineEditDisabled,readOnly:this.readOnly,disabled:t.hidden||!1,recordViewObject:this.recordViewObject,dataObject:this.options.dataObject},e=_.extend(e,t.options);this.createView(i,t.view,e,e=>{"getActionList"in e&&(t.actionList=e.getActionList(),this.applyAccessToActions(t.actionList)),"getButtonList"in e&&(t.buttonList=e.getButtonList(),this.applyAccessToActions(t.buttonList)),e.titleHtml?t.titleHtml=e.titleHtml:t.label?t.title=this.translate(t.label,"labels",this.scope):t.title=e.title,this.createView(i+"Actions","views/record/panel-actions",{selector:'.panel[data-name="'+t.name+'"] > .panel-heading > .panel-actions-container',model:this.model,defs:t,scope:this.scope,entityType:this.entityType})})})}setupPanels(){}getFieldViews(i){let s={};return this.panelList.forEach(e=>{let t=this.getView(e.name);(!t.disabled||i)&&"getFieldViews"in t&&(s=_.extend(s,t.getFieldViews()))}),s}getFields(){return this.getFieldViews()}fetch(){let i={};return this.panelList.forEach(e=>{let t=this.getView(e.name);!t.disabled&&"fetch"in t&&(i=_.extend(i,t.fetch()))}),i}hasPanel(t){return!!this.panelList.find(e=>e.name===t)}processShowPanel(t,e,i){this.recordHelper.getPanelStateParam(t,"hidden")||this.hasPanel(t)&&(this.panelList.filter(e=>e.name===t).forEach(e=>{e.hidden=!1,void 0!==e.tabNumber&&this.controlTabVisibilityShow(e.tabNumber)}),this.showPanelFinalize(t,e,i))}processHidePanel(t,e){this.recordHelper.getPanelStateParam(t,"hidden")&&this.hasPanel(t)&&(this.panelList.filter(e=>e.name===t).forEach(e=>{e.hidden=!0,void 0!==e.tabNumber&&this.controlTabVisibilityHide(e.tabNumber)}),this.hidePanelFinalize(t,e))}showPanelFinalize(s,a,l){let e=e=>{let t=this.getView(s);if(t&&(t.$el.closest(".panel").removeClass("hidden"),t.disabled=!1,t.trigger("show"),t.trigger("panel-show-propagated"),e&&!l&&t.getFieldViews)){let e=t.getFieldViews();if(e)for(var i in e)e[i].reRender()}"function"==typeof a&&a.call(this)};if(this.isRendered())return e(!0),void this.adjustPanels();this.once("after:render",()=>{e()})}hidePanelFinalize(t,i){if(this.isRendered()){let e=this.getView(t);return e&&(e.$el.closest(".panel").addClass("hidden"),e.disabled=!0,e.trigger("hide")),"function"==typeof i&&i.call(this),void this.adjustPanels()}"function"==typeof i&&this.once("after:render",()=>{i.call(this)})}showPanel(t,i,e){if(this.hasPanel(t)&&!this.recordHelper.getPanelStateParam(t,"hiddenLocked")){if(i){var s="hidden"+Espo.Utils.upperCaseFirst(i)+"Locked";this.recordHelper.setPanelStateParam(t,s,!1);for(let e=0;e<this.panelSoftLockedTypeList.length;e++){var a=this.panelSoftLockedTypeList[e];if(a!==i){a="hidden"+Espo.Utils.upperCaseFirst(a)+"Locked";if(this.recordHelper.getPanelStateParam(t,a))return}}}s=!1===this.recordHelper.getPanelStateParam(t,"hidden");this.recordHelper.setPanelStateParam(t,"hidden",!1),this.processShowPanel(t,e,s)}}hidePanel(e,t,i,s){this.hasPanel(e)&&(this.recordHelper.setPanelStateParam(e,"hidden",!0),t&&this.recordHelper.setPanelStateParam(e,"hiddenLocked",!0),i&&(t="hidden"+Espo.Utils.upperCaseFirst(i)+"Locked",this.recordHelper.setPanelStateParam(e,t,!0)),this.processHidePanel(e,s))}alterPanels(l){l=l||this.layoutData||{};let r=[],e=[];for(var t in l){var i=l[t];"_delimiter_"===t&&this.panelList.push({name:t}),i.tabBreak&&(r.push(i.index),e.push({index:i.index,label:i.tabLabel}))}this.tabDataList=e.sort((e,t)=>e.index-t.index);let o=[];this.panelList.forEach((t,e)=>{t.index="index"in t?t.index:e;let i=!1;if(t.name){var s,a=l[t.name]||{};if(a.disabled)return;for(s in l[t.name]&&(i=!0),a)t[s]=a[s]}t.disabled&&!i||(t.tabNumber=r.length-r.slice().reverse().findIndex(e=>t.index>e)-1,t.tabNumber===r.length&&(t.tabNumber=-1),o.push(t))}),o.sort((e,t)=>e.index-t.index);var s=o.findIndex(e=>-1!==e.tabNumber);if(-1!==s&&(o[s].isTabsBeginning=!0,this.hasTabs=!0,this.currentTab=o[s].tabNumber,this.panelList.filter(e=>-1!==e.tabNumber&&e.tabNumber!==this.currentTab).forEach(e=>{e.tabHidden=!0}),this.panelList.forEach((e,t)=>{-1===e.tabNumber||0!==t&&this.panelList[t-1].tabNumber===e.tabNumber||(e.sticked=!1)})),this.panelList=o,this.recordViewObject&&this.recordViewObject.dynamicLogic){let t=this.recordViewObject.dynamicLogic;this.panelList.forEach(e=>{e.dynamicLogicVisible&&(t.addPanelVisibleCondition(e.name,e.dynamicLogicVisible),this.recordHelper.getPanelStateParam(e.name,"hidden")&&(e.hidden=!0)),e.style&&"default"!==e.style&&e.dynamicLogicStyled&&t.addPanelStyledCondition(e.name,e.dynamicLogicStyled)})}this.hasTabs&&this.options.isReturn&&this.isStoredTabForThisRecord()&&this.selectStoredTab()}setupPanelsFinal(){let i=!1,s=!1,a=-1;this.panelList.forEach((e,t)=>{if("_delimiter_"===e.name)return i=!0,s=!0,void(a=t);i&&(e.hidden=!0,e.hiddenAfterDelimiter=!0,this.recordHelper.setPanelStateParam(e.name,"hidden",!0),this.recordHelper.setPanelStateParam(e.name,"hiddenDelimiterLocked",!0)),s&&(e.isRightAfterDelimiter=!0,s=!1)}),~a&&this.panelList.splice(a,1),this.panelList=this.panelList.filter(e=>!this.recordHelper.getPanelStateParam(e.name,"hiddenLocked")),this.panelsAreSet=!0,this.trigger("panels-set")}actionShowMorePanels(){this.panelList.forEach(e=>{e.hiddenAfterDelimiter&&(delete e.isRightAfterDelimiter,this.showPanel(e.name,"delimiter"))}),this.$el.find(".panels-show-more-delimiter").remove()}onPanelsReady(e){Promise.race([new Promise(e=>{this.panelsAreSet&&e()}),new Promise(e=>{this.once("panels-set",e)})]).then(()=>{e.call(this)})}getTabDataList(){return this.tabDataList.map((e,t)=>{let i=e.label;i?"$"===i[0]&&(i=this.translate(i.substring(1),"tabs",this.scope)):i=(t+1).toString();e=-1===this.panelList.filter(e=>e.tabNumber===t).findIndex(e=>!this.recordHelper.getPanelStateParam(e.name,"hidden"));return{label:i,isActive:t===this.currentTab,hidden:e}})}selectTab(t){this.currentTab=t,this.isRendered()&&($("body > .popover").remove(),this.$el.find(".tabs > button").removeClass("active"),this.$el.find(`.tabs > button[data-tab="${t}"]`).addClass("active"),this.$el.find('.panel[data-tab]:not([data-tab="-1"])').addClass("tab-hidden"),this.$el.find(`.panel[data-tab="${t}"]`).removeClass("tab-hidden")),this.adjustPanels(),this.panelList.filter(e=>e.tabNumber===t&&e.name).forEach(e=>{let t=this.getView(e.name);t&&(t.trigger("tab-show"),t.propagateEvent("panel-show-propagated")),e.tabHidden=!1}),this.panelList.filter(e=>e.tabNumber!==t&&e.name).forEach(e=>{let t=this.getView(e.name);t&&t.trigger("tab-hide"),-1<e.tabNumber&&(e.tabHidden=!0)}),this.storeTab()}storeTab(){var e="tab_"+this.name,t="tab_"+this.name+"_record";this.getSessionStorage().set(e,this.currentTab),this.getSessionStorage().set(t,this.entityType+"_"+this.model.id)}isStoredTabForThisRecord(){var e="tab_"+this.name+"_record";return this.getSessionStorage().get(e)===this.entityType+"_"+this.model.id}selectStoredTab(){var e="tab_"+this.name,e=this.getSessionStorage().get(e);0<e&&this.selectTab(e)}controlTabVisibilityShow(e){this.hasTabs&&(this.isBeingRendered()?this.once("after:render",()=>this.controlTabVisibilityShow(e)):this.$el.find(`.tabs > [data-tab="${e.toString()}"]`).removeClass("hidden"))}controlTabVisibilityHide(t){if(this.hasTabs)if(this.isBeingRendered())this.once("after:render",()=>this.controlTabVisibilityHide(t));else{let e=this.panelList.filter(e=>e.tabNumber===t);var i;if(-1===e.findIndex(e=>!this.recordHelper.getPanelStateParam(e.name,"hidden"))){let e=this.$el.find(`.tabs > [data-tab="${t.toString()}"]`);e.addClass("hidden"),this.currentTab===t&&(i=(i=this.panelList.find(e=>-1<e.tabNumber&&!e.hidden))?i.tabNumber:0,this.selectTab(i))}}}}e.default=s}),define("views/record/list",["exports","view","helpers/mass-action","helpers/export","helpers/record-modal","helpers/list/select-provider"],function(e,t,l,o,a,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),l=s(l),o=s(o),a=s(a),i=s(i);class r extends t.default{template="record/list";type="list";name="list";presentationType="table";checkboxes=!0;selectable=!1;rowActionsView="views/record/row-actions/default";rowActionsDisabled=!1;entityType=null;scope=null;_internalLayoutType="list-row";listContainerEl=".list > table > tbody";showCount=!0;rowActionsColumnWidth=25;checkboxColumnWidth=40;minColumnWidth=100;buttonList=[];dropdownItemList=[];headerDisabled=!1;massActionsDisabled=!1;portalLayoutDisabled=!1;mandatorySelectAttributeList=null;layoutName=null;layoutScope=null;layoutAclDisabled=!1;setupHandlerType="record/list";checkboxesDisabled=!1;forceDisplayTopBar=!1;pagination=!1;header=!0;showMore=!0;massActionList=["remove","merge","massUpdate","export"];checkAllResultMassActionList=["remove","massUpdate","export"];forcedCheckAllResultMassActionList=null;quickDetailDisabled=!1;quickEditDisabled=!1;listLayout=null;_internalLayout=null;checkedList=null;allResultIsChecked=!1;checkAllResultDisabled=!1;buttonsDisabled=!1;editDisabled=!1;removeDisabled=!1;stickedBarDisabled=!1;massFollowDisabled=!1;massPrintPdfDisabled=!1;massConvertCurrencyDisabled=!1;massUpdateDisabled=!1;exportDisabled=!1;mergeDisabled=!1;noDataDisabled=!1;_$focusedCheckbox=null;$selectAllCheckbox=null;massActionDefs=null;events={"click a.link":function(t){if(!(t.ctrlKey||t.metaKey||t.shiftKey)&&(t.stopPropagation(),this.scope&&!this.selectable)){t.preventDefault();var t=$(t.currentTarget).attr("data-id"),i=this.collection.get(t),s=this.getModelScope(t);let e={id:t,model:i};this.options.keepCurrentRootUrl&&(e.rootUrl=this.getRouter().getCurrentUrl()),this.getRouter().navigate("#"+s+"/view/"+t,{trigger:!1}),this.getRouter().dispatch(s,"view",e)}},"auxclick a.link":function(i){if(1===i.button&&(i.ctrlKey||i.metaKey)){let t=$(i.currentTarget);var s=t.attr("data-id");if(s&&!this.quickDetailDisabled){let e=t.parent().closest(`[data-id="${s}"]`).find(`ul.list-row-dropdown-menu[data-id="${s}"]`);var a=e.find('a[data-action="quickView"]');e.length&&!a.length||(i.preventDefault(),i.stopPropagation(),this.actionQuickView({id:s}))}}},'click [data-action="showMore"]':function(){this.showMoreRecords()},"mousedown a.sort":function(e){e.preventDefault()},"click a.sort":function(e){e=$(e.currentTarget).data("name");this.toggleSort(e)},"click .pagination a":function(e){var t=$(e.currentTarget).data("page");$(e.currentTarget).parent().hasClass("disabled")||(Espo.Ui.notify(" ... "),this.collection.once("sync",()=>{Espo.Ui.notify(!1)}),"current"===t?this.collection.fetch():(this.collection[t+"Page"].call(this.collection),this.trigger("paginate")),this.deactivate())},"mousedown input.record-checkbox":function(){let e=$(document.activeElement);this._$focusedCheckbox=null,e.length&&"INPUT"===e.get(0).tagName&&e.hasClass("record-checkbox")&&(this._$focusedCheckbox=e)},"click input.record-checkbox":function(t){let i=$(t.currentTarget),a=this._$focusedCheckbox;if(t.shiftKey&&a){let e=this.$el.find("input.record-checkbox");var t=e.index(i),l=e.index(a);let s=a.prop("checked");void e.slice(Math.min(t,l),Math.max(t,l)+1).each((e,t)=>{let i=$(t);i.prop("checked",s),this.checkboxClick(i,s)})}else this.checkboxClick(i,i.is(":checked"))},"click .select-all":function(e){this.selectAllHandler(e.currentTarget.checked)},"click .action":function(e){Espo.Utils.handleAction(this,e.originalEvent,e.currentTarget,{actionItems:[...this.buttonList,...this.dropdownItemList],className:"list-action-item"})},'click .checkbox-dropdown [data-action="selectAllResult"]':function(){this.selectAllResult()},"click .actions-menu a.mass-action":function(e){let t=$(e.currentTarget);var i=t.data("action"),s="massAction"+Espo.Utils.upperCaseFirst(i);e.preventDefault(),e.stopPropagation();let a=t.closest(".dropdown-menu").parent();a.find('.actions-button[data-toggle="dropdown"]').dropdown("toggle").focus(),s in this?this[s]():this.massAction(i)},"click a.reset-custom-order":function(){this.resetCustomOrder()}};checkboxClick(e,t){var i=e.attr("data-id");t?this.checkRecord(i,e):this.uncheckRecord(i,e)}resetCustomOrder(){this.collection.resetOrderToDefault(),this.collection.trigger("order-changed"),this.collection.fetch().then(()=>{this.trigger("sort",{orderBy:this.collection.orderBy,order:this.collection.order})})}toggleSort(e){let t=!0,i=(t=e===this.collection.orderBy&&"asc"===this.collection.order?!1:t)?"asc":"desc";Espo.Ui.notify(" ... ");for(var s=this.getConfig().get("recordListMaxSizeLimit")||200;this.collection.length>s;)this.collection.pop();this.collection.sort(e,i).then(()=>{Espo.Ui.notify(!1),this.trigger("sort",{orderBy:e,order:i})}),this.collection.trigger("order-changed"),this.deactivate()}initStickedBar(){let s=this.$stickedBar=this.$el.find(".sticked-bar"),a=this.$el.find("> .list"),e=$(window),l=e,r=$("#navbar .navbar-right"),o=(this.on("render",()=>{this.$stickedBar=null}),!!this.$el.closest(".modal-body").length);var t=this.getThemeManager().getParam("screenWidthXs");let h=this.getThemeManager().getParam("navbarHeight"),n=$(window.document).width()<t;t=e=>{let t=0;for(var i=!n&&!o;!e.classList.contains("modal-body")&&(isNaN(e.offsetTop)||(t+=e.offsetTop),e=e.offsetParent););return i&&(t-=h),t};o&&(l=this.$el.closest(".modal-body"),r=l.parent().find(".modal-footer"));let d=t(a.get(0)),c=t(this.$el.find(".list-buttons-container").get(0)),i=(o||(d-=5,c-=5),l.off("scroll.list-"+this.cid),l.on("scroll.list-"+this.cid,()=>i()),e.off("resize.list-"+this.cid),e.on("resize.list-"+this.cid,()=>i()),this.on("check",()=>{0===this.checkedList.length&&!this.allResultIsChecked||i()}),this.on("remove",()=>{l.off("scroll.list-"+this.cid),e.off("resize.list-"+this.cid)}),()=>{if(0!==this.checkedList.length||this.allResultIsChecked){var e=l.scrollTop(),t=c,i=d+a.outerHeight(!0);if(!n||!$("#navbar .navbar-body").hasClass("in"))return i<=e||t<e?(s.removeClass("hidden"),void r.addClass("has-sticked-bar")):(s.addClass("hidden"),void r.removeClass("has-sticked-bar"))}})}showActions(){this.$el.find(".actions-button").removeClass("hidden"),this.options.stickedBarDisabled||this.stickedBarDisabled||!this.massActionList.length||this.$stickedBar||this.initStickedBar()}hideActions(){this.$el.find(".actions-button").addClass("hidden"),this.$stickedBar&&this.$stickedBar.addClass("hidden")}selectAllHandler(e){this.checkedList=[],e?(this.$el.find("input.record-checkbox").prop("checked",!0),this.showActions(),this.collection.models.forEach(e=>{this.checkedList.push(e.id)}),this.$el.find(".list > table tbody tr").addClass("active")):(this.allResultIsChecked&&this.unselectAllResult(),this.$el.find("input.record-checkbox").prop("checked",!1),this.hideActions(),this.$el.find(".list > table tbody tr").removeClass("active")),this.trigger("check")}data(){var e="both"===this.pagination||"top"===this.pagination,t="both"===this.pagination||!0===this.pagination||"bottom"===this.pagination,i=this.collection.total-this.collection.length;let s=this.checkAllResultDisabled;this.massActionsDisabled||this.checkAllResultMassActionList.length||(s=!0);var a=this.displayTotalCount&&0<this.collection.total,l=e||this.checkboxes||this.buttonList.length&&!this.buttonsDisabled||this.dropdownItemList.length&&!this.buttonsDisabled||this.forceDisplayTopBar||a,r=this.noDataDisabled||this._renderEmpty;return{scope:this.scope,entityType:this.entityType,header:this.header,headerDefs:this._getHeaderDefs(),paginationEnabled:this.pagination,paginationTop:e,paginationBottom:t,showMoreActive:this.collection.hasMore(),showMoreEnabled:this.showMore,showCount:this.showCount&&0<this.collection.total,moreCount:i,checkboxes:this.checkboxes,massActionList:this.massActionList,rowList:this.rowList,topBar:l,bottomBar:t,checkAllResultDisabled:s,buttonList:this.buttonList,dropdownItemList:this.dropdownItemList,displayTotalCount:a,displayActionsButtonGroup:this.checkboxes||this.massActionList||this.buttonList.length||this.dropdownItemList.length,totalCountFormatted:this.getNumberUtil().formatInt(this.collection.total),moreCountFormatted:this.getNumberUtil().formatInt(i),checkboxColumnWidth:this.checkboxColumnWidth,noDataDisabled:r}}init(){this.type=this.options.type||this.type,this.listLayout=this.options.listLayout||this.listLayout,this.layoutName=this.options.layoutName||this.layoutName||this.type,this.layoutScope=this.options.layoutScope||this.layoutScope,this.layoutAclDisabled=this.options.layoutAclDisabled||this.layoutAclDisabled,this.headerDisabled=this.options.headerDisabled||this.headerDisabled,this.noDataDisabled=this.options.noDataDisabled||this.noDataDisabled,this.headerDisabled?this.header=!1:this.header=(_.isUndefined(this.options.header)?this:this.options).header,this.pagination=(_.isUndefined(this.options.pagination)||null===this.options.pagination?this:this.options).pagination,this.checkboxes=(_.isUndefined(this.options.checkboxes)?this:this.options).checkboxes,this.selectable=(_.isUndefined(this.options.selectable)?this:this.options).selectable,this.checkboxesDisabled=!1===this.options.checkboxes,this.rowActionsView=(_.isUndefined(this.options.rowActionsView)?this:this.options).rowActionsView,this.showMore=(_.isUndefined(this.options.showMore)?this:this.options).showMore,this.massActionsDisabled=this.options.massActionsDisabled||this.massActionsDisabled,this.portalLayoutDisabled=this.options.portalLayoutDisabled||this.portalLayoutDisabled,this.massActionsDisabled&&!this.selectable&&(this.checkboxes=!1),this.rowActionsDisabled=this.options.rowActionsDisabled||this.rowActionsDisabled,this.dropdownItemList=Espo.Utils.cloneDeep(this.options.dropdownItemList||this.dropdownItemList),"buttonsDisabled"in this.options&&(this.buttonsDisabled=this.options.buttonsDisabled),"checkAllResultDisabled"in this.options&&(this.checkAllResultDisabled=this.options.checkAllResultDisabled)}getModelScope(e){return this.scope}selectAllResult(){this.allResultIsChecked=!0,this.hideActions(),this.$el.find("input.record-checkbox").prop("checked",!0).attr("disabled","disabled"),this.$selectAllCheckbox.prop("checked",!0),this.massActionList.forEach(e=>{~this.checkAllResultMassActionList.indexOf(e)||this.$el.find('div.list-buttons-container .actions-menu li a.mass-action[data-action="'+e+'"]').parent().addClass("hidden")}),this.checkAllResultMassActionList.length&&this.showActions(),this.$el.find(".list > table tbody tr").removeClass("active"),this.trigger("select-all-results")}unselectAllResult(){this.allResultIsChecked=!1,this.$el.find("input.record-checkbox").prop("checked",!1).removeAttr("disabled"),this.$selectAllCheckbox.prop("checked",!1),this.massActionList.forEach(e=>{~this.checkAllResultMassActionList.indexOf(e)||this.$el.find('div.list-buttons-container .actions-menu li a.mass-action[data-action="'+e+'"]').parent().removeClass("hidden")})}deactivate(){this.$el&&(this.$el.find(".pagination li").addClass("disabled"),this.$el.find("a.sort").addClass("disabled"))}export(t,i,e){t||(t={entityType:this.entityType},this.allResultIsChecked?(t.where=this.collection.getWhere(),t.searchParams=this.collection.data||null,t.searchData=this.collection.data||{}):t.ids=this.checkedList),i=i||"Export";let s={scope:this.entityType};if(e)s.fieldList=e;else{let t=[];(this.listLayout||[]).forEach(e=>{e.name&&t.push(e.name)}),s.fieldList=t}let a=new o.default(this),l=this.allResultIsChecked&&a.checkIsIdle(this.collection.total),r=e=>{window.location=this.getBasePath()+"?entryPoint=download&id="+e};this.createView("dialogExport","views/export/modals/export",s,e=>{e.render(),this.listenToOnce(e,"proceed",e=>{e.exportAllFields||(t.attributeList=e.attributeList,t.fieldList=e.fieldList),t.idle=l,t.format=e.format,t.params=e.params,Espo.Ui.notify(this.translate("pleaseWait","messages")),Espo.Ajax.postRequest(i,t,{timeout:0}).then(e=>{if(Espo.Ui.notify(!1),e.exportId)a.process(e.exportId).then(e=>{this.listenToOnce(e,"download",e=>{r(e)})});else{if(!e.id)throw new Error("No attachment-id.");window.location=this.getBasePath()+"?entryPoint=download&id="+e.id,r(e.id)}})})})}massAction(a){let l=this.massActionDefs[a]||{};var r=l.handler;if(r){let i="action"+Espo.Utils.upperCaseFirst(a),s={entityType:this.entityType,action:a,params:this.getMassActionSelectionPostData()};void Espo.loader.require(r,e=>{let t=new e(this);t[i].call(t,s)})}else{a=l.bypassConfirmation||!1,r=l.confirmationMessage||"confirmation";let e=l.acl,t=l.aclScope;var i=()=>{if(!e&&!t||this.getAcl().check(t||this.scope,e)){let e=[],t={};for(var i in this.allResultIsChecked?(t.where=this.collection.getWhere(),t.searchParams=this.collection.data||{},t.selectData=t.searchData,t.byWhere=!0):(t.idList=e,t.ids=e),this.checkedList)e.push(this.checkedList[i]);t.entityType=this.entityType;var s=l.waitMessage||"pleaseWait",s=(Espo.Ui.notify(this.translate(s,"messages",this.scope)),l.url);Espo.Ajax.postRequest(s,t).then(t=>{let i=t.successMessage||l.successMessage||"done";this.collection.fetch().then(()=>{let e=this.translate(i,"messages",this.scope);"count"in t&&(e=e.replace("{count}",t.count)),Espo.Ui.success(e)})})}else Espo.Ui.error(this.translate("Access denied"))};a?i.call(this):this.confirm(this.translate(r,"messages",this.scope),i,this)}}getMassActionSelectionPostData(){let e={};if(this.allResultIsChecked)e.where=this.collection.getWhere(),e.searchParams=this.collection.data||{},e.selectData=this.collection.data||{},e.byWhere=!0;else for(var t in e.ids=[],this.checkedList)e.ids.push(this.checkedList[t]);return e}massActionRecalculateFormula(){let s=!1,a=this.allResultIsChecked;a||(s=this.checkedList),this.confirm({message:this.translate("recalculateFormulaConfirmation","messages"),confirmText:this.translate("Yes")},()=>{Espo.Ui.notify(this.translate("pleaseWait","messages"));var e=this.getMassActionSelectionPostData();let i=new l.default(this);var t=!!e.searchParams&&i.checkIsIdle(this.collection.total);Espo.Ajax.postRequest("MassAction",{entityType:this.entityType,action:"recalculateFormula",params:e,idle:t}).then(e=>{let t=()=>{this.collection.fetch().then(()=>{Espo.Ui.success(this.translate("Done")),a?this.selectAllResult():s.forEach(e=>{this.checkRecord(e)})})};(e=e||{}).id?i.process(e.id,"recalculateFormula").then(e=>{this.listenToOnce(e,"close:success",()=>t())}):t()})})}massActionRemove(){if(!this.getAcl().check(this.entityType,"delete"))return Espo.Ui.error(this.translate("Access denied")),!1;this.confirm({message:this.translate("removeSelectedRecordsConfirmation","messages",this.scope),confirmText:this.translate("Remove")},()=>{Espo.Ui.notify(" ... ");let e=new l.default(this);var t=this.getMassActionSelectionPostData(),i=!!t.searchParams&&e.checkIsIdle(this.collection.total);Espo.Ajax.postRequest("MassAction",{entityType:this.entityType,action:"delete",params:t,idle:i}).then(t=>{let i=e=>{e?(this.unselectAllResult(),this.collection.fetch().then(()=>{Espo.Ui.success(this.translate(1===e?"massRemoveResultSingle":"massRemoveResult","messages").replace("{count}",e))}),Espo.Ui.notify(!1)):Espo.Ui.warning(this.translate("noRecordsRemoved","messages"))};if((t=t||{}).id)e.process(t.id,"delete").then(e=>{this.listenToOnce(e,"close:success",e=>i(e.count))});else{var s=t.count;if(this.allResultIsChecked)i(s);else{let e=t.ids||[];s?(e.forEach(e=>{Espo.Ui.notify(!1),this.collection.trigger("model-removing",e),this.removeRecordFromList(e),this.uncheckRecord(e,null,!0)}),this.$selectAllCheckbox.prop("checked")&&(this.$selectAllCheckbox.prop("checked",!1),this.collection.hasMore()&&this.showMoreRecords({skipNotify:!0})),Espo.Ui.success(this.translate(1===s?"massRemoveResultSingle":"massRemoveResult","messages").replace("{count}",s))):Espo.Ui.warning(this.translate("noRecordsRemoved","messages"))}}})})}massActionPrintPdf(){let e=this.getConfig().get("massPrintPdfMaxCount");var t,i;if(e&&this.checkedList.length>e)return t=this.translate("massPrintPdfMaxCountError","messages").replace("{maxCount}",e.toString()),void Espo.Ui.error(t);let s=[];for(i in this.checkedList)s.push(this.checkedList[i]);this.createView("pdfTemplate","views/modals/select-template",{entityType:this.entityType},e=>{e.render(),this.listenToOnce(e,"select",e=>{this.clearView("pdfTemplate"),Espo.Ui.notify(" ... "),Espo.Ajax.postRequest("Pdf/action/massPrint",{idList:s,entityType:this.entityType,templateId:e.id},{timeout:0}).then(e=>{Espo.Ui.notify(!1),window.open("?entryPoint=download&id="+e.id,"_blank")})})})}massActionFollow(){let e=this.checkedList.length;var t=this.translate("confirmMassFollow","messages").replace("{count}",e.toString());this.confirm({message:t,confirmText:this.translate("Follow")},()=>{Espo.Ui.notify(this.translate("pleaseWait","messages")),Espo.Ajax.postRequest("MassAction",{action:"follow",entityType:this.entityType,params:this.getMassActionSelectionPostData()}).then(e=>{let t=e.count||0,i="massFollowResult";if(t)return 1===t&&(i+="Single"),void Espo.Ui.success(this.translate(i,"messages").replace("{count}",t.toString()));Espo.Ui.warning(this.translate("massFollowZeroResult","messages"))})})}massActionUnfollow(){let e=this.checkedList.length;var t=this.translate("confirmMassUnfollow","messages").replace("{count}",e.toString());this.confirm({message:t,confirmText:this.translate("Unfollow")},()=>{Espo.Ui.notify(this.translate("pleaseWait","messages"));var e=this.getMassActionSelectionPostData();let i=new l.default(this);var t=!!e.searchParams&&i.checkIsIdle(this.collection.total);Espo.Ajax.postRequest("MassAction",{action:"unfollow",entityType:this.entityType,params:e,idle:t}).then(e=>{let t=e=>{let t="massUnfollowResult";e||Espo.Ui.warning(this.translate("massUnfollowZeroResult","messages")),1===e&&(t+="Single"),Espo.Ui.success(this.translate(t,"messages").replace("{count}",e))};e.id?i.process(e.id,"unfollow").then(e=>{this.listenToOnce(e,"close:success",e=>t(e.count))}):t(e.count||0)})})}massActionMerge(){if(!this.getAcl().check(this.entityType,"edit"))return Espo.Ui.error(this.translate("Access denied")),!1;var e;this.checkedList.length<2?Espo.Ui.error(this.translate("Select 2 or more records")):4<this.checkedList.length?Espo.Ui.error(this.translate("Select not more than 4 records")):(this.checkedList.sort(),e="#"+this.entityType+"/merge/ids="+this.checkedList.join(","),this.getRouter().navigate(e,{trigger:!1}),this.getRouter().dispatch(this.entityType,"merge",{ids:this.checkedList.join(","),collection:this.collection}))}massActionMassUpdate(){if(!this.getAcl().check(this.entityType,"edit"))return Espo.Ui.error(this.translate("Access denied")),!1;Espo.Ui.notify(" ... ");let s=!1,a=this.allResultIsChecked;a||(s=this.checkedList);var e=this.getMetadata().get(["clientDefs",this.entityType,"modalViews","massUpdate"])||"views/modals/mass-update";this.createView("massUpdate",e,{scope:this.scope,entityType:this.entityType,ids:s,where:this.collection.getWhere(),searchParams:this.collection.data,byWhere:this.allResultIsChecked,totalCount:this.collection.total},i=>{i.render(),i.notify(!1),this.listenToOnce(i,"after:update",e=>{if(e.idle)this.listenToOnce(i,"close",()=>{this.collection.fetch().then(()=>{a?this.selectAllResult():s.forEach(e=>{this.checkRecord(e)})})});else{i.close();let t=e.count;this.collection.fetch().then(()=>{if(t){let e="massUpdateResult";1===t&&(e="massUpdateResultSingle"),Espo.Ui.success(this.translate(e,"messages").replace("{count}",t))}else Espo.Ui.warning(this.translate("noRecordsUpdated","messages"));a?this.selectAllResult():s.forEach(e=>{this.checkRecord(e)})})}})})}massActionExport(){this.getConfig().get("exportDisabled")&&!this.getUser().isAdmin()||this.export()}massActionUnlink(){this.confirm({message:this.translate("unlinkSelectedRecordsConfirmation","messages"),confirmText:this.translate("Unlink")},()=>{Espo.Ui.notify(" ... "),Espo.Ajax.deleteRequest(this.collection.url,{ids:this.checkedList}).then(()=>{Espo.Ui.success(this.translate("Unlinked")),this.collection.fetch(),this.model.trigger("after:unrelate")})})}massActionConvertCurrency(){let i=!1,s=this.allResultIsChecked;s||(i=this.checkedList),this.createView("modalConvertCurrency","views/modals/mass-convert-currency",{entityType:this.entityType,ids:i,where:this.collection.getWhere(),searchParams:this.collection.data,byWhere:this.allResultIsChecked,totalCount:this.collection.total},t=>{t.render(),this.listenToOnce(t,"after:update",e=>{if(e.idle)this.listenToOnce(t,"close",()=>{this.collection.fetch().then(()=>{s?this.selectAllResult():i.forEach(e=>{this.checkRecord(e)})})});else{let t=e.count;this.collection.fetch().then(()=>{if(t){let e="massUpdateResult";1===t&&(e="massUpdateResultSingle"),Espo.Ui.success(this.translate(e,"messages").replace("{count}",t))}else Espo.Ui.warning(this.translate("noRecordsUpdated","messages"));s?this.selectAllResult():i.forEach(e=>{this.checkRecord(e)})})}})})}addMassAction(e,t,i){i?this.massActionList.unshift(e):this.massActionList.push(e),t&&this.collection.url===this.entityType&&(i?this.checkAllResultMassActionList.unshift(e):this.checkAllResultMassActionList.push(e)),this.checkboxesDisabled||(this.checkboxes=!0)}removeMassAction(e){let t=this.massActionList.indexOf(e);~t&&this.massActionList.splice(t,1),~(t=this.checkAllResultMassActionList.indexOf(e))&&this.checkAllResultMassActionList.splice(t,1)}removeAllResultMassAction(e){e=this.checkAllResultMassActionList.indexOf(e);~e&&this.checkAllResultMassActionList.splice(e,1)}setup(){if(void 0===this.collection)throw new Error("Collection has not been injected into views/record/list view.");this.layoutLoadCallbackList=[],this.entityType=this.collection.entityType||null,this.scope=this.options.scope||this.entityType,this.massActionList=Espo.Utils.clone(this.massActionList),this.checkAllResultMassActionList=Espo.Utils.clone(this.checkAllResultMassActionList),this.buttonList=Espo.Utils.clone(this.buttonList),this.mandatorySelectAttributeList=Espo.Utils.clone(this.options.mandatorySelectAttributeList||this.mandatorySelectAttributeList||[]),this.editDisabled=this.options.editDisabled||this.editDisabled||this.getMetadata().get(["clientDefs",this.scope,"editDisabled"]),this.removeDisabled=this.options.removeDisabled||this.removeDisabled||this.getMetadata().get(["clientDefs",this.scope,"removeDisabled"]),this.setupMassActions(),this.selectable&&(this.events["click .list a.link"]=e=>{e.preventDefault();var t=$(e.target).attr("data-id");if(t){t=this.collection.get(t);if(this.checkboxes){let e=[];e.push(t),this.trigger("select",e)}else this.trigger("select",t)}e.stopPropagation()}),"showCount"in this.options&&(this.showCount=this.options.showCount),this.displayTotalCount=this.showCount&&this.getConfig().get("displayListViewRecordCount"),"displayTotalCount"in this.options&&(this.displayTotalCount=this.options.displayTotalCount),this.forceDisplayTopBar=this.options.forceDisplayTopBar||this.forceDisplayTopBar,this.massActionList.length||this.selectable||(this.checkboxes=!1),this.getUser().isPortal()&&!this.portalLayoutDisabled&&this.getMetadata().get(["clientDefs",this.scope,"additionalLayouts",this.layoutName+"Portal"])&&(this.layoutName+="Portal"),this.wait(this.getHelper().processSetupHandlers(this,this.setupHandlerType)),this.listenTo(this.collection,"sync",(e,t,i)=>{if(this._renderEmpty=!1,!this.hasView("modal")||!this.getView("modal").isRendered()){if((i=i||{}).previousDataList){var s=this.collection.models.map(e=>Espo.Utils.cloneDeep(e.attributes));if(_.isEqual(s,i.previousDataList))return}this.noRebuild||i.noRebuild?this.noRebuild=null:(this.checkedList=[],this.allResultIsChecked=!1,this.buildRows(()=>{this.render()}))}}),this.checkedList=[],this.options.skipBuildRows||this.buildRows(),this._renderEmpty=this.options.skipBuildRows}afterRender(){this.$selectAllCheckbox=this.$el.find("input.select-all"),this.allResultIsChecked?this.selectAllResult():this.checkedList.length&&this.checkedList.forEach(e=>{this.checkRecord(e)})}setupMassActions(){if(this.massActionsDisabled)return this.massActionList=[],void(this.checkAllResultMassActionList=[]);this.getAcl().checkScope(this.entityType,"delete")||(this.removeMassAction("remove"),this.removeMassAction("merge")),(this.removeDisabled||this.getMetadata().get(["clientDefs",this.scope,"massRemoveDisabled"]))&&this.removeMassAction("remove"),this.getAcl().checkScope(this.entityType,"edit")||(this.removeMassAction("massUpdate"),this.removeMassAction("merge")),(this.getMetadata().get(["clientDefs",this.scope,"mergeDisabled"])||this.mergeDisabled)&&this.removeMassAction("merge"),this.massActionDefs={...this.getMetadata().get(["clientDefs","Global","massActionDefs"])||{},...this.getMetadata().get(["clientDefs",this.scope,"massActionDefs"])||{}};let e=[...this.getMetadata().get(["clientDefs","Global","massActionList"])||[],...this.getMetadata().get(["clientDefs",this.scope,"massActionList"])||[]],t=[...this.getMetadata().get(["clientDefs","Global","checkAllResultMassActionList"])||[],...this.getMetadata().get(["clientDefs",this.scope,"checkAllResultMassActionList"])||[]];e.forEach(e=>{var t=this.massActionDefs[e]||{};Espo.Utils.checkActionAvailability(this.getHelper(),t)&&Espo.Utils.checkActionAccess(this.getAcl(),null,t)&&this.massActionList.push(e)}),this.checkAllResultMassActionList=this.checkAllResultMassActionList.filter(e=>this.massActionList.includes(e)),t.forEach(e=>{var t;this.collection.url===this.entityType&&~this.massActionList.indexOf(e)&&(t=this.massActionDefs[e]||{},Espo.Utils.checkActionAvailability(this.getHelper(),t)&&Espo.Utils.checkActionAccess(this.getAcl(),null,t)&&this.checkAllResultMassActionList.push(e))}),e.concat(t).forEach(e=>{let a=this.massActionDefs[e]||{};if(a.initFunction&&a.handler){let s=this;this.wait(new Promise(i=>{Espo.loader.require(a.handler,e=>{let t=new e(s);t[a.initFunction].call(t),i()})}))}}),(this.getConfig().get("exportDisabled")&&!this.getUser().isAdmin()||"no"===this.getAcl().getPermissionLevel("exportPermission")||this.getMetadata().get(["clientDefs",this.scope,"exportDisabled"])||this.exportDisabled)&&this.removeMassAction("export"),("yes"!==this.getAcl().getPermissionLevel("massUpdatePermission")||this.editDisabled||this.massUpdateDisabled||this.getMetadata().get(["clientDefs",this.scope,"massUpdateDisabled"]))&&this.removeMassAction("massUpdate"),(!this.massFollowDisabled&&this.getMetadata().get(["scopes",this.entityType,"stream"])&&this.getAcl().check(this.entityType,"stream")||this.getMetadata().get(["clientDefs",this.scope,"massFollowDisabled"]))&&(this.addMassAction("follow"),this.addMassAction("unfollow",!0)),!this.massPrintPdfDisabled&&(this.getHelper().getAppParam("templateEntityTypeList")||[]).includes(this.entityType)&&this.addMassAction("printPdf"),this.options.unlinkMassAction&&this.collection&&this.addMassAction("unlink",!1,!0),!this.massConvertCurrencyDisabled&&!this.getMetadata().get(["clientDefs",this.scope,"convertCurrencyDisabled"])&&1<this.getConfig().get("currencyList").length&&this.getAcl().checkScope(this.scope,"edit")&&"yes"===this.getAcl().getPermissionLevel("massUpdatePermission")&&this.getFieldManager().getEntityTypeFieldList(this.entityType,{type:"currency",acl:"edit"}).length&&this.addMassAction("convertCurrency",!0),this.setupMassActionItems(),this.getUser().isAdmin()&&this.getMetadata().get(["formula",this.entityType,"beforeSaveCustomScript"])&&this.addMassAction("recalculateFormula",!0),this.collection.url!==this.entityType&&Espo.Utils.clone(this.checkAllResultMassActionList).forEach(e=>{this.removeAllResultMassAction(e)}),this.forcedCheckAllResultMassActionList&&(this.checkAllResultMassActionList=Espo.Utils.clone(this.forcedCheckAllResultMassActionList)),"yes"!==this.getAcl().getPermissionLevel("massUpdatePermission")&&this.removeAllResultMassAction("remove"),Espo.Utils.clone(this.massActionList).forEach(e=>{var t="massAction"+Espo.Utils.upperCaseFirst(e)+"Disabled";(this[t]||this.options[t])&&this.removeMassAction(e)})}setupMassActionItems(){}filterListLayout(e){if(this._cachedFilteredListLayout)return this._cachedFilteredListLayout;let t=this._cachedScopeForbiddenFieldList=this._cachedScopeForbiddenFieldList||this.getAcl().getScopeForbiddenFieldList(this.entityType,"read");if(!(t=this.layoutAclDisabled?[]:t).length)return this._cachedFilteredListLayout=e,this._cachedFilteredListLayout;let i=Espo.Utils.clone(e);for(var s in e){var a=e[s].name;a&&~t.indexOf(a)&&(i[s].customLabel="",i[s].notSortable=!0)}return this._cachedFilteredListLayout=i,this._cachedFilteredListLayout}_loadListLayout(e){var t;this.layoutLoadCallbackList.push(e),this.layoutIsBeingLoaded||(this.layoutIsBeingLoaded=!0,e=this.layoutName,t=this.layoutScope||this.collection.entityType,this.getHelper().layoutManager.get(t,e,e=>{let t=this.filterListLayout(e);this.layoutLoadCallbackList.forEach(e=>{e(t),this.layoutLoadCallbackList=[],this.layoutIsBeingLoaded=!1})}))}getSelectAttributeList(i){var e;if(null!==this.scope)return this.listLayout?(e=this.fetchAttributeListFromLayout(),void i(e)):void this._loadListLayout(e=>{this.listLayout=e;let t=this.fetchAttributeListFromLayout();this.mandatorySelectAttributeList&&(t=t.concat(this.mandatorySelectAttributeList)),i(t)});i(null)}fetchAttributeListFromLayout(){const e=new i.default(this.getHelper().layoutManager,this.getHelper().metadata,this.getHelper().fieldManager);return e.getFromLayout(this.entityType,this.listLayout)}_getHeaderDefs(){let t=[];for(const l in this.listLayout){let e=!1;"width"in this.listLayout[l]&&null!==this.listLayout[l].width?e=this.listLayout[l].width+"%":"widthPx"in this.listLayout[l]&&(e=this.listLayout[l].widthPx);var i=this.listLayout[l].name,s=this.listLayout[l].label||i;const r={name:i,isSortable:!this.listLayout[l].notSortable,width:e,align:"align"in this.listLayout[l]&&this.listLayout[l].align};"customLabel"in this.listLayout[l]?(r.customLabel=this.listLayout[l].customLabel,r.hasCustomLabel=!0,r.label=r.customLabel):r.label=this.translate(s,"fields",this.collection.entityType),this.listLayout[l].noLabel&&(r.label=null),r.isSortable&&(r.isSorted=this.collection.orderBy===i,r.isSorted&&(r.isDesc="desc"===this.collection.order)),t.push(r)}var a=this.collection.orderBy!==this.collection.defaultOrderBy||this.collection.order!==this.collection.defaultOrder;if(this.rowActionsView&&!this.rowActionsDisabled||a){let e=null;a&&(e=$("<a>").attr("role","button").attr("tabindex","0").addClass("reset-custom-order").attr("title",this.translate("Reset")).append($("<span>").addClass("fas fa-times fa-sm")).get(0).outerHTML),t.push({width:this.rowActionsColumnWidth,html:e,className:"action-cell"})}return t}_convertLayout(e,t){t=t||this.collection.prepareModel();let i=[];for(var s in this.checkboxes&&i.push({name:"r-checkboxField",columnName:"r-checkbox",template:"record/list-checkbox"}),e){var a=e[s],s=a.type||t.getFieldType(a.name)||"base";if(a.name){let e={columnName:a.name,name:a.name+"Field",view:a.view||t.getFieldParam(a.name,"view")||this.getFieldManager().getViewName(s),options:{defs:{name:a.name,params:a.params||{}},mode:"list"}};if(a.width&&(e.options.defs.width=a.width),a.widthPx&&(e.options.defs.widthPx=a.widthPx),a.link&&(e.options.mode="listLink"),a.align&&(e.options.defs.align=a.align),a.options)for(var l in a.options)void 0===e.options[l]&&(e.options[l]=a.options[l]);i.push(e)}}return this.rowActionsView&&!this.rowActionsDisabled&&i.push(this.getRowActionsDefs()),i}checkRecord(e,t,i){this.collection.get(e)&&((t=t||this.$el.find('.record-checkbox[data-id="'+e+'"]')).length&&(t.get(0).checked=!0,t.closest("tr").addClass("active")),-1===this.checkedList.indexOf(e)&&this.checkedList.push(e),this.handleAfterCheck(i))}uncheckRecord(e,t,i){(t=t||this.$el.find('.record-checkbox[data-id="'+e+'"]')).get(0)&&(t.get(0).checked=!1,t.closest("tr").removeClass("active"));t=this.checkedList.indexOf(e);-1!==t&&this.checkedList.splice(t,1),this.handleAfterCheck(i)}handleAfterCheck(e){this.checkedList.length?this.showActions():this.hideActions(),this.checkedList.length===this.collection.models.length?this.$el.find(".select-all").prop("checked",!0):this.$el.find(".select-all").prop("checked",!1),e||this.trigger("check")}getRowActionsDefs(){let e={defs:{params:{}}};if(this.options.rowActionsOptions)for(var t in this.options.rowActionsOptions)e[t]=this.options.rowActionsOptions[t];return{columnName:"buttons",name:"buttonsField",view:this.rowActionsView,options:e}}getSelected(){let i=[];return this.$el.find("input.record-checkbox:checked").each((e,t)=>{t=$(t).attr("data-id"),t=this.collection.get(t);i.push(t)}),i}getInternalLayoutForModel(e,t){var i=t.entityType;null===this._internalLayout&&(this._internalLayout={}),i in this._internalLayout||(this._internalLayout[i]=this._convertLayout(this.listLayout[i],t)),e(this._internalLayout[i])}getInternalLayout(t,e){return null!==this.scope||Array.isArray(this.listLayout)?null===this._internalLayout?null!==this.listLayout?(this._internalLayout=this._convertLayout(this.listLayout),void t(this._internalLayout)):void this._loadListLayout(e=>{this.listLayout=e,this._internalLayout=this._convertLayout(e),t(this._internalLayout)}):void t(this._internalLayout):e?void this.getInternalLayoutForModel(t,e):void t(null)}getItemEl(e,t){return this.getSelector()+' tr[data-id="'+e.id+'"] td.cell[data-name="'+t.columnName+'"]'}prepareInternalLayout(e,t){e.forEach(e=>{e.el=this.getItemEl(t,e)})}buildRow(e,i,s){let a=i.id;this.rowList.push(a),this.getInternalLayout(e=>{e=Espo.Utils.cloneDeep(e),this.prepareInternalLayout(e,i);var t={edit:this.getAcl().checkModel(i,"edit")&&!this.editDisabled,delete:this.getAcl().checkModel(i,"delete")&&!this.removeDisabled};this.createView(a,"views/base",{model:i,acl:t,selector:'.list-row[data-id="'+a+'"]',optionsToPass:["acl"],layoutDefs:{type:this._internalLayoutType,layout:e},setViewBeforeCallback:this.options.skipBuildRows&&!this.isRendered()},s)},i)}buildRows(r){if(this.checkedList=[],this.rowList=[],this.collection.length<=0)"function"==typeof r&&(r(),this.trigger("after:build-rows"));else{let t=0,e=this.pagination?2:1,i=()=>{++t===e&&"function"==typeof r&&r()},s=(this.wait(!0),this.collection.models),a=s.length,l=0;s.forEach(e=>{this.buildRow(t,e,()=>{++l===a&&(i(),this.wait(!1),this.trigger("after:build-rows"))})}),this.pagination&&this.createView("pagination","views/record/list-pagination",{collection:this.collection},i)}}showMoreRecords(i,l,r,o,t){l=l||this.collection,o=o||this.$el.find(".show-more"),r=r||this.$el.find(this.listContainerEl),i=i||{};const n=this.$el.find(".list");o.children("a").addClass("disabled"),i.skipNotify||Espo.Ui.notify(" ... ");let s=l.length;const d=()=>{var e;o.parent().append(o),l.total>l.length+l.lengthCorrection||-1===l.total?(e=l.total-l.length-l.lengthCorrection,e=this.getNumberUtil().formatInt(e),this.$el.find(".more-count").text(e),o.removeClass("hidden"),n.addClass("has-show-more")):(o.remove(),n.removeClass("has-show-more")),o.children("a").removeClass("disabled"),this.allResultIsChecked&&this.$el.find("input.record-checkbox").attr("disabled","disabled").prop("checked",!0),i.skipNotify||Espo.Ui.notify(!1),t&&t.call(this),this.trigger("after:show-more",s)};let h=l.length;this.listenToOnce(l,"update",(e,t)=>{t.changes.merged.length&&(e.lengthCorrection+=t.changes.merged.length)}),l.fetch({success:()=>{i.skipNotify||Espo.Ui.notify(!1),o.addClass("hidden"),n.removeClass("has-show-more");let s=l.length-h,a=0;l.length<=h&&d();for(let e=h;e<l.length;e++){var t=l.at(e);this.buildRow(e,t,e=>{var t=e.model;let i=this.getDomRowItem(t.id);i&&i.length&&i.remove(),r.append($(this.getRowContainerHtml(t.id))),e.render().then(()=>{++a===s&&d()})})}this.noRebuild=!0},remove:!1,more:!0})}getDomRowItem(e){return null}getRowContainerHtml(e){return $("<tr>").attr("data-id",e).addClass("list-row").get(0).outerHTML}actionQuickView(e){var s=(e=e||{}).id;if(s){let t=null,i=(this.collection&&(t=this.collection.get(s)),e.scope);if(i=(i=!i&&t?t.entityType:i)||this.scope)if(this.quickDetailDisabled)this.getRouter().navigate("#"+i+"/view/"+s,{trigger:!0});else{let e=new a.default(this.getMetadata(),this.getAcl());e.showDetail(this,{id:s,scope:i,model:t,rootUrl:this.options.keepCurrentRootUrl?this.getRouter().getCurrentUrl():null,editDisabled:this.quickEditDisabled}).then(e=>{t&&this.listenTo(e,"after:save",e=>{this.trigger("after:save",e)})})}else console.error("No scope.")}else console.error("No id.")}actionQuickEdit(s){var a=(s=s||{}).id;if(a){let t=null,i=(this.collection&&(t=this.collection.get(a)),s.scope);if(i=(i=!i&&t?t.entityType:i)||this.scope){var l=this.getMetadata().get(["clientDefs",i,"modalViews","edit"])||"views/modals/edit";if(!this.quickEditDisabled){Espo.Ui.notify(" ... ");let e={scope:i,id:a,model:t,fullFormDisabled:s.noFullForm,returnUrl:this.getRouter().getCurrentUrl(),returnDispatchParams:{controller:i,action:null,options:{isReturn:!0}}};return this.options.keepCurrentRootUrl&&(e.rootUrl=this.getRouter().getCurrentUrl()),void this.createView("modal",l,e,e=>{e.once("after:render",()=>{Espo.Ui.notify(!1)}),e.render(),this.listenToOnce(e,"remove",()=>{this.clearView("modal")}),this.listenToOnce(e,"after:save",e=>{let t=this.collection.get(e.id);t&&t.set(e.getClonedAttributes()),this.trigger("after:save",e)})})}let e={id:a,model:this.collection.get(a),returnUrl:this.getRouter().getCurrentUrl(),returnDispatchParams:{controller:i,action:null,options:{isReturn:!0}}};this.options.keepCurrentRootUrl&&(e.rootUrl=this.getRouter().getCurrentUrl()),this.getRouter().navigate("#"+i+"/edit/"+a,{trigger:!1}),this.getRouter().dispatch(i,"edit",e)}else console.error("No scope.")}else console.error("No id.")}getRowSelector(e){return'tr[data-id="'+e+'"]'}actionQuickRemove(e){let t=(e=e||{}).id;if(t){let e=this.collection.get(t);this.getAcl().checkModel(e,"delete")?this.confirm({message:this.translate("removeRecordConfirmation","messages",this.scope),confirmText:this.translate("Remove")},()=>{this.collection.trigger("model-removing",t),this.collection.remove(e),Espo.Ui.notify(" ... "),e.destroy({wait:!0,fromList:!0}).then(()=>{Espo.Ui.success(this.translate("Removed")),this.removeRecordFromList(t)}).catch(()=>{this.collection.push(e)})}):Espo.Ui.error(this.translate("Access denied"))}}removeRecordFromList(e){this.collection.remove(e),0<this.collection.total&&this.collection.total--,this.$el.find(".total-count-span").text(this.collection.total.toString());let t=this.checkedList.indexOf(e);-1!==t&&this.checkedList.splice(t,1);var i=e;this.clearView(i),~(t=this.rowList.indexOf(i))&&this.rowList.splice(t,1),this.removeRowHtml(e)}removeRowHtml(e){this.$el.find(this.getRowSelector(e)).remove(),0!==this.collection.length||0!==this.collection.total&&-2!==this.collection.total||this.reRender()}isIdChecked(e){return-1!==this.checkedList.indexOf(e)}getTableMinWidth(){if(this.listLayout){let t=0,i=0,s=0,a=0;this.listLayout.forEach(e=>{a++,e.widthPx?i+=e.widthPx:e.width?t+=e.width:s++}),this.rowActionsView&&!this.rowActionsDisabled&&(i+=this.rowActionsColumnWidth),this.checkboxes&&(i+=this.checkboxColumnWidth);let e;return e=100<=t?a*this.minColumnWidth:(e=(i+this.minColumnWidth*s)/(1-t/100),Math.round(e))}}}e.default=r}),define("views/record/edit",["exports","views/record/detail"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="record/edit";type="edit";fieldsMode="edit";mode="edit";buttonList=[{name:"save",label:"Save",style:"primary",title:"Ctrl+Enter"},{name:"cancel",label:"Cancel",title:"Esc"}];dropdownItemList=[];sideView="views/record/edit-side";bottomView="views/record/edit-bottom";duplicateAction=!1;saveAndContinueEditingAction=!0;saveAndNewAction=!0;setupHandlerType="record/edit";constructor(e){super(e)}actionSave(e){let t=this.isNew;return this.save((e=e||{}).options).then(()=>{this.options.duplicateSourceId&&(this.returnUrl=null),this.exit(t?"create":"save")}).catch(()=>{})}actionCancel(){this.cancel()}cancel(){this.isChanged&&this.resetModelChanges(),this.setIsNotChanged(),this.exit("cancel")}setupBeforeFinal(){this.model.isNew()&&this.populateDefaults(),super.setupBeforeFinal(),this.model.isNew()&&this.once("after:render",()=>{this.model.set(this.fetch(),{silent:!0})}),this.options.focusForCreate&&this.once("after:render",()=>{this.$el.closest(".modal").length?setTimeout(()=>this.focusForCreate(),50):this.focusForCreate()})}setupActionItems(){super.setupActionItems(),this.saveAndContinueEditingAction&&this.getAcl().checkScope(this.entityType,"edit")&&this.dropdownItemList.push({name:"saveAndContinueEditing",label:"Save & Continue Editing",title:"Ctrl+S"}),this.isNew&&this.saveAndNewAction&&this.getAcl().checkScope(this.entityType,"create")&&this.dropdownItemList.push({name:"saveAndNew",label:"Save & New",title:"Ctrl+Alt+Enter"})}actionSaveAndNew(e){e=e||{};var t=()=>{Espo.Ui.success(this.translate("Created")),this.getRouter().dispatch(this.scope,"create",{rootUrl:this.options.rootUrl,focusForCreate:!!e.focusForCreate}),this.getRouter().navigate("#"+this.scope+"/create",{trigger:!1})};this.save(e.options).then(t).catch(()=>{}),"notModified"===this.lastSaveCancelReason&&t()}handleShortcutKeyEscape(t){if(!this.buttonsDisabled&&-1!==this.buttonList.findIndex(e=>"cancel"===e.name&&!e.hidden)){t.preventDefault(),t.stopPropagation();let e=this.getFocusedFieldView();e&&this.model.set(e.fetch()),this.isChanged?this.confirm(this.translate("confirmLeaveOutMessage","messages")).then(()=>this.actionCancel()):this.actionCancel()}}handleShortcutKeyCtrlAltEnter(e){this.buttonsDisabled||(e.preventDefault(),e.stopPropagation(),this.saveAndNewAction&&this.hasAvailableActionItem("saveAndNew")&&this.actionSaveAndNew({focusForCreate:!0}))}}e.default=s}),define("views/record/row-actions/default",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="record/row-actions/default";setup(){this.options.acl=this.options.acl||{}}afterRender(){let e=this.$el.find('button[data-toggle="dropdown"]').parent(),t=!1;e.on("show.bs.dropdown",()=>{let e=this.$el.closest(".list-row");t=!1,e.hasClass("active")&&(t=!0),e.addClass("active")}),e.on("hide.bs.dropdown",()=>{t||this.$el.closest(".list-row").removeClass("active")})}getActionList(){let e=[{action:"quickView",label:"View",data:{id:this.model.id},link:"#"+this.model.entityType+"/view/"+this.model.id}];return this.options.acl.edit&&e.push({action:"quickEdit",label:"Edit",data:{id:this.model.id},link:"#"+this.model.entityType+"/edit/"+this.model.id}),this.options.acl.delete&&e.push({action:"quickRemove",label:"Remove",data:{id:this.model.id}}),e}data(){return{acl:this.options.acl,actionList:this.getActionList(),scope:this.model.entityType}}}e.default=s}),define("views/record/panels/bottom",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="record/panels/side";fieldList=null;actionList=null;buttonList=null;defs=null;mode="detail";disabled=!1;events={"click .action":function(e){Espo.Utils.handleAction(this,e.originalEvent,e.currentTarget,{actionItems:[...this.buttonList,...this.actionList],className:"panel-action"})}};data(){return{scope:this.scope,name:this.panelName,hiddenFields:this.recordHelper.getHiddenFields(),fieldList:this.getFieldList()}}init(){this.panelName=this.options.panelName,this.defs=this.options.defs||{},this.recordHelper=this.options.recordHelper,"disabled"in this.options&&(this.disabled=this.options.disabled),this.mode=this.options.mode||this.mode,this.readOnlyLocked=this.options.readOnlyLocked||this.readOnly,this.readOnly=this.readOnly||this.options.readOnly,this.inlineEditDisabled=this.inlineEditDisabled||this.options.inlineEditDisabled,this.buttonList=Espo.Utils.cloneDeep(this.defs.buttonList||this.buttonList||[]),this.actionList=Espo.Utils.cloneDeep(this.defs.actionList||this.actionList||[]),this.fieldList=this.options.fieldList||this.fieldList||[],this.recordViewObject=this.options.recordViewObject}setup(){this.setupFields(),this.fieldList=this.fieldList.map(e=>{let t=e;return"object"!=typeof t&&(t={name:t,viewKey:t+"Field"}),(t=Espo.Utils.clone(t)).viewKey=t.name+"Field",t.label=t.label||t.name,null!==this.recordHelper.getFieldStateParam(t.name,"hidden")?t.hidden=this.recordHelper.getFieldStateParam(t.name,"hidden"):this.recordHelper.setFieldStateParam(t.name,t.hidden||!1),t}),this.fieldList=this.fieldList.filter(e=>{if(e.name&&e.name in((this.model.defs||{}).fields||{}))return!0}),this.createFields()}setupFields(){}getButtonList(){return this.buttonList||[]}getActionList(){return this.actionList||[]}getFieldViews(){let t={};return this.getFieldList().forEach(e=>{this.hasView(e.viewKey)&&(t[e.name]=this.getView(e.viewKey))}),t}getFields(){return this.getFieldViews()}getFieldList(){return this.fieldList.map(e=>"object"!=typeof e?{name:e}:e)}createFields(){this.getFieldList().forEach(e=>{let t=null,i,s=null;"object"==typeof e?(i=e.name,t=e.view,"readOnly"in e&&(s=e.readOnly)):i=e,i in this.model.defs.fields&&this.createField(i,t,null,null,s)})}createField(e,t,i,s,a,l){var r=this.model.getFieldType(e)||"base";t=t||this.model.getFieldParam(e,"view")||this.getFieldManager().getViewName(r);const o={model:this.model,selector:'.field[data-name="'+e+'"]',defs:{name:e,params:i||{}},mode:s||this.mode,dataObject:this.options.dataObject};if(l)for(var n in l)o[n]=l[n];let d=this.readOnlyLocked;this.readOnly?o.readOnly=!0:null!==a&&(o.readOnly=a),a&&(d=!0),this.inlineEditDisabled&&(o.inlineEditDisabled=!0),this.recordHelper.getFieldStateParam(e,"hidden")&&(o.disabled=!0),this.recordHelper.getFieldStateParam(e,"hiddenLocked")&&(o.disabledLocked=!0),this.recordHelper.getFieldStateParam(e,"readOnly")&&(o.readOnly=!0),null!==this.recordHelper.getFieldStateParam(e,"required")&&(o.defs.params.required=this.recordHelper.getFieldStateParam(e,"required")),(d=!d&&this.recordHelper.getFieldStateParam(e,"readOnlyLocked")?!0:d)&&(o.readOnlyLocked=d),this.recordHelper.hasFieldOptionList(e)&&(o.customOptionList=this.recordHelper.getFieldOptionList(e)),this.recordViewObject&&(o.validateCallback=()=>this.recordViewObject.validateField(e)),this.createView(e+"Field",t,o)}isTabHidden(){if(-1===this.defs.tabNumber||void 0===this.defs.tabNumber)return!1;var e=this.getParentView();return e?!(!e||!e.hasTabs)&&e.currentTab!==defs.tabNumber:0<this.defs.tabNumber}}e.default=s}),define("views/fields/varchar",["exports","views/fields/base","helpers/reg-exp-pattern"],function(e,t,l){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),l=i(l);class s extends t.default{constructor(e){super(e)}type="varchar";listTemplate="fields/varchar/list";detailTemplate="fields/varchar/detail";searchTemplate="fields/varchar/search";searchTypeList=["startsWith","contains","equals","endsWith","like","notContains","notEquals","notLike","isEmpty","isNotEmpty"];validations=["required","pattern"];useAutocompleteUrl=!1;noSpellCheck=!1;setup(){this.setupOptions(),this.noSpellCheck=this.noSpellCheck||this.params.noSpellCheck,this.params.optionsPath&&(this.params.options=Espo.Utils.clone(this.getMetadata().get(this.params.optionsPath)||[])),this.options.customOptionList&&this.setOptionList(this.options.customOptionList),this.mode===this.MODE_DETAIL&&this.params.copyToClipboard&&(this.events['click [data-action="copyToClipboard"]']=()=>this.copyToClipboard())}setupOptions(){}setOptionList(e){this.originalOptionList||(this.originalOptionList=this.params.options||[]),this.params.options=Espo.Utils.clone(e),this.isEditMode()&&this.isRendered()&&this.reRender()}resetOptionList(){this.originalOptionList&&(this.params.options=Espo.Utils.clone(this.originalOptionList)),this.isEditMode()&&this.isRendered()&&this.reRender()}copyToClipboard(){var e=this.model.get(this.name);navigator.clipboard.writeText(e).then(()=>{Espo.Ui.success(this.translate("Copied to clipboard"))})}getAutocompleteUrl(e){return""}transformAutocompleteResult(e){let t="string"==typeof e?JSON.parse(e):e,i=[];return t.list.forEach(e=>{i.push({id:e.id,name:e.name||e.id,data:e.id,value:e.name||e.id,attributes:e})}),{suggestions:i}}setupSearch(){this.events["change select.search-type"]=e=>{e=$(e.currentTarget).val();this.handleSearchType(e)}}data(){let e=super.data();return null!==this.model.get(this.name)&&""!==this.model.get(this.name)&&this.model.has(this.name)&&(e.isNotEmpty=!0),e.valueIsSet=this.model.has(this.name),this.isSearchMode()&&"string"==typeof this.searchParams.value&&(this.searchData.value=this.searchParams.value),e.noSpellCheck=this.noSpellCheck,e.copyToClipboard=this.params.copyToClipboard,e}handleSearchType(e){~["isEmpty","isNotEmpty"].indexOf(e)?this.$el.find("input.main-element").addClass("hidden"):this.$el.find("input.main-element").removeClass("hidden")}afterRender(){var e;if(super.afterRender(),this.isSearchMode()&&(e=this.$el.find("select.search-type").val(),this.handleSearchType(e)),(this.isEditMode()||this.isSearchMode())&&(this.params.options&&this.params.options.length||this.useAutocompleteUrl)){const t={minChars:0,lookup:this.params.options,maxHeight:200,triggerSelectOnValidInput:!1,autoSelectFirst:!0,beforeRender:e=>{this.$element.hasClass("input-sm")&&e.addClass("small")},formatResult:e=>this.getHelper().escapeString(e.value),lookupFilter:(e,t,i)=>0===e.value.toLowerCase().indexOf(i)&&e.value.length!==i.length,onSelect:()=>{this.trigger("change"),this.$element.focus()}};this.useAutocompleteUrl&&(t.noCache=!0,t.lookup=(e,t)=>{Espo.Ajax.getRequest(this.getAutocompleteUrl(e)).then(e=>this.transformAutocompleteResult(e)).then(e=>{t(e)})}),this.$element.autocomplete(t),this.$element.attr("autocomplete","espo-"+this.name),this.$element.off("focus.autocomplete"),this.$element.on("focus",()=>{this.$element.val()||this.$element.autocomplete("onValueChange")}),this.once("render",()=>this.$element.autocomplete("dispose")),this.once("remove",()=>this.$element.autocomplete("dispose"))}this.isSearchMode()&&(this.$el.find("select.search-type").on("change",()=>{this.trigger("change")}),this.$element.on("input",()=>{this.trigger("change")}))}validatePattern(){var e=this.params.pattern;return this.fieldValidatePattern(this.name,e)}fieldValidatePattern(e,t){t=t||this.model.getFieldParam(e,"pattern");var i=this.model.get(e);if(!t)return!1;let s=new l.default(this.getMetadata(),this.getLanguage()),a=s.validate(t,i,e,this.entityType);if(!a)return!1;t=a.message.replace("{field}",this.getLanguage().translate(this.getLabelText()));return this.showValidationMessage(t,'[data-name="'+e+'"]'),!0}fetch(){let e={};var t=this.$element.val().trim();return e[this.name]=t||null,e}fetchSearch(){var t=this.fetchSearchType()||"startsWith";if(~["isEmpty","isNotEmpty"].indexOf(t)){if("isEmpty"===t)return{type:"or",value:[{type:"isNull",field:this.name},{type:"equals",field:this.name,value:""}],data:{type:t}};let e=[{type:"isNotNull",field:this.name,value:null}];return this.model.getFieldParam(this.name,"notStorable")||e.push({type:"notEquals",field:this.name,value:""}),{type:"and",value:e,data:{type:t}}}var e=this.$element.val().toString().trim();return e?{value:e,type:t,data:{type:t}}:null}getSearchType(){return this.getSearchParamsData().type||this.searchParams.typeFront||this.searchParams.type}}e.default=s}),define("views/fields/user",["exports","views/fields/link"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{searchTemplate="fields/user/search";setupSearch(){super.setupSearch(),this.searchTypeList=Espo.Utils.clone(this.searchTypeList),this.searchTypeList.push("isFromTeams"),this.searchData.teamIdList=this.getSearchParamsData().teamIdList||this.searchParams.teamIdList||[],this.searchData.teamNameHash=this.getSearchParamsData().teamNameHash||this.searchParams.teamNameHash||{},this.events['click a[data-action="clearLinkTeams"]']=e=>{e=$(e.currentTarget).data("id").toString();this.deleteLinkTeams(e)},this.addActionHandler("selectLinkTeams",()=>{Espo.Ui.notify(" ... ");var e=this.getMetadata().get("clientDefs.Team.modalViews.select")||"views/modals/select-records";this.createView("dialog",e,{scope:"Team",createButton:!1,multiple:!0},e=>{e.render(),Espo.Ui.notify(!1),this.listenToOnce(e,"select",e=>{(e="[object Array]"!==Object.prototype.toString.call(e)?[e]:e).forEach(e=>{this.addLinkTeams(e.id,e.get("name"))})})})}),this.events['click a[data-action="clearLinkTeams"]']=e=>{e=$(e.currentTarget).data("id").toString();this.deleteLinkTeams(e)}}handleSearchType(e){super.handleSearchType(e),"isFromTeams"===e?this.$el.find("div.teams-container").removeClass("hidden"):this.$el.find("div.teams-container").addClass("hidden")}afterRender(){if(super.afterRender(),this.mode===this.MODE_SEARCH){let t=this.$el.find("input.element-teams");t.autocomplete({serviceUrl:()=>"Team?&maxSize="+this.getAutocompleteMaxCount()+"&select=id,name",minChars:1,triggerSelectOnValidInput:!1,paramName:"q",noCache:!0,formatResult:e=>this.getHelper().escapeString(e.name),transformResult:e=>{e=JSON.parse(e);let t=[];return e.list.forEach(e=>{t.push({id:e.id,name:e.name,data:e.id,value:e.name})}),{suggestions:t}},onSelect:e=>{this.addLinkTeams(e.id,e.name),t.val(""),t.focus()}}),t.attr("autocomplete","espo-"+this.name),this.once("render",()=>{t.autocomplete("dispose")}),this.once("remove",()=>{t.autocomplete("dispose")}),"isFromTeams"===this.$el.find("select.search-type").val()&&this.searchData.teamIdList.forEach(e=>{this.addLinkTeamsHtml(e,this.searchData.teamNameHash[e])})}}deleteLinkTeams(e){this.deleteLinkTeamsHtml(e);var t=this.searchData.teamIdList.indexOf(e);-1<t&&this.searchData.teamIdList.splice(t,1),delete this.searchData.teamNameHash[e],this.trigger("change")}addLinkTeams(e,t){this.searchData.teamIdList=this.searchData.teamIdList||[],~this.searchData.teamIdList.indexOf(e)||(this.searchData.teamIdList.push(e),this.searchData.teamNameHash[e]=t,this.addLinkTeamsHtml(e,t),this.trigger("change"))}deleteLinkTeamsHtml(e){this.$el.find(".link-teams-container .link-"+e).remove()}addLinkTeamsHtml(e,t){e=this.getHelper().escapeString(e),t=this.getHelper().escapeString(t);let i=this.$el.find(".link-teams-container"),s=$("<div />").addClass("link-"+e).addClass("list-group-item");return s.html(t+"&nbsp"),s.prepend('<a role="button" class="pull-right" data-id="'+e+'" data-action="clearLinkTeams"><span class="fas fa-times"></a>'),i.append(s),s}fetchSearch(){var e=this.$el.find("select.search-type").val();return"isFromTeams"===e?{type:"isUserFromTeams",field:this.name,value:this.searchData.teamIdList,data:{type:e,teamIdList:this.searchData.teamIdList,teamNameHash:this.searchData.teamNameHash}}:super.fetchSearch()}}e.default=s}),define("views/fields/range-int",["exports","views/fields/base","views/fields/int","autonumeric"],function(e,t,i,s){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),i=a(i),s=a(s);class l extends t.default{type="rangeInt";listTemplate="fields/range-int/detail";detailTemplate="fields/range-int/detail";editTemplate="fields/range-int/edit";validations=["required","int","range","order"];data(){const e=super.data();return e.ucName=Espo.Utils.upperCaseFirst(this.name),e.fromValue=this.model.get(this.fromField),e.toValue=this.model.get(this.toField),e}init(){var e=Espo.Utils.upperCaseFirst(this.options.defs.name);this.fromField="from"+e,this.toField="to"+e,super.init()}getValueForDisplay(){let e=this.model.get(this.fromField),t=this.model.get(this.toField);return e=isNaN(e)?null:e,t=isNaN(t)?null:t,null!==e&&null!==t?this.formatNumber(e)+" &#8211 "+this.formatNumber(t):e?"&#62;&#61; "+this.formatNumber(e):t?"&#60;&#61; "+this.formatNumber(t):this.translate("None")}setup(){this.getPreferences().has("decimalMark")?this.decimalMark=this.getPreferences().get("decimalMark"):this.getConfig().has("decimalMark")&&(this.decimalMark=this.getConfig().get("decimalMark")),this.getPreferences().has("thousandSeparator")?this.thousandSeparator=this.getPreferences().get("thousandSeparator"):this.getConfig().has("thousandSeparator")&&(this.thousandSeparator=this.getConfig().get("thousandSeparator"))}setupFinal(){super.setupFinal(),this.setupAutoNumericOptions()}setupAutoNumericOptions(){var e=(this.disableFormatting?null:this.thousandSeparator)||"";let t="."===e?",":".";this.autoNumericOptions={digitGroupSeparator:e,decimalCharacter:t,modifyValueOnWheel:!1,decimalPlaces:0,selectOnFocus:!1,formulaMode:!0}}afterRender(){super.afterRender(),this.mode===this.MODE_EDIT&&(this.$from=this.$el.find('[data-name="'+this.fromField+'"]'),this.$to=this.$el.find('[data-name="'+this.toField+'"]'),this.$from.on("change",()=>{this.trigger("change")}),this.$to.on("change",()=>{this.trigger("change")}),this.autoNumericOptions&&(this.autoNumericInstance1=new s.default(this.$from.get(0),this.autoNumericOptions),this.autoNumericInstance2=new s.default(this.$to.get(0),this.autoNumericOptions)))}validateRequired(){var e=e=>{var t;if(this.model.isRequired(e)&&null===this.model.get(e))return t=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(t,'[data-name="'+e+'"]'),!0};let t=!1;return t=e(this.fromField)||t,t=e(this.toField)||t}validateInt(){var e=e=>{var t;if(isNaN(this.model.get(e)))return t=this.translate("fieldShouldBeInt","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(t,'[data-name="'+e+'"]'),!0};let t=!1;return t=e(this.fromField)||t,t=e(this.toField)||t}validateRange(){var e=e=>{var t=this.model.get(e);if(null===t)return!1;var i,s=this.model.getFieldParam(e,"min"),a=this.model.getFieldParam(e,"max");if(null!==s&&null!==a){if(t<s||a<t)return i=this.translate("fieldShouldBeBetween","messages").replace("{field}",this.translate(e,"fields",this.entityType)).replace("{min}",s).replace("{max}",a),this.showValidationMessage(i,'[data-name="'+e+'"]'),!0}else if(null!==s){if(t<s)return i=this.translate("fieldShouldBeLess","messages").replace("{field}",this.translate(e,"fields",this.entityType)).replace("{value}",s),this.showValidationMessage(i,'[data-name="'+e+'"]'),!0}else if(null!==a)if(a<t)return s=this.translate("fieldShouldBeGreater","messages").replace("{field}",this.translate(e,"fields",this.entityType)).replace("{value}",a),this.showValidationMessage(s,'[data-name="'+e+'"]'),!0};let t=!1;return t=e(this.fromField)||t,t=e(this.toField)||t}validateOrder(){var e=this.model.get(this.fromField),t=this.model.get(this.toField);if(null!==e&&null!==t&&t<e)return t=this.translate("fieldShouldBeGreater","messages").replace("{field}",this.translate(this.toField,"fields",this.entityType)).replace("{value}",this.translate(this.fromField,"fields",this.entityType)),this.showValidationMessage(t,'[data-name="'+this.fromField+'"]'),!0}isRequired(){return this.model.getFieldParam(this.fromField,"required")||this.model.getFieldParam(this.toField,"required")}parse(e){return i.default.prototype.parse.call(this,e)}formatNumber(e){return i.default.prototype.formatNumberDetail.call(this,e)}fetch(){let e={};return e[this.fromField]=this.parse(this.$from.val().trim()),e[this.toField]=this.parse(this.$to.val().trim()),e}}e.default=l}),define("views/fields/link-multiple",["exports","views/fields/base","helpers/record-modal"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{type="linkMultiple";listTemplate="fields/link-multiple/list";detailTemplate="fields/link-multiple/detail";editTemplate="fields/link-multiple/edit";searchTemplate="fields/link-multiple/search";nameHashName=null;idsName=null;nameHash=null;ids=null;foreignScope=null;autocompleteDisabled=!1;selectRecordsView="views/modals/select-records";createDisabled=!1;forceCreateButton=!1;sortable=!1;searchTypeList=["anyOf","isEmpty","isNotEmpty","noneOf","allOf"];selectFilterList=null;selectBoolFilterList=null;selectPrimaryFilterName=null;autocompleteMaxCount=null;forceSelectAllAttributes=!1;iconHtml="";events={'auxclick a[href]:not([role="button"])':function(e){var t;this.isReadMode()&&(1!==e.button||!e.ctrlKey&&!e.metaKey||(t=$(e.currentTarget).attr("data-id"))&&(e.preventDefault(),e.stopPropagation(),this.quickView(t)))}};data(){let e=this.model.get(this.idsName);return{...super.data(),idValues:this.model.get(this.idsName),idValuesString:e?e.join(","):"",nameHash:this.model.get(this.nameHashName),foreignScope:this.foreignScope,valueIsSet:this.model.has(this.idsName)}}getSelectFilters(){return null}getSelectBoolFilterList(){return this.selectBoolFilterList}getSelectPrimaryFilterName(){return this.selectPrimaryFilterName}getSelectFilterList(){return this.selectFilterList}getCreateAttributes(){let t=this.getMetadata().get(["clientDefs",this.entityType,"relationshipPanels",this.name,"createAttributeMap"])||{},i={};return Object.keys(t).forEach(e=>i[t[e]]=this.model.get(e)),i}setup(){var e,t;this.nameHashName=this.name+"Names",this.idsName=this.name+"Ids",this.foreignScope=this.options.foreignScope||this.foreignScope||this.model.getFieldParam(this.name,"entity")||this.model.getLinkParam(this.name,"entity"),"createDisabled"in this.options&&(this.createDisabled=this.options.createDisabled),this.isSearchMode()?(e=this.getSearchParamsData().nameHash||this.searchParams.nameHash||{},t=this.getSearchParamsData().idList||this.searchParams.value||[],this.nameHash=Espo.Utils.clone(e),this.ids=Espo.Utils.clone(t)):this.copyValuesFromModel(),this.listenTo(this.model,"change:"+this.idsName,()=>{this.copyValuesFromModel()}),this.sortable=this.sortable||this.params.sortable,this.iconHtml=this.getHelper().getScopeColorIconHtml(this.foreignScope),this.isListMode()||(this.addActionHandler("selectLink",()=>this.actionSelect()),this.events['click a[data-action="clearLink"]']=e=>{e=$(e.currentTarget).attr("data-id");this.deleteLink(e),this.$element.get(0).focus({preventScroll:!0})})}copyValuesFromModel(){this.ids=Espo.Utils.clone(this.model.get(this.idsName)||[]),this.nameHash=Espo.Utils.clone(this.model.get(this.nameHashName)||{})}handleSearchType(e){~["anyOf","noneOf","allOf"].indexOf(e)?this.$el.find("div.link-group-container").removeClass("hidden"):this.$el.find("div.link-group-container").addClass("hidden")}setupSearch(){this.events=_.extend({"change select.search-type":e=>{e=$(e.currentTarget).val();this.handleSearchType(e)}},this.events||{})}getAutocompleteMaxCount(){return this.autocompleteMaxCount||this.getConfig().get("recordsPerPage")}getAutocompleteUrl(){let t=this.foreignScope+"?&maxSize="+this.getAutocompleteMaxCount();if(!this.forceSelectAllAttributes){const s=this.getMetadata().get(["clientDefs",this.entityType,"relationshipPanels",this.name])||{};var i=this.mandatorySelectAttributeList||s.selectMandatoryAttributeList;let e=["id","name"];i&&(e=e.concat(i)),t+="&select="+e.join(",")}const s=this.getMetadata().get(["clientDefs",this.entityType,"relationshipPanels",this.name])||{};i=[...this.getSelectBoolFilterList()||[],...s.selectBoolFilterList||[]],i.length&&(t+="&"+$.param({boolFilterList:i})),i=this.getSelectPrimaryFilterName()||s.selectPrimaryFilter;return i&&(t+="&"+$.param({primaryFilter:i})),t}afterRender(){if(this.isEditMode()||this.isSearchMode()){this.$element=this.$el.find("input.main-element");let e=this.$element;var t;this.autocompleteDisabled||(this.$element.on("blur",()=>{setTimeout(()=>this.$element.autocomplete("clear"),300)}),this.$element.autocomplete({serviceUrl:()=>this.getAutocompleteUrl(),minChars:1,paramName:"q",noCache:!0,autoSelectFirst:!0,triggerSelectOnValidInput:!1,beforeRender:e=>{this.$element.hasClass("input-sm")&&e.addClass("small")},formatResult:e=>this.getHelper().escapeString(e.name),transformResult:e=>{e=JSON.parse(e);let t=[];return e.list.forEach(e=>{t.push({id:e.id,name:e.name||e.id,data:e.id,value:e.name||e.id})}),{suggestions:t}},onSelect:e=>{this.addLink(e.id,e.name),this.$element.val(""),this.$element.focus()}}),this.$element.attr("autocomplete","espo-"+this.name),this.once("render",()=>{e.autocomplete("dispose")}),this.once("remove",()=>{e.autocomplete("dispose")})),e.on("change",()=>{e.val("")}),this.renderLinks(),this.isEditMode()&&this.sortable&&this.$el.find(".link-container").sortable({stop:()=>{this.fetchFromDom(),this.trigger("change")}}),this.isSearchMode()&&(t=this.$el.find("select.search-type").val(),this.handleSearchType(t),this.$el.find("select.search-type").on("change",()=>{this.trigger("change")}))}}renderLinks(){this.ids.forEach(e=>{this.addLinkHtml(e,this.nameHash[e])})}deleteLink(e){this.trigger("delete-link",e),this.trigger("delete-link:"+e),this.deleteLinkHtml(e);var t=this.ids.indexOf(e);-1<t&&this.ids.splice(t,1),delete this.nameHash[e],this.afterDeleteLink(e),this.trigger("change")}addLink(e,t){~this.ids.indexOf(e)||(this.ids.push(e),this.nameHash[e]=t,this.addLinkHtml(e,t),this.afterAddLink(e),this.trigger("add-link",e),this.trigger("add-link:"+e)),this.trigger("change")}afterDeleteLink(e){}afterAddLink(e){}deleteLinkHtml(e){this.$el.find(".link-"+e).remove()}addLinkHtml(e,t){t=t||e;let i=this.$el.find(".link-container"),s=$("<div>").addClass("link-"+e).addClass("list-group-item").attr("data-id",e);return s.text(t).append("&nbsp;"),s.prepend($("<a>").addClass("pull-right").attr("role","button").attr("tabindex","0").attr("data-id",e).attr("data-action","clearLink").append($("<span>").addClass("fas fa-times"))),i.append(s),s}getIconHtml(e){return this.iconHtml}getDetailLinkHtml(e,t){!(t=t||this.nameHash[e]||e)&&e&&(t=this.translate(this.foreignScope,"scopeNames"));var i=this.isDetailMode()?this.getIconHtml(e):"";let s=$("<a>").attr("href",this.getUrl(e)).attr("data-id",e).text(t);return i&&s.prepend(i),s.get(0).outerHTML}getUrl(e){return"#"+this.foreignScope+"/view/"+e}getValueForDisplay(){if(!this.isDetailMode()&&!this.isListMode())return null;let t=[];return this.ids.forEach(e=>{t.push(this.getDetailLinkHtml(e))}),t.length?t.map(e=>$("<div>").addClass("link-multiple-item").html(e).wrap("<div />").parent().html()).join(""):null}validateRequired(){return!!this.isRequired()&&(0===(this.model.get(this.idsName)||[]).length&&(e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0));var e}fetch(){let e={};return e[this.idsName]=Espo.Utils.clone(this.ids),e[this.nameHashName]=Espo.Utils.clone(this.nameHash),e}fetchFromDom(){this.ids=[],this.$el.find(".link-container").children().each((e,t)=>{t=$(t).attr("data-id");t&&this.ids.push(t)})}fetchSearch(){var e=this.$el.find("select.search-type").val(),t=this.ids||[];if(~["anyOf","allOf","noneOf"].indexOf(e)&&!t.length)return{type:"isNotNull",attribute:"id",data:{type:e}};let i;return"anyOf"===e?i={type:"linkedWith",value:t,data:{type:e,nameHash:this.nameHash}}:"allOf"===e?(i={type:"linkedWithAll",value:t,data:{type:e,nameHash:this.nameHash}},t.length||(i.value=null),i):"noneOf"===e?i={type:"notLinkedWith",value:t,data:{type:e,nameHash:this.nameHash}}:"isEmpty"===e?i={type:"isNotLinked",data:{type:e}}:"isNotEmpty"===e?i={type:"isLinked",data:{type:e}}:void 0}getSearchType(){return this.getSearchParamsData().type||this.searchParams.typeFront||this.searchParams.type||"anyOf"}quickView(e){var t=this.foreignScope;let i=new s.default(this.getMetadata(),this.getAcl());i.showDetail(this,{id:e,scope:t})}actionSelect(){Espo.Ui.notify(" ... ");const s=this.getMetadata().get(["clientDefs",this.entityType,"relationshipPanels",this.name])||{},a=s.selectModalView||this.getMetadata().get(`clientDefs.${this.foreignScope}.modalViews.select`)||this.selectRecordsView,l=this.mandatorySelectAttributeList||s.selectMandatoryAttributeList,e=s.selectHandler||null;let r=this.isEditMode()&&(!this.createDisabled&&!s.createDisabled||this.forceCreateButton),o=null;r&&(o=()=>{let i=this.getCreateAttributes()||{};return s.createHandler?new Promise(t=>{Espo.loader.requirePromise(s.createHandler).then(e=>new e(this.getHelper())).then(e=>{e.getAttributes(this.model).then(e=>{t({...i,...e})})})}):Promise.resolve(i)}),new Promise(t=>{e&&!this.isSearchMode()?Espo.loader.requirePromise(e).then(e=>new e(this.getHelper())).then(e=>{e.getFilters(this.model).then(e=>t(e))}):t({})}).then(e=>{var t={...this.getSelectFilters()||{},...e.advanced||{}},i=[...this.getSelectBoolFilterList()||[],...e.bool||[],...s.selectBoolFilterList||[]],e=this.getSelectPrimaryFilterName()||e.primary||s.selectPrimaryFilter;this.createView("dialog",a,{scope:this.foreignScope,createButton:r,filters:t,boolFilterList:i,primaryFilterName:e,filterList:this.getSelectFilterList(),multiple:!0,mandatorySelectAttributeList:l,forceSelectAllAttributes:this.forceSelectAllAttributes,createAttributesProvider:o},e=>{e.render(),Espo.Ui.notify(!1),this.listenToOnce(e,"select",e=>{this.clearView("dialog"),(e="[object Array]"!==Object.prototype.toString.call(e)?[e]:e).forEach(e=>{this.addLink(e.id,e.get("name"))})})})})}}e.default=a}),define("views/fields/enum",["exports","views/fields/base","ui/multi-select","ui/select"],function(e,t,s,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),s=a(s),i=a(i);class l extends t.default{constructor(e){super(e)}type="enum";listTemplate="fields/enum/list";listLinkTemplate="fields/enum/list-link";detailTemplate="fields/enum/detail";editTemplate="fields/enum/edit";searchTemplate="fields/enum/search";translatedOptions=null;fetchEmptyValueAsNull=!0;searchTypeList=["anyOf","noneOf","isEmpty","isNotEmpty"];validationElementSelector=".selectize-control";data(){let e=super.data();e.translatedOptions=this.translatedOptions;var t=this.model.get(this.name),i=(this.isReadMode()&&this.styleMap&&(e.style=this.styleMap[t||""]||"default"),this.isReadMode()&&(this.params.displayAsLabel&&e.style&&"default"!==e.style?e.class="label label-md label":e.class="text"),t||"");return(null!=t&&""!==t||""===i&&i in(this.translatedOptions||{})&&""!==(this.translatedOptions||{})[i])&&(e.isNotEmpty=!0),e.valueIsSet=this.model.has(this.name),e.isNotEmpty&&(e.valueTranslated=this.translatedOptions?this.translatedOptions[i]||t:this.getLanguage().translateOption(i,this.name,this.entityType)),e}setup(){var e,t;this.params.options||(e="get"+Espo.Utils.upperCaseFirst(this.name)+"Options","function"==typeof this.model[e]&&(this.params.options=this.model[e].call(this.model)));let i=this.params.optionsPath,s=this.params.optionsReference;!i&&s&&([e,t]=s.split("."),i=`entityDefs.${e}.fields.${t}.options`),i&&(this.params.options=Espo.Utils.clone(this.getMetadata().get(i))||[]),this.styleMap=this.params.style||this.model.getFieldParam(this.name,"style")||{},this.setupOptions(),"translatedOptions"in this.options&&(this.translatedOptions=this.options.translatedOptions),"translatedOptions"in this.params&&(this.translatedOptions=this.params.translatedOptions),this.setupTranslation(),null===this.translatedOptions&&(this.translatedOptions=this.getLanguage().translate(this.name,"options",this.model.name)||{},this.translatedOptions===this.name&&(this.translatedOptions=null)),this.params.isSorted&&this.translatedOptions&&(this.params.options=Espo.Utils.clone(this.params.options)||[],this.params.options=this.params.options.sort((e,t)=>(this.translatedOptions[e]||e).localeCompare(this.translatedOptions[t]||t))),this.options.customOptionList&&this.setOptionList(this.options.customOptionList)}setupTranslation(){let e=this.params.translation,t=this.params.optionsReference;var i;if(!e&&t&&([s,i]=t.split("."),e=s+".options."+i),e&&(this.translatedOptions=null,this.params.options)){let t=this.getLanguage().translatePath(e),i={};this.params.options.forEach(e=>{"object"==typeof t&&e in t?i[e]=t[e]:Array.isArray(t)&&"number"==typeof e&&void 0!==t[e]?i[e.toString()]=t[e]:i[e]=e});var s=this.model.get(this.name);!s&&""!==s||s in i||"object"==typeof t&&s in t&&(i[s]=t[s]),this.translatedOptions=i}}setupOptions(){}setOptionList(t){var e=this.params.options;this.originalOptionList||(this.originalOptionList=this.params.options);let i=Espo.Utils.clone(t)||[];this.params.options=i;e=!_(e).isEqual(t);if(this.isEditMode()&&e){let e=!1;t=this.model.get(this.name);!i.includes(t)&&this.isReady&&(this.model.set(this.name,i[0]??null,{silent:!0}),e=!0),this.reRender().then(()=>{e&&this.trigger("change")})}}resetOptionList(){var e;this.originalOptionList&&(e=this.params.options,this.params.options=Espo.Utils.clone(this.originalOptionList),e=!_(e).isEqual(this.originalOptionList),this.isEditMode()&&e&&this.isRendered()&&this.reRender())}setupSearch(){this.events=_.extend({"change select.search-type":e=>{this.handleSearchType($(e.currentTarget).val())}},this.events||{})}handleSearchType(e){var t=this.$el.find("div.input-container");~["anyOf","noneOf"].indexOf(e)?t.removeClass("hidden"):t.addClass("hidden")}afterRender(){if(super.afterRender(),this.isSearchMode()){this.$element=this.$el.find(".main-element");var t=this.$el.find("select.search-type").val();this.handleSearchType(t);let e=this.getSearchParamsData().valueList||this.searchParams.value||[],i=(this.$element.val(e.join(":,:")),[]);(this.params.options||[]).forEach(e=>{let t=this.getLanguage().translateOption(e,this.name,this.scope);""!==(t=this.translatedOptions&&e in this.translatedOptions?this.translatedOptions[e]:t)&&i.push({value:e,text:t})});t={items:i,delimiter:":,:",matchAnyWord:!0};s.default.init(this.$element,t),this.$el.find(".selectize-dropdown-content").addClass("small"),this.$el.find("select.search-type").on("change",()=>this.trigger("change")),this.$element.on("change",()=>this.trigger("change"))}(this.isEditMode()||this.isSearchMode())&&i.default.init(this.$element,{matchAnyWord:!0})}focusOnInlineEdit(){i.default.focus(this.$element)}validateRequired(){var e;if(this.isRequired()&&!this.model.get(this.name))return e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0}fetch(){let e=this.$element.val(),t=(this.fetchEmptyValueAsNull&&!e&&(e=null),{});return t[this.name]=e,t}parseItemForSearch(e){return e}fetchSearch(){var e=this.fetchSearchType();let i=this.$element.val().split(":,:");if((i=1===i.length&&""===i[0]?[]:i).forEach((e,t)=>{i[t]=this.parseItemForSearch(e)}),"anyOf"===e)return 0===i.length?{type:"any",data:{type:"anyOf",valueList:i}}:{type:"in",value:i,data:{type:"anyOf",valueList:i}};if("noneOf"===e)return 0===i.length?{type:"any",data:{type:"noneOf",valueList:i}}:{type:"or",value:[{type:"notIn",value:i,attribute:this.name},{type:"isNull",attribute:this.name}],data:{type:"noneOf",valueList:i}};if("isEmpty"===e)return{type:"or",value:[{type:"isNull",attribute:this.name},{type:"equals",value:"",attribute:this.name}],data:{type:"isEmpty"}};if("isNotEmpty"!==e)return null;{let e=[{type:"isNotNull",attribute:this.name}];return this.model.getFieldParam(this.name,"notStorable")||e.push({type:"notEquals",value:"",attribute:this.name}),{type:"and",value:e,data:{type:"isNotEmpty"}}}}getSearchType(){return this.getSearchParamsData().type||"anyOf"}}e.default=l}),define("views/fields/date",["exports","views/fields/base","moment"],function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),n=i(n);class s extends t.default{type="date";listTemplate="fields/date/list";listLinkTemplate="fields/date/list-link";detailTemplate="fields/date/detail";editTemplate="fields/date/edit";searchTemplate="fields/date/search";validations=["required","date","after","before"];searchTypeList=["lastSevenDays","ever","isEmpty","currentMonth","lastMonth","nextMonth","currentQuarter","lastQuarter","currentYear","lastYear","today","past","future","lastXDays","nextXDays","olderThanXDays","afterXDays","on","after","before","between"];initialSearchIsNotIdle=!0;setup(){super.setup(),this.getConfig().get("fiscalYearShift")&&(this.searchTypeList=Espo.Utils.clone(this.searchTypeList),this.getConfig().get("fiscalYearShift")%3!=0&&(this.searchTypeList.push("currentFiscalQuarter"),this.searchTypeList.push("lastFiscalQuarter")),this.searchTypeList.push("currentFiscalYear"),this.searchTypeList.push("lastFiscalYear"))}data(){let e=super.data();var t,i;return e.dateValue=this.getDateStringValue(),e.isNone=null===e.dateValue,-1===e.dateValue&&(e.dateValue=null,e.isLoading=!0),this.isSearchMode()&&(t=this.getSearchParamsData().value||this.searchParams.dateValue,i=this.getSearchParamsData().valueTo||this.searchParams.dateValueTo,e.dateValue=this.getDateTime().toDisplayDate(t),e.dateValueTo=this.getDateTime().toDisplayDate(i),~["lastXDays","nextXDays","olderThanXDays","afterXDays"].indexOf(this.getSearchType())&&(e.number=this.searchParams.value)),e}setupSearch(){this.events=_.extend({"change select.search-type":e=>{e=$(e.currentTarget).val();this.handleSearchType(e)}},this.events||{})}stringifyDateValue(e){return e?this.mode===this.MODE_LIST||this.mode===this.MODE_DETAIL||this.mode===this.MODE_LIST_LINK?this.convertDateValueForDetail(e):this.getDateTime().toDisplayDate(e):this.mode===this.MODE_EDIT||this.mode===this.MODE_SEARCH||this.mode===this.MODE_LIST||this.mode===this.MODE_LIST_LINK?"":null}convertDateValueForDetail(e){if(this.getConfig().get("readableDateFormatDisabled")||this.params.useNumericFormat)return this.getDateTime().toDisplayDate(e);var t=this.getDateTime().getTimeZone(),i=this.getDateTime().internalDateTimeFormat,s=this.getDateTime().getReadableDateFormat(),e=e+" 00:00:00";let a=(0,n.default)().tz(t).startOf("day"),l=n.default.tz(e,i,t);var t=a.clone(),r=[t.unix(),t.add(1,"days").unix()],o=[t.unix(),t.add(1,"days").unix()],t=[t.add(-3,"days").unix(),t.add(1,"days").unix()];return l.unix()>=r[0]&&l.unix()<r[1]?this.translate("Today"):l.unix()>=o[0]&&l.unix()<o[1]?this.translate("Tomorrow"):l.unix()>=t[0]&&l.unix()<t[1]?this.translate("Yesterday"):(l=n.default.utc(e,i)).format("YYYY")===a.format("YYYY")?l.format(s):l.format(s+", YYYY")}getDateStringValue(){if(this.mode===this.MODE_DETAIL&&!this.model.has(this.name))return-1;var e=this.model.get(this.name);return this.stringifyDateValue(e)}afterRender(){if(this.mode===this.MODE_EDIT||this.mode===this.MODE_SEARCH){this.$element=this.$el.find('[data-name="'+this.name+'"]');let t=!1,e=(this.$element.on("change",e=>{t||(this.trigger("change"),t=!0,setTimeout(()=>t=!1,100)),e.isTrigger&&document.activeElement!==this.$element.get(0)&&this.$element.focus()}),this.$element.on("click",()=>{this.$element.datepicker("show")}),{format:this.getDateTime().dateFormat.toLowerCase(),weekStart:this.getDateTime().weekStart,autoclose:!0,todayHighlight:!0,keyboardNavigation:!0,todayBtn:this.getConfig().get("datepickerTodayButton")||!1,orientation:"bottom auto",templates:{leftArrow:'<span class="fas fa-chevron-left fa-sm"></span>',rightArrow:'<span class="fas fa-chevron-right fa-sm"></span>'},container:this.$el.closest(".modal-body").length?this.$el.closest(".modal-body"):"body"});var i=this.getConfig().get("language");if(i in $.fn.datepicker.dates||($.fn.datepicker.dates[i]={days:this.translate("dayNames","lists"),daysShort:this.translate("dayNamesShort","lists"),daysMin:this.translate("dayNamesMin","lists"),months:this.translate("monthNames","lists"),monthsShort:this.translate("monthNamesShort","lists"),today:this.translate("Today"),clear:this.translate("Clear")}),e.language=i,this.$element.datepicker(e),this.mode===this.MODE_SEARCH){let t=this.$el.find("input.additional");t.datepicker(e),t.parent().find("button.date-picker-btn").on("click",()=>{t.datepicker("show")}),this.$el.find("select.search-type").on("change",()=>{this.trigger("change")}),this.$el.find("input.number").on("change",()=>{this.trigger("change")}),t.on("change",e=>{this.trigger("change"),e.isTrigger&&document.activeElement!==t.get(0)&&t.focus()}),t.on("click",()=>{t.datepicker("show")})}if(this.$element.parent().find("button.date-picker-btn").on("click",()=>{this.$element.datepicker("show")}),this.mode===this.MODE_SEARCH){let e=this.$el.find("select.search-type");this.handleSearchType(e.val())}}}handleSearchType(e){this.$el.find("div.primary").addClass("hidden"),this.$el.find("div.additional").addClass("hidden"),this.$el.find("div.additional-number").addClass("hidden"),~["on","notOn","after","before"].indexOf(e)?this.$el.find("div.primary").removeClass("hidden"):~["lastXDays","nextXDays","olderThanXDays","afterXDays"].indexOf(e)?this.$el.find("div.additional-number").removeClass("hidden"):"between"===e&&(this.$el.find("div.primary").removeClass("hidden"),this.$el.find("div.additional").removeClass("hidden"))}parseDate(e){return this.getDateTime().fromDisplayDate(e)}parse(e){return e?this.parseDate(e):null}fetch(){let e={};return e[this.name]=this.parse(this.$element.val()),e}fetchSearch(){var e=this.parseDate(this.$element.val()),t=this.fetchSearchType();let i;if("between"===t){if(!e)return null;var s=this.parseDate(this.$el.find("input.additional").val());if(!s)return null;i={type:t,value:[e,s],data:{value:e,valueTo:s}}}else if(~["lastXDays","nextXDays","olderThanXDays","afterXDays"].indexOf(t)){s=this.$el.find("input.number").val();i={type:t,value:s}}else if(~["on","notOn","after","before"].indexOf(t)){if(!e)return null;i={type:t,value:e,data:{value:e}}}else i="isEmpty"===t?{type:"isNull",data:{type:t}}:{type:t};return i}getSearchType(){return this.getSearchParamsData().type||this.searchParams.typeFront||this.searchParams.type}validateRequired(){var e;if(this.isRequired())return null===this.model.get(this.name)?(e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0):void 0}validateDate(){var e;if(-1===this.model.get(this.name))return e=this.translate("fieldShouldBeDate","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0}validateAfter(){var e=this.model.getFieldParam(this.name,"after");if(!e)return!1;var t=this.model.get(this.name),i=this.model.get(e);return t&&i&&(0,n.default)(t).unix()<=(0,n.default)(i).unix()?(t=this.translate("fieldShouldAfter","messages").replace("{field}",this.getLabelText()).replace("{otherField}",this.translate(e,"fields",this.entityType)),this.showValidationMessage(t),!0):void 0}validateBefore(){var e=this.model.getFieldParam(this.name,"before");if(!e)return!1;var t=this.model.get(this.name),i=this.model.get(e);return t&&i&&(0,n.default)(t).unix()>=(0,n.default)(i).unix()?(t=this.translate("fieldShouldBefore","messages").replace("{field}",this.getLabelText()).replace("{otherField}",this.translate(e,"fields",this.entityType)),this.showValidationMessage(t),!0):void 0}}e.default=s}),define("views/fields/currency",["exports","views/fields/float","ui/select"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{type="currency";editTemplate="fields/currency/edit";detailTemplate="fields/currency/detail";detailTemplate1="fields/currency/detail-1";detailTemplate2="fields/currency/detail-2";detailTemplate3="fields/currency/detail-3";listTemplate="fields/currency/list";listTemplate1="fields/currency/list-1";listTemplate2="fields/currency/list-2";listTemplate3="fields/currency/list-3";detailTemplateNoCurrency="fields/currency/detail-no-currency";maxDecimalPlaces=3;validations=["required","number","range"];data(){var e=this.model.get(this.currencyFieldName)||this.getPreferences().get("defaultCurrency")||this.getConfig().get("defaultCurrency"),t=!this.isSingleCurrency||e!==this.defaultCurrency;return{...super.data(),currencyFieldName:this.currencyFieldName,currencyValue:e,currencyOptions:this.currencyOptions,currencyList:this.currencyList,currencySymbol:this.getMetadata().get(["app","currency","symbolMap",e])||"",multipleCurrencies:t,defaultCurrency:this.defaultCurrency}}setup(){super.setup(),this.currencyFieldName=this.name+"Currency",this.defaultCurrency=this.getConfig().get("defaultCurrency"),this.currencyList=this.getConfig().get("currencyList")||[this.defaultCurrency],this.decimalPlaces=this.getConfig().get("currencyDecimalPlaces"),this.params.onlyDefaultCurrency&&(this.currencyList=[this.defaultCurrency]),this.isSingleCurrency=this.currencyList.length<=1;var e=this.currencyValue=this.model.get(this.currencyFieldName)||this.defaultCurrency;~this.currencyList.indexOf(e)||(this.currencyList=Espo.Utils.clone(this.currencyList),this.currencyList.push(e))}setupAutoNumericOptions(){this.autoNumericOptions={digitGroupSeparator:this.thousandSeparator||"",decimalCharacter:this.decimalMark,modifyValueOnWheel:!1,selectOnFocus:!1,decimalPlaces:this.decimalPlaces,allowDecimalPadding:!0,showWarnings:!1,formulaMode:!0},null===this.decimalPlaces&&(this.autoNumericOptions.decimalPlaces=this.decimalPlacesRawValue,this.autoNumericOptions.decimalPlacesRawValue=this.decimalPlacesRawValue,this.autoNumericOptions.allowDecimalPadding=!1)}getCurrencyFormat(){return this.getConfig().get("currencyFormat")||1}_getTemplateName(){if(this.mode===this.MODE_DETAIL||this.mode===this.MODE_LIST){var e=this.mode===this.MODE_LIST?"listTemplate"+this.getCurrencyFormat().toString():"detailTemplate"+this.getCurrencyFormat().toString();if((e=this.options.hideCurrency?"detailTemplateNoCurrency":e)in this)return this[e]}return super._getTemplateName()}formatNumber(e){return this.formatNumberDetail(e)}formatNumberDetail(e){if(null===e)return"";{var i=this.decimalPlaces;let t=(e=0===i?Math.round(e):i?Math.round(e*Math.pow(10,i))/Math.pow(10,i):Math.round(e*Math.pow(10,this.maxDecimalPlaces))/Math.pow(10,this.maxDecimalPlaces)).toString().split(".");if(t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,this.thousandSeparator),0===i)return t[0];if(i){let e=0;if(1<t.length?e=t[1].length:t[1]="",i&&e<i){var s=i-e;for(let e=0;e<s;e++)t[1]+="0"}}return t.join(this.decimalMark)}}parse(e){return null===(e=""!==e?e:null)?null:(e=(e=e.split(this.thousandSeparator).join("")).split(this.decimalMark).join("."),this.params.decimal?e:parseFloat(e))}afterRender(){super.afterRender(),this.mode===this.MODE_EDIT&&(this.$currency=this.$el.find('[data-name="'+this.currencyFieldName+'"]'),this.$currency.on("change",()=>{this.model.set(this.currencyFieldName,this.$currency.val(),{ui:!0})}),i.default.init(this.$currency))}validateNumber(){if(!this.params.decimal)return this.validateFloat();var e=this.model.get(this.name);return Number.isNaN(Number(e))?(e=this.translate("fieldShouldBeNumber","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0):void 0}fetch(){var e=this.$element.val().trim(),e=this.parse(e);let t={},i=this.$currency.length?this.$currency.val():this.defaultCurrency;return null===e&&(i=null),t[this.name]=e,t[this.currencyFieldName]=i,t}}e.default=a}),define("views/fields/array",["exports","views/fields/base","helpers/reg-exp-pattern","ui/multi-select"],function(e,t,s,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s),a=i(a);class l extends t.default{type="array";listTemplate="fields/array/list";listLinkTemplate="fields/array/list-link";detailTemplate="fields/array/detail";editTemplate="fields/array/edit";searchTemplate="fields/array/search";searchTypeList=["anyOf","noneOf","allOf","isEmpty","isNotEmpty"];maxItemLength=null;validations=["required","maxCount"];MAX_ITEM_LENGTH=100;addItemModalView="views/modals/array-field-add";itemDelimiter=":,:";matchAnyWord=!0;translatedOptions=null;data(){let t=[];return(this.selected||[]).forEach(e=>{t.push(this.getItemHtml(e))}),{...super.data(),selected:this.selected,translatedOptions:this.translatedOptions,hasOptions:!!this.params.options,itemHtmlList:t,isEmpty:0===(this.selected||[]).length,valueIsSet:this.model.has(this.name),maxItemLength:this.maxItemLength||this.MAX_ITEM_LENGTH,allowCustomOptions:this.allowCustomOptions}}events={'click [data-action="removeValue"]':function(e){e=$(e.currentTarget).attr("data-value").toString();this.removeValue(e),this.focusOnElement()},'click [data-action="showAddModal"]':function(){this.actionAddItem()}};setup(){super.setup(),this.noEmptyString=this.params.noEmptyString,this.listenTo(this.model,"change:"+this.name,()=>{this.selected=Espo.Utils.clone(this.model.get(this.name))||[]}),this.selected=Espo.Utils.clone(this.model.get(this.name)||[]),"[object Array]"!==Object.prototype.toString.call(this.selected)&&(this.selected=[]);let e=this.params.optionsPath,t=this.params.optionsReference;var i,s;!e&&t&&([i,s]=t.split("."),e=`entityDefs.${i}.fields.${s}.options`),e&&(this.params.options=Espo.Utils.clone(this.getMetadata().get(e))||[]),this.styleMap=this.params.style||{},this.setupOptions(),"translatedOptions"in this.options&&(this.translatedOptions=this.options.translatedOptions),"translatedOptions"in this.params&&(this.translatedOptions=this.params.translatedOptions),this.translatedOptions||this.setupTranslation(),this.displayAsLabel=this.params.displayAsLabel||this.displayAsLabel,this.displayAsList=this.params.displayAsList||this.displayAsList,this.params.isSorted&&this.translatedOptions&&(this.params.options=Espo.Utils.clone(this.params.options),this.params.options=this.params.options.sort((e,t)=>(this.translatedOptions[e]||e).localeCompare(this.translatedOptions[t]||t))),this.options.customOptionList&&this.setOptionList(this.options.customOptionList,!0),!this.params.allowCustomOptions&&this.params.options||(this.allowCustomOptions=!0)}focusOnElement(){let e=this.$el.find('button[data-action="showAddModal"]');if(e[0])e[0].focus({preventScroll:!0});else{let e=this.$el.find("input");e[0]&&e[0].focus({preventScroll:!0})}}setupSearch(){this.events["change select.search-type"]=e=>{this.handleSearchType($(e.currentTarget).val())}}handleSearchType(e){let t=this.$el.find("div.input-container");~["anyOf","noneOf","allOf"].indexOf(e)?t.removeClass("hidden"):t.addClass("hidden")}setupTranslation(){let i,e=this.params.translation,t=this.params.optionsReference;var s,a;if(!e&&t&&([s,a]=t.split("."),e=s+".options."+a),this.translatedOptions=null,this.params.options){i=e?this.getLanguage().translatePath(e):this.translate(this.name,"options",this.model.name);let t={};this.params.options.forEach(e=>{"object"==typeof i&&e in i?t[e]=i[e]:t[e]=e}),this.translatedOptions=t}}setupOptions(){}setOptionList(i,e){var t=this.params.options,t=(this.originalOptionList||(this.originalOptionList=this.params.options),this.params.options=Espo.Utils.clone(i),!_(t).isEqual(i));if(this.isEditMode()&&!e&&t){let t=[];this.selected.forEach(e=>{~i.indexOf(e)&&t.push(e)}),this.selected=t,this.isRendered()?(this.reRender(),this.trigger("change")):this.once("after:render",()=>{this.trigger("change")})}}setTranslatedOptions(e){this.translatedOptions=e}resetOptionList(){var e;this.originalOptionList&&(e=this.params.options,this.params.options=Espo.Utils.clone(this.originalOptionList),e=!_(e).isEqual(this.originalOptionList),this.isEditMode()&&e&&this.isRendered()&&this.reRender())}controlAddItemButton(){let e=this.$select;e&&e.get(0)&&(!e.val().toString().trim()&&this.params.noEmptyString?this.$addButton.addClass("disabled").attr("disabled","disabled"):this.$addButton.removeClass("disabled").removeAttr("disabled"))}afterRender(){if(this.isEditMode()){this.$list=this.$el.find(".list-group");let t=this.$select=this.$el.find(".select");this.allowCustomOptions&&(this.$addButton=this.$el.find('button[data-action="addItem"]'),this.$addButton.on("click",()=>{var e=t.val().toString();this.addValueFromUi(e),this.focusOnElement()}),t.on("input",()=>this.controlAddItemButton()),t.on("keydown",e=>{"Enter"===Espo.Utils.getKeyFromKeyEvent(e)&&(e=t.val().toString(),this.addValueFromUi(e))}),this.controlAddItemButton()),this.$list.sortable({stop:()=>{this.fetchFromDom(),this.trigger("change")},distance:5,cancel:'input,textarea,button,select,option,a[role="button"]',cursor:"grabbing"})}this.isSearchMode()&&this.renderSearch()}addValueFromUi(i){if(i=i.trim(),!this.noEmptyString||""!==i){if(this.params.pattern){let e=new s.default(this.getMetadata(),this.getLanguage()),t=e.validate(this.params.pattern,i,this.name,this.entityType);if(t)return void setTimeout(()=>this.showValidationMessage(t.message,"input.select"),10)}this.addValue(i),this.$select.val(""),this.controlAddItemButton()}}renderSearch(){this.$element=this.$el.find(".main-element");let e=this.getSearchParamsData().valueList||this.searchParams.valueFront||[],i=(this.$element.val(e.join(this.itemDelimiter)),[]);(this.params.options||[]).forEach(e=>{let t=this.getLanguage().translateOption(e,this.name,this.scope);""!==(t=this.translatedOptions&&e in this.translatedOptions?this.translatedOptions[e]:t)&&i.push({value:e,text:t})}),e.filter(e=>!(this.params.options||[]).includes(e)).forEach(e=>{i.push({value:e,text:e})});var t={items:i,delimiter:this.itemDelimiter,matchAnyWord:this.matchAnyWord,allowCustomOptions:this.allowCustomOptions,create:e=>({value:e,text:e})},t=(a.default.init(this.$element,t),this.$el.find(".selectize-dropdown-content").addClass("small"),this.$el.find("select.search-type").val());this.handleSearchType(t),this.$el.find("select.search-type").on("change",()=>{this.trigger("change")}),this.$element.on("change",()=>{this.trigger("change")})}fetchFromDom(){let i=[];this.$el.find(".list-group .list-group-item").each((e,t)=>{t=$(t).attr("data-value").toString();i.push(t)}),this.selected=i}getValueForDisplay(){let e=this.selected.map(e=>{let t=null;""===(t=null===(t=null!==this.translatedOptions&&e in this.translatedOptions?this.translatedOptions[e]:t)?e:t)&&(t=this.translate("None"));e=this.styleMap[e]||"default";return(this.params.displayAsLabel?$("<span>").addClass("label label-md label-"+e):e&&"default"!==e?$("<span>").addClass("text-"+e):$("<span>")).text(t).get(0).outerHTML});if(this.displayAsList){if(!e.length)return"";let t="multi-enum-item-container";return this.displayAsLabel&&(t+=" multi-enum-item-label-container"),e.map(e=>$("<div>").addClass(t).html(e).get(0).outerHTML).join("")}return this.displayAsLabel?e.join(" "):e.join(", ")}getItemHtml(e){if(null!==this.translatedOptions)for(var t in this.translatedOptions)if(this.translatedOptions[t]===e){e=t;break}e=e.toString();var i=this.translatedOptions&&e in this.translatedOptions?this.translatedOptions[e].toString():e;return $("<div>").addClass("list-group-item").attr("data-value",e).css("cursor","default").append($("<a>").attr("role","button").attr("tabindex","0").addClass("pull-right").attr("data-value",e).attr("data-action","removeValue").append($("<span>").addClass("fas fa-times"))).append($("<span>").addClass("text").text(i)).append("").get(0).outerHTML}addValue(e){var t;-1===this.selected.indexOf(e)&&(t=this.getItemHtml(e),this.$list.append(t),this.selected.push(e),this.trigger("change"))}removeValue(e){var t=e.replace(/"/g,'\\"'),t=(this.$list.children('[data-value="'+t+'"]').remove(),this.selected.indexOf(e));this.selected.splice(t,1),this.trigger("change")}fetch(){let e={},t=Espo.Utils.clone(this.selected||[]);return this.params.isSorted&&this.translatedOptions&&(t=t.sort((e,t)=>(this.translatedOptions[e]||e).localeCompare(this.translatedOptions[t]||t))),e[this.name]=t,e}fetchSearch(){var e=this.$el.find("select.search-type").val()||"anyOf";let t;if(~["anyOf","noneOf","allOf"].indexOf(e)&&0===(t=1===(t=this.$element.val().split(this.itemDelimiter)).length&&""===t[0]?[]:t).length){if("anyOf"===e)return{type:"any",data:{type:e,valueList:t}};if("noneOf"===e)return{type:"any",data:{type:e,valueList:t}};if("allOf"===e)return{type:"any",data:{type:e,valueList:t}}}if("anyOf"===e){let e={type:"arrayAnyOf",value:t,data:{type:"anyOf",valueList:t}};return t.length||(e.value=null),e}if("noneOf"===e)return{type:"arrayNoneOf",value:t,data:{type:"noneOf",valueList:t}};if("allOf"!==e)return"isEmpty"===e?{type:"arrayIsEmpty",data:{type:"isEmpty"}}:"isNotEmpty"===e?{type:"arrayIsNotEmpty",data:{type:"isNotEmpty"}}:null;{let e={type:"arrayAllOf",value:t,data:{type:"allOf",valueList:t}};return t.length||(e.value=null),e}}validateRequired(){if(this.isRequired()){var e=this.model.get(this.name);if(!e||0===e.length)return e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e,".array-control-container"),!0}return!1}validateMaxCount(){var e;if(this.params.maxCount&&(this.model.get(this.name)||[]).length>this.params.maxCount)return e=this.translate("fieldExceedsMaxCount","messages").replace("{field}",this.getLabelText()).replace("{maxCount}",this.params.maxCount.toString()),this.showValidationMessage(e,".array-control-container"),!0;return!1}getSearchType(){return this.getSearchParamsData().type||"anyOf"}getAddItemModalOptions(){let t=[];return this.params.options.forEach(e=>{~this.selected.indexOf(e)||t.push(e)}),{options:t,translatedOptions:this.translatedOptions}}actionAddItem(){this.createView("addModal",this.addItemModalView,this.getAddItemModalOptions(),t=>{t.render(),t.once("add",e=>{this.addValue(e),t.close()}),t.once("add-mass",e=>{e.forEach(e=>this.addValue(e)),t.close()})})}}e.default=l}),define("views/dashlets/abstract/base",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{optionsData=null;optionsFields={title:{type:"varchar",required:!0},autorefreshInterval:{type:"enumFloat",options:[0,.5,1,2,5,10]}};disabledForReadOnlyActionList=["options","remove"];disabledForLockedActionList=["remove"];noPadding=!1;buttonList=[];actionList=[{name:"refresh",label:"Refresh",iconHtml:'<span class="fas fa-sync-alt"></span>'},{name:"options",label:"Options",iconHtml:'<span class="fas fa-pencil-alt"></span>'},{name:"remove",label:"Remove",iconHtml:'<span class="fas fa-times"></span>'}];actionRefresh(){this.render()}actionOptions(){}init(){this.name=this.options.name||this.name,this.id=this.options.id,this.defaultOptions=this.getMetadata().get(["dashlets",this.name,"options","defaults"])||this.defaultOptions||{},this.defaultOptions={title:this.getLanguage().translate(this.name,"dashlets"),...this.defaultOptions},this.defaultOptions=Espo.Utils.clone(this.defaultOptions),this.optionsFields=this.getMetadata().get(["dashlets",this.name,"options","fields"])||this.optionsFields||{},this.optionsFields=Espo.Utils.clone(this.optionsFields),this.setupDefaultOptions();let e=Espo.Utils.cloneDeep(this.defaultOptions);for(var t in e)"function"==typeof e[t]&&(e[t]=e[t].call(this));let i;if(i=this.options.readOnly?(this.getConfig().get("forcedDashletsOptions")||this.getConfig().get("dashletsOptions")||{})[this.id]||{}:this.getPreferences().getDashletOptions(this.id)||{},this.optionsData=_.extend(e,i),this.optionsData.autorefreshInterval){let e=6e4*this.optionsData.autorefreshInterval,t,i=()=>{t=setTimeout(()=>{this.actionRefresh(),i()},e)};i(),this.once("remove",()=>{clearTimeout(t)})}this.actionList=Espo.Utils.clone(this.actionList),this.buttonList=Espo.Utils.clone(this.buttonList),this.options.readOnly&&(this.actionList=this.actionList.filter(e=>!~this.disabledForReadOnlyActionList.indexOf(e.name))),this.options.locked&&(this.actionList=this.actionList.filter(e=>!this.disabledForLockedActionList.includes(e.name))),this.setupActionList(),this.setupButtonList()}setupDefaultOptions(){}setupActionList(){}setupButtonList(){}hasOption(e){return e in this.optionsData}getOption(e){return this.optionsData[e]}getTitle(){let e=this.getOption("title");return e=e||null}getContainerView(){return this.getParentView()}handleAction(e,t){Espo.Utils.handleAction(this,e,t,{actionItems:[...this.buttonList,...this.actionList],className:"dashlet-action"})}}e.default=s}),define("models/user",["exports","model"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{name="User";entityType="User";urlRoot="User";isAdmin(){return"admin"===this.get("type")||this.isSuperAdmin()}isPortal(){return"portal"===this.get("type")}isApi(){return"api"===this.get("type")}isRegular(){return"regular"===this.get("type")}isSystem(){return"system"===this.get("type")}isSuperAdmin(){return"super-admin"===this.get("type")}}e.default=s}),define("models/settings",["exports","model"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{name="Settings";entityType="Settings";urlRoot="Settings";load(){return new Promise(e=>{this.fetch().then(()=>e())})}getByPath(t){if(!t.length)return null;let i;for(let e=0;e<t.length;e++){var s=t[e];if(0===e)i=this.get(s);else{if(!(s in i))return null;i=i[s]}if(e===t.length-1)return i;if(null===i||"object"!=typeof i)return null}}}e.default=s}),define("models/preferences",["exports","model"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{name="Preferences";entityType="Preferences";urlRoot="Preferences";getDashletOptions(e){return(this.get("dashletsOptions")||{})[e]||null}isPortal(){return this.get("isPortalUser")}}e.default=s}),define("controllers/base",["exports","controller","views/base"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{login(e){var t=this.getConfig().get("loginView")||"views/login";let r=(e||{}).anotherUser;e=(e||{}).username,e={anotherUser:r,prefilledUsername:e};this.entire(t,e,l=>{l.render(),l.on("login",(e,t)=>{this.trigger("login",this.normalizeLoginData(e,t))}),l.once("redirect",(e,t,i,s,a)=>{l.remove(),this.entire(e,{loginData:a,userName:i,password:s,anotherUser:r,headers:t},e=>{e.render(),e.once("login",(e,t)=>{this.trigger("login",this.normalizeLoginData(e,t))}),e.once("back",()=>{e.remove(),this.login()})})})})}normalizeLoginData(e,t){return{auth:{userName:e,token:t.token,anotherUser:t.anotherUser},user:t.user,preferences:t.preferences,acl:t.acl,settings:t.settings,appParams:t.appParams,language:t.language}}logout(){var e=this.getConfig().get("applicationName")||"EspoCRM";$("head title").text(e),this.trigger("logout")}clearCache(){this.entire("views/clear-cache",{cache:this.getCache()},e=>{e.render()})}actionLogin(){this.login()}actionLogout(){this.logout()}actionLogoutWait(){this.entire("views/base",{template:"logout-wait"},e=>{e.render().then(()=>Espo.Ui.notify(" ... "))})}actionClearCache(){this.clearCache()}error404(){var e=new i.default({template:"errors/404"});this.entire(e)}error403(){var e=new i.default({template:"errors/403"});this.entire(e)}}e.default=a}),define("helpers/file-upload",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e){this.config=e}upload(s,a,e){return(e=e||{}).afterChunkUpload=e.afterChunkUpload||(()=>{}),e.afterAttachmentSave=e.afterAttachmentSave||(()=>{}),e.mediator=e.mediator||{},a.set("name",s.name),a.set("type",s.type||"text/plain"),a.set("size",s.size),this._useChunks(s)?this._uploadByChunks(s,a,e):new Promise((t,i)=>{let e=new FileReader;e.onload=e=>{a.set("file",e.target.result),a.save({},{timeout:0}).then(()=>t()).catch(()=>i())},e.readAsDataURL(s)})}_uploadByChunks(i,s,a){return new Promise((e,t)=>{s.set("isBeingUploaded",!0),s.save().then(()=>(a.afterAttachmentSave(s),this._uploadChunks(i,s,e,t,a))).catch(()=>t())})}_uploadChunks(t,i,s,a,l,r){let o=(r=r||0)+this._getChunkSize()+1;if(o>t.size&&(o=t.size),l.mediator.isCanceled)a();else{r=t.slice(r,o);let e=new FileReader;e.onloadend=e=>{e.target.readyState===FileReader.DONE&&Espo.Ajax.postRequest("Attachment/chunk/"+i.id,e.target.result,{headers:{contentType:"multipart/form-data"}}).then(()=>{l.afterChunkUpload(o),o!==t.size?this._uploadChunks(t,i,s,a,l,o):s()}).catch(()=>a())},e.readAsDataURL(r)}}_useChunks(e){var t=this._getChunkSize();return!!t&&e.size>t}_getChunkSize(){return 1024*(this.config.get("attachmentUploadChunkSize")||0)*1024}}}),define("collection",["exports","model","bullbone","underscore"],function(e,a,t,p){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a=i(a),p=i(p);class s{entityType=null;total=0;offset=0;maxSize=20;order=null;orderBy=null;where=null;whereAdditional=null;lengthCorrection=0;maxMaxSize=0;whereFunction;lastSyncPromise=null;constructor(e,t){(t={...t}).model&&(this.model=t.model),this._reset(),t.entityType&&(this.entityType=t.entityType,this.name=this.entityType),this.urlRoot=t.urlRoot||this.urlRoot||this.entityType,this.url=t.url||this.url||this.urlRoot,this.orderBy=t.orderBy||this.orderBy,this.order=t.order||this.order,this.defaultOrder=this.order,this.defaultOrderBy=this.orderBy,this.defs=t.defs||{},this.data={},this.model=t.model||a.default,e&&this.reset(e,{silent:!0,...t})}add(e,t){return this.set(e,{merge:!1,...t,...l}),this}remove(e,t){t={...t};e=!p.default.isArray(e)?[e]:e.slice();e=this._removeModels(e,t);return!t.silent&&e.length&&(t.changes={added:[],merged:[],removed:e},this.trigger("update",this,t)),this}set(e,i){if(null==e)return[];(i={...f,...i}).prepare&&!this._isModel(e)&&(e=this.prepareAttributes(e,i)||[]),e=!p.default.isArray(e)?[e]:e.slice();let t=i.at,s=((t=(t=null!=t?+t:t)>this.length?this.length:t)<0&&(t+=this.length+1),[]),a=[],l=[],r=[],o={};var h=i.add,c=i.merge,u=i.remove;let n,d;for(d=0;d<e.length;d++){n=e[d];let t=this._get(n);if(t){if(c&&n!==t){let e=this._isModel(n)?n.attributes:n;i.prepare&&(e=t.prepareAttributes(e,i)),t.set(e,i),l.push(t)}o[t.cid]||(o[t.cid]=!0,s.push(t)),e[d]=t}else h&&(n=e[d]=this._prepareModel(n))&&(a.push(n),this._addReference(n,i),o[n.cid]=!0,s.push(n))}if(u){for(d=0;d<this.length;d++)n=this.models[d],o[n.cid]||r.push(n);r.length&&this._removeModels(r,i)}let m=!1;if(s.length&&(h&&u)?(m=this.length!==s.length||p.default.some(this.models,(e,t)=>e!==s[t]),this.models.length=0,g(this.models,s,0),this.length=this.models.length):a.length&&(g(this.models,a,null==t?this.length:t),this.length=this.models.length),!i.silent){for(d=0;d<a.length;d++)null!=t&&(i.index=t+d),(n=a[d]).trigger("add",n,this,i);m&&this.trigger("sort",this,i),(a.length||r.length||l.length)&&(i.changes={added:a,removed:r,merged:l},this.trigger("update",this,i))}return e}reset(e,t){this.lengthCorrection=0,t=t?p.default.clone(t):{};for(let e=0;e<this.models.length;e++)this._removeReference(this.models[e],t);return t.previousModels=this.models,this._reset(),e&&this.add(e,{silent:!0,...t}),t.silent||this.trigger("reset",this,t),this}push(e,t){return this.add(e,{at:this.length,...t}),this}pop(e){var t=this.at(this.length-1);return t?(this.remove(t,e),t):null}unshift(e,t){return this.add(e,{at:0,...t}),this}shift(e){var t=this.at(0);return t?(this.remove(t,e),t):null}get(e){return this._get(e)}has(e){return this._has(e)}at(e){return e<0&&(e+=this.length),this.models[e]}forEach(e,t){return this.models.forEach(e,t)}indexOf(e){return this.models.indexOf(e)}_has(e){return!!this._get(e)}_get(e){if(null!=e)return this._byId[e]||this._byId[this.modelId(e.attributes||e)]||e.cid&&this._byId[e.cid]}modelId(e){return e.id}_reset(){this.length=0,this.models=[],this._byId={}}sort(e,t){return this.orderBy=e,!0===t?t="desc":!1===t&&(t="asc"),this.order=t||"asc",this.fetch()}nextPage(){this.setOffset(this.offset+this.maxSize)}previousPage(){this.setOffset(this.offset-this.maxSize)}firstPage(){this.setOffset(0)}lastPage(){let e=this.total-this.total%this.maxSize;e===this.total&&(e=this.total-this.maxSize),this.setOffset(e)}setOffset(e){if(e<0)throw new RangeError("offset can not be less than 0");if(e>this.total&&-1!==this.total&&0<e)throw new RangeError("offset can not be larger than total count");this.offset=e,this.fetch()}hasMore(){return this.total>this.length||-1===this.total}prepareAttributes(e,t){return this.total=e.total,this.dataAdditional=e.additionalData||null,e.list}parse(e,t){return this.prepareAttributes(e,t)}fetch(t){(t={...t}).data={...t.data,...this.data},this.offset=t.offset||this.offset,this.orderBy=t.orderBy||this.orderBy,this.order=t.order||this.order,this.where=t.where||this.where;var e=this.length+this.lengthCorrection;"maxSize"in t?t.data.maxSize=t.maxSize:(t.data.maxSize=!t.more&&e>this.maxSize?e:this.maxSize,this.maxMaxSize&&t.data.maxSize>this.maxMaxSize&&(t.data.maxSize=this.maxMaxSize)),t.data.offset=t.more?e:this.offset,t.data.orderBy=this.orderBy,t.data.order=this.order,t.data.where=this.getWhere();let i=(t={prepare:!0,...t}).success,s=(t.success=e=>{t.reset?this.reset(e,t):this.set(e,t),i&&i.call(t.context,this,e,t),this.trigger("sync",this,e,t)},t.error);return t.error=e=>{s&&s.call(t.context,this,e,t),this.trigger("error",this,e,t)},this.lastSyncPromise=a.default.prototype.sync.call(this,"read",this,t),this.lastSyncPromise}abortLastFetch(){this.lastSyncPromise&&this.lastSyncPromise.getReadyState()<4&&this.lastSyncPromise.abort()}getWhere(){let e=(this.where||[]).concat(this.whereAdditional||[]);return e=this.whereFunction?e.concat(this.whereFunction()||[]):e}getEntityType(){return this.entityType||this.name}resetOrderToDefault(){this.orderBy=this.defaultOrderBy,this.order=this.defaultOrder}setOrder(e,t,i){this.orderBy=e,this.order=t,i&&(this.defaultOrderBy=e,this.defaultOrder=t)}clone(){const e=new this.constructor(this.models,{model:this.model,entityType:this.entityType,defs:this.defs,orderBy:this.orderBy,order:this.order});return e.name=this.name,e.urlRoot=this.urlRoot,e.url=this.url,e.defaultOrder=this.defaultOrder,e.defaultOrderBy=this.defaultOrderBy,e.data=Espo.Utils.cloneDeep(this.data),e.where=Espo.Utils.cloneDeep(this.where),e.whereAdditional=Espo.Utils.cloneDeep(this.whereAdditional),e.total=this.total,e.offset=this.offset,e.maxSize=this.maxSize,e.maxMaxSize=this.maxMaxSize,e.whereFunction=this.whereFunction,e}prepareModel(){return this._prepareModel({})}composeSyncUrl(){return this.url}_isModel(e){return e instanceof a.default}_removeModels(i,s){let a=[];for(let t=0;t<i.length;t++){let e=this.get(i[t]);var l,r;e&&(l=this.models.indexOf(e),this.models.splice(l,1),this.length--,delete this._byId[e.cid],null!=(r=this.modelId(e.attributes))&&delete this._byId[r],s.silent||(s.index=l,e.trigger("remove",e,this,s)),a.push(e),this._removeReference(e,s))}return a}_addReference(e){this._byId[e.cid]=e;var t=this.modelId(e.attributes);null!=t&&(this._byId[t]=e),e.on("all",this._onModelEvent,this)}_removeReference(e){delete this._byId[e.cid];var t=this.modelId(e.attributes);null!=t&&delete this._byId[t],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)}_onModelEvent(e,t,i,s){"sync"===e&&i!==this||(t?("add"!==e&&"remove"!==e||i===this)&&("destroy"===e&&this.remove(t,s),"change"!==e||(i=this.modelId(t.previousAttributes()))!==(s=this.modelId(t.attributes))&&(null!=i&&delete this._byId[i],null!=s&&(this._byId[s]=t)),this.trigger.apply(this,arguments)):this.trigger.apply(this,arguments))}_prepareModel(e){if(this._isModel(e))return e.collection||(e.collection=this),e;const t=this.model;return new t(e,{collection:this,entityType:this.entityType||this.name,defs:this.defs})}}Object.assign(s.prototype,t.Events),s.extend=t.View.extend;const f={add:!0,remove:!0,merge:!0},l={add:!0,remove:!1},g=(e,t,i)=>{i=Math.min(Math.max(i,0),e.length);let s=Array(e.length-i);var a=t.length;let l;for(l=0;l<s.length;l++)s[l]=e[l+i];for(l=0;l<a;l++)e[l+i]=t[l];for(l=0;l<s.length;l++)e[l+a+i]=s[l]};e.default=s}),define("app",["exports","jquery","backbone","bullbone","js-base64","ui","utils","acl-manager","cache","storage","models/settings","language","metadata","field-manager","models/user","models/preferences","model-factory","collection-factory","controllers/base","router","date-time","layout-manager","theme-manager","session-storage","view-helper","web-socket-manager","ajax","number-util","page-title","broadcast-channel"],function(e,t,i,l,o,n,r,s,h,c,u,m,p,f,g,v,y,b,w,L,C,M,T,x,D,S,a,E,k,P){"use strict";function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=d(t),i=d(i),o=d(o),n=d(n),r=d(r),s=d(s),h=d(h),c=d(c),u=d(u),m=d(m),p=d(p),f=d(f),g=d(g),v=d(v),y=d(y),b=d(b),w=d(w),L=d(L),C=d(C),M=d(M),T=d(T),x=d(x),D=d(D),S=d(S),a=d(a),E=d(E),k=d(k),P=d(P);class F{constructor(e,t){e=e||{},this.id=e.id||"espocrm-application-id",this.useCache=e.useCache||this.useCache,this.apiUrl=e.apiUrl||this.apiUrl,this.basePath=e.basePath||"",this.ajaxTimeout=e.ajaxTimeout||0,this.internalModuleList=e.internalModuleList||[],this.bundledModuleList=e.bundledModuleList||[],this.appTimestamp=e.appTimestamp,this.initCache(e).then(()=>this.init(e,t)),this.initDomEventListeners()}useCache=!1;user=null;preferences=null;settings=null;metadata=null;language=null;fieldManager=null;cache=null;storage=null;loader=null;apiUrl="api/v1";auth=null;anotherUser=null;baseController=null;controllers=null;router=null;modelFactory=null;collectionFactory=null;viewFactory=null;viewLoader=null;viewHelper=null;masterView="views/site/master";responseCache=null;broadcastChannel=null;dateTime=null;numberUtil=null;webSocketManager=null;appTimestamp=null;started=!1;aclName="acl";initCache(e){if(!this.useCache)return Promise.resolve();let i=e.cacheTimestamp||null,s=(this.cache=new h.default(i),this.cache.getCacheTimestamp());return i?this.cache.handleActuality(i):this.cache.storeTimestamp(),window.caches?new Promise(t=>{(!i||!s||i!==s?caches.delete("espo"):Promise.resolve()).then(()=>caches.open("espo")).then(e=>{this.responseCache=e,t()}).catch(()=>{console.error("Could not open 'espo' cache."),t()})}):Promise.resolve()}init(e,t){this.appParams={},this.controllers={},this.loader=Espo.loader,this.loader.setResponseCache(this.responseCache),this.useCache&&!this.loader.getCacheTimestamp()&&e.cacheTimestamp&&this.loader.setCacheTimestamp(e.cacheTimestamp),this.storage=new c.default,this.sessionStorage=new x.default,this.setupAjax(),this.settings=new u.default(null),this.language=new m.default(this.cache),this.metadata=new p.default(this.cache),this.fieldManager=new f.default,this.initBroadcastChannel(),Promise.all([this.settings.load(),this.language.loadDefault(),this.initTemplateBundles()]).then(()=>{this.loader.setIsDeveloperMode(this.settings.get("isDeveloperMode")),this.user=new g.default,this.preferences=new v.default,this.preferences.settings=this.settings,this.acl=this.createAclManager(),this.fieldManager.acl=this.acl,this.themeManager=new T.default(this.settings,this.preferences,this.metadata),this.modelFactory=new y.default(this.metadata),this.collectionFactory=new b.default(this.modelFactory,this.settings,this.metadata),this.settings.get("useWebSocket")&&(this.webSocketManager=new S.default(this.settings)),this.initUtils(),this.initView(),this.initBaseController(),t.call(this,this)})}start(){this.initAuth(),this.started=!0,this.auth?this.initUserData(null,()=>this.onAuth.call(this)):this.baseController.login()}onAuth(e){this.metadata.load().then(()=>{this.fieldManager.defs=this.metadata.get("fields"),this.fieldManager.metadata=this.metadata,this.settings.defs=this.metadata.get("entityDefs.Settings")||{},this.user.defs=this.metadata.get("entityDefs.User"),this.preferences.defs=this.metadata.get("entityDefs.Preferences"),this.viewHelper.layoutManager.userId=this.user.id,this.themeManager.isUserTheme()&&this.loadStylesheet(),this.anotherUser&&(this.viewHelper.webSocketManager=null,this.webSocketManager=null),this.webSocketManager&&this.webSocketManager.connect(this.auth,this.user.id);let t=[],s={},a=this.metadata.get("clientDefs")||{};Object.keys(a).forEach(i=>{let e=(a[i]||{})[this.aclName];e&&t.push(new Promise(t=>{this.loader.require(e,e=>{s[i]=e,t()})}))}),!this.themeManager.isApplied()&&this.themeManager.isUserTheme()&&t.push(new Promise(t=>{const i=e=>{this.themeManager.isApplied()||50===e?t():(e=e||0,setTimeout(()=>i(e+1),10))};i()})),Promise.all(t).then(()=>{this.acl.implementationClassMap=s,this.initRouter()}),e&&this.broadcastChannel.postMessage("logged-in")})}initRouter(){var e=this.metadata.get(["app","clientRoutes"])||{};this.router=new L.default({routes:e}),this.viewHelper.router=this.router,this.baseController.setRouter(this.router),this.router.confirmLeaveOutMessage=this.language.translate("confirmLeaveOutMessage","messages"),this.router.confirmLeaveOutConfirmText=this.language.translate("Yes"),this.router.confirmLeaveOutCancelText=this.language.translate("Cancel"),this.router.on("routed",e=>this.doAction(e));try{i.default.history.start({root:window.location.pathname})}catch(e){i.default.history.loadUrl()}}doAction(t){this.trigger("action",t),this.baseController.trigger("action");var e=e=>{try{e.doAction(t.action,t.options),this.trigger("action:done")}catch(e){switch(console.error(e),e.name){case"AccessDenied":this.baseController.error403();break;case"NotFound":this.baseController.error404();break;default:throw e}}};t.controllerClassName?this.createController(t.controllerClassName,null,e):this.getController(t.controller,e)}initBaseController(){this.baseController=new w.default({},this.getControllerInjection()),this.viewHelper.baseController=this.baseController}getControllerInjection(){return{viewFactory:this.viewFactory,modelFactory:this.modelFactory,collectionFactory:this.collectionFactory,settings:this.settings,user:this.user,preferences:this.preferences,acl:this.acl,cache:this.cache,router:this.router,storage:this.storage,metadata:this.metadata,dateTime:this.dateTime,broadcastChannel:this.broadcastChannel,baseController:this.baseController}}getController(t,i){if(t)if(t in this.controllers)i(this.controllers[t]);else try{let e=this.metadata.get(["clientDefs",t,"controller"]);var s;e||(s=this.metadata.get(["scopes",t,"module"]),e=r.default.composeClassName(s,t,"controllers")),this.createController(e,t,i)}catch(e){this.baseController.error404()}else i(this.baseController)}createController(e,s,a){Espo.loader.require(e,e=>{var t=this.getControllerInjection();let i=new e(this.baseController.params,t);i.name=s,i.masterView=this.masterView,this.controllers[s]=i,a(i)},()=>this.baseController.error404())}initUtils(){this.dateTime=new C.default,this.modelFactory.dateTime=this.dateTime,this.dateTime.setSettingsAndPreferences(this.settings,this.preferences),this.numberUtil=new E.default(this.settings,this.preferences)}createAclManager(){return new s.default(this.user,null,this.settings.get("aclAllowDeleteCreated"))}initView(){let e=this.viewHelper=new D.default,t=(e.layoutManager=new M.default(this.cache,this.id),e.settings=this.settings,e.config=this.settings,e.user=this.user,e.preferences=this.preferences,e.acl=this.acl,e.modelFactory=this.modelFactory,e.collectionFactory=this.collectionFactory,e.storage=this.storage,e.sessionStorage=this.sessionStorage,e.dateTime=this.dateTime,e.language=this.language,e.metadata=this.metadata,e.fieldManager=this.fieldManager,e.cache=this.cache,e.themeManager=this.themeManager,e.webSocketManager=this.webSocketManager,e.numberUtil=this.numberUtil,e.pageTitle=new k.default(this.settings),e.basePath=this.basePath,e.appParams=this.appParams,e.broadcastChannel=this.broadcastChannel,this.viewLoader=(e,t)=>{this.loader.require(r.default.composeViewClassName(e),t)},{});const s=e=>(e in t||(t[e]=-1!==this.internalModuleList.indexOf(e)),t[e]),a=(e,t)=>{let i=null;switch(e){case"template":~t.indexOf(".")&&console.warn(t+": template name should use slashes for a directory separator."),i="res/templates/"+t.split(".").join("/")+".tpl";break;case"layoutTemplate":i="res/layout-types/"+t+".tpl"}return i},i=(e,t)=>{if(!t.includes(":"))return"client/"+a(e,t);var[t,i]=t.split(":");return"custom"===t?"client/custom/"+a(e,i):s(t)?"client/modules/"+t+"/"+a(e,i):"client/custom/modules/"+t+"/"+a(e,i)};this.viewFactory=new l.Factory({defaultViewName:"views/base",helper:e,viewLoader:this.viewLoader,resources:{loaders:{template:(e,t)=>{e=i("template",e);this.loader.require("res!"+e,t)},layoutTemplate:(e,t)=>{Espo.layoutTemplates&&e in Espo.layoutTemplates?t(Espo.layoutTemplates[e]):(e=i("layoutTemplate",e),this.loader.require("res!"+e,t))}}},preCompiledTemplates:Espo.preCompiledTemplates||{}})}initAuth(){this.auth=this.storage.get("user","auth")||null,this.anotherUser=this.storage.get("user","anotherUser")||null,this.baseController.on("login",e=>{var t=e.user.id,i=e.auth.userName,s=e.auth.token,a=e.auth.anotherUser||null,a=(this.auth=o.default.encode(i+":"+s),this.anotherUser=a,this.storage.get("user","lastUserId"));a!==t&&(this.metadata.clearCache(),this.language.clearCache()),this.storage.set("user","auth",this.auth),this.storage.set("user","lastUserId",t),this.storage.set("user","anotherUser",this.anotherUser),this.setCookieAuth(i,s),this.initUserData(e,()=>this.onAuth(!0))}),this.baseController.on("logout",()=>this.logout())}logout(e,t){let i=!1;!this.auth||e||1<(s=o.default.decode(this.auth).split(":")).length&&(i=this.appParams.logoutWait||!1,a.default.postRequest("App/destroyAuthToken",{token:s[1]},{resolveWithXhr:!0}).then(e=>{let t=e.getResponseHeader("X-Logout-Redirect-Url");t?setTimeout(()=>window.location.href=t,50):i&&this.doAction({action:"login"})})),this.webSocketManager&&this.webSocketManager.close(),t=t||e&&this.auth&&this.auth!==this.storage.get("user","auth"),this.auth=null,this.anotherUser=null,this.user.clear(),this.preferences.clear(),this.acl.clear(),t||(this.storage.clear("user","auth"),this.storage.clear("user","anotherUser"));var s=i?"logoutWait":"login";this.doAction({action:s}),t||this.unsetCookieAuth(),this.broadcastChannel.object&&(t||this.broadcastChannel.postMessage("logged-out")),t||this.sendLogoutRequest(),this.loadStylesheet()}sendLogoutRequest(){let e=new XMLHttpRequest;e.open("GET",this.basePath+this.apiUrl+"/"),e.setRequestHeader("Authorization","Basic "+o.default.encode("**logout:logout")),e.send(""),e.abort()}loadStylesheet(){var e;this.metadata.get(["themes"])&&(e=this.basePath+this.themeManager.getStylesheet(),(0,t.default)("#main-stylesheet").attr("href",e))}setCookieAuth(e,t){let i=new Date;i.setTime(i.getTime()+864e8),document.cookie="auth-token="+t+"; SameSite=Lax; expires="+i.toUTCString()+"; path=/"}unsetCookieAuth(){document.cookie="auth-token=; SameSite=Lax; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/"}initUserData(l,r){l=l||{},null!==this.auth&&new Promise(t=>{l.user?t(l):this.requestUserData(e=>{t(l=e)})}).then(e=>(this.language.name=e.language,this.language.load())).then(()=>{this.dateTime.setLanguage(this.language);var e,t=l.user||null,i=l.preferences||null,s=l.acl||null,a=l.settings||{};for(e in this.user.set(t),this.preferences.set(i),this.settings.set(a),this.acl.set(s),l.appParams)this.appParams[e]=l.appParams[e];if(this.auth){let t=new XMLHttpRequest;t.open("GET",this.basePath+this.apiUrl+"/"),t.setRequestHeader("Authorization","Basic "+this.auth),t.onreadystatechange=()=>{var e;t.readyState===XMLHttpRequest.DONE&&200===t.status&&(e=o.default.decode(this.auth).split(":"),this.setCookieAuth(e[0],e[1]),r()),t.readyState===XMLHttpRequest.DONE&&401===t.status&&n.default.error("Auth error")},t.send("")}})}requestUserData(e){a.default.getRequest("App/user",{},{appStart:!0}).then(e)}setupAjax(){let i=!1;a.default.configure({apiUrl:this.basePath+this.apiUrl,timeout:this.ajaxTimeout,beforeSend:e=>{null!==this.auth&&(e.setRequestHeader("Authorization","Basic "+this.auth),e.setRequestHeader("Espo-Authorization",this.auth),e.setRequestHeader("Espo-Authorization-By-Token","true")),null!==this.anotherUser&&e.setRequestHeader("X-Another-User",this.anotherUser)},onSuccess:(e,t)=>{var e=e.getResponseHeader("X-App-Timestamp");e&&!i&&(e=parseInt(e),t=t.bypassAppReload,this.appTimestamp&&e>this.appTimestamp&&!t&&(i=!0,n.default.confirm(this.language.translate("confirmAppRefresh","messages"),{confirmText:this.language.translate("Refresh"),cancelText:this.language.translate("Cancel"),backdrop:"static",confirmStyle:"success"}).then(()=>{window.location.reload(),this.broadcastChannel&&this.broadcastChannel.postMessage("reload")})))},onError:(i,s)=>{setTimeout(()=>{if(!i.errorIsHandled){switch(i.status){case 200:n.default.error(this.language.translate("Bad server response")),console.error("Bad server response: "+i.responseText);break;case 401:if(s.login)break;if(this.auth&&this.router&&!this.router.confirmLeaveOut){this.logout(!0);break}if(this.auth&&this.router&&this.router.confirmLeaveOut){n.default.error(this.language.translate("loggedOutLeaveOut","messages"),!0),this.router.trigger("logout");break}var e;this.auth&&(e=!s.appStart,this.logout(!0,e)),console.error("Error 401: Unauthorized.");break;case 403:if(s.main){this.baseController.error403();break}this._processErrorAlert(i,"Access denied");break;case 400:this._processErrorAlert(i,"Bad request");break;case 404:if(s.main){this.baseController.error404();break}this._processErrorAlert(i,"Not found",!0);break;default:this._processErrorAlert(i,null)}var t=i.getResponseHeader("X-Status-Reason");t&&console.error("Server side error "+i.status+": "+t)}},0)},onTimeout:()=>{n.default.error(this.language.translate("Timeout"),!0)}}),t.default.ajaxSetup({beforeSend:(e,t)=>{t.url&&t.url.includes("q=")||console.warn("$.ajax is deprecated, support will be removed in v9.0. Use Espo.Ajax instead."),!t.local&&this.apiUrl&&(t.url=r.default.trimSlash(this.apiUrl)+"/"+t.url),t.local||""===this.basePath||(t.url=this.basePath+t.url),null!==this.auth&&(e.setRequestHeader("Authorization","Basic "+this.auth),e.setRequestHeader("Espo-Authorization",this.auth),e.setRequestHeader("Espo-Authorization-By-Token","true")),null!==this.anotherUser&&e.setRequestHeader("X-Another-User",this.anotherUser)},dataType:"json",timeout:this.ajaxTimeout,contentType:"application/json"})}_processErrorAlert(e,t,i){let s=this.language.translate("Error")+" "+e.status,a=(t&&(s+=": "+this.language.translate(t)),{msg:s,closeButton:!1}),l=i?!0:!1;if(!l&&e.responseText&&"{"===e.responseText[0]){let t=null;try{t=JSON.parse(e.responseText)}catch(e){}if(t&&t.messageTranslation&&t.messageTranslation.label){let e=this.language.translate(t.messageTranslation.label,"messages",t.messageTranslation.scope);var r,o=t.messageTranslation.data||{};for(r in o)e=e.replace("{"+r+"}",o[r]);a.msg+="\n"+e,a.closeButton=!0,l=!0}}l||(t=e.getResponseHeader("X-Status-Reason"))&&(a.msg+="\n"+t,a.closeButton=!0),n.default.error(a.msg,a.closeButton)}initBroadcastChannel(){this.broadcastChannel=new P.default,this.broadcastChannel.subscribe(e=>{if(this.auth||!this.started){if("update:all"===e.data)return this.metadata.loadSkipCache(),this.settings.load(),this.language.loadSkipCache(),void this.viewHelper.layoutManager.clearLoadedData();if("update:metadata"!==e.data)if("update:config"!==e.data)if("update:language"!==e.data)if("update:layout"!==e.data)if("reload"!==e.data){if("logged-out"===e.data&&this.started){if(this.auth&&this.router.confirmLeaveOut)return n.default.error(this.language.translate("loggedOutLeaveOut","messages"),!0),void this.router.trigger("logout");this.logout(!0)}}else window.location.reload();else this.viewHelper.layoutManager.clearLoadedData();else this.language.loadSkipCache();else this.settings.load();else this.metadata.loadSkipCache()}else"logged-in"===e.data&&window.location.reload()})}initDomEventListeners(){(0,t.default)(document).on("keydown.espo.button",e=>{"Enter"!==e.code||"A"!==e.target.tagName||"button"!==e.target.getAttribute("role")||e.target.getAttribute("href")||e.ctrlKey||e.altKey||e.metaKey||((0,t.default)(e.target).click(),e.preventDefault())})}initTemplateBundles(){if(!this.responseCache)return Promise.resolve();const e="templateBundlesCached";if(this.cache.get("app",e))return Promise.resolve();let t=["client/lib/templates.tpl"],l=(this.bundledModuleList.forEach(e=>{e=this.internalModuleList.includes(e)?`client/modules/${e}/lib/templates.tpl`:`client/custom/modules/${e}/lib/templates.tpl`;t.push(e)}),window.location.origin+window.location.pathname),r=this.loader.getCacheTimestamp();var i=t.map(e=>{let t=new URL(l+this.basePath+e);return t.searchParams.append("t",this.appTimestamp),new Promise(s=>{fetch(t).then(e=>{if(!e.ok)return console.error(`Could not fetch ${t}.`),void s();let a=[];e.text().then(e=>{var t,i=e.indexOf("\n");i<=0?s():(t=e.slice(0,i+1),(e=e.slice(i+1)).split(t).forEach(e=>{var t=e.indexOf("\n"),i=e.slice(0,t),e=e.slice(t+1),t=l+this.basePath+"client/"+i;let s=new URL(t);s.searchParams.append("r",r),a.push(this.responseCache.put(s,new Response(e)))}))}),Promise.all(a).then(()=>s())})})});return Promise.all(i).then(()=>{this.cache.set("app",e,!0)})}}Object.assign(F.prototype,l.Events),F.extend=l.View.extend,e.default=F}),define("acl-portal-manager",["exports","acl-manager","acl-portal"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{checkInAccount(e){const t=this.getImplementation(e.entityType);return t.checkInAccount(e)}checkIsOwnContact(e){const t=this.getImplementation(e.entityType);return t.checkIsOwnContact(e)}getImplementation(t){if(!(t in this.implementationHash)){let e=i.default;t in this.implementationClassMap&&(e=this.implementationClassMap[t]),this.implementationHash[t]=new e(this.getUser(),t,this.aclAllowDeleteCreated)}return this.implementationHash[t]}}e.default=a}),define("views/list-with-categories",["exports","views/list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="list-with-categories";quickCreate=!0;storeViewAfterCreate=!0;storeViewAfterUpdate=!0;currentCategoryId=null;currentCategoryName="";categoryScope=null;categoryField="category";categoryFilterType="inCategory";isExpanded=!1;hasExpandedToggler=!0;expandedTogglerDisabled=!1;keepCurrentRootUrl=!0;hasNavigationPanel=!1;nestedCollectionIsBeingFetched=!1;nestedCategoriesCollection;data(){let e={};return e.hasTree=(this.isExpanded||this.hasNavigationPanel)&&!this.categoriesDisabled,e.hasNestedCategories=!this.isExpanded,e.fallback=!e.hasTree&&!e.hasNestedCategories,e}setup(){super.setup(),this.categoryScope||(this.categoryScope=this.scope+"Category"),this.showEditLink=this.getAcl().check(this.categoryScope,"edit")||this.getAcl().check(this.categoryScope,"create");!this.getMetadata().get(["clientDefs",this.categoryScope,"isExpandedByDefault"])&&1||(this.isExpanded=!0);var e=this.getMetadata().get(["clientDefs",this.categoryScope,"isCollapsedByDefault"])||!1,e=(e&&(this.isExpanded=!1),this.categoriesDisabled=this.categoriesDisabled||this.getMetadata().get(["scopes",this.categoryScope,"disabled"])||!this.getAcl().checkScope(this.categoryScope),this.categoriesDisabled?(this.isExpanded=!0,this.hasExpandedToggler=!1,this.hasNavigationPanel=!1):this.expandedTogglerDisabled||(this.getUser().isPortal()||this.hasIsExpandedStoredValue()&&(this.isExpanded=this.getIsExpandedStoredValue()),this.getUser().isPortal()&&(this.hasExpandedToggler=!1,this.isExpanded=!1)),this.hasNavigationPanelStoredValue()&&(this.hasNavigationPanel=this.getNavigationPanelStoredValue()),this.options.params||{});"categoryId"in e&&(this.currentCategoryId=e.categoryId),this.applyCategoryToCollection(),this.listenTo(this.collection,"sync",(e,t,i)=>{i&&i.openCategory||this.controlListVisibility()})}prepareCreateReturnDispatchParams(e){this.currentCategoryId&&(e.options.categoryId=this.currentCategoryId,e.options.categoryName=this.currentCategoryName)}setupReuse(e){this.applyRoutingParams(e)}applyRoutingParams(e){this.isExpanded||("categoryId"in e&&e.categoryId!==this.currentCategoryId&&this.openCategory(e.categoryId,e.categoryName),this.selectCurrentCategory())}hasTextFilter(){if(this.collection.where)for(let e=0;e<this.collection.where.length;e++)if("textFilter"===this.collection.where[e].type)return!0;return!(!this.collection.data||!this.collection.data.textFilter)}hasNavigationPanelStoredValue(){return this.getStorage().has("state","categories-navigation-panel-"+this.scope)}getNavigationPanelStoredValue(){var e=this.getStorage().get("state","categories-navigation-panel-"+this.scope);return"true"===e||!0===e}setNavigationPanelStoredValue(e){return this.getStorage().set("state","categories-navigation-panel-"+this.scope,e)}hasIsExpandedStoredValue(){return this.getStorage().has("state","categories-expanded-"+this.scope)}getIsExpandedStoredValue(){var e=this.getStorage().get("state","categories-expanded-"+this.scope);return"true"===e||!0===e}setIsExpandedStoredValue(e){return this.getStorage().set("state","categories-expanded-"+this.scope,e)}afterRender(){this.$nestedCategoriesContainer=this.$el.find(".nested-categories-container"),this.$listContainer=this.$el.find(".list-container"),this.hasView("list")?this.controlListVisibility():(this.isExpanded||this.hideListContainer(),this.loadList()),this.categoriesDisabled||!this.isExpanded&&!this.hasNavigationPanel||this.hasView("categories")||this.loadCategories(),this.isExpanded||this.hasView("nestedCategories")||this.loadNestedCategories(),this.$el.focus()}actionExpand(){this.isExpanded=!0,this.setIsExpandedStoredValue(!0),this.applyCategoryToCollection(),this.clearView("nestedCategories"),this.clearView("categories"),this.getRouter().navigate("#"+this.scope),this.updateLastUrl(),this.nestedCategoriesCollection=null,this.reRender(),this.$listContainer.empty(),this.collection.fetch()}actionCollapse(){this.isExpanded=!1,this.setIsExpandedStoredValue(!1),this.applyCategoryToCollection(),this.applyCategoryToNestedCategoriesCollection(),this.clearView("categories"),this.navigateToCurrentCategory(),this.reRender(),this.$listContainer.empty(),this.collection.fetch()}actionOpenCategory(e){this.openCategory(e.id||null,e.name),this.selectCurrentCategory(),this.navigateToCurrentCategory()}navigateToCurrentCategory(){!this.isExpanded&&this.currentCategoryId?this.getRouter().navigate("#"+this.scope+"/list/categoryId="+this.currentCategoryId):this.getRouter().navigate("#"+this.scope),this.updateLastUrl()}selectCurrentCategory(){let e=this.getCategoriesView();e&&(e.setSelected(this.currentCategoryId),e.reRender())}openCategory(e,t){if(this.getNestedCategoriesView().isLoading=!0,this.getNestedCategoriesView().reRender(),this.getNestedCategoriesView().isLoading=!1,this.nestedCategoriesCollection.reset(),this.collection.reset(),this.$listContainer.empty(),this.currentCategoryId=e,this.currentCategoryName=t||e,this.applyCategoryToNestedCategoriesCollection(),this.applyCategoryToCollection(),this.collection.abortLastFetch(),this.nestedCategoriesCollection)return this.nestedCategoriesCollection.abortLastFetch(),this.hideListContainer(),this.$nestedCategoriesContainer.addClass("hidden"),Espo.Ui.notify(" ... "),void Promise.all([this.nestedCategoriesCollection.fetch().then(()=>this.updateHeader()),this.collection.fetch({openCategory:!0})]).then(()=>{Espo.Ui.notify(!1),this.controlNestedCategoriesVisibility(),this.controlListVisibility()});this.collection.fetch().then(()=>{Espo.Ui.notify(!1)})}controlListVisibility(){this.isExpanded?this.showListContainer():this.nestedCollectionIsBeingFetched||(this.collection.models.length||!this.nestedCategoriesCollection||!this.nestedCategoriesCollection.models.length||this.hasTextFilter()?this.showListContainer():this.hideListContainer())}controlNestedCategoriesVisibility(){this.$nestedCategoriesContainer.removeClass("hidden")}getTreeCollection(t){this.getCollectionFactory().create(this.categoryScope).then(e=>{e.url=e.entityType+"/action/listTree",e.setOrder(null,null),(this.collection.treeCollection=e).fetch().then(()=>t.call(this,e))})}applyCategoryToNestedCategoriesCollection(){this.nestedCategoriesCollection&&(this.nestedCategoriesCollection.parentId=this.currentCategoryId,this.nestedCategoriesCollection.currentCategoryId=this.currentCategoryId,this.nestedCategoriesCollection.currentCategoryName=this.currentCategoryName||this.currentCategoryId,this.nestedCategoriesCollection.where=[])}getNestedCategoriesCollection(t){this.getCollectionFactory().create(this.categoryScope,e=>{(this.nestedCategoriesCollection=e).setOrder(null,null),e.url=e.entityType+"/action/listTree",e.maxDepth=null,e.data.checkIfEmpty=!0,this.getAcl().checkScope(this.scope,"create")||(e.data.onlyNotEmpty=!0),this.applyCategoryToNestedCategoriesCollection(),this.nestedCollectionIsBeingFetched=!0,e.fetch().then(()=>{this.nestedCollectionIsBeingFetched=!1,this.controlNestedCategoriesVisibility(),this.controlListVisibility(),this.updateHeader(),t.call(this,e)})})}getNestedCategoriesView(){return this.getView("nestedCategories")}getCategoriesView(){return this.getView("categories")}loadNestedCategories(){this.getNestedCategoriesCollection(e=>{this.createView("nestedCategories","views/record/list-nested-categories",{collection:e,selector:".nested-categories-container",showEditLink:this.showEditLink,isExpanded:this.isExpanded,hasExpandedToggler:this.hasExpandedToggler,hasNavigationPanel:this.hasNavigationPanel,subjectEntityType:this.collection.entityType},e=>{e.render()})})}loadCategories(){this.getTreeCollection(e=>{this.createView("categories","views/record/list-tree",{collection:e,selector:".categories-container",selectable:!0,showRoot:!0,rootName:this.translate(this.scope,"scopeNamesPlural"),buttonsDisabled:!0,checkboxes:!1,showEditLink:this.showEditLink,isExpanded:this.isExpanded,hasExpandedToggler:this.hasExpandedToggler,menuDisabled:!this.isExpanded&&this.hasNavigationPanel,readOnly:!0},e=>{this.currentCategoryId&&e.setSelected(this.currentCategoryId),e.render(),this.listenTo(e,"select",i=>{if(!this.isExpanded){let e=null,t=null;return i&&i.id&&(e=i.id,t=i.get("name")),this.openCategory(e,t),void this.navigateToCurrentCategory()}this.currentCategoryId=null,this.currentCategoryName="",i&&i.id&&(this.currentCategoryId=i.id,this.currentCategoryName=i.get("name")),this.applyCategoryToCollection(),this.collection.abortLastFetch(),Espo.Ui.notify(" ... "),this.collection.fetch().then(()=>Espo.Ui.notify(!1))})})})}applyCategoryToCollection(){this.collection.whereFunction=()=>{let e;if(this.isExpanded||this.hasTextFilter()?this.currentCategoryId&&(e={attribute:this.categoryField,type:this.categoryFilterType,value:this.currentCategoryId}):e=this.isCategoryMultiple()?this.currentCategoryId?{attribute:this.categoryField,type:"linkedWith",value:[this.currentCategoryId]}:{attribute:this.categoryField,type:"isNotLinked"}:this.currentCategoryId?{attribute:this.categoryField+"Id",type:"equals",value:this.currentCategoryId}:{attribute:this.categoryField+"Id",type:"isNull"},e)return[e]}}isCategoryMultiple(){return"linkMultiple"===this.getMetadata().get(["entityDefs",this.scope,"fields",this.categoryField,"type"])}getCreateAttributes(){let t;if(this.isCategoryMultiple()){if(this.currentCategoryId){let e={};e[this.currentCategoryId]=this.getCurrentCategoryName(),t={};var i=this.categoryField+"Ids",s=this.categoryField+"Names";return t[i]=[this.currentCategoryId],t[s]=e,t}return null}i=this.categoryField+"Id",s=this.categoryField+"Name";return(t={})[i]=this.currentCategoryId,t[s]=this.getCurrentCategoryName(),t}getCurrentCategoryName(){return this.currentCategoryName||(this.nestedCategoriesCollection&&this.nestedCategoriesCollection.categoryData&&this.nestedCategoriesCollection.categoryData.name?this.nestedCategoriesCollection.categoryData.name:this.currentCategoryId)}actionManageCategories(){this.clearView("categories"),this.clearView("nestedCategories"),this.getRouter().navigate("#"+this.categoryScope,{trigger:!0})}getHeader(){if(!this.nestedCategoriesCollection)return super.getHeader();var e=this.nestedCategoriesCollection.path;if(!e||0===e.length)return super.getHeader();var t="#"+this.scope;let i=[$("<a>").attr("href",t).addClass("action").text(this.translate(this.scope,"scopeNamesPlural")).addClass("action").attr("data-action","openCategory")];var s=this.nestedCategoriesCollection.categoryData.name,a=this.nestedCategoriesCollection.categoryData.upperId,l=this.nestedCategoriesCollection.categoryData.upperName,e=(2<e.length&&i.push("..."),a&&(e=t+"/list/categoryId="+this.escapeString(a),t=$("<a>").attr("href",e).text(l).addClass("action").attr("data-action","openCategory").attr("data-id",a).attr("data-name",l),i.push(t)),$("<span>").text(s));return i.push(e),this.buildHeaderHtml(i)}updateHeader(){this.getView("header").reRender()}hideListContainer(){this.$listContainer.addClass("hidden")}showListContainer(){this.$listContainer.removeClass("hidden")}actionToggleNavigationPanel(){var e=!this.hasNavigationPanel;this.hasNavigationPanel=e,this.setNavigationPanelStoredValue(e),this.reRender().then(()=>{this.loadNestedCategories()})}}e.default=s}),define("views/detail",["exports","views/main"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="detail";name="Detail";optionsToPass=["attributes","returnUrl","returnDispatchParams","rootUrl"];headerView="views/header";recordView="views/record/detail";rootLinkDisabled=!1;rootUrl="";isReturn=!1;shortcutKeys={};entityType;setup(){super.setup(),this.entityType=this.model.entityType||this.model.name,this.headerView=this.options.headerView||this.headerView,this.recordView=this.options.recordView||this.recordView,this.rootUrl=this.options.rootUrl||this.options.params.rootUrl||"#"+this.scope,this.isReturn=this.options.isReturn||this.options.params.isReturn||!1,this.setupHeader(),this.setupRecord(),this.setupPageTitle(),this.initFollowButtons(),this.initRedirect()}setupFinal(){super.setupFinal(),this.wait(this.getHelper().processSetupHandlers(this,"detail"))}initRedirect(){if(this.options.params.isAfterCreate){let e=()=>{Espo.Ui.success(this.translate("Created")),setTimeout(()=>{this.getRouter().navigate(this.rootUrl,{trigger:!0})},1e3)};this.model.lastSyncPromise&&403===this.model.lastSyncPromise.getStatus()?e():this.listenToOnce(this.model,"fetch-forbidden",()=>e())}}setupPageTitle(){this.listenTo(this.model,"after:save",()=>{this.updatePageTitle()}),this.listenTo(this.model,"sync",e=>{e&&e.hasChanged("name")&&this.updatePageTitle()})}setupHeader(){this.createView("header",this.headerView,{model:this.model,fullSelector:"#main > .header",scope:this.scope,fontSizeFlexible:!0}),this.listenTo(this.model,"sync",e=>{e&&e.hasChanged("name")&&this.getView("header")&&this.getView("header").reRender()})}setupRecord(){let t={model:this.model,fullSelector:"#main > .record",scope:this.scope,shortcutKeysEnabled:!0,isReturn:this.isReturn};return this.optionsToPass.forEach(e=>{t[e]=this.options[e]}),this.options.params&&this.options.params.rootUrl&&(t.rootUrl=this.options.params.rootUrl),this.model.get("deleted")&&(t.readOnly=!0),this.createView("record",this.getRecordViewName(),t)}getRecordViewName(){return this.getMetadata().get("clientDefs."+this.scope+".recordViews.detail")||this.recordView}initFollowButtons(){this.getMetadata().get(["scopes",this.scope,"stream"])&&(this.addFollowButtons(),this.listenTo(this.model,"change:isFollowed",()=>{this.controlFollowButtons()}))}addFollowButtons(){var e=this.model.get("isFollowed");this.addMenuItem("buttons",{name:"unfollow",label:"Followed",style:"success",action:"unfollow",hidden:!e},!0),this.addMenuItem("buttons",{name:"follow",label:"Follow",style:"default",iconHtml:'<span class="fas fa-rss fa-sm"></span>',text:this.translate("Follow"),action:"follow",hidden:e||!this.model.has("isFollowed")||!this.getAcl().checkModel(this.model,"stream")},!0)}controlFollowButtons(){if(this.model.get("isFollowed"))return this.hideHeaderActionItem("follow"),void this.showHeaderActionItem("unfollow");this.hideHeaderActionItem("unfollow"),this.getAcl().checkModel(this.model,"stream")&&this.showHeaderActionItem("follow")}actionFollow(){this.disableMenuItem("follow"),Espo.Ajax.putRequest(this.entityType+"/"+this.model.id+"/subscription").then(()=>{this.hideHeaderActionItem("follow"),this.model.set("isFollowed",!0,{sync:!0}),this.enableMenuItem("follow")}).catch(()=>{this.enableMenuItem("follow")})}actionUnfollow(){this.disableMenuItem("unfollow"),Espo.Ajax.deleteRequest(this.entityType+"/"+this.model.id+"/subscription").then(()=>{this.hideHeaderActionItem("unfollow"),this.model.set("isFollowed",!1,{sync:!0}),this.enableMenuItem("unfollow")}).catch(()=>{this.enableMenuItem("unfollow")})}getHeader(){var e=this.model.get("name")||this.model.id;let t=$("<span>").addClass("font-size-flexible title").text(e);this.model.get("deleted")&&t.css("text-decoration","line-through");var e=this.getHeaderIconHtml(),i=this.getLanguage().translate(this.scope,"scopeNamesPlural");let s=$("<span>").text(i);return this.rootLinkDisabled||(s=$("<span>").append($("<a>").attr("href",this.rootUrl).addClass("action").attr("data-action","navigateToRoot").text(i))),e&&s.prepend(e),this.buildHeaderHtml([s,t])}updatePageTitle(){this.model.has("name")?this.setPageTitle(this.model.get("name")||this.model.id):super.updatePageTitle()}getRecordView(){return this.getView("record")}updateRelationshipPanel(t){let i=this.getView("record").getView("bottom");if(i){let e=i.getView(t);e&&e.collection.fetch()}}relatedAttributeMap={};relatedAttributeFunctions={};selectRelatedFilters={};selectPrimaryFilterNames={};selectBoolFilterLists=[];actionCreateRelated(t){let i=(t=t||{}).link,s=this.model.defs.links[i].entity,a=this.model.defs.links[i].foreign,l={},r=(this.relatedAttributeFunctions[i]&&"function"==typeof this.relatedAttributeFunctions[i]&&(l=_.extend(this.relatedAttributeFunctions[i].call(this),l)),this.getMetadata().get(["clientDefs",this.scope,"relationshipPanels",i,"createAttributeMap"])||this.relatedAttributeMap[i]||{}),e=(Object.keys(r).forEach(e=>{l[r[e]]=this.model.get(e)}),Espo.Ui.notify(" ... "),this.getMetadata().get(["clientDefs",this.scope,"relationshipPanels",i,"createHandler"]));new Promise(t=>{e?Espo.loader.requirePromise(e).then(e=>new e(this.getHelper())).then(e=>{e.getAttributes(this.model).then(e=>t(e))}):t({})}).then(e=>{l={...l,...e};e=this.getMetadata().get(["clientDefs",s,"modalViews","edit"])||"views/modals/edit";this.createView("quickCreate",e,{scope:s,relate:{model:this.model,link:a},attributes:l},e=>{e.render(),e.notify(!1),this.listenToOnce(e,"after:save",()=>{t.fromSelectRelated&&setTimeout(()=>this.clearView("dialogSelectRelated"),25),this.updateRelationshipPanel(i),this.model.trigger("after:relate"),this.model.trigger("after:relate:"+i)})})})}actionSelectRelated(t){let s=t.link;if(!t.foreignEntityType&&!this.model.defs.links[s])throw new Error("Link "+s+" does not exist.");let i=t.foreignEntityType||this.model.defs.links[s].entity,h=t.massSelect,a=this.getMetadata().get(["clientDefs",this.scope,"relationshipPanels",s])||{},l={};if(s in this.selectRelatedFilters)for(var e in l=Espo.Utils.cloneDeep(this.selectRelatedFilters[s])||l){var c;"function"==typeof l[e]&&((c=l[e].call(this))?l[e]=c:delete l[e])}var r,o=this.model.getLinkParam(s,"foreign");o&&i&&(m=this.getMetadata().get(["entityDefs",i,"links",o,"type"]),r=this.getMetadata().get(["entityDefs",i,"fields",o,"type"]),~["belongsTo","belongsToParent"].indexOf(m)&&r&&!l[o]&&~["link","linkParent"].indexOf(r)&&(l[o]={type:"isNull",attribute:o+"Id",data:{type:"isEmpty"}}));let n=t.primaryFilterName||this.selectPrimaryFilterNames[s]||null,u=("function"==typeof n&&(n=n.call(this)),t.boolFilterList),d=(u="string"==typeof t.boolFilterList?t.boolFilterList.split(","):u)||a.selectBoolFilterList||this.selectBoolFilterLists[s]||[];"function"==typeof d&&(d=d.call(this)),d=Espo.Utils.clone(d),n=n||a.selectPrimaryFilter||null;var m=t.viewKey||"select";let p=a.selectModalView||this.getMetadata().get(["clientDefs",i,"modalViews",m])||"views/modals/select-records",f=(Espo.Ui.notify(" ... "),a.selectHandler||null);new Promise(t=>{f?Espo.loader.requirePromise(f).then(e=>new e(this.getHelper())).then(e=>{e.getFilters(this.model).then(e=>t(e))}):t({})}).then(e=>{l={...l,...e.advanced||{}},d=[...d,...e.bool||[]],e.primary&&!n&&(n=e.primary),this.createView("dialogSelectRelated",p,{scope:i,multiple:!0,createButton:t.createButton||!1,triggerCreateEvent:!0,filters:l,massRelateEnabled:h,primaryFilterName:n,boolFilterList:d,mandatorySelectAttributeList:a.selectMandatoryAttributeList},e=>{e.render(),Espo.Ui.notify(!1),this.listenTo(e,"create",()=>{this.actionCreateRelated({link:t.link,fromSelectRelated:!0})}),this.listenToOnce(e,"select",e=>{let i={};if("[object Array]"===Object.prototype.toString.call(e)){let t=[];e.forEach(e=>t.push(e.id)),i.ids=t}else e.massRelate?(i.massRelate=!0,i.where=e.where,i.searchParams=e.searchParams):i.id=e.id;e=this.scope+"/"+this.model.id+"/"+s;Espo.Ajax.postRequest(e,i).then(()=>{Espo.Ui.success(this.translate("Linked")),this.updateRelationshipPanel(s),this.model.trigger("after:relate"),this.model.trigger("after:relate:"+s)})})})})}actionDuplicate(){Espo.Ui.notify(" ... "),Espo.Ajax.postRequest(this.scope+"/action/getDuplicateAttributes",{id:this.model.id}).then(e=>{Espo.Ui.notify(!1);var t="#"+this.scope+"/create";this.getRouter().dispatch(this.scope,"create",{attributes:e,returnUrl:this.getRouter().getCurrentUrl(),options:{duplicateSourceId:this.model.id}}),this.getRouter().navigate(t,{trigger:!1})})}}e.default=s}),define("views/stream/notes/relate",["exports","views/stream/note"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="stream/notes/create-related";messageName="relate";data(){return{...super.data(),relatedTypeString:this.translateEntityType(this.entityType),iconHtml:this.getIconHtml(this.entityType,this.entityId)}}init(){this.getUser().isAdmin()&&(this.isRemovable=!0),super.init()}setup(){var e=this.model.get("data")||{};this.entityType=this.model.get("relatedType")||e.entityType||null,this.entityId=this.model.get("relatedId")||e.entityId||null,this.entityName=this.model.get("relatedName")||e.entityName||null,this.messageData.relatedEntityType=this.translateEntityType(this.entityType),this.messageData.relatedEntity=$("<a>").attr("href","#"+this.entityType+"/view/"+this.entityId).text(this.entityName),this.createMessage()}}e.default=s}),define("views/record/list-expanded",["exports","views/record/list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="record/list-expanded";checkboxes=!1;selectable=!1;rowActionsView=!1;_internalLayoutType="list-row-expanded";presentationType="expanded";pagination=!1;header=!1;_internalLayout=null;checkedList=null;listContainerEl=".list > ul";setup(){super.setup(),this.on("after:save",e=>{let t=this.getView(e.id);t&&t.reRender()}),this.displayTotalCount=!1}_loadListLayout(e){var t=this.type+"Expanded";this.layoutLoadCallbackList.push(e),this.layoutIsBeingLoaded||(this.layoutIsBeingLoaded=!0,this._helper.layoutManager.get(this.collection.entityType,t,t=>{this.layoutLoadCallbackList.forEach(e=>{e(t),this.layoutLoadCallbackList=[],this.layoutIsBeingLoaded=!1})}))}_convertLayout(e,i){i=i||this.collection.prepareModel();let s={rows:[],right:!1};for(var a in e.rows){var l,r=e.rows[a];let t=[];for(l in r){var o=r[l],n=o.type||i.getFieldType(o.name)||"base";let e={name:o.name+"Field",field:o.name,view:o.view||i.getFieldParam(o.name,"view")||this.getFieldManager().getViewName(n),options:{defs:{name:o.name,params:o.params||{}},mode:"list"}};if(o.options)for(var d in o.options)void 0===e.options[d]&&(e.options[d]=o.options[d]);o.link&&(e.options.mode="listLink"),t.push(e)}s.rows.push(t)}var t;return"right"in e?e.right&&(t=e.right.name||"right",s.right={field:t,name:t,view:e.right.view,options:{defs:{params:{width:e.right.width||"7%"}}}}):this.rowActionsView&&(s.right=this.getRowActionsDefs()),s}getRowSelector(e){return'li[data-id="'+e+'"]'}getItemEl(e,t){t=t.field||t.columnName;return this.getSelector()+' li[data-id="'+e.id+'"] .cell[data-name="'+t+'"]'}getRowContainerHtml(e){return $("<li>").attr("data-id",e).addClass("list-group-item list-row").get(0).outerHTML}prepareInternalLayout(e,t){let i=e.rows||[];i.forEach(e=>{e.forEach(e=>{e.el=this.getItemEl(t,e)})}),e.right&&(e.right.el=this.getItemEl(t,e.right))}fetchAttributeListFromLayout(){var t=[];return this.listLayout.rows&&this.listLayout.rows.forEach(e=>{e.forEach(e=>{e.name&&(e=e.name,this.getMetadata().get(["entityDefs",this.scope,"fields",e,"type"])&&this.getFieldManager().getEntityTypeFieldAttributeList(this.scope,e).forEach(e=>{t.push(e)}))})}),t}}e.default=s}),define("views/record/edit-for-modal",["exports","views/record/edit"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{bottomView=null;sideView=null;buttonsDisabled=!0;isWide=!0;accessControlDisabled=!0;confirmLeaveDisabled=!0}e.default=s}),define("views/record/detail-side",["exports","views/record/panels-container"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="record/side";mode="detail";readOnly=!1;inlineEditDisabled=!1;name="side";defaultPanel=!0;panelList=[];defaultPanelDefs={name:"default",label:!1,view:"views/record/panels/default-side",isForm:!0,options:{fieldList:[{name:":assignedUser"},{name:"teams"}]}};init(){this.panelList=this.options.panelList||this.panelList,this.scope=this.entityType=this.options.model.entityType,this.recordHelper=this.options.recordHelper,this.panelList=Espo.Utils.clone(this.panelList),this.readOnlyLocked=this.options.readOnlyLocked||this.readOnly,this.readOnly=this.options.readOnly||this.readOnly,this.inlineEditDisabled=this.options.inlineEditDisabled||this.inlineEditDisabled,this.recordViewObject=this.options.recordViewObject}setupPanels(){}setup(){if(this.type=this.mode,"type"in this.options&&(this.type=this.options.type),this.setupPanels(),!this.additionalPanelsDisabled){let e=this.getMetadata().get(["clientDefs",this.scope,"sidePanels",this.type])||[];e.forEach(e=>{this.panelList.push(e)})}this.panelList=this.panelList.filter(e=>{if(!e.aclScope||this.getAcl().checkScope(e.aclScope))return!(e.accessDataList&&!Espo.Utils.checkAccessDataList(e.accessDataList,this.getAcl(),this.getUser()))}),this.panelList=this.panelList.map(e=>{let t=Espo.Utils.clone(e);return null!==this.recordHelper.getPanelStateParam(e.name,"hidden")?t.hidden=this.recordHelper.getPanelStateParam(e.name,"hidden"):this.recordHelper.setPanelStateParam(e.name,"hidden",t.hidden||!1),t}),this.panelList.forEach(e=>{e.actionsViewKey=e.name+"Actions"}),this.wait(Promise.all([new Promise(t=>{this.getHelper().layoutManager.get(this.scope,"sidePanels"+Espo.Utils.upperCaseFirst(this.type),e=>{this.layoutData=e,t()})}),new Promise(t=>{!this.defaultPanel||this.getMetadata().get(["clientDefs",this.scope,"defaultSidePanelDisabled"])||this.getMetadata().get(["clientDefs",this.scope,"defaultSidePanel",this.type])||this.getMetadata().get(["clientDefs",this.scope,"defaultSidePanelFieldLists",this.type])||this.getMetadata().get(["clientDefs",this.scope,"defaultSidePanelFieldList"])?t():this.getHelper().layoutManager.get(this.scope,"defaultSidePanel",e=>{this.defaultSidePanelLayoutData=e,t()})})]).then(()=>{this.defaultPanel&&this.setupDefaultPanel(),this.alterPanels(),this.setupPanelsFinal(),this.setupPanelViews()}))}setupDefaultPanel(){let t=!1;if(this.panelList.forEach(e=>{"default"===e.name&&(t=!0)}),!t){let s=this.getMetadata().get(["clientDefs",this.scope,"defaultSidePanel",this.type]);if(!1!==s&&!this.getMetadata().get(["clientDefs",this.scope,"defaultSidePanelDisabled"])&&(s=s||this.defaultPanelDefs)){(s=Espo.Utils.cloneDeep(s)).view=this.getMetadata().get(["clientDefs",this.scope,"defaultSidePanelView"])||s.view;let i=this.getMetadata().get(["clientDefs",this.scope,"defaultSidePanelFieldLists",this.type]);if((i=!(i=i||this.getMetadata().get(["clientDefs",this.scope,"defaultSidePanelFieldList"]))&&this.defaultSidePanelLayoutData?this.defaultSidePanelLayoutData:i)&&(s.options=s.options||{},s.options.fieldList=i),(i=s.options.fieldList)&&i.length){i.forEach((e,t)=>{"object"!=typeof e&&(e={name:e},i[t]=e),":assignedUser"===e.name&&(this.model.hasField("assignedUsers")?(e.name="assignedUsers",this.model.getFieldParam("assignedUsers","view")||(e.view="views/fields/assigned-users")):this.model.hasField("assignedUser")?e.name="assignedUser":s.options.fieldList[t]={})});const a=this.getMetadata().get(["entityDefs",this.entityType,"fields"])||{};s.options.fieldList=i.filter(e=>{return!(a[e.name]||{}).disabled})}this.panelList.unshift(s)}}}}e.default=s}),define("views/record/detail-bottom",["exports","views/record/panels-container"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="record/bottom";mode="detail";streamPanel=!0;relationshipPanels=!0;readOnly=!1;portalLayoutDisabled=!1;name="bottom";setupPanels(){var e=this.scope;this.panelList=Espo.Utils.clone(this.getMetadata().get(["clientDefs",e,"bottomPanels",this.type])||this.panelList||[]),this.panelList.forEach(e=>{"index"in e||"order"in e&&(e.index=e.order)}),this.streamPanel&&this.getMetadata().get(["scopes",e,"stream"])&&this.setupStreamPanel()}setupStreamPanel(){let e=this.getAcl().checkModel(this.model,"stream",!0);null===e&&this.listenToOnce(this.model,"sync",()=>{(e=this.getAcl().checkModel(this.model,"stream",!0))&&this.onPanelsReady(()=>{this.showPanel("stream","acl")})}),!1!==e&&(this.panelList.push({name:"stream",label:"Stream",view:this.getMetadata().get(["clientDefs",this.scope,"streamPanelView"])||"views/stream/panel",sticked:!0,hidden:!e,index:2}),e||this.recordHelper.setPanelStateParam("stream","hiddenAclLocked",!0))}init(){this.recordHelper=this.options.recordHelper,this.scope=this.entityType=this.model.name,this.readOnlyLocked=this.options.readOnlyLocked||this.readOnly,this.readOnly=this.options.readOnly||this.readOnly,this.inlineEditDisabled=this.options.inlineEditDisabled||this.inlineEditDisabled,this.portalLayoutDisabled=this.options.portalLayoutDisabled||this.portalLayoutDisabled,this.recordViewObject=this.options.recordViewObject}setup(){this.type=this.mode,"type"in this.options&&(this.type=this.options.type),this.panelList=[],this.setupPanels(),this.wait(!0),Promise.all([new Promise(t=>{this.getHelper().layoutManager.get(this.scope,"bottomPanels"+Espo.Utils.upperCaseFirst(this.type),e=>{this.layoutData=e,t()})})]).then(()=>{let t=[];if(this.panelList=this.panelList.filter(e=>{if(t.push(e.name),!e.aclScope||this.getAcl().checkScope(e.aclScope))return!(e.accessDataList&&!Espo.Utils.checkAccessDataList(e.accessDataList,this.getAcl(),this.getUser()))}),this.relationshipPanels){var e,i=(this.model.defs||{}).links||{};if(this.layoutData)for(var s in this.layoutData)i[s]&&(e=this.layoutData[s],~t.indexOf(s)||e.disabled||this.addRelationshipPanel(s,e))}this.panelList=this.panelList.map(e=>{let t=Espo.Utils.clone(e);return null!==this.recordHelper.getPanelStateParam(e.name,"hidden")?t.hidden=this.recordHelper.getPanelStateParam(e.name,"hidden"):this.recordHelper.setPanelStateParam(e.name,"hidden",t.hidden||!1),t}),this.panelList.forEach(e=>{e.actionsViewKey=e.name+"Actions"}),this.alterPanels(),this.setupPanelsFinal(),this.setupPanelViews(),this.wait(!1)})}setReadOnly(){this.readOnly=!0}addRelationshipPanel(e,t){var i=this.scope,s=this.getMetadata().get("scopes")||{};let a;if((a="string"==typeof t||t instanceof String?{name:t}:Espo.Utils.clone(t||{})).name=a.name||e,a.name){void 0===a.order&&(a.order=5),e=a.name;t=(this.model.defs||{}).links||{};if(e in t){t=t[e].entity;if(!(s[t]||{}).disabled&&this.getAcl().check(t,"read")){var l,r=this.getMetadata().get(["clientDefs",i,"relationshipPanels",e])||{};for(l in r=Espo.Utils.clone(r))l in a||(a[l]=r[l]);a.view||(a.view="views/record/panels/relationship"),null!==this.recordHelper.getPanelStateParam(a.name,"hidden")?a.hidden=this.recordHelper.getPanelStateParam(a.name,"hidden"):this.recordHelper.setPanelStateParam(a.name,"hidden",a.hidden||!1),this.panelList.push(a)}}}}}e.default=s}),define("views/record/row-actions/relationship",["exports","views/record/row-actions/default"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){const e=[{action:"quickView",label:"View",data:{id:this.model.id},link:"#"+this.model.entityType+"/view/"+this.model.id}];return this.options.acl.edit&&(e.push({action:"quickEdit",label:"Edit",data:{id:this.model.id},link:"#"+this.model.entityType+"/edit/"+this.model.id}),this.options.unlinkDisabled||e.push({action:"unlinkRelated",label:"Unlink",data:{id:this.model.id}})),this.options.acl.delete&&e.push({action:"removeRelated",label:"Remove",data:{id:this.model.id}}),e}}e.default=s}),define("views/record/row-actions/edit-and-remove",["exports","views/record/row-actions/default"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){let e=[];return this.options.acl.edit&&e.push({action:"quickEdit",label:"Edit",data:{id:this.model.id},link:"#"+this.model.entityType+"/edit/"+this.model.id}),this.options.acl.delete&&e.push({action:"quickRemove",label:"Remove",data:{id:this.model.id}}),e}}e.default=s}),define("views/record/panels/side",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="record/panels/side";fieldList=null;mode="detail";actionList=null;buttonList=null;readOnly=!1;inlineEditDisabled=!1;disabled=!1;events={"click .action":function(e){Espo.Utils.handleAction(this,e.originalEvent,e.currentTarget,{actionItems:[...this.buttonList,...this.actionList],className:"panel-action"})}};data(){return{fieldList:this.getFieldList(),hiddenFields:this.recordHelper.getHiddenFields()}}init(){this.panelName=this.options.panelName,this.defs=this.options.defs||{},this.recordHelper=this.options.recordHelper,"disabled"in this.options&&(this.disabled=this.options.disabled),this.buttonList=_.clone(this.defs.buttonList||this.buttonList||[]),this.actionList=_.clone(this.defs.actionList||this.actionList||[]),this.fieldList=this.options.fieldList||this.fieldList||this.defs.fieldList||[],this.mode=this.options.mode||this.mode,this.readOnlyLocked=this.options.readOnlyLocked||this.readOnly,this.readOnly=this.readOnly||this.options.readOnly,this.inlineEditDisabled=this.inlineEditDisabled||this.options.inlineEditDisabled,this.recordViewObject=this.options.recordViewObject}setup(){this.setupFields(),this.fieldList=this.fieldList.map(e=>{let t=e;return"object"!=typeof t&&(t={name:t,viewKey:t+"Field"}),(t=Espo.Utils.clone(t)).viewKey=t.name+"Field",t.label=t.label||t.name,null!==this.recordHelper.getFieldStateParam(t.name,"hidden")?t.hidden=this.recordHelper.getFieldStateParam(t.name,"hidden"):this.recordHelper.setFieldStateParam(t.name,t.hidden||!1),t}),this.fieldList=this.fieldList.filter(e=>{if(e.name&&(e.isAdditional||e.name in((this.model.defs||{}).fields||{})))return!0}),this.createFields()}afterRender(){0===this.$el.children().length&&this.$el.parent().addClass("hidden")}setupFields(){}createField(e,t,i,s,a,l){var r=this.model.getFieldType(e)||"base";t=t||this.model.getFieldParam(e,"view")||this.getFieldManager().getViewName(r);let o={model:this.model,selector:'.field[data-name="'+e+'"]',defs:{name:e,params:i||{}},mode:s||this.mode,dataObject:this.options.dataObject};if(l)for(var n in l)o[n]=l[n];let d=this.readOnlyLocked;this.readOnly?o.readOnly=!0:null!==a&&(o.readOnly=a),a&&(d=!0),this.inlineEditDisabled&&(o.inlineEditDisabled=!0),this.recordHelper.getFieldStateParam(e,"hidden")&&(o.disabled=!0),this.recordHelper.getFieldStateParam(e,"hiddenLocked")&&(o.disabledLocked=!0),this.recordHelper.getFieldStateParam(e,"readOnly")&&(o.readOnly=!0),null!==this.recordHelper.getFieldStateParam(e,"required")&&(o.defs.params.required=this.recordHelper.getFieldStateParam(e,"required")),(d=!d&&this.recordHelper.getFieldStateParam(e,"readOnlyLocked")?!0:d)&&(o.readOnlyLocked=d),this.recordHelper.hasFieldOptionList(e)&&(o.customOptionList=this.recordHelper.getFieldOptionList(e)),this.recordViewObject&&(o.validateCallback=()=>this.recordViewObject.validateField(e)),o.recordHelper=this.recordHelper,this.createView(e+"Field",t,o)}createFields(){this.getFieldList().forEach(e=>{let t=null,i,s=null;"object"==typeof e?(i=e.name,t=e.view,"readOnly"in e&&(s=e.readOnly)):i=e,(e.isAdditional||i in this.model.defs.fields)&&this.createField(i,t,null,null,s,e.options)})}getFields(){return this.getFieldViews()}getFieldViews(){let t={};return this.getFieldList().forEach(e=>{this.hasView(e.viewKey)&&(t[e.name]=this.getView(e.viewKey))}),t}getFieldList(){return this.fieldList.map(e=>"object"!=typeof e?{name:e}:e)}getActionList(){return this.actionList||[]}getButtonList(){return this.buttonList||[]}actionRefresh(){this.model.fetch()}isTabHidden(){if(-1===this.defs.tabNumber||void 0===this.defs.tabNumber)return!1;var e=this.getParentView();return e?!(!e||!e.hasTabs)&&e.currentTab!==defs.tabNumber:0<this.defs.tabNumber}}e.default=s}),define("views/record/panels/relationship",["exports","views/record/panels/bottom","search-manager","helpers/record-modal"],function(e,t,l,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),l=i(l),a=i(a);class s extends t.default{template="record/panels/relationship";rowActionsView="views/record/row-actions/relationship";url=null;scope=null;readOnly=!1;fetchOnModelAfterRelate=!1;noCreateScopeList=["User","Team","Role","Portal"];recordsPerPage=null;viewModalView=null;setup(){if(super.setup(),this.link=this.link||this.defs.link||this.panelName,!(this.scope||this.link in this.model.defs.links))throw new Error("Link '"+this.link+"' is not defined in model '"+this.model.entityType+"'");this.scope=this.scope||this.model.defs.links[this.link].entity;var e=this.getMetadata().get(["entityDefs",this.model.entityType,"links",this.link,"readOnly"])||!1;let i=this.url=this.url||this.model.entityType+"/"+this.model.id+"/"+this.link,t=("create"in this.defs||(this.defs.create=!0),"select"in this.defs||(this.defs.select=!0),"view"in this.defs||(this.defs.view=!0),e&&(this.defs.create=!1,this.defs.select=!1),this.filterList=this.defs.filterList||this.filterList||null,this.filterList&&this.filterList.length&&(this.filter=this.getStoredFilter()),this.setupTitle(),this.defs.createDisabled&&(this.defs.create=!1),this.defs.selectDisabled&&(this.defs.select=!1),this.defs.viewDisabled&&(this.defs.view=!1),!1);if(this.defs.create&&this.getAcl().check(this.scope,"create")&&!~this.noCreateScopeList.indexOf(this.scope)&&(this.buttonList.push({title:"Create",action:this.defs.createAction||"createRelated",link:this.link,html:'<span class="fas fa-plus"></span>',data:{link:this.link},acl:this.defs.createRequiredAccess||null}),t=!0),this.defs.select){let e={link:this.link};this.defs.selectPrimaryFilterName&&(e.primaryFilterName=this.defs.selectPrimaryFilterName),this.defs.selectBoolFilterList&&(e.boolFilterList=this.defs.selectBoolFilterList),e.massSelect=this.defs.massSelect,e.createButton=t,this.actionList.unshift({label:"Select",action:this.defs.selectAction||"selectRelated",data:e,acl:this.defs.selectRequiredAccess||"edit"})}this.defs.view&&this.actionList.unshift({label:"View List",action:this.defs.viewAction||"viewRelatedList"}),this.setupActions();let s="listSmall",a=(this.setupListLayout(),this.listLayoutName&&(s=this.listLayoutName),null);e=this.defs.layout||null;e&&("string"==typeof e?s=e:(s="listRelationshipCustom",a=e)),this.listLayout=a,this.layoutName=s,this.setupSorting(),this.wait(!0),this.getCollectionFactory().create(this.scope,t=>{if(t.maxSize=this.recordsPerPage||this.getConfig().get("recordsPerPageSmall")||5,this.defs.filters){let e=new l.default(t,"listRelationship",!1,this.getDateTime());e.setAdvanced(this.defs.filters),t.where=e.getWhere()}t.url=t.urlRoot=i,this.defaultOrderBy&&t.setOrder(this.defaultOrderBy,this.defaultOrder||!1,!0),(this.collection=t).parentModel=this.model,this.setFilter(this.filter),this.fetchOnModelAfterRelate&&this.listenTo(this.model,"after:relate",()=>t.fetch()),this.listenTo(this.model,"update-all",()=>t.fetch());let e=this.defs.recordListView||this.getMetadata().get(["clientDefs",this.scope,"recordViews","listRelated"])||this.getMetadata().get(["clientDefs",this.scope,"recordViews","list"])||"views/record/list";this.listViewName=e,this.rowActionsView=!this.defs.readOnly&&(this.defs.rowActionsView||this.rowActionsView),this.once("after:render",()=>{this.createView("list",e,{collection:t,layoutName:s,listLayout:a,checkboxes:!1,rowActionsView:this.rowActionsView,buttonsDisabled:!0,selector:".list-container",skipBuildRows:!0,rowActionsOptions:{unlinkDisabled:this.defs.unlinkDisabled},displayTotalCount:!1},e=>{e.getSelectAttributeList(e=>{e&&(t.data.select=e.join(",")),this.defs.hidden?this.once("show",()=>t.fetch()):t.fetch()})})}),this.wait(!1)}),this.setupFilterActions(),this.setupLast()}setupLast(){}setupTitle(){this.title=this.title||this.translate(this.link,"links",this.model.entityType);let e="";this.getConfig().get("scopeColorsDisabled")||(e=this.getHelper().getScopeColorIconHtml(this.scope)),this.titleHtml=this.title,this.defs.label?this.titleHtml=e+this.translate(this.defs.label,"labels",this.scope):this.titleHtml=e+this.title,this.filter&&"all"!==this.filter&&(this.titleHtml+=" &middot; "+this.translateFilter(this.filter))}setupSorting(){let e=this.defs.orderBy||this.defs.sortBy||this.orderBy,t=this.defs.orderDirection||this.orderDirection||this.order;"asc"in this.defs&&(t=this.defs.asc?"asc":"desc"),e||(e=this.getMetadata().get(["entityDefs",this.scope,"collection","orderBy"]),t=this.getMetadata().get(["entityDefs",this.scope,"collection","order"])),e&&!t&&(t="asc"),this.defaultOrderBy=e,this.defaultOrder=t}setupListLayout(){}setupActions(){}setupFilterActions(){this.filterList&&this.filterList.length&&(this.actionList.push(!1),this.filterList.slice(0).forEach(e=>{let t;t="all"===e?!this.filter:e===this.filter;var i=this.translateFilter(e);let s=$("<div>").append($("<span>").addClass("check-icon fas fa-check pull-right").addClass(t?"":"hidden")).append($("<div>").text(i));this.actionList.push({action:"selectFilter",html:s.get(0).innerHTML,data:{name:e}})}))}translateFilter(e){return this.translate(e,"presetFilters",this.scope)}getStoredFilter(){var e="panelFilter"+this.model.entityType+"-"+(this.panelName||this.name);return this.getStorage().get("state",e)||null}storeFilter(e){var t="panelFilter"+this.model.entityType+"-"+(this.panelName||this.name);e?this.getStorage().set("state",t,e):this.getStorage().clear("state",t)}setFilter(e){this.filter=e,this.collection.data.primaryFilter=null,e&&"all"!==e&&(this.collection.data.primaryFilter=e)}actionSelectFilter(e){let i=e.name,t=i,s=("all"===i&&(t=!1),this.storeFilter(t),this.setFilter(t),this.filterList.forEach(e=>{let t=this.$el.closest(".panel").find('[data-name="'+e+'"] span');e===i?t.removeClass("hidden"):t.addClass("hidden")}),this.collection.reset(),this.getView("list"));s&&s.$el&&(e=s.$el.parent().get(0).clientHeight,s.$el.empty(),e&&s.$el.parent().css("height",e+"px")),this.collection.fetch().then(()=>{s.$el.parent().css("height","")}),this.setupTitle(),this.isRendered()&&this.$el.closest(".panel").find("> .panel-heading > .panel-title > span").html(this.titleHtml)}actionRefresh(){this.collection.fetch()}actionViewRelatedList(e){var t=this.getMetadata().get(["clientDefs",this.model.entityType,"relationshipPanels",this.name,"viewModalView"])||this.getMetadata().get(["clientDefs",this.scope,"modalViews","relatedList"])||this.viewModalView||"views/modals/related-list",i=e.scope||this.scope;let s=this.filter,a=(this.relatedListFiltersDisabled&&(s=null),{model:this.model,panelName:this.panelName,link:this.link,scope:i,defs:this.defs,title:e.title||this.title,filterList:this.filterList,filter:s,layoutName:this.layoutName,defaultOrder:this.defaultOrder,defaultOrderBy:this.defaultOrderBy,url:e.url||this.url,listViewName:this.listViewName,createDisabled:!this.isCreateAvailable(i),selectDisabled:!this.isSelectAvailable(i),rowActionsView:this.rowActionsView,panelCollection:this.collection,filtersDisabled:this.relatedListFiltersDisabled});if(e.viewOptions)for(var l in e.viewOptions)a[l]=e.viewOptions[l];Espo.Ui.notify(" ... "),this.createView("modalRelatedList",t,a,e=>{Espo.Ui.notify(!1),e.render(),this.listenTo(e,"action",(e,t)=>{Espo.Utils.handleAction(this,e,t)}),this.listenToOnce(e,"close",()=>{this.clearView("modalRelatedList")})})}isCreateAvailable(e){return!!this.defs.create}isSelectAvailable(e){return!!this.defs.select}actionViewRelated(t){var t=t.id,i=this.collection.get(t);if(i){var s=i.entityType;let e=new a.default(this.getMetadata(),this.getAcl());e.showDetail(this,{scope:s,id:t,model:i}).then(e=>{this.listenTo(e,"after:save",()=>{this.collection.fetch()})})}}actionEditRelated(e){var e=e.id,t=this.collection.get(e).name,i=this.getMetadata().get("clientDefs."+t+".modalViews.edit")||"views/modals/edit";Espo.Ui.notify(" ... "),this.createView("quickEdit",i,{scope:t,id:e},e=>{e.once("after:render",()=>{Espo.Ui.notify(!1)}),e.render(),e.once("after:save",()=>{this.collection.fetch()})})}actionUnlinkRelated(e){let t=e.id;this.confirm({message:this.translate("unlinkRecordConfirmation","messages"),confirmText:this.translate("Unlink")},()=>{Espo.Ui.notify(" ... "),Espo.Ajax.deleteRequest(this.collection.url,{id:t}).then(()=>{Espo.Ui.success(this.translate("Unlinked")),this.collection.fetch(),this.model.trigger("after:unrelate"),this.model.trigger("after:unrelate:"+this.link)})})}actionRemoveRelated(e){let t=e.id;this.confirm({message:this.translate("removeRecordConfirmation","messages"),confirmText:this.translate("Remove")},()=>{let e=this.collection.get(t);Espo.Ui.notify(" ... "),e.destroy().then(()=>{Espo.Ui.success(this.translate("Removed")),this.collection.fetch(),this.model.trigger("after:unrelate"),this.model.trigger("after:unrelate:"+this.link)})})}actionUnlinkAllRelated(e){this.confirm(this.translate("unlinkAllConfirmation","messages"),()=>{Espo.Ui.notify(" ... "),Espo.Ajax.postRequest(this.model.entityType+"/action/unlinkAll",{link:e.link,id:this.model.id}).then(()=>{Espo.Ui.success(this.translate("Unlinked")),this.collection.fetch(),this.model.trigger("after:unrelate"),this.model.trigger("after:unrelate:"+this.link)})})}}e.default=s}),define("views/modals/select-records",["exports","views/modal","search-manager"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{template="modals/select-records";cssName="select-modal";className="dialog dialog-record";multiple=!1;createButton=!0;searchPanel=!0;scope="";noCreateScopeList=["User","Team","Role","Portal"];layoutName="listSmall";shortcutKeys={"Control+Enter":function(e){this.handleShortcutKeyCtrlEnter(e)},"Control+Space":function(e){this.handleShortcutKeyCtrlSpace(e)},"Control+Slash":function(e){this.handleShortcutKeyCtrlSlash(e)},"Control+Comma":function(e){this.handleShortcutKeyCtrlComma(e)},"Control+Period":function(e){this.handleShortcutKeyCtrlPeriod(e)}};events={'click button[data-action="create"]':function(){this.create()},"click .list a":function(e){e.preventDefault()}};data(){return{createButton:this.createButton,createText:this.translate("Create "+this.scope,"labels",this.scope)}}setup(){this.filters=this.options.filters||{},this.boolFilterList=this.options.boolFilterList||[],this.primaryFilterName=this.options.primaryFilterName||null,this.filterList=this.options.filterList||this.filterList||null,this.layoutName=this.options.layoutName||this.layoutName,"multiple"in this.options&&(this.multiple=this.options.multiple),"createButton"in this.options&&(this.createButton=this.options.createButton),this.massRelateEnabled=this.options.massRelateEnabled,this.buttonList=[{name:"cancel",label:"Cancel"}],this.multiple&&this.buttonList.unshift({name:"select",style:"danger",label:"Select",disabled:!0,title:"Ctrl+Enter"}),this.scope=this.entityType=this.options.scope||this.scope;var e=this.getMetadata().get(["clientDefs",this.scope,"selectRecords","orderBy"]),t=this.getMetadata().get(["clientDefs",this.scope,"selectRecords","order"]);e&&(this.defaultOrderBy=e,this.defaultOrder=t||!1),-1!==this.noCreateScopeList.indexOf(this.scope)&&(this.createButton=!1),this.createButton&&(this.getAcl().check(this.scope,"create")&&!this.getMetadata().get(["clientDefs",this.scope,"createDisabled"])||(this.createButton=!1)),this.createButton&&this.addButton({name:"create",position:"right",onClick:()=>this.create(),label:"Create"}),this.getMetadata().get(["clientDefs",this.scope,"searchPanelDisabled"])&&(this.searchPanel=!1),this.getUser().isPortal()&&this.getMetadata().get(["clientDefs",this.scope,"searchPanelInPortalDisabled"])&&(this.searchPanel=!1),this.$header=$("<span>"),this.$header.append($("<span>").text(this.translate("Select")+" · "+this.getLanguage().translate(this.scope,"scopeNamesPlural"))),this.$header.prepend(this.getHelper().getScopeColorIconHtml(this.scope)),this.waitForView("list"),this.searchPanel&&this.waitForView("search"),this.getCollectionFactory().create(this.scope,e=>{e.maxSize=this.getConfig().get("recordsPerPageSelect")||5,this.collection=e,this.defaultOrderBy&&this.collection.setOrder(this.defaultOrderBy,this.defaultOrder||"asc",!0),this.setupSearch(),this.setupList()}),this.once("close",()=>{this.collection.lastSyncPromise&&this.collection.lastSyncPromise.getStatus()<4&&Espo.Ui.notify(!1),this.collection.abortLastFetch()})}setupSearch(){let e=this.searchManager=new s.default(this.collection,"listSelect",null,this.getDateTime()),i=(e.emptyOnReset=!0,this.filters&&e.setAdvanced(this.filters),this.boolFilterList||this.getMetadata().get("clientDefs."+this.scope+".selectDefaultFilters.boolFilterList"));if(i){let t={};i.forEach(e=>{t[e]=!0}),e.setBool(t)}var t=this.primaryFilterName||this.getMetadata().get("clientDefs."+this.scope+".selectDefaultFilters.filter");t&&e.setPrimary(t),this.collection.where=e.getWhere(),this.searchPanel&&this.createView("search","views/record/search",{collection:this.collection,fullSelector:this.containerSelector+" .search-container",searchManager:e,disableSavePreset:!0,filterList:this.filterList},e=>{this.listenTo(e,"reset",()=>{})})}setupList(){var e=this.getMetadata().get("clientDefs."+this.scope+".recordViews.listSelect")||this.getMetadata().get("clientDefs."+this.scope+".recordViews.list")||"views/record/list",e=this.createView("list",e,{collection:this.collection,fullSelector:this.containerSelector+" .list-container",selectable:!0,checkboxes:this.multiple,massActionsDisabled:!0,rowActionsView:!1,layoutName:this.layoutName,searchManager:this.searchManager,checkAllResultDisabled:!this.massRelateEnabled,buttonsDisabled:!0,skipBuildRows:!0,pagination:this.getMetadata().get(["clientDefs",this.scope,"listPagination"])||null},e=>{this.listenToOnce(e,"select",e=>{this.trigger("select",e),this.close()}),this.multiple&&(this.listenTo(e,"check",()=>{e.checkedList.length?this.enableButton("select"):this.disableButton("select")}),this.listenTo(e,"select-all-results",()=>{this.enableButton("select")}));const i=()=>{setTimeout(()=>{Espo.Ui.notify(" ... "),this.collection.fetch().then(()=>Espo.Ui.notify(!1))},1)};this.options.forceSelectAllAttributes||this.forceSelectAllAttributes?i():e.getSelectAttributeList(t=>{~t.indexOf("name")||t.push("name");let e=this.options.mandatorySelectAttributeList||this.mandatorySelectAttributeList||[];e.forEach(e=>{~t.indexOf(e)||t.push(e)}),t&&(this.collection.data.select=t.join(",")),i()})});this.wait(e)}create(){if(this.options.triggerCreateEvent)this.trigger("create");else{Espo.Ui.notify(" ... ");let t=this.getMetadata().get(["clientDefs",this.scope,"modalViews","edit"])||"views/modals/edit";new Promise(t=>{this.options.createAttributesProvider?this.options.createAttributesProvider().then(e=>{t(e)}):t(this.options.createAttributes||{})}).then(e=>{this.createView("quickCreate",t,{scope:this.scope,fullFormDisabled:!0,attributes:e},t=>{t.render().then(()=>Espo.Ui.notify(!1)),this.listenToOnce(t,"leave",()=>{t.close(),this.close()}),this.listenToOnce(t,"after:save",e=>{t.close(),this.trigger("select",e),setTimeout(()=>this.close(),10)})})})}}actionSelect(){if(this.multiple){let e=this.getRecordView();if(e.allResultIsChecked)return this.trigger("select",{massRelate:!0,where:this.collection.getWhere(),searchParams:this.collection.data}),void this.close();var t=e.getSelected();t.length&&this.trigger("select",t),this.close()}}getSearchView(){return this.getView("search")}getRecordView(){return this.getView("list")}handleShortcutKeyCtrlSlash(t){if(this.searchPanel){let e=this.$el.find("input.text-filter").first();e.length&&(t.preventDefault(),t.stopPropagation(),e.focus())}}handleShortcutKeyCtrlEnter(e){this.multiple&&this.hasAvailableActionItem("select")&&(e.stopPropagation(),e.preventDefault(),this.actionSelect())}handleShortcutKeyCtrlSpace(e){this.createButton&&(e.preventDefault(),e.stopPropagation(),this.create())}handleShortcutKeyCtrlComma(){this.getSearchView()&&this.getSearchView().selectPreviousPreset()}handleShortcutKeyCtrlPeriod(){this.getSearchView()&&this.getSearchView().selectNextPreset()}}e.default=a}),define("views/modals/related-list",["exports","views/modal","search-manager","jquery"],function(e,t,i,s){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),i=a(i),s=a(s);class l extends t.default{template="modals/related-list";className="dialog dialog-record";searchPanel=!0;scope="";noCreateScopeList=["User","Team","Role","Portal"];backdrop=!0;fixedHeaderHeight=!0;mandatorySelectAttributeList=null;layoutName="listSmall";shortcutKeys={"Control+Space":function(e){this.handleShortcutKeyCtrlSpace(e)},"Control+Slash":function(e){this.handleShortcutKeyCtrlSlash(e)},"Control+Comma":function(e){this.handleShortcutKeyCtrlComma(e)},"Control+Period":function(e){this.handleShortcutKeyCtrlPeriod(e)}};events={'click button[data-action="createRelated"]':function(){this.actionCreateRelated()},"click .action":function(e){Espo.Utils.handleAction(this,e.originalEvent,e.currentTarget)||this.trigger("action",e.originalEvent,e.currentTarget)}};setup(){this.primaryFilterName=this.options.primaryFilterName||null,this.buttonList=[{name:"cancel",label:"Close"}],this.scope=this.options.scope||this.scope,this.defaultOrderBy=this.options.defaultOrderBy,this.defaultOrder=this.options.defaultOrder,this.panelName=this.options.panelName,this.link=this.options.link,this.defs=this.options.defs||{},this.filterList=this.options.filterList,this.filter=this.options.filter,this.layoutName=this.options.layoutName||this.layoutName,this.url=this.options.url,this.listViewName=this.options.listViewName,this.rowActionsView=this.options.rowActionsView,this.createDisabled=this.options.createDisabled||this.createDisabled,this.selectDisabled=this.options.selectDisabled||this.selectDisabled,this.massUnlinkDisabled=this.options.massUnlinkDisabled||this.massUnlinkDisabled,this.massActionRemoveDisabled=this.options.massActionRemoveDisabled||this.massActionRemoveDisabled,this.massActionMassUpdateDisabled=this.options.massActionMassUpdateDisabled||this.massActionMassUpdateDisabled,this.panelCollection=this.options.panelCollection,this.panelCollection?(this.listenTo(this.panelCollection,"sync",(e,t,i)=>{i.skipCollectionSync||this.collection.fetch()}),this.listenTo(this.panelCollection,"change",(i,e)=>{if(!e.xhr&&i.id){let t=this.collection.get(i.id);if(t){let e={};for(var s in i.attributes)i.hasChanged(s)&&(e[s]=i.attributes[s]);t.set(e)}}}),this.model&&this.listenTo(this.model,"after:unrelate",()=>{this.panelCollection.fetch({skipCollectionSync:!0})})):this.model&&this.listenTo(this.model,"after:relate",()=>{this.collection.fetch()}),-1!==this.noCreateScopeList.indexOf(this.scope)&&(this.createDisabled=!0),this.primaryFilterName=this.filter,this.createDisabled||this.getAcl().check(this.scope,"create")&&!this.getMetadata().get(["clientDefs",this.scope,"createDisabled"])||(this.createDisabled=!0),this.unlinkDisabled=this.unlinkDisabled||this.options.unlinkDisabled,this.massUnlinkDisabled||((this.unlinkDisabled||this.defs.massUnlinkDisabled||this.defs.unlinkDisabled)&&(this.massUnlinkDisabled=!0),this.getAcl().check(this.model,"edit")||(this.massUnlinkDisabled=!0)),this.selectDisabled||this.buttonList.unshift({name:"selectRelated",label:"Select",pullLeft:!0}),this.createDisabled||this.buttonList.unshift({name:"createRelated",label:"Create",pullLeft:!0}),this.$header=(0,s.default)("<span>"),this.model&&this.model.get("name")&&this.$header.append((0,s.default)("<span>").text(this.model.get("name")),' <span class="chevron-right"></span> ');let e=this.options.title;if(e=e&&this.getHelper().escapeString(this.options.title).replace(/@right/,'<span class="chevron-right"></span>'),this.$header.append(e||(0,s.default)("<span>").text(this.getLanguage().translate(this.link,"links",this.entityType))),this.options.listViewUrl&&(this.$header=(0,s.default)("<a>").attr("href",this.options.listViewUrl).append(this.$header)),!this.options.listViewUrl&&(!this.defs.fullFormDisabled&&this.link&&this.model.hasLink(this.link)||this.options.fullFormUrl)){let e=this.options.fullFormUrl||"#"+this.model.entityType+"/related/"+this.model.id+"/"+this.link;this.buttonList.unshift({name:"fullForm",label:"Full Form",onClick:()=>this.getRouter().navigate(e,{trigger:!0})}),this.$header=(0,s.default)("<a>").attr("href",e).append(this.$header)}var t=this.getHelper().getScopeColorIconHtml(this.scope);t&&(this.$header=(0,s.default)("<span>").append(t).append(this.$header)),this.waitForView("list"),this.searchPanel&&this.waitForView("search"),this.getCollectionFactory().create(this.scope,e=>{e.maxSize=this.getConfig().get("recordsPerPage"),e.url=this.url,e.setOrder(this.defaultOrderBy,this.defaultOrder,!0),this.collection=e,this.panelCollection&&this.listenTo(e,"change",e=>{let t=this.panelCollection.get(e.id);t&&t.set(e.attributes)}),this.setupSearch(),this.setupList()}),this.once("close",()=>{this.collection.lastSyncPromise&&this.collection.lastSyncPromise.getStatus()<4&&Espo.Ui.notify(!1),this.collection.abortLastFetch()})}setFilter(e){this.searchManager.setPrimary(e)}getSearchView(){return this.getView("search")}setupSearch(){let e=this.searchManager=new i.default(this.collection,"listSelect",null,this.getDateTime());e.emptyOnReset=!0;var t=this.primaryFilterName;t&&e.setPrimary(t),this.collection.where=e.getWhere();let s=Espo.Utils.clone(this.getMetadata().get(["clientDefs",this.scope,"filterList"])||[]);this.filterList&&this.filterList.forEach(e=>{let t=!1,i=e.name||e;i&&"all"!==i&&(s.forEach(e=>{e=e.name||e;i===e&&(t=!0)}),t||s.push(e))}),this.options.filtersDisabled&&(s=[]),this.searchPanel&&this.createView("search","views/record/search",{collection:this.collection,fullSelector:this.containerSelector+" .search-container",searchManager:e,disableSavePreset:!0,filterList:s},e=>{this.listenTo(e,"reset",()=>{})})}setupList(){var e=this.listViewName||this.getMetadata().get(["clientDefs",this.scope,"recordViews","listRelated"])||this.getMetadata().get(["clientDefs",this.scope,"recordViews","list"])||"views/record/list",e=this.createView("list",e,{collection:this.collection,fullSelector:this.containerSelector+" .list-container",rowActionsView:this.rowActionsView,layoutName:this.layoutName,searchManager:this.searchManager,buttonsDisabled:!0,skipBuildRows:!0,model:this.model,unlinkMassAction:!this.massUnlinkDisabled,massActionRemoveDisabled:this.massActionRemoveDisabled,massActionMassUpdateDisabled:this.massActionMassUpdateDisabled,mandatorySelectAttributeList:this.mandatorySelectAttributeList,rowActionsOptions:{unlinkDisabled:this.unlinkDisabled},pagination:this.getConfig().get("listPagination")||this.getMetadata().get(["clientDefs",this.scope,"listPagination"])||null},e=>{this.listenToOnce(e,"select",e=>{this.trigger("select",e),this.close()}),this.multiple&&(this.listenTo(e,"check",()=>{e.checkedList.length?this.enableButton("select"):this.disableButton("select")}),this.listenTo(e,"select-all-results",()=>this.enableButton("select")));const i=()=>{setTimeout(()=>{Espo.Ui.notify(" ... "),this.collection.fetch().then(()=>Espo.Ui.notify(!1))},1)};this.options.forceSelectAllAttributes||this.forceSelectAllAttributes?i():e.getSelectAttributeList(t=>{~t.indexOf("name")||t.push("name");const e=this.options.mandatorySelectAttributeList||this.mandatorySelectAttributeList||[];e.forEach(e=>{~t.indexOf(e)||t.push(e)}),t&&(this.collection.data.select=t.join(",")),i()})});this.wait(e)}actionUnlinkRelated(e){let t=e.id;this.confirm({message:this.translate("unlinkRecordConfirmation","messages"),confirmText:this.translate("Unlink")},()=>{Espo.Ui.notify(" ... "),Espo.Ajax.deleteRequest(this.collection.url,{id:t}).then(()=>{Espo.Ui.success(this.translate("Unlinked")),this.collection.fetch(),this.model.trigger("after:unrelate"),this.model.trigger("after:unrelate:"+this.link)})})}actionCreateRelated(){var e=this.defs.createAction||"createRelated",t="action"+Espo.Utils.upperCaseFirst(e);let i=this.getParentView();for(;i;){if(i[t]){i;break}i=i.getParentView()}i[t]({link:this.link,scope:this.scope})}actionSelectRelated(){var e=this.defs.selectAction||"selectRelated",t="action"+Espo.Utils.upperCaseFirst(e);let i=this.getParentView();for(;i;){if(i[t]){i;break}i=i.getParentView()}i[t]({link:this.link,primaryFilterName:this.defs.selectPrimaryFilterName,boolFilterList:this.defs.selectBoolFilterList,massSelect:this.defs.massSelect})}actionRemoveRelated(e){let t=e.id;this.confirm({message:this.translate("removeRecordConfirmation","messages"),confirmText:this.translate("Remove")},()=>{let e=this.collection.get(t);Espo.Ui.notify(" ... "),e.destroy().then(()=>{Espo.Ui.success(this.translate("Removed")),this.collection.fetch(),this.model.trigger("after:unrelate"),this.model.trigger("after:unrelate:"+this.link)})})}handleShortcutKeyCtrlSlash(t){if(this.searchPanel){let e=this.$el.find("input.text-filter").first();e.length&&(t.preventDefault(),t.stopPropagation(),e.focus())}}handleShortcutKeyCtrlSpace(e){this.createDisabled||-1!==this.buttonList.findIndex(e=>"createRelated"===e.name&&!e.hidden)&&(e.preventDefault(),e.stopPropagation(),this.actionCreateRelated())}handleShortcutKeyCtrlComma(){this.getSearchView()&&this.getSearchView().selectPreviousPreset()}handleShortcutKeyCtrlPeriod(){this.getSearchView()&&this.getSearchView().selectNextPreset()}}e.default=l}),define("views/modals/mass-convert-currency",["exports","views/modal","model","helpers/mass-action"],function(e,t,i,l){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i),l=s(l);class a extends t.default{template="modals/mass-convert-currency";className="dialog dialog-record";buttonList=[{name:"cancel",label:"Cancel"}];data(){return{}}setup(){this.$header=$("<span>").append($("<span>").text(this.translate(this.options.entityType,"scopeNamesPlural")),' <span class="chevron-right"></span> ',$("<span>").text(this.translate("convertCurrency","massActions"))),this.addButton({name:"convert",text:this.translate("Update"),style:"danger"},!0);let e=this.model=new i.default;e.set("currency",this.getConfig().get("defaultCurrency")),e.set("baseCurrency",this.getConfig().get("baseCurrency")),e.set("currencyRates",this.getConfig().get("currencyRates")),e.set("currencyList",this.getConfig().get("currencyList")),this.createView("currency","views/fields/enum",{model:e,params:{options:this.getConfig().get("currencyList")},name:"currency",selector:'.field[data-name="currency"]',mode:"edit",labelText:this.translate("Convert to")}),this.createView("baseCurrency","views/fields/enum",{model:e,params:{options:this.getConfig().get("currencyList")},name:"baseCurrency",selector:'.field[data-name="baseCurrency"]',mode:"detail",labelText:this.translate("baseCurrency","fields","Settings"),readOnly:!0}),this.createView("currencyRates","views/settings/fields/currency-rates",{model:e,name:"currencyRates",selector:'.field[data-name="currencyRates"]',mode:"edit",labelText:this.translate("currencyRates","fields","Settings")})}getFieldView(e){return this.getView(e)}actionConvert(){this.disableButton("convert"),this.getFieldView("currency").fetchToModel(),this.getFieldView("currencyRates").fetchToModel();var e=this.model.get("currency"),t=this.model.get("currencyRates"),i=!this.options.ids||0===this.options.ids.length;let s=new l.default(this);var a=i&&s.checkIsIdle(this.options.totalCount);Espo.Ajax.postRequest("MassAction",{entityType:this.options.entityType,action:"convertCurrency",params:{ids:this.options.ids||null,where:i?this.options.where:null,searchParams:i?this.options.searchParams:null},data:{fieldList:this.options.fieldList||null,currency:e,targetCurrency:e,rates:t},idle:a}).then(e=>{e.id?s.process(e.id,"convertCurrency").then(e=>{this.listenToOnce(e,"close",()=>this.close()),this.listenToOnce(e,"success",e=>{this.trigger("after:update",{count:e.count,idle:!0})})}):(this.trigger("after:update",{count:e.count}),this.close())}).catch(()=>{this.enableButton("convert")})}}e.default=a}),define("views/modals/edit",["exports","views/modal","backbone"],function(e,t,l){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),l=i(l);class s extends t.default{template="modals/edit";cssName="edit-modal";saveDisabled=!1;fullFormDisabled=!1;editView=null;escapeDisabled=!0;className="dialog dialog-record";sideDisabled=!1;bottomDisabled=!1;shortcutKeys={"Control+Enter":function(e){this.saveDisabled||-1!==this.buttonList.findIndex(e=>"save"===e.name&&!e.hidden)&&(e.preventDefault(),e.stopPropagation(),this.actionSave())},"Control+KeyS":function(e){this.saveDisabled||-1!==this.buttonList.findIndex(e=>"save"===e.name&&!e.hidden)&&(e.preventDefault(),e.stopPropagation(),this.actionSaveAndContinueEditing())},Escape:function(t){if(!this.saveDisabled){t.stopPropagation(),t.preventDefault();let e=this.getRecordView().getFocusedFieldView();e&&this.model.set(e.fetch(),{skipReRender:!0}),this.getRecordView().isChanged?this.confirm(this.translate("confirmLeaveOutMessage","messages")).then(()=>this.actionClose()):this.actionClose()}},"Control+Backslash":function(e){this.getRecordView().handleShortcutKeyControlBackslash(e)}};setup(){this.buttonList=[],"saveDisabled"in this.options&&(this.saveDisabled=this.options.saveDisabled),this.saveDisabled||this.buttonList.push({name:"save",label:"Save",style:"primary",title:"Ctrl+Enter"}),this.fullFormDisabled=this.options.fullFormDisabled||this.fullFormDisabled,this.layoutName=this.options.layoutName||this.layoutName,this.fullFormDisabled||this.buttonList.push({name:"fullForm",label:"Full Form"}),this.buttonList.push({name:"cancel",label:"Cancel",title:"Esc"}),this.scope=this.scope||this.options.scope,this.entityType=this.options.entityType||this.scope,this.id=this.options.id,this.headerHtml=this.composeHeaderHtml(),this.sourceModel=this.model,this.waitForView("edit"),this.getModelFactory().create(this.entityType,e=>{if(this.id)return this.sourceModel?e=this.model=this.sourceModel.clone():(this.model=e).id=this.id,void e.fetch().then(()=>{this.createRecordView(e)});this.model=e,this.options.relate&&e.setRelate(this.options.relate),this.options.attributes&&e.set(this.options.attributes),this.createRecordView(e)})}createRecordView(i,e){var t=this.editView||this.getMetadata().get(["clientDefs",i.entityType,"recordViews","editSmall"])||this.getMetadata().get(["clientDefs",i.entityType,"recordViews","editQuick"])||"views/record/edit-small",s={model:i,fullSelector:this.containerSelector+" .edit-container",type:"editSmall",layoutName:this.layoutName||"detailSmall",buttonsDisabled:!0,sideDisabled:this.sideDisabled,bottomDisabled:this.bottomDisabled,focusForCreate:this.options.focusForCreate,exit:()=>{}};this.handleRecordViewOptions(s),this.createView("edit",t,s,e).then(e=>{var t;this.listenTo(e,"before:save",()=>this.trigger("before:save",i)),this.options.relate&&"link"in this.options.relate&&(t=this.options.relate.link,i.hasField(t)&&["link"].includes(i.getFieldType(t))&&e.setFieldReadOnly(t))})}handleRecordViewOptions(e){}getRecordView(){return this.getView("edit")}onBackdropClick(){this.getRecordView().isChanged||this.close()}composeHeaderHtml(){let e;var t;return e=this.id?(t=this.getLanguage().translate("Edit")+" · "+this.getLanguage().translate(this.scope,"scopeNames"),$("<span>").text(t).get(0).outerHTML):$("<span>").text(this.getLanguage().translate("Create "+this.scope,"labels",this.scope)).get(0).outerHTML,this.fullFormDisabled||(t=this.id?"#"+this.scope+"/edit/"+this.id:"#"+this.scope+"/create",e=$("<a>").attr("href",t).addClass("action").attr("title",this.translate("Full Form")).attr("data-action","fullForm").append(e).get(0).outerHTML),e=this.getHelper().getScopeColorIconHtml(this.scope)+e}actionSave(i){i=i||{};let e=this.getRecordView(),s=e.model,a=this.dialog.$el.find(".modal-footer button");a.addClass("disabled").attr("disabled","disabled"),e.save().then(()=>{var e,t=!this.id;if(t&&(this.id=s.id),this.trigger("after:save",s,{bypassClose:i.bypassClose}),!i.bypassClose)return this.dialog.close(),void(t&&(t="#"+this.scope+"/view/"+s.id,e=s.get("name")||this.model.id,e=this.translate("Created")+"\n"+`[${e}](${t})`,Espo.Ui.notify(e,"success",4e3,{suppress:!0})));this.$el.find(".modal-header .modal-title-text").html(this.composeHeaderHtml()),a.removeClass("disabled").removeAttr("disabled")}).catch(()=>{a.removeClass("disabled").removeAttr("disabled")})}actionSaveAndContinueEditing(){this.actionSave({bypassClose:!0})}actionFullForm(){let e,t=this.getRouter(),i,s,a;this.id?(e="#"+this.scope+"/edit/"+this.id,i=this.getRecordView().fetch(),s=this.getRecordView().model,i={...i,...s.getClonedAttributes()},a={attributes:i,returnUrl:this.options.returnUrl||l.default.history.fragment,returnDispatchParams:this.options.returnDispatchParams||null,model:this.sourceModel,id:this.id},this.options.rootUrl&&(a.rootUrl=this.options.rootUrl),setTimeout(()=>{t.dispatch(this.scope,"edit",a),t.navigate(e,{trigger:!1})},10)):(e="#"+this.scope+"/create",i=this.getRecordView().fetch(),s=this.getRecordView().model,i={...i,...s.getClonedAttributes()},a={attributes:i,relate:this.options.relate,returnUrl:this.options.returnUrl||l.default.history.fragment,returnDispatchParams:this.options.returnDispatchParams||null},this.options.rootUrl&&(a.rootUrl=this.options.rootUrl),setTimeout(()=>{t.dispatch(this.scope,"create",a),t.navigate(e,{trigger:!1})},10)),this.trigger("leave"),this.dialog.close()}}e.default=s}),define("views/fields/user-with-avatar",["exports","views/fields/user"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{listTemplate="fields/user-with-avatar/list";detailTemplate="fields/user-with-avatar/detail";data(){let e=super.data();return this.mode===this.MODE_DETAIL&&(e.avatar=this.getAvatarHtml(),e.isOwn=this.model.get(this.idName)===this.getUser().id),e}getAvatarHtml(){return this.getHelper().getAvatarHtml(this.model.get(this.idName),"small",14,"avatar-link")}}e.default=s}),define("views/fields/url",["exports","views/fields/varchar"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="url";listTemplate="fields/url/list";detailTemplate="fields/url/detail";defaultProtocol="https:";validations=["required","valid","maxLength"];noSpellCheck=!0;DEFAULT_MAX_LENGTH=255;data(){let e=super.data();return e.url=this.getUrl(),e}afterRender(){super.afterRender(),this.isEditMode()&&this.$element.on("change",()=>{var e=this.$element.val()||"",t=this.parse(e);t!==e&&(e=t?decodeURI(t):"",this.$element.val(e))})}getValueForDisplay(){var e=this.model.get(this.name);return e?decodeURI(e):null}parse(e){return e=e.trim(),e=(e=this.params.strip?this.strip(e):e)===decodeURI(e)?encodeURI(e):e}strip(e){return e=(e=-1!==e.indexOf("//")?e.substr(e.indexOf("//")+2):e).replace(/\/+$/,"")}getUrl(){let e=this.model.get(this.name);return e&&""!==e?e=-1===e.indexOf("//")?this.defaultProtocol+"//"+e:e:e}validateValid(){var e=this.model.get(this.name);if(!e)return!1;var t=this.getMetadata().get(["app","regExpPatterns","uriOptionalProtocol","pattern"]);let i=new RegExp("^"+t+"$");if(i.test(e))return!1;t=this.translate("fieldInvalid","messages").replace("{field}",this.translate(this.name,"fields",this.entityType));return this.showValidationMessage(t),!0}validateMaxLength(){var e=this.params.maxLength||this.DEFAULT_MAX_LENGTH,t=this.model.get(this.name);if(!t||!t.length)return!1;if(t.length<=e)return!1;t=this.translate("fieldUrlExceedsMaxLength","messages").replace("{maxLength}",e).replace("{field}",this.translate(this.name,"fields",this.entityType));return this.showValidationMessage(t),!0}fetch(){let e=super.fetch();var t=e[this.name];return t&&(e[this.name]=this.parse(t)),e}}e.default=s}),define("views/fields/url-multiple",["exports","views/fields/array"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="urlMultiple";maxItemLength=255;displayAsList=!0;defaultProtocol="https:";setup(){super.setup(),this.noEmptyString=!0,this.params.pattern="$uriOptionalProtocol"}addValueFromUi(e){e=e.trim(),(e=this.params.strip?this.strip(e):e)===decodeURI(e)&&(e=encodeURI(e)),super.addValueFromUi(e)}strip(e){return e=(e=-1!==e.indexOf("//")?e.substring(e.indexOf("//")+2):e).replace(/\/+$/,"")}prepareUrl(e){return e=-1===e.indexOf("//")?this.defaultProtocol+"//"+e:e}getValueForDisplay(){let e=this.selected.map(e=>$("<a>").attr("href",this.prepareUrl(e)).attr("target","_blank").text(decodeURI(e)));return e.map(e=>$("<div>").addClass("multi-enum-item-container").append(e).get(0).outerHTML).join("")}getItemHtml(e){var t=super.getItemHtml(e);let i=$(t);return i.find("span.text").html($("<a>").attr("href",this.prepareUrl(e)).css("user-drag","none").attr("target","_blank").text(decodeURI(e))),i.get(0).outerHTML}}e.default=s}),define("views/fields/text",["exports","views/fields/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="text";listTemplate="fields/text/list";detailTemplate="fields/text/detail";editTemplate="fields/text/edit";searchTemplate="fields/text/search";seeMoreText=!1;rowsDefault=10;rowsMin=2;seeMoreDisabled=!1;cutHeight=200;noResize=!1;changeInterval=5;searchTypeList=["contains","startsWith","equals","endsWith","like","notContains","notLike","isEmpty","isNotEmpty"];events={'click a[data-action="seeMoreText"]':function(){this.seeMoreText=!0,this.reRender()},'click [data-action="mailTo"]':function(e){this.mailTo($(e.currentTarget).data("email-address"))}};setup(){super.setup(),this.params.rows=this.params.rows||this.rowsDefault,this.noResize=this.options.noResize||this.params.noResize||this.noResize,this.seeMoreDisabled=this.seeMoreDisabled||this.params.seeMoreDisabled,this.autoHeightDisabled=this.options.autoHeightDisabled||this.params.autoHeightDisabled||this.autoHeightDisabled,this.params.cutHeight&&(this.cutHeight=this.params.cutHeight),this.rowsMin=this.options.rowsMin||this.params.rowsMin||this.rowsMin,this.params.rows<this.rowsMin&&(this.rowsMin=this.params.rows),this.on("remove",()=>{$(window).off("resize.see-more-"+this.cid)})}setupSearch(){this.events["change select.search-type"]=e=>{e=$(e.currentTarget).val();this.handleSearchType(e)}}data(){let e=super.data();return null!==this.model.get(this.name)&&""!==this.model.get(this.name)&&this.model.has(this.name)&&(e.isNotEmpty=!0),this.mode===this.MODE_SEARCH&&"string"==typeof this.searchParams.value&&(this.searchData.value=this.searchParams.value),this.mode===this.MODE_EDIT&&(this.autoHeightDisabled?e.rows=this.params.rows:e.rows=this.rowsMin),e.valueIsSet=this.model.has(this.name),this.isReadMode()&&(e.isCut=this.isCut(),e.isCut&&(e.cutHeight=this.cutHeight),e.displayRawText=this.params.displayRawText),e.noResize=this.noResize,e}handleSearchType(e){~["isEmpty","isNotEmpty"].indexOf(e)?this.$el.find("input.main-element").addClass("hidden"):this.$el.find("input.main-element").removeClass("hidden")}getValueForDisplay(){return this.model.get(this.name)||""}controlTextareaHeight(e){var t=this.$element.prop("scrollHeight"),i=this.$element.prop("clientHeight");if(void 0!==e||0!==i){if(i!==e){if(i+1<t){e=this.$element.prop("rows");if(this.params.rows&&e>=this.params.rows)return;this.$element.attr("rows",e+1),this.controlTextareaHeight(i)}0===this.$element.val().length&&this.$element.attr("rows",this.rowsMin)}}else setTimeout(this.controlTextareaHeight.bind(this),10)}isCut(){return!this.seeMoreText&&!this.seeMoreDisabled}controlSeeMore(){this.isCut()&&(this.$text.height()>this.cutHeight?(this.$seeMoreContainer.removeClass("hidden"),this.$textContainer.addClass("cut")):(this.$seeMoreContainer.addClass("hidden"),this.$textContainer.removeClass("cut")))}afterRender(){var e;if(super.afterRender(),this.isReadMode()&&($(window).off("resize.see-more-"+this.cid),this.$textContainer=this.$el.find("> .complex-text-container"),this.$text=this.$textContainer.find("> .complex-text"),this.$seeMoreContainer=this.$el.find("> .see-more-container"),this.isCut()&&(this.controlSeeMore(),this.model.get(this.name)&&0===this.$text.height()&&(this.$textContainer.addClass("cut"),setTimeout(this.controlSeeMore.bind(this),50)),this.listenTo(this.recordHelper,"panel-show",()=>this.controlSeeMore()),this.on("panel-show-propagated",()=>this.controlSeeMore()),$(window).on("resize.see-more-"+this.cid,()=>{this.controlSeeMore()}))),this.mode!==this.MODE_EDIT||(e=this.getValueForDisplay())&&this.$element.val(e),this.mode===this.MODE_SEARCH&&(e=this.$el.find("select.search-type").val(),this.handleSearchType(e),this.$el.find("select.search-type").on("change",()=>{this.trigger("change")}),this.$element.on("input",()=>{this.trigger("change")})),this.mode===this.MODE_EDIT&&!this.autoHeightDisabled){this.controlTextareaHeight(),this.$element.on("input",()=>{this.controlTextareaHeight()});let e=new Date;const t=1e3*this.changeInterval;this.$element.on("keydown",()=>{Date.now()-e>t&&(this.trigger("change"),e=Date.now())})}}fetch(){let e={},t=this.$element.val()||null;return t&&""===t.trim()&&(t=""),e[this.name]=t,e}fetchSearch(){var e=this.fetchSearchType()||"startsWith";if("isEmpty"===e)return{type:"or",value:[{type:"isNull",field:this.name},{type:"equals",field:this.name,value:""}],data:{type:e}};if("isNotEmpty"===e)return{type:"and",value:[{type:"notEquals",field:this.name,value:""},{type:"isNotNull",field:this.name,value:null}],data:{type:e}};var t=this.$element.val().toString().trim();return!!t&&{value:t,type:e}}getSearchType(){return this.getSearchParamsData().type||this.searchParams.typeFront||this.searchParams.type}mailTo(e){let i={status:"Draft",to:e};this.getConfig().get("emailForceUseExternalClient")||this.getPreferences().get("emailUseExternalClient")||!this.getAcl().checkScope("Email","create")?Espo.loader.require("email-helper",e=>{let t=new e;document.location.href=t.composeMailToLink(i,this.getConfig().get("outboundEmailBccAddress"))}):(e=this.getMetadata().get("clientDefs."+this.scope+".modalViews.compose")||"views/modals/compose-email",Espo.Ui.notify(" ... "),this.createView("quickCreate",e,{attributes:i},e=>{e.render(),e.notify(!1)}))}}e.default=s}),define("views/fields/range-float",["exports","views/fields/range-int","views/fields/float"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{type="rangeFloat";validations=["required","float","range","order"];decimalPlacesRawValue=10;setupAutoNumericOptions(){this.autoNumericOptions={digitGroupSeparator:this.thousandSeparator||"",decimalCharacter:this.decimalMark,modifyValueOnWheel:!1,selectOnFocus:!1,decimalPlaces:this.decimalPlacesRawValue,decimalPlacesRawValue:this.decimalPlacesRawValue,allowDecimalPadding:!1,showWarnings:!1,formulaMode:!0}}validateFloat(){var e=e=>{var t;if(isNaN(this.model.get(e)))return t=this.translate("fieldShouldBeFloat","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(t,'[data-name="'+e+'"]'),!0};let t=!1;return t=e(this.fromField)||t,t=e(this.toField)||t}parse(e){return i.default.prototype.parse.call(this,e)}formatNumber(e){return i.default.prototype.formatNumberDetail.call(this,e)}}e.default=a}),define("views/fields/phone",["exports","views/fields/varchar","ui/select"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{type="phone";editTemplate="fields/phone/edit";detailTemplate="fields/phone/detail";listTemplate="fields/phone/list";validations=["required","phoneData"];events={'click [data-action="switchPhoneProperty"]':function(e){let t=$(e.currentTarget),i=$(e.currentTarget).closest("div.phone-number-block");"primary"===t.data("property-type")?t.hasClass("active")||""!==i.find("input.phone-number").val()&&(this.$el.find('button.phone-property[data-property-type="primary"]').removeClass("active").children().addClass("text-muted"),t.addClass("active").children().removeClass("text-muted")):t.hasClass("active")?t.removeClass("active").children().addClass("text-muted"):t.addClass("active").children().removeClass("text-muted"),this.trigger("change")},'click [data-action="removePhoneNumber"]':function(e){e=$(e.currentTarget).closest("div.phone-number-block");this.removePhoneNumber(e),this.trigger("change");let t=this.$el.find(".phone-number").last();t.length&&t[0].focus({preventScroll:!0})},"change input.phone-number":function(e){let t=$(e.currentTarget);e=t.closest("div.phone-number-block");this._itemJustRemoved||(""===t.val()&&e.length?this.removePhoneNumber(e):this.trigger("change"),this.manageAddButton())},"keypress input.phone-number":function(){this.manageAddButton()},"paste input.phone-number":function(){setTimeout(()=>this.manageAddButton(),10)},'click [data-action="addPhoneNumber"]':function(){this.addPhoneNumber()},"keydown input.phone-number":function(e){var t=Espo.Utils.getKeyFromKeyEvent(e);let i=$(e.currentTarget);"Enter"!==t?"Backspace"===t&&""===i.val()&&(t=i.closest("div.phone-number-block"),this._itemJustRemoved=!0,setTimeout(()=>this._itemJustRemoved=!1,100),e.stopPropagation(),this.removePhoneNumber(t),setTimeout(()=>this.focusOnLast(!0),50)):this.$el.find('[data-action="addPhoneNumber"]').hasClass("disabled")||(this.addPhoneNumber(),e.stopPropagation())}};validateRequired(){var e;if(this.isRequired())return this.model.get(this.name)?void 0:(e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e,"div.phone-number-block:nth-child(1) input.phone-number"),!0)}validatePhoneData(){let e=this.model.get(this.dataFieldName);if(e&&e.length){var t="^"+this.getMetadata().get(["app","regExpPatterns","phoneNumberLoose","pattern"])+"$";let s=new RegExp(t),a=[],l=!1;return e.forEach((e,t)=>{var e=e.phoneNumber,i=(s.test(e)||(l=!0,i=this.translate("fieldPhoneInvalidCharacters","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(i,"div.phone-number-block:nth-child("+(t+1).toString()+") input.phone-number")),String(e).replace(/[\s+]/g,""));if(~a.indexOf(i))return e=this.translate("fieldValueDuplicate","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e,"div.phone-number-block:nth-child("+(t+1).toString()+") input.phone-number"),void(l=!0);a.push(i)}),!!l||void 0}}data(){let i;if(this.mode===this.MODE_EDIT){if(i=Espo.Utils.cloneDeep(this.model.get(this.dataFieldName)),(this.model.isNew()||!this.model.get(this.name))&&(!i||!i.length)){let e;e=this.model.isNew()?this.phoneNumberOptedOutByDefault&&"User"!==this.model.entityType:this.model.get(this.isOptedOutFieldName),i=[{phoneNumber:this.model.get(this.name)||"",primary:!0,type:this.defaultType,optOut:e,invalid:!1}]}}else i=this.model.get(this.dataFieldName)||!1;if(i&&(i=Espo.Utils.cloneDeep(i)).forEach(e=>{let t=e.phoneNumber||"";e.erased=0===t.indexOf(this.erasedPlaceholder),e.erased||(e.valueForLink=t.replace(/ /g,"")),e.lineThrough=e.optOut||e.invalid||this.model.get("doNotCall")}),(!i||0===i.length)&&this.model.get(this.name)){let e=this.model.get(this.name),t={phoneNumber:e,primary:!0,valueForLink:e.replace(/ /g,"")};"edit"===this.mode&&this.model.isNew()&&(t.type=this.defaultType),i=[t]}let e={...super.data(),phoneNumberData:i,doNotCall:this.model.get("doNotCall"),lineThrough:this.model.get("doNotCall")||this.model.get(this.isOptedOutFieldName)};return this.isReadMode()&&(e.isOptedOut=this.model.get(this.isOptedOutFieldName),e.isInvalid=this.model.get(this.isInvalidFieldName),this.model.get(this.name)&&(e.isErased=0===this.model.get(this.name).indexOf(this.erasedPlaceholder),e.isErased||(e.valueForLink=this.model.get(this.name).replace(/ /g,""))),e.valueIsSet=this.model.has(this.name)),e.itemMaxLength=this.itemMaxLength,e}focusOnLast(e){let t=this.$el.find("input.form-control").last();t.focus(),e&&t[0]&&t[0].setSelectionRange(t[0].value.length,t[0].value.length)}removePhoneNumber(e){1===e.parent().children().length?e.find("input.phone-number").val(""):this.removePhoneNumberBlock(e),this.trigger("change")}addPhoneNumber(){let e=Espo.Utils.cloneDeep(this.fetchPhoneNumberData());var t={phoneNumber:"",primary:!e.length,type:!1,optOut:this.emailAddressOptedOutByDefault,invalid:!1};e.push(t),this.model.set(this.dataFieldName,e,{silent:!0}),this.reRender().then(()=>this.focusOnLast())}afterRender(){super.afterRender(),this.manageButtonsVisibility(),this.manageAddButton(),this.mode===this.MODE_EDIT&&this.$el.find("select").toArray().forEach(e=>{i.default.init($(e))})}removePhoneNumberBlock(e){let t=!1;e.find('button[data-property-type="primary"]').hasClass("active")&&(t=!0),e.remove(),t&&this.$el.find('button[data-property-type="primary"]').first().addClass("active").children().removeClass("text-muted"),this.manageButtonsVisibility(),this.manageAddButton()}manageAddButton(){let e=this.$el.find("input.phone-number"),i=0;e.each((e,t)=>{""!==t.value&&i++}),i!==e.length?this.$el.find('[data-action="addPhoneNumber"]').addClass("disabled").attr("disabled","disabled"):this.$el.find('[data-action="addPhoneNumber"]').removeClass("disabled").removeAttr("disabled")}manageButtonsVisibility(){let e=this.$el.find('button[data-property-type="primary"]'),t=this.$el.find('button[data-action="removePhoneNumber"]'),i=this.$el.find(".phone-number-block-container");if(1<e.length)return e.removeClass("hidden"),t.removeClass("hidden"),void i.addClass("many");i.removeClass("many"),e.addClass("hidden"),t.addClass("hidden")}setup(){this.dataFieldName=this.name+"Data",this.defaultType=this.defaultType||this.getMetadata().get("entityDefs."+this.model.entityType+".fields."+this.name+".defaultType"),this.isOptedOutFieldName=this.name+"IsOptedOut",this.isInvalidFieldName=this.name+"IsInvalid",this.phoneNumberOptedOutByDefault=this.getConfig().get("phoneNumberIsOptedOutByDefault"),this.model.has("doNotCall")&&this.listenTo(this.model,"change:doNotCall",(e,t,i)=>{"detail"!==this.mode&&"list"!==this.mode||i.ui&&this.reRender()}),this.erasedPlaceholder="ERASED:",this.itemMaxLength=this.getMetadata().get(["entityDefs","PhoneNumber","fields","name","maxLength"])}fetchPhoneNumberData(){let a=[],e=this.$el.find("div.phone-number-block");return e.length&&e.each((e,t)=>{let i={},s=$(t);i.phoneNumber=s.find("input.phone-number").val().trim(),""!==i.phoneNumber&&(i.primary=s.find('button[data-property-type="primary"]').hasClass("active"),i.type=s.find('select[data-property-type="type"]').val(),i.optOut=s.find('button[data-property-type="optOut"]').hasClass("active"),i.invalid=s.find('button[data-property-type="invalid"]').hasClass("active"),a.push(i))}),a}fetch(){let i={},e=this.fetchPhoneNumberData()||[],s=(i[this.dataFieldName]=e,i[this.name]=null,i[this.isOptedOutFieldName]=!1,i[this.isInvalidFieldName]=!1,0);var t;return e.forEach((e,t)=>{e.primary&&(s=t,e.optOut&&(i[this.isOptedOutFieldName]=!0),e.invalid&&(i[this.isInvalidFieldName]=!0))}),e.length&&0<s&&(t=e[0],e[0]=e[s],e[s]=t),e.length?i[this.name]=e[0].phoneNumber:(i[this.isOptedOutFieldName]=null,i[this.isInvalidFieldName]=null),i}}e.default=a}),define("views/fields/multi-enum",["exports","views/fields/array","helpers/reg-exp-pattern","ui/multi-select"],function(e,t,s,l){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s),l=i(l);class a extends t.default{type="multiEnum";listTemplate="fields/array/list";detailTemplate="fields/array/detail";editTemplate="fields/multi-enum/edit";MAX_ITEM_LENGTH=100;restoreOnBackspace=!1;validationElementSelector=".selectize-control";events={};data(){return{...super.data(),optionList:this.params.options||[]}}getTranslatedOptions(){return(this.params.options||[]).map(e=>null!==this.translatedOptions&&e in this.translatedOptions?this.translatedOptions[e]:e)}translateValueToEditLabel(e){let t=e;return~(this.params.options||[]).indexOf(e)&&(t=this.getLanguage().translateOption(e,this.name,this.scope)),t=""===(t=this.translatedOptions&&e in this.translatedOptions?this.translatedOptions[e]:t)?this.translate("None"):t}afterRender(){if(this.isSearchMode())this.renderSearch();else if(this.isEditMode()){this.$element=this.$el.find('[data-name="'+this.name+'"]');let i=[],t=Espo.Utils.clone(this.selected);for(var s in t){let e=t[s];var a=e;""===e&&(e=t[s]="__emptystring__"),~(this.params.options||[]).indexOf(e)||i.push({value:e,text:this.translateValueToEditLabel(a)})}this.$element.val(t.join(this.itemDelimiter)),(this.params.options||[]).forEach(e=>{var t=e;""===e&&(e="__emptystring__"),i.push({value:e,text:this.translateValueToEditLabel(t)})});var e={items:i,delimiter:this.itemDelimiter,matchAnyWord:this.matchAnyWord,draggable:!0,allowCustomOptions:this.allowCustomOptions,restoreOnBackspace:this.restoreOnBackspace,create:e=>this.createCustomOptionCallback(e)};l.default.init(this.$element,e),this.$element.on("change",()=>{this.trigger("change")})}}createCustomOptionCallback(t){if(t.length>this.MAX_ITEM_LENGTH)return i=this.translate("arrayItemMaxLength","messages").replace("{max}",this.MAX_ITEM_LENGTH.toString()),this.showValidationMessage(i,".selectize-control"),null;if(this.params.pattern){let e=new s.default(this.getMetadata(),this.getLanguage());var i=e.validate(this.params.pattern,t,this.name,this.entityType);if(i)return this.showValidationMessage(i.message,".selectize-control"),null}return{value:t,text:t}}focusOnInlineEdit(){l.default.focus(this.$element)}fetch(){let e=this.$element.val().split(this.itemDelimiter);for(var t in e=1===e.length&&""===e[0]?[]:e)"__emptystring__"===e[t]&&(e[t]="");this.params.isSorted&&this.translatedOptions&&(e=e.sort((e,t)=>(this.translatedOptions[e]||e).localeCompare(this.translatedOptions[t]||t)));let i={};return i[this.name]=e,i}validateRequired(){var e;if(this.isRequired())return e=this.model.get(this.name),e&&0!==e.length?void 0:(e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e,".selectize-control"),!0)}validateMaxCount(){var e;if(this.params.maxCount)return(this.model.get(this.name)||[]).length>this.params.maxCount?(e=this.translate("fieldExceedsMaxCount","messages").replace("{field}",this.getLabelText()).replace("{maxCount}",this.params.maxCount.toString()),this.showValidationMessage(e,".selectize-control"),!0):void 0}}e.default=a}),define("views/fields/link-multiple-with-primary",["exports","views/fields/link-multiple"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{primaryLink;switchPrimary(e){let t=this.$el.find(`[data-id="${e}"][data-action="switchPrimary"]`);t.hasClass("active")||(this.$el.find('button[data-action="switchPrimary"]').removeClass("active").children().addClass("text-muted"),t.addClass("active").children().removeClass("text-muted"),this.setPrimaryId(e))}getAttributeList(){const e=super.getAttributeList();return e.push(this.primaryIdAttribute),e.push(this.primaryNameAttribute),e}setup(){this.primaryLink=this.options.primaryLink||this.primaryLink||this.model.getFieldParam(this.name,"primaryLink"),this.primaryIdAttribute=this.primaryLink+"Id",this.primaryNameAttribute=this.primaryLink+"Name",super.setup(),this.primaryId=this.model.get(this.primaryIdAttribute),this.primaryName=this.model.get(this.primaryNameAttribute),this.listenTo(this.model,"change:"+this.primaryIdAttribute,()=>{this.primaryId=this.model.get(this.primaryIdAttribute),this.primaryName=this.model.get(this.primaryNameAttribute)}),this.events['click [data-action="switchPrimary"]']=e=>{let t=$(e.currentTarget);e=t.data("id");this.switchPrimary(e)}}setPrimaryId(e){this.primaryId=e,this.primaryName=e?this.nameHash[e]:null,this.trigger("change")}renderLinks(){this.primaryId&&this.addLinkHtml(this.primaryId,this.primaryName),this.ids.forEach(e=>{e!==this.primaryId&&this.addLinkHtml(e,this.nameHash[e])})}getValueForDisplay(){if(this.isDetailMode()||this.isListMode()){let t=[];if(this.primaryId&&t.push(this.getDetailLinkHtml(this.primaryId,this.primaryName)),this.ids.length)return this.ids.forEach(e=>{e!==this.primaryId&&t.push(this.getDetailLinkHtml(e))}),t.map(e=>$("<div>").append(e).get(0).outerHTML).join("")}}deleteLink(e){e===this.primaryId&&this.setPrimaryId(null),super.deleteLink(e)}deleteLinkHtml(e){super.deleteLinkHtml(e),this.managePrimaryButton()}addLinkHtml(e,t){if(t=t||e,this.isSearchMode())return super.addLinkHtml(e,t);let i=this.$el.find(".link-container"),s=$("<div>").addClass("form-inline clearfix ").addClass("list-group-item link-with-role link-group-item-with-primary").addClass("link-"+e).attr("data-id",e);var t=$("<div>").text(t).append("&nbsp;"),a=$("<a>").attr("role","button").attr("tabindex","0").attr("data-id",e).attr("data-action","clearLink").addClass("pull-right").append($("<span>").addClass("fas fa-times"));let l=$("<div>"),r=$("<div>");l.append(t),r.append(a),s.append(l),s.append(r);t=e===this.primaryId,a=$("<span>").addClass("fas fa-star fa-sm").addClass(t?"":"text-muted");let o=$("<button>").attr("type","button").addClass("btn btn-link btn-sm pull-right hidden").attr("title",this.translate("Primary")).attr("data-action","switchPrimary").attr("data-id",e).append(a);return o.insertBefore(s.children().first().children().first()),i.append(s),this.managePrimaryButton(),s}managePrimaryButton(){let t=this.$el.find('button[data-action="switchPrimary"]');if(1<t.length?t.removeClass("hidden"):t.addClass("hidden"),0===t.filter(".active").length){let e=t.first();e.length&&(e.addClass("active").children().removeClass("text-muted"),this.setPrimaryId(e.data("id")))}}fetch(){const e=super.fetch();return e[this.primaryIdAttribute]=this.primaryId,e[this.primaryNameAttribute]=this.primaryName,e}}e.default=s}),define("views/fields/link-multiple-with-columns",["exports","views/fields/link-multiple","helpers/reg-exp-pattern","ui/select"],function(e,t,o,d){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),o=i(o),d=i(d);class s extends t.default{COLUMN_TYPE_VARCHAR="varchar";COLUMN_TYPE_ENUM="enum";COLUMN_TYPE_BOOL="bool";setup(){super.setup();let e=this.columnsDefs||{},s=(this.validations.push("columnPattern"),this.columnsDefs={},this.columnsName=this.name+"Columns",this.columns=Espo.Utils.cloneDeep(this.model.get(this.columnsName)||{}),this.listenTo(this.model,"change:"+this.columnsName,()=>{this.columns=Espo.Utils.cloneDeep(this.model.get(this.columnsName)||{})}),this.getMetadata().get(["entityDefs",this.model.entityType,"fields",this.name,"columns"])||{});this.columnList=this.columnList||Object.keys(s),this.columnList.forEach(t=>{if(t in e)this.columnsDefs[t]=Espo.Utils.cloneDeep(e[t]);else if(t in s){var i=s[t];let e={};e.field=i,e.scope=this.foreignScope,!this.getMetadata().get(["entityDefs",this.foreignScope,"fields",i,"type"])&&this.getMetadata().get(["entityDefs",this.model.entityType,"fields",i,"type"])&&(e.scope=this.model.entityType);i=this.getMetadata().get(["entityDefs",e.scope,"fields",i])||{};e.type=i.type,e.type!==this.COLUMN_TYPE_ENUM&&e.type!==this.COLUMN_TYPE_VARCHAR||(e.options=i.options),"default"in i&&(e.default=i.default),"maxLength"in i&&(e.maxLength=i.maxLength),"pattern"in i&&(e.pattern=i.pattern),this.columnsDefs[t]=e}}),(this.isEditMode()||this.isDetailMode())&&(this.events['click a[data-action="toggleBoolColumn"]']=e=>{var t=$(e.currentTarget).data("id"),e=$(e.currentTarget).data("column");this.toggleBoolColumn(t,e)}),this.on("render",this.disposeColumnAutocompletes,this),this.once("remove",this.disposeColumnAutocompletes,this)}toggleBoolColumn(e,t){this.columns[e][t]=!this.columns[e][t],this.reRender()}getAttributeList(){return[...super.getAttributeList(),this.name+"Columns"]}getDetailLinkHtml(a,e){e=e||this.nameHash[a]||a;let l=$("<div>").append($("<a>").attr("href","#"+this.foreignScope+"/view/"+a).attr("data-id",a).text(e));return!this.isDetailMode()||(e=this.getIconHtml(a))&&l.prepend(e),this.columnList.forEach(e=>{var t=(this.columns[a]||{})[e]||"",i=this.columnsDefs[e].type,s=this.columnsDefs[e].field,e=this.columnsDefs[e].scope;""!==t&&t&&(i!==this.COLUMN_TYPE_ENUM&&i!==this.COLUMN_TYPE_VARCHAR||(i=i===this.COLUMN_TYPE_ENUM?this.getLanguage().translateOption(t,s,e):t,l.append($("<span>").text(" "),$("<span>").addClass("text-muted chevron-right"),$("<span>").text(" "),$("<span>").text(i).addClass("text-muted small"))))}),l.get(0).outerHTML}getValueForDisplay(){if(this.isDetailMode()||this.isListMode()){let t=[];return this.ids.forEach(e=>{t.push(this.getDetailLinkHtml(e))}),t.join("")}}deleteLink(e){this.trigger("delete-link",e),this.trigger("delete-link:"+e),this.deleteLinkHtml(e);var t=this.ids.indexOf(e);-1<t&&this.ids.splice(t,1),delete this.nameHash[e],delete this.columns[e],this.afterDeleteLink(e),this.trigger("change")}getColumnValue(e,t){return(this.columns[e]||{})[t]}addLink(t,e){~this.ids.indexOf(t)||(this.ids.push(t),this.nameHash[t]=e,this.columns[t]={},this.columnList.forEach(e=>{this.columns[t][e]=null,"default"in this.columnsDefs[e]&&(this.columns[t][e]=this.columnsDefs[e].default)}),this.addLinkHtml(t,e),this.afterAddLink(t),this.trigger("add-link",t),this.trigger("add-link:"+t)),this.trigger("change")}getJQSelect(e,t,s){let a=this.columnsDefs[e].field,l=this.columnsDefs[e].scope,i=this.columnsDefs[e].options||[],r=$("<select>").addClass("role form-control input-sm").attr("data-id",t).attr("data-column",e);return i.forEach(e=>{var t=this.getLanguage().translateOption(e,a,l);let i=$("<option>").val(e).text(t);e===(s||"")&&i.attr("selected","selected"),r.append(i)}),r}getJQInput(e,t,i){var s=this.columnsDefs[e].field,a=this.columnsDefs[e].scope,l=this.columnsDefs[e].maxLength,s=this.translate(s,"fields",a);let r=$("<input>").addClass("role form-control input-sm").attr("data-column",e).attr("placeholder",s).attr("data-id",t).attr("value",i||"");return l&&r.attr("maxlength",l),r}getJQLi(e,t,i){var s=this.columnsDefs[e].field,a=this.columnsDefs[e].scope,s=this.translate(s,"fields",a);return $("<li>").append($("<a>").attr("role","button").attr("tabindex","0").attr("data-action","toggleBoolColumn").attr("data-column",e).attr("data-id",t).append($("<span>").addClass("check-icon fas fa-check pull-right").addClass(i?"":"hidden")).append($("<div>").text(s)))}addLinkHtml(s,e){if(this.isSearchMode())return super.addLinkHtml(s,e);let t=this.$el.find(".link-container"),i=$("<div>").addClass("form-inline clearfix").addClass("list-group-item link-with-role link-group-item-with-columns").addClass("link-"+s);var a=$("<a>").attr("role","button").attr("tabindex","0").attr("data-id",s).attr("data-action","clearLink").addClass("pull-right").append($("<span>").addClass("fas fa-times")),e=$("<div>").addClass("link-item-name").text(e).append("&nbsp;");let l=[],r=[],o=(this.columnList.forEach(e=>{var t=(this.columns[s]||{})[e],i=this.columnsDefs[e].type;i!==this.COLUMN_TYPE_ENUM?i!==this.COLUMN_TYPE_VARCHAR?i===this.COLUMN_TYPE_BOOL&&r.push(this.getJQLi(e,s,t)):l.push(this.getJQInput(e,s,t)):l.push(this.getJQSelect(e,s,t))}),$("<div>")),n=$("<div>");if(l.forEach(e=>o.append($("<span>").addClass("link-item-column").addClass("link-item-column-"+e.get(0).tagName.toLowerCase()).append(e))),r.length){let t=$("<ul>").addClass("dropdown-menu");r.forEach(e=>t.append(e)),o.append($("<div>").addClass("btn-group pull-right").append($("<button>").attr("type","button").attr("data-toggle","dropdown").addClass("btn btn-link btn-sm dropdown-toggle").append($("<span>").addClass("caret"))).append(t))}return o.append(e),n.append(a),i.append(o),i.append(n),t.append(i),this.isEditMode()&&(l.forEach(e=>{"SELECT"===e.get(0).tagName&&d.default.init(e);let t=t=>{if(t&&t.length){var i=t.data("column");let e=t.val().toString().trim();t=t.data("id");""===e&&(e=null),this.columns[t]=this.columns[t]||{},this.columns[t][i]=e}};e.on("change",e=>{e=$(e.currentTarget);t(e),this.trigger("change")}),t(e)}),this.initAutocomplete(s)),i}initAutocomplete(s){this._autocompleteElementList||(this._autocompleteElementList=[]),this.columnList.forEach(t=>{if(this.columnsDefs[t].type===this.COLUMN_TYPE_VARCHAR){var i=this.columnsDefs[t].options;if(i&&i.length){let e=this.$el.find('[data-column="'+t+'"][data-id="'+s+'"]');e.length&&(e.autocomplete({minChars:0,lookup:i,maxHeight:200,beforeRender:e=>{e.addClass("small")},formatResult:e=>this.getHelper().escapeString(e.value),lookupFilter:(e,t,i)=>0===e.value.toLowerCase().indexOf(i)&&e.value.length!==i.length,onSelect:()=>{this.trigger("change"),e.trigger("change"),e.focus()}}),e.attr("autocomplete","espo-"+this.name+"-"+t+"-"+s),e.on("focus",()=>{e.val()||e.autocomplete("onValueChange")}),this._autocompleteElementList.push(e),this.once("delete-link:"+s,()=>{e.autocomplete("dispose")}))}}})}disposeColumnAutocompletes(){this._autocompleteElementList&&this._autocompleteElementList.length&&(this._autocompleteElementList.forEach(e=>{e.autocomplete("dispose")}),this._autocompleteElementList=[])}validateColumnPattern(){let e=!1;var t;for(t of this.columnList.filter(e=>this.columnsDefs[e].type===this.COLUMN_TYPE_VARCHAR).filter(e=>this.columnsDefs[e].pattern))for(var i of this.ids){var s=this.getColumnValue(i,t);s&&this.validateColumnPatternValue(i,t,s)&&(e=!0)}return e}validateColumnPatternValue(e,t,i){var s=this.columnsDefs[t].pattern,a=this.columnsDefs[t].field,l=this.columnsDefs[t].scope;let r=new o.default(this.getMetadata(),this.getLanguage());s=r.validate(s,i,a,l);return!!s&&(this.showValidationMessage(s.message,'[data-column="'+t+'"][data-id="'+e+'"]'),!0)}fetch(){let e=super.fetch();return e[this.columnsName]=Espo.Utils.cloneDeep(this.columns),e}}e.default=s}),define("views/fields/foreign-array",["exports","views/fields/array"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="foreign";setupOptions(){this.params.options=[];let o=this.params.field;var e=this.params.link;if(o&&e){let r=this.getMetadata().get(["entityDefs",this.model.entityType,"links",e,"entity"]);if(r){let{optionsPath:e,translation:t,options:i,isSorted:s,displayAsLabel:a,style:l}=this.getMetadata().get(["entityDefs",r,"fields",o]);i=e?this.getMetadata().get(e):i,this.params.options=Espo.Utils.clone(i)||[],this.params.translation=t,this.params.isSorted=s||!1,this.params.displayAsLabel=a||!1,this.styleMap=l||{},this.translatedOptions=Object.fromEntries(this.params.options.map(e=>[e,this.getLanguage().translateOption(e,o,r)]))}}}}e.default=s}),define("views/fields/file",["exports","views/fields/link","helpers/file-upload"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{type="file";listTemplate="fields/file/list";listLinkTemplate="fields/file/list";detailTemplate="fields/file/detail";editTemplate="fields/file/edit";showPreview=!1;accept=!1;defaultType=!1;previewSize="small";validations=["ready","required"];searchTypeList=["isNotEmpty","isEmpty"];ROW_HEIGHT=37;events={"click a.remove-attachment":function(e){let t=$(e.currentTarget).parent();this.deleteAttachment(),t.parent().remove(),this.$el.find("input.file").val(null),setTimeout(()=>this.focusOnUploadButton(),10)},"change input.file":function(e){let t=$(e.currentTarget);var i=e.currentTarget.files;i.length&&(this.uploadFile(i[0]),e.target.value=null,t.replaceWith(t.clone(!0)))},'click a[data-action="showImagePreview"]':function(e){e.preventDefault();e=this.model.get(this.idName);this.createView("preview","views/modals/image-preview",{id:e,model:this.model,name:this.model.get(this.nameName)},e=>{e.render()})},'click a.action[data-action="insertFromSource"]':function(e){e=$(e.currentTarget).data("name");this.insertFromSource(e)},"keydown label.attach-file-label":function(e){"Enter"===Espo.Utils.getKeyFromKeyEvent(e)&&this.$el.find("input.file").get(0).click()}};data(){let e={...super.data(),id:this.model.get(this.idName),acceptAttribute:this.acceptAttribute};return this.mode===this.MODE_EDIT&&(e.sourceList=this.sourceList),e.valueIsSet=this.model.has(this.idName),e}showValidationMessage(e,t){let i=this.$el.find("label");var s=i.attr("title");i.attr("title",""),super.showValidationMessage(e,t),i.attr("title",s)}validateRequired(){if(this.isRequired()&&null==this.model.get(this.idName)){var t=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText());let e;return e=this.isUploading?this.$el.find(".gray-box"):this.$el.find(".attachment-button label"),this.showValidationMessage(t,e),!0}}validateReady(){var e,t;if(this.isUploading)return e=this.$el.find(".gray-box"),t=this.translate("fieldIsUploading","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(t,e),!0}setup(){this.nameName=this.name+"Name",this.idName=this.name+"Id",this.typeName=this.name+"Type",this.foreignScope="Attachment",this.previewSize=this.options.previewSize||this.params.previewSize||this.previewSize,this.previewTypeList=this.getMetadata().get(["app","image","previewFileTypeList"])||[],this.imageSizes=this.getMetadata().get(["app","image","sizes"])||{};let i=this.getMetadata().get(["clientDefs","Attachment","sourceDefs"])||{};this.sourceList=Espo.Utils.clone(this.params.sourceList||[]),this.sourceList=this.sourceList.concat(this.getMetadata().get(["clientDefs","Attachment","generalSourceList"])||[]).filter((e,t,i)=>i.indexOf(e)===t).filter(e=>{let t=i[e]||{};if(t.accessDataList&&!Espo.Utils.checkAccessDataList(t.accessDataList,this.getAcl(),this.getUser()))return!1;if(t.configCheck){e=t.configCheck.split(".");if(!this.getConfig().getByPath(e))return!1}return!0}),"showPreview"in this.params&&(this.showPreview=this.params.showPreview),"accept"in this.params&&(this.accept=this.params.accept),this.accept&&this.accept.length&&(this.acceptAttribute=this.accept.join(", ")),this.on("remove",()=>{this.resizeIsBeingListened&&$(window).off("resize."+this.cid)}),this.on("inline-edit-off",()=>{this.isUploading=!1})}afterRender(){var e,t,i;this.mode===this.MODE_EDIT&&(this.$attachment=this.$el.find("div.attachment"),i=this.model.get(this.nameName),e=this.model.get(this.typeName)||this.defaultType,(t=this.model.get(this.idName))&&this.addAttachmentBox(i,e,t),this.$el.off("drop"),this.$el.off("dragover"),this.$el.off("dragleave"),this.$el.on("drop",e=>{e.preventDefault(),e.stopPropagation(),(event=e.originalEvent).dataTransfer&&event.dataTransfer.files&&event.dataTransfer.files.length&&this.uploadFile(event.dataTransfer.files[0])}),this.$el.on("dragover",e=>{e.preventDefault()}),this.$el.on("dragleave",e=>{e.preventDefault()})),this.mode===this.MODE_SEARCH&&(i=this.$el.find("select.search-type").val(),this.handleSearchType(i)),this.mode===this.MODE_DETAIL&&"large"===this.previewSize&&(this.handleResize(),this.resizeIsBeingListened=!0,$(window).on("resize."+this.cid,()=>{this.handleResize()}))}focusOnInlineEdit(){this.focusOnUploadButton()}focusOnUploadButton(){let e=this.$el.find(".attach-file-label");e.length&&e.focus()}handleResize(){var e=this.$el.width();this.$el.find("img.image-preview").css("maxWidth",e+"px")}getDetailPreview(e,t,i){if(!~this.previewTypeList.indexOf(t))return e;let s=this.previewSize;this.isListMode()&&(s=this.params.listPreviewSize||"small");t=this.getBasePath()+"?entryPoint=image&size="+s+"&id="+i;let a=(this.imageSizes[s]||{})[1];this.isListMode()&&!this.params.listPreviewSize&&(a=this.ROW_HEIGHT+"px");var l,t=$("<img>").attr("src",t).addClass("image-preview").css({maxWidth:(this.imageSizes[s]||{})[0],maxHeight:a});return this.mode===this.MODE_LIST_LINK?(l="#"+this.model.entityType+"/view/"+this.model.id,$("<a>").attr("href",l).append(t).get(0).outerHTML):$("<a>").attr("data-action","showImagePreview").attr("data-id",i).attr("title",e).attr("href",this.getImageUrl(i)).append(t).get(0).outerHTML}getEditPreview(e,t,i){return~this.previewTypeList.indexOf(t)?$("<img>").attr("src",this.getImageUrl(i,"small")).attr("title",e).attr("draggable",!1).css({maxWidth:(this.imageSizes[this.previewSize]||{})[0],maxHeight:(this.imageSizes[this.previewSize]||{})[1]}).get(0).outerHTML:null}getValueForDisplay(){if(!this.isDetailMode()&&!this.isListMode())return"";var i=this.model.get(this.nameName),s=this.model.get(this.typeName)||this.defaultType,a=this.model.get(this.idName);if(!a)return!1;if(this.showPreview&&~this.previewTypeList.indexOf(s)){let e="";this.isListMode()&&this.params.listPreviewSize&&(e+="no-shrink");s=$("<div>").addClass("attachment-preview").addClass(e).append(this.getDetailPreview(i,s,a));let t="attachment-block-container";return"large"===this.previewSize&&(t+=" attachment-block-container-large"),"small"===this.previewSize&&(t+=" attachment-block-container-small"),$("<div>").addClass(t).append($("<div>").addClass("attachment-block").append(s)).get(0).outerHTML}return $("<span>").append($("<span>").addClass("fas fa-paperclip text-soft small")," ",$("<a>").attr("href",this.getDownloadUrl(a)).attr("target","_BLANK").text(i)).get(0).innerHTML}getImageUrl(e,t){let i=this.getBasePath()+"?entryPoint=image&id="+e;return t&&(i+="&size="+t),this.getUser().get("portalId")&&(i+="&portalId="+this.getUser().get("portalId")),i}getDownloadUrl(e){let t=this.getBasePath()+"?entryPoint=download&id="+e;return this.getUser().get("portalId")&&(t+="&portalId="+this.getUser().get("portalId")),t}deleteAttachment(){let t=this.model.get(this.idName),e={};e[this.idName]=null,e[this.nameName]=null,this.model.set(e),this.$attachment.empty(),t&&this.model.isNew()&&this.getModelFactory().create("Attachment",e=>{e.id=t,e.destroy()})}setAttachment(e,t){let i={};i[this.idName]=e.id,i[this.nameName]=e.get("name"),this.model.set(i,{ui:t})}getMaxFileSize(){let e=this.params.maxFileSize||0;var t=!this.getConfig().get("attachmentUploadChunkSize"),i=this.getConfig().get("attachmentUploadMaxSize")||0,s=this.getHelper().getAppParam("maxUploadSize")||0;return(!e||e>i)&&(e=i),e=t&&e>s?s:e}uploadFile(t){let l=!1,e=!1;var i=this.getMaxFileSize();if(e=i&&t.size>1024*i*1024?!0:e)return i=this.translate("fieldMaxFileSizeError","messages").replace("{field}",this.getLabelText()).replace("{max}",i),void this.showValidationMessage(i,".attachment-button label");this.isUploading=!0;let r=new s.default(this.getConfig());this.getModelFactory().create("Attachment",e=>{let i=this.addAttachmentBox(t.name,t.type),s=i.parent().find(".uploading-message"),a=(this.$el.find(".attachment-button").addClass("hidden"),{});i.find(".remove-attachment").on("click.uploading",()=>{l=!0,this.isUploading=!1,this.$el.find(".attachment-button").removeClass("hidden"),this.$el.find("input.file").val(null),a.isCanceled=!0}),e.set("role","Attachment"),e.set("relatedType",this.model.entityType),e.set("field",this.name),this.handleUploadingFile(t).then(t=>{r.upload(t,e,{afterChunkUpload:e=>{e=Math.floor(e/t.size*100)+"%";s.html(e)},afterAttachmentSave:e=>{i.attr("data-id",e.id)},mediator:a}).then(()=>{l||this.isUploading&&(this.setAttachment(e,!0),i.trigger("ready"),this.isUploading=!1,setTimeout(()=>{if(!document.activeElement||"BODY"===document.activeElement.tagName){let e=this.$el.find(".preview a");e.focus()}},50))}).catch(()=>{a.isCanceled||(i.remove(),this.$el.find(".uploading-message").remove(),this.$el.find(".attachment-button").removeClass("hidden"),this.isUploading=!1)})})})}handleUploadingFile(t){return new Promise(e=>e(t))}getBoxPreviewHtml(e,t,i){let s=$("<span>").text(e);if(!i)return s.get(0).outerHTML;if(this.showPreview){t=this.getEditPreview(e,t,i);if(t)return t}t=this.getBasePath()+"?entryPoint=download&id="+i;return $("<a>").attr("href",t).attr("target","_BLANK").text(e).get(0).outerHTML}addAttachmentBox(t,i,e){this.$attachment.empty();var s=$("<a>").attr("role","button").attr("tabindex","0").addClass("remove-attachment pull-right").append($("<span>").addClass("fas fa-times")),a=this.getBoxPreviewHtml(t,i,e);let l=$("<div>").addClass("gray-box").append(s).append($("<span>").addClass("preview").append(a)),r=$("<div>").append(l);if(this.$attachment.append(r),e)return l;let o=$("<span>").addClass("small uploading-message").text(this.translate("Uploading..."));return r.append(o),l.on("ready",()=>{var e=this.model.get(this.idName),e=this.getBoxPreviewHtml(t,i,e);l.find(".preview").html(e),o.html(this.translate("Ready")),l.find(".preview").find("img").length&&o.remove()}),l}insertFromSource(s){var a=this.getMetadata().get(["clientDefs","Attachment","sourceDefs",s,"insertModalView"])||this.getMetadata().get(["clientDefs",s,"modalViews","select"])||"views/modals/select-records";if(a){Espo.Ui.notify(" ... ");let e=null,t=("getSelectFilters"+s in this&&(e=this["getSelectFilters"+s](),this.model.get("parentId")&&"Account"===this.model.get("parentType")&&"link"===this.getMetadata().get(["entityDefs",s,"fields","account","type"])&&(e={account:{type:"equals",field:"accountId",value:this.model.get("parentId"),valueName:this.model.get("parentName")}})),this.getMetadata().get(["clientDefs","Attachment","sourceDefs",s,"boolFilterList"])),i=("getSelectBoolFilterList"+s in this&&(t=this["getSelectBoolFilterList"+s]()),this.getMetadata().get(["clientDefs","Attachment","sourceDefs",s,"primaryFilter"]));"getSelectPrimaryFilterName"+s in this&&(i=this["getSelectPrimaryFilterName"+s]()),this.createView("insertFromSource",a,{scope:s,createButton:!1,filters:e,boolFilterList:t,primaryFilterName:i,multiple:!1},e=>{e.render(),Espo.Ui.notify(!1),this.listenToOnce(e,"select",e=>{(e="[object Array]"!==Object.prototype.toString.call(e)?[e]:e).forEach(e=>{"Attachment"!==e.entityType?Espo.Ajax.postRequest(s+"/action/getAttachmentList",{id:e.id,field:this.name,relatedType:this.entityType}).then(e=>{e.forEach(t=>{this.getModelFactory().create("Attachment",e=>{e.set(t),this.setAttachment(e)})})}):this.setAttachment(e)})})})}}fetch(){let e={};return e[this.idName]=this.model.get(this.idName),e}}e.default=a}),define("views/fields/enum-int",["exports","views/fields/enum"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="enumInt";listTemplate="fields/enum/detail";detailTemplate="fields/enum/detail";editTemplate="fields/enum/edit";searchTemplate="fields/enum/search";validations=[];fetch(){var e=parseInt(this.$element.val());let t={};return t[this.name]=e,t}parseItemForSearch(e){return parseInt(e)}}e.default=s}),define("views/fields/email",["exports","views/fields/varchar"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="email";editTemplate="fields/email/edit";detailTemplate="fields/email/detail";listTemplate="fields/email/list";validations=["required","emailData"];events={'click [data-action="mailTo"]':function(e){this.mailTo($(e.currentTarget).data("email-address"))},'click [data-action="switchEmailProperty"]':function(e){let t=$(e.currentTarget),i=$(e.currentTarget).closest("div.email-address-block");"primary"===t.data("property-type")?t.hasClass("active")||""!==i.find("input.email-address").val()&&(this.$el.find('button.email-property[data-property-type="primary"]').removeClass("active").children().addClass("text-muted"),t.addClass("active").children().removeClass("text-muted")):t.hasClass("active")?t.removeClass("active").children().addClass("text-muted"):t.addClass("active").children().removeClass("text-muted"),this.trigger("change")},'click [data-action="removeEmailAddress"]':function(e){e=$(e.currentTarget).closest("div.email-address-block");this.removeEmailAddress(e);let t=this.$el.find(".email-address").last();t.length&&t[0].focus({preventScroll:!0})},"change input.email-address":function(e){let t=$(e.currentTarget);e=t.closest("div.email-address-block");this._itemJustRemoved||(""===t.val()&&e.length?this.removeEmailAddress(e):this.trigger("change"),this.trigger("change"),this.manageAddButton())},"keypress input.email-address":function(){this.manageAddButton()},"paste input.email-address":function(){setTimeout(()=>this.manageAddButton(),10)},'click [data-action="addEmailAddress"]':function(){this.addEmailAddress()},"keydown input.email-address":function(e){var t=Espo.Utils.getKeyFromKeyEvent(e);let i=$(e.currentTarget);"Enter"!==t?"Backspace"===t&&""===i.val()&&(t=i.closest("div.email-address-block"),this._itemJustRemoved=!0,setTimeout(()=>this._itemJustRemoved=!1,100),e.stopPropagation(),this.removeEmailAddress(t),setTimeout(()=>this.focusOnLast(!0),50)):this.$el.find('[data-action="addEmailAddress"]').hasClass("disabled")||(this.addEmailAddress(),e.stopPropagation())}};validateEmailData(){let e=this.model.get(this.dataFieldName);if(e&&e.length){let a=[],l=new RegExp(/^[-!#$%&'*+/=?^_`{|}~A-Za-z0-9]+(?:\.[-!#$%&'*+/=?^_`{|}~A-Za-z0-9]+)*/.source+/@([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])?\.)+[A-Za-z0-9][A-Za-z0-9-]*[A-Za-z0-9]/.source),r=!1;return e.forEach((e,t)=>{let i=e.emailAddress||"";var s,e=String(i).toLowerCase();return l.test(e)||0===i.indexOf(this.erasedPlaceholder)?~a.indexOf(e)?(s=this.translate("fieldValueDuplicate","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(s,"div.email-address-block:nth-child("+(t+1).toString()+") input"),void(r=!0)):void a.push(e):(s=this.translate("fieldShouldBeEmail","messages").replace("{field}",this.getLabelText()),this.reRender(),this.showValidationMessage(s,"div.email-address-block:nth-child("+(t+1).toString()+") input"),void(r=!0))}),!!r||void 0}}validateRequired(){var e;if(this.isRequired()&&!this.model.get(this.name))return e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e,"div.email-address-block:nth-child(1) input"),!0}data(){let t;if(this.mode===this.MODE_EDIT){if(t=Espo.Utils.clone(this.model.get(this.dataFieldName)),(this.model.isNew()||!this.model.get(this.name))&&(!t||!t.length)){let e;e=this.model.isNew()?this.emailAddressOptedOutByDefault&&"User"!==this.model.entityType:this.model.get(this.isOptedOutFieldName),t=[{emailAddress:this.model.get(this.name)||"",primary:!0,optOut:e,invalid:!1}]}}else t=this.model.get(this.dataFieldName)||!1;(t=t&&0!==t.length||!this.model.get(this.name)?t:[{emailAddress:this.model.get(this.name),primary:!0,optOut:!1,invalid:!1}])&&(t=Espo.Utils.cloneDeep(t)).forEach(e=>{let t=e.emailAddress||"";e.erased=0===t.indexOf(this.erasedPlaceholder),e.lineThrough=e.optOut||e.invalid});let e={...super.data(),emailAddressData:t};return this.isReadMode()&&(e.isOptedOut=this.model.get(this.isOptedOutFieldName),e.isInvalid=this.model.get(this.isInvalidFieldName),this.model.get(this.name)&&(e.isErased=0===this.model.get(this.name).indexOf(this.erasedPlaceholder)),e.valueIsSet=this.model.has(this.name)),e.itemMaxLength=this.itemMaxLength,e}getAutocompleteMaxCount(){return this.autocompleteMaxCount||this.getConfig().get("recordsPerPage")}focusOnLast(e){let t=this.$el.find("input.form-control").last();t.focus(),e&&t[0]}removeEmailAddress(e){1===e.parent().children().length?e.find("input.email-address").val(""):this.removeEmailAddressBlock(e),this.trigger("change")}addEmailAddress(){let e=Espo.Utils.cloneDeep(this.fetchEmailAddressData());var t={emailAddress:"",primary:!e.length,optOut:this.emailAddressOptedOutByDefault,invalid:!1,lower:""};e.push(t),this.model.set(this.dataFieldName,e,{silent:!0}),this.reRender().then(()=>this.focusOnLast())}removeEmailAddressBlock(e){let t=!1;e.find('button[data-property-type="primary"]').hasClass("active")&&(t=!0),e.remove(),t&&this.$el.find('button[data-property-type="primary"]').first().addClass("active").children().removeClass("text-muted"),this.manageButtonsVisibility(),this.manageAddButton()}afterRender(){super.afterRender(),this.manageButtonsVisibility(),this.manageAddButton(),this.mode===this.MODE_SEARCH&&this.getAcl().check("Email","create")&&this.$element.autocomplete({serviceUrl:()=>"EmailAddress/search?maxSize="+this.getAutocompleteMaxCount(),paramName:"q",minChars:1,autoSelectFirst:!0,triggerSelectOnValidInput:!1,formatResult:e=>this.getHelper().escapeString(e.name)+" &#60;"+this.getHelper().escapeString(e.id)+"&#62;",transformResult:e=>{e=JSON.parse(e);let t=[];return e.forEach(e=>{t.push({id:e.emailAddress,name:e.entityName,emailAddress:e.emailAddress,entityId:e.entityId,entityName:e.entityName,entityType:e.entityType,data:e.emailAddress,value:e.emailAddress})}),{suggestions:t}},onSelect:e=>{this.$element.val(e.emailAddress),this.$element.focus()}})}manageAddButton(){let e=this.$el.find("input.email-address"),i=0;e.each((e,t)=>{""!==t.value&&i++}),i!==e.length?this.$el.find('[data-action="addEmailAddress"]').addClass("disabled").attr("disabled","disabled"):this.$el.find('[data-action="addEmailAddress"]').removeClass("disabled").removeAttr("disabled")}manageButtonsVisibility(){let e=this.$el.find('button[data-property-type="primary"]'),t=this.$el.find('button[data-action="removeEmailAddress"]');1<e.length?(e.removeClass("hidden"),t.removeClass("hidden")):(e.addClass("hidden"),t.addClass("hidden"))}mailTo(e){let i={status:"Draft",to:e};var t=this.model.entityType;switch(t){case"Account":case"Lead":i.parentType=t,i.parentName=this.model.get("name"),i.parentId=this.model.id;break;case"Contact":this.getConfig().get("b2cMode")?(i.parentType="Contact",i.parentName=this.model.get("name"),i.parentId=this.model.id):this.model.get("accountId")&&(i.parentType="Account",i.parentName=this.model.get("accountName"),i.parentId=this.model.get("accountId"))}this.model.collection&&this.model.collection.parentModel&&this.checkParentTypeAvailability(this.model.collection.parentModel.entityType)&&(i.parentType=this.model.collection.parentModel.entityType,i.parentId=this.model.collection.parentModel.id,i.parentName=this.model.collection.parentModel.get("name")),i.parentId?i.parentType&&!this.checkParentTypeAvailability(i.parentType)&&(i.parentType=null,i.parentId=null,i.parentName=null):this.checkParentTypeAvailability(this.model.entityType)&&(i.parentType=this.model.entityType,i.parentId=this.model.id,i.parentName=this.model.get("name")),~["Contact","Lead","Account"].indexOf(this.model.entityType)&&(i.nameHash={},i.nameHash[e]=this.model.get("name")),this.getConfig().get("emailForceUseExternalClient")||this.getPreferences().get("emailUseExternalClient")||!this.getAcl().checkScope("Email","create")?Espo.loader.require("email-helper",e=>{let t=new e;document.location.href=t.composeMailToLink(i,this.getConfig().get("outboundEmailBccAddress"))}):(e=this.getMetadata().get("clientDefs."+this.scope+".modalViews.compose")||"views/modals/compose-email",Espo.Ui.notify(" ... "),this.createView("quickCreate",e,{attributes:i},e=>{e.render(),e.notify(!1)}))}checkParentTypeAvailability(e){return~(this.getMetadata().get(["entityDefs","Email","fields","parent","entityList"])||[]).indexOf(e)}setup(){this.dataFieldName=this.name+"Data",this.isOptedOutFieldName=this.name+"IsOptedOut",this.isInvalidFieldName=this.name+"IsInvalid",this.erasedPlaceholder="ERASED:",this.emailAddressOptedOutByDefault=this.getConfig().get("emailAddressIsOptedOutByDefault"),this.itemMaxLength=this.getMetadata().get(["entityDefs","EmailAddress","fields","name","maxLength"])||255}fetchEmailAddressData(){let a=[],e=this.$el.find("div.email-address-block");return e.length&&e.each((e,t)=>{let i={},s=$(t);i.emailAddress=s.find("input.email-address").val().trim(),""!==i.emailAddress&&(i.primary=s.find('button[data-property-type="primary"]').hasClass("active"),i.optOut=s.find('button[data-property-type="optOut"]').hasClass("active"),i.invalid=s.find('button[data-property-type="invalid"]').hasClass("active"),i.lower=i.emailAddress.toLowerCase(),a.push(i))}),a}fetch(){let i={},e=this.fetchEmailAddressData()||[],s=(i[this.dataFieldName]=e,i[this.name]=null,i[this.isOptedOutFieldName]=!1,i[this.isInvalidFieldName]=!1,0);var t;return e.forEach((e,t)=>{e.primary&&(s=t,e.optOut&&(i[this.isOptedOutFieldName]=!0),e.invalid&&(i[this.isInvalidFieldName]=!0))}),e.length&&0<s&&(t=e[0],e[0]=e[s],e[s]=t),e.length?i[this.name]=e[0].emailAddress:(i[this.isOptedOutFieldName]=null,i[this.isInvalidFieldName]=null),i}}e.default=s}),define("views/fields/datetime",["exports","views/fields/date","moment"],function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),n=i(n);class s extends t.default{type="datetime";editTemplate="fields/datetime/edit";validations=["required","datetime","after","before"];searchTypeList=["lastSevenDays","ever","isEmpty","currentMonth","lastMonth","nextMonth","currentQuarter","lastQuarter","currentYear","lastYear","today","past","future","lastXDays","nextXDays","olderThanXDays","afterXDays","on","after","before","between"];timeFormatMap={"HH:mm":"H:i","hh:mm A":"h:i A","hh:mm a":"h:i a","hh:mmA":"h:iA","hh:mma":"h:ia"};data(){let e=super.data();e.date=e.time="";var t=this.getDateTime().toDisplay(this.model.get(this.name));return t&&(t=this.splitDatetime(t),e.date=t[0],e.time=t[1]),e}getDateStringValue(){if(this.mode===this.MODE_DETAIL&&!this.model.has(this.name))return-1;var o=this.model.get(this.name);if(!o)return this.mode===this.MODE_EDIT|this.mode===this.MODE_SEARCH|this.mode===this.MODE_LIST||this.mode===this.MODE_LIST_LINK?"":null;if(this.mode!==this.MODE_LIST&&this.mode!==this.MODE_DETAIL&&this.mode!==this.MODE_LIST_LINK)return this.getDateTime().toDisplay(o);{if(this.getConfig().get("readableDateFormatDisabled")||this.params.useNumericFormat)return this.getDateTime().toDisplay(o);let e=this.getDateTime().timeFormat,t=(this.params.hasSeconds&&(e=e.replace(/:mm/,":mm:ss")),this.getDateTime().toMoment(o)),i=(0,n.default)().tz(this.getDateTime().timeZone||"UTC"),s=i.clone().startOf("day"),a=[s.unix(),s.add(1,"days").unix()],l=[s.unix(),s.add(1,"days").unix()],r=[s.add(-3,"days").unix(),s.add(1,"days").unix()];if(t.unix()>=a[0]&&t.unix()<a[1])return this.translate("Today")+" "+t.format(e);if(t.unix()>l[0]&&t.unix()<l[1])return this.translate("Tomorrow")+" "+t.format(e);if(t.unix()>r[0]&&t.unix()<r[1])return this.translate("Yesterday")+" "+t.format(e);o=this.getDateTime().getReadableDateFormat();return t.format("YYYY")===i.format("YYYY")?t.format(o)+" "+t.format(e):t.format(o+", YYYY")+" "+t.format(e)}}initTimepicker(){let e=this.$time;e.timepicker({step:this.params.minuteStep||30,scrollDefaultNow:!0,timeFormat:this.timeFormatMap[this.getDateTime().timeFormat]}),e.parent().find("button.time-picker-btn").on("click",()=>{e.timepicker("show")})}setDefaultTime(){var e=(0,n.default)("2014-01-01 00:00").format(this.getDateTime().getDateTimeFormat())||"",e=this.splitDatetime(e);2===e.length&&this.$time.val(e[1])}splitDatetime(e){let t=(0,n.default)(e,this.getDateTime().getDateTimeFormat());var i=t.format(this.getDateTime().getDateFormat());return[i,e.substr(i.length+1)]}setup(){super.setup(),this.on("remove",()=>this.destroyTimepicker()),this.on("mode-changed",()=>this.destroyTimepicker())}destroyTimepicker(){this.$time&&this.$time[0]&&this.$time.timepicker("remove")}afterRender(){if(super.afterRender(),this.mode===this.MODE_EDIT){this.$date=this.$element;let e=this.$time=this.$el.find("input.time-part"),t=(this.initTimepicker(),this.$element.on("change.datetime",()=>{this.$element.val()&&!e.val()&&(this.setDefaultTime(),this.trigger("change"))}),!1),i=!1,s=e.val();e.on("change",()=>{if(!t){if(i)return void e.val(s);if(this.noneOption&&""===e.val()&&""!==this.$date.val())return void e.val(this.noneOption);this.trigger("change"),s=e.val()}t=!0,setTimeout(()=>t=!1,100)}),e.on("timeFormatError",()=>{i=!0,setTimeout(()=>i=!1,50)})}}parse(e){return e?this.getDateTime().fromDisplay(e):null}fetch(){let e={};var t=this.$date.val(),i=this.$time.val();let s=null;return""!==t&&""!==i&&(s=this.parse(t+" "+i)),e[this.name]=s,e}validateDatetime(){var e;if(-1===this.model.get(this.name))return e=this.translate("fieldShouldBeDatetime","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0}fetchSearch(){let e=super.fetchSearch();return e&&(e.dateTime=!0),e}}e.default=s}),define("views/fields/currency-converted",["exports","views/fields/currency"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{data(){let e=super.data();var t=this.getConfig().get("defaultCurrency");return e.currencyValue=t,e.currencySymbol=this.getMetadata().get(["app","currency","symbolMap",t])||"",e}}e.default=s}),define("views/fields/checklist",["exports","views/fields/array"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="checklist";listTemplate="fields/array/list";detailTemplate="fields/checklist/detail";editTemplate="fields/checklist/edit";isInversed=!1;events={};data(){return{optionDataList:this.getOptionDataList(),...super.data()}}setup(){super.setup(),this.params.options=this.params.options||[],this.isInversed=this.params.isInversed||this.options.isInversed||this.isInversed}afterRender(){this.isSearchMode()&&this.renderSearch(),this.isEditMode()&&this.$el.find("input").on("change",()=>{this.trigger("change")})}getOptionDataList(){let a=this.model.get(this.name)||[],l=[];return this.params.options.forEach(e=>{let t=~a.indexOf(e);var i=e,s=this.cid+"-"+Espo.Utils.camelCaseToHyphen(e.replace(/\s+/g,"-"));this.isInversed&&(t=!t),l.push({name:e,isChecked:t,dataName:i,id:s,label:this.translatedOptions[e]||e})}),l}fetch(){let s=[],e=(this.params.options.forEach(e=>{let t=this.$el.find('input[data-name="'+e+'"]'),i=t.get(0)&&t.get(0).checked;(i=this.isInversed?!i:i)&&s.push(e)}),{});return e[this.name]=s,e}validateRequired(){var e;if(this.isRequired())return e=this.model.get(this.name),e&&0!==e.length?void 0:(e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e,".checklist-item-container:last-child input"),!0)}validateMaxCount(){var e;if(this.params.maxCount)return(this.model.get(this.name)||[]).length>this.params.maxCount?(e=this.translate("fieldExceedsMaxCount","messages").replace("{field}",this.getLabelText()).replace("{maxCount}",this.params.maxCount.toString()),this.showValidationMessage(e,".checklist-item-container:last-child input"),!0):void 0}}e.default=s}),define("views/fields/bool",["exports","views/fields/base","ui/select"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{type="bool";listTemplate="fields/bool/list";detailTemplate="fields/bool/detail";editTemplate="fields/bool/edit";searchTemplate="fields/bool/search";validations=[];initialSearchIsNotIdle=!0;data(){let e=super.data();return e.valueIsSet=this.model.has(this.name),e}afterRender(){super.afterRender(),this.mode===this.MODE_SEARCH&&(this.$element.on("change",()=>{this.trigger("change")}),i.default.init(this.$element))}fetch(){var e=this.$element.get(0).checked;let t={};return t[this.name]=e,t}fetchSearch(){var e=this.$element.val();return e?"any"===e?{type:"or",value:[{type:"isTrue",attribute:this.name},{type:"isFalse",attribute:this.name}],data:{type:e}}:{type:e,data:{type:e}}:null}getSearchType(){return this.getSearchParamsData().type||this.searchParams.type||"isTrue"}}e.default=a}),define("views/fields/attachment-multiple",["exports","views/fields/base","helpers/file-upload"],function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),a=i(a);class s extends t.default{type="attachmentMultiple";listTemplate="fields/attachments-multiple/list";detailTemplate="fields/attachments-multiple/detail";editTemplate="fields/attachments-multiple/edit";searchTemplate="fields/link-multiple/search";previewSize="medium";nameHashName=null;idsName=null;nameHash=null;foreignScope=null;showPreviews=!0;accept=null;validations=["ready","required"];searchTypeList=["isNotEmpty","isEmpty"];events={"click a.remove-attachment":function(e){let t=$(e.currentTarget).parent();e=t.attr("data-id");e&&this.deleteAttachment(e),t.parent().remove(),this.$el.find("input.file").val(null),setTimeout(()=>this.focusOnUploadButton(),10)},"change input.file":function(e){let t=$(e.currentTarget);var i=e.currentTarget.files;this.uploadFiles(i),e.target.value=null,t.replaceWith(t.clone(!0))},'click a.action[data-action="insertFromSource"]':function(e){e=$(e.currentTarget).data("name");this.insertFromSource(e)},'click a[data-action="showImagePreview"]':function(e){e.preventDefault();e=$(e.currentTarget).data("id");let t=this.model.get(this.idsName)||[],i=this.model.get(this.typeHashName)||{},s=[],a=(t.forEach(e=>{this.isTypeIsImage(i[e])&&s.push(e)}),[]);s.forEach(e=>{a.push({id:e,name:this.nameHash[e]})}),this.createView("preview","views/modals/image-preview",{id:e,model:this.model,name:this.nameHash[e],imageList:a},e=>{e.render()})},"keydown label.attach-file-label":function(e){"Enter"===Espo.Utils.getKeyFromKeyEvent(e)&&this.$el.find("input.file").get(0).click()}};data(){let e=this.model.get(this.idsName),t={...super.data(),idValues:this.model.get(this.idsName),idValuesString:e?e.join(","):"",nameHash:this.model.get(this.nameHashName),foreignScope:this.foreignScope,valueIsSet:this.model.has(this.idsName),acceptAttribute:this.acceptAttribute};return this.mode===this.MODE_EDIT&&(t.fileSystem=~this.sourceList.indexOf("FileSystem"),t.sourceList=this.sourceList),t}setup(){this.nameHashName=this.name+"Names",this.typeHashName=this.name+"Types",this.idsName=this.name+"Ids",this.foreignScope="Attachment",this.previewSize=this.options.previewSize||this.params.previewSize||this.previewSize,this.previewTypeList=this.getMetadata().get(["app","image","previewFileTypeList"])||[],this.imageSizes=this.getMetadata().get(["app","image","sizes"])||{},this.nameHash=_.clone(this.model.get(this.nameHashName))||{},"showPreviews"in this.params&&(this.showPreviews=this.params.showPreviews),"accept"in this.params&&(this.accept=this.params.accept),this.accept&&this.accept.length&&(this.acceptAttribute=this.accept.join(", "));let i=this.getMetadata().get(["clientDefs","Attachment","sourceDefs"])||{};this.sourceList=Espo.Utils.clone(this.params.sourceList||[]),this.sourceList=this.sourceList.concat(this.getMetadata().get(["clientDefs","Attachment","generalSourceList"])||[]).filter((e,t,i)=>i.indexOf(e)===t).filter(e=>{let t=i[e]||{};if(t.accessDataList&&!Espo.Utils.checkAccessDataList(t.accessDataList,this.getAcl(),this.getUser()))return!1;if(t.configCheck){e=t.configCheck.split(".");if(!this.getConfig().getByPath(e))return!1}return!0}),this.listenTo(this.model,"change:"+this.nameHashName,()=>{this.nameHash=_.clone(this.model.get(this.nameHashName))||{}}),this.on("remove",()=>{this.resizeIsBeingListened&&$(window).off("resize."+this.cid)}),this.on("inline-edit-off",()=>{this.isUploading=!1})}setupSearch(){this.events["change select.search-type"]=e=>{e=$(e.currentTarget).val();this.handleSearchType(e)}}focusOnInlineEdit(){this.focusOnUploadButton()}focusOnUploadButton(){this.$el.find(".attach-file-label").focus()}empty(){this.clearIds(),this.$attachments.empty()}handleResize(){var e=this.$el.width();this.$el.find("img.image-preview").css("maxWidth",e+"px")}deleteAttachment(t){this.removeId(t),this.model.isNew()&&this.getModelFactory().create("Attachment",e=>{e.id=t,e.destroy()})}getImageUrl(e,t){let i=this.getBasePath()+"?entryPoint=image&id="+e;return t&&(i+="&size="+t),this.getUser().get("portalId")&&(i+="&portalId="+this.getUser().get("portalId")),i}getDownloadUrl(e){let t=this.getBasePath()+"?entryPoint=download&id="+e;return this.getUser().get("portalId")&&(t+="&portalId="+this.getUser().get("portalId")),t}removeId(e){let t=_.clone(this.model.get(this.idsName)||[]);var i=t.indexOf(e);t.splice(i,1),this.model.set(this.idsName,t);let s=_.clone(this.model.get(this.nameHashName)||{}),a=(delete s[e],this.model.set(this.nameHashName,s),_.clone(this.model.get(this.typeHashName)||{}));delete a[e],this.model.set(this.typeHashName,a)}clearIds(e){this.model.set(this.idsName,[],{silent:e=e||!1}),this.model.set(this.nameHashName,{},{silent:e}),this.model.set(this.typeHashName,{},{silent:e})}pushAttachment(e,t,i){let s=_.clone(this.model.get(this.idsName)||[]),a=(s.push(e.id),this.model.set(this.idsName,s,{ui:i}),_.clone(this.model.get(this.typeHashName)||{})),l=(a[e.id]=e.get("type"),this.model.set(this.typeHashName,a,{ui:i}),_.clone(this.model.get(this.nameHashName)||{}));l[e.id]=e.get("name"),this.model.set(this.nameHashName,l,{ui:i})}getEditPreview(e,t,i){return~this.previewTypeList.indexOf(t)?$("<img>").attr("src",this.getImageUrl(i,"small")).attr("title",e).attr("draggable",!1).css({maxWidth:(this.imageSizes[this.previewSize]||{})[0],maxHeight:(this.imageSizes[this.previewSize]||{})[1]}).get(0).outerHTML:null}getBoxPreviewHtml(e,t,i){let s=$("<span>").text(e);if(!i)return s.get(0).outerHTML;if(this.showPreviews){t=this.getEditPreview(e,t,i);if(t)return t}t=this.getBasePath()+"?entryPoint=download&id="+i;return $("<a>").attr("href",t).attr("target","_BLANK").text(e).get(0).outerHTML}addAttachmentBox(t,i,e){let s=this.$attachments;var a=$("<a>").attr("role","button").attr("tabindex","0").addClass("remove-attachment pull-right").append($("<span>").addClass("fas fa-times")),l=this.getBoxPreviewHtml(t,i,e);let r=$("<div>").addClass("gray-box").append(a).append($("<span>").addClass("preview").append(l)),o=$("<div>").append(r);if(s.append(o),e)return r.attr("data-id",e),r;let n=$("<span>").addClass("small uploading-message").text(this.translate("Uploading..."));return o.append(n),r.on("ready",()=>{n.html(this.translate("Ready"));var e=r.attr("data-id"),e=this.getBoxPreviewHtml(t,i,e);r.find(".preview").html(e),r.find(".preview").find("img").length&&n.remove()}),r}showValidationMessage(e,t){let i=this.$el.find("label");var s=i.attr("title");i.attr("title",""),super.showValidationMessage(e,t),i.attr("title",s)}getMaxFileSize(){let e=this.params.maxFileSize||0;var t=!this.getConfig().get("attachmentUploadChunkSize"),i=this.getConfig().get("attachmentUploadMaxSize")||0,s=this.getHelper().getAppParam("maxUploadSize")||0;return(!e||e>i)&&(e=i),e=t&&e>s?s:e}uploadFiles(i){let n=0,d=0,t=!1;var e,s=this.getMaxFileSize();if(s)for(let e=0;e<i.length;e++)i[e].size>1024*s*1024&&(t=!0);if(t)return e=this.translate("fieldMaxFileSizeError","messages").replace("{field}",this.getLabelText()).replace("{max}",s),void this.showValidationMessage(e,"label");this.isUploading=!0,this.getModelFactory().create("Attachment",l=>{let r=[],t=[];for(let e=0;e<i.length;e++)t.push(i[e]),d++;let o=new a.default(this.getConfig());t.forEach(t=>{let i=this.addAttachmentBox(t.name,t.type),s=i.parent().find(".uploading-message"),e={},a=(i.find(".remove-attachment").on("click.uploading",()=>{r.push(a.cid),d--,n===d&&(this.isUploading=!1,d&&this.afterAttachmentsUploaded.call(this)),e.isCanceled=!0}),l.clone());a.set("role","Attachment"),a.set("parentType",this.model.entityType),a.set("field",this.name),o.upload(t,a,{afterChunkUpload:e=>{e=Math.floor(e/t.size*100)+"%";s.html(e)},afterAttachmentSave:e=>{i.attr("data-id",e.id)},mediator:e}).then(()=>{-1===r.indexOf(a.cid)&&(this.pushAttachment(a,null,!0),i.attr("data-id",a.id),i.trigger("ready"),++n===d&&this.isUploading&&(this.model.trigger("attachment-uploaded:"+this.name),this.afterAttachmentsUploaded.call(this),this.isUploading=!1,setTimeout(()=>{document.activeElement&&"BODY"!==document.activeElement.tagName||this.focusOnUploadButton()},50)))}).catch(()=>{e.isCanceled||(i.remove(),s.remove(),--d||(this.isUploading=!1),n===d&&this.isUploading&&(this.isUploading=!1,this.afterAttachmentsUploaded.call(this)))})})})}afterAttachmentsUploaded(){}afterRender(){if(this.mode===this.MODE_EDIT){this.$attachments=this.$el.find("div.attachments");let e=this.model.get(this.idsName)||[],s=this.model.get(this.nameHashName),a=this.model.get(this.typeHashName)||{};e.forEach(e=>{var t,i;s&&(t=s[e],i=a[e]||null,this.addAttachmentBox(t,i,e))}),this.$el.off("drop"),this.$el.off("dragover"),this.$el.off("dragleave"),this.$el.on("drop",e=>{e.preventDefault(),e.stopPropagation(),(event=e.originalEvent).dataTransfer&&event.dataTransfer.files&&event.dataTransfer.files.length&&this.uploadFiles(event.dataTransfer.files)}),this.$el.get(0).addEventListener("dragover",e=>{e.preventDefault()}),this.$el.get(0).addEventListener("dragleave",e=>{e.preventDefault()})}var e;this.mode===this.MODE_SEARCH&&(e=this.$el.find("select.search-type").val(),this.handleSearchType(e)),this.mode===this.MODE_DETAIL&&"large"===this.previewSize&&(this.handleResize(),this.resizeIsBeingListened=!0,$(window).on("resize."+this.cid,()=>{this.handleResize()}))}isTypeIsImage(e){return!!~this.previewTypeList.indexOf(e)}getDetailPreview(e,t,i){return(this.isTypeIsImage(t)?$("<a>").attr("data-action","showImagePreview").attr("data-id",i).attr("title",e).attr("href",this.getImageUrl(i)).append($("<img>").attr("src",this.getImageUrl(i,this.previewSize)).addClass("image-preview").css({maxWidth:(this.imageSizes[this.previewSize]||{})[0],maxHeight:(this.imageSizes[this.previewSize]||{})[1]})):$("<span>").text(e)).get(0).outerHTML}getValueForDisplay(){if(this.isDetailMode()||this.isListMode()){var a,l=this.nameHash,r=this.model.get(this.typeHashName)||{};let e=[],t=[];for(a in l){var o=r[a]||!1,n=l[a];this.showPreviews&&~this.previewTypeList.indexOf(o)&&(this.isDetailMode()||this.isListMode()&&this.showPreviewsInListMode)?e.push($("<div>").addClass("attachment-preview").append(this.getDetailPreview(n,o,a))):t.push($("<div>").addClass("attachment-block").append($("<span>").addClass("fas fa-paperclip text-soft small")," ",$("<a>").attr("href",this.getDownloadUrl(a)).attr("target","_BLANK").text(n)))}let i=null;if("large"===this.previewSize&&(i="attachment-block-container-large"),"small"===this.previewSize&&(i="attachment-block-container-small"),0===t.length&&0===e.length)return"";let s=$("<div>").append($("<div>").addClass("attachment-block-container").addClass(i).append(e)).append(t);return s.get(0).innerHTML}}insertFromSource(s){var a=this.getMetadata().get(["clientDefs","Attachment","sourceDefs",s,"insertModalView"])||this.getMetadata().get(["clientDefs",s,"modalViews","select"])||"views/modals/select-records";if(a){Espo.Ui.notify(" ... ");let e=null,t=("getSelectFilters"+s in this&&(e=this["getSelectFilters"+s](),this.model.get("parentId")&&"Account"===this.model.get("parentType")&&"link"===this.getMetadata().get(["entityDefs",s,"fields","account","type"])&&(e={account:{type:"equals",field:"accountId",value:this.model.get("parentId"),valueName:this.model.get("parentName")}})),this.getMetadata().get(["clientDefs","Attachment","sourceDefs",s,"boolFilterList"])),i=("getSelectBoolFilterList"+s in this&&(t=this["getSelectBoolFilterList"+s]()),this.getMetadata().get(["clientDefs","Attachment","sourceDefs",s,"primaryFilter"]));"getSelectPrimaryFilterName"+s in this&&(i=this["getSelectPrimaryFilterName"+s]()),this.createView("insertFromSource",a,{scope:s,createButton:!1,filters:e,boolFilterList:t,primaryFilterName:i,multiple:!0},e=>{e.render(),Espo.Ui.notify(!1),this.listenToOnce(e,"select",e=>{(e="[object Array]"!==Object.prototype.toString.call(e)?[e]:e).forEach(e=>{"Attachment"!==e.entityType?Espo.Ajax.postRequest(s+"/action/getAttachmentList",{id:e.id,field:this.name,parentType:this.entityType}).then(e=>{e.forEach(t=>{this.getModelFactory().create("Attachment",e=>{e.set(t),this.pushAttachment(e,!0)})})}):this.pushAttachment(e)})})})}}validateRequired(){var e;if(this.isRequired()&&0===(this.model.get(this.idsName)||[]).length)return e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e,"label"),!0}validateReady(){var e;if(this.isUploading)return e=this.translate("fieldIsUploading","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e,"label"),!0}fetch(){let e={};return e[this.idsName]=this.model.get(this.idsName)||[],e}handleSearchType(e){this.$el.find("div.link-group-container").addClass("hidden")}fetchSearch(){var e=this.$el.find("select.search-type").val();return"isEmpty"===e?{type:"isNotLinked",data:{type:e}}:"isNotEmpty"===e?{type:"isLinked",data:{type:e}}:null}}e.default=s}),define("views/dashlets/abstract/record-list",["exports","views/dashlets/abstract/base","search-manager"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{templateContent='<div class="list-container">{{{list}}}</div>';scope;listView=null;listViewColumn="views/record/list";listViewExpanded="views/record/list-expanded";layoutType="expanded";optionsFields={title:{type:"varchar",required:!0},autorefreshInterval:{type:"enumFloat",options:[0,.5,1,2,5,10]},displayRecords:{type:"enumInt",options:[3,4,5,10,15]}};rowActionsView="views/record/row-actions/view-and-edit";init(){super.init(),this.scope=this.getMetadata().get(["dashlets",this.name,"entityType"])||this.scope}checkAccess(){return this.getAcl().check(this.scope,"read")}getSearchData(){return this.getOption("searchData")}afterRender(){this.getCollectionFactory().create(this.scope,t=>{var e=this.getSearchData();this.searchManager=new i.default(t,"list",null,this.getDateTime(),e),this.scope?this.checkAccess()?(this.collectionUrl&&(t.url=this.collectionUrl),(this.collection=t).orderBy=this.getOption("orderBy")||this.getOption("sortBy")||this.collection.orderBy,this.getOption("orderBy")&&(t.order="asc"),this.hasOption("asc")&&(t.order=!!this.getOption("asc")&&"asc"),"asc"===this.getOption("sortDirection")?t.order="asc":"desc"===this.getOption("sortDirection")&&(t.order="desc"),"asc"===this.getOption("order")?t.order="asc":"desc"===this.getOption("order")&&(t.order="desc"),t.maxSize=this.getOption("displayRecords"),t.where=this.searchManager.getWhere(),e=this.listView||("expanded"===this.layoutType?this.listViewExpanded:this.listViewColumn),this.createView("list",e,{collection:t,selector:".list-container",pagination:!!this.getOption("pagination")&&"bottom",type:"listDashlet",rowActionsView:this.rowActionsView,checkboxes:!1,showMore:!0,listLayout:this.getOption(this.layoutType+"Layout"),skipBuildRows:!0},e=>{e.getSelectAttributeList(e=>{e&&(t.data.select=e.join(",")),t.fetch()})})):this.$el.find(".list-container").html(this.translate("No Access")):this.$el.find(".list-container").html(this.translate("selectEntityType","messages","DashletOptions"))})}setupActionList(){this.scope&&this.getAcl().checkScope(this.scope,"create")&&this.actionList.unshift({name:"create",text:this.translate("Create "+this.scope,"labels",this.scope),iconHtml:'<span class="fas fa-plus"></span>',url:"#"+this.scope+"/create"})}actionRefresh(){this.collection&&(this.collection.where=this.searchManager.getWhere(),this.collection.fetch({previousDataList:this.collection.models.map(e=>Espo.Utils.cloneDeep(e.attributes))}))}actionCreate(){const e=this.getCreateAttributes()||{};this.getOption("populateAssignedUser")&&(this.getMetadata().get(["entityDefs",this.scope,"fields","assignedUsers"])?(e.assignedUsersIds=[this.getUser().id],e.assignedUsersNames={},e.assignedUsersNames[this.getUser().id]=this.getUser().get("name")):(e.assignedUserId=this.getUser().id,e.assignedUserName=this.getUser().get("name"))),Espo.Ui.notify(" ... ");var t=this.getMetadata().get("clientDefs."+this.scope+".modalViews.edit")||"views/modals/edit";this.createView("modal",t,{scope:this.scope,attributes:e},e=>{e.render(),e.notify(!1),this.listenToOnce(e,"after:save",()=>{this.actionRefresh()})})}getCreateAttributes(){}}e.default=a}),define("controllers/record",["exports","controller"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{defaultAction="list";constructor(e,t){super(e,t),this.collectionMap={}}checkAccess(e){return!!this.getAcl().check(this.name,e)}getViewName(e){return this.getMetadata().get(["clientDefs",this.name,"views",e])||"views/"+Espo.Utils.camelCaseToHyphen(e)}beforeList(){this.handleCheckAccess("read")}actionList(r){let o=r.isReturn||this.getRouter().backProcessed,n=this.name+"List";!o&&this.getStoredMainView(n)&&this.clearStoredMainView(n),this.getCollection().then(e=>{const t={},i=()=>{e.abortLastFetch(),t.abort=!0,Espo.Ui.notify(!1)};this.listenToOnce(this.baseController,"action",i),this.listenToOnce(e,"sync",()=>this.stopListening(this.baseController,"action",i));var s={scope:this.name,collection:e,params:r,mediator:t},a=this.getViewName("list"),l={useStored:o,key:n};this.main(a,s,null,l)})}beforeView(){this.handleCheckAccess("read")}createViewView(e,t,i){i=i||this.getViewName("detail"),this.main(i,{scope:this.name,model:t,returnUrl:e.returnUrl,returnDispatchParams:e.returnDispatchParams,params:e})}prepareModelView(e,t){}actionView(i){let t=i.id;this.getRouter().backProcessed?(this.lastViewActionOptions&&this.lastViewActionOptions.id===t&&(i=Espo.Utils.clone(this.lastViewActionOptions)).model&&i.model.get("deleted")&&delete i.model,i.isReturn=!0):delete this.lastViewActionOptions,this.lastViewActionOptions=i;const s=e=>{this.prepareModelView(e,i),this.createViewView.call(this,i,e)};if("model"in i){let t=i.model;return s(t),this.showLoadingNotification(),t.fetch().then(()=>this.hideLoadingNotification()).catch(e=>{403===e.status&&i.isAfterCreate&&(this.hideLoadingNotification(),e.errorIsHandled=!0,t.trigger("fetch-forbidden"))}),void this.listenToOnce(this.baseController,"action",()=>{t.abortLastFetch(),this.hideLoadingNotification()})}this.getModel().then(e=>{e.id=t,this.showLoadingNotification(),e.fetch({main:!0}).then(()=>{if(this.hideLoadingNotification(),e.get("deleted"))return this.listenToOnce(e,"after:restore-deleted",()=>{s(e)}),this.prepareModelView(e,i),void this.createViewView(i,e,"views/deleted-detail");s(e)}),this.listenToOnce(this.baseController,"action",()=>{e.abortLastFetch()})})}beforeCreate(){this.handleCheckAccess("create")}prepareModelCreate(e,t){this.listenToOnce(e,"before:save",()=>{var e=this.name+"List",t=this.getStoredMainView(e);t&&("storeViewAfterCreate"in t&&t.storeViewAfterCreate||this.clearStoredMainView(e))}),this.listenToOnce(e,"after:save",()=>{var e=this.name+"List";let t=this.getStoredMainView(e);t&&"storeViewAfterCreate"in t&&t.storeViewAfterCreate&&"collection"in t&&t.collection&&this.listenToOnce(t,"after:render",()=>t.collection.fetch())})}create(s){let a=(s=s||{}).options||{};this.getModel().then(e=>{s.relate&&e.setRelate(s.relate);let t={scope:this.name,model:e,returnUrl:s.returnUrl,returnDispatchParams:s.returnDispatchParams,params:s};for(var i in a)t[i]=a[i];s.attributes&&e.set(s.attributes),this.prepareModelCreate(e,s),this.main(this.getViewName("edit"),t)})}actionCreate(e){this.create(e)}beforeEdit(){this.handleCheckAccess("edit")}prepareModelEdit(e,t){this.listenToOnce(e,"before:save",()=>{var e=this.name+"List",t=this.getStoredMainView(e);t&&("storeViewAfterUpdate"in t&&t.storeViewAfterUpdate||this.clearStoredMainView(e))})}actionEdit(s){let e=s.id,a=s.options||{};this.getModel().then(i=>{i.id=e,s.model&&(i=s.model),this.prepareModelEdit(i,s),this.showLoadingNotification(),i.fetch({main:!0}).then(()=>{this.hideLoadingNotification();let e={scope:this.name,model:i,returnUrl:s.returnUrl,returnDispatchParams:s.returnDispatchParams,params:s};for(var t in a)e[t]=a[t];s.attributes&&(e.attributes=s.attributes),this.main(this.getViewName("edit"),e)}),this.listenToOnce(this.baseController,"action",()=>{i.abortLastFetch()})})}beforeMerge(){this.handleCheckAccess("edit")}actionMerge(e){let r=e.ids.split(",");this.getModel().then(i=>{let s=[],a=()=>{this.main("views/merge",{models:s,scope:this.name,collection:e.collection})},l=0;r.forEach(e=>{let t=i.clone();t.id=e,s.push(t),this.listenToOnce(t,"sync",()=>{++l===r.length&&a()}),t.fetch()})})}actionRelated(e){let t=e.id,i=e.link,s=this.getViewName("listRelated"),a;this.getModel().then(e=>((a=e).id=t,a.fetch({main:!0}))).then(()=>{var e=a.getLinkParam(i,"entity");if(!e)throw this.baseController.error404(),new Error(`Bad link '${i}'.`);return this.collectionFactory.create(e)}).then(e=>{e.url=a.entityType+"/"+t+"/"+i,this.main(s,{scope:this.name,model:a,collection:e,link:i})})}getCollection(e){if(!this.name)throw new Error("No collection for unnamed controller");let t=this.entityType||this.name;return e&&t in this.collectionMap?(e=this.collectionMap[t],Promise.resolve(e)):this.collectionFactory.create(t,e=>{this.collectionMap[t]=e,this.listenTo(e,"sync",()=>e.isFetched=!0)})}getModel(t,i){if(i=i||this,!this.name)throw new Error("No collection for unnamed controller");var e=this.entityType||this.name;return this.modelFactory.create(e,e=>{t&&t.call(i,e)})}}e.default=s}),define("helpers/misc/stored-text-search",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t,i){this.scope=e,this.storage=t,this.key="textSearches",this.maxCount=i||100,this.list=null}match(e,t){var i;e=e.toLowerCase().trim();let s=[];for(i of this.get())if(i.toLowerCase().startsWith(e)&&s.push(i),void 0!==t&&s.length===t)break;return s}get(){return null===this.list&&(this.list=this.getFromStorage()),this.list}getFromStorage(){return this.storage.get(this.key,this.scope)||[]}store(e){e=e.trim();let t=this.getFromStorage();var i=t.indexOf(e);-1!==i&&t.splice(i,1),t.unshift(e),t.length>this.maxCount&&(t=t.slice(0,this.maxCount)),this.list=t,this.storage.set(this.key,this.scope,t)}remove(e){e=e.trim();let t=this.getFromStorage();e=t.indexOf(e);-1!==e&&(t.splice(e,1),this.list=t,this.storage.set(this.key,this.scope,t))}}}),define("helpers/misc/foreign-field",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e){let t=(this.view=e).getMetadata();var i=e.model,s=e.params.field,a=e.params.link,a=t.get(["entityDefs",i.entityType,"links",a,"entity"])||i.entityType;let l=t.get(["entityDefs",a,"fields",s])||{};i=l.type;let r=["default","audited","readOnly","required"];this.foreignParams={},e.getFieldManager().getParamList(i).forEach(e=>{e=e.name;r.includes(e)||(this.foreignParams[e]=l[e]||null)})}getForeignParams(){return Espo.Utils.cloneDeep(this.foreignParams)}}}),define("multi-collection",["exports","collection"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{seeds=null;prepareAttributes(e,t){if(this.total=e.total,!("list"in e))throw new Error("No 'list' in response.");const i=e.list;return i.map(e=>{var t=e._scope;if(!t)throw new Error("No '_scope' attribute.");delete(e=_.clone(e))._scope;let i=this.seeds[t].clone();return i.set(e),i})}clone(){let e=super.clone();return e.seeds=this.seeds,e}}e.default=s}),define("email-helper",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t,i,s){this.language=e,this.user=t,this.dateTime=i,this.acl=s,this.erasedPlaceholder="ERASED:"}getLanguage(){return this.language}getUser(){return this.user}getDateTime(){return this.dateTime}getReplyAttributes(e,h,c){let t={status:"Draft",isHtml:e.get("isHtml")},i=e.get("name")||"",s=(t.name=0!==i.toUpperCase().indexOf("RE:")?"Re: "+i:i,""),a=!1,l=e.get("nameHash")||{},r=e.get("replyTo")||null,o=e.get("replyToString")||null,u=this.getUser().get("emailAddressList")||[];if(r){let e=r.split(";");s=e.join(";")}else if(o){let i=[];o.split(";").forEach(e=>{var t=e.trim(),e=this.parseAddressFromStringAddress(e);e&&(i.push(e),(t=this.parseNameFromStringAddress(t))&&t!==e&&(l[e]=t))}),s=i.join(";")}var n,d;if(s&&s.includes("@")||!e.get("from")||(u.includes(e.get("from"))?a=!0:(s=e.get("from"),l[s]||(!(n=e.get("fromString")||e.get("fromName"))||(n=this.parseNameFromStringAddress(n))!==s&&(l[s]=n)))),t.to=s,c&&(t.cc=e.get("cc")||"",(e.get("to")||"").split(";").forEach(e=>{(e=e.trim())!==this.getUser().get("emailAddress")&&(a?(t.to&&(t.to+=";"),t.to+=e):(t.cc&&(t.cc+=";"),t.cc+=e))}),t.cc=t.cc.replace(/^(; )/,"")),t.to){let e=t.to.split(";");e=e.filter(e=>0!==e.indexOf(this.erasedPlaceholder)),t.to=e.join(";")}if(t.cc){let e=t.cc.split(";");e=e.filter(e=>0!==e.indexOf(this.erasedPlaceholder)),t.cc=e.join(";")}e.get("parentId")&&(t.parentId=e.get("parentId"),t.parentName=e.get("parentName"),t.parentType=e.get("parentType")),e.get("teamsIds")&&e.get("teamsIds").length&&(t.teamsIds=Espo.Utils.clone(e.get("teamsIds")),t.teamsNames=Espo.Utils.clone(e.get("teamsNames")||{}),(n=this.user.get("defaultTeamId"))&&!~t.teamsIds.indexOf(n)&&(t.teamsIds.push(this.user.get("defaultTeamId")),t.teamsNames[this.user.get("defaultTeamId")]=this.user.get("defaultTeamName")),t.teamsIds=t.teamsIds.filter(e=>this.acl.checkTeamAssignmentPermission(e))),t.nameHash=l,t.repliedId=e.id,t.inReplyTo=e.get("messageId");let m=(e.get("to")||"").split(";");for(d of this.getUser().get("userEmailAddressList")||[])if(m.includes(d)){t.from=d;break}return this.addReplyBodyAttributes(e,t),t}getForwardAttributes(e){let t={status:"Draft",isHtml:e.get("isHtml")},i=e.get("name");return~!i.toUpperCase().indexOf("FWD:")&&~!i.toUpperCase().indexOf("FW:")?t.name="Fwd: "+i:t.name=i,e.get("parentId")&&(t.parentId=e.get("parentId"),t.parentName=e.get("parentName"),t.parentType=e.get("parentType")),this.addForwardBodyAttributes(e,t),t}addForwardBodyAttributes(a,e){let t="",i=(t=a.get("isHtml")?"<br>------"+this.getLanguage().translate("Forwarded message","labels","Email")+"------":"\n\n------"+this.getLanguage().translate("Forwarded message","labels","Email")+"------",[]);if(a.get("from")){var s=a.get("from");let e=this.getLanguage().translate("from","fields","Email")+": ";var l=a.get("nameHash")||{};s in l&&(e+=l[s]+" "),a.get("isHtml")?e+="&lt;"+s+"&gt;":e+="<"+s+">",i.push(e)}if(a.get("dateSent")&&(l=this.getLanguage().translate("dateSent","fields","Email")+": ",l+=this.getDateTime().toDisplay(a.get("dateSent")),i.push(l)),a.get("name")&&(s=this.getLanguage().translate("subject","fields","Email")+": ",s+=a.get("name"),i.push(s)),a.get("to")){var l=this.getLanguage().translate("to","fields","Email")+": ";let s=[];a.get("to").split(";").forEach(e=>{var t=a.get("nameHash")||{};let i="";e in t&&(i+=t[e]+" "),a.get("isHtml")?i+="&lt;"+e+"&gt;":i+="<"+e+">",s.push(i)}),l+=s.join(";"),i.push(l)}i.forEach(e=>{a.get("isHtml")?t+="<br>"+e:t+="\n"+e}),a.get("isHtml")?(s=a.get("body"),e.body=t+"<br><br>"+s):(l=a.get("body")||a.get("bodyPlain")||"",e.bodyPlain=e.body=t+"\n\n"+l)}parseNameFromStringAddress(t){if(~t.indexOf("<")){let e=t.replace(/<(.*)>/,"").trim();return e='"'===e.charAt(0)&&'"'===e.charAt(e.length-1)?e.slice(1,e.length-2):e}return null}parseAddressFromStringAddress(e){var t=e.match(/<(.*)>/);let i;return i=t&&1<t.length?t[1]:e.trim()}addReplyBodyAttributes(i,s){var e,t=this.getDateTime().getReadableShortDateTimeFormat(),a=i.get("dateSent");let l=null;if(a){let e=this.getDateTime().toMoment(a);l=e.format(t)}let r=l||this.getLanguage().translate("Original message","labels","Email");if(!i.get("fromName")&&i.get("from")&&(e=(i.get("nameHash")||{})[i.get("from")])&&(r+=", "+e),r+=":",i.get("isHtml")){a=i.get("body"),a="<p>&nbsp;</p><p>"+r+"</p><blockquote>"+a+"</blockquote>";s.body=a}else{let e=i.get("body")||i.get("bodyPlain")||"",t="\n\n";t+=r+"\n",e.split("\n").forEach(e=>{t+="> "+e+"\n"}),e=t,s.body=e,s.bodyPlain=e}}composeMailToLink(e,t){var i,s="mailto:";s+=(e.to||"").split(";").join(",");let a={},l=(e.cc&&(a.cc=e.cc.split(";").join(",")),e.bcc&&(t?t+=";":t="",t+=e.bcc),t&&(a.bcc=t.split(";").join(",")),e.name&&(a.subject=e.name),e.body&&(a.body=e.body,e.isHtml&&(a.body=this.htmlToPlain(a.body))),e.inReplyTo&&(a["In-Reply-To"]=e.inReplyTo),"");for(i in a)""!==l?l+="&":l+="?",l+=i+"="+encodeURIComponent(a[i]);return s+=l}htmlToPlain(e){let t=(e=e||"").replace(/<br\s*\/?>/gm,"\n"),i=(t=t.replace(/<\/p\s*\/?>/gm,"\n\n"),$("<div>").html(t));return i.find("style").remove(),i.find('link[ref="stylesheet"]').remove(),t=i.text()}}}),define("dynamic-handler",["exports","bullbone"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i{constructor(e){this.recordView=e,this.model=e.model}init(){}onChange(e,t){}getMetadata(){return this.recordView.getMetadata()}}i.extend=t.View.extend,e.default=i}),define("app-portal",["exports","app","acl-portal-manager"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{aclName="aclPortal";masterView="views/site-portal/master";createAclManager(){return new i.default(this.user,null,this.settings.get("aclAllowDeleteCreated"))}}e.default=a}),define("action-handler",["exports","bullbone"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i{constructor(e){this.view=e}}i.extend=t.View.extend,e.default=i}),define("views/stream",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="stream";filterList=["all","posts","updates"];filter=!1;events={'click button[data-action="refresh"]':function(){this.getRecordView()&&this.getRecordView().showNewRecords()},'click button[data-action="selectFilter"]':function(e){e=$(e.currentTarget).data();this.actionSelectFilter(e)}};data(){let e=this.filter;return!1===e&&(e="all"),{displayTitle:this.options.displayTitle,filterList:this.filterList,filter:e}}setup(){this.filter=this.options.filter||this.filter,this.wait(this.getModelFactory().create("Note",e=>{this.createView("createPost","views/stream/record/edit",{selector:".create-post-container",model:e,interactiveMode:!0},e=>{this.listenTo(e,"after:save",()=>this.getRecordView().showNewRecords())})}))}afterRender(){Espo.Ui.notify(" ... "),this.getCollectionFactory().create("Note",e=>{(this.collection=e).url="Stream",this.setFilter(this.filter),e.fetch().then(()=>{this.createView("list","views/stream/record/list",{selector:".list-container",collection:e,isUserStream:!0},e=>{e.notify(!1),e.render().then(e=>{e.$el.find("> .list > .list-group")})})})})}getRecordView(){return this.getView("list")}actionSelectFilter(e){e=e.name;let i=e,t=e,s=("all"===i&&(t=!1),this.filter=t,this.setFilter(this.filter),this.filterList.forEach(e=>{var t=this.$el.find('.page-header button[data-action="selectFilter"][data-name="'+e+'"]');e===i?t.addClass("active"):t.removeClass("active")}),"#Stream");this.filter&&(s+="/"+i),this.getRouter().navigate(s),Espo.Ui.notify(" ... "),this.listenToOnce(this.collection,"sync",()=>{Espo.Ui.notify(!1)}),this.collection.reset(),this.collection.fetch()}setFilter(e){this.collection.data.filter=null,e&&(this.collection.data.filter=e),this.collection.offset=0,this.collection.maxSize=this.getConfig().get("recordsPerPage")||this.collection.maxSize}}e.default=s}),define("views/popup-notification",["exports","view","jquery"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{type="default";style="default";closeButton=!0;soundPath="client/sounds/pop_cork";init(){super.init();let t=this.options.id,i=this.containerSelector="#"+t;this.setSelector(i),this.notificationSoundsDisabled=this.getConfig().get("notificationSoundsDisabled"),this.soundPath=this.getBasePath()+(this.getConfig().get("popupNotificationSound")||this.soundPath),this.on("render",()=>{(0,s.default)(i).remove();var e="popup-notification-"+Espo.Utils.toDom(this.type);(0,s.default)("<div>").attr("id",t).addClass("popup-notification").addClass(e).addClass("popup-notification-"+this.style).appendTo("#popup-notifications-container"),this.setElement(i)}),this.on("after:render",()=>{this.$el.find('[data-action="close"]').on("click",()=>{this.resolveCancel()})}),this.once("after:render",()=>{this.onShow()}),this.once("remove",function(){(0,s.default)(i).remove()}),this.notificationData=this.options.notificationData,this.notificationId=this.options.notificationId,this.id=this.options.id}data(){return{closeButton:this.closeButton,notificationData:this.notificationData,notificationId:this.notificationId}}playSound(){if(!this.notificationSoundsDisabled){var t='<audio autoplay="autoplay"><source src="'+this.soundPath+'.mp3" type="audio/mpeg" /><source src="'+this.soundPath+'.ogg" type="audio/ogg" /><embed hidden="true" autostart="true" loop="false" src="'+this.soundPath+'.mp3" /></audio>';let e=(0,s.default)(t);e.get(0).volume=.3,e.get(0).play()}}onShow(){this.options.isFirstCheck||this.playSound()}onConfirm(){}onCancel(){}resolveConfirm(){this.onConfirm(),this.trigger("confirm"),this.remove()}resolveCancel(){this.onCancel(),this.trigger("cancel"),this.remove()}confirm(){console.warn("Method 'confirm' in views/popup-notification is deprecated. Use 'resolveConfirm' instead."),this.resolveConfirm()}cancel(){console.warn("Method 'cancel' in views/popup-notification is deprecated. Use 'resolveCancel' instead."),this.resolveCancel()}}e.default=a}),define("views/merge",["exports","views/main"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="merge";name="Merge";headerView="views/header";recordView="views/record/merge";setup(){this.models=this.options.models,this.setupHeader(),this.setupRecord()}setupHeader(){this.createView("header",this.headerView,{model:this.model,fullSelector:"#main > .page-header"})}setupRecord(){this.createView("body",this.recordView,{fullSelector:"#main > .body",models:this.models,collection:this.collection})}getHeader(){return this.buildHeaderHtml([$("<a>").attr("href","#"+this.models[0].entityType).text(this.getLanguage().translate(this.models[0].entityType,"scopeNamesPlural")),$("<span>").text(this.getLanguage().translate("Merge"))])}updatePageTitle(){this.setPageTitle(this.getLanguage().translate("Merge"))}}e.default=s}),define("views/login",["exports","view","js-base64","jquery"],function(e,t,a,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),a=s(a),i=s(i);class l extends t.default{template="login";views={footer:{fullSelector:"body > footer",view:"views/site/footer"}};anotherUser=null;isPopoverDestroyed=!1;handler=null;fallback=!1;method=null;events={"submit #login-form":function(e){e.preventDefault(),this.login()},"click #sign-in":function(){this.signIn()},'click a[data-action="passwordChangeRequest"]':function(){this.showPasswordChangeRequest()},'click a[data-action="showFallback"]':function(){this.showFallback()},keydown:function(e){"Control+Enter"===Espo.Utils.getKeyFromKeyEvent(e)&&(e.preventDefault(),!this.handler||this.fallback&&this.$username.val()?this.login():this.signIn())}};data(){return{logoSrc:this.getLogoSrc(),showForgotPassword:this.getConfig().get("passwordRecoveryEnabled"),anotherUser:this.anotherUser,hasSignIn:!!this.handler,hasFallback:!!this.handler&&this.fallback,method:this.method,signInText:this.signInText,logInText:this.logInText}}setup(){this.anotherUser=this.options.anotherUser||null;let t=this.getConfig().get("loginData")||{};this.fallback=!!t.fallback,this.method=t.method,t.handler&&(this.wait(Espo.loader.requirePromise(t.handler).then(e=>{this.handler=new e(this,t.data||{})})),this.signInText=this.getLanguage().has(this.method,"signInLabels","Global")?this.translate(this.method,"signInLabels"):this.translate("Sign in")),this.getLanguage().has("Log in","labels","Global")&&(this.logInText=this.translate("Log in")),this.logInText=this.getLanguage().has("Log in","labels","Global")?this.translate("Log in"):this.translate("Login")}getLogoSrc(){var e=this.getConfig().get("companyLogoId");return e?this.getBasePath()+"?entryPoint=LogoImage&id="+e:this.getBasePath()+(this.getConfig().get("logoSrc")||"client/img/logo.svg")}afterRender(){this.$submit=this.$el.find("#btn-login"),this.$signIn=this.$el.find("#sign-in"),this.$username=this.$el.find("#field-userName"),this.$password=this.$el.find("#field-password"),this.options.prefilledUsername&&this.$username.val(this.options.prefilledUsername),this.handler&&(this.$username.closest(".cell").addClass("hidden"),this.$password.closest(".cell").addClass("hidden"),this.$submit.closest(".cell").addClass("hidden"))}signIn(){this.disableForm(),this.handler.process().then(e=>{this.proceed(e)}).catch(()=>{this.undisableForm()})}login(){let e,t=this.$username.val();var i=this.$password.val(),s=t.trim();if(s!==t&&(this.$username.val(s),t=s),""!==t){this.disableForm();try{e=a.default.encode(t+":"+i)}catch(e){throw Espo.Ui.error(this.translate("Error")+": "+e.message,!0),this.undisableForm(),e}s={Authorization:"Basic "+e,"Espo-Authorization":e};this.proceed(s,t,i)}else this.processEmptyUsername()}proceed(e,i,s){e=Espo.Utils.clone(e);let a=Espo.Utils.clone(e);e["Espo-Authorization-By-Token"]="false",e["Espo-Authorization-Create-Token-Secret"]="true",null!==this.anotherUser&&(e["X-Another-User"]=this.anotherUser),this.notifyLoading(),Espo.Ajax.getRequest("App/user",null,{login:!0,headers:e}).then(e=>{Espo.Ui.notify(!1),this.triggerLogin(i,e)}).catch(e=>{if(this.undisableForm(),401===e.status){var t=e.responseJSON||{};if("second-step-required"===e.getResponseHeader("X-Status-Reason"))return e.errorIsHandled=!0,void this.onSecondStepRequired(a,i,s,t);this.onWrongCredentials()}})}triggerLogin(e,t){this.anotherUser&&(t.anotherUser=this.anotherUser),e=e||(t.user||{}).userName,this.trigger("login",e,t)}processEmptyUsername(){this.isPopoverDestroyed=!1;let e=this.$username;var t=this.getLanguage().translate("userCantBeEmpty","messages","User");e.popover({placement:"bottom",container:"body",content:t,trigger:"manual"}).popover("show");let i=e.closest(".form-group");i.addClass("has-error"),e.one("mousedown click",()=>{i.removeClass("has-error"),this.isPopoverDestroyed||(e.popover("destroy"),this.isPopoverDestroyed=!0)})}disableForm(){this.$submit.addClass("disabled").attr("disabled","disabled"),this.$signIn.addClass("disabled").attr("disabled","disabled")}undisableForm(){this.$submit.removeClass("disabled").removeAttr("disabled"),this.$signIn.removeClass("disabled").removeAttr("disabled")}onSecondStepRequired(e,t,i,s){var a=s.view||"views/login-second-step";this.trigger("redirect",a,e,t,i,s)}onWrongCredentials(){let e=(0,i.default)("#login .form-group");e.addClass("has-error"),this.$el.one("mousedown click",()=>{e.removeClass("has-error")});var t=this.handler?"failedToLogIn":"wrongUsernamePassword";Espo.Ui.error(this.translate(t,"messages","User"))}showFallback(){this.$el.find('[data-action="showFallback"]').addClass("hidden"),this.$el.find(".panel-body").addClass("fallback-shown"),this.$username.closest(".cell").removeClass("hidden"),this.$password.closest(".cell").removeClass("hidden"),this.$submit.closest(".cell").removeClass("hidden")}notifyLoading(){Espo.Ui.notify(" ... ")}showPasswordChangeRequest(){this.notifyLoading(),this.createView("passwordChangeRequest","views/modals/password-change-request",{url:window.location.href},e=>{e.render(),Espo.Ui.notify(!1)})}}e.default=l}),define("views/login-second-step",["exports","view","js-base64","jquery"],function(e,t,a,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),a=s(a),i=s(i);class l extends t.default{template="login-second-step";views={footer:{fullSelector:"body > footer",view:"views/site/footer"}};anotherUser=null;loginData=null;headers=null;isPopoverDestroyed=!1;events={"submit #login-form":function(e){e.preventDefault(),this.send()},'click [data-action="backToLogin"]':function(){this.trigger("back")},keydown:function(e){"Control+Enter"===Espo.Utils.getKeyFromKeyEvent(e)&&(e.preventDefault(),this.send())}};data(){return{message:this.message}}setup(){this.message=this.translate(this.options.loginData.message,"messages","User"),this.anotherUser=this.options.anotherUser||null,this.headers=this.options.headers||{},this.loginData=this.options.loginData}afterRender(){this.$code=(0,i.default)('[data-name="field-code"]'),this.$submit=this.$el.find("#btn-send"),this.$code.focus()}send(){var e=this.$code.val().trim().replace(/\s/g,"");let t=this.options.userName;var i=this.loginData.token;let s=Espo.Utils.clone(this.headers);""!==e?(this.disableForm(),t&&i&&(i=a.default.encode(t+":"+i),s.Authorization="Basic "+i,s["Espo-Authorization"]=i),s["Espo-Authorization-Code"]=e,s["Espo-Authorization-Create-Token-Secret"]="true",null!==this.anotherUser&&(s["X-Another-User"]=this.anotherUser),this.notifyLoading(),Espo.Ajax.getRequest("App/user",null,{login:!0,headers:s}).then(e=>{Espo.Ui.notify(!1),this.triggerLogin(t,e)}).catch(e=>{this.undisableForm(),401===e.status&&this.onWrongCredentials()})):this.processEmptyCode()}triggerLogin(e,t){this.anotherUser&&(t.anotherUser=this.anotherUser),e=e||(t.user||{}).userName,this.trigger("login",e,t)}processEmptyCode(){this.isPopoverDestroyed=!1;var e=this.getLanguage().translate("codeIsRequired","messages","User");let t=this.$code,i=(t.popover({placement:"bottom",container:"body",content:e,trigger:"manual"}).popover("show"),t.closest(".form-group"));i.addClass("has-error"),t.one("mousedown click",()=>{i.removeClass("has-error"),this.isPopoverDestroyed||(t.popover("destroy"),this.isPopoverDestroyed=!0)})}onWrongCredentials(){let e=(0,i.default)("#login .form-group");e.addClass("has-error"),this.$el.one("mousedown click",()=>{e.removeClass("has-error")}),Espo.Ui.error(this.translate("wrongCode","messages","User"))}notifyLoading(){Espo.Ui.notify(" ... ")}disableForm(){this.$submit.addClass("disabled").attr("disabled","disabled")}undisableForm(){this.$submit.removeClass("disabled").removeAttr("disabled")}}e.default=l}),define("views/list-tree",["exports","views/list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{searchPanel=!1;createButton=!1;name="listTree";getRecordViewName(){return this.getMetadata().get(["clientDefs",this.scope,"recordViews","listTree"])||"views/record/list-tree"}}e.default=s}),define("views/list-related",["exports","views/main","search-manager"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{template="list";name="ListRelated";headerView="views/header";searchView="views/record/search";recordView="views/record/list";searchPanel=!0;searchManager=null;optionsToPass=[];keepCurrentRootUrl=!1;viewMode="";viewModeList=null;defaultViewMode="list";MODE_LIST="list";rowActionsView="views/record/row-actions/relationship";createButton=!0;unlinkDisabled=!1;filtersDisabled=!1;shortcutKeys={"Control+Space":function(e){this.handleShortcutKeyCtrlSpace(e)},"Control+Slash":function(e){this.handleShortcutKeyCtrlSlash(e)},"Control+Comma":function(e){this.handleShortcutKeyCtrlComma(e)},"Control+Period":function(e){this.handleShortcutKeyCtrlPeriod(e)}};setup(){if(this.link=this.options.link,!this.link)throw console.error("Link not passed."),new Error;if(!this.model)throw console.error("Model not passed."),new Error;if(!this.collection)throw console.error("Collection not passed."),new Error;if(this.panelDefs=this.getMetadata().get(["clientDefs",this.scope,"relationshipPanels",this.link])||{},this.panelDefs.fullFormDisabled)throw console.error("Full-form disabled."),new Error;this.collection.maxSize=this.getConfig().get("recordsPerPage")||this.collection.maxSize,this.collectionUrl=this.collection.url,this.collectionMaxSize=this.collection.maxSize,this.foreignScope=this.collection.entityType,this.setupModes(),this.setViewMode(this.viewMode),this.getMetadata().get(["clientDefs",this.foreignScope,"searchPanelDisabled"])&&(this.searchPanel=!1),this.getUser().isPortal()&&this.getMetadata().get(["clientDefs",this.foreignScope,"searchPanelInPortalDisabled"])&&(this.searchPanel=!1),this.getMetadata().get(["clientDefs",this.foreignScope,"createDisabled"])&&(this.createButton=!1),(!1===this.panelDefs.create||this.panelDefs.createDisabled||this.panelDefs.createAction)&&(this.createButton=!1),this.entityType=this.collection.entityType,this.headerView=this.options.headerView||this.headerView,this.recordView=this.options.recordView||this.recordView,this.searchView=this.options.searchView||this.searchView,this.setupHeader(),this.defaultOrderBy=this.panelDefs.orderBy||this.collection.orderBy,this.defaultOrder=this.panelDefs.orderDirection||this.collection.order,this.panelDefs.orderBy&&!this.panelDefs.orderDirection&&(this.defaultOrder="asc"),this.collection.setOrder(this.defaultOrderBy,this.defaultOrder,!0),this.searchPanel&&this.setupSearchManager(),this.setupSorting(),this.searchPanel&&this.setupSearchPanel(),this.createButton&&this.setupCreateButton(),this.options.params&&this.options.params.fromAdmin&&(this.keepCurrentRootUrl=!0),this.wait(this.getHelper().processSetupHandlers(this,"list"))}setupModes(){this.defaultViewMode=this.options.defaultViewMode||this.getMetadata().get(["clientDefs",this.foreignScope,"listRelatedDefaultViewMode"])||this.defaultViewMode,this.viewMode=this.viewMode||this.defaultViewMode;var t=this.options.viewModeList||this.viewModeList||this.getMetadata().get(["clientDefs",this.foreignScope,"listRelatedViewModeList"]);if(this.viewModeList=t||[this.MODE_LIST],1<this.viewModeList.length){let e=null;var t="listRelatedViewMode"+this.scope+this.link;!this.getStorage().has("state",t)||(t=this.getStorage().get("state",t))&&this.viewModeList.includes(t)&&(e=t),e=e||this.defaultViewMode,this.viewMode=e}}setupHeader(){this.createView("header",this.headerView,{collection:this.collection,fullSelector:"#main > .page-header",scope:this.scope,isXsSingleRow:!0})}setupCreateButton(){this.menu.buttons.unshift({action:"quickCreate",iconHtml:'<span class="fas fa-plus fa-sm"></span>',text:this.translate("Create "+this.foreignScope,"labels",this.foreignScope),style:"default",acl:"create",aclScope:this.foreignScope,title:"Ctrl+Space"})}setupSearchPanel(){this.createSearchView()}createSearchView(){let s=Espo.Utils.clone(this.getMetadata().get(["clientDefs",this.foreignScope,"filterList"])||[]);return this.panelDefs.filterList&&this.panelDefs.filterList.forEach(e=>{let t=!1,i=e.name||e;i&&"all"!==i&&(s.forEach(e=>{e=e.name||e;i===e&&(t=!0)}),t||s.push(e))}),this.filtersDisabled&&(s=[]),this.createView("search",this.searchView,{collection:this.collection,fullSelector:"#main > .search-container",searchManager:this.searchManager,scope:this.foreignScope,viewMode:this.viewMode,viewModeList:this.viewModeList,isWide:!0,filterList:s},e=>{1<this.viewModeList.length&&this.listenTo(e,"change-view-mode",e=>this.switchViewMode(e))})}switchViewMode(e){this.clearView("list"),this.collection.isFetched=!1,this.collection.reset(),this.setViewMode(e,!0),this.loadList()}setViewMode(e,t){this.viewMode=e,this.collection.url=this.collectionUrl,this.collection.maxSize=this.collectionMaxSize,t&&(t="listViewMode"+this.scope+this.link,this.getStorage().set("state",t,e)),this.searchView&&this.getView("search")&&this.getSearchView().setViewMode(e);t="setViewMode"+Espo.Utils.upperCaseFirst(this.viewMode);this[t]&&this[t]()}setupSearchManager(){let e=this.collection,t=new i.default(e,"list",null,this.getDateTime(),null);t.scope=this.foreignScope,e.where=t.getWhere(),this.searchManager=t}setupSorting(){}getSearchView(){return this.getView("search")}getRecordView(){return this.getView("list")}getRecordViewName(){if(this.viewMode===this.MODE_LIST)return this.panelDefs.recordListView||this.getMetadata().get(["clientDefs",this.foreignScope,"recordViews",this.MODE_LIST])||this.recordView;var e="record"+Espo.Utils.upperCaseFirst(this.viewMode)+"View";return this.getMetadata().get(["clientDefs",this.foreignScope,"recordViews",this.viewMode])||this[e]}afterRender(){Espo.Ui.notify(!1),this.hasView("list")||this.loadList(),this.$el.get(0).focus({preventScroll:!0})}loadList(){"isFetched"in this.collection&&this.collection.isFetched?this.createListRecordView(!1):(Espo.Ui.notify(" ... "),this.createListRecordView(!0))}prepareRecordViewOptions(e){}createListRecordView(){let t={collection:this.collection,selector:".list-container",scope:this.foreignScope,skipBuildRows:!0,shortcutKeysEnabled:!0};this.optionsToPass.forEach(e=>{t[e]=this.options[e]}),this.keepCurrentRootUrl&&(t.keepCurrentRootUrl=!0),this.panelDefs.layout&&"string"==typeof this.panelDefs.layout&&(t.layoutName=this.panelDefs.layout),t.rowActionsView=!this.panelDefs.readOnly&&(this.panelDefs.rowActionsView||this.rowActionsView),(this.getConfig().get("listPagination")||this.getMetadata().get(["clientDefs",this.foreignScope,"listPagination"]))&&(t.pagination=!0);var e=this.panelDefs.massUnlinkDisabled||this.panelDefs.unlinkDisabled||this.unlinkDisabled,e=(t={unlinkMassAction:!e,skipBuildRows:!0,buttonsDisabled:!0,forceDisplayTopBar:!0,rowActionsOptions:{unlinkDisabled:this.panelDefs.unlinkDisabled||this.unlinkDisabled},...t},this.getHelper().isXsScreen()&&(t.type="listSmall"),this.prepareRecordViewOptions(t),this.getRecordViewName());this.createView("list",e,t,e=>{this.hasParentView()?(this.listenToOnce(e,"after:render",()=>{this.hasParentView()||(e.undelegateEvents(),this.clearView("list"))}),e.getSelectAttributeList(e=>{this.options.mediator&&this.options.mediator.abort||(e&&(this.collection.data.select=e.join(",")),Espo.Ui.notify(" ... "),this.collection.fetch({main:!0}).then(()=>Espo.Ui.notify(!1)))})):e.undelegateEvents()})}actionQuickCreate(){let t=this.link,i=this.foreignScope,s=this.model.getLinkParam(t,"foreign"),a={},l=this.getMetadata().get(["clientDefs",this.scope,"relationshipPanels",t,"createAttributeMap"])||{},e=(Object.keys(l).forEach(e=>{a[l[e]]=this.model.get(e)}),Espo.Ui.notify(" ... "),this.getMetadata().get(["clientDefs",this.scope,"relationshipPanels",t,"createHandler"]));new Promise(t=>{e?Espo.loader.requirePromise(e).then(e=>new e(this.getHelper())).then(e=>{e.getAttributes(this.model).then(e=>t(e))}):t({})}).then(e=>{a={...a,...e};e=this.getMetadata().get(["clientDefs",i,"modalViews","edit"])||"views/modals/edit";this.createView("quickCreate",e,{scope:i,relate:{model:this.model,link:s},attributes:a},e=>{e.render(),e.notify(!1),this.listenToOnce(e,"after:save",()=>{this.collection.fetch(),this.model.trigger("after:relate"),this.model.trigger("after:relate:"+t)})})})}actionUnlinkRelated(e){let t=e.id;this.confirm({message:this.translate("unlinkRecordConfirmation","messages"),confirmText:this.translate("Unlink")},()=>{Espo.Ui.notify(" ... "),Espo.Ajax.deleteRequest(this.collection.url,{id:t}).then(()=>{Espo.Ui.success(this.translate("Unlinked")),this.collection.fetch(),this.model.trigger("after:unrelate"),this.model.trigger("after:unrelate:"+this.link)})})}getHeader(){var e=this.model.get("name")||this.model.id,t="#"+this.scope+"/view/"+this.model.id;let i=$("<a>").attr("href",t).addClass("font-size-flexible title").text(e);this.model.get("deleted")&&i.css("text-decoration","line-through");t=this.getHelper().getScopeColorIconHtml(this.foreignScope),e=this.getLanguage().translate(this.scope,"scopeNamesPlural");let s=$("<span>").text(e);this.rootLinkDisabled||(s=$("<span>").append($("<a>").attr("href","#"+this.scope).addClass("action").attr("data-action","navigateToRoot").text(e))),t&&s.prepend(t);e=$("<span>").text(this.translate(this.link,"links",this.scope));return this.buildHeaderHtml([s,i,e])}updatePageTitle(){this.setPageTitle(this.getLanguage().translate(this.link,"links",this.scope))}getCreateAttributes(){}handleShortcutKeyCtrlSpace(e){this.createButton&&this.getAcl().checkScope(this.foreignScope,"create")&&(e.preventDefault(),e.stopPropagation(),this.actionQuickCreate({focusForCreate:!0}))}handleShortcutKeyCtrlSlash(t){if(this.searchPanel){let e=this.$el.find("input.text-filter").first();e.length&&(t.preventDefault(),t.stopPropagation(),e.focus())}}handleShortcutKeyCtrlComma(e){this.getSearchView()&&this.getSearchView().selectPreviousPreset()}handleShortcutKeyCtrlPeriod(e){this.getSearchView()&&this.getSearchView().selectNextPreset()}}e.default=a}),define("views/home",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="home";setup(){var e=this.getMetadata().get(["clientDefs","Home","view"])||"views/dashboard";this.createView("content",e,{selector:"> .home-content"})}}e.default=s}),define("views/header",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="header";data(){let t={},e=("getHeader"in this.getParentMainView()&&(t.header=this.getParentMainView().getHeader()),t.scope=this.scope||this.getParentMainView().scope,t.items=this.getItems(),(t.items||{}).dropdown||[]);return t.hasVisibleDropdownItems=!1,e.forEach(e=>{e.hidden||(t.hasVisibleDropdownItems=!0)}),t.noBreakWords=this.options.fontSizeFlexible,t.isXsSingleRow=this.options.isXsSingleRow,(t.items.buttons||[]).length<2&&(t.isHeaderAdditionalSpace=!0),t}setup(){this.scope=this.options.scope,this.model&&this.listenTo(this.model,"after:save",()=>{this.isRendered()&&this.reRender()}),this.wasRendered=!1}afterRender(){this.options.fontSizeFlexible&&this.adjustFontSize(),this.wasRendered&&this.getParentMainView().trigger("header-rendered"),this.wasRendered=!0}adjustFontSize(t){(t=t||0)||(this.fontSizePercentage=100);let i=this.$el.find(".header-breadcrumbs");var e=i.width();let s=0;if(i.children().each((e,t)=>{s+=$(t).outerWidth(!0)}),e<s){if(7<t)return i.addClass("overlapped"),void this.$el.find(".title").each((e,t)=>{let i=$(t),s=$(t).text(),a=(i.attr("title",s),!1);i.on("touchstart",()=>{a||(i.attr("title",""),a=!0,Espo.Ui.popover(i,{content:s,noToggleInit:!0},this)),i.popover("toggle")})});this.fontSizePercentage-=4;let e=this.$el.find(".font-size-flexible");e.css("font-size",this.fontSizePercentage+"%"),e.css("position","relative"),(6<t||4<t)&&e.css("top","-1px"),this.adjustFontSize(t+1)}}getItems(){return this.getParentMainView().getMenu()||{}}getParentMainView(){return this.getParentView()}}e.default=s}),define("views/edit",["exports","views/main"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="edit";name="Edit";optionsToPass=["returnUrl","returnDispatchParams","attributes","rootUrl","duplicateSourceId","returnAfterCreate"];headerView="views/header";recordView="views/record/edit";rootLinkDisabled=!1;setup(){this.headerView=this.options.headerView||this.headerView,this.recordView=this.options.recordView||this.recordView,this.setupHeader(),this.setupRecord()}setupFinal(){super.setupFinal(),this.wait(this.getHelper().processSetupHandlers(this,"edit"))}setupHeader(){this.createView("header",this.headerView,{model:this.model,fullSelector:"#main > .header",scope:this.scope})}setupRecord(){let t={model:this.model,fullSelector:"#main > .record",scope:this.scope,shortcutKeysEnabled:!0};this.optionsToPass.forEach(e=>{t[e]=this.options[e]});var e=this.options.params||{};return e.rootUrl&&(t.rootUrl=e.rootUrl),e.focusForCreate&&(t.focusForCreate=!0),this.createView("record",this.getRecordViewName(),t)}getRecordViewName(){return this.getMetadata().get("clientDefs."+this.scope+".recordViews.edit")||this.recordView}getHeader(){var e=this.getHeaderIconHtml(),t=this.options.rootUrl||this.options.params.rootUrl||"#"+this.scope,i=this.getLanguage().translate(this.scope,"scopeNamesPlural");let s=$("<span>").text(i);if(this.options.noHeaderLinks||this.rootLinkDisabled||(s=$("<span>").append($("<a>").attr("href",t).addClass("action").attr("data-action","navigateToRoot").text(i))),e&&s.prepend(e),this.model.isNew())return t=$("<span>").text(this.getLanguage().translate("create")),this.buildHeaderHtml([s,t]);i=this.model.get("name")||this.model.id;let a=$("<span>").text(i);return this.options.noHeaderLinks||(e="#"+this.scope+"/view/"+this.model.id,a=$("<a>").attr("href",e).addClass("action").append(a)),this.buildHeaderHtml([s,a])}updatePageTitle(){if(this.model.isNew())return e=this.getLanguage().translate("Create")+" "+this.getLanguage().translate(this.scope,"scopeNames"),void this.setPageTitle(e);var e=this.model.get("name"),e=e||this.getLanguage().translate(this.scope,"scopeNames");this.setPageTitle(e)}}e.default=s}),define("views/deleted-detail",["exports","views/detail"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{recordView="views/record/deleted-detail";menuDisabled=!0;setup(){super.setup(),this.model.get("deleted")&&(this.menuDisabled=!0)}getRecordViewName(){return this.recordView}}e.default=s}),define("views/dashlet",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="dashlet";name;id;optionsView=null;data(){return{name:this.name,id:this.id,title:this.getTitle(),actionList:(this.getBodyView()||{}).actionList||[],buttonList:(this.getBodyView()||{}).buttonList||[],noPadding:(this.getBodyView()||{}).noPadding}}events={"click .action":function(e){Espo.Utils.handleAction(this,e.originalEvent,e.currentTarget)||this.getBodyView().handleAction(e.originalEvent,e.currentTarget)},"mousedown .panel-heading .dropdown-menu":function(e){e.stopPropagation()},"shown.bs.dropdown .panel-heading .btn-group":function(e){this.controlDropdownShown($(e.currentTarget).parent())},"hide.bs.dropdown .panel-heading .btn-group":function(){this.controlDropdownHide()}};controlDropdownShown(e){let t=this.$el.children().first();e.find(".dropdown-menu").get(0).getBoundingClientRect().bottom<t.get(0).getBoundingClientRect().bottom||t.addClass("has-dropdown-opened")}controlDropdownHide(){this.$el.children().first().removeClass("has-dropdown-opened")}setup(){this.name=this.options.name,this.id=this.options.id,this.on("resize",()=>{let e=this.getView("body");e&&e.trigger("resize")});var e=this.getMetadata().get(["dashlets",this.name,"view"])||"views/dashlets/"+Espo.Utils.camelCaseToHyphen(this.name);this.createView("body",e,{selector:".dashlet-body",id:this.id,name:this.name,readOnly:this.options.readOnly,locked:this.options.locked})}refresh(){this.getBodyView().actionRefresh()}actionRefresh(){this.refresh()}actionOptions(){var e=this.getMetadata().get(["dashlets",this.name,"options","view"])||this.optionsView||"views/dashlets/options/base";Espo.Ui.notify(" ... "),this.createView("options",e,{name:this.name,optionsData:this.getOptionsData(),fields:this.getBodyView().optionsFields},s=>{s.render(),Espo.Ui.notify(!1),this.listenToOnce(s,"save",e=>{var t=this.id;Espo.Ui.notify(this.translate("saving","messages")),this.getPreferences().once("sync",()=>{this.getPreferences().trigger("update"),Espo.Ui.notify(!1),s.close(),this.trigger("change")});let i=this.getPreferences().get("dashletsOptions")||{};i[t]=e,this.getPreferences().save({dashletsOptions:i},{patch:!0})})})}getOptionsData(){return this.getBodyView().optionsData}getOption(e){return this.getBodyView().getOption(e)}getTitle(){return this.getBodyView().getTitle()}getBodyView(){return this.getView("body")}actionRemove(){this.confirm(this.translate("confirmation","messages"),()=>{this.trigger("remove-dashlet"),this.$el.remove(),this.remove()})}}e.default=s}),define("views/dashboard",["exports","view","gridstack"],function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),a=i(a);class s extends t.default{template="dashboard";dashboardLayout=null;currentTab=null;WIDTH_MULTIPLIER=3;events={'click button[data-action="selectTab"]':function(e){e=parseInt($(e.currentTarget).data("tab"));this.selectTab(e)},'click .dashboard-buttons [data-action="addDashlet"]':function(){this.createView("addDashlet","views/modals/add-dashlet",{},e=>{e.render(),this.listenToOnce(e,"add",e=>{this.addDashlet(e)})})},'click .dashboard-buttons [data-action="editTabs"]':function(){this.editTabs()}};data(){return{displayTitle:this.options.displayTitle,currentTab:this.currentTab,tabCount:this.dashboardLayout.length,dashboardLayout:this.dashboardLayout,layoutReadOnly:this.layoutReadOnly,hasAdd:!this.layoutReadOnly&&!this.getPreferences().get("dashboardLocked")}}generateId(){return Math.floor(10000001*Math.random()).toString()}setupCurrentTabLayout(){this.dashboardLayout||(e=[{name:"My Espo",layout:[]}],this.getConfig().get("forcedDashboardLayout")?this.dashboardLayout=this.getConfig().get("forcedDashboardLayout")||[]:this.getUser().get("portalId")?this.dashboardLayout=this.getConfig().get("dashboardLayout")||[]:this.dashboardLayout=this.getPreferences().get("dashboardLayout")||e,0!==this.dashboardLayout.length&&"[object Array]"===Object.prototype.toString.call(this.dashboardLayout)||(this.dashboardLayout=e));var e=this.dashboardLayout||[],e=(e.length<=this.currentTab&&(this.currentTab=0),e[this.currentTab].layout||[]),e=a.default.Utils.sort(e);this.currentTabLayout=e}storeCurrentTab(e){this.getStorage().set("state","dashboardTab",e)}selectTab(e){this.$el.find('.page-header button[data-action="selectTab"]').removeClass("active"),this.$el.find('.page-header button[data-action="selectTab"][data-tab="'+e+'"]').addClass("active"),this.currentTab=e,this.storeCurrentTab(e),this.setupCurrentTabLayout(),this.dashletIdList.forEach(e=>{this.clearView("dashlet-"+e)}),this.dashletIdList=[],this.reRender()}setup(){if(this.currentTab=this.getStorage().get("state","dashboardTab")||0,this.setupCurrentTabLayout(),this.dashletIdList=[],this.screenWidthXs=this.getThemeManager().getParam("screenWidthXs"),this.getUser().isPortal())this.layoutReadOnly=!0,this.dashletsReadOnly=!0;else{let e=this.getAcl().getScopeForbiddenFieldList("Preferences","edit");~e.indexOf("dashboardLayout")&&(this.layoutReadOnly=!0),~e.indexOf("dashletsOptions")&&(this.dashletsReadOnly=!0)}this.once("remove",()=>{this.grid&&this.grid.destroy(),this.fallbackModeTimeout&&clearTimeout(this.fallbackModeTimeout),$(window).off("resize.dashboard")})}afterRender(){this.$dashboard=this.$el.find("> .dashlets"),window.innerWidth>=this.screenWidthXs?this.initGridstack():this.initFallbackMode(),$(window).off("resize.dashboard"),$(window).on("resize.dashboard",this.onResize.bind(this))}onResize(){this.isFallbackMode()&&window.innerWidth>=this.screenWidthXs?this.initGridstack():!this.isFallbackMode()&&window.innerWidth<this.screenWidthXs&&this.initFallbackMode()}isFallbackMode(){return this.$dashboard.hasClass("fallback")}preserveDashletViews(){this.preservedDashletViews={},this.preservedDashletElements={},this.currentTabLayout.forEach(e=>{var t="dashlet-"+e.id;let i=this.getView(t),s=(this.unchainView(t),(this.preservedDashletViews[e.id]=i).$el.children(0));(this.preservedDashletElements[e.id]=s).detach()})}addPreservedDashlet(e){var t=this.preservedDashletViews[e],i=this.preservedDashletElements[e];this.$el.find('.dashlet-container[data-id="'+e+'"]').append(i),this.setView("dashlet-"+e,t)}clearPreservedDashlets(){this.preservedDashletViews=null,this.preservedDashletElements=null}hasPreservedDashlets(){return!!this.preservedDashletViews}initFallbackMode(){this.grid&&(this.grid.destroy(!1),this.grid=null,this.preserveDashletViews()),this.$dashboard.empty();let t=this.$dashboard;t.addClass("fallback"),this.currentTabLayout.forEach(e=>{e=this.prepareFallbackItem(e);t.append(e)}),this.currentTabLayout.forEach(e=>{e.id&&e.name&&(this.getMetadata().get(["dashlets",e.name])?this.hasPreservedDashlets()?this.addPreservedDashlet(e.id):this.createDashletView(e.id,e.name):console.error("Dashlet "+e.name+" doesn't exist or not available."))}),this.clearPreservedDashlets(),this.fallbackModeTimeout&&clearTimeout(this.fallbackModeTimeout),this.$dashboard.css("height",""),this.fallbackControlHeights()}fallbackControlHeights(){this.currentTabLayout.forEach(e=>{let t=this.$dashboard.find('.dashlet-container[data-id="'+e.id+'"]');e=t.find(".panel-heading").outerHeight();let i=t.find(".dashlet-body");var s=i.get(0);s&&s.scrollHeight>s.offsetHeight&&(s=s.scrollHeight+e,t.css("height",s+"px"))}),this.fallbackModeTimeout=setTimeout(()=>{this.fallbackControlHeights()},300)}initGridstack(){this.isFallbackMode()&&this.preserveDashletViews(),this.$dashboard.empty();let e=this.$gridstack=this.$dashboard,t=(e.removeClass("fallback"),this.fallbackModeTimeout&&clearTimeout(this.fallbackModeTimeout),!1),i=!1,s=((this.getUser().isPortal()||this.getPreferences().get("dashboardLocked"))&&(t=!0,i=!0),this.grid=a.default.init({cellHeight:1.14*this.getThemeManager().getParam("dashboardCellHeight"),margin:this.getThemeManager().getParam("dashboardCellMargin")/2,column:12,handle:".panel-heading",disableDrag:t,disableResize:i,disableOneColumnMode:!0,draggable:{distance:10},dragInOptions:{scroll:!1},float:!1,animate:!1,scroll:!1},e.get(0)));s.removeAll(),this.currentTabLayout.forEach(e=>{let t=this.prepareGridstackItem(e.id,e.name);this.getMetadata().get(["dashlets",e.name])&&s.addWidget(t.get(0),{x:e.x*this.WIDTH_MULTIPLIER,y:e.y,w:e.width*this.WIDTH_MULTIPLIER,h:e.height})}),e.find(".grid-stack-item").css("position","absolute"),this.currentTabLayout.forEach(e=>{e.id&&e.name&&(this.getMetadata().get(["dashlets",e.name])?this.hasPreservedDashlets()?this.addPreservedDashlet(e.id):this.createDashletView(e.id,e.name):console.error("Dashlet "+e.name+" doesn't exist or not available."))}),this.clearPreservedDashlets(),this.grid.on("change",()=>{this.fetchLayout(),this.saveLayout()}),this.grid.on("resizestop",e=>{e=$(e.target).data("id");let t=this.getView("dashlet-"+e);t&&t.trigger("resize")})}fetchLayout(){this.dashboardLayout[this.currentTab].layout=_.map(this.$gridstack.find(".grid-stack-item"),e=>{let t=$(e);var e=t.attr("gs-x"),i=t.attr("gs-y"),s=t.attr("gs-h"),a=t.attr("gs-w");return{id:t.data("id"),name:t.data("name"),x:e/this.WIDTH_MULTIPLIER,y:i,width:a/this.WIDTH_MULTIPLIER,height:s}})}prepareGridstackItem(e,t){let i=$("<div>").addClass("grid-stack-item"),s=$('<div class="grid-stack-item-content dashlet-container"></div>');return s.attr("data-id",e),s.attr("data-name",t),i.attr("data-id",e),i.attr("data-name",t),i.append(s),i}prepareFallbackItem(e){let t=$("<div>"),i=$('<div class="dashlet-container">');return i.attr("data-id",e.id),i.attr("data-name",e.name),i.attr("data-x",e.x),i.attr("data-y",e.y),i.attr("data-height",e.height),i.attr("data-width",e.width),i.css("height",e.height*this.getThemeManager().getParam("dashboardCellHeight")+"px"),t.attr("data-id",e.id),t.attr("data-name",e.name),t.append(i),t}saveLayout(e){this.layoutReadOnly||(e={...e||{},dashboardLayout:this.dashboardLayout},this.getPreferences().save(e,{patch:!0}),this.getPreferences().trigger("update"))}removeDashlet(i){let e=!1,t=(this.isFallbackMode()&&(this.initGridstack(),e=!0),this.$gridstack.find('.grid-stack-item[data-id="'+i+'"]')),s=(this.grid.removeWidget(t.get(0),!0),this.dashboardLayout[this.currentTab].layout),a=(s.forEach((e,t)=>{e.id===i&&s.splice(t,1)}),{});var l;a.dashletsOptions=this.getPreferences().get("dashletsOptions")||{},delete a.dashletsOptions[i],a.dashboardLayout=this.dashboardLayout,this.layoutReadOnly||(this.getPreferences().save(a,{patch:!0}),this.getPreferences().trigger("update"),~(l=this.dashletIdList.indexOf(i))&&this.dashletIdList.splice(l,l),this.clearView("dashlet-"+i),this.setupCurrentTabLayout(),e&&this.initFallbackMode())}addDashlet(e){let t=!1;this.isFallbackMode()&&(this.initGridstack(),t=!0);var i="d"+Math.floor(1000001*Math.random()).toString();let s=this.prepareGridstackItem(i,e);this.grid.addWidget(s.get(0),{x:0,y:0,w:2*this.WIDTH_MULTIPLIER,h:2}),this.createDashletView(i,e,e,e=>{this.fetchLayout(),this.saveLayout(),this.setupCurrentTabLayout(),e.getView("body")&&e.getView("body").afterAdding&&e.getView("body").afterAdding.call(e.getView("body")),t&&this.initFallbackMode()})}createDashletView(t,i,s,a){let e={id:t,name:i};return s&&(e.label=s),this.createView("dashlet-"+t,"views/dashlet",{label:i,name:i,id:t,selector:'> .dashlets .dashlet-container[data-id="'+t+'"]',readOnly:this.dashletsReadOnly,locked:this.getPreferences().get("dashboardLocked")},e=>{this.dashletIdList.push(t),e.render(),this.listenToOnce(e,"change",()=>{this.clearView(t),this.createDashletView(t,i,s)}),this.listenToOnce(e,"remove-dashlet",()=>{this.removeDashlet(t)}),a&&a.call(this,e)})}editTabs(){var e=this.getPreferences().get("dashboardLocked");this.createView("editTabs","views/modals/edit-dashboard",{dashboardLayout:this.dashboardLayout,dashboardLocked:e,fromDashboard:!0},e=>{e.render(),this.listenToOnce(e,"after:save",a=>{e.close();let l=[];a.dashboardTabList.forEach(t=>{let i=[],s=null,e=(this.dashboardLayout.forEach(e=>{e.name===t&&(i=e.layout,s=e.id)}),{name:t=t in a.renameMap?a.renameMap[t]:t,layout:i});s&&(e.id=s),l.push(e)}),this.dashletIdList.forEach(e=>{this.clearView("dashlet-"+e)}),this.dashboardLayout=l,this.saveLayout({dashboardLocked:a.dashboardLocked}),this.storeCurrentTab(0),this.currentTab=0,this.setupCurrentTabLayout(),this.reRender()})})}}e.default=s}),define("views/collapsed-modal",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{templateContent=`
        <div class="title-container">
            <a role="button" data-action="expand" class="title">{{title}}</a>
        </div>
        <div class="close-container">
            <a role="button" data-action="close"><span class="fas fa-times"></span></a>
        </div>
    `;events={'click [data-action="expand"]':function(){this.expand()},'click [data-action="close"]':function(){this.close()}};data(){let e=this.title;return{title:e=this.duplicateNumber?this.title+" "+this.duplicateNumber:e}}setup(){this.title=this.options.title||"no-title",this.duplicateNumber=this.options.duplicateNumber||null}expand(){this.trigger("expand")}close(){this.trigger("close")}}e.default=s}),define("views/collapsed-modal-bar",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{maxNumberToDisplay=3;templateContent=`
        {{#each dataList}}
        <div class="collapsed-modal" data-number="{{number}}">{{var key ../this}}</div>
        {{/each}}
    `;data(){return{dataList:this.getDataList()}}init(){this.on("render",()=>{0===$(".collapsed-modal-bar").length&&$("<div />").addClass("collapsed-modal-bar").appendTo("body")})}setup(){this.lastNumber=0,this.numberList=[]}getDataList(){let i=[],e=Espo.Utils.clone(this.numberList);return(e=this.numberList.length>this.maxNumberToDisplay?e.slice(this.numberList.length-this.maxNumberToDisplay):e).reverse().forEach((e,t)=>{i.push({number:e.toString(),key:"key-"+e,index:t})}),i}calculateDuplicateNumber(t){let i=0;return this.numberList.forEach(e=>{e=this.getModalViewByNumber(e);e&&e.title===t&&i++}),0===i?null:i}getModalViewByNumber(e){return this.getView("key-"+e)}addModalView(t,e){let i=this.lastNumber;this.numberList.push(this.lastNumber);var s="key-"+i;this.createView(s,"views/collapsed-modal",{title:e.title,duplicateNumber:this.calculateDuplicateNumber(e.title),selector:'[data-number="'+i+'"]'}).then(e=>{this.listenToOnce(e,"close",()=>{this.removeModalView(i)}),this.listenToOnce(e,"expand",()=>{this.removeModalView(i,!0),setTimeout(()=>{var e="dialog-"+i;this.setView(e,t),t.setSelector(t.containerSelector),this.getView(e).render()},5)}),this.reRender(!0)}),this.lastNumber++}removeModalView(e,t){var i="key-"+e,s=this.numberList.indexOf(e);~s&&this.numberList.splice(s,1),this.isRendered()&&this.$el.find('.collapsed-modal[data-number="'+e+'"]').remove(),t||this.reRender(),this.clearView(i)}}e.default=s}),define("views/clear-cache",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="clear-cache";el="> body";events={'click .action[data-action="clearLocalCache"]':function(){this.clearLocalCache()},'click .action[data-action="returnToApplication"]':function(){this.returnToApplication()}};data(){return{cacheIsEnabled:!!this.options.cache}}clearLocalCache(){this.options.cache.clear(),this.$el.find('.action[data-action="clearLocalCache"]').remove(),this.$el.find(".message-container").removeClass("hidden"),this.$el.find(".message-container span").html(this.translate("Cache has been cleared")),this.$el.find('.action[data-action="returnToApplication"]').removeClass("hidden")}returnToApplication(){this.getRouter().navigate("",{trigger:!0})}}e.default=s}),define("views/about",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="about";data(){return{version:this.getConfig().get("version")}}}e.default=s}),define("views/stream/panel",["exports","views/record/panels/relationship","jquery-textcomplete"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{template="stream/panel";postingMode=!1;postDisabled=!1;relatedListFiltersDisabled=!0;layoutName=null;filterList=["all","posts","updates"];additionalEvents={'focus textarea[data-name="post"]':function(){this.enablePostingMode(!0)},"click button.post":function(){this.post()},'click .action[data-action="switchInternalMode"]':function(e){this.isInternalNoteMode=!this.isInternalNoteMode;e=$(e.currentTarget);this.isInternalNoteMode?e.addClass("enabled"):e.removeClass("enabled")},'keydown textarea[data-name="post"]':function(e){"Control+Enter"===Espo.Utils.getKeyFromKeyEvent(e)&&(e.stopPropagation(),e.preventDefault(),this.post())},'input textarea[data-name="post"]':function(){this.controlPreviewButton(),this.controlPostButtonAvailability(this.$textarea.val())},'click .action[data-action="preview"]':function(){this.preview()}};data(){let e=super.data();return e.postDisabled=this.postDisabled,e.placeholderText=this.placeholderText,e.allowInternalNotes=this.allowInternalNotes,e}controlPreviewButton(){this.$previewButton=this.$previewButton||this.$el.find(".stream-post-preview"),""===this.$textarea.val()?this.$previewButton.addClass("hidden"):this.$previewButton.removeClass("hidden")}enablePostingMode(t){var i;this.$el.find(".buttons-panel").removeClass("hide"),this.postingMode||(this.$textarea.val()&&this.$textarea.val().length&&this.getView("postField").controlTextareaHeight(),i=!1,$("body").on("click.stream-panel",e=>{!t||i?$(e.target).parent().hasClass("remove-attachment")||$.contains(this.$postContainer.get(0),e.target)||""===this.$textarea.val()&&($(e.target).closest(".popover-content").get(0)||(this.seed.get("attachmentsIds")||[]).length||this.getView("attachments")&&this.getView("attachments").isUploading||this.disablePostingMode()):i=!0})),this.postingMode=!0,this.controlPreviewButton()}disablePostingMode(){this.postingMode=!1,this.$textarea.val(""),this.hasView("attachments")&&this.getView("attachments").empty(),this.$el.find(".buttons-panel").addClass("hide"),$("body").off("click.stream-panel"),this.$textarea.prop("rows",1)}setup(){this.events={...this.additionalEvents,...this.events},this.scope=this.model.entityType,this.filter=this.getStoredFilter(),this.setupTitle(),this.placeholderText=this.translate("writeYourCommentHere","messages"),this.allowInternalNotes=!1,this.getUser().isPortal()||(this.allowInternalNotes=this.getMetadata().get(["clientDefs",this.scope,"allowInternalNotes"])),this.isInternalNoteMode=!1,this.storageTextKey="stream-post-"+this.model.entityType+"-"+this.model.id,this.storageAttachmentsKey="stream-post-attachments-"+this.model.entityType+"-"+this.model.id,this.storageIsInernalKey="stream-post-is-internal-"+this.model.entityType+"-"+this.model.id,this.on("remove",()=>{this.storeControl(),$(window).off("beforeunload.stream-"+this.cid)}),$(window).off("beforeunload.stream-"+this.cid),$(window).on("beforeunload.stream-"+this.cid,()=>{this.storeControl()});var t=this.getSessionStorage().get(this.storageAttachmentsKey);this.setupActions(),this.wait(!0),this.getModelFactory().create("Note",e=>{this.seed=e,t&&(this.hasStoredAttachments=!0,this.seed.set({attachmentsIds:t.idList,attachmentsNames:t.names,attachmentsTypes:t.types})),this.allowInternalNotes&&(this.getMetadata().get(["entityDefs","Note","fields","isInternal","default"])&&(this.isInternalNoteMode=!0),this.getSessionStorage().has(this.storageIsInernalKey)&&(this.isInternalNoteMode=this.getSessionStorage().get(this.storageIsInernalKey))),this.isInternalNoteMode&&this.seed.set("isInternal",!0),this.createView("postField","views/note/fields/post",{selector:".textarea-container",name:"post",mode:"edit",params:{required:!0,rowsMin:1,rows:25},model:this.seed,placeholderText:this.placeholderText,noResize:!0},e=>{this.initPostEvents(e)}),this.createCollection(()=>{this.wait(!1)}),this.listenTo(this.seed,"change:attachmentsIds",()=>{this.controlPostButtonAvailability()})}),this.defs.hidden||this.subscribeToWebSocket(),this.once("show",()=>{this.isSubscribedToWebSocket||this.subscribeToWebSocket()}),this.once("remove",()=>{this.isSubscribedToWebSocket&&this.unsubscribeFromWebSocket()})}subscribeToWebSocket(){var e;this.getHelper().webSocketManager&&"User"!==this.model.entityType&&(e="streamUpdate."+this.model.entityType+"."+this.model.id,this.streamUpdateWebSocketTopic=e,this.isSubscribedToWebSocket=!0,this.getHelper().webSocketManager.subscribe(e,(e,t)=>{if(t.createdById!==this.getUser().id)if(t.noteId){let e=this.collection.get(t.noteId);void(e&&e.fetch())}else this.collection.fetchNew()}))}unsubscribeFromWebSocket(){this.getHelper().webSocketManager.unsubscribe(this.streamUpdateWebSocketTopic)}setupTitle(){this.title=this.translate("Stream"),this.titleHtml=this.title,this.filter&&"all"!==this.filter&&(this.titleHtml+=" &middot; "+this.translate(this.filter,"filters","Note"))}storeControl(){var e=!1,t=(this.$textarea&&this.$textarea.length&&((t=this.$textarea.val()).length?(this.getSessionStorage().set(this.storageTextKey,t),e=!0):this.hasStoredText&&this.getSessionStorage().clear(this.storageTextKey)),this.seed.get("attachmentsIds")||[]);t.length?(this.getSessionStorage().set(this.storageAttachmentsKey,{idList:t,names:this.seed.get("attachmentsNames")||{},types:this.seed.get("attachmentsTypes")||{}}),e=!0):this.hasStoredAttachments&&this.getSessionStorage().clear(this.storageAttachmentsKey),e?this.getSessionStorage().set(this.storageIsInernalKey,this.isInternalNoteMode):this.getSessionStorage().clear(this.storageIsInernalKey)}createCollection(t,i){this.getCollectionFactory().create("Note",e=>{(this.collection=e).url=this.model.entityType+"/"+this.model.id+"/stream",e.maxSize=this.getConfig().get("recordsPerPageSmall")||5,this.setFilter(this.filter),t.call(i)})}initPostEvents(e){this.listenTo(e,"add-files",e=>{this.getView("attachments").uploadFiles(e),this.postingMode||this.enablePostingMode()})}afterRender(){this.$textarea=this.$el.find('textarea[data-name="post"]'),this.$attachments=this.$el.find("div.attachments"),this.$postContainer=this.$el.find(".post-container"),this.$postButton=this.$el.find("button.post");var e=this.getSessionStorage().get(this.storageTextKey);e&&e.length&&(this.hasStoredText=!0,this.$textarea.val(e)),this.controlPostButtonAvailability(e),this.isInternalNoteMode&&this.$el.find('.action[data-action="switchInternalMode"]').addClass("enabled");let t=this.collection,i=(this.listenToOnce(t,"sync",()=>{this.createView("list","views/stream/record/list",{selector:"> .list-container",collection:t,model:this.model},e=>{e.render()}),this.stopListening(this.model,"all"),this.stopListening(this.model,"destroy"),setTimeout(()=>{this.listenTo(this.model,"all",e=>{~["sync","after:relate"].indexOf(e)&&t.fetchNew()}),this.listenTo(this.model,"destroy",()=>{this.stopListening(this.model,"all")})},500)}),this.defs.hidden?this.once("show",()=>t.fetch()):t.fetch(),this.getAcl().getPermissionLevel("assignmentPermission"));"no"!==i&&(this.$textarea.textcomplete([{match:/(^|\s)@(\w*)$/,index:2,search:(e,t)=>{0!==e.length?Espo.Ajax.getRequest((e=>{e="User?orderBy=name&limit=7&q="+e+"&"+$.param({primaryFilter:"active"});return"team"===i&&(e+="&"+$.param({boolFilterList:["onlyMyTeam"]})),e})(e)).then(e=>t(e.list)):t([])},template:e=>this.getHelper().escapeString(e.name)+' <span class="text-muted">@'+this.getHelper().escapeString(e.userName)+"</span>",replace:e=>"$1@"+e.userName}]),this.once("remove",()=>{this.$textarea.length&&this.$textarea.textcomplete("destroy")}));var e=this.$el.find(".buttons-panel a.stream-post-info"),s=this.translate("infoMention","messages","Stream"),a=this.translate("infoSyntax","messages","Stream");let l=[],r=([["code","`{text}`"],["multilineCode","```{text}```"],["strongText","**{text}**"],["emphasizedText","*{text}*"],["deletedText","~~{text}~~"],["blockquote","> {text}"],["link","[{text}](url)"]].forEach(e=>{var t=this.translate(e[0],"syntaxItems","Stream"),e=e[1].replace("{text}",t);l.push(e)}),$("<ul>").append(l.map(e=>$("<li>").text(e))));s=this.getHelper().transformMarkdownInlineText(s)+"<br><br>"+this.getHelper().transformMarkdownInlineText(a)+":<br>"+r.get(0).outerHTML;Espo.Ui.popover(e,{content:s},this),this.createView("attachments","views/stream/fields/attachment-multiple",{model:this.seed,mode:"edit",selector:"div.attachments-container",defs:{name:"attachments"}},e=>{e.render()})}afterPost(){this.$el.find("textarea.note").prop("rows",1)}post(){let t=this.$textarea.val();this.disablePostButton(),this.$textarea.prop("disabled",!0),this.getModelFactory().create("Note",e=>this.getView("attachments").validateReady()?(this.$textarea.prop("disabled",!1),void this.enablePostButton()):""===t.trim()&&0===(this.seed.get("attachmentsIds")||[]).length?(this.notify("Post cannot be empty","error"),this.$textarea.prop("disabled",!1),this.controlPostButtonAvailability(),void this.$textarea.focus()):(e.set("post",t),e.set("attachmentsIds",Espo.Utils.clone(this.seed.get("attachmentsIds")||[])),e.set("type","Post"),e.set("isInternal",this.isInternalNoteMode),this.prepareNoteForPost(e),Espo.Ui.notify(" ... "),void e.save(null).then(()=>{Espo.Ui.success(this.translate("Posted")),this.collection.fetchNew(),this.$textarea.prop("disabled",!1),this.disablePostingMode(),this.afterPost(),this.getPreferences().get("followEntityOnStreamPost")&&this.model.set("isFollowed",!0),this.getSessionStorage().clear(this.storageTextKey),this.getSessionStorage().clear(this.storageAttachmentsKey),this.getSessionStorage().clear(this.storageIsInernalKey)}).catch(()=>{this.$textarea.prop("disabled",!1),this.controlPostButtonAvailability()})))}prepareNoteForPost(e){e.set("parentId",this.model.id),e.set("parentType",this.model.entityType)}getButtonList(){return[]}setupActions(){this.actionList=[],this.actionList.push({action:"viewPostList",html:$("<span>").append($("<span>").text(this.translate("View List"))," &middot; ",$("<span>").text(this.translate("posts","filters","Note"))).get(0).innerHTML,onClick:()=>this.actionViewPostList()}),this.actionList.push(!1),this.filterList.forEach(e=>{var t="all"===e?!this.filter:e===this.filter;this.actionList.push({action:"selectFilter",html:$("<span>").append($("<span>").addClass("check-icon fas fa-check pull-right").addClass(t?"":" hidden"),$("<div>").text(this.translate(e,"filters","Note"))).get(0).innerHTML,data:{name:e}})})}actionViewPostList(){var e={scope:"Note",viewOptions:{url:this.model.entityType+"/"+this.model.id+"/posts",title:this.translate("Stream")+" @right "+this.translate("posts","filters","Note"),forceSelectAllAttributes:!0}};this.actionViewRelatedList(e)}getStoredFilter(){return this.getStorage().get("state","streamPanelFilter"+this.scope)||null}storeFilter(e){e?this.getStorage().set("state","streamPanelFilter"+this.scope,e):this.getStorage().clear("state","streamPanelFilter"+this.scope)}setFilter(e){this.filter=e,this.collection.data.filter=null,e&&(this.collection.data.filter=e)}actionRefresh(){this.hasView("list")&&this.getView("list").showNewRecords()}preview(){this.createView("dialog","views/modal",{templateContent:'<div class="complex-text">{{complexText viewObject.options.text linksInNewTab=true}}</div>',text:this.$textarea.val(),headerText:this.translate("Preview"),backdrop:!0},e=>{e.render()})}controlPostButtonAvailability(e){var t=this.seed.get("attachmentsIds")||[];let i=this.seed.get("post");if(!(i=void 0!==e?e:i)&&!t.length)return this.$postButton.hasClass("disabled")?void 0:void this.disablePostButton();this.$postButton.hasClass("disabled")&&this.enablePostButton()}disablePostButton(){this.$postButton.addClass("disabled").attr("disabled","disabled")}enablePostButton(){this.$postButton.removeClass("disabled").removeAttr("disabled")}}e.default=a}),define("views/stream/message",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{data(){return this.dataForTemplate}setup(){let t=this.options.messageTemplate;var i,s,a=Espo.Utils.clone(this.options.messageData||{});for(i in this.dataForTemplate={},a){let e=a[i]||"";0!==i.indexOf("html:")?e instanceof jQuery?(this.dataForTemplate[i]=e.get(0).outerHTML,t=t.replace("{"+i+"}","{{{"+i+"}}}")):e instanceof Element?(this.dataForTemplate[i]=e.outerHTML,t=t.replace("{"+i+"}","{{{"+i+"}}}")):e.indexOf&&(t=0!==e.indexOf("field:")?(this.dataForTemplate[i]=e,t.replace("{"+i+"}","{{"+i+"}}")):(s=e.substring(6),this.createField(i,s),s=this.getHelper().escapeString(i),t.replace("{"+i+"}",`<span data-key="${s}">{{{${i}}}}</span>`))):(i=i.substring(5),this.dataForTemplate[i]=e,t=t.replace("{"+i+"}","{{{"+i+"}}}"))}this.templateContent=t}createField(e,t,i,s){i=i||this.model.getFieldType(t)||"base",this.createView(e,this.getFieldManager().getViewName(i),{model:this.model,defs:{name:t,params:s||{}},mode:"detail",readOnly:!0,selector:`[data-key="${e}"]`})}}e.default=s}),define("views/stream/row-actions/default",["views/record/row-actions/edit-and-remove"],function(e){return e.extend({getActionList:function(){var e=[];return this.options.acl.edit&&this.options.isEditable&&e.push({action:"quickEdit",label:"Edit",data:{id:this.model.id}}),this.options.acl.edit&&this.options.isRemovable&&e.push({action:"quickRemove",label:"Remove",data:{id:this.model.id}}),e}})}),define("views/stream/record/list",["exports","views/record/list-expanded"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="listStream";massActionsDisabled=!0;setup(){this.itemViews=this.getMetadata().get("clientDefs.Note.itemViews")||{},super.setup(),this.isRenderingNew=!1,this.listenTo(this.collection,"sync",(e,t,i)=>{if(i.fetchNew&&!this.isRenderingNew){i=i.lengthBeforeFetch||0;if(0!==i){let l=this.$el.find(this.listContainerEl);i=this.collection.length-i;if(0!=i){this.isRenderingNew=!0;for(let a=i-1;0<=a;a--){let s=this.collection.at(a);this.buildRow(a,s,e=>{0===a&&(this.isRenderingNew=!1);let t=$(this.getRowContainerHtml(s.id));var i=this.$el.find(`[data-id="${s.id}"]`);i.length&&(t=i),i.length||l.prepend(t),e.render()})}}}else this.buildRows(()=>this.reRender())}}),this.events["auxclick a[href][data-scope][data-id]"]=t=>{if(1===t.button&&(t.ctrlKey||t.metaKey)){let e=$(t.currentTarget);var i=e.attr("data-id"),s=e.attr("data-scope");t.preventDefault(),t.stopPropagation(),this.actionQuickView({id:i,scope:s})}}}buildRow(e,t,i){var s=t.id,a=(this.rowList.push(s),t.get("type")),a=this.itemViews[a]||"views/stream/notes/"+Espo.Utils.camelCaseToHyphen(a);this.createView(s,a,{model:t,parentModel:this.model,acl:{edit:this.getAcl().checkModel(t,"edit")},isUserStream:this.options.isUserStream,noEdit:this.options.noEdit,optionsToPass:["acl"],name:this.type+"-"+t.entityType,selector:'li[data-id="'+t.id+'"]',setViewBeforeCallback:this.options.skipBuildRows&&!this.isRendered()},i)}buildRows(i){if(this.checkedList=[],this.rowList=[],0<this.collection.length){this.wait(!0);let e=this.collection.models.length,t=0;for(var s in this.collection.models){var a=this.collection.models[s];this.buildRow(s,a,()=>{++t===e&&("function"==typeof i&&i(),this.wait(!1),this.trigger("after:build-rows"))})}}else"function"==typeof i&&(i(),this.trigger("after:build-rows"))}showNewRecords(){this.collection.fetchNew()}}e.default=s}),define("views/stream/record/edit",["exports","views/record/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="stream/record/edit";postingMode=!1;dependencyDefs={targetType:{map:{users:[{action:"hide",fields:["teams","portals"]},{action:"show",fields:["users"]},{action:"setNotRequired",fields:["teams","portals"]},{action:"setRequired",fields:["users"]}],teams:[{action:"hide",fields:["users","portals"]},{action:"show",fields:["teams"]},{action:"setRequired",fields:["teams"]},{action:"setNotRequired",fields:["users","portals"]}],portals:[{action:"hide",fields:["users","teams"]},{action:"show",fields:["portals"]},{action:"setRequired",fields:["portals"]},{action:"setNotRequired",fields:["users","teams"]}]},default:[{action:"hide",fields:["teams","users","portals"]},{action:"setNotRequired",fields:["teams","users","portals"]}]}};data(){let e=super.data();return e.interactiveMode=this.options.interactiveMode,e}setup(){super.setup(),this.seed=this.model.clone(),this.options.interactiveMode&&(this.events['focus textarea[data-name="post"]']=()=>{this.enablePostingMode()},this.events['keydown textarea[data-name="post"]']=e=>{"Control+Enter"===Espo.Utils.getKeyFromKeyEvent(e)&&(e.stopPropagation(),e.preventDefault(),this.post())},this.events["click button.post"]=()=>{this.post()});let e=["self"];this.model.set("type","Post"),this.model.set("targetType","self");var t=this.getAcl().getPermissionLevel("message"),i=this.getAcl().getPermissionLevel("portal");"team"!==t&&"all"!==t||(e.push("users"),e.push("teams")),"all"===t&&e.push("all"),"yes"===i&&(e.push("portals"),~e.indexOf("users")||e.push("users")),this.createField("targetType","views/fields/enum",{options:e}),this.createField("users","views/note/fields/users",{}),this.createField("teams","views/fields/teams",{}),this.createField("portals","views/fields/link-multiple",{}),this.createField("post","views/note/fields/post",{required:!0,rowsMin:1,rows:25,noResize:!0}),this.createField("attachments","views/stream/fields/attachment-multiple",{}),this.listenTo(this.model,"change",()=>{this.postingMode&&this.setConfirmLeaveOut(!0)})}disablePostingMode(){this.postingMode=!1,this.$el.find(".post-control").addClass("hidden"),this.setConfirmLeaveOut(!1),$("body").off("click.stream-create-post"),this.getFieldView("post").$element.prop("rows",1)}enablePostingMode(){if(this.$el.find(".post-control").removeClass("hidden"),!this.postingMode){let e=$("body");e.off("click.stream-create-post"),e.on("click.stream-create-post",e=>{!$.contains(window.document.body,e.target)||$.contains(this.$el.get(0),e.target)||$(e.target).closest(".modal-dialog").length||this.getFieldView("post")&&""===this.getFieldView("post").$element.val()&&((this.model.get("attachmentsIds")||[]).length||this.disablePostingMode())})}this.postingMode=!0}afterRender(){this.$postButton=this.$el.find("button.post");var e=this.getFieldView("post");e&&(this.stopListening(e,"add-files"),this.listenTo(e,"add-files",e=>{this.enablePostingMode();let t=this.getFieldView("attachments");t&&t.uploadFiles(e)}))}validate(){let e=super.validate(),t=this.model.get("post")||"";return e=""!==t.trim()||(this.model.get("attachmentsIds")||[]).length?e:!0}post(){this.save()}beforeBeforeSave(){this.disablePostButton()}beforeSave(){Espo.Ui.notify(" ... ")}afterSave(){Espo.Ui.success(this.translate("Posted")),this.options.interactiveMode&&(this.model.clear(),this.model.set("targetType","self"),this.model.set("type","Post"),this.disablePostingMode(),this.enablePostButton(),this.getFieldView("post").$element.prop("rows",1))}afterNotValid(){this.enablePostButton()}disablePostButton(){this.trigger("disable-post-button"),this.$postButton.addClass("disable").attr("disabled","disabled")}enablePostButton(){this.trigger("enable-post-button"),this.$postButton.removeClass("disable").removeAttr("disabled")}}e.default=s}),define("views/stream/notes/update",["exports","views/stream/note"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="stream/notes/update";messageName="update";data(){return{...super.data(),fieldsArr:this.fieldsArr,parentType:this.model.get("parentType")}}init(){this.getUser().isAdmin()&&(this.isRemovable=!0),super.init()}setup(){this.addActionHandler("expandDetails",(e,t)=>this.toggleDetails(e,t)),this.createMessage(),this.wait(!0),this.getModelFactory().create(this.model.get("parentType"),a=>{let l=a,r=a.clone(),o=this.model.get("data"),e=(o.attributes=o.attributes||{},l.set(o.attributes.was),r.set(o.attributes.became),this.fieldsArr=[],o.fields);e.forEach(e=>{var t,i=a.getFieldType(e)||"base",i=this.getMetadata().get(["entityDefs",a.entityType,"fields",e,"view"])||this.getFieldManager().getViewName(i);let s=!1;for(t of this.getFieldManager().getEntityTypeFieldAttributeList(a.entityType,e))if(t in o.attributes.was){s=!0;break}s?(this.createView(e+"Was",i,{model:l,readOnly:!0,defs:{name:e},mode:"detail",inlineEditDisabled:!0}),this.createView(e+"Became",i,{model:r,readOnly:!0,defs:{name:e},mode:"detail",inlineEditDisabled:!0}),this.fieldsArr.push({field:e,was:e+"Was",became:e+"Became"})):this.fieldsArr.push({field:e,noValues:!0})}),this.wait(!1)})}toggleDetails(e,t){if(this.$el.find(".details").hasClass("hidden"))return this.$el.find(".details").removeClass("hidden"),void $(t).find("span").removeClass("fa-chevron-down").addClass("fa-chevron-up");this.$el.find(".details").addClass("hidden"),$(t).find("span").addClass("fa-chevron-down").removeClass("fa-chevron-up")}}e.default=s}),define("views/stream/notes/unrelate",["exports","views/stream/notes/relate"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="stream/notes/create-related";messageName="unrelate"}e.default=s}),define("views/stream/notes/status",["exports","views/stream/note"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="stream/notes/status";messageName="status";data(){return{...super.data(),style:this.style,statusText:this.statusText}}init(){this.getUser().isAdmin()&&(this.isRemovable=!0),super.init()}setup(){var e=this.model.get("data"),t=e.field,i=e.value;this.style=e.style||"default",this.statusText=this.getLanguage().translateOption(i,t,this.model.get("parentType")),this.messageData.field=this.translate(t,"fields",this.model.get("parentType")).toLowerCase(),this.createMessage()}}e.default=s}),define("views/stream/notes/post",["exports","views/stream/note"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="stream/notes/post";messageName="post";isEditable=!0;isRemovable=!0;data(){let e=super.data();return e.showAttachments=!!(this.model.get("attachmentsIds")||[]).length,e.showPost=!!this.model.get("post"),e.isInternal=this.isInternal,e}setup(){if(this.createField("post",null,null,"views/stream/fields/post"),this.createField("attachments","attachmentMultiple",{},"views/stream/fields/attachment-multiple",{previewSize:this.options.isNotification?"small":"medium"}),this.isInternal=this.model.get("isInternal"),!this.model.get("post")&&this.model.get("parentId")&&(this.messageName="attach",this.isThis&&(this.messageName+="This")),this.listenTo(this.model,"change",()=>{(this.model.hasChanged("post")||this.model.hasChanged("attachmentsIds"))&&this.reRender()}),this.model.get("parentId"))this.createMessage();else{if(this.model.get("isGlobal"))return this.messageName="postTargetAll",void this.createMessage();if(this.model.has("teamsIds")&&this.model.get("teamsIds").length){let e=this.model.get("teamsIds"),i=this.model.get("teamsNames")||{},s=(this.messageName="postTargetTeam",1<e.length&&(this.messageName="postTargetTeams"),[]);return e.forEach(e=>{var t=i[e];t&&s.push($("<a>").attr("href","#Team/view/"+e).text(t).get(0).outerHTML)}),this.messageData["html:target"]=s.join(", "),void this.createMessage()}if(this.model.has("portalsIds")&&this.model.get("portalsIds").length){let e=this.model.get("portalsIds"),i=this.model.get("portalsNames")||{},s=(this.messageName="postTargetPortal",1<e.length&&(this.messageName="postTargetPortals"),[]);return e.forEach(e=>{var t=i[e];t&&s.push($("<a>").attr("href","#Portal/view/"+e).text(t).get(0).outerHTML)}),this.messageData["html:target"]=s.join(", "),void this.createMessage()}if(this.model.has("usersIds")&&this.model.get("usersIds").length){let i=this.model.get("usersIds"),s=this.model.get("usersNames")||{};if(this.messageName="postTarget",1===i.length&&i[0]===this.model.get("createdById"))return this.messageName="postTargetSelf",void this.createMessage();let a=[];i.forEach(e=>{if(e===this.getUser().id)return this.messageName="postTargetYou",void(1<i.length&&(e===this.model.get("createdById")?this.messageName="postTargetSelfAndOthers":this.messageName="postTargetYouAndOthers"));var t;e!==this.model.get("createdById")?(t=s[e])&&a.push($("<a>").attr("href","#User/view/"+e).attr("data-scope","User").attr("data-id",e).text(t).get(0).outerHTML):this.messageName="postTargetSelfAndOthers"}),this.messageData["html:target"]=a.join(", "),this.createMessage()}else this.createMessage()}}}e.default=s}),define("views/stream/notes/mention-in-post",["exports","views/stream/note"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="stream/notes/post";messageName="mentionInPost";data(){return{...super.data(),showAttachments:!!(this.model.get("attachmentsIds")||[]).length,showPost:!!this.model.get("post")}}setup(){if(this.model.get("post")&&this.createField("post",null,null,"views/stream/fields/post"),(this.model.get("attachmentsIds")||[]).length&&this.createField("attachments","attachmentMultiple",{},"views/stream/fields/attachment-multiple",{previewSize:this.options.isNotification?"small":null}),this.messageData.mentioned=this.options.userId,this.model.get("parentId")||(this.messageName="mentionInPostTarget"),this.isUserStream&&this.options.userId===this.getUser().id){if(this.model.get("parentId"))return this.messageName="mentionYouInPost",void this.createMessage();if(this.messageName="mentionYouInPostTarget",this.model.get("isGlobal"))return this.messageName="mentionYouInPostTargetAll",void this.createMessage();if(this.messageName="mentionYouInPostTarget",this.model.has("teamsIds")&&this.model.get("teamsIds").length){let e=this.model.get("teamsIds"),i=this.model.get("teamsNames")||{},s=[];return e.forEach(e=>{var t=i[e];t&&s.push($("<a>").attr("href","#Team/view/"+e).text(t).get(0).outerHTML)}),this.messageData["html:target"]=s.join(", "),void this.createMessage()}if(this.model.has("usersIds")&&this.model.get("usersIds").length){var e=this.model.get("usersIds"),s=this.model.get("usersNames")||{};if(1===e.length&&e[0]===this.model.get("createdById"))return this.messageName="mentionYouInPostTargetNoTarget",void this.createMessage();let i=[];return e.forEach(e=>{var t=s[e];t&&i.push($("<a>").attr("href","#User/view/"+e).text(t).get(0).outerHTML)}),this.messageData["html:target"]=i.join(", "),void this.createMessage()}"self"===this.model.get("targetType")&&(this.messageName="mentionYouInPostTargetNoTarget"),this.createMessage()}else this.createMessage()}}e.default=s}),define("views/stream/notes/email-sent",["exports","views/stream/note"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="stream/notes/email-sent";isRemovable=!1;data(){return{...super.data(),emailId:this.emailId,emailName:this.emailName,hasPost:this.hasPost,hasAttachments:this.hasAttachments,emailIconClassName:this.getMetadata().get(["clientDefs","Email","iconClass"])||""}}setup(){var e=this.model.get("data")||{};this.emailId=e.emailId,this.emailName=e.emailName,this.parentModel&&this.model.get("parentType")===this.parentModel.entityType&&this.model.get("parentId")===this.parentModel.id&&(this.model.get("post")&&(this.createField("post",null,null,"views/stream/fields/post"),this.hasPost=!0),(this.model.get("attachmentsIds")||[]).length&&(this.createField("attachments","attachmentMultiple",{},"views/stream/fields/attachment-multiple"),this.hasAttachments=!0)),this.messageData.email=$("<a>").attr("href","#Email/view/"+e.emailId).text(e.emailName),this.messageName="emailSent",this.messageData.by=$("<a>").attr("href","#"+e.personEntityType+"/view/"+e.personEntityId).text(e.personEntityName),this.isThis&&(this.messageName+="This"),this.createMessage()}}e.default=s}),define("views/stream/notes/email-received",["exports","views/stream/note"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="stream/notes/email-received";isRemovable=!1;isSystemAvatar=!0;data(){return{...super.data(),emailId:this.emailId,emailName:this.emailName,hasPost:this.hasPost,hasAttachments:this.hasAttachments,emailIconClassName:this.getMetadata().get(["clientDefs","Email","iconClass"])||""}}setup(){var e=this.model.get("data")||{};this.emailId=e.emailId,this.emailName=e.emailName,this.parentModel&&this.model.get("parentType")===this.parentModel.entityType&&this.model.get("parentId")===this.parentModel.id&&(this.model.get("post")&&(this.createField("post",null,null,"views/stream/fields/post"),this.hasPost=!0),(this.model.get("attachmentsIds")||[]).length&&(this.createField("attachments","attachmentMultiple",{},"views/stream/fields/attachment-multiple"),this.hasAttachments=!0)),this.messageData.email=$("<a>").attr("href","#Email/view/"+e.emailId).text(e.emailName),this.messageName="emailReceived",e.isInitial&&(this.messageName+="Initial"),e.personEntityId&&(this.messageName+="From",this.messageData.from=$("<a>").attr("href","#"+e.personEntityType+"/view/"+e.personEntityId).text(e.personEntityName)),this.model.get("parentType")===e.personEntityType&&this.model.get("parentId")===e.personEntityId&&(this.isThis=!0),this.isThis&&(this.messageName+="This"),this.createMessage()}}e.default=s}),define("views/stream/notes/create",["exports","views/stream/note"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="stream/notes/create";assigned=!1;messageName="create";isRemovable=!1;data(){return{...super.data(),statusText:this.statusText,statusStyle:this.statusStyle}}setup(){this.model.get("data")&&this.setupData(),this.createMessage()}setupData(){var e,t,i=this.model.get("data");this.assignedUserId=i.assignedUserId||null,this.assignedUserName=i.assignedUserName||null,this.messageData.assignee=$("<a>").attr("href","#User/view/"+this.assignedUserId).text(this.assignedUserName);let s=!1;this.isUserStream&&this.assignedUserId===this.getUser().id&&(s=!0),this.assignedUserId&&(this.messageName="createAssigned",this.isThis?(this.messageName+="This",this.assignedUserId===this.model.get("createdById")&&(this.messageName+="Self")):this.assignedUserId===this.model.get("createdById")?this.messageName+="Self":s&&(this.messageName+="You")),i.statusField&&(e=this.statusField=i.statusField,t=i.statusValue,this.statusStyle=i.statusStyle||"default",this.statusText=this.getLanguage().translateOption(t,e,this.model.get("parentType")))}}e.default=s}),define("views/stream/notes/create-related",["exports","views/stream/note"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="stream/notes/create-related";messageName="createRelated";data(){return{...super.data(),relatedTypeString:this.translateEntityType(this.entityType),iconHtml:this.getIconHtml(this.entityType,this.entityId)}}init(){this.getUser().isAdmin()&&(this.isRemovable=!0),super.init()}setup(){var e=this.model.get("data")||{};this.entityType=this.model.get("relatedType")||e.entityType||null,this.entityId=this.model.get("relatedId")||e.entityId||null,this.entityName=this.model.get("relatedName")||e.entityName||null,this.messageData.relatedEntityType=this.translateEntityType(this.entityType),this.messageData.relatedEntity=$("<a>").attr("href","#"+this.entityType+"/view/"+this.entityId).text(this.entityName),this.createMessage()}}e.default=s}),define("views/stream/notes/assign",["exports","views/stream/note"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="stream/notes/assign";messageName="assign";init(){this.getUser().isAdmin()&&(this.isRemovable=!0),super.init()}setup(){var e=this.model.get("data");this.assignedUserId=e.assignedUserId||null,this.assignedUserName=e.assignedUserName||null,this.messageData.assignee=$("<a>").attr("href","#User/view/"+e.assignedUserId).text(e.assignedUserName),this.isUserStream?this.assignedUserId?this.assignedUserId===this.model.get("createdById")?this.messageName+="Self":this.assignedUserId===this.getUser().id&&(this.messageName+="You"):this.messageName+="Void":this.assignedUserId?this.assignedUserId===this.model.get("createdById")&&(this.messageName+="Self"):this.messageName+="Void",this.createMessage()}}e.default=s}),define("views/stream/modals/create-post",["exports","views/modal"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{templateContent='<div class="record">{{{record}}}</div>';shortcutKeys={"Control+Enter":"post"};setup(){this.headerText=this.translate("Create Post"),this.buttonList=[{name:"post",label:"Post",style:"primary",title:"Ctrl+Enter",onClick:()=>this.post()},{name:"cancel",label:"Cancel",title:"Esc",onClick:e=>{e.close()}}],this.wait(!0),this.getModelFactory().create("Note",e=>{this.createView("record","views/stream/record/edit",{model:e,selector:".record"},e=>{this.listenTo(e,"after:save",()=>{this.trigger("after:save")}),this.listenTo(e,"disable-post-button",()=>this.disableButton("post")),this.listenTo(e,"enable-post-button",()=>this.enableButton("post"))}),this.wait(!1)})}getRecordView(){return this.getView("record")}post(){this.getRecordView().save()}}e.default=s}),define("views/stream/fields/post",["views/fields/text"],function(e){return e.extend({getValueForDisplay:function(){let s=e.prototype.getValueForDisplay.call(this);if(this.isDetailMode()||this.isListMode()){let i=(this.model.get("data")||{}).mentions||{};Object.keys(i).sort((e,t)=>e.length<t.length).forEach(e=>{var t="["+i[e].name+"](#User/view/"+i[e].id+")";s=s.replace(new RegExp(e,"g"),t)})}return s}})}),define("views/stream/fields/attachment-multiple",["views/fields/attachment-multiple"],function(e){return e.extend({showPreviews:!0,showPreviewsInListMode:!0})}),define("views/site/navbar",["exports","view","jquery"],function(e,t,v){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),v=i(v);class s extends t.default{template="site/navbar";currentTab=null;events={"click .navbar-collapse.in a.nav-link":function(e){let t=(0,v.default)(e.currentTarget);t.attr("href")&&this.xsCollapse()},"click a.nav-link":function(){this.isSideMenuOpened&&this.closeSideMenu()},"click a.navbar-brand.nav-link":function(){this.xsCollapse()},'click a[data-action="quick-create"]':function(e){e.preventDefault();e=(0,v.default)(e.currentTarget).data("name");this.quickCreate(e)},"click a.minimizer":function(){this.switchMinimizer()},"click a.side-menu-button":function(){this.switchSideMenu()},"click a.action":function(e){Espo.Utils.handleAction(this,e.originalEvent,e.currentTarget)},'click [data-action="toggleCollapsable"]':function(){this.toggleCollapsable()},"click li.show-more a":function(e){e.stopPropagation(),this.showMoreTabs()},"click .not-in-more > .nav-link-group":function(e){this.handleGroupDropdownClick(e)},"click .in-more .nav-link-group":function(e){this.handleGroupDropdownClick(e)}};data(){return{tabDefsList1:this.tabDefsList.filter(e=>!e.isInMore),tabDefsList2:this.tabDefsList.filter(e=>e.isInMore),title:this.options.title,menuDataList:this.getMenuDataList(),quickCreateList:this.quickCreateList,enableQuickCreate:0<this.quickCreateList.length,userId:this.getUser().id,logoSrc:this.getLogoSrc()}}handleGroupDropdownClick(e){let t=(0,v.default)(e.currentTarget).parent();if(t.parent().hasClass("more-dropdown-menu"))return e.stopPropagation(),t.hasClass("open")?void t.removeClass("open"):void this.handleGroupDropdownInMoreOpen(t);t.hasClass("open")||this.handleGroupDropdownOpen(t)}handleGroupMenuPosition(t,i){if(this.navbarAdjustmentHandler&&this.navbarAdjustmentHandler.handleGroupMenuPosition())this.handleGroupMenuPosition(t,i);else{var s=i.get(0).getBoundingClientRect(),a=window.innerHeight,l=this.isSide();if(!l&&!i.parent().hasClass("more-dropdown-menu"))return r=a-s.bottom,void this.handleGroupMenuScrolling(t,i,r);var r=t.children().length,l=(l?this.$tabs.find("> .tab"):this.$tabs.find(".tab-group > ul > li:visible")).height()*r;let e=s.top-1;e+l>a&&(e=a-l-2)<0&&(e=0),t.css({top:e+"px"});r=a-e;this.handleGroupMenuScrolling(t,i,r)}}handleGroupMenuScrolling(e,t,i){e.css({maxHeight:i+"px"});let s=(0,v.default)(window);s.off("scroll.navbar-tab-group"),s.on("scroll.navbar-tab-group",()=>{e.get(0)&&t.get(0)&&t.hasClass("open")&&e.scrollTop(s.scrollTop())})}handleGroupDropdownOpen(e){var t=e.find(".dropdown-menu");this.handleGroupMenuPosition(t,e),setTimeout(()=>{this.adjustBodyMinHeight()},50),e.off("hidden.bs.dropdown"),e.on("hidden.bs.dropdown",()=>{this.adjustBodyMinHeight()})}handleGroupDropdownInMoreOpen(e){this.$el.find(".tab-group.tab.dropdown").removeClass("open");let t=this.$el.find(".more-dropdown-menu"),i=(e.addClass("open"),e.find(".dropdown-menu"));var s=t.get(0).getBoundingClientRect(),a=s.right;i.css({left:a+"px"}),this.handleGroupMenuPosition(i,e),this.adjustBodyMinHeight(),this.isSide()||a+i.width()>window.innerWidth&&i.css({left:s.left-i.width()-2})}isCollapsableVisible(){return this.$el.find(".navbar-body").hasClass("in")}toggleCollapsable(){this.isCollapsableVisible()?this.hideCollapsable():this.showCollapsable()}hideCollapsable(){this.$el.find(".navbar-body").removeClass("in")}showCollapsable(){this.$el.find(".navbar-body").addClass("in")}xsCollapse(){this.hideCollapsable()}isMinimized(){return this.$body.hasClass("minimized")}switchSideMenu(){this.isMinimized()&&(this.isSideMenuOpened?this.closeSideMenu():this.openSideMenu())}openSideMenu(){this.isSideMenuOpened=!0,this.$body.addClass("side-menu-opened"),this.$sideMenuBackdrop=(0,v.default)("<div>").addClass("side-menu-backdrop").click(()=>this.closeSideMenu()).appendTo(this.$body),this.$sideMenuBackdrop2=(0,v.default)("<div>").addClass("side-menu-backdrop").click(()=>this.closeSideMenu()).appendTo(this.$navbarRightContainer)}closeSideMenu(){this.isSideMenuOpened=!1,this.$body.removeClass("side-menu-opened"),this.$sideMenuBackdrop.remove(),this.$sideMenuBackdrop2.remove()}switchMinimizer(){let e=this.$body;if(this.isMinimized()?(this.isSideMenuOpened&&this.closeSideMenu(),e.removeClass("minimized"),this.getStorage().set("state","siteLayoutState","expanded")):(e.addClass("minimized"),this.getStorage().set("state","siteLayoutState","collapsed")),window.Event)try{window.dispatchEvent(new Event("resize"))}catch(e){}}getLogoSrc(){var e=this.getConfig().get("companyLogoId");return e?this.getBasePath()+"?entryPoint=LogoImage&id="+e:this.getBasePath()+(this.getThemeManager().getParam("logo")||"client/img/logo.svg")}getTabList(){let e=(this.getPreferences().get("useCustomTabList")?this.getPreferences():this.getConfig()).get("tabList");return e=Espo.Utils.cloneDeep(e||[]),this.isSide()&&e.unshift("Home"),e}getQuickCreateList(){return this.getConfig().get("quickCreateList")||[]}setup(){this.getRouter().on("routed",e=>{e.controller?this.selectTab(e.controller):this.selectTab(!1)}),this.createView("notificationsBadge","views/notification/badge",{selector:".notifications-badge-container"});const e=()=>{this.setupQuickCreateList(),this.setupTabDefsList()};this.setupGlobalSearch(),e(),this.listenTo(this.getHelper().settings,"sync",()=>{e(),this.reRender()}),this.listenTo(this.getHelper().language,"sync",()=>{e(),this.reRender()}),this.once("remove",()=>{(0,v.default)(window).off("resize.navbar"),(0,v.default)(window).off("scroll.navbar"),(0,v.default)(window).off("scroll.navbar-tab-group"),this.$body.removeClass("has-navbar")})}setupQuickCreateList(){let t=this.getMetadata().get("scopes")||{};this.quickCreateList=this.getQuickCreateList().filter(e=>!!t[e]&&((t[e]||{}).disabled?void 0:!(t[e]||{}).acl||this.getAcl().check(e,"create")))}filterTabItem(e){if(~["Home","_delimiter_","_delimiter-ext_"].indexOf(e))return!0;var t=this.getMetadata().get("scopes")||{};if(!t[e])return!1;t=t[e]||{};return t.disabled?void 0:t.acl?this.getAcl().check(e):!t.tabAclPermission||(e=this.getAcl().getPermissionLevel(t.tabAclPermission))&&"no"!==e}setupGlobalSearch(){this.globalSearchAvailable=!1,(this.getConfig().get("globalSearchEntityList")||[]).forEach(e=>{this.globalSearchAvailable||this.getAcl().checkScope(e)&&(this.globalSearchAvailable=!0)}),this.globalSearchAvailable&&this.createView("globalSearch","views/global-search/global-search",{selector:".global-search-container"})}adjustTop(){let t=this.getThemeManager().getParam("screenWidthXs"),a=this.getNavbarHeight(),e=(0,v.default)(window),l=this.$tabs,r=this.$more,o=this.$moreDropdown,i=(e.on("resize.navbar",()=>d()),e.on("scroll.navbar",()=>{this.isMoreDropdownShown&&r.scrollTop(e.scrollTop())}),this.$moreDropdown.on("shown.bs.dropdown",()=>{r.scrollTop(e.scrollTop())}),this.on("show-more-tabs",()=>{r.scrollTop(e.scrollTop())}),()=>{var e=window.innerHeight;window.innerWidth<t?(r.css("max-height",""),r.css("overflow-y","")):(r.css("overflow-y","hidden"),r.css("max-height",e-a+"px"))});e.on("resize.navbar",()=>{i()}),i();const h=()=>{var t=l.children().length;if(!(t<=1)){let e=l.children().eq(t-2);e.prependTo(r)}},c=()=>{let e=r.children().eq(0);e.length&&e.insertBefore(o)};let n=(0,v.default)("#navbar .navbar"),u=(window.innerWidth>=t&&(l.children("li").each(()=>{h()}),n.css("max-height","unset"),n.css("overflow","visible")),this.getThemeManager().getParam("navbarBaseWidth")||555),m=this.tabList.length,p=a+1,f=(this.adjustBodyMinHeightMethodName="adjustBodyMinHeightTop",(0,v.default)("#nav-more-tabs-dropdown")),g=f.closest("li");const d=()=>{var e=window.innerWidth,i=g.width();if(r.children("li.not-in-more").each(()=>{c()}),!(e<t)){n.css("max-height",a+"px"),n.css("overflow","hidden"),r.parent().addClass("hidden");var s=this.$el.width()-u-i;let e=l.width(),t=0;for(;e>s;)if(h(),e=l.width(),++t>=m){setTimeout(()=>d(),100);break}n.css("max-height","unset"),n.css("overflow","visible"),0<r.children().length&&o.removeClass("hidden")}},s=e=>{if(n.height()>p)return d(),void setTimeout(()=>s(!0),200);e||(d(),setTimeout(()=>s(!0),10)),setTimeout(()=>s(!0),1e3)};n.height()<=p&&0===r.children().length&&r.parent().addClass("hidden"),s()}adjustSide(){let i=this.getThemeManager().getParam("screenWidthXs"),s=this.getStaticItemsHeight(),e=(0,v.default)(window),a=this.$tabs,l=this.$more;this.adjustBodyMinHeightMethodName="adjustBodyMinHeightSide",0===l.children().length&&l.parent().addClass("hidden"),e.on("scroll.navbar",()=>{e.scrollTop()?this.$navbarRight.addClass("shadowed"):this.$navbarRight.removeClass("shadowed"),a.scrollTop(e.scrollTop()),this.isMoreDropdownShown&&l.scrollTop(e.scrollTop())}),this.$moreDropdown.on("shown.bs.dropdown",()=>{l.scrollTop(e.scrollTop())}),this.on("show-more-tabs",()=>{l.scrollTop(e.scrollTop())});const t=()=>{var e=window.innerHeight,t=window.innerWidth;if(this.$minimizer.removeClass("hidden"),t<i)return a.css("height","auto"),void l.css("max-height","");a.css("height",e-s+"px"),l.css("max-height",e+"px")};(0,v.default)(window).on("resize.navbar",()=>{t()}),t(),this.adjustBodyMinHeight()}getNavbarHeight(){return this.getThemeManager().getParam("navbarHeight")||43}isSide(){return"side"===this.getThemeManager().getParam("navbar")}getStaticItemsHeight(){return this.getThemeManager().getParam("navbarStaticItemsHeight")||97}adjustBodyMinHeight(){this.adjustBodyMinHeightMethodName&&this[this.adjustBodyMinHeightMethodName]()}adjustBodyMinHeightSide(){let s=this.$tabs.get(0).scrollHeight+this.getStaticItemsHeight(),a=0,l=(this.$more.find("> li:visible").each((e,t)=>{let i=(0,v.default)(t);a+=i.height()}),s=Math.max(s,a),this.$tabs.find("> .tab").height());this.tabList.forEach((t,i)=>{if("object"==typeof t){let e=this.$el.find('li.tab[data-name="group-'+i+'"]');e.hasClass("open")&&(i=(t.itemList||[]).length,(t=l*i)>s&&(s=t))}}),this.$body.css("minHeight",s+"px")}adjustBodyMinHeightTop(){let s=this.getNavbarHeight(),a=(this.$more.find("> li").each((e,t)=>{let i=(0,v.default)(t);if(this.isMoreTabsShown){if(i.hasClass("show-more"))return}else if(i.hasClass("after-show-more"))return;s+=i.height()}),this.$tabs.find(".tab-group > ul > li:visible").height());this.tabList.forEach((t,i)=>{if("object"==typeof t){let e=this.$el.find('li.tab[data-name="group-'+i+'"]');e.hasClass("open")&&(i=(t.itemList||[]).length,(t=a*i)>s&&(s=t))}}),this.$body.css("minHeight",s+"px")}afterRender(){this.$body=(0,v.default)("body"),this.$tabs=this.$el.find("ul.tabs"),this.$more=this.$tabs.find("li.more > ul"),this.$minimizer=this.$el.find("a.minimizer"),this.$body.addClass("has-navbar");let e=this.$moreDropdown=this.$tabs.find("li.more"),t=(e.on("shown.bs.dropdown",()=>{this.isMoreDropdownShown=!0,this.adjustBodyMinHeight()}),e.on("hidden.bs.dropdown",()=>{this.isMoreDropdownShown=!1,this.hideMoreTabs(),this.adjustBodyMinHeight()}),this.selectTab(this.getRouter().getLast().controller),this.getStorage().get("state","siteLayoutState")),i=(t=t||(1320<(0,v.default)(window).width()?"expanded":"collapsed"),!1);(i="collapsed"===t?!0:i)&&this.$body.addClass("minimized"),this.$navbar=this.$el.find("> .navbar"),this.$navbarRightContainer=this.$navbar.find("> .navbar-body > .navbar-right-container"),this.$navbarRight=this.$navbarRightContainer.children();var s=this.getThemeManager().getParam("navbarAdjustmentHandler");s?Espo.loader.require(s,e=>{let t=new e(this);(this.navbarAdjustmentHandler=t).process()}):this.getThemeManager().getParam("skipDefaultNavbarAdjustment")||this.adjustAfterRender()}adjustAfterRender(){if(this.isSide()){let e=()=>{this.$navbar.height()<(0,v.default)(window).height()/2?setTimeout(()=>e(),50):this.getThemeManager().isUserTheme()?setTimeout(()=>this.adjustSide(),10):this.adjustSide()};void e()}else{let e=()=>{this.$el.width()<(0,v.default)(window).width()/2?setTimeout(()=>e(),50):this.getThemeManager().isUserTheme()?setTimeout(()=>this.adjustTop(),10):this.adjustTop()};e()}}selectTab(e){this.currentTab!==e&&(this.$el.find("ul.tabs li.active").removeClass("active"),e&&this.$el.find('ul.tabs li[data-name="'+e+'"]').addClass("active"),this.currentTab=e)}setupTabDefsList(){let e=this.getTabList();function s(e){return"_delimiter_"===e||"_delimiter-ext_"===e}function a(e){return"object"==typeof e&&"divider"===e.type}this.tabList=e.filter(e=>!!e&&("object"==typeof e?"divider"===e.type?!!this.isSide():(e.itemList=e.itemList||[],e.itemList=e.itemList.filter(e=>this.filterTabItem(e)),!!e.itemList.length):this.filterTabItem(e)));let l=!1,i=(this.tabList=this.tabList.filter((e,t)=>{var i=this.tabList[t+1],t=this.tabList[t-1];return s(e)&&(l=!0),!a(e)||(!i||!a(i)&&!(a(t)&&s(i)&&l))}),[]);let r={colorsDisabled:this.getPreferences().get("scopeColorsDisabled")||this.getPreferences().get("tabColorsDisabled")||this.getConfig().get("scopeColorsDisabled")||this.getConfig().get("tabColorsDisabled"),tabIconsDisabled:this.getConfig().get("tabIconsDisabled")},o={moreIsMet:!1,isHidden:!1};this.tabList.forEach((e,t)=>{if(s(e))return o.moreIsMet?t===this.tabList.length-1?void 0:(o.isHidden=!0,void i.push({name:"show-more",isInMore:!0,className:"show-more",html:'<span class="fas fa-ellipsis-h more-icon"></span>'})):void(o.moreIsMet=!0);i.push(this.prepareTabItemDefs(r,e,t,o))}),this.tabDefsList=i}prepareTabItemDefs(i,e,h,s){let t,a,l=null,r=null,o=!1,n=!1,c=e,u="nav-link";var m=e=>0===e.indexOf("$")?this.translate(e.slice(1),"navbarTabs"):e,h=("Home"===e?(t=this.getLanguage().translate(e),a="#"):"object"==typeof e&&"divider"===e.type?(n=!0,t=e.text,u="nav-divider-text",c="divider-"+h,t=t&&m(t)):"object"==typeof e?(o=!0,t=e.text||"",r=e.color,l=e.iconClass,c="group-"+h,a=null,u="nav-link-group",t=t&&m(t)):(t=this.getLanguage().translate(e,"scopeNamesPlural"),a="#"+e),(t=t||"").substring(0,2));i.colorsDisabled||o||n||(r=this.getMetadata().get(["clientDefs",e,"color"])),i.tabIconsDisabled||o||n||(l=this.getMetadata().get(["clientDefs",e,"iconClass"]));let d={link:a,label:t,shortLabel:h,name:c,isInMore:s.moreIsMet,color:r,iconClass:l,isAfterShowMore:s.isHidden,aClassName:u,isGroup:o,isDivider:n};return o&&(d.itemList=e.itemList.map((e,t)=>this.prepareTabItemDefs(i,e,t,s))),s.isHidden&&(d.className="after-show-more"),r&&!l&&(d.colorIconClass="color-icon fas fa-square"),d}getMenuDataList(){let e=this.getHelper().getAvatarHtml(this.getUser().id,"small",16,"avatar-link"),t=(e&&(e+=" "),[{link:"#User/view/"+this.getUser().id,html:e+this.getHelper().escapeString(this.getUser().get("name"))},{divider:!0}]);return this.getUser().isAdmin()&&t.push({link:"#Admin",label:this.getLanguage().translate("Administration")}),t.push({link:"#Preferences",label:this.getLanguage().translate("Preferences")}),this.getConfig().get("actionHistoryDisabled")||(t.push({divider:!0}),t.push({action:"showLastViewed",link:"#LastViewed",label:this.getLanguage().translate("LastViewed","scopeNamesPlural")})),t=t.concat([{divider:!0},{link:"#About",label:this.getLanguage().translate("About")},{action:"logout",label:this.getLanguage().translate("Log Out")}])}quickCreate(e){Espo.Ui.notify(" ... ");var t=this.getMetadata().get(["clientDefs",e,"quickCreateModalType"])||"edit",t=this.getMetadata().get(["clientDefs",e,"modalViews",t])||"views/modals/edit";this.createView("quickCreate",t,{scope:e},e=>{e.once("after:render",()=>Espo.Ui.notify(!1)),e.render()})}actionLogout(){this.getRouter().logout()}actionShowLastViewed(){Espo.Ui.notify(" ... "),this.createView("dialog","views/modals/last-viewed",{},e=>{e.render(),Espo.Ui.notify(!1),this.listenToOnce(e,"close",()=>{this.clearView("dialog")})})}actionShowHistory(){this.createView("dialog","views/modals/action-history",{},e=>{e.render(),this.listenTo(e,"close",()=>{this.clearView("dialog")})})}showMoreTabs(){this.$el.find(".tab-group.tab.dropdown").removeClass("open"),this.isMoreTabsShown=!0,this.$more.addClass("more-expanded"),this.adjustBodyMinHeight(),this.trigger("show-more-tabs")}hideMoreTabs(){this.isMoreTabsShown&&(this.$more.removeClass("more-expanded"),this.adjustBodyMinHeight(),this.isMoreTabsShown=!1)}}e.default=s}),define("views/site/master",["exports","view","jquery"],function(e,t,l){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),l=i(l);class s extends t.default{template="site/master";views={header:{id:"header",view:"views/site/header"},main:{id:"main",view:!1},footer:{fullSelector:"body > footer",view:"views/site/footer"}};showLoadingNotification(){Espo.Ui.notify(" ... ")}hideLoadingNotification(){Espo.Ui.notify(!1)}setup(){(0,l.default)(window).on("resize."+this.cid,()=>{this.adjustContent()})}onRemove(){(0,l.default)(window).off("resize."+this.cid)}afterRender(){var e,t=this.getThemeManager().getParam("params");let i=(0,l.default)("body");for(e in t){var s=this.getThemeManager().getParam(e);i.attr("data-"+Espo.Utils.camelCaseToHyphen(e),s)}let a=this.getView("footer");if(a){let e=a.$el.html()||"";if((e.match(/espocrm/gi)||[]).length<2){t="PHAgY2xhc3M9ImNyZWRpdCBzbWFsbCI+JmNvcHk7IDxhIGhyZWY9Imh0dHA6Ly93d3cuZXNwb2NybS5jb20iPkVzcG9DUk08L2E+PC9wPg==";let e;"function"==typeof window.atob?e=window.atob(t):"function"==typeof atob&&(e=atob(t)),e&&a.$el.html(e)}}this.$content=this.$el.find("> #content"),this.adjustContent();t=this.getHelper().getAppParam("extensions")||[];this.getConfig().get("maintenanceMode")?this.createView("dialog","views/modal",{templateContent:'<div class="text-danger">{{complexText viewObject.options.message}}</div>',headerText:this.translate("maintenanceMode","fields","Settings"),backdrop:!0,message:this.translate("maintenanceMode","messages"),buttonList:[{name:"close",label:this.translate("Close")}]},e=>{e.render()}):this.getHelper().getAppParam("auth2FARequired")?this.createView("dialog","views/modals/auth2fa-required",{},e=>{e.render()}):0!==t.length&&this.processExtensions(t)}adjustContent(){if(this.isRendered()){if(window.innerWidth<this.getThemeManager().getParam("screenWidthXs")){this.isSmallScreen=!0;let e=window.innerHeight-this.$content.get(0).getBoundingClientRect().top,t=(0,l.default)("#navbar .navbar-body");(t.hasClass("in")||t.hasClass("collapsing"))&&(e+=t.height());var i=(0,l.default)("#footer").height()||26;return(e-=i)<=0?void this.$content.css("minHeight",""):void this.$content.css("minHeight",e+"px")}this.isSmallScreen&&this.$content.css("minHeight",""),this.isSmallScreen=!1}}processExtensions(e){let i=[];if(e.forEach(e=>{var t;e.notify&&(t=e.licenseStatusMessage??"extensionLicense"+Espo.Utils.upperCaseFirst(Espo.Utils.hyphenToCamelCase(e.licenseStatus.toLowerCase())),i.push(this.translate(t,"messages").replace("{name}",e.name)))}),i.length){let e=i.join("\n\n"),t=(e=this.getHelper().transformMarkdownText(e),new Espo.Ui.Dialog({backdrop:"static",buttonList:[{name:"close",text:this.translate("Close"),className:"btn-s-wide",onClick:()=>t.close()}],className:"dialog-confirm text-danger",body:e.toString()}));t.show()}}}e.default=s}),define("views/site/header",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="site/header";title="EspoCRM";navbarView="views/site/navbar";customViewPath=["clientDefs","App","navbarView"];data={title:this.title};setup(){var e=this.getMetadata().get(this.customViewPath)||this.navbarView;this.createView("navbar",e,{fullSelector:"#navbar",title:this.title})}}e.default=s}),define("views/site/footer",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="site/footer"}e.default=s}),define("views/search/filter",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="search/filter";data(){return{name:this.name,scope:this.model.entityType,notRemovable:this.options.notRemovable}}setup(){var e=this.name=this.options.name,t=this.model.getFieldType(e);t&&(t=this.model.getFieldParam(e,"view")||this.getFieldManager().getViewName(t),this.createView("field",t,{mode:"search",model:this.model,selector:".field",defs:{name:e},searchParams:this.options.params},e=>{this.listenTo(e,"change",()=>{this.trigger("change")}),this.listenTo(e,"search",()=>{this.trigger("search")})}))}getFieldView(){return this.getView("field")}populateDefaults(){let e=this.getView("field");e&&"populateSearchDefaults"in e&&e.populateSearchDefaults()}}e.default=s}),define("views/record/search",["exports","view","helpers/misc/stored-text-search"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{template="record/search";scope="";entityType="";searchManager=null;fieldFilterList=null;fieldFilterTranslations=null;textFilter="";primary=null;presetFilterList=null;advanced=null;bool=null;disableSavePreset=!1;textFilterDisabled=!1;toShowApplyFiltersButton=!1;toShowResetFiltersText=!1;isSearchedWithAdvancedFilter=!1;viewModeIconClassMap={list:"fas fa-align-justify",kanban:"fas fa-align-left fa-rotate-90"};FIELD_QUICK_SEARCH_COUNT_THRESHOLD=4;autocompleteLimit=7;data(){return{scope:this.scope,entityType:this.entityType,textFilter:this.textFilter,bool:this.bool||{},boolFilterList:this.boolFilterList,hasFieldQuickSearch:this.fieldFilterList.length>=this.FIELD_QUICK_SEARCH_COUNT_THRESHOLD,filterFieldDataList:this.getFilterFieldDataList(),filterDataList:this.getFilterDataList(),presetName:this.presetName,presetFilterList:this.getPresetFilterList(),leftDropdown:this.isLeftDropdown(),textFilterDisabled:this.textFilterDisabled,viewMode:this.viewMode,viewModeDataList:this.viewModeDataList||[],hasViewModeSwitcher:this.viewModeList&&1<this.viewModeList.length,isWide:this.options.isWide,toShowApplyFiltersButton:this.toShowApplyFiltersButton,toShowResetFiltersText:this.toShowResetFiltersText}}setup(){this.entityType=this.collection.entityType,this.scope=this.options.scope||this.entityType,this.searchManager=this.options.searchManager,this.storedTextSearchHelper=new s.default(this.scope,this.getHelper().storage),this.textSearchStoringDisabled=this.getPreferences().get("textSearchStoringDisabled"),this.textFilterDisabled=this.options.textFilterDisabled||this.textFilterDisabled||this.getMetadata().get(["clientDefs",this.scope,"textFilterDisabled"]),"disableSavePreset"in this.options&&(this.disableSavePreset=this.options.disableSavePreset),this.viewMode=this.options.viewMode,this.viewModeList=this.options.viewModeList,this.addReadyCondition(()=>null!==this.fieldFilterList),this.boolFilterList=Espo.Utils.clone(this.getMetadata().get(["clientDefs",this.scope,"boolFilterList"])||[]).filter(e=>"string"==typeof e||!(e=e||{}).aux&&((!e.inPortalDisabled||!this.getUser().isPortal())&&(!(e.isPortalOnly&&!this.getUser().isPortal())&&!(e.accessDataList&&!Espo.Utils.checkAccessDataList(e.accessDataList,this.getAcl(),this.getUser()))))).map(e=>"string"==typeof e?e:(e=e||{}).name),this.fieldFilterTranslations={};let i=this.getAcl().getScopeForbiddenFieldList(this.entityType)||[];this.wait(new Promise(t=>{this.getHelper().layoutManager.get(this.entityType,"filters",e=>{this.fieldFilterList=[],(e||[]).forEach(e=>{~i.indexOf(e)||(this.fieldFilterList.push(e),this.fieldFilterTranslations[e]=this.translate(e,"fields",this.entityType))}),t()})}));var e=this.options.filterList||this.getMetadata().get(["clientDefs",this.scope,"filterList"])||[];if(this.presetFilterList=Espo.Utils.clone(e).filter(e=>"string"==typeof e||!(e=e||{}).aux&&((!e.inPortalDisabled||!this.getUser().isPortal())&&(!(e.isPortalOnly&&!this.getUser().isPortal())&&!(e.accessDataList&&!Espo.Utils.checkAccessDataList(e.accessDataList,this.getAcl(),this.getUser()))))),((this.getPreferences().get("presetFilters")||{})[this.scope]||[]).forEach(e=>{this.presetFilterList.push(e)}),this.getMetadata().get(["scopes",this.entityType,"stream"])&&this.boolFilterList.push("followed"),this.loadSearchData(),this.hasAdvancedFilter()&&(this.isSearchedWithAdvancedFilter=!0),this.presetName){let e=!1;for(var t in this.presetFilterList){t=this.presetFilterList[t]||{};if(("string"==typeof t?t:t.name)===this.presetName){e=!0;break}}e||this.presetFilterList.push(this.presetName)}this.model=this.collection.prepareModel(),this.model.clear(),this.createFilters(),this.setupViewModeDataList(),this.listenTo(this.collection,"order-changed",()=>{this.controlResetButtonVisibility()}),this.wait(this.getHelper().processSetupHandlers(this,"record/search"))}setupViewModeDataList(){if(!this.viewModeList)return[];let t=[];this.viewModeList.forEach(e=>{e={name:e,title:this.translate(e,"listViewModes"),iconClass:this.viewModeIconClassMap[e]};t.push(e)}),this.viewModeDataList=t}setViewMode(e,t,i){this.viewMode=e,this.isRendered()?(this.$el.find('[data-action="switchViewMode"]').removeClass("active"),this.$el.find('[data-action="switchViewMode"][data-name="'+e+'"]').addClass("active")):this.isBeingRendered()&&!t&&this.once("after:render",()=>{this.setViewMode(e,!0)}),i&&this.trigger("change-view-mode",e)}isLeftDropdown(){return this.presetFilterList.length||this.boolFilterList.length||Object.keys(this.advanced||{}).length}handleLeftDropdownVisibility(){this.isLeftDropdown()?this.$leftDropdown.removeClass("hidden"):this.$leftDropdown.addClass("hidden")}createFilters(e){let t=0,i=Object.keys(this.advanced||{}).length;for(var s in 0===i&&"function"==typeof e&&e(),this.advanced)this.createFilter(s,this.advanced[s],()=>{++t===i&&"function"==typeof e&&e()})}events={'keydown input[data-name="textFilter"]':function(e){var t=Espo.Utils.getKeyFromKeyEvent(e);"Enter"!==e.code&&"Enter"!==t&&"Control+Enter"!==t||(this.search(),this.hideApplyFiltersButton())},'focus input[data-name="textFilter"]':function(e){e.currentTarget.select()},'click .advanced-filters-apply-container a[data-action="applyFilters"]':function(){this.search(),this.hideApplyFiltersButton(),this.$el.find("button.search").focus()},'click button[data-action="search"]':function(){this.search(),this.hideApplyFiltersButton()},'click a[data-action="addFilter"]':function(e){let t=$(e.currentTarget);e=t.data("name");t.closest("li").addClass("hidden"),this.addFilter(e)},"click .advanced-filters a.remove-filter":function(e){let t=$(e.currentTarget);e=t.data("name");this.removeFilter(e)},'click button[data-action="reset"]':function(){this.resetFilters()},'click button[data-action="refresh"]':function(){this.refresh()},'click a[data-action="selectPreset"]':function(e){let t=$(e.currentTarget);e=t.data("name")||null;this.selectPreset(e)},'click .dropdown-menu a[data-action="savePreset"]':function(){this.createView("savePreset","views/modals/save-filters",{},t=>{t.render(),this.listenToOnce(t,"save",e=>{this.savePreset(e),t.close(),this.removeFilters(),this.createFilters(()=>{this.render()})})})},'click .dropdown-menu a[data-action="removePreset"]':function(){let e=this.presetName;this.confirm(this.translate("confirmation","messages"),()=>{this.removePreset(e)})},'change .search-row ul.filter-menu input[data-role="boolFilterCheckbox"]':function(e){e.stopPropagation(),this.search(),this.manageLabels()},'click [data-action="switchViewMode"]':function(e){e=$(e.currentTarget).data("name");e!==this.viewMode&&this.setViewMode(e,!1,!0)},"keyup input.field-filter-quick-search-input":function(e){this.processFieldFilterQuickSearch(e.currentTarget.value)},"keydown input.field-filter-quick-search-input":function(e){"Enter"!==e.code?"Escape"===e.code&&this.closeAddFieldDropdown():this.addFirstFieldFilter()}};removeFilter(e){this.$el.find('ul.filter-list li[data-name="'+e+'"]').removeClass("hidden");let t=this.getView("filter-"+e).$el.closest("div.filter");if(this.clearView("filter-"+e),t.remove(),delete this.advanced[e],this.presetName=this.primary,this.updateAddFilterButton(),this.fetch(),this.updateSearch(),this.manageLabels(),this.handleLeftDropdownVisibility(),this.controlResetButtonVisibility(),this.isSearchedWithAdvancedFilter)return this.hasAdvancedFilter()?this.showApplyFiltersButton():this.showResetFiltersButton(),void this.$applyFilters.focus();this.hasAdvancedFilter()||this.hideApplyFiltersButton()}addFilter(e){this.advanced[e]={},this.presetName=this.primary,this.createFilter(e,{},e=>{e.populateDefaults(),this.fetch(),this.updateSearch(),e.getFieldView().initialSearchIsNotIdle&&this.showApplyFiltersButton()}),this.updateAddFilterButton(),this.handleLeftDropdownVisibility(),this.manageLabels(),this.controlResetButtonVisibility()}refresh(){Espo.Ui.notify(" ... "),this.collection.abortLastFetch(),this.collection.reset(),this.collection.fetch().then(()=>{Espo.Ui.notify(!1)})}selectPreset(e,t){var i=!(this.primary===this.presetName),e=(this.presetName=e,this.getPresetData()),s=(this.primary=this.getPrimaryFilterName(),!(this.primary===this.presetName));(t||i||s||Object.keys(e).length)&&(this.removeFilters(),this.advanced=e),this.updateSearch(),this.manageLabels(),this.createFilters(()=>{this.reRender().then(()=>{this.$el.find(".filters-button").get(0).focus({preventScroll:!0})})}),this.updateCollection()}removeFilters(){for(var e in this.$advancedFiltersPanel.empty(),this.advanced)this.clearView("filter-"+e)}resetFilters(){this.trigger("reset"),this.collection.resetOrderToDefault(),this.textFilter="",this.selectPreset(this.presetName,!0),this.hideApplyFiltersButton(),this.trigger("update-ui")}savePreset(e){var t="f"+Math.floor(1000001*Math.random()).toString();this.fetch(),this.updateSearch();let i=this.getPreferences().get("presetFilters")||{};this.scope in i||(i[this.scope]=[]);e={id:t,name:t,label:e,data:this.advanced,primary:this.primary};i[this.scope].push(e),this.presetFilterList.push(e),this.getPreferences().once("sync",()=>{this.getPreferences().trigger("update"),this.updateSearch()}),this.getPreferences().save({presetFilters:i},{patch:!0}),this.presetName=t}removePreset(i){let e=this.getPreferences().get("presetFilters")||{};this.scope in e||(e[this.scope]=[]);let s;(s=e[this.scope]).forEach((e,t)=>{e.id===i&&s.splice(t,1)}),(s=this.presetFilterList).forEach((e,t)=>{e.id===i&&s.splice(t,1)}),this.getPreferences().set("presetFilters",e),this.getPreferences().save({patch:!0}),this.getPreferences().trigger("update"),this.presetName=this.primary,this.advanced={},this.removeFilters(),this.render(),this.updateSearch(),this.updateCollection()}updateAddFilterButton(){let e=this.$el.find("ul.filter-list");0===e.children().not(".hidden").not(".dropdown-header").not(".quick-search-list-item").length?this.$addFilterButton.addClass("disabled"):this.$addFilterButton.removeClass("disabled"),this.trigger("update-ui")}afterRender(){this.$filtersLabel=this.$el.find(".search-row span.filters-label"),this.$filtersButton=this.$el.find(".search-row button.filters-button"),this.$leftDropdown=this.$el.find("div.search-row div.left-dropdown"),this.$resetButton=this.$el.find('[data-action="reset"]'),this.$applyFiltersContainer=this.$el.find(".advanced-filters-apply-container"),this.$applyFilters=this.$applyFiltersContainer.find('[data-action="applyFilters"]'),this.$filterList=this.$el.find("ul.filter-list"),this.$fieldQuickSearch=this.$filterList.find("input.field-filter-quick-search-input"),this.$addFilterButton=this.$el.find("button.add-filter-button"),this.$textFilter=this.$el.find("input.text-filter"),this.updateAddFilterButton(),this.$advancedFiltersPanel=this.$el.find(".advanced-filters"),this.manageLabels(),this.controlResetButtonVisibility(),this.initQuickSearchUi(),this.initTextSearchAutocomplete()}initTextSearchAutocomplete(){if(!this.textSearchStoringDisabled){let t=!1;this.$textFilter.autocomplete({minChars:0,noCache:!0,triggerSelectOnValidInput:!1,beforeRender:e=>{e.addClass("text-search-suggestions"),e.off("mousedown"),e.on("mousedown",e=>{0===e.originalEvent.button&&(t=!0,setTimeout(()=>t=!1,201))}),e.find('a[data-action="clearStoredTextSearch"]').on("click",e=>{e.stopPropagation(),e.preventDefault();e=e.currentTarget.getAttribute("data-value");this.storedTextSearchHelper.remove(e),setTimeout(()=>this.$textFilter.focus(),205)})},formatResult:e=>$("<span>").append($("<a>").attr("data-action","clearStoredTextSearch").attr("role","button").attr("data-value",e.value).attr("title",this.translate("Remove")).html('<span class="fas fa-times fa-sm"></span>').addClass("pull-right text-soft"),$("<span>").text(e.value)).get(0).innerHTML,lookup:(e,t)=>{t({suggestions:this.storedTextSearchHelper.match(e,this.autocompleteLimit).map(e=>({value:e}))})},onSelect:()=>{this.$textFilter.focus(),this.$textFilter.autocomplete("hide")}}),this.$textFilter.on("blur",()=>{t||setTimeout(()=>this.$textFilter.autocomplete("hide"),1)}),this.$textFilter.on("focus",()=>{this.$textFilter.val()&&this.$textFilter.autocomplete("hide")}),this.once("render",()=>this.$textFilter.autocomplete("dispose")),this.once("remove",()=>this.$textFilter.autocomplete("dispose"))}}initQuickSearchUi(){this.$addFilterButton.parent().on("show.bs.dropdown",()=>{setTimeout(()=>{this.$fieldQuickSearch.focus();var e=this.$fieldQuickSearch.outerWidth();this.$fieldQuickSearch.css("minWidth",e)},1)}),this.$addFilterButton.parent().on("hide.bs.dropdown",()=>{this.resetFieldFilterQuickSearch(),this.$fieldQuickSearch.css("minWidth","")})}manageLabels(){this.$el.find("ul.dropdown-menu > li.preset-control").addClass("hidden"),this.currentFilterLabelList=[],this.managePresetFilters(),this.manageBoolFilters(),this.$filtersLabel.html(this.currentFilterLabelList.join(" &middot; "))}toShowResetButton(){if(this.textFilter)return!0;var e=this.presetName||null,t=this.primary;return!(e&&e!==t||!Object.keys(this.advanced).length)||(this.collection.orderBy!==this.collection.defaultOrderBy||this.collection.order!==this.collection.defaultOrder)}controlResetButtonVisibility(){this.toShowResetButton()?this.$resetButton.css("visibility","visible"):this.$resetButton.css("visibility","hidden")}managePresetFilters(){let a=this.presetName||null;var e,t=this.primary;this.$el.find("ul.filter-menu a.preset span").remove();let l=this.translate("all","presetFilters",this.entityType),r="default";if((a=!a&&t?t:a)&&a!==t){this.$advancedFiltersPanel.addClass("hidden");let t=null,i="default",s=null;this.presetFilterList.forEach(e=>{e.name===a&&(t=e.label||!1,i=e.style||"default",s=e.id)}),t=t||this.translate(this.presetName,"presetFilters",this.entityType),l=t,r=i,s&&(this.$el.find("ul.dropdown-menu > li.divider.preset-control").removeClass("hidden"),this.$el.find("ul.dropdown-menu > li.preset-control.remove-preset").removeClass("hidden"))}else this.$advancedFiltersPanel.removeClass("hidden"),0!==Object.keys(this.advanced).length&&(this.disableSavePreset||(this.$el.find("ul.dropdown-menu > li.divider.preset-control").removeClass("hidden"),this.$el.find("ul.dropdown-menu > li.preset-control.save-preset").removeClass("hidden"),this.$el.find("ul.dropdown-menu > li.preset-control.remove-preset").addClass("hidden"))),t&&(t=this.translate(t,"presetFilters",this.entityType),e=this.getPrimaryFilterStyle(),l=t,r=e);this.currentFilterLabelList.push(l),this.$filtersButton.removeClass("btn-default").removeClass("btn-primary").removeClass("btn-danger").removeClass("btn-success").removeClass("btn-info"),this.$filtersButton.addClass("btn-"+r),a=a||"",this.$el.find('ul.filter-menu a.preset[data-name="'+a+'"]').prepend('<span class="fas fa-check pull-right"></span>')}manageBoolFilters(){(this.boolFilterList||[]).forEach(e=>{this.bool[e]&&(e=this.translate(e,"boolFilters",this.entityType),this.currentFilterLabelList.push(e))})}search(){this.fetch(),this.updateSearch(),this.updateCollection(),this.controlResetButtonVisibility(),this.storeTextSearch(),this.isSearchedWithAdvancedFilter=this.hasAdvancedFilter()}hasAdvancedFilter(){return 0<Object.keys(this.advanced).length}getFilterDataList(){let e=[];for(var t in this.advanced)e.push({key:"filter-"+t,name:t});return e}updateCollection(){this.collection.abortLastFetch(),this.collection.reset(),this.collection.where=this.searchManager.getWhere(),this.collection.offset=0,Espo.Ui.notify(" ... "),this.collection.fetch().then(()=>{Espo.Ui.notify(!1)})}getPresetFilterList(){let t=[];return this.presetFilterList.forEach(e=>{"string"==typeof e&&(e={name:e}),t.push(e)}),t}getPresetData(){let t={};return this.getPresetFilterList().forEach(e=>{e.name===this.presetName&&(t=Espo.Utils.clone(e.data||{}))}),t}getPrimaryFilterName(){let t=null;return this.getPresetFilterList().forEach(e=>{e.name===this.presetName&&("data"in e?e.primary&&(t=e.primary):t=e.name)}),t}getPrimaryFilterStyle(){let t=null;return this.getPresetFilterList().forEach(e=>{e.name===this.primary&&(t=e.style||"default")}),t}loadSearchData(){var e=this.searchManager.get();this.textFilter=e.textFilter,"presetName"in e&&(this.presetName=e.presetName);let t=!1;"primary"in e&&(this.primary=e.primary,this.presetName||(this.presetName=this.primary),t=!0),this.presetName?(this.advanced=_.extend(Espo.Utils.clone(this.getPresetData()),e.advanced),t||(this.primary=this.getPrimaryFilterName())):this.advanced=Espo.Utils.clone(e.advanced),this.bool=e.bool}createFilter(e,t,i,s){t=t||{};let a=!1;this.isRendered()&&(a=!0,this.$advancedFiltersPanel.append('<div data-name="'+e+'" class="filter filter-'+e+'" />')),this.createView("filter-"+e,"views/search/filter",{name:e,model:this.model,params:t,selector:'.filter[data-name="'+e+'"]'},t=>{"function"==typeof i&&t.once("after:render",()=>{i(t)}),a&&!s&&t.render(),this.listenTo(t,"change",()=>{let e=this.isSearchedWithAdvancedFilter;e||t.getView("field").fetchSearch()&&(e=!0),e&&this.showApplyFiltersButton()}),this.listenTo(t,"search",()=>{this.search(),this.hideApplyFiltersButton()})})}fetch(){for(var t in this.textFilter=(this.$el.find('input[data-name="textFilter"]').val()||"").trim(),this.bool={},this.boolFilterList.forEach(e=>{this.bool[e]=this.$el.find('input[data-name="'+e+'"][data-role="boolFilterCheckbox"]').prop("checked")}),this.advanced){let e=this.getView("filter-"+t).getView("field");this.advanced[t]=e.fetchSearch(),e.searchParams=this.advanced[t]}}updateSearch(){this.searchManager.set({textFilter:this.textFilter,advanced:this.advanced,bool:this.bool,presetName:this.presetName,primary:this.primary})}getFilterFieldDataList(){let e=[];for(var t in this.fieldFilterList){t=this.fieldFilterList[t],t={name:t,checked:t in this.advanced,label:this.fieldFilterTranslations[t]||t};e.push(t)}return e}showResetFiltersButton(){this.toShowApplyFiltersButton=!0,this.toShowResetFiltersText=!0,this.$applyFiltersContainer.removeClass("hidden"),this.$applyFiltersContainer.find(".text-apply").addClass("hidden"),this.$applyFiltersContainer.find(".text-reset").removeClass("hidden")}showApplyFiltersButton(){this.toShowApplyFiltersButton=!0,this.toShowResetFiltersText=!1,this.$applyFiltersContainer.removeClass("hidden"),this.$applyFiltersContainer.find(".text-reset").addClass("hidden"),this.$applyFiltersContainer.find(".text-apply").removeClass("hidden")}hideApplyFiltersButton(){this.toShowApplyFiltersButton=!1,this.toShowResetFiltersText=!1,this.$applyFiltersContainer.addClass("hidden")}selectPreviousPreset(){let e=Espo.Utils.clone(this.getPresetFilterList());var t;e.unshift({name:null}),1!==e.length&&((t=e.findIndex(e=>e.name===this.presetName)-1)<0||(t=e[t],this.selectPreset(t.name)))}selectNextPreset(){let e=Espo.Utils.clone(this.getPresetFilterList());var t;e.unshift({name:null}),1!==e.length&&((t=e.findIndex(e=>e.name===this.presetName)+1)>=e.length||(t=e[t],this.selectPreset(t.name)))}processFieldFilterQuickSearch(a){a=(a=a.trim()).toLowerCase();let l=this.$filterList.find("li.filter-item");""!==a?(l.addClass("search-hidden"),this.fieldFilterList.forEach(e=>{let t=this.fieldFilterTranslations[e]||e,i=(t=t.toLowerCase()).split(" "),s=0===t.indexOf(a);(s=s||0<i.filter(e=>3<e.length&&0===e.indexOf(a)).length)&&l.filter(`[data-name="${e}"]`).removeClass("search-hidden")})):l.removeClass("search-hidden")}resetFieldFilterQuickSearch(){this.$fieldQuickSearch.val(""),this.$filterList.find("li.filter-item").removeClass("search-hidden")}addFirstFieldFilter(){let e=this.$filterList.find("li.filter-item:not(.hidden):not(.search-hidden)").first();var t;e.length&&(t=e.attr("data-name"),e.addClass("hidden"),this.closeAddFieldDropdown(),this.addFilter(t),this.resetFieldFilterQuickSearch())}closeAddFieldDropdown(){this.$addFilterButton.parent().find('[data-toggle="dropdown"]').dropdown("toggle")}storeTextSearch(){this.textFilter&&(this.textSearchStoringDisabled||this.storedTextSearchHelper.store(this.textFilter))}}e.default=a}),define("views/record/panel-actions",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="record/panel-actions";data(){return{defs:this.options.defs,buttonList:this.getButtonList(),actionList:this.getActionList(),entityType:this.options.entityType,scope:this.options.scope}}setup(){this.buttonList=this.options.defs.buttonList||[],this.actionList=this.options.defs.actionList||[],this.defs=this.options.defs}getButtonList(){let t=[];return this.buttonList.forEach(e=>{e.hidden||t.push(e)}),t}getActionList(){return this.actionList.filter(e=>!e.hidden).map(e=>((e=Espo.Utils.clone(e)).action&&(e.data=Espo.Utils.clone(e.data||{}),e.data.panel=this.options.defs.name),e))}}e.default=s}),define("views/record/merge",["exports","view","jquery"],function(e,t,o){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),o=i(o);class s extends t.default{template="record/merge";scope="";events={'change input[type="radio"][name="check-all"]':function(e){e.stopPropagation();e=e.currentTarget.value;(0,o.default)('input[data-id="'+e+'"]').prop("checked",!0)},'click button[data-action="cancel"]':function(){this.getRouter().navigate("#"+this.scope,{trigger:!0})},'click button[data-action="merge"]':function(){let t=(0,o.default)('input[type="radio"][name="check-all"]:checked').val(),l,r=(this.models.forEach(e=>{e.id===t&&(l=e)}),{});(0,o.default)("input.field-radio:checked").each((e,i)=>{var s=i.name;let a=(0,o.default)(i).attr("data-id");if(l.id!==a){i=l.getFieldParam(s,"type");let e=this.getFieldManager().getActualAttributeList(i,s),t;this.models.forEach(e=>{e.id===a&&(t=e)}),e.forEach(e=>{r[e]=t.get(e)})}}),Espo.Ui.notify(" ... ");var e=this.models.filter(e=>e.id!==l.id).map(e=>e.id);Espo.Ajax.postRequest("Action",{entityType:this.scope,action:"merge",id:l.id,data:{sourceIdList:e,attributes:r}}).then(()=>{Espo.Ui.success(this.translate("Merged"),{suppress:!0}),this.getRouter().navigate("#"+this.scope+"/view/"+l.id,{trigger:!0}),this.collection&&this.collection.fetch()})}};data(){let e=[];return this.fields.forEach(t=>{let i={name:t,scope:this.scope,columns:[]};this.models.forEach(e=>{i.columns.push({id:e.id,fieldVariable:e.id+"-"+t,isReadOnly:this.readOnlyFields[t]||!1})}),e.push(i)}),{rows:e,modelList:this.models,scope:this.scope,hasCreatedAt:this.hasCreatedAt,width:Math.round((80-5*this.models.length)/this.models.length*10)/10,dataList:this.getDataList()}}afterRender(){(0,o.default)('input[data-id="'+this.models[0].id+'"]').prop("checked",!0)}setup(){this.scope=this.options.models[0].name,this.models=this.options.models;let t=this.getFieldManager(),i=[];var s,e=this.models[0].defs.fields;for(s in this.readOnlyFields={},e){var l=e[s].type;if("linkMultiple"!==l&&(!(e[s].disabled||e[s].utility||e[s].mergeDisabled)&&"createdAt"!==s&&"modifiedAt"!==s&&t.isMergeable(l))){let e=t.getActualAttributeList(l,s),a=!1;e.forEach(t=>{let i=[],s=(this.models.forEach(e=>{i.push(e.get(t))}),i[0]);i.forEach(e=>{_.isEqual(s,e)||(a=!0)})}),a&&(i.push(s),this.models[0].isFieldReadOnly(s)&&(this.readOnlyFields[s]=!0))}}i.sort((e,t)=>this.translate(e,"fields",this.scope).localeCompare(this.translate(t,"fields",this.scope))),i=i.sort((e,t)=>!this.readOnlyFields[e]&&this.readOnlyFields[t]?-1:1),this.fields=i,this.fields.forEach(i=>{let s=this.models[0].getFieldParam(i,"type");this.models.forEach(e=>{var t=e.getFieldParam(i,"view")||this.getFieldManager().getViewName(s);this.createView(e.id+"-"+i,t,{model:e,fullSelector:'.merge [data-id="'+e.id+'"] .field[data-name="'+i+'"]',defs:{name:i},mode:"detail",readOnly:!0})})}),this.hasCreatedAt=this.getMetadata().get(["entityDefs",this.scope,"fields","createdAt"]),this.hasCreatedAt&&this.models.forEach(e=>{this.createView(e.id+"-createdAt","views/fields/datetime",{model:e,fullSelector:'.merge [data-id="'+e.id+'"] .field[data-name="createdAt"]',defs:{name:"createdAt"},mode:"detail",readOnly:!0})})}getDataList(){let i=[];return this.models.forEach(e=>{var t={};t.id=e.id,t.name=e.get("name"),t.createdAtViewName=e.id+"-createdAt",i.push(t)}),i}}e.default=s}),define("views/record/list-tree",["exports","views/record/list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="record/list-tree";showMore=!1;showCount=!1;checkboxes=!1;rowActionsView=!1;presentationType="tree";header=!1;listContainerEl=" > .list > ul";checkAllResultDisabled=!0;showRoot=!1;massActionList=["remove"];selectable=!1;createDisabled=!1;selectedData=null;level=0;itemViewName="views/record/list-tree-item";data(){let e=super.data();return e.createDisabled=this.createDisabled,e.showRoot=this.showRoot,e.showRoot&&(e.rootName=this.rootName||this.translate("Root")),e.showEditLink=this.showEditLink,0===this.level&&this.selectable&&null===(this.selectedData||{}).id&&(e.rootIsSelected=!0),0===this.level&&this.options.hasExpandedToggler&&(e.hasExpandedToggler=!0),0===this.level&&(e.isExpanded=this.isExpanded),(e.hasExpandedToggler||this.showEditLink)&&(e.showRootMenu=!0),this.options.menuDisabled&&(e.showRootMenu=!1),e.noData=e.createDisabled&&!e.rowList.length&&!e.showRoot,e}setup(){"selectable"in this.options&&(this.selectable=this.options.selectable),this.readOnly=this.options.readOnly,this.createDisabled=this.readOnly||this.options.createDisabled||this.createDisabled,this.isExpanded=this.options.isExpanded,"showRoot"in this.options&&(this.showRoot=this.options.showRoot,"rootName"in this.options&&(this.rootName=this.options.rootName)),"showRoot"in this.options&&(this.showEditLink=this.options.showEditLink),"level"in this.options&&(this.level=this.options.level),this.rootView=this.options.rootView||this,0===this.level&&(this.selectedData={id:null,path:[],names:{}}),"selectedData"in this.options&&(this.selectedData=this.options.selectedData),super.setup(),this.selectable&&this.on("select",e=>{e.id&&(this.$el.find('a.link[data-id="'+e.id+'"]').addClass("text-bold"),0===this.level&&(this.$el.find("a.link").removeClass("text-bold"),this.$el.find('a.link[data-id="'+e.id+'"]').addClass("text-bold"),this.setSelected(e.id),e.selectedData=this.selectedData)),0<this.level&&this.getParentView().trigger("select",e)})}setSelected(i){this.selectedData.id=null===i?null:i,this.rowList.forEach(e=>{let t=this.getView(e);t.model.id===i?t.setIsSelected():t.isSelected=!1,t.hasView("children")&&t.getChildrenView().setSelected(i)})}buildRows(a){if(this.checkedList=[],this.rowList=[],0<this.collection.length){this.wait(!0);let e=this.collection.models,i=e.length,s=0;void e.forEach(e=>{var t=e.id;this.rowList.push(t),this.createView(t,this.itemViewName,{model:e,collection:this.collection,selector:this.getRowSelector(e.id),createDisabled:this.createDisabled,readOnly:this.readOnly,level:this.level,isSelected:e.id===this.selectedData.id,selectedData:this.selectedData,selectable:this.selectable,setViewBeforeCallback:this.options.skipBuildRows&&!this.isRendered(),rootView:this.rootView},()=>{++s===i&&("function"==typeof a&&a(),this.wait(!1))})})}else"function"==typeof a&&a()}getRowSelector(e){return'li[data-id="'+e+'"]'}getItemEl(e,t){return this.getSelector()+' li[data-id="'+e.id+'"] span.cell[data-name="'+t.name+'"]'}getCreateAttributes(){return{}}actionCreate(e,t){t.stopPropagation();let s=this.getCreateAttributes(),i=0;this.collection.models.forEach(e=>{e.get("order")>i&&(i=e.get("order"))}),s.order=i+1,s.parentId=null,s.parentName=null,this.model&&(s.parentId=this.model.id,s.parentName=this.model.get("name"));var t=this.collection.entityType,a=this.getMetadata().get("clientDefs."+t+".modalViews.edit")||"views/modals/edit";this.createView("quickCreate",a,{scope:t,attributes:s},i=>{i.render(),this.listenToOnce(i,"after:save",e=>{i.close();let t=this.collection;if(e.set("childCollection",t.createSeed()),e.get("parentId")===s.parentId)this.collection.push(e),this.buildRows(()=>{this.render()});else{let e=this;for(;;){if(!e.level)break;e=e.getParentView().getParentView()}void e.collection.fetch()}})})}actionSelectRoot(){this.trigger("select",{id:null}),this.selectable&&(this.$el.find("a.link").removeClass("text-bold"),this.$el.find('a.link[data-action="selectRoot"]').addClass("text-bold"),this.setSelected(null))}}e.default=s}),define("views/record/list-tree-item",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="record/list-tree-item";isEnd=!1;level=0;listViewName="views/record/list-tree";data(){return{name:this.model.get("name"),isUnfolded:this.isUnfolded,showFold:this.isUnfolded&&!this.isEnd,showUnfold:!this.isUnfolded&&!this.isEnd,isEnd:this.isEnd,isSelected:this.isSelected,readOnly:this.readOnly}}events={'click [data-action="unfold"]':function(e){this.unfold(),e.stopPropagation()},'click [data-action="fold"]':function(e){this.fold(),e.stopPropagation()},'click [data-action="remove"]':function(e){this.actionRemove(),e.stopPropagation()}};setIsSelected(){this.isSelected=!0,this.selectedData.id=this.model.id;let e=this.selectedData.path,t=this.selectedData.names,i=(e.length=0,this);for(;;){if(e.unshift(i.model.id),t[i.model.id]=i.model.get("name"),!i.getParentListView().level)break;i=i.getParentView().getParentView()}}setup(){"level"in this.options&&(this.level=this.options.level),"isSelected"in this.options&&(this.isSelected=this.options.isSelected),"selectedData"in this.options&&(this.selectedData=this.options.selectedData),this.readOnly=this.options.readOnly,"createDisabled"in this.options&&(this.createDisabled=this.options.createDisabled),this.readOnly&&(this.createDisabled=!0),this.rootView=this.options.rootView,this.scope=this.model.entityType,this.isUnfolded=!1;var e=this.model.get("childCollection");e&&0===e.length||this.model.isEnd?this.createDisabled&&(this.isEnd=!0):e&&(e.models.forEach(e=>{~this.selectedData.path.indexOf(e.id)&&(this.isUnfolded=!0)}),this.isUnfolded&&this.createChildren()),this.on("select",e=>{this.getParentListView().trigger("select",e)})}getParentListView(){return this.getParentView()}createChildren(){var e=this.model.get("childCollection");let t=null;this.isRendered()&&(t=e=>{this.listenToOnce(e,"after:render",()=>{this.trigger("children-created")}),e.render()}),this.createView("children",this.listViewName,{collection:e,selector:"> .children",createDisabled:this.options.createDisabled,readOnly:this.options.readOnly,level:this.level+1,selectedData:this.selectedData,model:this.model,selectable:this.options.selectable,rootView:this.rootView},t)}checkLastChildren(){Espo.Ajax.getRequest(this.collection.entityType+"/action/lastChildrenIdList",{parentId:this.model.id}).then(e=>{let i=this.getChildrenView();e.forEach(e=>{var t=this.model.get("childCollection").get(e),t=(t&&(t.isEnd=!0),i.getView(e));t&&(t.isEnd=!0,t.afterIsEnd())}),this.model.lastAreChecked=!0})}unfold(){if(this.createDisabled&&this.once("children-created",()=>{this.model.lastAreChecked||this.checkLastChildren()}),null!==this.model.get("childCollection"))return this.createChildren(),this.isUnfolded=!0,this.afterUnfold(),void this.trigger("after:unfold");this.getCollectionFactory().create(this.scope,e=>{e.url=this.collection.url,e.parentId=this.model.id,e.maxDepth=null,Espo.Ui.notify(" ... "),this.listenToOnce(e,"sync",()=>{Espo.Ui.notify(!1),this.model.set("childCollection",e),this.createChildren(),this.isUnfolded=!0,e.length||!this.createDisabled?(this.afterUnfold(),this.trigger("after:unfold")):(this.isEnd=!0,this.afterIsEnd())}),e.fetch()})}fold(){this.clearView("children"),this.isUnfolded=!1,this.afterFold()}afterRender(){if(this.isUnfolded?this.afterUnfold():this.afterFold(),this.isEnd&&this.afterIsEnd(),!this.readOnly){let e=this.$el.find('> .cell [data-action="remove"]');this.$el.find("> .cell").on("mouseenter",function(){e.removeClass("hidden")}),this.$el.find("> .cell").on("mouseleave",function(){e.addClass("hidden")})}}afterFold(){this.$el.find('a[data-action="fold"][data-id="'+this.model.id+'"]').addClass("hidden"),this.$el.find('a[data-action="unfold"][data-id="'+this.model.id+'"]').removeClass("hidden"),this.$el.find(" > .children").addClass("hidden")}afterUnfold(){this.$el.find('a[data-action="unfold"][data-id="'+this.model.id+'"]').addClass("hidden"),this.$el.find('a[data-action="fold"][data-id="'+this.model.id+'"]').removeClass("hidden"),this.$el.find(" > .children").removeClass("hidden")}afterIsEnd(){this.$el.find('a[data-action="unfold"][data-id="'+this.model.id+'"]').addClass("hidden"),this.$el.find('a[data-action="fold"][data-id="'+this.model.id+'"]').addClass("hidden"),this.$el.find('span[data-name="white-space"][data-id="'+this.model.id+'"]').removeClass("hidden"),this.$el.find(" > .children").addClass("hidden")}getCurrentPath(){let e=this,t=[];for(;;){if(t.unshift(e.model.id),e.getParentView()===this.rootView)break;e=e.getParentView().getParentView()}return t}actionRemove(){this.confirm({message:this.translate("removeRecordConfirmation","messages",this.scope),confirmText:this.translate("Remove")},()=>{this.model.destroy({wait:!0}).then(()=>this.remove())})}getChildrenView(){return this.getView("children")}}e.default=s}),define("views/record/list-pagination",["view"],function(e){return e.extend({template:"record/list-pagination",data:function(){var e=0<this.collection.offset,t=this.collection.total-this.collection.offset>this.collection.maxSize||-1===this.collection.total;return{total:this.collection.total,from:this.collection.offset+1,to:this.collection.offset+this.collection.length,previous:e,next:t,noTotal:-1===this.collection.total||-2===this.collection.total}}})}),define("views/record/list-nested-categories",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="record/list-nested-categories";isLoading=!1;events={"click .action":function(e){Espo.Utils.handleAction(this,e.originalEvent,e.currentTarget)}};data(){let e={};this.isLoading||(e.list=this.getDataList()),e.scope=this.collection.entityType,e.isLoading=this.isLoading,e.currentId=this.collection.currentCategoryId,e.currentName=this.collection.currentCategoryName,e.categoryData=this.collection.categoryData,e.hasExpandedToggler=this.options.hasExpandedToggler,e.showEditLink=this.options.showEditLink,e.hasNavigationPanel=this.options.hasNavigationPanel;var t=this.collection.categoryData||{};return e.upperLink=t.upperId?"#"+this.subjectEntityType+"/list/categoryId="+t.upperId:"#"+this.subjectEntityType,e}getDataList(){var t=[];return this.collection.forEach(e=>{e={id:e.id,name:e.get("name"),recordCount:e.get("recordCount"),isEmpty:e.get("isEmpty"),link:"#"+this.subjectEntityType+"/list/categoryId="+e.id};t.push(e)}),t}setup(){this.listenTo(this.collection,"sync",()=>{this.reRender()}),this.subjectEntityType=this.options.subjectEntityType}actionShowMore(){this.$el.find(".category-item.show-more").addClass("hidden"),this.collection.fetch({remove:!1,more:!0})}}e.default=s}),define("views/record/kanban",["exports","views/record/list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="record/kanban";itemViewName="views/record/kanban-item";rowActionsView="views/record/row-actions/default-kanban";type="kanban";name="kanban";showCount=!0;headerDisabled=!1;layoutName="kanban";portalLayoutDisabled=!1;minColumnWidthPx=220;showMore=!0;quickDetailDisabled=!1;quickEditDisabled=!1;listLayout=null;_internalLayout=null;buttonsDisabled=!1;backDragStarted=!0;buttonList=[];events={"click a.link":function(t){if(!(t.ctrlKey||t.metaKey||t.shiftKey)&&(t.stopPropagation(),this.scope&&!this.selectable)){t.preventDefault();var t=$(t.currentTarget).data("id"),i=this.collection.get(t),s=this.getModelScope(t);let e={id:t,model:i};this.options.keepCurrentRootUrl&&(e.rootUrl=this.getRouter().getCurrentUrl()),this.getRouter().navigate("#"+s+"/view/"+t,{trigger:!1}),this.getRouter().dispatch(s,"view",e)}},'click [data-action="groupShowMore"]':function(e){let t=$(e.currentTarget);e=t.data("name");this.groupShowMore(e)},"click .action":function(e){Espo.Utils.handleAction(this,e.originalEvent,e.currentTarget,{actionItems:[...this.buttonList],className:"list-action-item"})},"mouseenter th.group-header":function(e){e=$(e.currentTarget).attr("data-name");this.showPlus(e)},"mouseleave th.group-header":function(e){e=$(e.currentTarget).attr("data-name");this.hidePlus(e)},'click [data-action="createInGroup"]':function(e){e=$(e.currentTarget).attr("data-group");this.actionCreateInGroup(e)},"mousedown .kanban-columns td":function(e){$(e.originalEvent.target).closest(".item").length||this.initBackDrag(e.originalEvent)},"auxclick a.link":function(t){if(1===t.button&&(t.ctrlKey||t.metaKey)){let e=$(t.currentTarget);var i=e.attr("data-id");i&&(this.quickDetailDisabled||e.parent().closest(`[data-id="${i}"]`).find(`ul.list-row-dropdown-menu[data-id="${i}"] a[data-action="quickView"]`).length&&(t.preventDefault(),t.stopPropagation(),this.actionQuickView({id:i})))}}};data(){return{scope:this.scope,header:this.header,topBar:this.displayTotalCount||this.buttonList.length&&!this.buttonsDisabled,showCount:this.showCount&&0<this.collection.total,buttonList:this.buttonList,displayTotalCount:this.displayTotalCount&&0<=this.collection.total,totalCount:this.collection.total,statusList:this.statusList,groupDataList:this.groupDataList,minTableWidthPx:this.minColumnWidthPx*this.statusList.length,isEmptyList:0===this.collection.models.length,totalCountFormatted:this.getNumberUtil().formatInt(this.collection.total),isCreatable:this.isCreatable}}init(){this.listLayout=this.options.listLayout||this.listLayout,this.type=this.options.type||this.type,this.layoutName=this.options.layoutName||this.layoutName||this.type,this.rowActionsView=(_.isUndefined(this.options.rowActionsView)?this:this.options).rowActionsView,this.massActionsDisabled&&!this.selectable&&(this.checkboxes=!1),this.rowActionsDisabled=this.options.rowActionsDisabled||this.rowActionsDisabled,"buttonsDisabled"in this.options&&(this.buttonsDisabled=this.options.buttonsDisabled)}getModelScope(e){return this.scope}setup(){if(void 0===this.collection)throw new Error("Collection has not been injected into Record.List view.");if(this.layoutLoadCallbackList=[],this.entityType=this.collection.entityType||null,this.scope=this.options.scope||this.entityType,this.buttonList=Espo.Utils.clone(this.buttonList),"showCount"in this.options&&(this.showCount=this.options.showCount),this.displayTotalCount=this.showCount&&this.getConfig().get("displayListViewRecordCount"),this.minColumnWidthPx=this.getConfig().get("kanbanMinColumnWidth")||this.minColumnWidthPx,"displayTotalCount"in this.options&&(this.displayTotalCount=this.options.displayTotalCount),this.getUser().isPortal()&&!this.portalLayoutDisabled&&this.getMetadata().get(["clientDefs",this.scope,"additionalLayouts",this.layoutName+"Portal"])&&(this.layoutName+="Portal"),this.orderDisabled=this.getMetadata().get(["scopes",this.scope,"kanbanOrderDisabled"]),this.getUser().isPortal()&&(this.orderDisabled=!0),this.statusField=this.getMetadata().get(["scopes",this.scope,"statusField"]),!this.statusField)throw new Error("No status field for entity type '"+this.scope+"'.");this.statusList=Espo.Utils.clone(this.getMetadata().get(["entityDefs",this.scope,"fields",this.statusField,"options"]));let t=this.getMetadata().get(["scopes",this.scope,"kanbanStatusIgnoreList"])||[];this.statusList=this.statusList.filter(e=>{if(!~t.indexOf(e))return!0}),this.seedCollection=this.collection.clone(),this.seedCollection.reset(),this.seedCollection.url=this.scope,this.seedCollection.maxSize=this.collection.maxSize,this.seedCollection.entityType=this.collection.entityType,this.seedCollection.orderBy=this.collection.defaultOrderBy,this.seedCollection.order=this.collection.defaultOrder,this.listenTo(this.collection,"sync",()=>{this.hasView("modal")&&this.getView("modal").isRendered()||this.buildRows(()=>{this.render()})}),this.collection.listenTo(this.collection,"change:"+this.statusField,this.onChangeGroup.bind(this),this),this.buildRows(),this.on("remove",()=>{$(window).off("resize.kanban-a-"+this.cid),$(window).off("scroll.kanban-"+this.cid),$(window).off("resize.kanban-"+this.cid)}),this.statusFieldIsEditable=this.getAcl().checkScope(this.entityType,"edit")&&!this.getAcl().getScopeForbiddenFieldList(this.entityType,"edit").includes(this.statusField)&&!this.getMetadata().get(["clientDefs",this.scope,"editDisabled"])&&!this.getMetadata().get(["entityDefs",this.entityType,"fields",this.statusField,"readOnly"]),this.isCreatable=this.statusFieldIsEditable&&this.getAcl().check(this.entityType,"create"),this.wait(this.getHelper().processSetupHandlers(this,"record/kanban"))}afterRender(){let e=$(window);this.$listKanban=this.$el.find(".list-kanban"),this.$content=$("#content"),this.$groupColumnList=this.$listKanban.find(".group-column-list"),this.$container=this.$el.find(".list-kanban-container"),e.off("resize.kanban-a-"+this.cid),e.on("resize.kanban-a-"+this.cid,()=>this.adjustMinHeight()),this.$container.on("scroll",()=>this.syncHeadScroll()),this.adjustMinHeight(),this.statusFieldIsEditable&&this.initSortable(),this.initStickableHeader(),this.$showMore=this.$el.find(".group-column .show-more"),this.plusElementMap={},this.statusList.forEach(e=>{var t=e.replace(/"/g,'\\"');this.plusElementMap[e]=this.$el.find('.kanban-head .create-button[data-group="'+t+'"]')})}initStickableHeader(){let a=this.$headContainer=this.$el.find(".kanban-head-container"),l=this.getThemeManager().getParam("navbarHeight")||30,r=this.getThemeManager().getParam("screenWidthXs"),o=this.$el.find(".kanban-columns-container"),n=$(window),d=$("<div>").addClass("kanban-head-placeholder").html("&nbsp;").hide().insertAfter(a),e=(n.off("scroll.kanban-"+this.cid),n.on("scroll.kanban-"+this.cid,()=>{e()}),n.off("resize.kanban-"+this.cid),n.on("resize.kanban-"+this.cid,()=>e()),()=>{var e,t,i,s=o.width();return $(window.document).width()<r?(a.removeClass("sticked"),a.css("width",""),d.hide(),a.show(),a.get(0).scrollLeft=0,void a.children().css("width","")):(e=this.$listKanban.offset().top-l,i=o.offset().top+o.outerHeight(!0),(t=n.scrollTop())<i?(e<t?(i=this.$container.width()-3,a.children().css("width",s),a.css("width",i+"px"),a.hasClass("sticked")||(a.addClass("sticked"),d.show())):(a.css("width",""),a.hasClass("sticked")&&(a.removeClass("sticked"),d.hide())),a.show(),void this.syncHeadScroll()):(a.css("width",s+"px"),a.hide(),d.show(),a.get(0).scrollLeft=0,void a.children().css("width","")))})}initSortable(){let l=this.$groupColumnList,r=(l.find("> .item").on("touchstart",e=>{e.originalEvent.stopPropagation()}),this.orderDisabled),i=this.$el.find(".group-column-list");l.sortable({distance:10,connectWith:".group-column-list",cancel:".btn-group *",containment:this.getSelector(),scroll:!1,over:function(){$(this).addClass("drop-hover")},out:function(){$(this).removeClass("drop-hover")},sort:e=>{this.blockScrollControl||this.controlHorizontalScroll(e.originalEvent)},start:(e,t)=>{i.addClass("drop-active"),l.sortable("refreshPositions"),$(t.item).find(".btn-group.open > .dropdown-toggle").parent().removeClass("open"),this.draggedGroupFrom=$(t.item).closest(".group-column-list").data("name"),this.$showMore.addClass("hidden"),this.sortIsStarted=!0,this.sortWasCentered=!1,this.$draggable=t.item},stop:(e,i)=>{this.blockScrollControl=!1,this.sortIsStarted=!1,this.$draggable=null;let t=$(i.item),s=(this.$el.find(".group-column-list").removeClass("drop-active"),t.closest(".group-column-list").data("name"));i=t.data("id");let a=this.draggedGroupFrom;if(this.draggedGroupFrom=null,this.$showMore.removeClass("hidden"),s!==a){let e=this.collection.get(i);if(!e)return void l.sortable("cancel");let t={};return t[this.statusField]=s,this.handleAttributesOnGroupChange(e,t,s),l.sortable("disable"),void e.save(t,{patch:!0,isDrop:!0}).then(()=>{Espo.Ui.success(this.translate("Saved")),l.sortable("destroy"),this.initSortable(),this.moveModelBetweenGroupCollections(e,a,s),r||(this.reOrderGroup(s),this.storeGroupOrder(s)),this.rebuildGroupDataList()}).catch(()=>{l.sortable("cancel"),l.sortable("enable")})}if(r)return l.sortable("cancel"),void l.sortable("enable");this.reOrderGroup(s),this.storeGroupOrder(s),this.rebuildGroupDataList()}})}storeGroupOrder(e,t){let i=this.getGroupOrderFromDom(e);return t&&i.unshift(t),Espo.Ajax.putRequest("Kanban/order",{entityType:this.entityType,group:e,ids:i})}getGroupOrderFromDom(e){let i=[],t=this.$el.find('.group-column-list[data-name="'+e+'"]');return t.children().each((e,t)=>{i.push($(t).data("id"))}),i}reOrderGroup(e){let t=this.getGroupCollection(e),i=this.getGroupOrderFromDom(e),s={};for(t.models.forEach(e=>{s[e.id]=e});t.models.length;)t.pop({silent:!0});i.forEach(e=>{e=s[e];e&&t.add(e,{silent:!0})})}rebuildGroupDataList(){this.groupDataList.forEach(e=>{e.dataList=[];for(var t of e.collection.models)e.dataList.push({key:t.id,id:t.id})})}moveModelBetweenGroupCollections(e,t,i){let s=this.getGroupCollection(t);s&&(s.remove(e.id,{silent:!0}),(s=this.getGroupCollection(i))&&s.add(e,{silent:!0}))}handleAttributesOnGroupChange(e,t,i){}adjustMinHeight(){if(0!==this.collection.models.length&&this.$container){let e=this.getHelper().calculateContentContainerHeight(this.$el.find(".kanban-columns-container"));var t=this.$container.get(0);t.scrollWidth>t.clientWidth&&(e-=18),e<100&&(e=100),this.$listKanban.find("td.group-column").css({minHeight:e+"px"})}}getListLayout(t){this.listLayout?t.call(this,this.listLayout):this._loadListLayout(e=>{this.listLayout=e,t.call(this,e)})}getSelectAttributeList(t){super.getSelectAttributeList(e=>{e&&(~e.indexOf(this.statusField)||e.push(this.statusField)),t(e)})}buildRows(s){let l=(this.collection.dataAdditional||{}).groupList||[],r=(this.collection.reset(),this.collection.subCollectionList=[],this.wait(!0),this.groupDataList=[],0),a=0;this.getListLayout(e=>{if(this.listLayout=e,l.forEach((e,t)=>{let i=this.seedCollection.clone(),s=(this.listenTo(i,"destroy",(e,t,i)=>{i.fromList||this.removeRecordFromList(e.id)}),i.total=e.total,i.url=this.collection.url,i.where=this.collection.where,i.entityType=this.seedCollection.entityType,i.maxSize=this.seedCollection.maxSize,i.orderBy=this.seedCollection.orderBy,i.order=this.seedCollection.order,i.whereAdditional=[{field:this.statusField,type:"equals",value:e.name}],i.groupName=e.name,i.set(e.list),this.collection.subCollectionList.push(i),this.collection.add(i.models),[]),a=(i.models.forEach(e=>{r++,s.push({key:e.id,id:e.id})}),null);t<l.length-1&&(a=this.getMetadata().get(["entityDefs",this.scope,"fields",this.statusField,"style",l[t+1].name]));t={name:e.name,label:this.getLanguage().translateOption(e.name,this.statusField,this.scope),dataList:s,collection:i,isLast:t===l.length-1,hasShowMore:i.total>i.length||-1===i.total,style:this.getMetadata().get(["entityDefs",this.scope,"fields",this.statusField,"style",e.name]),nextStyle:a};this.groupDataList.push(t)}),0===r)return this.wait(!1),void(s&&s());this.groupDataList.forEach(i=>{i.dataList.forEach((e,t)=>{e=i.collection.get(e.id);this.buildRow(t,e,()=>{++a===r&&(this.wait(!1),s&&s())})})})})}buildRow(e,t,i){var s=t.id;this.createView(s,this.itemViewName,{model:t,selector:'.item[data-id="'+t.id+'"]',itemLayout:this.listLayout,rowActionsDisabled:this.rowActionsDisabled,rowActionsView:this.rowActionsView,setViewBeforeCallback:this.options.skipBuildRows&&!this.isRendered(),statusFieldIsEditable:this.statusFieldIsEditable},i)}removeRecordFromList(t){this.collection.remove(t),0<this.collection.total&&this.collection.total--,this.totalCount=this.collection.total,this.$el.find(".total-count-span").text(this.totalCount.toString()),this.clearView(t),this.$el.find('.item[data-id="'+t+'"]').remove(),this.collection.subCollectionList.forEach(e=>{e.get(t)&&e.remove(t)});for(var i of this.groupDataList)for(let e=0;e<i.dataList.length;e++)if(i.dataList[e].id===t){i.dataList.splice(e,1),0<i.collection.total&&i.collection.total--,i.hasShowMore=i.collection.total>i.collection.length||-1===i.collection.total;break}}onChangeGroup(i,e,t){let s=i.id;var a,l=i.get(this.statusField);this.collection.subCollectionList.forEach(e=>{e.get(s)&&(e.remove(s),0<e.total&&e.total--)});let r;for(a of this.groupDataList)for(let e=0;e<a.dataList.length;e++){var o=a.dataList[e];if(o.id===s){r=o,a.dataList.splice(e,1);break}}if(l&&!t.isDrop){for(var n of this.groupDataList)n.name===l&&(n.collection.unshift(i),n.collection.total++,r&&(n.dataList.unshift(r),n.hasShowMore=n.collection.total>n.collection.length||-1===n.collection.total));let e=this.$el.find('.item[data-id="'+s+'"]'),t=this.$el.find('.group-column[data-name="'+l+'"] .group-column-list');t.length?t.prepend(e):e.remove(),this.orderDisabled||this.storeGroupOrder(l)}}groupShowMore(t){let i;for(var e in this.groupDataList){if((i=this.groupDataList[e]).name===t)break;i=null}if(i){let e=i.collection;var s=this.$el.find('.group-column-list[data-name="'+t+'"]'),a=this.$el.find('.group-column[data-name="'+t+'"] .show-more');e.data.select=this.collection.data.select,this.showMoreRecords({},e,s,a,()=>{this.noRebuild=!1,e.models.forEach(e=>{this.collection.get(e.id)||(this.collection.add(e),i.dataList.push({key:e.id,id:e.id}))})})}}getDomRowItem(e){return this.$el.find('.item[data-id="'+e+'"]')}getRowContainerHtml(e){return $("<div>").attr("data-id",e).addClass("item").get(0).outerHTML}actionMoveOver(e){e=this.collection.get(e.id);this.createView("moveOverDialog","views/modals/kanban-move-over",{model:e,statusField:this.statusField},e=>{e.render()})}getGroupCollection(t){let i=null;return this.collection.subCollectionList.forEach(e=>{e.groupName===t&&(i=e)}),i}showPlus(e){let t=this.plusElementMap[e];t&&t.removeClass("hidden")}hidePlus(e){let t=this.plusElementMap[e];t&&t.addClass("hidden")}actionCreateInGroup(t){let e={};e[this.statusField]=t;var i=this.getMetadata().get("clientDefs."+this.scope+".modalViews.edit")||"views/modals/edit",s={attributes:e,scope:this.scope};this.createView("quickCreate",i,s,e=>{e.getRecordView().setFieldReadOnly(this.statusField,!0),e.render(),this.listenToOnce(e,"after:save",()=>{this.orderDisabled?this.collection.fetch():this.storeGroupOrder(t,e.model.id).then(()=>this.collection.fetch())})})}initBackDrag(e){this.backDragStarted=!0;let t=this.$container.get(0),i=(t.style.cursor="grabbing",t.style.userSelect="none",$(document)),s=t.scrollLeft,a=e.clientX;i.on("mousemove."+this.cid,e=>{e=e.originalEvent.clientX-a;t.scrollLeft=s-e,this.syncHeadScroll()}),i.one("mouseup."+this.cid,()=>{this.stopBackDrag()})}stopBackDrag(){this.$container.get(0).style.cursor="default",this.$container.get(0).style.userSelect="none",$(document).off("mousemove."+this.cid)}syncHeadScroll(){this.$headContainer.hasClass("sticked")&&(this.$headContainer.get(0).scrollLeft=this.$container.get(0).scrollLeft)}controlHorizontalScroll(i){if(this.sortIsStarted&&this.$draggable){var s=this.$draggable.get(0).getBoundingClientRect(),a=s.left,s=s.right;let e=this.$container.get(0);var l=e.getBoundingClientRect();let t=2;var r=l.right-70<s&&e.scrollLeft+e.offsetWidth<e.scrollWidth,o=l.left+70>a&&0<e.scrollLeft;return(this.$groupColumnList.sortable("refreshPositions"),r&&this.sortWasCentered)?(l.right-s<17.5&&(t*=3),s=Math.min(t,e.offsetWidth-e.scrollLeft),e.scrollLeft=e.scrollLeft+s,this.syncHeadScroll(),e.scrollLeft+e.offsetWidth===e.scrollWidth?void(this.blockScrollControl=!1):(this.blockScrollControl=!0,void setTimeout(()=>this.controlHorizontalScroll(i),5))):o&&this.sortWasCentered?(-(l.left-a)<17.5&&(t*=3),s=Math.min(t,e.scrollLeft),e.scrollLeft=e.scrollLeft-s,this.syncHeadScroll(),0===e.scrollLeft?void(this.blockScrollControl=!1):(this.blockScrollControl=!0,void setTimeout(()=>this.controlHorizontalScroll(i),5))):(!this.blockScrollControl||o||r||(this.blockScrollControl=!1),void(o||r||(this.sortWasCentered=!0)))}}}e.default=s}),define("views/record/kanban-item",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="record/kanban-item";data(){return{layoutDataList:this.layoutDataList,rowActionsDisabled:this.rowActionsDisabled}}events={};setup(){var e;this.itemLayout=this.options.itemLayout,this.rowActionsView=this.options.rowActionsView,this.rowActionsDisabled=this.options.rowActionsDisabled,this.layoutDataList=[],this.itemLayout.forEach((e,t)=>{var i,s=e.name,a=s+"Field",t={name:s,isAlignRight:"right"===e.align,isLarge:e.isLarge,isFirst:0===t,key:a},t=(this.layoutDataList.push(t),e.view||this.model.getFieldParam(s,"view"));t||(i=this.model.getFieldType(s)||"base",t=this.getFieldManager().getViewName(i));let l="list";e.link&&(l="listLink"),this.createView(a,t,{model:this.model,name:s,mode:l,readOnly:!0,selector:'.field[data-name="'+s+'"]'})}),this.rowActionsDisabled||(e={edit:this.getAcl().checkModel(this.model,"edit"),delete:this.getAcl().checkModel(this.model,"delete")},this.createView("itemMenu",this.rowActionsView,{selector:".item-menu-container",model:this.model,acl:e,statusFieldIsEditable:this.options.statusFieldIsEditable}))}}e.default=s}),define("views/record/edit-small",["exports","views/record/edit"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{bottomView=null}e.default=s}),define("views/record/edit-side",["exports","views/record/detail-side"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{mode="edit";defaultPanelDefs={name:"default",label:!1,view:"views/record/panels/side",isForm:!0,options:{fieldList:[{name:":assignedUser"},{name:"teams",view:"views/fields/teams"}]}}}e.default=s}),define("views/record/edit-bottom",["exports","views/record/detail-bottom"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{mode="edit";streamPanel=!1;relationshipPanels=!1}e.default=s}),define("views/record/detail-small",["exports","views/record/detail"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{bottomView=null}e.default=s}),define("views/record/detail-middle",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{init(){this.recordHelper=this.options.recordHelper,this.scope=this.model.entityType}data(){return{hiddenPanels:this.recordHelper.getHiddenPanels(),hiddenFields:this.recordHelper.getHiddenFields()}}showPanel(e){this.recordHelper.getPanelStateParam(e,"hiddenLocked")||(this.showPanelInternal(e),this.recordHelper.setPanelStateParam(e,"hidden",!1))}showPanelInternal(e){this.isRendered()&&this.$el.find('.panel[data-name="'+e+'"]').removeClass("hidden"),!!this.recordHelper.getPanelStateParam(e,"hidden")&&this.options.panelFieldListMap&&this.options.panelFieldListMap[e]&&this.options.panelFieldListMap[e].forEach(e=>{e=this.getFieldView(e);e&&e.reRender()})}hidePanel(e){this.hidePanelInternal(e),this.recordHelper.setPanelStateParam(e,"hidden",!0)}hidePanelInternal(e){this.isRendered()&&this.$el.find('.panel[data-name="'+e+'"]').addClass("hidden")}hideField(s){this.recordHelper.setFieldStateParam(s,"hidden",!0);var e=()=>{var e,t,i=this.getFieldView(s);i?(t=(e=(i=i.$el).closest('.cell[data-name="'+s+'"]')).find('label.control-label[data-name="'+s+'"]'),i.addClass("hidden"),t.addClass("hidden"),e.addClass("hidden-cell")):(this.$el.find('.cell[data-name="'+s+'"]').addClass("hidden-cell"),this.$el.find('.field[data-name="'+s+'"]').addClass("hidden"),this.$el.find('label.control-label[data-name="'+s+'"]').addClass("hidden"))},t=(this.isRendered()?e():this.once("after:render",()=>{e()}),this.getFieldView(s));t&&t.setDisabled()}showField(s){var e,t;this.recordHelper.getFieldStateParam(s,"hiddenLocked")||(this.recordHelper.setFieldStateParam(s,"hidden",!1),e=()=>{var e,t,i=this.getFieldView(s);i?(t=(e=(i=i.$el).closest('.cell[data-name="'+s+'"]')).find('label.control-label[data-name="'+s+'"]'),i.removeClass("hidden"),t.removeClass("hidden"),e.removeClass("hidden-cell")):(this.$el.find('.cell[data-name="'+s+'"]').removeClass("hidden-cell"),this.$el.find('.field[data-name="'+s+'"]').removeClass("hidden"),this.$el.find('label.control-label[data-name="'+s+'"]').removeClass("hidden"))},this.isRendered()?e():this.once("after:render",()=>{e()}),(t=this.getFieldView(s))&&(t.disabledLocked||t.setNotDisabled()))}getFields(){return this.getFieldViews()}getFieldViews(){let e={};for(var t in this.nestedViews){var i=this.nestedViews[t].name;e[i]=this.nestedViews[t]}return e}getFieldView(e){return(this.getFieldViews()||{})[e]}getView(e){let t=super.getView(e);return t=t||this.getFieldView(e)}}e.default=s}),define("views/record/deleted-detail",["views/record/detail"],function(e){return e.extend({bottomView:null,sideView:"views/record/deleted-detail-side",setupBeforeFinal:function(){e.prototype.setupBeforeFinal.call(this),this.buttonList=[],this.dropdownItemList=[],this.addDropdownItem({name:"restoreDeleted",label:"Restore"})},actionRestoreDeleted:function(){Espo.Ui.notify(" ... "),Espo.Ajax.postRequest(this.model.entityType+"/action/restoreDeleted",{id:this.model.id}).then(()=>{Espo.Ui.notify(!1),this.model.set("deleted",!1),this.model.trigger("after:restore-deleted")})}})}),define("views/record/deleted-detail-side",["views/record/detail-side"],function(e){return e.extend({additionalPanelsDisabled:!0})}),define("views/record/row-actions/view-only",["exports","views/record/row-actions/default"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){return[{action:"quickView",label:"View",data:{id:this.model.id},link:"#"+this.model.entityType+"/view/"+this.model.id}]}}e.default=s}),define("views/record/row-actions/view-and-remove",["exports","views/record/row-actions/default"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){const e=[{action:"quickView",label:"View",data:{id:this.model.id},link:"#"+this.model.entityType+"/view/"+this.model.id}];return this.options.acl.delete&&e.push({action:"quickRemove",label:"Remove",data:{id:this.model.id}}),e}}e.default=s}),define("views/record/row-actions/view-and-edit",["exports","views/record/row-actions/default"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){let e=[{action:"quickView",label:"View",data:{id:this.model.id},link:"#"+this.model.entityType+"/view/"+this.model.id}];return e=this.options.acl.edit?e.concat([{action:"quickEdit",label:"Edit",data:{id:this.model.id},link:"#"+this.model.entityType+"/edit/"+this.model.id}]):e}}e.default=s}),define("views/record/row-actions/remove-only",["exports","views/record/row-actions/default"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){if(this.options.acl.delete)return[{action:"quickRemove",label:"Remove",data:{id:this.model.id}}]}}e.default=s}),define("views/record/row-actions/relationship-view-only",["exports","views/record/row-actions/relationship"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){return[{action:"viewRelated",label:"View",data:{id:this.model.id},link:"#"+this.model.entityType+"/view/"+this.model.id}]}}e.default=s}),define("views/record/row-actions/relationship-view-and-unlink",["exports","views/record/row-actions/relationship"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){const e=[{action:"quickView",label:"View",data:{id:this.model.id},link:"#"+this.model.entityType+"/view/"+this.model.id}];return this.options.acl.edit&&!this.options.unlinkDisabled&&e.push({action:"unlinkRelated",label:"Unlink",data:{id:this.model.id}}),e}}e.default=s}),define("views/record/row-actions/relationship-view-and-edit",["exports","views/record/row-actions/relationship"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){const e=[{action:"quickView",label:"View",data:{id:this.model.id},link:"#"+this.model.entityType+"/view/"+this.model.id}];return this.options.acl.edit&&e.push({action:"quickEdit",label:"Edit",data:{id:this.model.id},link:"#"+this.model.entityType+"/edit/"+this.model.id}),e}}e.default=s}),define("views/record/row-actions/relationship-unlink-only",["exports","views/record/row-actions/relationship"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){if(this.options.acl.edit&&!this.options.unlinkDisabled)return[{action:"unlinkRelated",label:"Unlink",data:{id:this.model.id}}]}}e.default=s}),define("views/record/row-actions/relationship-remove-only",["exports","views/record/row-actions/relationship"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){if(this.options.acl.delete)return[{action:"removeRelated",label:"Remove",data:{id:this.model.id}}]}}e.default=s}),define("views/record/row-actions/relationship-no-unlink",["exports","views/record/row-actions/relationship"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){let e=[{action:"quickView",label:"View",data:{id:this.model.id},link:"#"+this.model.entityType+"/view/"+this.model.id}];return this.options.acl.edit&&(e=e.concat([{action:"quickEdit",label:"Edit",data:{id:this.model.id},link:"#"+this.model.entityType+"/edit/"+this.model.id}])),this.options.acl.delete&&e.push({action:"removeRelated",label:"Remove",data:{id:this.model.id}}),e}}e.default=s}),define("views/record/row-actions/relationship-no-remove",["views/record/row-actions/relationship"],function(e){return e.extend({getActionList:function(){var e=[{action:"quickView",label:"View",data:{id:this.model.id},link:"#"+this.model.entityType+"/view/"+this.model.id}];return this.options.acl.edit&&(e.push({action:"quickEdit",label:"Edit",data:{id:this.model.id},link:"#"+this.model.entityType+"/edit/"+this.model.id}),this.options.unlinkDisabled||e.push({action:"unlinkRelated",label:"Unlink",data:{id:this.model.id}})),e}})}),define("views/record/row-actions/relationship-edit-and-remove",["exports","views/record/row-actions/relationship"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){const e=[];return this.options.acl.edit&&e.push({action:"quickEdit",label:"Edit",data:{id:this.model.id}}),this.options.acl.delete&&e.push({action:"quickRemove",label:"Remove",data:{id:this.model.id}}),e}}e.default=s}),define("views/record/row-actions/empty",["exports","views/record/row-actions/default"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){return[]}}e.default=s}),define("views/record/row-actions/default-kanban",["exports","views/record/row-actions/default"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getActionList(){const e=[{action:"quickView",label:"View",data:{id:this.model.id},link:"#"+this.model.entityType+"/view/"+this.model.id}];return this.options.statusFieldIsEditable&&e.push({action:"moveOver",label:"Move Over",data:{id:this.model.id}}),this.options.acl.edit&&e.push({action:"quickEdit",label:"Edit",data:{id:this.model.id},link:"#"+this.model.entityType+"/edit/"+this.model.id}),this.options.acl.delete&&e.push({action:"quickRemove",label:"Remove",data:{id:this.model.id}}),e}}e.default=s}),define("views/record/panels/default-side",["exports","views/record/panels/side"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{data(){let e=super.data();return(this.complexCreatedDisabled&&this.complexModifiedDisabled||!this.hasComplexCreated&&!this.hasComplexModified)&&(e.complexDateFieldsDisabled=!0),e.hasComplexCreated=this.hasComplexCreated,e.hasComplexModified=this.hasComplexModified,e}setup(){this.fieldList=Espo.Utils.cloneDeep(this.fieldList),this.hasComplexCreated=!!this.getMetadata().get(["entityDefs",this.model.entityType,"fields","createdAt"])&&!!this.getMetadata().get(["entityDefs",this.model.entityType,"fields","createdBy"]),this.hasComplexModified=!!this.getMetadata().get(["entityDefs",this.model.entityType,"fields","modifiedAt"])&&!!this.getMetadata().get(["entityDefs",this.model.entityType,"fields","modifiedBy"]),super.setup()}setupFields(){super.setupFields(),this.complexCreatedDisabled?this.recordViewObject.hideField("complexCreated"):this.hasComplexCreated&&(this.fieldList.push({name:"complexCreated",labelText:this.translate("Created"),isAdditional:!0,view:"views/fields/complex-created",readOnly:!0}),this.model.get("createdById")||this.recordViewObject.hideField("complexCreated")),this.complexModifiedDisabled?this.recordViewObject.hideField("complexModified"):(this.hasComplexModified&&this.fieldList.push({name:"complexModified",labelText:this.translate("Modified"),isAdditional:!0,view:"views/fields/complex-created",readOnly:!0,options:{baseName:"modified"}}),this.model.get("modifiedById")||this.recordViewObject.hideField("complexModified")),!this.complexCreatedDisabled&&this.hasComplexCreated&&this.listenTo(this.model,"change:createdById",()=>{this.model.get("createdById")&&this.recordViewObject.showField("complexCreated")}),!this.complexModifiedDisabled&&this.hasComplexModified&&this.listenTo(this.model,"change:modifiedById",()=>{this.model.get("modifiedById")&&this.recordViewObject.showField("complexModified")}),this.getMetadata().get(["scopes",this.model.entityType,"stream"])&&!this.getUser().isPortal()&&(this.fieldList.push({name:"followers",labelText:this.translate("Followers"),isAdditional:!0,view:"views/fields/followers",readOnly:!0}),this.controlFollowersField(),this.listenTo(this.model,"change:followersIds",()=>this.controlFollowersField()))}controlFollowersField(){this.model.get("followersIds")&&this.model.get("followersIds").length?this.recordViewObject.showField("followers"):this.recordViewObject.hideField("followers")}}e.default=s}),define("views/notification/panel",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="notification/panel";setup(){this.addActionHandler("markAllNotificationsRead",()=>this.actionMarkAllRead()),this.addActionHandler("openNotifications",()=>this.actionOpenNotifications()),this.addActionHandler("closePanel",()=>this.close()),this.addHandler("keydown","",e=>{"Escape"===e.code&&this.close()});var e=this.getCollectionFactory().create("Notification",e=>{this.collection=e,this.collection.maxSize=this.getConfig().get("notificationsMaxSize")||5,this.listenTo(this.collection,"sync",()=>{this.trigger("collection-fetched")})});this.wait(e),this.navbarPanelHeightSpace=this.getThemeManager().getParam("navbarPanelHeightSpace")||100,this.navbarPanelBodyMaxHeight=this.getThemeManager().getParam("navbarPanelBodyMaxHeight")||600,this.once("remove",()=>{$(window).off("resize.notifications-height"),this.overflowWasHidden&&($("body").css("overflow","unset"),this.overflowWasHidden=!1)})}afterRender(){this.collection.fetch().then(()=>this.createRecordView()).then(e=>e.render());let e=$(window);e.off("resize.notifications-height"),e.on("resize.notifications-height",this.processSizing.bind(this)),this.processSizing(),$("#navbar li.notifications-badge-container").addClass("open"),this.$el.find("> .panel").focus()}onRemove(){$("#navbar li.notifications-badge-container").removeClass("open")}createRecordView(){var e=this.getMetadata().get(["clientDefs","Notification","recordViews","list"])||"views/notification/record/list";return this.createView("list",e,{selector:".list-container",collection:this.collection,showCount:!1,listLayout:{rows:[[{name:"data",view:"views/notification/fields/container",options:{containerSelector:this.getSelector()}}]],right:{name:"read",view:"views/notification/fields/read",width:"10px"}}})}actionMarkAllRead(){Espo.Ajax.postRequest("Notification/action/markAllRead").then(()=>this.trigger("all-read"))}processSizing(){let e=$(window);var t=e.height(),i=e.width(),s=this.$el.find(".panel-heading").outerHeight();let a={};if(i<=this.getThemeManager().getParam("screenWidthXs"))return a.height=t-s+"px",a.overflow="auto",$("body").css("overflow","hidden"),this.overflowWasHidden=!0,void this.$el.find(".panel-body").css(a);a.height="unset",a.overflow="none",this.overflowWasHidden&&($("body").css("overflow","unset"),this.overflowWasHidden=!1),t-this.navbarPanelBodyMaxHeight<this.navbarPanelHeightSpace&&(i=t-this.navbarPanelHeightSpace,a.maxHeight=i+"px"),this.$el.find(".panel-body").css(a)}close(){this.trigger("close")}actionOpenNotifications(){this.getRouter().navigate("#Notification",{trigger:!0}),this.close()}}e.default=s}),define("views/notification/list",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="notification/list";setup(){this.addActionHandler("refresh",()=>this.getRecordView().showNewRecords()),this.addActionHandler("markAllNotificationsRead",()=>this.actionMarkAllRead());var e=this.getCollectionFactory().create("Notification").then(e=>{this.collection=e,this.collection.maxSize=this.getConfig().get("recordsPerPage")||20});this.wait(e)}afterRender(){let e=this.getMetadata().get(["clientDefs","Notification","recordViews","list"])||"views/notification/record/list",t={selector:".list-container",collection:this.collection,showCount:!1,listLayout:{rows:[[{name:"data",view:"views/notification/fields/container",options:{containerSelector:this.getSelector()}}]],right:{name:"read",view:"views/notification/fields/read-with-menu",width:"10px"}}};this.collection.fetch().then(()=>this.createView("list",e,t)).then(e=>e.render()).then(e=>{e.$el.find("> .list > .list-group")})}actionMarkAllRead(){Espo.Ajax.postRequest("Notification/action/markAllRead").then(()=>{this.trigger("all-read"),this.$el.find(".badge-circle-warning").remove()})}getRecordView(){return this.getView("list")}}e.default=s}),define("views/notification/badge",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="notification/badge";notificationsCheckInterval=10;groupedCheckInterval=15;useWebSocket=!1;timeout=null;groupedTimeout=null;popupNotificationsData;soundPath="client/sounds/pop_cork";setup(){this.addActionHandler("showNotifications",()=>this.showNotifications()),this.soundPath=this.getBasePath()+(this.getConfig().get("notificationSound")||this.soundPath),this.notificationSoundsDisabled=!0,this.useWebSocket=!!this.getHelper().webSocketManager;let e=()=>{for(var e in this.timeout&&clearTimeout(this.timeout),this.groupedTimeout&&clearTimeout(this.groupedTimeout),this.popupTimeouts)clearTimeout(this.popupTimeouts[e])};this.once("remove",()=>e()),this.listenToOnce(this.getHelper().router,"logout",()=>e()),this.notificationsCheckInterval=this.getConfig().get("notificationsCheckInterval")||this.notificationsCheckInterval,this.groupedCheckInterval=this.getConfig().get("popupNotificationsCheckInterval")||this.groupedCheckInterval,this.lastId=0,this.shownNotificationIds=[],this.closedNotificationIds=[],this.popupTimeouts={},delete localStorage.messageBlockPlayNotificationSound,delete localStorage.messageClosePopupNotificationId,delete localStorage.messageNotificationRead,window.addEventListener("storage",e=>{var t,i;"messageClosePopupNotificationId"===e.key&&(!(t=localStorage.getItem("messageClosePopupNotificationId"))||this.hasView(i="popup-"+t)&&(this.markPopupRemoved(t),this.clearView(i))),"messageNotificationRead"===e.key&&!this.isBroadcastingNotificationRead&&localStorage.getItem("messageNotificationRead")&&this.checkUpdates()},!1)}afterRender(){for(var e in this.$badge=this.$el.find(".notifications-button"),this.$number=this.$el.find(".number-badge"),this.runCheckUpdates(!0),this.$popupContainer=$("#popup-notifications-container"),$(this.$popupContainer).length||(this.$popupContainer=$("<div>").attr("id","popup-notifications-container").addClass("hidden").appendTo("body")),this.popupNotificationsData=this.getMetadata().get("app.popupNotifications")||{})this.checkPopupNotifications(e);this.hasGroupedPopupNotifications()&&this.checkGroupedPopupNotifications()}playSound(){if(!this.notificationSoundsDisabled){const e=$("<audio>").attr("autoplay","autoplay").append($("<source>").attr("src",this.soundPath+".mp3").attr("type","audio/mpeg")).append($("<source>").attr("src",this.soundPath+".ogg").attr("type","audio/ogg")).append($("<embed>").attr("src",this.soundPath+".mp3").attr("hidden","true").attr("autostart","true").attr("false","false")).get(0);e.volume=.3,e.play()}}showNotRead(e){this.$badge.attr("title",this.translate("New notifications")+": "+e),this.$number.removeClass("hidden").html(e.toString()),this.getHelper().pageTitle.setNotificationNumber(e)}hideNotRead(){this.$badge.attr("title",this.translate("Notifications")),this.$number.addClass("hidden").html(""),this.getHelper().pageTitle.setNotificationNumber(0)}checkBypass(){var e=this.getRouter().getLast()||{},t=(e.options||{}).page||null;return!("Admin"!==e.controller||"page"!==e.action||!~["upgrade","extensions"].indexOf(t))}checkUpdates(t){this.checkBypass()||Espo.Ajax.getRequest("Notification/action/notReadCount").then(e=>{!t&&e>this.unreadCount&&(localStorage.getItem("messageBlockPlayNotificationSound")||(this.playSound(),localStorage.setItem("messageBlockPlayNotificationSound","true"),setTimeout(()=>{delete localStorage.messageBlockPlayNotificationSound},1e3*this.notificationsCheckInterval))),(this.unreadCount=e)?this.showNotRead(e):this.hideNotRead()})}runCheckUpdates(e){this.checkUpdates(e),this.useWebSocket?this.getHelper().webSocketManager.subscribe("newNotification",()=>{this.checkUpdates()}):this.timeout=setTimeout(()=>this.runCheckUpdates(),1e3*this.notificationsCheckInterval)}hasGroupedPopupNotifications(){for(var e in this.popupNotificationsData){e=this.popupNotificationsData[e]||{};if(e.grouped&&(!e.portalDisabled||!this.getUser().isPortal()))return!0}return!1}checkGroupedPopupNotifications(){this.checkBypass()||Espo.Ajax.getRequest("PopupNotification/action/grouped").then(i=>{for(let t in i){let e=i[t];e.forEach(e=>this.showPopupNotification(t,e))}}),this.useWebSocket||(this.groupedTimeout=setTimeout(()=>this.checkGroupedPopupNotifications(),1e3*this.groupedCheckInterval))}checkPopupNotifications(i,t){var s=this.popupNotificationsData[i]||{};let a=s.url,l=s.interval;var r=s.disabled||!1;if(!(r||s.portalDisabled&&this.getUser().isPortal())){let e=this.useWebSocket&&s.useWebSocket;e&&(r="popupNotifications."+(s.webSocketCategory||i),this.getHelper().webSocketManager.subscribe(r,(e,t)=>{t.list&&t.list.forEach(e=>{this.showPopupNotification(i,e)})})),s.grouped||a&&l&&new Promise(e=>{this.checkBypass()?e():Espo.Ajax.getRequest(a).then(e=>e.forEach(e=>this.showPopupNotification(i,e,t))).finally(()=>e())}).then(()=>{e||(this.popupTimeouts[i]=setTimeout(()=>this.checkPopupNotifications(i,!0),1e3*l))})}}showPopupNotification(e,i,s){var a=this.popupNotificationsData[e].view;if(a){let t=i.id||null;if(t){if(t=e+"_"+t,~this.shownNotificationIds.indexOf(t)){let e=this.getView("popup-"+t);return void(e&&e.trigger("update-data",i.data))}if(~this.closedNotificationIds.indexOf(t))return}else t=this.lastId++;this.shownNotificationIds.push(t),this.createView("popup-"+t,a,{notificationData:i.data||{},notificationId:i.id,id:t,isFirstCheck:!s},e=>{e.render(),this.$popupContainer.removeClass("hidden"),this.listenTo(e,"remove",()=>{this.markPopupRemoved(t),localStorage.setItem("messageClosePopupNotificationId",t)})})}}markPopupRemoved(e){var t=this.shownNotificationIds.indexOf(e);-1<t&&this.shownNotificationIds.splice(t,1),0===this.shownNotificationIds.length&&this.$popupContainer.addClass("hidden"),this.closedNotificationIds.push(e)}broadcastNotificationsRead(){this.useWebSocket&&(this.isBroadcastingNotificationRead=!0,localStorage.setItem("messageNotificationRead","true"),setTimeout(()=>{this.isBroadcastingNotificationRead=!1,delete localStorage.messageNotificationRead},500))}showNotifications(){this.closeNotifications();let t=$("<div>").attr("id","notifications-panel"),e=(t.appendTo(this.$el.find(".notifications-panel-container")),this.createView("panel","views/notification/panel",{fullSelector:"#notifications-panel"},e=>{e.render(),this.$el.closest(".navbar-body").removeClass("in"),this.listenTo(e,"all-read",()=>{this.hideNotRead(),this.$el.find(".badge-circle-warning").remove(),this.broadcastNotificationsRead()}),this.listenTo(e,"collection-fetched",()=>{this.checkUpdates(),this.broadcastNotificationsRead()}),this.listenToOnce(e,"close",()=>{this.closeNotifications()})}),$(document));e.on("mouseup.notification",e=>{t.is(e.target)||0!==t.has(e.target).length||$(e.target).closest("div.modal-dialog").length||this.closeNotifications()}),window.innerWidth<this.getThemeManager().getParam("screenWidthXs")&&this.listenToOnce(this.getRouter(),"route",()=>{this.closeNotifications()})}closeNotifications(){let e=$("#notifications-panel"),t=(e.remove(),$(document));this.hasView("panel")&&this.getView("panel").remove(),t.off("mouseup.notification")}}e.default=s}),define("views/note/detail",["views/main"],e=>e.extend({templateContent:`
            <div class="header page-header">{{{header}}}</div>
            <div class="record list-container list-container-panel block-center">{{{record}}}</div>
        `,isDeleted:!1,setup:function(){this.scope=this.model.entityType,this.setupHeader(),this.setupRecord(),this.listenToOnce(this.model,"remove",()=>{this.clearView("record"),this.isDeleted=!0,this.getHeaderView().reRender()})},setupHeader:function(){this.createView("header","views/header",{selector:"> .header",scope:this.scope,fontSizeFlexible:!0})},setupRecord:function(){this.wait(this.getCollectionFactory().create(this.scope).then(e=>{this.collection=e,this.collection.add(this.model),this.createView("record","views/stream/record/list",{selector:"> .record",collection:this.collection,isUserStream:!0})}))},getHeader:function(){var e=this.model.get("parentType"),t=this.model.get("parentId"),i=this.model.get("parentName"),s=this.model.get("type");let a=$("<span>").text(this.getLanguage().translateOption(s,"type","Note"));return(this.model.get("deleted")||this.isDeleted)&&a.css("text-decoration","line-through"),e&&t?this.buildHeaderHtml([$("<a>").attr("href","#"+e).text(this.translate(e,"scopeNamesPlural")),$("<a>").attr("href","#"+e+"/view/"+t).text(i||t),$("<span>").text(this.translate("Stream","scopeNames")),a]):this.buildHeaderHtml([$("<span>").text(this.translate("Stream","scopeNames")),a])}})),define("views/note/record/edit",["views/record/edit"],function(e){return e.extend({sideView:null,isWide:!0,setup:function(){e.prototype.setup.call(this),this.controlRequiredFields(),this.listenTo(this.model,"change:attachmentsIds",()=>{this.controlRequiredFields()})},controlRequiredFields:function(){(this.model.get("attachmentsIds")||[]).length?this.setFieldNotRequired("post"):this.setFieldRequired("post")},afterRender:function(){e.prototype.afterRender.call(this)}})}),define("views/note/modals/edit",["views/modals/edit"],function(e){return e.extend({fullFormDisabled:!0,setup:function(){e.prototype.setup.call(this),this.once("ready",()=>{let t=this.getView("edit")||this.getView("record");var e;!t||(e=t.getFieldView("post"))&&this.listenTo(e,"add-files",e=>{t.getFieldView("attachments")&&t.getFieldView("attachments").uploadFiles(e)})})}})}),define("views/note/fields/users",["views/fields/link-multiple"],function(e){return e.extend({init:function(){this.messagePermission=this.getAcl().getPermissionLevel("message"),this.portalPermission=this.getAcl().getPermissionLevel("portal"),"no"===this.messagePermission&&"no"===this.portalPermission&&(this.readOnly=!0),e.prototype.init.call(this)},getSelectBoolFilterList:function(){return"team"===this.messagePermission?["onlyMyTeam"]:"yes"===this.portalPermission?null:void 0},getSelectPrimaryFilterName:function(){return"yes"===this.portalPermission&&"no"===this.messagePermission?"activePortal":"active"},getSelectFilterList:function(){return"yes"===this.portalPermission?"no"===this.messagePermission?["activePortal"]:["active","activePortal"]:null}})}),define("views/note/fields/post",["views/fields/text","lib!jquery-textcomplete"],function(e,t){return e.extend({setup:function(){e.prototype.setup.call(this),this.events["paste textarea"]=e=>this.handlePaste(e),this.insertedImagesData={}},handlePaste:function(t){if(t.originalEvent.clipboardData){let e=t.originalEvent.clipboardData.getData("text/plain");(e=e&&e.trim())&&this.handlePastedText(e,t.originalEvent)}},afterRenderEdit:function(){var e=this.options.placeholderText||this.translate("writeMessage","messages","Note");this.$element.attr("placeholder",e),this.$textarea=this.$element;let t=this.$textarea,i=(t.off("drop"),t.off("dragover"),t.off("dragleave"),t.off("paste"),t.on("paste",e=>{var t=e.originalEvent.clipboardData.items;if(t)for(var i,s=0;s<t.length;s++)~t[s].type.indexOf("image")&&(i=t[s].getAsFile(),this.trigger("add-files",[i]))}),this.$textarea.on("drop",e=>{e.preventDefault(),e.stopPropagation(),(e=e.originalEvent).dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length&&this.trigger("add-files",e.dataTransfer.files),this.$textarea.attr("placeholder",i)}),this.$textarea.attr("placeholder")),s=(this.$textarea.on("dragover",e=>{e.preventDefault(),this.$textarea.attr("placeholder",this.translate("dropToAttach","messages"))}),this.$textarea.on("dragleave",e=>{e.preventDefault(),this.$textarea.attr("placeholder",i)}),this.getAcl().get("assignmentPermission"));var a=e=>{let t="User?q="+e+"&"+$.param({primaryFilter:"active"})+"&orderBy=name&maxSize="+this.getConfig().get("recordsPerPage")+"&select=id,name,userName";return"team"===s&&(t+="&"+$.param({boolFilterList:["onlyMyTeam"]})),t};"no"!==s&&this.model.isNew()&&(this.$element.textcomplete([{match:/(^|\s)@(\w*)$/,search:(e,t)=>{0!==e.length?Espo.Ajax.getRequest(a(e)).then(e=>{t(e.list)}):t([])},template:e=>this.getHelper().escapeString(e.name)+' <span class="text-muted">@'+this.getHelper().escapeString(e.userName)+"</span>",replace:e=>"$1@"+e.userName}],{zIndex:1100}),this.once("remove",()=>{this.$element.length&&this.$element.textcomplete("destroy")}))},validateRequired:function(){return(!this.isRequired()||!(this.model.get("attachmentsIds")||[]).length)&&e.prototype.validateRequired.call(this)},handlePastedText:function(i,e){if(/^http(s){0,1}\:\/\//.test(i)){var s=".+\\.("+["jpg","jpeg","png","gif"].join("|")+")(/?.*){0,1}$";let e=new RegExp(s,"i"),a=i;s=this.getConfig().get("siteUrl").replace(/\/$/,"");let t=this.model.get("attachmentsIds")||[];if(e.test(i))return(l=this.insertedImagesData[a])&&~t.indexOf(l)?void 0:void Espo.Ajax.postRequest("Attachment/fromImageUrl",{url:a,parentType:"Note",field:"attachments"}).then(e=>{let t=Espo.Utils.clone(this.model.get("attachmentsIds")||[]),i=Espo.Utils.clone(this.model.get("attachmentsNames")||{}),s=Espo.Utils.clone(this.model.get("attachmentsTypes")||{});t.push(e.id),i[e.id]=e.name,s[e.id]=e.type,this.insertedImagesData[a]=e.id,this.model.set({attachmentsIds:t,attachmentsNames:i,attachmentsTypes:s})}).catch(e=>{e.errorIsHandled=!0});if(/\?entryPoint\=image\&/.test(i)&&0===i.indexOf(s)){a=i.replace(/[\&]{0,1}size\=[a-z\-]*/,"");var l=/\&{0,1}id\=([a-z0-9A-Z]*)/g.exec(i);if(2===l.length){let a=l[1];~t.indexOf(a)||((s=this.insertedImagesData[a])&&~t.indexOf(s)||Espo.Ajax.postRequest("Attachment/copy/"+a,{parentType:"Note",field:"attachments"}).then(e=>{let t=Espo.Utils.clone(this.model.get("attachmentsIds")||[]),i=Espo.Utils.clone(this.model.get("attachmentsNames")||{}),s=Espo.Utils.clone(this.model.get("attachmentsTypes")||{});t.push(e.id),i[e.id]=e.name,s[e.id]=e.type,this.insertedImagesData[a]=e.id,this.model.set({attachmentsIds:t,attachmentsNames:i,attachmentsTypes:s})}).catch(e=>{e.errorIsHandled=!0}))}}}}})}),define("views/modals/view-map",["exports","views/modal"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{templateContent='<div class="map-container no-side-margin">{{{map}}}</div>';backdrop=!0;setup(){var e=this.options.field,t="#AddressMap/view/"+this.model.entityType+"/"+this.model.id+"/"+e,i=this.translate(e,"fields",this.model.entityType),t=(this.headerElement=$("<a>").attr("href","#"+t).text(i).get(0),this.model.getFieldParam(e+"Map","view")||this.getFieldManager().getViewName("map"));this.createView("map",t,{model:this.model,name:e+"Map",selector:".map-container",height:"auto"})}}e.default=s}),define("views/modals/select-template",["exports","views/modals/select-records"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{multiple=!1;createButton=!1;searchPanel=!1;scope="Template";setupSearch(){super.setupSearch(),this.searchManager.setAdvanced({entityType:{type:"equals",value:this.options.entityType}}),this.collection.where=this.searchManager.getWhere()}afterRender(){super.afterRender();let e=this.$el.find("a.link").first().get(0);e&&setTimeout(()=>e.focus({preventScroll:!0}),10)}}e.default=s}),define("views/modals/select-records-with-categories",["exports","views/modals/select-records","views/list-with-categories"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{template="modals/select-records-with-categories";categoryField="category";categoryFilterType="inCategory";categoryScope="";isExpanded=!0;data(){return{...super.data(),categoriesDisabled:this.categoriesDisabled}}setup(){this.scope=this.entityType=this.options.scope||this.scope,this.categoryScope=this.categoryScope||this.scope+"Category",this.categoriesDisabled=this.categoriesDisabled||this.getMetadata().get(["scopes",this.categoryScope,"disabled"])||!this.getAcl().checkScope(this.categoryScope),super.setup()}setupList(){this.categoriesDisabled||this.setupCategories(),super.setupList()}setupCategories(){this.getCollectionFactory().create(this.categoryScope,e=>{(this.treeCollection=e).url=e.entityType+"/action/listTree",e.data.onlyNotEmpty=!0,e.fetch().then(()=>this.createCategoriesView())})}createCategoriesView(){this.createView("categories","views/record/list-tree",{collection:this.treeCollection,selector:".categories-container",selectable:!0,readOnly:!0,showRoot:!0,rootName:this.translate(this.scope,"scopeNamesPlural"),buttonsDisabled:!0,checkboxes:!1,isExpanded:this.isExpanded},e=>{this.isRendered()?e.render():this.listenToOnce(this,"after:render",()=>e.render()),this.listenTo(e,"select",e=>{this.currentCategoryId=null,this.currentCategoryName="",e&&e.id&&(this.currentCategoryId=e.id,this.currentCategoryName=e.get("name")),this.applyCategoryToCollection(),Espo.Ui.notify(" ... "),this.collection.fetch().then(()=>Espo.Ui.notify(!1))})})}applyCategoryToCollection(){i.default.prototype.applyCategoryToCollection.call(this)}isCategoryMultiple(){i.default.prototype.isCategoryMultiple.call(this)}}e.default=a}),define("views/modals/select-category-tree-records",["exports","views/modals/select-records"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setup(){this.filters=this.options.filters||{},this.boolFilterList=this.options.boolFilterList||{},this.primaryFilterName=this.options.primaryFilterName||null,"multiple"in this.options&&(this.multiple=this.options.multiple),this.createButton=!1,this.massRelateEnabled=this.options.massRelateEnabled,this.buttonList=[{name:"cancel",label:"Cancel"}],this.multiple&&this.buttonList.unshift({name:"select",style:"danger",label:"Select",onClick:e=>{let t=this.getRecordView();var i;t.allResultIsChecked?this.trigger("select",{massRelate:!0,where:this.collection.getWhere(),searchParams:this.collection.data}):(i=t.getSelected()).length&&this.trigger("select",i),e.close()}}),this.scope=this.options.scope,this.$header=$("<span>"),this.$header.append($("<span>").text(this.translate("Select")+": "+this.getLanguage().translate(this.scope,"scopeNamesPlural"))),this.$header.prepend(this.getHelper().getScopeColorIconHtml(this.scope)),this.waitForView("list"),Espo.loader.require("search-manager",s=>{this.getCollectionFactory().create(this.scope,e=>{e.maxSize=this.getConfig().get("recordsPerPageSelect")||5,this.collection=e;var t=new s(e,"listSelect",null,this.getDateTime()),i=(t.emptyOnReset=!0,this.filters&&t.setAdvanced(this.filters),this.boolFilterList&&t.setBool(this.boolFilterList),this.primaryFilterName&&t.setPrimary(this.primaryFilterName),e.where=t.getWhere(),e.url=e.entityType+"/action/listTree",this.getMetadata().get("clientDefs."+this.scope+".recordViews.listSelectCategoryTree")||"views/record/list-tree");this.listenToOnce(e,"sync",()=>{this.createView("list",i,{collection:e,fullSelector:this.containerSelector+" .list-container",readOnly:!0,selectable:!0,checkboxes:this.multiple,massActionsDisabled:!0,searchManager:t,checkAllResultDisabled:!0,buttonsDisabled:!0},e=>{e.once("select",e=>{this.trigger("select",e),this.close()})})}),e.fetch()})})}}e.default=s}),define("views/modals/save-filters",["exports","views/modal","model"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{template="modals/save-filters";cssName="save-filters";data(){return{dashletList:this.dashletList}}setup(){this.buttonList=[{name:"save",label:"Save",style:"primary"},{name:"cancel",label:"Cancel"}],this.headerText=this.translate("Save Filter");var e=new i.default;this.createView("name","views/fields/varchar",{selector:'.field[data-name="name"]',defs:{name:"name",params:{required:!0}},mode:"edit",model:e})}getFieldView(e){return this.getView(e)}actionSave(){let e=this.getFieldView("name");if(e.fetchToModel(),!e.validate())return this.trigger("save",e.model.get("name")),!0}}e.default=a}),define("views/modals/resolve-save-conflict",["exports","views/modal"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="modals/resolve-save-conflict";backdrop=!0;resolutionList=["current","actual","original"];defaultResolution="current";data(){let t=[];return this.fieldList.forEach(e=>{e={field:e,viewKey:e+"Field",resolution:this.defaultResolution};t.push(e)}),{dataList:t,entityType:this.entityType,resolutionList:this.resolutionList}}setup(){this.headerText=this.translate("Resolve Conflict"),this.buttonList=[{name:"apply",label:"Apply",style:"danger"},{name:"cancel",label:"Cancel"}],this.entityType=this.model.entityType,this.originalModel=this.model,this.originalAttributes=Espo.Utils.cloneDeep(this.options.originalAttributes),this.currentAttributes=Espo.Utils.cloneDeep(this.options.currentAttributes),this.actualAttributes=Espo.Utils.cloneDeep(this.options.actualAttributes);let i=this.options.attributeList,s=[];this.getFieldManager().getEntityTypeFieldList(this.entityType).forEach(e=>{let t=this.getFieldManager().getEntityTypeFieldAttributeList(this.entityType,e);i.filter(e=>t.includes(e)).length&&s.push(e)}),this.fieldList=s,this.wait(this.getModelFactory().create(this.entityType).then(e=>{this.model=e,this.fieldList.forEach(e=>{this.setResolution(e,this.defaultResolution)}),this.fieldList.forEach(e=>{this.createField(e)})}))}setResolution(e,t){var i,e=this.getFieldManager().getEntityTypeFieldAttributeList(this.entityType,e);let s={},a=this.currentAttributes;"actual"===t?a=this.actualAttributes:"original"===t&&(a=this.originalAttributes);for(i of e)s[i]=a[i]||null;this.model.set(s)}createField(e){var t=this.model.getFieldType(e),t=this.model.getFieldParam(e,"view")||this.getFieldManager().getViewName(t);this.createView(e+"Field",t,{readOnly:!0,model:this.model,name:e,selector:'[data-name="field"][data-field="'+e+'"]',mode:"list"})}afterRender(){this.$el.find('[data-name="resolution"]').on("change",e=>{let t=$(e.currentTarget);var e=t.attr("data-field"),i=t.val();this.setResolution(e,i)})}actionApply(){var e=this.model.attributes;this.originalModel.set(e),this.trigger("resolve"),this.close()}}e.default=s}),define("views/modals/password-change-request",["exports","views/modal"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="modals/password-change-request";cssName="password-change-request";className="dialog dialog-centered";noFullHeight=!0;footerAtTheTop=!1;setup(){this.buttonList=[{name:"submit",label:"Submit",style:"danger",className:"btn-s-wide"},{name:"cancel",label:"Close",pullLeft:!0,className:"btn-s-wide"}],this.headerText=this.translate("Password Change Request","labels","User"),this.once("close remove",()=>{this.$userName&&this.$userName.popover("destroy"),this.$emailAddress&&this.$emailAddress.popover("destroy")})}afterRender(){this.$userName=this.$el.find('input[name="username"]'),this.$emailAddress=this.$el.find('input[name="emailAddress"]')}actionSubmit(){let t=this.$userName,i=this.$emailAddress;var e=t.val(),s=i.val();let a=!0;if(""===e){a=!1;var l=this.getLanguage().translate("userCantBeEmpty","messages","User");this.isPopoverUserNameDestroyed=!1,t.popover({container:"body",placement:"bottom",content:l,trigger:"manual"}).popover("show");let e=t.closest(".form-group");e.addClass("has-error"),t.one("mousedown click",()=>{e.removeClass("has-error"),this.isPopoverUserNameDestroyed||(t.popover("destroy"),this.isPopoverUserNameDestroyed=!0)})}if(""===s){a=!1;l=this.getLanguage().translate("emailAddressCantBeEmpty","messages","User");this.isPopoverEmailAddressDestroyed=!1,i.popover({container:"body",placement:"bottom",content:l,trigger:"manual"}).popover("show");let e=i.closest(".form-group");e.addClass("has-error"),i.one("mousedown click",()=>{e.removeClass("has-error"),this.isPopoverEmailAddressDestroyed||(i.popover("destroy"),this.isPopoverEmailAddressDestroyed=!0)})}if(a){let t=this.$el.find('button[data-name="submit"]');t.addClass("disabled"),Espo.Ui.notify(this.translate("pleaseWait","messages")),Espo.Ajax.postRequest("User/passwordChangeRequest",{userName:e,emailAddress:s,url:this.options.url}).then(()=>{Espo.Ui.notify(!1);var e=this.translate("uniqueLinkHasBeenSent","messages","User");e+=" "+this.translate("passwordRecoverySentIfMatched","messages","User"),this.$el.find(".cell-userName").addClass("hidden"),this.$el.find(".cell-emailAddress").addClass("hidden"),t.addClass("hidden"),this.$el.find(".msg-box").removeClass("hidden"),this.$el.find(".msg-box").html('<span class="text-success">'+e+"</span>")}).catch(e=>{404===e.status&&(Espo.Ui.error(this.translate("userNameEmailAddressNotFound","messages","User")),e.errorIsHandled=!0),403===e.status&&"Already-Sent"===e.getResponseHeader("X-Status-Reason")&&(Espo.Ui.error(this.translate("forbidden","messages","User"),!0),e.errorIsHandled=!0),t.removeClass("disabled")})}}}e.default=s}),define("views/modals/mass-update",["exports","views/modal","helpers/mass-action"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{template="modals/mass-update";cssName="mass-update";className="dialog dialog-record";layoutName="massUpdate";ACTION_UPDATE="update";data(){return{scope:this.scope,fieldList:this.fieldList,entityType:this.entityType}}events={'click a[data-action="add-field"]':function(e){e=$(e.currentTarget).data("name");this.addField(e)},'click button[data-action="reset"]':function(){this.reset()}};setup(){this.buttonList=[{name:"update",label:"Update",style:"danger",disabled:!0},{name:"cancel",label:"Cancel"}],this.entityType=this.options.entityType||this.options.scope,this.scope=this.options.scope||this.entityType,this.ids=this.options.ids,this.where=this.options.where,this.searchParams=this.options.searchParams,this.byWhere=this.options.byWhere,this.hasActionMap={};var e=this.options.totalCount,i=(this.helper=new s.default(this),this.idle=this.byWhere&&this.helper.checkIsIdle(e),this.$header=$("<span>").append($("<span>").text(this.translate(this.scope,"scopeNamesPlural")),' <span class="chevron-right"></span> ',$("<span>").text(this.translate("Mass Update"))),this.getAcl().getScopeForbiddenFieldList(this.entityType,"edit")||[]);this.wait(!0),this.getModelFactory().create(this.entityType,t=>{this.model=t,this.getHelper().layoutManager.get(this.entityType,this.layoutName,e=>{e=e||[],this.fieldList=[],e.forEach(e=>{~i.indexOf(e)||t.hasField(e)&&this.fieldList.push(e)}),this.wait(!1)})}),this.addedFieldList=[]}addField(e){this.$el.find('[data-action="reset"]').removeClass("hidden"),this.$el.find('ul.filter-list li[data-name="'+e+'"]').addClass("hidden"),0===this.$el.find("ul.filter-list li:not(.hidden)").length&&this.$el.find("button.select-field").addClass("disabled").attr("disabled","disabled"),this.addedFieldList.push(e);var t=this.getHelper().escapeString(this.translate(e,"fields",this.entityType)),t=$("<div>").addClass("cell form-group").attr("data-name",e).append($("<label>").addClass("control-label").text(t)).append($("<div>").addClass("field").attr("data-name",e));let s=$("<div>").addClass("item grid-auto-fill-md").attr("data-name",e).append(t);this.$el.find(".fields-container").append(s);var t=this.model.getFieldType(e),a=this.model.getFieldParam(e,"view")||this.getFieldManager().getViewName(t);let l=this.getMetadata().get(["entityDefs",this.entityType,e,"massUpdateActionList"])||this.getMetadata().get(["fields",t,"massUpdateActionList"]);t=null!==l;if(this.hasActionMap[e]=t,this.disableButton("update"),this.createView(e,a,{model:this.model,selector:'.field[data-name="'+e+'"]',defs:{name:e},mode:"edit"},e=>{this.enableButton("update"),e.render()}),t){let i=$("<select>").addClass("item-action form-control").attr("data-name",e);l.forEach(e=>{var t=this.translate(Espo.Utils.upperCaseFirst(e));i.append($("<option>").text(t).val(e))});a=$("<div>").addClass("cell call-action form-group").attr("data-name",e).append($("<label>").addClass("control-label hidden-xs").html("&nbsp;")).append($("<div>").addClass("field").attr("data-name",e).append(i));s.append(a)}}getFieldView(e){return this.getView(e)}actionUpdate(){this.disableButton("update");let a={},l={},i=(this.addedFieldList.forEach(e=>{let t=this.fetchAction(e),i=this.getFieldView(e).fetch(),s={};this.getFieldManager().getEntityTypeFieldActualAttributeList(this.entityType,e).forEach(e=>{l[e]=t,s[e]=i[e]}),_.extend(a,s)}),this.model.set(a),!1);if(this.addedFieldList.forEach(e=>{let t=this.getFieldView(e);i=t.validate()||i}),i)return Espo.Ui.error(this.translate("Not valid")),void this.enableButton("update");Espo.Ui.notify(this.translate("saving","messages")),Espo.Ajax.postRequest("MassAction",{action:"update",entityType:this.entityType,params:{ids:this.ids||null,where:this.ids&&0!==this.ids.length?null:this.options.where,searchParams:this.ids&&0!==this.ids.length?null:this.options.searchParams},data:{values:a,actions:l},idle:this.idle}).then(e=>{(e=e||{}).id?this.helper.process(e.id,"update").then(e=>{this.listenToOnce(e,"close",()=>this.close()),this.listenToOnce(e,"success",e=>{this.trigger("after:update",{count:e.count,idle:!0})})}):this.trigger("after:update",{count:e.count})}).catch(()=>{this.enableButton("update")})}fetchAction(e){if(!this.hasActionMap[e])return this.ACTION_UPDATE;let t=this.$el.find('select.item-action[data-name="'+e+'"]');return t.val()||this.ACTION_UPDATE}reset(){this.addedFieldList.forEach(e=>{this.clearView(e),this.$el.find('.item[data-name="'+e+'"]').remove()}),this.addedFieldList=[],this.hasActionMap={},this.model.clear(),this.$el.find('[data-action="reset"]').addClass("hidden"),this.$el.find("button.select-field").removeClass("disabled").removeAttr("disabled"),this.$el.find("ul.filter-list").find("li").removeClass("hidden"),this.disableButton("update")}}e.default=a}),define("views/modals/mass-action",["exports","views/modal","model"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{template="modals/mass-action";className="dialog dialog-record";checkInterval=4e3;data(){return{infoText:this.translate("infoText","messages","MassAction")}}setup(){this.action=this.options.action,this.id=this.options.id,this.status="Pending",this.headerText=this.translate("Mass Action","scopeNames")+": "+this.translate(this.action,"massActions",this.options.scope),this.model=new i.default,this.model.name="MassAction",this.model.setDefs({fields:{status:{type:"enum",readOnly:!0,options:["Pending","Running","Success","Failed"],style:{Success:"success",Failed:"danger"}},processedCount:{type:"int",readOnly:!0}}}),this.model.set({status:this.status,processedCount:null}),this.createView("record","views/record/edit-for-modal",{scope:"None",model:this.model,selector:".record",detailLayout:[{rows:[[{name:"status",labelText:this.translate("status","fields","MassAction")},{name:"processedCount",labelText:this.translate("processedCount","fields","MassAction")}]]}]}),this.on("close",()=>{var e=this.model.get("status");"Pending"!==e&&"Running"!==e||Espo.Ajax.postRequest(`MassAction/${this.id}/subscribe`)}),this.checkStatus()}checkStatus(){Espo.Ajax.getRequest(`MassAction/${this.id}/status`).then(e=>{var t=e.status;this.model.set("status",t),"Pending"!==t&&"Running"!==t?(this.model.set({processedCount:e.processedCount}),"Success"===t&&this.trigger("success",{count:e.processedCount}),this.$el&&this.$el.find(".info-text").addClass("hidden")):setTimeout(()=>this.checkStatus(),this.checkInterval)})}}e.default=a}),define("views/modals/last-viewed",["exports","views/modal"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{scope="ActionHistoryRecord";className="dialog dialog-record";template="modals/last-viewed";backdrop=!0;setup(){this.events["click .list .cell > a"]=()=>{this.close()},this.$header=$("<a>").attr("href","#LastViewed").attr("data-action","listView").addClass("action").text(this.getLanguage().translate("LastViewed","scopeNamesPlural")),this.waitForView("list"),this.getCollectionFactory().create(this.scope,e=>{e.maxSize=this.getConfig().get("recordsPerPage"),e.url="LastViewed",this.collection=e,this.loadList(),e.fetch()})}actionListView(){this.getRouter().navigate("#LastViewed",{trigger:!0}),this.close()}loadList(){let e=this.getMetadata().get("clientDefs."+this.scope+".recordViews.listLastViewed")||"views/record/list";this.listenToOnce(this.collection,"sync",()=>{this.createView("list",e,{collection:this.collection,fullSelector:this.containerSelector+" .list-container",selectable:!1,checkboxes:!1,massActionsDisabled:!0,rowActionsView:!1,searchManager:this.searchManager,checkAllResultDisabled:!0,buttonsDisabled:!0,headerDisabled:!0,layoutName:"listForLastViewed",layoutAclDisabled:!0})})}}e.default=s}),define("views/modals/kanban-move-over",["exports","views/modal"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="modals/kanban-move-over";backdrop=!0;data(){return{optionDataList:this.optionDataList}}events={'click [data-action="move"]':function(e){e=$(e.currentTarget).data("value");this.moveTo(e)}};setup(){this.scope=this.model.entityType;var e=this.getHelper().getScopeColorIconHtml(this.scope);this.statusField=this.options.statusField,this.$header=$("<span>"),this.$header.append($("<span>").text(this.getLanguage().translate(this.scope,"scopeNames"))),this.model.get("name")&&(this.$header.append(' <span class="chevron-right"></span> '),this.$header.append($("<span>").text(this.model.get("name")))),this.$header.prepend(e),this.buttonList=[{name:"cancel",label:"Cancel"}],this.optionDataList=[],(this.getMetadata().get(["entityDefs",this.scope,"fields",this.statusField,"options"])||[]).forEach(e=>{this.optionDataList.push({value:e,label:this.getLanguage().translateOption(e,this.statusField,this.scope)})})}moveTo(e){var t={};t[this.statusField]=e,this.model.save(t,{patch:!0,isMoveTo:!0}).then(()=>{Espo.Ui.success(this.translate("Done"))}),this.close()}}e.default=s}),define("views/modals/image-preview",["exports","views/modal"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=(i=t)&&i.__esModule?i:{default:i};let s;class a extends t.default{template="modals/image-preview";cssName="image-preview";size="";backdrop=!0;transformClassList=["transform-flip","transform-rotate-180","transform-flip-and-rotate-180","transform-flip-and-rotate-270","transform-rotate-90","transform-flip-and-rotate-90","transform-rotate-270"];events={keydown:function(e){"ArrowLeft"!==e.code?"ArrowRight"===e.code&&this.switchToNext(!0):this.switchToPrevious(!0)}};data(){return{name:this.options.name,url:this.getImageUrl(),originalUrl:this.getOriginalImageUrl(),showOriginalLink:this.size}}setup(){this.buttonList=[],this.headerHtml="&nbsp;",this.navigationEnabled=this.options.imageList&&1<this.options.imageList.length,this.imageList=this.options.imageList||[],this.once("remove",()=>{$(window).off("resize.image-review")}),this.wait(Espo.loader.requirePromise("lib!exif-js").then(e=>s=e))}getImageUrl(){let e=this.getBasePath()+"?entryPoint=image&id="+this.options.id;return this.size&&(e+="&size="+this.size),this.getUser().get("portalId")&&(e+="&portalId="+this.getUser().get("portalId")),e}getOriginalImageUrl(){let e=this.getBasePath()+"?entryPoint=image&id="+this.options.id;return this.getUser().get("portalId")&&(e+="&portalId="+this.getUser().get("portalId")),e}onImageLoad(){}afterRender(){let t=this.$el.find(".image-container"),i=this.$img=this.$el.find(".image-container img");i.on("load",()=>{var e=i.get(0);s.getData(e,()=>{if("from-image"!==i.css("image-orientation"))switch(s.getTag(this,"Orientation")){case 2:i.addClass("transform-flip");break;case 3:i.addClass("transform-rotate-180");break;case 4:i.addClass("transform-rotate-180"),i.addClass("transform-flip");break;case 5:i.addClass("transform-rotate-270"),i.addClass("transform-flip");break;case 6:i.addClass("transform-rotate-90");break;case 7:i.addClass("transform-rotate-90"),i.addClass("transform-flip");break;case 8:i.addClass("transform-rotate-270")}}),e.naturalWidth>e.clientWidth&&this.$el.find(".original-link-container").removeClass("hidden")}),this.navigationEnabled&&(i.css("cursor","pointer"),i.click(()=>{this.switchToNext()}));const e=()=>{var e=t.width();i.css("maxWidth",e)};$(window).off("resize.image-review"),$(window).on("resize.image-review",()=>{e()}),setTimeout(()=>e(),100)}isMultiple(){return 1<this.imageList.length}switchToPrevious(e){if(this.isMultiple()){let i=-1;this.imageList.forEach((e,t)=>{e.id===this.options.id&&(i=t)}),e&&0===i||(this.transformClassList.forEach(e=>{this.$img.removeClass(e)}),--i<0&&(i=this.imageList.length-1),this.options.id=this.imageList[i].id,this.options.name=this.imageList[i].name,this.reRender())}}switchToNext(e){if(this.isMultiple()){let i=-1;this.imageList.forEach((e,t)=>{e.id===this.options.id&&(i=t)}),e&&i===this.imageList.length-1||(this.transformClassList.forEach(e=>{this.$img.removeClass(e)}),++i>this.imageList.length-1&&(i=0),this.options.id=this.imageList[i].id,this.options.name=this.imageList[i].name,this.reRender())}}}e.default=a}),define("views/modals/image-crop",["exports","views/modal"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="modals/image-crop";cssName="image-crop";events={'click [data-action="zoomIn"]':function(){this.$img.cropper("zoom",.1)},'click [data-action="zoomOut"]':function(){this.$img.cropper("zoom",-.1)}};setup(){this.buttonList=[{name:"crop",label:"Submit",style:"primary"},{name:"cancel",label:"Cancel"}],this.wait(Espo.loader.requirePromise("lib!cropper")),this.on("remove",()=>{this.$img.length&&(this.$img.cropper("destroy"),this.$img.parent().empty())})}afterRender(){let e=this.$img=$("<img>").attr("src",this.options.contents).addClass("hidden");this.$el.find(".image-container").append(e),setTimeout(()=>{e.cropper({aspectRatio:1,movable:!0,resizable:!0,rotatable:!1})},50)}actionCrop(){var e=this.$img.cropper("getDataURL","image/jpeg");this.trigger("crop",e),this.close()}}e.default=s}),define("views/modals/followers-list",["exports","views/modals/related-list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{massActionRemoveDisabled=!0;massActionMassUpdateDisabled=!0;mandatorySelectAttributeList=["type"];setup(){this.getUser().isAdmin()||"no"!==this.getAcl().getPermissionLevel("followerManagementPermission")||"no"!==this.getAcl().getPermissionLevel("portalPermission")||(this.unlinkDisabled=!0),super.setup()}actionSelectRelated(){let e=this.getParentView();for(;e;){if(e.actionSelectRelated){e;break}e=e.getParentView()}let t="active";this.getUser().isAdmin()||"no"!==this.getAcl().getPermissionLevel("followerManagementPermission")||"yes"!==this.getAcl().getPermissionLevel("portalPermission")||(t="activePortal"),e.actionSelectRelated({link:this.link,primaryFilterName:t,massSelect:!1,foreignEntityType:"User",viewKey:"selectFollowers"})}}e.default=s}),define("views/modals/edit-dashboard",["exports","views/modal","model"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{template="modals/edit-dashboard";className="dialog dialog-record";cssName="edit-dashboard";data(){return{hasLocked:this.hasLocked}}events={"click button.add":function(e){e=$(e.currentTarget).data("name");this.getParentDashboardView().addDashlet(e),this.close()}};shortcutKeys={"Control+Enter":"save"};getParentDashboardView(){return this.getParentView()}setup(){this.buttonList=[{name:"save",label:this.options.fromDashboard?"Save":"Apply",style:"primary",title:"Ctrl+Enter"},{name:"cancel",label:"Cancel",title:"Esc"}];let e=this.options.dashboardLayout||[],t=[],i=(e.forEach(e=>{e.name&&t.push(e.name)}),this.model=new s.default({},{entityType:"Preferences"}));i.set("dashboardTabList",t),this.hasLocked="dashboardLocked"in this.options,this.hasLocked&&i.set("dashboardLocked",this.options.dashboardLocked||!1),this.createView("dashboardTabList","views/preferences/fields/dashboard-tab-list",{selector:'.field[data-name="dashboardTabList"]',defs:{name:"dashboardTabList",params:{required:!0,noEmptyString:!0}},mode:"edit",model:i}),this.hasLocked&&this.createView("dashboardLocked","views/fields/bool",{selector:'.field[data-name="dashboardLocked"]',mode:"edit",model:i,defs:{name:"dashboardLocked"}}),this.headerText=this.translate("Edit Dashboard"),this.dashboardLayout=this.options.dashboardLayout}getFieldView(e){return this.getView(e)}actionSave(){const e=this.getFieldView("dashboardTabList");if(e.fetchToModel(),this.hasLocked){const t=this.getFieldView("dashboardLocked");t.fetchToModel()}if(!e.validate()){let e={};e.dashboardTabList=this.model.get("dashboardTabList"),this.hasLocked&&(e.dashboardLocked=this.model.get("dashboardLocked"));var i,s=this.model.get("translatedOptions");let t={};for(i in s)i!==s[i]&&(t[i]=s[i]);e.renameMap=t,this.trigger("after:save",e),this.dialog.close()}}}e.default=a}),define("views/modals/duplicate",["exports","views/modal"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="modals/duplicate";cssName="duplicate-modal";data(){return{scope:this.scope,duplicates:this.duplicates}}setup(){let e="Save";this.model&&this.model.isNew()&&(e="Create"),this.buttonList=[{name:"save",label:e,style:"danger",onClick:e=>{this.trigger("save"),e.close()}},{name:"cancel",label:"Cancel"}],this.scope=this.options.scope,this.duplicates=this.options.duplicates,this.scope&&this.setupRecord()}setupRecord(){var e=new Promise(i=>{this.getHelper().layoutManager.get(this.scope,"listSmall",t=>{(t=Espo.Utils.cloneDeep(t)).forEach(e=>e.notSortable=!0),this.getCollectionFactory().create(this.scope).then(e=>{e.add(this.duplicates),this.createView("record","views/record/list",{selector:".list-container",collection:e,listLayout:t,buttonsDisabled:!0,massActionsDisabled:!0,rowActionsDisabled:!0}),i()})})});this.wait(e)}}e.default=s}),define("views/modals/detail",["exports","views/modal","helpers/action-item-setup","backbone"],function(e,t,i,r){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i),r=s(r);class a extends t.default{template="modals/detail";cssName="detail-modal";className="dialog dialog-record";editDisabled=!1;fullFormDisabled=!1;detailView=null;removeDisabled=!0;backdrop=!0;fitHeight=!0;sideDisabled=!1;bottomDisabled=!1;fixedHeaderHeight=!0;flexibleHeaderFontSize=!0;duplicateAction=!1;shortcutKeys={"Control+Space":function(e){this.editDisabled||"TEXTAREA"!==e.target.tagName&&"INPUT"!==e.target.tagName&&-1!==this.buttonList.findIndex(e=>"edit"===e.name)&&(e.stopPropagation(),e.preventDefault(),this.actionEdit().then(e=>{e.$el.find(".form-control:not([disabled])").first().focus()}))},"Control+Backslash":function(e){this.getRecordView().handleShortcutKeyControlBackslash(e)},"Control+ArrowLeft":function(e){this.handleShortcutKeyControlArrowLeft(e)},"Control+ArrowRight":function(e){this.handleShortcutKeyControlArrowRight(e)}};setup(){this.scope=this.scope||this.options.scope,this.id=this.options.id,this.buttonList=[],"editDisabled"in this.options&&(this.editDisabled=this.options.editDisabled),"removeDisabled"in this.options&&(this.removeDisabled=this.options.removeDisabled),this.editDisabled=this.getMetadata().get(["clientDefs",this.scope,"editDisabled"])||this.editDisabled,this.removeDisabled=this.getMetadata().get(["clientDefs",this.scope,"removeDisabled"])||this.removeDisabled,this.fullFormDisabled=this.options.fullFormDisabled||this.fullFormDisabled,this.layoutName=this.options.layoutName||this.layoutName,this.setupRecordButtons(),this.model&&this.controlRecordButtonsVisibility(),this.fullFormDisabled||this.buttonList.push({name:"fullForm",label:"Full Form"}),this.buttonList.push({name:"cancel",label:"Close",title:"Esc"}),this.model&&this.model.collection&&!this.navigateButtonsDisabled?(this.buttonList.push({name:"previous",html:'<span class="fas fa-chevron-left"></span>',title:this.translate("Previous Entry"),position:"right",className:"btn-icon",style:"text",disabled:!0}),this.buttonList.push({name:"next",html:'<span class="fas fa-chevron-right"></span>',title:this.translate("Next Entry"),position:"right",className:"btn-icon",style:"text",disabled:!0}),this.indexOfRecord=this.model.collection.indexOf(this.model)):this.navigateButtonsDisabled=!0,this.waitForView("record"),this.sourceModel=this.model,this.getModelFactory().create(this.scope).then(e=>{if(!this.sourceModel)return this.model=e,this.model.id=this.id,this.setupAfterModelCreated(),this.listenTo(this.model,"sync",()=>{this.controlRecordButtonsVisibility(),this.trigger("model-sync")}),this.listenToOnce(this.model,"sync",()=>{this.setupActionItems(),this.createRecordView()}),void this.model.fetch();this.model=this.sourceModel.clone(),this.model.collection=this.sourceModel.collection.clone(),this.setupAfterModelCreated(),this.listenTo(this.model,"change",()=>{this.sourceModel.set(this.model.getClonedAttributes())}),this.listenTo(this.model,"sync",()=>{this.controlRecordButtonsVisibility(),this.trigger("model-sync")}),this.once("after:render",()=>{this.model.fetch()}),this.setupActionItems(),this.createRecordView()}),this.listenToOnce(this.getRouter(),"routed",()=>{this.remove()}),this.duplicateAction&&this.getAcl().checkScope(this.scope,"create")&&this.addDropdownItem({name:"duplicate",label:"Duplicate"})}setupActionItems(){let e=new i.default(this.getMetadata(),this.getHelper(),this.getAcl(),this.getLanguage());e.setup(this,"modalDetail",e=>this.wait(e),e=>this.addDropdownItem(e),e=>this.showActionItem(e),e=>this.hideActionItem(e),{listenToViewModelSync:!0})}setupAfterModelCreated(){}setupRecordButtons(){this.removeDisabled||this.addRemoveButton(),this.editDisabled||this.addEditButton()}controlRecordButtonsVisibility(){this.getAcl().check(this.model,"edit")?this.showButton("edit"):this.hideButton("edit"),this.getAcl().check(this.model,"delete")?this.showActionItem("remove"):this.hideActionItem("remove")}addEditButton(){this.addButton({name:"edit",label:"Edit",title:"Ctrl+Space"},!0)}removeEditButton(){this.removeButton("edit")}addRemoveButton(){this.addDropdownItem({name:"remove",label:"Remove"})}removeRemoveButton(){this.removeButton("remove")}getScope(){return this.scope}createRecordView(e){let t=this.model;var i=this.getScope(),i=(this.headerHtml="",this.headerHtml+=$("<span>").text(this.getLanguage().translate(i,"scopeNames")).get(0).outerHTML,t.get("name")&&(this.headerHtml+=" "+$("<span>").addClass("chevron-right").get(0).outerHTML,this.headerHtml+=" "+$("<span>").text(t.get("name")).get(0).outerHTML),this.fullFormDisabled||(i="#"+i+"/view/"+this.id,this.headerHtml=$("<a>").attr("href",i).addClass("action font-size-flexible").attr("title",this.translate("Full Form")).attr("data-action","fullForm").append(this.headerHtml).get(0).outerHTML),this.headerHtml=this.getHelper().getScopeColorIconHtml(this.scope)+this.headerHtml,this.editDisabled||((i=this.getAcl().check(t,"edit",!0))?this.showButton("edit"):(this.hideButton("edit"),null===i&&this.listenToOnce(t,"sync",()=>{this.getAcl().check(t,"edit")&&this.showButton("edit")}))),this.removeDisabled||((i=this.getAcl().check(t,"delete",!0))?this.showButton("remove"):(this.hideButton("remove"),null===i&&this.listenToOnce(t,"sync",()=>{this.getAcl().check(t,"delete")&&this.showButton("remove")}))),this.detailViewName||this.detailView||this.getMetadata().get(["clientDefs",t.entityType,"recordViews","detailSmall"])||this.getMetadata().get(["clientDefs",t.entityType,"recordViews","detailQuick"])||"views/record/detail-small"),s={model:t,fullSelector:this.containerSelector+" .record-container",type:"detailSmall",layoutName:this.layoutName||"detailSmall",buttonsDisabled:!0,inlineEditDisabled:!0,sideDisabled:this.sideDisabled,bottomDisabled:this.bottomDisabled,exit:function(){}};this.createView("record",i,s,e)}getRecordView(){return this.getView("record")}afterRender(){super.afterRender(),setTimeout(()=>{this.$el.children(0).scrollTop(0)},50),this.navigateButtonsDisabled||this.controlNavigationButtons()}controlNavigationButtons(){if(this.getRecordView()){var i=this.indexOfRecord;let e=!1,t=!1;0<i&&(e=!0),(i<this.model.collection.total-1||-1===this.model.collection.total||-2===this.model.collection.total&&i<this.model.collection.length-1)&&(t=!0),e?this.enableButton("previous"):this.disableButton("previous"),t?this.enableButton("next"):this.disableButton("next")}}switchToModelByIndex(e){if(this.model.collection){var t=this.model;if(this.sourceModel=this.model.collection.at(e),!this.sourceModel)throw new Error("Model is not found in collection by index.");this.indexOfRecord=e,this.id=this.sourceModel.id,this.scope=this.sourceModel.entityType,this.model=this.sourceModel.clone(),this.model.collection=this.sourceModel.collection.clone(),this.stopListening(t,"change"),this.stopListening(t,"sync"),this.listenTo(this.model,"change",()=>{this.sourceModel.set(this.model.getClonedAttributes())}),this.listenTo(this.model,"sync",()=>{this.controlRecordButtonsVisibility(),this.trigger("model-sync")}),this.createRecordView(()=>{this.reRender().then(()=>{this.model.fetch()})}),this.controlNavigationButtons(),this.trigger("switch-model",this.model,t)}}actionPrevious(){var e;this.model.collection&&0<this.indexOfRecord&&(e=this.indexOfRecord-1,this.switchToModelByIndex(e))}actionNext(){if(this.model.collection&&!(!(this.indexOfRecord<this.model.collection.total-1)&&0<=this.model.collection.total||-2===this.model.collection.total&&this.indexOfRecord>=this.model.collection.length-1)){let e=this.model.collection,t=this.indexOfRecord+1;t<=e.length-1?this.switchToModelByIndex(t):e.fetch({more:!0,remove:!1}).then(()=>{this.switchToModelByIndex(t)})}}actionEdit(){if(this.options.quickEditDisabled){let e={id:this.id,model:this.model,returnUrl:this.getRouter().getCurrentUrl()};return this.options.rootUrl&&(e.rootUrl=this.options.rootUrl),this.getRouter().navigate("#"+this.scope+"/edit/"+this.id,{trigger:!1}),this.getRouter().dispatch(this.scope,"edit",e),Promise.reject()}let e=this.getMetadata().get(["clientDefs",this.scope,"modalViews","edit"])||"views/modals/edit";return Espo.Ui.notify(" ... "),new Promise(t=>{this.createView("quickEdit",e,{scope:this.scope,entityType:this.model.entityType,id:this.id,fullFormDisabled:this.fullFormDisabled},e=>{this.listenToOnce(e,"remove",()=>{this.dialog.show()}),this.listenToOnce(e,"leave",()=>{this.remove()}),this.listenTo(e,"after:save",(e,t)=>{this.model.set(e.getClonedAttributes()),this.trigger("after:save",e,t),this.controlRecordButtonsVisibility(),this.trigger("model-sync")}),e.render().then(()=>{Espo.Ui.notify(!1),this.dialog.hide(),t(e)})})})}actionRemove(){let t=this.getRecordView().model;this.confirm(this.translate("removeRecordConfirmation","messages"),()=>{let e=this.dialog.$el.find(".modal-footer button");e.addClass("disabled").attr("disabled","disabled"),t.destroy().then(()=>{this.trigger("after:destroy",t),this.dialog.close()}).catch(()=>{e.removeClass("disabled").removeAttr("disabled")})})}actionFullForm(){let e,t=this.getRouter(),i=this.getScope();e="#"+i+"/view/"+this.id;var s=this.getRecordView().fetch();let a=this.getRecordView().model,l={attributes:_.extend(s,a.getClonedAttributes()),returnUrl:r.default.history.fragment,model:this.sourceModel||this.model,id:this.id};this.options.rootUrl&&(l.rootUrl=this.options.rootUrl),setTimeout(()=>{t.dispatch(i,"view",l),t.navigate(e,{trigger:!1})},10),this.trigger("leave"),this.dialog.close()}actionDuplicate(){Espo.Ui.notify(" ... "),Espo.Ajax.postRequest(this.scope+"/action/getDuplicateAttributes",{id:this.model.id}).then(e=>{Espo.Ui.notify(!1);var t="#"+this.scope+"/create";this.getRouter().dispatch(this.scope,"create",{attributes:e,returnUrl:this.getRouter().getCurrentUrl(),options:{duplicateSourceId:this.model.id,returnAfterCreate:!0}}),this.getRouter().navigate(t,{trigger:!1})})}handleShortcutKeyControlArrowLeft(e){this.model.collection&&-1!==this.buttonList.findIndex(e=>"previous"===e.name&&!e.disabled)&&"TEXTAREA"!==e.target.tagName&&"INPUT"!==e.target.tagName&&(e.preventDefault(),e.stopPropagation(),this.actionPrevious())}handleShortcutKeyControlArrowRight(e){this.model.collection&&-1!==this.buttonList.findIndex(e=>"next"===e.name&&!e.disabled)&&"TEXTAREA"!==e.target.tagName&&"INPUT"!==e.target.tagName&&(e.preventDefault(),e.stopPropagation(),this.actionNext())}}e.default=a}),define("views/modals/convert-currency",["exports","views/modals/mass-convert-currency"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setup(){super.setup(),this.headerText=this.translate("convertCurrency","massActions")}actionConvert(){this.disableButton("convert"),this.getFieldView("currency").fetchToModel(),this.getFieldView("currencyRates").fetchToModel();var e=this.model.get("currency"),t=this.model.get("currencyRates");Espo.Ajax.postRequest("Action",{entityType:this.options.entityType,action:"convertCurrency",id:this.options.model.id,data:{targetCurrency:e,rates:t,fieldList:this.options.fieldList||null}}).then(e=>{this.trigger("after:update",e),this.close()}).catch(()=>{this.enableButton("convert")})}}e.default=s}),define("views/modals/compose-email",["exports","views/modals/edit"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{scope="Email";layoutName="composeSmall";saveDisabled=!0;fullFormDisabled=!0;isCollapsable=!0;wasModified=!1;shortcutKeys={"Control+Enter":function(e){-1!==this.buttonList.findIndex(e=>"send"===e.name&&!e.hidden)&&(e.stopPropagation(),e.preventDefault(),this.actionSend())},"Control+KeyS":function(e){-1!==this.buttonList.findIndex(e=>"saveDraft"===e.name&&!e.hidden)&&(e.preventDefault(),e.stopPropagation(),this.actionSaveDraft())},Escape:function(e){e.stopPropagation(),e.preventDefault();let t=this.getRecordView().getFocusedFieldView();t&&this.model.set(t.fetch()),this.getRecordView().isChanged?this.confirm(this.translate("confirmLeaveOutMessage","messages")).then(()=>this.actionClose()):this.actionClose()}};setup(){var i;if(super.setup(),this.buttonList.unshift({name:"saveDraft",text:this.translate("Save Draft","labels","Email"),title:"Ctrl+S"}),this.buttonList.unshift({name:"send",text:this.translate("Send","labels","Email"),style:"primary",title:"Ctrl+Enter"}),this.$header=$("<a>").attr("role","button").attr("tabindex","0").attr("data-action","fullFormDraft").text(this.getLanguage().translate("Compose Email")),this.events['click a[data-action="fullFormDraft"]']=()=>this.actionFullFormDraft(),this.getConfig().get("emailForceUseExternalClient")||this.getPreferences().get("emailUseExternalClient")||!this.getAcl().checkScope("Email","create"))return i=this.options.attributes||{},Espo.loader.require("email-helper",e=>{this.getRouter().confirmLeaveOut=!1;let t=new e;document.location.href=t.composeMailToLink(i,this.getConfig().get("outboundEmailBccAddress"))}),void this.once("after:render",()=>{this.actionClose()});this.once("remove",()=>{this.dialogIsHidden=!1}),this.listenTo(this.model,"change",(e,t)=>{t.ui&&(this.wasModified=!0)})}createRecordView(e,t){var i=this.getMetadata().get("clientDefs."+e.entityType+".recordViews.compose")||"views/email/record/compose",e={model:e,fullSelector:this.containerSelector+" .edit-container",type:"editSmall",layoutName:this.layoutName||"detailSmall",buttonsDisabled:!0,selectTemplateDisabled:this.options.selectTemplateDisabled,removeAttachmentsOnSelectTemplate:this.options.removeAttachmentsOnSelectTemplate,signatureDisabled:this.options.signatureDisabled,appendSignature:this.options.appendSignature,focusForCreate:this.options.focusForCreate,exit:()=>{}};this.createView("edit",i,e,t)}actionSend(){let e=this.dialog,t=this.getRecordView(),i=t.model,s=()=>{this.dialogIsHidden=!1,this.trigger("after:save",i),this.trigger("after:send",i),e.close(),this.stopListening(t,"before:save",a),this.stopListening(t,"error:save",l),this.remove()},a=()=>{this.dialogIsHidden=!0,e.hideWithBackdrop(),t.setConfirmLeaveOut(!1),this.forceRemoveIsInitiated||this.initiateForceRemove()},l=()=>{this.dialogIsHidden=!1,this.isRendered()&&e.show()};this.listenToOnce(t,"after:send",s),this.disableButton("send"),this.disableButton("saveDraft"),this.listenToOnce(t,"cancel:save",()=>{this.enableButton("send"),this.enableButton("saveDraft"),this.stopListening(t,"after:send",s),this.stopListening(t,"before:save",a),this.stopListening(t,"error:save",l)}),this.listenToOnce(t,"before:save",a),this.listenToOnce(t,"error:save",l),t.send()}actionSaveDraft(e){let t=this.getRecordView(),i=t.model,s=(this.disableButton("send"),this.disableButton("saveDraft"),()=>{this.enableButton("send"),this.enableButton("saveDraft"),Espo.Ui.success(this.translate("savedAsDraft","messages","Email")),this.trigger("after:save",i),this.$el.find('button[data-name="cancel"]').html(this.translate("Close"))});return t.once("after:save",()=>s()),t.once("cancel:save",()=>{this.enableButton("send"),this.enableButton("saveDraft"),t.off("after:save",s)}),t.saveDraft(e)}initiateForceRemove(){this.forceRemoveIsInitiated=!0;let e=this.getParentView();if(!e)return!0;e.once("remove",()=>{this.dialogIsHidden&&this.remove()})}actionFullFormDraft(){this.actionSaveDraft().then(()=>{this.getRouter().navigate("#Email/edit/"+this.model.id,{trigger:!0}),this.close()}).catch(e=>{"notModified"===e&&(Espo.Ui.notify(!1),this.getRouter().navigate("#Email/edit/"+this.model.id,{trigger:!0}))})}beforeCollapse(){return this.wasModified&&this.actionSaveDraft({skipNotModifiedWarning:!0}),this.getRecordView().setConfirmLeaveOut(!1),super.beforeCollapse()}}e.default=s}),define("views/modals/change-password",["exports","views/modal"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="modals/change-password";cssName="change-password";className="dialog dialog-record";setup(){this.buttonList=[{name:"change",label:"Change",style:"danger"},{name:"cancel",label:"Cancel"}],this.headerText=this.translate("Change Password","labels","User");var e=this.getModelFactory().create("User",e=>{this.model=e,this.createView("currentPassword","views/fields/password",{model:e,mode:"edit",selector:'.field[data-name="currentPassword"]',defs:{name:"currentPassword",params:{required:!0}}}),this.createView("password","views/user/fields/password",{model:e,mode:"edit",selector:'.field[data-name="password"]',defs:{name:"password",params:{required:!0}}}),this.createView("passwordConfirm","views/fields/password",{model:e,mode:"edit",selector:'.field[data-name="passwordConfirm"]',defs:{name:"passwordConfirm",params:{required:!0}}})});this.wait(e)}getFieldView(e){return this.getView(e)}actionChange(){this.getFieldView("currentPassword").fetchToModel(),this.getFieldView("password").fetchToModel(),this.getFieldView("passwordConfirm").fetchToModel(),this.getFieldView("currentPassword").validate()||this.getFieldView("password").validate()||this.getFieldView("passwordConfirm").validate()||(this.$el.find('button[data-name="change"]').addClass("disabled"),Espo.Ajax.putRequest("UserSecurity/password",{currentPassword:this.model.get("currentPassword"),password:this.model.get("password")}).then(()=>{Espo.Ui.success(this.translate("passwordChanged","messages","User")),this.trigger("changed"),this.close()}).catch(()=>{this.$el.find('button[data-name="change"]').removeClass("disabled")}))}}e.default=s}),define("views/modals/auth2fa-required",["exports","views/modal"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{noCloseButton=!0;escapeDisabled=!0;events={'click [data-action="proceed"]':"actionProceed",'click [data-action="logout"]':"actionLogout"};templateContent=`
        <div class="complex-text">{{complexText viewObject.messageText}}</div>
        <div class="button-container btn-group" style="margin-top: 30px">
        <button class="btn btn-primary" data-action="proceed">{{translate 'Proceed'}}</button>
        <button class="btn btn-default" data-action="logout">{{translate 'Log Out'}}</button></div>
    `;setup(){this.buttonList=[],this.headerText=this.translate("auth2FARequiredHeader","messages","User"),this.messageText=this.translate("auth2FARequired","messages","User")}actionProceed(){this.createView("dialog","views/user/modals/security",{userModel:this.getUser()},e=>{e.render(),this.listenToOnce(e,"done",()=>{this.clearView("dialog"),this.close()})})}actionLogout(){this.getRouter().logout()}}e.default=s}),define("views/modals/array-field-add",["exports","views/modal"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="modals/array-field-add";cssName="add-modal";backdrop=!0;data(){return{optionList:this.optionList,translatedOptions:this.translations}}events={"click .add":function(e){e=$(e.currentTarget).attr("data-value");this.trigger("add",e)},'click input[type="checkbox"]':function(e){var t=$(e.currentTarget).attr("data-value");e.target.checked?this.checkedList.push(t):-1!==(e=this.checkedList.indexOf(t))&&this.checkedList.splice(e,1),this.checkedList.length?this.enableButton("select"):this.disableButton("select")},'keyup input[data-name="quick-search"]':function(e){this.processQuickSearch(e.currentTarget.value)}};setup(){this.headerText=this.translate("Add Item"),this.checkedList=[],this.translations=Espo.Utils.clone(this.options.translatedOptions||{}),this.optionList=this.options.options||[],this.optionList.forEach(e=>{e in this.translations||(this.translations[e]=e)}),this.buttonList=[{name:"select",style:"danger",label:"Select",disabled:!0,onClick:()=>{this.trigger("add-mass",this.checkedList)}},{name:"cancel",label:"Cancel"}]}afterRender(){this.$noData=this.$el.find(".no-data"),setTimeout(()=>{this.$el.find('input[data-name="quick-search"]').focus()},100)}processQuickSearch(e){e=e.trim();let t=this.$noData;if(t.addClass("hidden"),e){let s=[],a=e.toLowerCase();if(this.optionList.forEach(e=>{let t=this.translations[e].toLowerCase();for(var i of t.split(" "))if(0===i.indexOf(a))return void s.push(e)}),0===s.length)return this.$el.find("ul .list-group-item").addClass("hidden"),void t.removeClass("hidden");this.optionList.forEach(e=>{let t=this.$el.find(`ul .list-group-item[data-name="${e}"]`);~s.indexOf(e)?t.removeClass("hidden"):t.addClass("hidden")})}else this.$el.find("ul .list-group-item").removeClass("hidden")}}e.default=s}),define("views/modals/add-dashlet",["exports","views/modal"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="modals/add-dashlet";cssName="add-dashlet";backdrop=!0;events={"click .add":function(e){e=$(e.currentTarget).data("name");this.trigger("add",e),this.close()},'keyup input[data-name="quick-search"]':function(e){this.processQuickSearch(e.currentTarget.value)}};data(){return{dashletList:this.dashletList}}setup(){this.headerText=this.translate("Add Dashlet");let e=Object.keys(this.getMetadata().get("dashlets")||{}).sort((e,t)=>this.translate(e,"dashlets").localeCompare(this.translate(t,"dashlets")));this.translations={},this.dashletList=e.filter(e=>{var t=this.getMetadata().get(["dashlets",e,"aclScope"])||null;let i=this.getMetadata().get(["dashlets",e,"accessDataList"])||null;return"Settings"===this.options.parentType||("Portal"===this.options.parentType?!i||!i.find(e=>e.inPortalDisabled):!(t&&!this.getAcl().check(t))&&(!(i&&!Espo.Utils.checkAccessDataList(i,this.getAcl(),this.getUser()))&&(this.translations[e]=this.translate(e,"dashlets"),!0)))})}afterRender(){this.$noData=this.$el.find(".no-data"),setTimeout(()=>{this.$el.find('input[data-name="quick-search"]').focus()},100)}processQuickSearch(e){e=e.trim();let t=this.$noData;if(t.addClass("hidden"),e){let s=[],a=e.toLowerCase();if(this.dashletList.forEach(e=>{let t=this.translations[e].toLowerCase();for(var i of t.split(" "))if(0===i.indexOf(a))return void s.push(e)}),0===s.length)return this.$el.find("ul .list-group-item").addClass("hidden"),void t.removeClass("hidden");this.dashletList.forEach(e=>{let t=this.$el.find(`ul .list-group-item[data-name="${e}"]`);~s.indexOf(e)?t.removeClass("hidden"):t.addClass("hidden")})}else this.$el.find("ul .list-group-item").removeClass("hidden")}}e.default=s}),define("views/modals/action-history",["exports","views/modal","search-manager"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{template="modals/action-history";scope="ActionHistoryRecord";className="dialog dialog-record";backdrop=!0;setup(){super.setup(),this.buttonList=[{name:"cancel",label:"Close"}],this.scope=this.entityType=this.options.scope||this.scope,this.$header=$("<a>").attr("href","#ActionHistoryRecord").addClass("action").attr("data-action","listView").text(this.getLanguage().translate(this.scope,"scopeNamesPlural")),this.waitForView("list"),this.getCollectionFactory().create(this.scope,e=>{e.maxSize=this.getConfig().get("recordsPerPage")||20,this.collection=e,this.setupSearch(),this.setupList(),e.fetch()})}actionListView(){this.getRouter().navigate("#ActionHistoryRecord",{trigger:!0}),this.close()}setupSearch(){let e=this.searchManager=new i.default(this.collection,"listSelect",null,this.getDateTime());this.collection.data.boolFilterList=["onlyMy"],this.collection.where=e.getWhere(),this.createView("search","views/record/search",{collection:this.collection,fullSelector:this.containerSelector+" .search-container",searchManager:e,disableSavePreset:!0,textFilterDisabled:!0})}setupList(){let e=this.getMetadata().get(`clientDefs.${this.scope}.recordViews.list`)||"views/record/list";this.listenToOnce(this.collection,"sync",()=>{this.createView("list",e,{collection:this.collection,fullSelector:this.containerSelector+" .list-container",selectable:!1,checkboxes:!1,massActionsDisabled:!0,rowActionsView:"views/record/row-actions/view-only",type:"listSmall",searchManager:this.searchManager,checkAllResultDisabled:!0,buttonsDisabled:!0})})}}e.default=a}),define("views/global-search/scope-badge",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="global-search/scope-badge";data(){return{label:this.translate(this.model.get("_scope"),"scopeNames")}}}e.default=s}),define("views/global-search/panel",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="global-search/panel";setup(){this.addHandler("click",'[data-action="closePanel"]',()=>this.close()),this.maxSize=this.getConfig().get("globalSearchMaxSize")||10,this.navbarPanelHeightSpace=this.getThemeManager().getParam("navbarPanelHeightSpace")||100,this.navbarPanelBodyMaxHeight=this.getThemeManager().getParam("navbarPanelBodyMaxHeight")||600}onRemove(){$(window).off("resize.global-search-height"),this.overflowWasHidden&&($("body").css("overflow","unset"),this.overflowWasHidden=!1)}afterRender(){this.collection.reset(),this.collection.maxSize=this.maxSize,this.collection.fetch().then(()=>this.createRecordView()).then(e=>e.render());const e=$(window);e.off("resize.global-search-height"),e.on("resize.global-search-height",this.processSizing.bind(this)),this.processSizing()}createRecordView(){return this.createView("list","views/record/list-expanded",{selector:".list-container",collection:this.collection,listLayout:{rows:[[{name:"name",view:"views/global-search/name-field"}]],right:{name:"read",view:"views/global-search/scope-badge",width:"80px"}}})}processSizing(){const e=$(window);var t=e.height(),i=e.width(),s=this.$el.find(".panel-heading").outerHeight();let a={};i<=this.getThemeManager().getParam("screenWidthXs")?(a.height=t-s+"px",a.overflow="auto",$("body").css("overflow","hidden"),this.overflowWasHidden=!0):(a.height="unset",a.overflow="none",this.overflowWasHidden&&($("body").css("overflow","unset"),this.overflowWasHidden=!1),t-this.navbarPanelBodyMaxHeight<this.navbarPanelHeightSpace&&(i=t-this.navbarPanelHeightSpace,a.maxHeight=i+"px")),this.$el.find(".panel-body").css(a)}close(){this.trigger("close")}}e.default=s}),define("views/global-search/name-field",["exports","views/fields/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{listTemplate="global-search/name-field";data(){return{scope:this.model.get("_scope"),name:this.model.get("name")||this.translate("None"),id:this.model.id,iconHtml:this.getHelper().getScopeColorIconHtml(this.model.get("_scope"))}}}e.default=s}),define("views/global-search/global-search",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="global-search/global-search";setup(){this.addHandler("keydown","input.global-search-input","onKeydown"),this.addHandler("focus","input.global-search-input","onFocus"),this.addHandler("click",'[data-action="search"]',()=>this.runSearch());var e=this.getCollectionFactory().create("GlobalSearch",e=>{this.collection=e,this.collection.url="GlobalSearch"});this.wait(e),this.closeNavbarOnShow=/iPad|iPhone|iPod/.test(navigator.userAgent)}onFocus(e){let t=e.target;t.select()}onKeydown(e){var t=Espo.Utils.getKeyFromKeyEvent(e);"Enter"!==e.code&&"Enter"!==t&&"Control+Enter"!==t?"Escape"===t&&this.closePanel():this.runSearch()}afterRender(){this.$input=this.$el.find("input.global-search-input")}runSearch(){var e=this.$input.val().trim();""!==e&&2<=e.length&&this.search(e)}search(e){this.collection.url=this.collection.urlRoot="GlobalSearch?q="+encodeURIComponent(e),this.showPanel()}showPanel(){this.closePanel(),this.closeNavbarOnShow&&this.$el.closest(".navbar-body").removeClass("in");let t=$("<div>").attr("id","global-search-panel"),e=(t.appendTo(this.$el.find(".global-search-panel-container")),this.createView("panel","views/global-search/panel",{fullSelector:"#global-search-panel",collection:this.collection},e=>{e.render(),this.listenToOnce(e,"close",this.closePanel)}),$(document));e.on("mouseup.global-search",e=>{1===e.which&&(t.is(e.target)||0!==t.has(e.target).length||this.closePanel())}),e.on("click.global-search",e=>{"A"!==e.target.tagName||"showMore"===$(e.target).data("action")||$(e.target).hasClass("global-search-button")||setTimeout(()=>this.closePanel(),100)})}closePanel(){let e=$("#global-search-panel"),t=(e.remove(),$(document));this.hasView("panel")&&this.getView("panel").remove(),t.off("mouseup.global-search"),t.off("click.global-search")}}e.default=s}),define("views/fields/wysiwyg",["exports","views/fields/text"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="wysiwyg";listTemplate="fields/wysiwyg/detail";detailTemplate="fields/wysiwyg/detail";editTemplate="fields/wysiwyg/edit";height=250;rowsDefault=1e4;fallbackBodySideMargin=5;fallbackBodyTopMargin=4;seeMoreDisabled=!0;fetchEmptyValueAsNull=!1;validationElementSelector=".note-editor";htmlPurificationDisabled=!1;events={"click .note-editable":function(){this.fixPopovers()},"focus .note-editable":function(){this.$noteEditor.addClass("in-focus")},"blur .note-editable":function(){this.$noteEditor.removeClass("in-focus")}};setup(){super.setup(),this.wait(Espo.loader.requirePromise("lib!summernote").then(()=>{!$.summernote.options||"espoImage"in $.summernote.options||this.initEspoPlugin()})),this.hasBodyPlainField=!!~this.getFieldManager().getEntityTypeFieldList(this.model.entityType).indexOf(this.name+"Plain"),"height"in this.params&&(this.height=this.params.height),"minHeight"in this.params&&(this.minHeight=this.params.minHeight),this.useIframe=this.params.useIframe||this.useIframe,this.setupToolbar(),this.listenTo(this.model,"change:isHtml",(e,t,i)=>{if(i.ui&&this.isEditMode()){if(!this.isRendered())return;if(!e.has("isHtml")||e.get("isHtml")){let e=this.plainToHtml(this.model.get(this.name));return this.lastHtmlValue&&this.model.get(this.name)===this.htmlToPlain(this.lastHtmlValue)&&(e=this.lastHtmlValue),this.model.set(this.name,e,{skipReRender:!0}),void this.enableWysiwygMode()}this.lastHtmlValue=this.model.get(this.name);i=this.htmlToPlain(this.model.get(this.name));return this.disableWysiwygMode(),void this.model.set(this.name,i)}this.isDetailMode()&&this.isRendered()&&this.reRender()}),this.once("remove",()=>{this.destroySummernote()}),this.on("inline-edit-off",()=>{this.destroySummernote()}),this.on("render",()=>{this.destroySummernote()}),this.once("remove",()=>{$(window).off("resize."+this.cid),this.$scrollable&&this.$scrollable.off("scroll."+this.cid+"-edit")})}data(){let e=super.data();return e.useIframe=this.useIframe,e.isPlain=this.isPlain(),e}setupToolbar(){this.buttons={},this.toolbar=this.params.toolbar||this.toolbar||[["style",["style"]],["style",["bold","italic","underline","clear"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]],["table",["table","espoLink","espoImage","hr"]],["misc",["codeview","fullscreen"]]],this.params.toolbar||this.params.attachmentField&&(this.toolbar.push(["attachment",["attachment"]]),this.buttons.attachment=()=>{let e=$.summernote.ui,t=e.button({contents:'<i class="fas fa-paperclip"></i>',tooltip:this.translate("Attach File"),click:()=>{this.attachFile(),this.listenToOnce(this.model,"attachment-uploaded:attachments",()=>{this.isEditMode()&&Espo.Ui.success(this.translate("Attached"))})}});return t.render()})}isPlain(){return this.model.has("isHtml")&&!this.model.get("isHtml")}fixPopovers(){$("body > .note-popover").removeClass("hidden")}getValueForDisplay(){var e=super.getValueForDisplay();return this.isPlain()?e:this.sanitizeHtml(e)}sanitizeHtml(e){return(e=e&&(this.htmlPurificationDisabled?this.sanitizeHtmlLight(e):this.getHelper().sanitizeHtml(e)))||""}sanitizeHtmlLight(e){return this.getHelper().moderateSanitizeHtml(e)}getValueForEdit(){var e=this.model.get(this.name)||"";return this.htmlPurificationForEditDisabled?this.sanitizeHtmlLight(e):this.sanitizeHtml(e)}afterRender(){super.afterRender(),this.isEditMode()&&(this.$summernote=this.$el.find(".summernote"));var e=this.getConfig().get("language");e in $.summernote.lang||($.summernote.lang[e]=this.getLanguage().translate("summernote","sets")),this.isEditMode()&&(!this.model.has("isHtml")||this.model.get("isHtml")?this.enableWysiwygMode():this.$element.removeClass("hidden")),this.isReadMode()&&this.renderDetail()}renderDetail(){if(!this.model.has("isHtml")||this.model.get("isHtml"))if(this.useIframe){this.$el.find("iframe").removeClass("hidden");let u=this.$el.find("iframe"),m=this.iframe=u.get(0);if(m){u.on("load",()=>{u.contents().find("a").attr("target","_blank")});let e=m.contentWindow.document,t=this.sanitizeHtml(this.model.get(this.name)||""),i=this.getThemeManager().getParam("isDark")&&this.htmlHasColors(t),s=u.parent(),a=(i?s.addClass("fallback"):s.removeClass("fallback"),m.contentWindow.document.createElement("link")),l=(a.type="text/css",a.rel="stylesheet",a.href=this.getBasePath()+(i?this.getThemeManager().getIframeFallbackStylesheet():this.getThemeManager().getIframeStylesheet()),t=a.outerHTML+t,e.write(t),e.close(),u.contents().find("html body")),r=(l.find("img").each((e,t)=>{let i=$(t);"none"===i.css("max-width")&&i.css("max-width","100%")}),$(e)),o=(r.on("click",()=>{var e=new MouseEvent("click",{bubbles:!0});u[0].dispatchEvent(e)}),r.on("mouseup",()=>{var e=new MouseEvent("mouseup",{bubbles:!0});u[0].dispatchEvent(e)}),r.on("keydown",e=>{e=e.originalEvent,e=new KeyboardEvent("keydown",{bubbles:!0,code:e.code,ctrlKey:e.ctrlKey,metaKey:e.metaKey,altKey:e.altKey});u[0].dispatchEvent(e)}),function(){var e=l.get(0);e&&e.clientWidth!==m.scrollWidth&&(m.style.height=m.scrollHeight+20+"px")}),n=(i&&s.css({paddingLeft:this.fallbackBodySideMargin+"px",paddingRight:this.fallbackBodySideMargin+"px",paddingTop:this.fallbackBodyTopMargin+"px"}),10),h=function(e,t){if(l.css("height",""),!(200<(e=e||0))){e++;var i=r.height()-m.scrollHeight;if(void 0!==t&&i===t)return l.css("height",m.clientHeight-n+"px"),void o();i?(t=m.scrollHeight+n,m.style.height=t+"px",h(e,i)):o()}},d=function(e){if(e){if(m.scrollHeight>=r.height())return}else u.css({overflowY:"hidden",overflowX:"hidden"}),m.style.height="0px";let t=u.contents().find("html body"),i=t.height();0===i&&(i=t.children(0).height()+100),m.style.height=i+"px",h(),e||u.css({overflowY:"hidden",overflowX:"scroll"})},c=(u.css({visibility:"hidden"}),setTimeout(()=>{d(),u.css({visibility:"visible"}),u.on("load",()=>{var e;d(!0),i&&(e=m.contentWindow.getComputedStyle(l.get(0)).backgroundColor,s.css({backgroundColor:e}))})},40),this.model.get(this.name)||u.addClass("hidden"),$(window).width());$(window).off("resize."+this.cid),$(window).on("resize."+this.cid,()=>{$(window).width()!==c&&(d(),c=$(window).width())})}}else this.$element=this.$el.find(".html-container");else this.$el.find(".plain").removeClass("hidden")}enableWysiwygMode(){if(this.$element){this.$element.addClass("hidden"),this.$summernote.removeClass("hidden");var s=this.getValueForEdit();this.$summernote.html(s),this.$summernote.find("style").remove(),this.$summernote.find('link[ref="stylesheet"]').remove();let e=Espo.Utils.cloneDeep($.summernote.options.keyMap);e.pc["CTRL+K"]="espoLink.show",e.mac["CMD+K"]="espoLink.show",e.pc["CTRL+DELETE"]="removeFormat",e.mac["CMD+DELETE"]="removeFormat",delete e.pc["CTRL+ENTER"],delete e.mac["CMD+ENTER"],delete e.pc["CTRL+BACKSLASH"],delete e.mac["CMD+BACKSLASH"];s=this.toolbar;let t=new Date;const a=1e3*this.changeInterval;let i={espoView:this,lang:this.getConfig().get("language"),keyMap:e,callbacks:{onImageUpload:e=>{e=e[0];Espo.Ui.notify(this.translate("Uploading...")),this.uploadInlineAttachment(e).then(e=>{e="?entryPoint=attachment&id="+e.id;this.$summernote.summernote("insertImage",e),Espo.Ui.notify(!1)})},onBlur:()=>{this.trigger("change")},onKeydown:()=>{Date.now()-t>a&&(this.trigger("change"),t=Date.now())}},onCreateLink(e){return e},toolbar:s,buttons:this.buttons,dialogsInBody:this.$el,codeviewFilter:!0};if(this.height)i.height=this.height;else{let e=this.$el.closest(".modal-body");e.length||(e=$(window)),(this.$scrollable=e).off("scroll."+this.cid+"-edit"),e.on("scroll."+this.cid+"-edit",e=>{this.onScrollEdit(e)})}this.minHeight&&(i.minHeight=this.minHeight),this.destroySummernote(),this.$summernote.summernote(i),this.summernoteIsInitialized=!0,this.$toolbar=this.$el.find(".note-toolbar"),this.$area=this.$el.find(".note-editing-area"),this.$noteEditor=this.$el.find("> .note-editor")}}focusOnInlineEdit(){this.$noteEditor?this.$summernote.summernote("focus"):super.focusOnInlineEdit()}uploadInlineAttachment(a){return new Promise((i,s)=>{this.getModelFactory().create("Attachment",t=>{let e=new FileReader;e.onload=e=>{t.set("name",a.name),t.set("type",a.type),t.set("role","Inline Attachment"),t.set("global",!0),t.set("size",a.size),this.model.id&&t.set("relatedId",this.model.id),t.set("relatedType",this.model.entityType),t.set("file",e.target.result),t.set("field",this.name),t.save().then(()=>i(t)).catch(()=>s())},e.readAsDataURL(a)})})}destroySummernote(){this.summernoteIsInitialized&&this.$summernote&&(this.$summernote.summernote("destroy"),this.summernoteIsInitialized=!1)}plainToHtml(e){return(e=e||"").replace(/\n/g,"<br>")}htmlToPlain(e){e=(e=e||"").replace(/<br\s*\/?>/gm,"\n").replace(/<\/p\s*\/?>/gm,"\n\n");let t=$("<div>").html(e);return t.find("style").remove(),t.find('link[ref="stylesheet"]').remove(),t.text()}disableWysiwygMode(){this.destroySummernote(),this.$noteEditor=null,this.$summernote&&this.$summernote.addClass("hidden"),this.$element.removeClass("hidden"),this.$scrollable&&this.$scrollable.off("scroll."+this.cid+"-edit")}fetch(){let i={};if(!this.model.has("isHtml")||this.model.get("isHtml")){let e=this.$summernote.summernote("code"),t=("<p><br></p>"===e&&(e=""),'<img src="'+window.location.origin+window.location.pathname+"?entryPoint=attachment");e=e.replace(new RegExp(t.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),'<img src="?entryPoint=attachment'),i[this.name]=e}else i[this.name]=this.$element.val(),this.fetchEmptyValueAsNull&&(i[this.name]||(i[this.name]=null));return this.model.has("isHtml")&&this.hasBodyPlainField&&(this.model.get("isHtml")?i[this.name+"Plain"]=this.htmlToPlain(i[this.name]):i[this.name+"Plain"]=i[this.name]),i}onScrollEdit(e){let t=$(e.target);var e=this.$toolbar.height(),i=this.$toolbar.parent().width();let s,a;if(t.get(0)===window.document){let e=t.find(".detail-button-container:not(.hidden)");var l=e.offset();l&&(s=l.top+e.height(),a=s-$(window).scrollTop())}else{l=t.offset();l&&(s=l.top,a=s-$(window).scrollTop())}var l=this.$el.offset().top,r=l+this.$el.height()-e;let o=!1;if(o=s>l&&r>s?!0:o)return this.$toolbar.css({top:a+"px",width:i+"px"}),this.$toolbar.addClass("sticked"),void this.$area.css({marginTop:e+"px",backgroundColor:""});this.$toolbar.css({top:"",width:""}),this.$toolbar.removeClass("sticked"),this.$area.css({marginTop:""})}attachFile(){let e=this.$el.closest(".record");e.find('.field[data-name="'+this.params.attachmentField+'"] input.file').click()}initEspoPlugin(){var e=this.getLanguage().get("Global","sets","summernote")||{image:{},link:{},video:{}};$.extend($.summernote.options,{espoImage:{icon:'<i class="note-icon-picture"/>',tooltip:e.image.image},espoLink:{icon:'<i class="note-icon-link"/>',tooltip:e.link.link}}),$.extend($.summernote.plugins,{espoImage:function(t){let i=$.summernote.ui,s=t.options,a=s.espoView,e=s.langInfo;a&&(t.memo("button.espoImage",()=>{let e=i.button({contents:s.espoImage.icon,tooltip:s.espoImage.tooltip,click(){t.invoke("espoImage.show")}});return e.render()}),this.initialize=function(){},this.destroy=function(){a&&a.clearView("insertImageDialog")},this.show=function(){a.createView("insertImageDialog","views/wysiwyg/modals/insert-image",{labels:{insert:e.image.insert,url:e.image.url,selectFromFiles:e.image.selectFromFiles}},e=>{e.render(),a.listenToOnce(e,"upload",e=>{a.$summernote.summernote("insertImagesOrCallback",e)}),a.listenToOnce(e,"insert",e=>{a.$summernote.summernote("insertImage",e)}),a.listenToOnce(e,"close",()=>{a.clearView("insertImageDialog"),a.fixPopovers()})})})},linkDialog:function(t){var e=t.options;let i=e.espoView,s=e.langInfo;i&&(this.show=function(){var e=t.invoke("editor.getLinkInfo");i.createView("dialogInsertLink","views/wysiwyg/modals/insert-link",{labels:{insert:s.link.insert,openInNewWindow:s.link.openInNewWindow,url:s.link.url,textToDisplay:s.link.textToDisplay},linkInfo:e},e=>{e.render(),i.listenToOnce(e,"insert",e=>{i.$summernote.summernote("createLink",e)}),i.listenToOnce(e,"close",()=>{i.clearView("dialogInsertLink"),i.fixPopovers()})})})},espoLink:function(s){let i=$.summernote.ui,a=s.options,l=a.espoView,r=a.langInfo;if(l){let t=/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform);s.memo("button.espoLink",function(){let e=i.button({contents:a.espoLink.icon,tooltip:a.espoLink.tooltip+" ("+(t?"CMD+K":"CTRL+K")+")",click(){s.invoke("espoLink.show")}});return e.render()}),this.initialize=function(){this.$modalBody=l.$el.closest(".modal-body"),this.isInModal=0<this.$modalBody.length},this.destroy=function(){l&&l.clearView("dialogInsertLink")},this.show=function(){var e=s.invoke("editor.getLinkInfo");let i=this.isInModal?this.$modalBody.get(0):window;l.createView("dialogInsertLink","views/wysiwyg/modals/insert-link",{labels:{insert:r.link.insert,openInNewWindow:r.link.openInNewWindow,url:r.link.url,textToDisplay:r.link.textToDisplay},linkInfo:e},e=>{e.render(),l.listenToOnce(e,"insert",e=>{let t="scrollY"in i?i.scrollY:i.scrollTop;l.$summernote.summernote("createLink",e),setTimeout(()=>i.scroll(0,t),20)}),l.listenToOnce(e,"close",()=>{l.clearView("dialogInsertLink"),l.fixPopovers()})})}}},fullscreen:function(e){let t=e.options.espoView;t&&(this.$window=$(window),this.$scrollbar=$("html, body"),this.initialize=function(){this.$editor=e.layoutInfo.editor,this.$toolbar=e.layoutInfo.toolbar,this.$editable=e.layoutInfo.editable,this.$codable=e.layoutInfo.codable,this.$modal=t.$el.closest(".modal"),this.isInModal=0<this.$modal.length},this.resizeTo=function(e){this.$editable.css("height",e.h),this.$codable.css("height",e.h),this.$codable.data("cmeditor")&&this.$codable.data("cmeditor").setsize(null,e.h)},this.onResize=function(){this.resizeTo({h:this.$window.height()-this.$toolbar.outerHeight()})},this.isFullscreen=function(){return this.$editor.hasClass("fullscreen")},this.destroy=function(){this.$window.off("resize.summernote"+t.cid),this.isInModal?this.$modal.css("overflow-y",""):this.$scrollbar.css("overflow","")},this.toggle=function(){this.$editor.toggleClass("fullscreen"),this.isFullscreen()?(this.$editable.data("orgHeight",this.$editable.css("height")),this.$editable.data("orgMaxHeight",this.$editable.css("maxHeight")),this.$editable.css("maxHeight",""),this.$window.on("resize.summernote"+t.cid,this.onResize.bind(this)).trigger("resize"),this.isInModal?this.$modal.css("overflow-y","hidden"):this.$scrollbar.css("overflow","hidden"),this._isFullscreen=!0):(this.$window.off("resize.summernote"+t.cid),this.resizeTo({h:this.$editable.data("orgHeight")}),this.$editable.css("maxHeight",this.$editable.css("orgMaxHeight")),this.isInModal?this.$modal.css("overflow-y",""):this.$scrollbar.css("overflow",""),this._isFullscreen=!1),e.invoke("toolbar.updateFullscreen",this.isFullscreen())})}})}htmlHasColors(e){return!!~e.indexOf("background-color:")||(!!~e.indexOf("color:")||!!~e.indexOf('<font color="'))}}e.default=s}),define("views/fields/varchar-column",["exports","views/fields/varchar"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{searchTypeList=["startsWith","contains","equals","endsWith","like","isEmpty","isNotEmpty"];fetchSearch(){var e=this.fetchSearchType()||"startsWith";if(~["isEmpty","isNotEmpty"].indexOf(e))return"isEmpty"===e?{typeFront:e,where:{type:"or",value:[{type:"columnIsNull",field:this.name},{type:"columnEquals",field:this.name,value:""}]}}:{typeFront:e,where:{type:"and",value:[{type:"columnNotEquals",field:this.name,value:""},{type:"columnIsNotNull",field:this.name,value:null}]}};let t=this.$element.val().toString().trim();return(t=t.trim())?{value:t,type:"column".Espo.Utils.upperCaseFirst(e),data:{type:e,value:t}}:null}}e.default=s}),define("views/fields/users",["exports","views/fields/link-multiple"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{init(){this.assignmentPermission=this.getAcl().getPermissionLevel("assignmentPermission"),"no"===this.assignmentPermission&&(this.readOnly=!0),super.init()}getSelectBoolFilterList(){if("team"===this.assignmentPermission||"no"===this.assignmentPermission)return["onlyMyTeam"]}getSelectPrimaryFilterName(){return"active"}}e.default=s}),define("views/fields/teams",["exports","views/fields/link-multiple"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{init(){this.assignmentPermission=this.getAcl().getPermissionLevel("assignmentPermission"),super.init()}getSelectBoolFilterList(){if("team"===this.assignmentPermission||"no"===this.assignmentPermission)return["onlyMy"]}}e.default=s}),define("views/fields/range-currency",["exports","views/fields/range-float","views/fields/currency","ui/select"],function(e,t,i,s){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),i=a(i),s=a(s);class l extends t.default{type="rangeCurrency";editTemplate="fields/range-currency/edit";data(){return{currencyField:this.currencyField,currencyValue:this.model.get(this.fromCurrencyField)||this.getPreferences().get("defaultCurrency")||this.getConfig().get("defaultCurrency"),currencyList:this.currencyList,...super.data()}}setup(){super.setup();var e=Espo.Utils.upperCaseFirst(this.name);this.fromCurrencyField="from"+e+"Currency",this.toCurrencyField="to"+e+"Currency",this.currencyField=this.name+"Currency",this.currencyList=this.getConfig().get("currencyList")||["USD"],this.decimalPlaces=this.getConfig().get("currencyDecimalPlaces")}setupAutoNumericOptions(){this.autoNumericOptions={digitGroupSeparator:this.thousandSeparator||"",decimalCharacter:this.decimalMark,modifyValueOnWheel:!1,selectOnFocus:!1,decimalPlaces:this.decimalPlaces,allowDecimalPadding:!0,showWarnings:!1,formulaMode:!0},null===this.decimalPlaces&&(this.autoNumericOptions.decimalPlaces=this.decimalPlacesRawValue,this.autoNumericOptions.decimalPlacesRawValue=this.decimalPlacesRawValue,this.autoNumericOptions.allowDecimalPadding=!1)}afterRender(){super.afterRender(),this.mode===this.MODE_EDIT&&(this.$currency=this.$el.find('[data-name="'+this.currencyField+'"]'),s.default.init(this.$currency))}formatNumber(e){return i.default.prototype.formatNumberDetail.call(this,e)}getValueForDisplay(){let e=this.model.get(this.fromField),t=this.model.get(this.toField);e=isNaN(e)?null:e,t=isNaN(t)?null:t;var i=this.model.get(this.fromCurrencyField)||this.model.get(this.toCurrencyField),i=this.getMetadata().get(["app","currency","symbolMap",i])||i;return null!==e&&null!==t?this.formatNumber(e)+" &#8211 "+this.formatNumber(t)+" "+i:e?"&#62;&#61; "+this.formatNumber(e)+" "+i:t?"&#60;&#61; "+this.formatNumber(t)+" "+i:this.translate("None")}fetch(){const e=super.fetch();var t=this.$currency.val();return null!==e[this.fromField]?e[this.fromCurrencyField]=t:e[this.fromCurrencyField]=null,null!==e[this.toField]?e[this.toCurrencyField]=t:e[this.toCurrencyField]=null,e}}e.default=l}),define("views/fields/person-name",["exports","views/fields/varchar","ui/select"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{type="personName";detailTemplate="fields/person-name/detail";editTemplate="fields/person-name/edit";editTemplateLastFirst="fields/person-name/edit-last-first";editTemplateLastFirstMiddle="fields/person-name/edit-last-first-middle";editTemplateFirstMiddleLast="fields/person-name/edit-first-middle-last";validations=["required","pattern"];data(){let e=super.data();return e.ucName=Espo.Utils.upperCaseFirst(this.name),e.salutationValue=this.model.get(this.salutationField),e.firstValue=this.model.get(this.firstField),e.lastValue=this.model.get(this.lastField),e.middleValue=this.model.get(this.middleField),e.salutationOptions=this.model.getFieldParam(this.salutationField,"options"),this.isEditMode()&&(e.firstMaxLength=this.model.getFieldParam(this.firstField,"maxLength"),e.lastMaxLength=this.model.getFieldParam(this.lastField,"maxLength"),e.middleMaxLength=this.model.getFieldParam(this.middleField,"maxLength")),e.valueIsSet=this.model.has(this.firstField)||this.model.has(this.lastField),this.isDetailMode()?e.isNotEmpty=!!(e.firstValue||e.lastValue||e.salutationValue||e.middleValue):this.isListMode()&&(e.isNotEmpty=!!e.firstValue||!!e.lastValue||!!e.middleValue),(e.isNotEmpty&&this.isDetailMode()||this.isListMode())&&(e.formattedValue=this.getFormattedValue()),e}setup(){super.setup();var e=Espo.Utils.upperCaseFirst(this.name);this.salutationField="salutation"+e,this.firstField="first"+e,this.lastField="last"+e,this.middleField="middle"+e}afterRender(){super.afterRender(),this.isEditMode()&&(this.$salutation=this.$el.find('[data-name="'+this.salutationField+'"]'),this.$first=this.$el.find('[data-name="'+this.firstField+'"]'),this.$last=this.$el.find('[data-name="'+this.lastField+'"]'),this.formatHasMiddle()&&(this.$middle=this.$el.find('[data-name="'+this.middleField+'"]')),this.$salutation.on("change",()=>{this.trigger("change")}),this.$first.on("change",()=>{this.trigger("change")}),this.$last.on("change",()=>{this.trigger("change")}),i.default.init(this.$salutation))}getFormattedValue(){let e=this.model.get(this.salutationField);var t=this.model.get(this.firstField),i=this.model.get(this.lastField),s=this.model.get(this.middleField);return e=e&&this.getLanguage().translateOption(e,"salutationName",this.model.entityType),this.formatName({salutation:e,first:t,middle:s,last:i})}_getTemplateName(){if(this.isEditMode()){var e="editTemplate"+Espo.Utils.upperCaseFirst(this.getFormat().toString());if(e in this)return this[e]}return super._getTemplateName()}getFormat(){return this.format=this.format||this.getConfig().get("personNameFormat")||"firstLast",this.format}formatHasMiddle(){var e=this.getFormat();return"firstMiddleLast"===e||"lastFirstMiddle"===e}validateRequired(){var e=this.isRequired(),t=e=>{var t;if(this.model.isRequired(e)&&!this.model.get(e))return t=this.translate("fieldIsRequired","messages").replace("{field}",this.translate(e,"fields",this.model.entityType)),this.showValidationMessage(t,'[data-name="'+e+'"]'),!0};if(e&&(!this.model.get(this.firstField)&&!this.model.get(this.lastField)))return e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e,'[data-name="'+this.lastField+'"]'),!0;let i=!1;return i=t(this.salutationField)||i,i=t(this.firstField)||i,i=t(this.lastField)||i,i=t(this.middleField)||i}validatePattern(){let e=!1;return e=this.fieldValidatePattern(this.firstField)||e,e=this.fieldValidatePattern(this.lastField)||e,e=this.fieldValidatePattern(this.middleField)||e}hasRequiredMarker(){return!!this.isRequired()||(this.model.getFieldParam(this.salutationField,"required")||this.model.getFieldParam(this.firstField,"required")||this.model.getFieldParam(this.middleField,"required")||this.model.getFieldParam(this.lastField,"required"))}fetch(){let e={};return e[this.salutationField]=this.$salutation.val()||null,e[this.firstField]=this.$first.val().trim()||null,e[this.lastField]=this.$last.val().trim()||null,this.formatHasMiddle()&&(e[this.middleField]=this.$middle.val().trim()||null),e[this.name]=this.formatName({first:e[this.firstField],last:e[this.lastField],middle:e[this.middleField]}),e}formatName(e){let t;var i=this.getFormat();let s=[];return s.push(e.salutation),"firstLast"===i?(s.push(e.first),s.push(e.last)):"lastFirst"===i?(s.push(e.last),s.push(e.first)):"firstMiddleLast"===i?(s.push(e.first),s.push(e.middle),s.push(e.last)):"lastFirstMiddle"===i?(s.push(e.last),s.push(e.first),s.push(e.middle)):(s.push(e.first),s.push(e.last)),t=""===(t=s.filter(e=>!!e).join(" ").trim())?null:t}}e.default=a}),define("views/fields/password",["exports","views/fields/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="password";detailTemplate="fields/password/detail";editTemplate="fields/password/edit";validations=["required","confirm"];events={'click [data-action="change"]':function(){this.changePassword()}};changePassword(){this.$el.find('[data-action="change"]').addClass("hidden"),this.$element.removeClass("hidden"),this.changing=!0}data(){return{isNew:this.model.isNew(),...super.data()}}validateConfirm(){var e;if(this.model.has(this.name+"Confirm"))return this.model.get(this.name)!==this.model.get(this.name+"Confirm")?(e=this.translate("fieldBadPasswordConfirm","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0):void 0}afterRender(){super.afterRender(),this.changing=!1,this.params.readyToChange&&this.changePassword()}fetch(){return this.model.isNew()||this.changing?super.fetch():{}}}e.default=s}),define("views/fields/number",["exports","views/fields/varchar"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="number";validations=[];inlineEditDisabled=!0;readOnly=!0;fetch(){return{}}}e.default=s}),define("views/fields/map",["exports","views/fields/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="map";detailTemplate="fields/map/detail";listTemplate="fields/map/detail";addressField=null;provider=null;height=300;data(){const e=super.data();return e.hasAddress=this.hasAddress(),e}setup(){this.addressField=this.name.slice(0,this.name.length-3),this.provider=this.options.provider||this.params.provider,this.height=this.options.height||this.params.height||this.height;const e=Object.keys(this.getMetadata().get("fields.address.fields")||{}).map(e=>this.addressField+Espo.Utils.upperCaseFirst(e));this.listenTo(this.model,"sync",t=>{let i=!1;e.forEach(e=>{t.hasChanged(e)&&(i=!0)}),i&&this.isRendered()&&this.reRender()}),this.listenTo(this.model,"after:save",()=>{this.isRendered()&&this.reRender()})}hasAddress(){return!!this.model.get(this.addressField+"City")||!!this.model.get(this.addressField+"PostalCode")}onRemove(){$(window).off("resize."+this.cid)}afterRender(){var e;this.addressData={city:this.model.get(this.addressField+"City"),street:this.model.get(this.addressField+"Street"),postalCode:this.model.get(this.addressField+"PostalCode"),country:this.model.get(this.addressField+"Country"),state:this.model.get(this.addressField+"State")},this.$map=this.$el.find(".map"),this.hasAddress()&&(this.processSetHeight(!0),"auto"===this.height&&($(window).off("resize."+this.cid),$(window).on("resize."+this.cid,this.processSetHeight.bind(this))),e="afterRender"+this.provider.replace(/\s+/g,""),"function"==typeof this[e]?this[e]():(e=this.getMetadata().get(["clientDefs","AddressMap","implementations",this.provider]))&&Espo.loader.require(e,e=>{e.render(this)}))}afterRenderGoogle(){if(window.google&&window.google.maps)this.initMapGoogle();else if("function"!=typeof window.mapapiloaded){window.mapapiloaded=()=>{this.initMapGoogle()};let e="https://maps.googleapis.com/maps/api/js?callback=mapapiloaded";var i=this.getConfig().get("googleMapsApiKey");i&&(e+="&key="+i);let t=document.createElement("script");t.setAttribute("async","async"),t.src=e,document.head.appendChild(t)}else{let e=window.mapapiloaded;void(window.mapapiloaded=()=>{this.initMapGoogle(),e()})}}processSetHeight(e){let t=this.height;"auto"===this.height&&(t=this.$el.parent().height(),e&&t<=0)?setTimeout(()=>{this.processSetHeight(!0)},50):this.$map.css("height",t+"px")}initMapGoogle(){const e=new google.maps.Geocoder;let i;try{i=new google.maps.Map(this.$el.find(".map").get(0),{zoom:15,center:{lat:0,lng:0},scrollwheel:!1})}catch(e){return void console.error(e.message)}let t="";this.addressData.street&&(t+=this.addressData.street),this.addressData.city&&(""!==t&&(t+=", "),t+=this.addressData.city),this.addressData.state&&(""!==t&&(t+=", "),t+=this.addressData.state),this.addressData.postalCode&&(this.addressData.state||this.addressData.city?t+=" ":t&&(t+=", "),t+=this.addressData.postalCode),this.addressData.country&&(""!==t&&(t+=", "),t+=this.addressData.country),e.geocode({address:t},(e,t)=>{t===google.maps.GeocoderStatus.OK&&(i.setCenter(e[0].geometry.location),new google.maps.Marker({map:i,position:e[0].geometry.location}))})}}e.default=s}),define("views/fields/link-parent",["exports","views/fields/base","helpers/record-modal","ui/select"],function(e,t,s,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),s=a(s),i=a(i);class l extends t.default{type="linkParent";listTemplate="fields/link-parent/list";detailTemplate="fields/link-parent/detail";editTemplate="fields/link-parent/edit";searchTemplate="fields/link-parent/search";listLinkTemplate="fields/link-parent/list-link";nameName=null;idName=null;typeName=null;foreignScope=null;foreignScopeList=null;autocompleteDisabled=!1;selectRecordsView="views/modals/select-records";createDisabled=!1;searchTypeList=["is","isEmpty","isNotEmpty"];selectPrimaryFilterName=null;selectBoolFilterList=null;autocompleteMaxCount=null;forceSelectAllAttributes=!1;mandatorySelectAttributeList=null;initialSearchIsNotIdle=!0;events={'auxclick a[href]:not([role="button"])':function(e){this.isReadMode()&&1===e.button&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),e.stopPropagation(),this.quickView())}};data(){let e=this.model.get(this.nameName),t=(!e&&this.model.get(this.idName)&&this.model.get(this.typeName)&&(e=this.translate(this.model.get(this.typeName),"scopeNames")),null);return(this.mode===this.MODE_DETAIL||this.mode===this.MODE_LIST&&this.displayScopeColorInListMode)&&this.foreignScope&&(t=this.getHelper().getScopeColorIconHtml(this.foreignScope)),{...super.data(),idName:this.idName,nameName:this.nameName,typeName:this.typeName,idValue:this.model.get(this.idName),nameValue:e,typeValue:this.model.get(this.typeName),foreignScope:this.foreignScope,foreignScopeList:this.foreignScopeList,valueIsSet:this.model.has(this.idName)||this.model.has(this.typeName),iconHtml:t,displayEntityType:this.displayEntityType&&this.model.get(this.typeName)}}getSelectFilters(){return null}getSelectBoolFilterList(){return this.selectBoolFilterList}getSelectPrimaryFilterName(){return this.selectPrimaryFilterName}getCreateAttributes(){return null}setup(){this.nameName=this.name+"Name",this.typeName=this.name+"Type",this.idName=this.name+"Id",this.foreignScopeList=this.options.foreignScopeList||this.foreignScopeList,this.foreignScopeList=this.foreignScopeList||this.params.entityList||this.model.getLinkParam(this.name,"entityList")||[],this.foreignScopeList=Espo.Utils.clone(this.foreignScopeList).filter(e=>{if(!this.getMetadata().get(["scopes",e,"disabled"]))return!0}),this.foreignScope=this.model.get(this.typeName)||this.foreignScopeList[0],this.foreignScope&&!~this.foreignScopeList.indexOf(this.foreignScope)&&this.foreignScopeList.unshift(this.foreignScope),this.listenTo(this.model,"change:"+this.typeName,()=>{this.foreignScope=this.model.get(this.typeName)||this.foreignScopeList[0]}),"createDisabled"in this.options&&(this.createDisabled=this.options.createDisabled),this.isListMode()||(this.addActionHandler("selectLink",()=>{Espo.Ui.notify(" ... ");var e=this.getMetadata().get("clientDefs."+this.foreignScope+".modalViews.select")||this.selectRecordsView,t=!this.createDisabled&&this.isEditMode();this.createView("dialog",e,{scope:this.foreignScope,createButton:t,filters:this.getSelectFilters(),boolFilterList:this.getSelectBoolFilterList(),primaryFilterName:this.getSelectPrimaryFilterName(),createAttributes:t?this.getCreateAttributes():null,mandatorySelectAttributeList:this.getMandatorySelectAttributeList(),forceSelectAllAttributes:this.isForceSelectAllAttributes()},e=>{e.render(),Espo.Ui.notify(!1),this.listenToOnce(e,"select",e=>{this.clearView("dialog"),this.select(e)})})}),this.addActionHandler("clearLink",()=>{this.foreignScopeList.length&&(this.foreignScope=this.foreignScopeList[0],i.default.setValue(this.$elementType,this.foreignScope)),this.$elementName.val(""),this.$elementId.val(""),this.trigger("change")}),this.events['change select[data-name="'+this.typeName+'"]']=e=>{this.foreignScope=e.currentTarget.value,this.$elementName.val(""),this.$elementId.val("")})}setupSearch(){var e=this.getSearchParamsData().type;"is"!==e&&e||(this.searchData.idValue=this.getSearchParamsData().idValue||this.searchParams.valueId,this.searchData.nameValue=this.getSearchParamsData().nameValue||this.searchParams.valueName,this.searchData.typeValue=this.getSearchParamsData().typeValue||this.searchParams.valueType),this.events["change select.search-type"]=e=>{e=$(e.currentTarget).val();this.handleSearchType(e)}}handleSearchType(e){~["is"].indexOf(e)?this.$el.find("div.primary").removeClass("hidden"):this.$el.find("div.primary").addClass("hidden")}select(e){this.$elementName.val(e.get("name")||e.id),this.$elementId.val(e.get("id")),this.trigger("change")}getMandatorySelectAttributeList(){return this.mandatorySelectAttributeList}isForceSelectAllAttributes(){return this.forceSelectAllAttributes}getAutocompleteMaxCount(){return this.autocompleteMaxCount||this.getConfig().get("recordsPerPage")}getAutocompleteUrl(){let t=this.foreignScope+"?maxSize="+this.getAutocompleteMaxCount();if(!this.isForceSelectAllAttributes()){let e=["id","name"];this.getMandatorySelectAttributeList()&&(e=e.concat(this.getMandatorySelectAttributeList())),t+="&select="+e.join(",")}var e=this.getSelectBoolFilterList(),e=(e&&(t+="&"+$.param({boolFilterList:e})),this.getSelectPrimaryFilterName());return e&&(t+="&"+$.param({primaryFilter:e})),t}afterRender(){if(this.isEditMode()||this.isSearchMode()){this.$elementId=this.$el.find('input[data-name="'+this.idName+'"]'),this.$elementName=this.$el.find('input[data-name="'+this.nameName+'"]'),this.$elementType=this.$el.find('select[data-name="'+this.typeName+'"]'),this.$elementName.on("change",()=>{""===this.$elementName.val()&&(this.$elementName.val(""),this.$elementId.val(""),this.trigger("change"))}),this.$elementType.on("change",()=>{this.$elementName.val(""),this.$elementId.val(""),this.trigger("change")}),this.$elementName.on("blur",e=>{setTimeout(()=>{this.mode===this.MODE_EDIT&&(e.currentTarget.value=this.model.get(this.nameName)||"")},100),this.autocompleteDisabled||setTimeout(()=>this.$elementName.autocomplete("clear"),300)}),this.autocompleteDisabled||(this.$elementName.autocomplete({serviceUrl:e=>this.getAutocompleteUrl(e),minChars:1,paramName:"q",noCache:!0,triggerSelectOnValidInput:!1,autoSelectFirst:!0,beforeRender:e=>{this.$elementName.hasClass("input-sm")&&e.addClass("small")},formatResult:e=>this.getHelper().escapeString(e.name),transformResult:e=>{e=JSON.parse(e);let t=[];return e.list.forEach(e=>{t.push({id:e.id,name:e.name||e.id,data:e.id,value:e.name||e.id,attributes:e})}),{suggestions:t}},onSelect:t=>{this.getModelFactory().create(this.foreignScope,e=>{e.set(t.attributes),this.select(e),this.$elementName.focus()})}}),this.$elementName.off("focus.autocomplete"),this.$elementName.on("focus",()=>this.$elementName.get(0).select()),this.$elementName.attr("autocomplete","espo-"+this.name),i.default.init(this.$elementType,{}));let e=this.$elementName;this.once("render",()=>{e.autocomplete("dispose")}),this.once("remove",()=>{e.autocomplete("dispose")})}var e;"search"===this.mode&&(e=this.$el.find("select.search-type").val(),this.handleSearchType(e),this.$el.find("select.search-type").on("change",()=>{this.trigger("change")}))}getValueForDisplay(){return this.model.get(this.nameName)}validateRequired(){var e;if(this.isRequired()&&(null===this.model.get(this.idName)||!this.model.get(this.typeName)))return e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0}fetch(){let e={};return e[this.typeName]=this.$elementType.val()||null,e[this.nameName]=this.$elementName.val()||null,e[this.idName]=this.$elementId.val()||null,null===e[this.idName]&&(e[this.typeName]=null),e}fetchSearch(){var e=this.$el.find("select.search-type").val();if("isEmpty"===e)return{type:"isNull",field:this.idName,data:{type:e}};if("isNotEmpty"===e)return{type:"isNotNull",field:this.idName,data:{type:e}};var e=this.$elementType.val(),t=this.$elementName.val(),i=this.$elementId.val();return e?i?{type:"and",attribute:this.idName,value:[{type:"equals",field:this.idName,value:i},{type:"equals",field:this.typeName,value:e}],data:{type:"is",idValue:i,nameValue:t,typeValue:e}}:{type:"and",attribute:this.idName,value:[{type:"isNotNull",field:this.idName},{type:"equals",field:this.typeName,value:e}],data:{type:"is",typeValue:e}}:null}getSearchType(){return this.getSearchParamsData().type||this.searchParams.typeFront}quickView(){var t=this.model.get(this.idName),i=this.model.get(this.typeName);if(t&&i){let e=new s.default(this.getMetadata(),this.getAcl());e.showDetail(this,{id:t,scope:i})}}}e.default=l}),define("views/fields/link-one",["exports","views/fields/link"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{searchTypeList=["is","isEmpty","isNotEmpty","isOneOf"];fetchSearch(){var e=this.$el.find("select.search-type").val(),t=this.$el.find('[data-name="'+this.idName+'"]').val();return"isOneOf"===e?{type:"linkedWith",field:this.name,value:this.searchData.oneOfIdList,data:{type:e,oneOfIdList:this.searchData.oneOfIdList,oneOfNameHash:this.searchData.oneOfNameHash}}:"is"!==e&&e?"isEmpty"===e?{type:"isNotLinked",data:{type:e}}:"isNotEmpty"===e?{type:"isLinked",data:{type:e}}:void 0:!!t&&{type:"linkedWith",field:this.name,value:t,data:{type:e,nameValue:this.$el.find('[data-name="'+this.nameName+'"]').val()}}}}e.default=s}),define("views/fields/link-multiple-with-status",["exports","views/fields/link-multiple"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setup(){super.setup(),this.columnsName=this.name+"Columns",this.columns=Espo.Utils.cloneDeep(this.model.get(this.columnsName)||{}),this.listenTo(this.model,"change:"+this.columnsName,()=>{this.columns=Espo.Utils.cloneDeep(this.model.get(this.columnsName)||{})}),this.statusField=this.getMetadata().get(["entityDefs",this.model.entityType,"fields",this.name,"columns","status"]),this.styleMap=this.getMetadata().get(["entityDefs",this.foreignScope,"fields",this.statusField,"style"])||{}}getAttributeList(){const e=super.getAttributeList();return e.push(this.name+"Columns"),e}getDetailLinkHtml(e,t){var i=(this.columns[e]||{}).status;if(!i)return super.getDetailLinkHtml(e,t);i=this.styleMap[i];if(!i||!~["success","danger"].indexOf(i))return super.getDetailLinkHtml(e,t);let s="";return"success"===i?s="fas fa-check text-success small":"danger"===i&&(s="fas fa-times text-danger small"),'<span class="'+s+'"></span> '+super.getDetailLinkHtml(e,t)}}e.default=s}),define("views/fields/link-multiple-with-role",["exports","views/fields/link-multiple","ui/select"],function(e,t,d){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),d=i(d);class s extends t.default{roleType="enum";columnName="role";roleFieldIsForeign=!0;emptyRoleValue=null;rolePlaceholderText=null;roleMaxLength=50;ROLE_TYPE_ENUM="enum";ROLE_TYPE_VARCHAR="varchar";setup(){super.setup(),this.columnsName=this.name+"Columns",this.columns=Espo.Utils.cloneDeep(this.model.get(this.columnsName)||{}),this.listenTo(this.model,"change:"+this.columnsName,()=>{this.columns=Espo.Utils.cloneDeep(this.model.get(this.columnsName)||{})}),this.roleField=this.getMetadata().get(["entityDefs",this.model.entityType,"fields",this.name,"columns",this.columnName]),this.displayRoleAsLabel=this.getMetadata().get(["entityDefs",this.model.entityType,"fields",this.roleField,"displayAsLabel"]),this.roleFieldScope=this.roleFieldIsForeign?this.foreignScope:this.model.entityType,this.roleType!==this.ROLE_TYPE_ENUM||this.forceRoles||(this.roleList=this.getMetadata().get(["entityDefs",this.roleFieldScope,"fields",this.roleField,"options"]),this.roleList||(this.roleList=[],this.skipRoles=!0))}getAttributeList(){const e=super.getAttributeList();return e.push(this.name+"Columns"),e}getDetailLinkHtml(i,e){!(e=e||this.nameHash[i]||i)&&i&&(e=this.translate(this.foreignScope,"scopeNames"));let s=(this.columns[i]||{})[this.columnName]||"",a=(this.emptyRoleValue&&s===this.emptyRoleValue&&(s=""),$("<div>").append($("<a>").attr("href","#"+this.foreignScope+"/view/"+i).attr("data-id",i).text(e)));if(!this.isDetailMode()||(e=this.getIconHtml(i))&&a.prepend(e),s){let e=this.getMetadata().get(["entityDefs",this.model.entityType,"fields",this.roleField,"style",s]),t="text";this.displayRoleAsLabel&&e&&"default"!==e?(t="label label-sm label","muted"===e&&(e="default")):e=e||"muted",t=t+"-"+e;i=this.roleType===this.ROLE_TYPE_ENUM?this.getLanguage().translateOption(s,this.roleField,this.roleFieldScope):s;a.append($("<span>").text(" "),$("<span>").addClass("text-muted chevron-right"),$("<span>").text(" "),$("<span>").text(i).addClass("small").addClass(t))}return a.get(0).outerHTML}getValueForDisplay(){if(this.isDetailMode()||this.isListMode()){let t=[];return this.ids.forEach(e=>{t.push(this.getDetailLinkHtml(e))}),t.join("")}}deleteLink(e){this.trigger("delete-link",e),this.trigger("delete-link:"+e),this.deleteLinkHtml(e);var t=this.ids.indexOf(e);-1<t&&this.ids.splice(t,1),delete this.nameHash[e],delete this.columns[e],this.afterDeleteLink(e),this.trigger("change")}addLink(e,t){~this.ids.indexOf(e)||(this.ids.push(e),this.nameHash[e]=t,this.columns[e]={},this.columns[e][this.columnName]=null,this.addLinkHtml(e,t),this.trigger("add-link",e),this.trigger("add-link:"+e)),this.trigger("change")}getJQSelect(e,s){let a=$("<select>").addClass("role form-control input-sm").attr("data-id",e);return this.roleList.forEach(e=>{var t=this.getLanguage().translateOption(e,this.roleField,this.roleFieldScope);let i=$("<option>").val(e).text(t);e===(s||"")&&i.attr("selected","selected"),a.append(i)}),a}addLinkHtml(e,t){if(t=t||e,this.isSearchMode()||this.skipRoles)return super.addLinkHtml(e,t);var i=(this.columns[e]||{})[this.columnName];let s=this.$el.find(".link-container"),a=$("<div>").addClass("form-inline clearfix").addClass("list-group-item link-with-role link-group-item-with-columns").addClass("link-"+e);var l=$("<a>").attr("role","button").attr("tabindex","0").attr("data-id",e).attr("data-action","clearLink").addClass("pull-right").append($("<span>").addClass("fas fa-times"));let r=$("<div>").addClass("pull-left");var o,l=$("<div>").append(l),t=$("<div>").addClass("link-item-name").text(t).append("&nbsp;");let n;if((n=this.roleType===this.ROLE_TYPE_ENUM?this.getJQSelect(e,i):(o=this.rolePlaceholderText||this.translate(this.roleField,"fields",this.roleFieldScope),$("<input>").addClass("role form-control input-sm").attr("maxlength",this.roleMaxLength).attr("placeholder",o).attr("data-id",e).attr("value",i||"")))&&r.append($("<span>").addClass("link-item-column").addClass("link-item-column-"+n.get(0).tagName.toLowerCase()).append(n)),r.append(t),a.append(r).append(l),s.append(a),n&&"SELECT"===n.get(0).tagName&&d.default.init(n),this.isEditMode()&&n){let t=t=>{if(t&&t.length&&null!==t.val()){let e=t.val().toString().trim();t=t.data("id");""===e&&(e=null),this.columns[t]=this.columns[t]||{},this.columns[t][this.columnName]=e}};n.on("change",e=>{t($(e.currentTarget)),this.trigger("change")}),t(n)}return a}fetch(){let e=super.fetch();return this.skipRoles||(e[this.columnsName]=Espo.Utils.cloneDeep(this.columns)),e}}e.default=s}),define("views/fields/link-multiple-with-columns-with-primary",["exports","views/fields/link-multiple-with-columns","views/fields/link-multiple-with-primary"],function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),a=i(a);class s extends t.default{primaryLink;getAttributeList(){let e=super.getAttributeList();return e.push(this.primaryIdAttribute),e.push(this.primaryNameAttribute),e}setup(){this.primaryLink=this.primaryLink||this.model.getFieldParam(this.name,"primaryLink"),this.primaryIdAttribute=this.primaryLink+"Id",this.primaryNameAttribute=this.primaryLink+"Name",super.setup(),this.events['click [data-action="switchPrimary"]']=e=>{let t=$(e.currentTarget);e=t.data("id");a.default.prototype.switchPrimary.call(this,e)},this.primaryId=this.model.get(this.primaryIdAttribute),this.primaryName=this.model.get(this.primaryNameAttribute),this.listenTo(this.model,"change:"+this.primaryIdAttribute,()=>{this.primaryId=this.model.get(this.primaryIdAttribute),this.primaryName=this.model.get(this.primaryNameAttribute)})}setPrimaryId(e){this.primaryId=e,this.primaryName=e?this.nameHash[e]:null,this.trigger("change")}renderLinks(){this.primaryId&&this.addLinkHtml(this.primaryId,this.primaryName),this.ids.forEach(e=>{e!==this.primaryId&&this.addLinkHtml(e,this.nameHash[e])})}getValueForDisplay(){if(this.isDetailMode()||this.isListMode()){let t=[];if(this.primaryId&&t.push(this.getDetailLinkHtml(this.primaryId,this.primaryName)),this.ids.length)return this.ids.forEach(e=>{e!==this.primaryId&&t.push(this.getDetailLinkHtml(e))}),t.map(e=>$("<div>").append(e).get(0).outerHTML).join("")}}deleteLink(e){e===this.primaryId&&this.setPrimaryId(null),super.deleteLink(e)}deleteLinkHtml(e){super.deleteLinkHtml(e),this.managePrimaryButton()}addLinkHtml(e,t){if(t=t||e,this.isSearchMode())return super.addLinkHtml(e,t);if(this.skipRoles)return a.default.prototype.addLinkHtml.call(this,e,t);let i=super.addLinkHtml(e,t);t=e===this.primaryId,t=$("<span>").addClass("fas fa-star fa-sm").addClass(t?"":"text-muted");let s=$("<button>").attr("type","button").addClass("btn btn-link btn-sm pull-right hidden").attr("title",this.translate("Primary")).attr("data-action","switchPrimary").attr("data-id",e).append(t);return s.insertAfter(i.children().first().children().first()),this.managePrimaryButton(),i}managePrimaryButton(){let t=this.$el.find('button[data-action="switchPrimary"]');if(1<t.length?t.removeClass("hidden"):t.addClass("hidden"),0===t.filter(".active").length){let e=t.first();e.length&&(e.addClass("active").children().removeClass("text-muted"),this.setPrimaryId(e.data("id")))}}fetch(){const e=super.fetch();return e[this.primaryIdAttribute]=this.primaryId,e[this.primaryNameAttribute]=this.primaryName,e}}e.default=s}),define("views/fields/link-multiple-category-tree",["exports","views/fields/link-multiple"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{selectRecordsView="views/modals/select-category-tree-records";autocompleteDisabled=!1;getUrl(e){return"#"+this.entityType+"/list/categoryId="+e}fetchSearch(){const e=super.fetchSearch();return e&&(e.type="inCategory",e)}}e.default=s}),define("views/fields/link-category-tree",["exports","views/fields/link"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{selectRecordsView="views/modals/select-category-tree-records";autocompleteDisabled=!1;fetchSearch(){const e=super.fetchSearch();return e&&("is"===e.typeFront&&(e.field=this.name,e.type="inCategory"),e)}getUrl(){var e=this.model.get(this.idName);return e?"#"+this.entityType+"/list/categoryId="+e:null}}e.default=s}),define("views/fields/json-object",["exports","views/fields/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="jsonObject";listTemplate="fields/json-object/detail";detailTemplate="fields/json-object/detail";data(){const e=super.data();return e.valueIsSet=this.model.has(this.name),e.isNotEmpty=!!this.model.get(this.name),e}getValueForDisplay(){var e=this.model.get(this.name);return e?JSON.stringify(e,null,2).replace(/(\r\n|\n|\r)/gm,"<br>").replace(/\s/g,"&nbsp;"):null}}e.default=s}),define("views/fields/image",["exports","views/fields/file"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="image";showPreview=!0;accept=["image/*"];defaultType="image/jpeg";previewSize="small"}e.default=s}),define("views/fields/formula",["exports","views/fields/text"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=(i=t)&&i.__esModule?i:{default:i};let s;class a extends t.default{detailTemplate="fields/formula/detail";editTemplate="fields/formula/edit";height=300;maxLineDetailCount=80;maxLineEditCount=200;insertDisabled=!1;checkSyntaxDisabled=!1;events={'click [data-action="addAttribute"]':function(){this.addAttribute()},'click [data-action="addFunction"]':function(){this.addFunction()},'click [data-action="checkSyntax"]':function(){this.checkSyntax()}};setup(){super.setup(),this.height=this.options.height||this.params.height||this.height,this.maxLineDetailCount=this.options.maxLineDetailCount||this.params.maxLineDetailCount||this.maxLineDetailCount,this.maxLineEditCount=this.options.maxLineEditCount||this.params.maxLineEditCount||this.maxLineEditCount,this.targetEntityType=this.options.targetEntityType||this.params.targetEntityType||this.targetEntityType,this.insertDisabled=this.insertDisabled||this.options.insertDisabled,this.checkSyntaxDisabled=this.checkSyntaxDisabled||this.options.checkSyntaxDisabled,this.containerId="editor-"+Math.floor(1e4*Math.random()+1).toString(),this.mode!==this.MODE_EDIT&&this.mode!==this.MODE_DETAIL||this.wait(this.requireAce()),this.on("remove",()=>{this.editor&&this.editor.destroy()})}requireAce(){return Espo.loader.requirePromise("lib!ace").then(e=>{s=e;let t=[Espo.loader.requirePromise("lib!ace-mode-javascript"),Espo.loader.requirePromise("lib!ace-ext-language_tools")];return this.getThemeManager().getParam("isDark")&&t.push(Espo.loader.requirePromise("lib!ace-theme-tomorrow_night")),Promise.all(t)})}data(){let e=super.data();return e.containerId=this.containerId,e.targetEntityType=this.targetEntityType,e.hasSide=!this.insertDisabled||!this.checkSyntaxDisabled,e.hasInsert=!this.insertDisabled,e.hasCheckSyntax=!this.checkSyntaxDisabled,e}afterRender(){if(super.afterRender(),this.$editor=this.$el.find("#"+this.containerId),this.$editor.length&&(this.mode===this.MODE_EDIT||this.mode===this.MODE_DETAIL||this.mode===this.MODE_LIST)){this.$editor.css("fontSize","14px"),this.mode===this.MODE_EDIT&&this.$editor.css("minHeight",this.height+"px");let e=this.editor=s.edit(this.containerId),t=(e.setOptions({maxLines:this.mode===this.MODE_EDIT?this.maxLineEditCount:this.maxLineDetailCount}),this.getThemeManager().getParam("isDark")&&e.setOptions({theme:"ace/theme/tomorrow_night"}),this.isEditMode()&&(e.getSession().on("change",()=>{this.trigger("change",{ui:!0})}),e.getSession().setUseWrapMode(!0)),this.isReadMode()&&(e.setReadOnly(!0),e.renderer.$cursorLayer.element.style.display="none",e.renderer.setShowGutter(!1)),e.setShowPrintMargin(!1),e.getSession().setUseWorker(!1),e.commands.removeCommand("find"),e.setHighlightActiveLine(!1),s.require("ace/mode/javascript").Mode);e.session.setMode(new t),this.insertDisabled||this.isReadMode()||this.initAutocomplete()}}fetch(){let e={},t=this.editor.getValue();return""===t&&(t=null),e[this.name]=t,e}addAttribute(){this.createView("dialog","views/admin/formula/modals/add-attribute",{scope:this.targetEntityType},e=>{e.render(),this.listenToOnce(e,"add",e=>{this.editor.insert(e),this.clearView("dialog")})})}addFunction(){this.createView("dialog","views/admin/formula/modals/add-function",{scope:this.targetEntityType,functionDataList:this.getFunctionDataList()},e=>{e.render(),this.listenToOnce(e,"add",e=>{this.editor.insert(e),this.clearView("dialog")})})}getFunctionDataList(){let e=Espo.Utils.clone(this.getMetadata().get(["app","formula","functionList"])||[]),i=(this.options.additionalFunctionDataList&&(e=e.concat(this.options.additionalFunctionDataList)),this.options.allowedFunctionList);return i&&(e=e.filter(e=>{for(var t of i){if(t.endsWith("\\")&&e.name.startsWith(t))return!0;if(e.name===t)return!0}return!1})),e=this.targetEntityType?e:e.filter(e=>0!==e.name.indexOf("entity\\"))}initAutocomplete(){let d=this.getFunctionDataList().filter(e=>e.insertText),h=this.getFormulaAttributeList();s.require("ace/ext/language_tools"),this.editor.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0}),this.editor.completers=[{identifierRegexps:[/[\\a-zA-Z0-9{}\[\].$'"]/],getCompletions:function(e,t,i,s,a){let l=d.filter(e=>{let t=e.name;if(0===t.indexOf(s))return!0;let i=t.split("\\");return 0===i[i.length-1].indexOf(s)}),r=l.map(e=>({caption:e.name+"()",value:e.insertText,meta:e.returnType||null,completer:{insertMatch:(e,t)=>{e.completer.insertMatch({value:t.value});var i,s=t.value.indexOf("(");~s&&(~t.value.indexOf("()")||(i=e.selection.getCursor(),e.gotoLine(i.row+1,i.column-t.value.length+s+1)))}}})),o=h.filter(e=>0===e.indexOf(s));var n=o.map(e=>({name:e,value:e,meta:"attribute"}));a(null,r=r.concat(n))}}]}getFormulaAttributeList(){if(!this.targetEntityType)return[];let s=this.getFieldManager().getEntityTypeAttributeList(this.targetEntityType).concat(["id"]).sort(),a=this.getMetadata().get(["entityDefs",this.targetEntityType,"links"])||{},i=[];return Object.keys(a).forEach(e=>{var t=a[e].type;t&&~["belongsToParent","hasOne","belongsTo"].indexOf(t)&&i.push(e)}),i.sort(),i.forEach(t=>{var i=a[t].entity;if(i&&!a[t].disabled){let e=this.getFieldManager().getEntityTypeAttributeList(i).sort();e.forEach(e=>{s.push(t+"."+e)})}}),s}checkSyntax(){var e=this.editor.getValue();e?Espo.Ajax.postRequest("Formula/action/checkSyntax",{expression:e}).then(t=>{if(t.isSuccess)Espo.Ui.success(this.translate("checkSyntaxSuccess","messages","Formula"));else{let e=this.translate("checkSyntaxError","messages","Formula");t.message&&(e+=" "+t.message),Espo.Ui.error(e)}}):Espo.Ui.success(this.translate("checkSyntaxSuccess","messages","Formula"))}}e.default=a}),define("views/fields/foreign",["exports","views/fields/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="foreign"}e.default=s}),define("views/fields/foreign-varchar",["exports","views/fields/varchar","helpers/misc/foreign-field"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{type="foreign";setup(){super.setup();const e=new s.default(this);var t,i=e.getForeignParams();for(t in i)this.params[t]=i[t]}}e.default=a}),define("views/fields/foreign-url",["exports","views/fields/url","helpers/misc/foreign-field"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{type="foreign";readOnly=!0;setup(){super.setup();const e=new s.default(this);var t,i=e.getForeignParams();for(t in i)this.params[t]=i[t]}}e.default=a}),define("views/fields/foreign-url-multiple",["exports","views/fields/url-multiple","helpers/misc/foreign-field"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{type="foreign";readOnly=!0;setup(){super.setup();const e=new s.default(this);var t,i=e.getForeignParams();for(t in i)this.params[t]=i[t]}}e.default=a}),define("views/fields/foreign-text",["exports","views/fields/text","helpers/misc/foreign-field"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{type="foreign";setup(){super.setup();const e=new s.default(this);var t,i=e.getForeignParams();for(t in i)this.params[t]=i[t]}}e.default=a}),define("views/fields/foreign-phone",["exports","views/fields/phone"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="foreign";readOnly=!0}e.default=s}),define("views/fields/foreign-multi-enum",["exports","views/fields/multi-enum","views/fields/foreign-array"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{type="foreign";setupOptions(){i.default.prototype.setupOptions.call(this)}}e.default=a}),define("views/fields/foreign-int",["exports","views/fields/int","helpers/misc/foreign-field"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{type="foreign";setup(){super.setup();const e=new s.default(this);var t,i=e.getForeignParams();for(t in i)this.params[t]=i[t];this.disableFormatting=i.disableFormatting}}e.default=a}),define("views/fields/foreign-float",["exports","views/fields/float","helpers/misc/foreign-field"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{type="foreign";setup(){super.setup();const e=new s.default(this);var t,i=e.getForeignParams();for(t in i)this.params[t]=i[t]}}e.default=a}),define("views/fields/foreign-enum",["exports","views/fields/enum"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="foreign";setupOptions(){this.params.options=[];let o=this.params.field;var e=this.params.link;if(o&&e){let r=this.getMetadata().get(["entityDefs",this.model.entityType,"links",e,"entity"]);if(r){let{optionsPath:e,translation:t,options:i,isSorted:s,displayAsLabel:a,style:l}=this.getMetadata().get(["entityDefs",r,"fields",o]);i=e?this.getMetadata().get(e):i,this.params.options=Espo.Utils.clone(i)||[],this.params.translation=t,this.params.isSorted=s||!1,this.params.displayAsLabel=a||!1,this.styleMap=l||{},this.translatedOptions=Object.fromEntries(this.params.options.map(e=>[e,this.getLanguage().translateOption(e,o,r)]))}}}}e.default=s}),define("views/fields/foreign-email",["exports","views/fields/email"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="foreign";readOnly=!0}e.default=s}),define("views/fields/foreign-datetime",["exports","views/fields/datetime","helpers/misc/foreign-field"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{type="foreign";setup(){super.setup();const e=new s.default(this);var t,i=e.getForeignParams();for(t in i)this.params[t]=i[t]}}e.default=a}),define("views/fields/foreign-date",["exports","views/fields/date","helpers/misc/foreign-field"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{type="foreign";setup(){super.setup();const e=new s.default(this);var t,i=e.getForeignParams();for(t in i)this.params[t]=i[t]}}e.default=a}),define("views/fields/foreign-currency-converted",["exports","views/fields/currency-converted"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="foreign"}e.default=s}),define("views/fields/foreign-checklist",["exports","views/fields/checklist"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="foreign";setupOptions(){if(this.params.options=[],this.params.field&&this.params.link){const t=this.getMetadata().get(["entityDefs",this.model.entityType,"links",this.params.link,"entity"]);t&&(this.params.isSorted=this.getMetadata().get(["entityDefs",t,"fields",this.params.field,"isSorted"])||!1,this.params.options=this.getMetadata().get(["entityDefs",t,"fields",this.params.field,"options"])||[],this.translatedOptions={},this.params.options.forEach(e=>{this.translatedOptions[e]=this.getLanguage().translateOption(e,this.params.field,t)}))}}}e.default=s}),define("views/fields/foreign-bool",["exports","views/fields/bool","helpers/misc/foreign-field"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{type="foreign";setup(){super.setup();let e=new s.default(this);var t,i=e.getForeignParams();for(t in i)this.params[t]=i[t]}}e.default=a}),define("views/fields/followers",["exports","views/fields/link-multiple"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{foreignScope="User";portionSize=6;setup(){super.setup(),this.addActionHandler("showMoreFollowers",(e,t)=>{this.showMoreFollowers(),$(t).remove()}),this.portionSize=this.getConfig().get("recordFollowersLoadLimit")||this.portionSize,this.limit=this.portionSize,this.listenTo(this.model,"change:isFollowed",()=>{let t=this.model.get(this.idsName)||[];if(this.model.get("isFollowed")){if(!~t.indexOf(this.getUser().id)){t.unshift(this.getUser().id);let e=this.model.get(this.nameHashName)||{};e[this.getUser().id]=this.getUser().get("name"),this.model.trigger("change:"+this.idsName),this.reRender()}}else{var e=t.indexOf(this.getUser().id);~e&&(t.splice(e,1),this.model.trigger("change:"+this.idsName),this.reRender())}})}showMoreFollowers(){this.getCollectionFactory().create("User",e=>{e.url=this.model.entityType+"/"+this.model.id+"/followers",e.offset=this.ids.length||0,e.maxSize=this.portionSize,e.data.select=["id","name"].join(","),e.orderBy=null,e.order=null,this.listenToOnce(e,"sync",()=>{let t=this.model.get(this.idsName)||[],i=this.model.get(this.nameHashName)||{};e.forEach(e=>{t.push(e.id),i[e.id]=e.get("name")}),this.limit+=this.portionSize,this.model.trigger("change:"+this.idsName),this.reRender()}),e.fetch()})}getValueForDisplay(){if(this.mode===this.MODE_DETAIL||this.mode===this.MODE_LIST){let t=[],e=(this.ids.forEach(e=>{t.push(this.getDetailLinkHtml(e))}),null);return t.length&&(e=""+t.join(", ")),t.length>=this.limit&&(e+=', <a role="button" data-action="showMoreFollowers">...</a>'),e}}}e.default=s}),define("views/fields/enum-styled",["exports","views/fields/enum"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{}e.default=s}),define("views/fields/enum-float",["exports","views/fields/enum-int"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="enumFloat";fetch(){var e=parseFloat(this.$element.val());let t={};return t[this.name]=e,t}parseItemForSearch(e){return parseFloat(e)}}e.default=s}),define("views/fields/enum-column",["exports","views/fields/enum"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{searchTypeList=["anyOf","noneOf"];fetchSearch(){var e=this.fetchSearchType();let i=this.$element.val().split(":,:");return(i=1===i.length&&""===i[0]?[]:i).forEach((e,t)=>{i[t]=this.parseItemForSearch(e)}),"anyOf"===e?0===i.length?{data:{type:"anyOf",valueList:i}}:{type:"columnIn",value:i,data:{type:"anyOf",valueList:i}}:"noneOf"===e?0===i.length?{data:{type:"noneOf",valueList:i}}:{type:"or",value:[{type:"columnIsNull",attribute:this.name},{type:"columnNotIn",value:i,attribute:this.name}],data:{type:"noneOf",valueList:i}}:null}}e.default=s}),define("views/fields/entity-type",["exports","views/fields/enum"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkAvailability(e){e=this.scopesMetadataDefs[e]||{};if(e.entity&&e.object)return!0}setupOptions(){var e=this.scopesMetadataDefs=this.getMetadata().get("scopes");this.params.options=Object.keys(e).filter(e=>{if(this.checkAvailability(e))return!0}).sort((e,t)=>this.translate(e,"scopeNames").localeCompare(this.translate(t,"scopeNames"))),this.params.options.unshift("")}setup(){this.params.translation="Global.scopeNames",this.setupOptions(),super.setup()}}e.default=s}),define("views/fields/entity-type-list",["exports","views/fields/multi-enum"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkAvailability(e){e=this.scopesMetadataDefs[e]||{};if(e.entity&&e.object)return!0}setupOptions(){var e=this.scopesMetadataDefs=this.getMetadata().get("scopes");this.params.options=Object.keys(e).filter(e=>{if(this.checkAvailability(e))return!0}).sort((e,t)=>this.translate(e,"scopeNames").localeCompare(this.translate(t,"scopeNames")))}setup(){this.params.translation||(this.params.translation="Global.scopeNames"),this.setupOptions(),super.setup()}}e.default=s}),define("views/fields/email-address",["exports","views/fields/varchar"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{editTemplate="fields/email-address/edit";validations=["required","emailAddress"];emailAddressRe=new RegExp(/^[-!#$%&'*+/=?^_`{|}~A-Za-z0-9]+(?:\.[-!#$%&'*+/=?^_`{|}~A-Za-z0-9]+)*/.source+/@([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])?\.)+[A-Za-z0-9][A-Za-z0-9-]*[A-Za-z0-9]/.source);validateEmailAddress(){var e=this.model.get(this.name);return!!e&&(""!==e&&!this.emailAddressRe.test(e)&&(e=this.translate("fieldShouldBeEmail","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0))}}e.default=s}),define("views/fields/duration",["exports","views/fields/enum","ui/select","moment"],function(e,t,a,l){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),a=i(a),l=i(l);class s extends t.default{type="duration";listTemplate="fields/base/detail";detailTemplate="fields/varchar/detail";editTemplate="fields/duration/edit";data(){return{valueIsSet:this.model.has(this.startField)&&this.model.has(this.endField),durationOptions:this.durationOptions,...super.data()}}calculateSeconds(){this.seconds=0;var e=this.model.get(this.startField);let t=this.model.get(this.endField);if((this.isEditMode()||this.isDetailMode())&&this.model.isNew()&&(this.seconds=this.model.getFieldParam(this.name,"default")||0),this.model.get("isAllDay")){var i=this.model.get(this.startField+"Date"),s=this.model.get(this.endField+"Date");if(i&&s)return void(this.seconds=(0,l.default)(s).add(1,"days").unix()-(0,l.default)(i).unix())}e&&t?this.seconds=(0,l.default)(this.model.get(this.endField)).unix()-(0,l.default)(this.model.get(this.startField)).unix():e&&(t=this._getDateEnd(),this.model.set(this.endField,t,{silent:!0}))}init(){super.init(),this.listenTo(this,"render",()=>{this.calculateSeconds(),this.durationOptions="",this.getOptions().forEach(e=>{let t=$("<option>").val(e).text(this.stringifyDuration(e));e===this.seconds&&t.attr("selected","selected"),this.durationOptions+=t.get(0).outerHTML}),this.stringValue=this.stringifyDuration(this.seconds)})}getOptions(){let e=Espo.Utils.clone(this.model.getFieldParam(this.name,"options")??[]);return this.model.get("isAllDay")||-1!==e.indexOf(this.seconds)||e.push(this.seconds),e.sort((e,t)=>e-t),e}setup(){if(this.startField=this.model.getFieldParam(this.name,"start"),this.endField=this.model.getFieldParam(this.name,"end"),!this.startField||!this.endField)throw new Error("Bad definition for field '"+this.name+"'.");this.calculateSeconds(),this.blockDateEndChangeListener=!1,this.listenTo(this.model,"change:"+this.endField,(e,t,i)=>{var s,a;this.blockDateEndChangeListener||(s=this.model.get(this.startField),(a=this.model.get(this.endField))&&s&&(this.seconds=(0,l.default)(a).unix()-(0,l.default)(s).unix(),i.updatedByDuration||this.updateDuration()))}),this.listenTo(this.model,"change:"+this.startField,(e,t,i)=>{var s;if(i.ui)return!this.model.get(this.startField+"Date")||0!=(s=this.seconds%86400)&&(this.seconds=this.seconds-s+86400),this.blockDateEndChangeListener=!0,setTimeout(()=>this.blockDateEndChangeListener=!1,100),this.updateDateEnd(),void setTimeout(()=>this.updateDuration(),50);!this.isEditMode()&&i.xhr||this.updateDateEnd()})}getValueForDisplay(){return this.stringValue}stringifyDuration(e){if(!e)return"0";if(e<60)return"0";var t=Math.floor(e/86400),i=(e%=86400,Math.floor(e/3600)),e=(e%=3600,Math.floor(e/60));let s=[];return t&&s.push(t+""+this.getLanguage().translate("d","durationUnits")),i&&s.push(i+""+this.getLanguage().translate("h","durationUnits")),e&&s.push(e+""+this.getLanguage().translate("m","durationUnits")),s.join(" ")}focusOnInlineEdit(){a.default.focus(this.$duration)}afterRender(){let e=this.getParentView();var t,i,s;e&&"getView"in e&&(this.endFieldView=e.getView(this.endField)),this.isEditMode()&&(this.$duration=this.$el.find(".main-element"),this.$duration.on("change",()=>{this.seconds=parseInt(this.$duration.val()),this.updateDateEnd()}),t=this.model.get(this.startField),i=this.model.get(this.endField),s=this.$duration.val(),!i&&t&&s&&this.endFieldView&&(this.endFieldView.isRendered()?this.updateDateEnd():this.endFieldView.once("after:render",()=>{this.updateDateEnd()})),a.default.init(this.$duration,{sortBy:"$score",sortDirection:"desc",score:(e,t)=>{t=parseInt(t.value),e=parseInt(e);if(isNaN(e))return 0;var i=Number.MAX_SAFE_INTEGER-t;return 0===e&&0===t||60*e===t||60*e*60===t||60*e*60*24===t?i:0},load:(i,s)=>{i=parseInt(i);if(!(isNaN(i)||i<=0||59<i)){let t=[],e=60*i;if(t.push({value:e.toString(),text:this.stringifyDuration(e)}),i<=9){let e=3600*i;t.push({value:e.toString(),text:this.stringifyDuration(e)})}s(t)}}}))}_getDateEndDate(){var e=this.seconds,t=this.model.get(this.startField+"Date");if(t){if(!e)return t;t=l.default.utc(t).unix()+e;return l.default.unix(t).utc().add(-1,"day").format(this.getDateTime().internalDateFormat)}}_getDateEnd(){var t=this.seconds,i=this.model.get(this.startField);if(i){let e;return e=t?(t=l.default.utc(i).unix()+t,l.default.unix(t).utc().format(this.getDateTime().internalDateTimeFormat)):i}}updateDateEnd(){let e;if(this.model.get("isAllDay"))return e=this._getDateEndDate(),void setTimeout(()=>{this.model.set(this.endField+"Date",e,{updatedByDuration:!0})},1);e=this._getDateEnd(),setTimeout(()=>{this.model.set(this.endField,e,{updatedByDuration:!0}),this.model.set(this.endField+"Date",null)},1)}updateDuration(){let e=this.seconds;var t;if(this.isEditMode()&&this.$duration&&this.$duration.length)return t=this.getOptions().map(e=>({value:e.toString(),text:this.stringifyDuration(e)})),a.default.setValue(this.$duration,""),a.default.setOptions(this.$duration,t),void a.default.setValue(this.$duration,e.toString());this.reRender()}fetch(){return{}}}e.default=s}),define("views/fields/datetime-short",["exports","views/fields/datetime","moment"],function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),a=i(a);class s extends t.default{listTemplate="fields/datetime-short/list";detailTemplate="fields/datetime-short/detail";data(){let e=super.data();return this.mode!==this.MODE_LIST&&this.mode!==this.MODE_DETAIL||(e.fullDateValue=super.getDateStringValue()),e}getDateStringValue(){if(this.mode!==this.MODE_LIST&&this.mode!==this.MODE_DETAIL)return super.getDateStringValue();var e=this.model.get(this.name);if(!e)return super.getDateStringValue();let t=this.getDateTime().timeFormat,i=(this.params.hasSeconds&&(t=t.replace(/:mm/,":mm:ss")),this.getDateTime().toMoment(e)),s=(0,a.default)().tz(this.getDateTime().timeZone||"UTC");if(i.unix()>s.clone().startOf("day").unix()&&i.unix()<s.clone().add(1,"days").startOf("day").unix())return i.format(t);e=this.getDateTime().getReadableShortDateFormat();return i.format("YYYY")===s.format("YYYY")?i.format(e):i.format(e+", YY")}}e.default=s}),define("views/fields/datetime-optional",["exports","views/fields/datetime","moment"],function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),a=i(a);class s extends t.default{type="datetimeOptional";setup(){super.setup(),this.noneOption=this.translate("None"),this.nameDate=this.name+"Date"}isDate(){var e=this.model.get(this.nameDate);return!(!e||""===e)}data(){let e=super.data();var t;return this.isDate()&&(t=this.model.get(this.nameDate),e.date=this.getDateTime().toDisplayDate(t),e.time=this.noneOption),e}getDateStringValue(){var e;return this.isDate()?(e=this.model.get(this.nameDate),this.stringifyDateValue(e)):super.getDateStringValue()}setDefaultTime(){this.$time.val(this.noneOption)}initTimepicker(){let e=this.$time,t={step:this.params.minuteStep||30,scrollDefaultNow:!0,timeFormat:this.timeFormatMap[this.getDateTime().timeFormat],noneOption:[{label:this.noneOption,value:this.noneOption}]};(this.emptyTimeInInlineEditDisabled&&this.isInlineEditMode()||this.noneOptionIsHidden)&&delete t.noneOption,e.timepicker(t),e.parent().find("button.time-picker-btn").on("click",()=>{e.timepicker("show")})}fetch(){let e={};var t=this.$date.val(),i=this.$time.val();let s=null;return i!==this.noneOption&&""!==i?(""!==t&&""!==i&&(s=this.parse(t+" "+i)),e[this.name]=s,e[this.nameDate]=null):""!==t?(e[this.nameDate]=this.getDateTime().fromDisplayDate(t),i=e[this.nameDate]+" 00:00:00",i=a.default.tz(i,this.getConfig().get("timeZone")||"UTC").add(this.isEnd?1:0,"days").utc().format(this.getDateTime().internalDateTimeFullFormat),e[this.name]=i):(e[this.nameDate]=null,e[this.name]=null),e}validateAfter(){var e=this.model.getFieldParam(this.name,"after");if(e){var t=e+"Date",i=this.model.get(this.name)||this.model.get(this.nameDate),t=this.model.get(e)||this.model.get(t);if(i&&t)return(this.validateAfterAllowSameDay&&this.model.get(this.nameDate)?(0,a.default)(i).unix()<(0,a.default)(t).unix():(0,a.default)(i).unix()<=(0,a.default)(t).unix())?(i=this.translate("fieldShouldAfter","messages").replace("{field}",this.getLabelText()).replace("{otherField}",this.translate(e,"fields",this.entityType)),this.showValidationMessage(i),!0):void 0}}validateBefore(){var e=this.model.getFieldParam(this.name,"before");if(e){var t=e+"Date",i=this.model.get(this.name)||this.model.get(this.nameDate),t=this.model.get(e)||this.model.get(t);if(i&&t)return(0,a.default)(i).unix()>=(0,a.default)(t).unix()?(i=this.translate("fieldShouldBefore","messages").replace("{field}",this.getLabelText()).replace("{otherField}",this.translate(e,"fields",this.entityType)),this.showValidationMessage(i),!0):void 0}}validateRequired(){var e;if(this.isRequired())return null===this.model.get(this.name)&&null===this.model.get(this.nameDate)?(e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0):void 0}}e.default=s}),define("views/fields/currency-list",["exports","views/fields/enum"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setupOptions(){this.params.options=[],(this.getConfig().get("currencyList")||[]).forEach(e=>{this.params.options.push(e)})}}e.default=s}),define("views/fields/complex-expression",["exports","views/fields/text"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=(i=t)&&i.__esModule?i:{default:i};let s;class a extends t.default{detailTemplate="fields/formula/detail";editTemplate="fields/formula/edit";height=50;maxLineDetailCount=80;maxLineEditCount=200;events={'click [data-action="addAttribute"]':function(){this.addAttribute()},'click [data-action="addFunction"]':function(){this.addFunction()}};setup(){super.setup(),this.height=this.options.height||this.params.height||this.height,this.maxLineDetailCount=this.options.maxLineDetailCount||this.params.maxLineDetailCount||this.maxLineDetailCount,this.maxLineEditCount=this.options.maxLineEditCount||this.params.maxLineEditCount||this.maxLineEditCount,this.targetEntityType=this.options.targetEntityType||this.params.targetEntityType||this.targetEntityType,this.containerId="editor-"+Math.floor(1e4*Math.random()+1).toString(),this.mode!==this.MODE_EDIT&&this.mode!==this.MODE_DETAIL||this.wait(this.requireAce()),this.on("remove",()=>{this.editor&&this.editor.destroy()})}requireAce(){return Espo.loader.requirePromise("lib!ace").then(e=>{s=e;let t=[Espo.loader.requirePromise("lib!ace-ext-language_tools")];return this.getThemeManager().getParam("isDark")&&t.push(Espo.loader.requirePromise("lib!ace-theme-tomorrow_night")),Promise.all(t)})}data(){let e=super.data();return e.containerId=this.containerId,e.targetEntityType=this.targetEntityType,e.hasInsert=!0,e}afterRender(){if(super.afterRender(),this.$editor=this.$el.find("#"+this.containerId),this.$editor.length&&(this.mode===this.MODE_EDIT||this.mode===this.MODE_DETAIL||this.mode===this.MODE_LIST)){this.$editor.css("fontSize","14px"),this.mode===this.MODE_EDIT&&this.$editor.css("minHeight",this.height+"px");const e=this.editor=s.edit(this.containerId);e.setOptions({maxLines:this.mode===this.MODE_EDIT?this.maxLineEditCount:this.maxLineDetailCount}),this.getThemeManager().getParam("isDark")&&e.setOptions({theme:"ace/theme/tomorrow_night"}),this.isEditMode()&&(e.getSession().on("change",()=>{this.trigger("change",{ui:!0})}),e.getSession().setUseWrapMode(!0)),this.isReadMode()&&(e.setReadOnly(!0),e.renderer.$cursorLayer.element.style.display="none",e.renderer.setShowGutter(!1)),e.setShowPrintMargin(!1),e.getSession().setUseWorker(!1),e.commands.removeCommand("find"),e.setHighlightActiveLine(!1),this.isReadMode()||this.initAutocomplete()}}fetch(){let e={};return e[this.name]=this.editor.getValue(),e}getFunctionDataList(){return this.getMetadata().get(["app","complexExpression","functionList"])||[]}initAutocomplete(){let d=this.getFunctionDataList().filter(e=>e.insertText),h=this.getFormulaAttributeList();s.require("ace/ext/language_tools"),this.editor.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0}),this.editor.completers=[{identifierRegexps:[/[\\a-zA-Z0-9{}\[\].$'"]/],getCompletions:function(e,t,i,s,a){let l=d.filter(e=>{let t=e.name.toLowerCase();return 0===t.indexOf(s.toLowerCase())}),r=l.map(e=>({caption:e.name+"()",value:e.insertText,meta:e.returnType||null})),o=h.filter(e=>0===e.indexOf(s));var n=o.map(e=>({name:e,value:e,meta:"attribute"}));a(null,r=r.concat(n))}}]}getFormulaAttributeList(){if(!this.targetEntityType)return[];let s=this.getFieldManager().getEntityTypeAttributeList(this.targetEntityType).sort(),a=(s.unshift("id"),this.getMetadata().get(["entityDefs",this.targetEntityType,"links"])||{}),i=[];return Object.keys(a).forEach(e=>{var t=a[e].type;t&&~["hasMany","hasOne","belongsTo"].indexOf(t)&&i.push(e)}),i.sort(),i.forEach(t=>{var i=a[t].entity;if(i&&!a[t].disabled){let e=this.getFieldManager().getEntityTypeAttributeList(i).sort();e.forEach(e=>{s.push(t+"."+e)})}}),s}addAttribute(){this.createView("dialog","views/admin/formula/modals/add-attribute",{scope:this.targetEntityType,attributeList:this.getFormulaAttributeList()},e=>{e.render(),this.listenToOnce(e,"add",e=>{this.editor.insert(e),this.clearView("dialog")})})}addFunction(){this.createView("dialog","views/admin/complex-expression/modals/add-function",{scope:this.targetEntityType,functionDataList:this.getFunctionDataList()},e=>{e.render(),this.listenToOnce(e,"add",e=>{this.editor.insert(e),this.clearView("dialog")})})}}e.default=a}),define("views/fields/complex-created",["exports","views/fields/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{detailTemplateContent='<span data-name="{{baseName}}At" class="field">{{{atField}}}</span> <span class="text-muted chevron-right"</span> <span data-name="{{baseName}}By" class="field">{{{byField}}}</span>';baseName="created";getAttributeList(){return[this.fieldAt,this.fieldBy]}init(){this.baseName=this.options.baseName||this.baseName,this.fieldAt=this.baseName+"At",this.fieldBy=this.baseName+"By",super.init()}setup(){super.setup(),this.createField("at"),this.createField("by")}data(){return{baseName:this.baseName,...super.data()}}createField(e){var t=this.baseName+Espo.Utils.upperCaseFirst(e),i=this.model.getFieldType(t)||"base",i=this.model.getFieldParam(t,"view")||this.getFieldManager().getViewName(i);this.createView(e+"Field",i,{name:t,model:this.model,mode:this.MODE_DETAIL,readOnly:!0,readOnlyLocked:!0,selector:'[data-name="'+t+'"]'})}fetch(){return{}}}e.default=s}),define("views/fields/colorpicker",["exports","views/fields/varchar"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="varchar";detailTemplate="fields/colorpicker/detail";listTemplate="fields/colorpicker/detail";editTemplate="fields/colorpicker/edit";setup(){super.setup(),this.wait(Espo.loader.requirePromise("lib!bootstrap-colorpicker"))}afterRender(){var e;super.afterRender(),this.isEditMode()&&(e=!!this.$el.closest(".modal").length,this.$element.parent().colorpicker({format:"hex",container:e&&this.$el}),e&&this.$el.find(".colorpicker").css("position","relative").addClass("pull-right"),this.$element.on("change",()=>{""===this.$element.val()&&this.$el.find(".input-group-addon > i").css("background-color","transparent")}))}}e.default=s}),define("views/fields/barcode",["exports","views/fields/varchar"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=(i=t)&&i.__esModule?i:{default:i};let s,l;class a extends t.default{type="barcode";listTemplate="fields/barcode/detail";detailTemplate="fields/barcode/detail";setup(){let e=255;switch(this.params.codeType){case"EAN2":e=2;break;case"EAN5":e=5;break;case"EAN8":e=8;break;case"EAN13":e=13;break;case"UPC":e=12;break;case"UPCE":e=11;break;case"ITF14":e=14;break;case"pharmacode":e=6}this.params.maxLength=e,"QRcode"!==this.params.codeType?(this.isSvg=!0,this.wait(Espo.loader.requirePromise("lib!jsbarcode").then(e=>s=e))):this.wait(Espo.loader.requirePromise("lib!qrcodejs").then(e=>l=e)),super.setup(),$(window).on("resize."+this.cid,()=>{this.isRendered()&&this.controlWidth()}),this.listenTo(this.recordHelper,"panel-show",()=>this.controlWidth())}data(){let e=super.data();return e.isSvg=this.isSvg,e}onRemove(){$(window).off("resize."+this.cid)}afterRender(){if(super.afterRender(),this.isListMode()||this.isDetailMode){let e=this.model.get(this.name);e&&("QRcode"===this.params.codeType?this.initQrcode(e):$(this.getSelector()+" .barcode").length?this.initBarcode(e):setTimeout(()=>{this.initBarcode(e),this.controlWidth()},100)),this.controlWidth()}}initQrcode(t){let i=128;192<t.length&&(i*=2),this.isListMode()&&(i=64);var s=this.$el.width();s<i&&s&&(i=s);let a=this.$el.find(".barcode");s=e=>{e={text:t,width:i,height:i,colorDark:"#000000",colorLight:"#ffffff",correctLevel:e||l.CorrectLevel.H};new l(a.get(0),e)};try{s()}catch(e){try{a.empty(),s(l.CorrectLevel.L)}catch(e){console.error(this.name+": "+e.message)}}}initBarcode(e){s(this.getSelector()+" .barcode",e,{format:this.params.codeType,height:50,fontSize:14,margin:0,lastChar:this.params.lastChar})}controlWidth(){this.$el.find(".barcode").css("max-width",this.$el.width()+"px")}}e.default=a}),define("views/fields/autoincrement",["exports","views/fields/int"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="autoincrement";validations=[];inlineEditDisabled=!0;readOnly=!0;disableFormatting=!0;parse(e){return e=null!==(e=""!==e?e:null)?-1!==e.indexOf(".")||-1!==e.indexOf(",")?NaN:parseInt(e):e}fetch(){return{}}}e.default=s}),define("views/fields/assigned-users",["exports","views/fields/link-multiple"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{init(){this.assignmentPermission=this.getAcl().getPermissionLevel("assignmentPermission"),"no"===this.assignmentPermission&&(this.readOnly=!0),super.init()}getSelectBoolFilterList(){if("team"===this.assignmentPermission)return["onlyMyTeam"]}getSelectPrimaryFilterName(){return"active"}getDetailLinkHtml(e,t){var i=super.getDetailLinkHtml(e),e=this.isDetailMode()?this.getHelper().getAvatarHtml(e,"small",14,"avatar-link"):"";return e?e+" "+i:i}}e.default=s}),define("views/fields/assigned-user",["exports","views/fields/user-with-avatar"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{init(){this.assignmentPermission=this.getAcl().getPermissionLevel("assignmentPermission"),"no"===this.assignmentPermission&&this.setReadOnly(!0),super.init()}getSelectBoolFilterList(){if("team"===this.assignmentPermission)return["onlyMyTeam"]}getSelectPrimaryFilterName(){return"active"}getEmptyAutocompleteResult(){return{list:[{id:this.getUser().id,name:this.getUser().get("name")}]}}}e.default=s}),define("views/fields/array-int",["exports","views/fields/array"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{type="arrayInt";fetchFromDom(){let s=[];this.$el.find(".list-group .list-group-item").each((e,t)=>{let i=$(t).data("value");("string"==typeof i||i instanceof String)&&(i=parseInt($(t).data("value"))),s.push(i)}),this.selected=s}addValue(e){e=parseInt(e),isNaN(e)||super.addValue(e)}removeValue(e){var t;e=parseInt(e),isNaN(e)||(t=e.toString().replace(/"/g,'\\"'),this.$list.children('[data-value="'+t+'"]').remove(),t=this.selected.indexOf(e),this.selected.splice(t,1),this.trigger("change"))}}e.default=s}),define("views/fields/address",["exports","views/fields/base","views/fields/varchar"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{type="address";listTemplate="fields/address/detail";detailTemplate="fields/address/detail";editTemplate="fields/address/edit";editTemplate1="fields/address/edit-1";editTemplate2="fields/address/edit-2";editTemplate3="fields/address/edit-3";editTemplate4="fields/address/edit-4";searchTemplate="fields/address/search";postalCodeField;streetField;cityField;stateField;countryField;validations=["required","pattern"];events={'click [data-action="viewMap"]':function(e){e.preventDefault(),e.stopPropagation(),this.viewMapAction()}};data(){let t=super.data();return t.ucName=Espo.Utils.upperCaseFirst(this.name),this.addressPartList.forEach(e=>{t[e+"Value"]=this.model.get(this[e+"Field"])}),this.mode!==this.MODE_DETAIL&&this.mode!==this.MODE_LIST||(t.formattedAddress=this.getFormattedAddress(),t.isNone=null===t.formattedAddress,-1===t.formattedAddress&&(t.formattedAddress=null,t.isLoading=!0),this.params.viewMap&&this.canBeDisplayedOnMap()&&(t.viewMap=!0,t.viewMapLink="#AddressMap/view/"+this.model.entityType+"/"+this.model.id+"/"+this.name)),this.isEditMode()&&(t.stateMaxLength=this.stateMaxLength,t.streetMaxLength=this.streetMaxLength,t.postalCodeMaxLength=this.postalCodeMaxLength,t.cityMaxLength=this.cityMaxLength,t.countryMaxLength=this.countryMaxLength),t}setupSearch(){this.searchData.value=this.getSearchParamsData().value||this.searchParams.additionalValue}canBeDisplayedOnMap(){return!!this.model.get(this.name+"City")||!!this.model.get(this.name+"PostalCode")}getFormattedAddress(){let t=!1,i=!1;if(this.addressAttributeList.forEach(e=>{t=t||this.model.get(e),i=i||this.model.has(e)}),!t)return this.mode===this.MODE_LIST?"":i?null:-1;var e="getFormattedAddress"+this.getAddressFormat().toString();return e in this?this[e]():void 0}getFormattedAddress1(){var e=this.model.get(this.postalCodeField),t=this.model.get(this.streetField),i=this.model.get(this.cityField),s=this.model.get(this.stateField),a=this.model.get(this.countryField);let l="";return t&&(l+=t),(i||s||e)&&(""!==l&&(l+="\n"),i&&(l+=i),s&&(i&&(l+=", "),l+=s),e&&((i||s)&&(l+=" "),l+=e)),a&&(""!==l&&(l+="\n"),l+=a),l}getFormattedAddress2(){var e=this.model.get(this.postalCodeField),t=this.model.get(this.streetField),i=this.model.get(this.cityField),s=this.model.get(this.stateField),a=this.model.get(this.countryField);let l="";return t&&(l+=t),(i||e)&&(""!==l&&(l+="\n"),e&&(l+=e,i&&(l+=" ")),i&&(l+=i)),(s||a)&&(""!==l&&(l+="\n"),s&&(l+=s,a&&(l+=" ")),a&&(l+=a)),l}getFormattedAddress3(){var e=this.model.get(this.postalCodeField),t=this.model.get(this.streetField),i=this.model.get(this.cityField),s=this.model.get(this.stateField),a=this.model.get(this.countryField);let l="";return a&&(l+=a),(i||s||e)&&(""!==l&&(l+="\n"),e&&(l+=e),s&&(e&&(l+=" "),l+=s),i&&((e||s)&&(l+=" "),l+=i)),t&&(""!==l&&(l+="\n"),l+=t),l}getFormattedAddress4(){var e=this.model.get(this.postalCodeField),t=this.model.get(this.streetField),i=this.model.get(this.cityField),s=this.model.get(this.stateField),a=this.model.get(this.countryField);let l="";return t&&(l+=t),i&&(""!==l&&(l+="\n"),l+=i),(a||s||e)&&(""!==l&&(l+="\n"),a&&(l+=a),s&&(a&&(l+=" - "),l+=s),e&&((a||s)&&(l+=" "),l+=e)),l}_getTemplateName(){if(this.mode===this.MODE_EDIT){var e="editTemplate"+this.getAddressFormat().toString();if(e in this)return this[e]}return super._getTemplateName()}getAddressFormat(){return this.getConfig().get("addressFormat")||1}afterRender(){var e;this.mode===this.MODE_EDIT&&(this.$street=this.$el.find('[data-name="'+this.streetField+'"]'),this.$postalCode=this.$el.find('[data-name="'+this.postalCodeField+'"]'),this.$state=this.$el.find('[data-name="'+this.stateField+'"]'),this.$city=this.$el.find('[data-name="'+this.cityField+'"]'),this.$country=this.$el.find('[data-name="'+this.countryField+'"]'),this.$street.on("change",()=>{this.trigger("change")}),this.$postalCode.on("change",()=>{this.trigger("change")}),this.$state.on("change",()=>{this.trigger("change")}),this.$city.on("change",()=>{this.trigger("change")}),this.$country.on("change",()=>{this.trigger("change")}),(e=this.getConfig().get("addressCountryList")||[]).length&&(this.$country.autocomplete({minChars:0,lookup:e,maxHeight:200,formatResult:e=>this.getHelper().escapeString(e.value),lookupFilter:(e,t,i)=>0===e.value.toLowerCase().indexOf(i)&&e.value.length!==i.length,onSelect:()=>{this.trigger("change"),this.$country.focus()}}),this.$country.on("focus",()=>{this.$country.val()||this.$country.autocomplete("onValueChange")}),this.once("render",()=>{this.$country.autocomplete("dispose")}),this.once("remove",()=>{this.$country.autocomplete("dispose")}),this.$country.attr("autocomplete","espo-country")),(e=this.getConfig().get("addressCityList")||[]).length&&(this.$city.autocomplete({minChars:0,lookup:e,maxHeight:200,formatResult:e=>this.getHelper().escapeString(e.value),lookupFilter:(e,t,i)=>0===e.value.toLowerCase().indexOf(i)&&e.value.length!==i.length,onSelect:()=>{this.trigger("change"),this.$city.focus()}}),this.$city.on("focus",()=>{this.$city.val()||this.$city.autocomplete("onValueChange")}),this.once("render",()=>{this.$city.autocomplete("dispose")}),this.once("remove",()=>{this.$city.autocomplete("dispose")}),this.$city.attr("autocomplete","espo-city")),(e=this.getConfig().get("addressStateList")||[]).length&&(this.$state.autocomplete({minChars:0,lookup:e,maxHeight:200,formatResult:e=>this.getHelper().escapeString(e.value),lookupFilter:function(e,t,i){return 0===e.value.toLowerCase().indexOf(i)&&e.value.length!==i.length},onSelect:()=>{this.trigger("change"),this.$state.focus()}}),this.$state.on("focus",()=>{this.$state.val()||this.$state.autocomplete("onValueChange")}),this.once("render",()=>{this.$state.autocomplete("dispose")}),this.once("remove",()=>{this.$state.autocomplete("dispose")}),this.$state.attr("autocomplete","espo-state")),this.controlStreetTextareaHeight(),this.$street.on("input",()=>{this.controlStreetTextareaHeight()}))}controlStreetTextareaHeight(e){var t=this.$street.prop("scrollHeight"),i=this.$street.prop("clientHeight");void 0!==e||0!==i?i!==e&&(i+1<t&&(e=this.$street.prop("rows"),this.$street.attr("rows",e+1),this.controlStreetTextareaHeight(i)),0===this.$street.val().length&&this.$street.attr("rows",1)):setTimeout(this.controlStreetTextareaHeight.bind(this),10)}setup(){super.setup();let e=this.getMetadata().get(["fields",this.type,"actualFields"])||[];this.addressAttributeList=[],this.addressPartList=[],e.forEach(e=>{var t=this.name+Espo.Utils.upperCaseFirst(e);this.addressAttributeList.push(t),this.addressPartList.push(e),this[e+"Field"]=t,this[e+"MaxLength"]=this.getMetadata().get(["entityDefs",this.entityType,"fields",t,"maxLength"])})}validateRequired(){var e=e=>{var t;if(this.model.isRequired(e)&&""===this.model.get(e))return t=this.translate("fieldIsRequired","messages").replace("{field}",this.translate(e,"fields",this.entityType)),this.showValidationMessage(t,'[data-name="'+e+'"]'),!0};let t=!1;return t=e(this.postalCodeField)||t,t=e(this.streetField)||t,t=e(this.stateField)||t,t=e(this.cityField)||t,t=e(this.countryField)||t}isRequired(){return this.model.getFieldParam(this.postalCodeField,"required")||this.model.getFieldParam(this.streetField,"required")||this.model.getFieldParam(this.stateField,"required")||this.model.getFieldParam(this.cityField,"required")||this.model.getFieldParam(this.countryField,"required")}validatePattern(){var e;let t=!1;for(e of[this.postalCodeField,this.stateField,this.cityField,this.countryField])t=i.default.prototype.fieldValidatePattern.call(this,e)||t;return t}fetch(){let t={},e=(t[this.postalCodeField]=this.$postalCode.val().toString().trim(),t[this.streetField]=this.$street.val().toString().trim(),t[this.stateField]=this.$state.val().toString().trim(),t[this.cityField]=this.$city.val().toString().trim(),t[this.countryField]=this.$country.val().toString().trim(),[this.postalCodeField,this.streetField,this.stateField,this.cityField,this.countryField]);return e.forEach(e=>{""===t[e]&&(t[e]=null)}),t}fetchSearch(){var e=this.$el.find("input.main-element").val().toString().trim();return e?{type:"or",value:[{type:"like",field:this.postalCodeField,value:e+"%"},{type:"like",field:this.streetField,value:e+"%"},{type:"like",field:this.cityField,value:e+"%"},{type:"like",field:this.stateField,value:e+"%"},{type:"like",field:this.countryField,value:e+"%"}],data:{value:e}}:null}viewMapAction(){this.createView("mapDialog","views/modals/view-map",{model:this.model,field:this.name},e=>e.render())}}e.default=a}),define("views/fields/address-state",["exports","views/fields/varchar"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setupOptions(){var e=this.getConfig().get("addressStateList")||[];e.length&&(this.params.options=Espo.Utils.clone(e))}}e.default=s}),define("views/fields/address-country",["exports","views/fields/varchar"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setupOptions(){var e=this.getConfig().get("addressCountryList")||[];e.length&&(this.params.options=Espo.Utils.clone(e))}}e.default=s}),define("views/fields/address-city",["exports","views/fields/varchar"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setupOptions(){var e=this.getConfig().get("addressCityList")||[];e.length&&(this.params.options=Espo.Utils.clone(e))}}e.default=s}),define("views/dashlets/stream",["exports","views/dashlets/abstract/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{name="Stream";templateContent='<div class="list-container">{{{list}}}</div>';actionRefresh(){this.getRecordView()&&this.getRecordView().showNewRecords()}afterRender(){this.getCollectionFactory().create("Note",e=>{(this.collection=e).url="Stream",e.maxSize=this.getOption("displayRecords"),this.getOption("skipOwn")&&(e.data.skipOwn=!0),e.fetch().then(()=>{this.createView("list","views/stream/record/list",{selector:"> .list-container",collection:e,isUserStream:!0,noEdit:!1},e=>{e.render()})})})}getRecordView(){return this.getView("list")}setupActionList(){this.actionList.unshift({name:"viewList",text:this.translate("View"),iconHtml:'<span class="fas fa-align-justify"></span>',url:"#Stream"}),this.getUser().isPortal()||this.actionList.unshift({name:"create",text:this.translate("Create Post","labels"),iconHtml:'<span class="fas fa-plus"></span>'})}actionCreate(){this.createView("dialog","views/stream/modals/create-post",{},e=>{e.render(),this.listenToOnce(e,"after:save",()=>{e.close(),this.actionRefresh()})})}actionViewList(){this.getRouter().navigate("#Stream",{trigger:!0})}}e.default=s}),define("views/dashlets/records",["exports","views/dashlets/abstract/record-list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{name="Records";rowActionsView="views/record/row-actions/view-and-edit";listView="views/email/record/list-expanded";init(){super.init(),this.scope=this.getOption("entityType")}getSearchData(){const e={primary:this.getOption("primaryFilter")},t=("all"===e.primary&&delete e.primary,{});return(this.getOption("boolFilterList")||[]).forEach(e=>{t[e]=!0}),e.bool=t,e}setupActionList(){var e=this.getOption("entityType");e&&this.getAcl().checkScope(e,"create")&&this.actionList.unshift({name:"create",text:this.translate("Create "+e,"labels",e),iconHtml:'<span class="fas fa-plus"></span>',url:"#"+e+"/create"})}}e.default=s}),define("views/dashlets/memo",["exports","views/dashlets/abstract/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{name="Memo";templateContent=`
        {{#if text}}
        <div class="complex-text complex-text-memo">{{complexText text}}</div>
        {{/if}}
    `;data(){return{text:this.getOption("text")}}afterAdding(){this.getContainerView().actionOptions()}}e.default=s}),define("views/dashlets/iframe",["exports","views/dashlets/abstract/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{name="Iframe";templateContent='<iframe style="margin: 0; border: 0;"></iframe>';afterRender(){const e=this.$el.find("iframe");var t=this.getOption("url"),t=(t&&e.attr("src",t),this.$el.addClass("no-padding"),this.$el.css("overflow","hidden"),this.$el.height());e.css("height",t),e.css("width","100%")}afterAdding(){this.getContainerView().actionOptions()}}e.default=s}),define("views/dashlets/emails",["exports","views/dashlets/abstract/record-list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{name="Emails";scope="Emails";rowActionsView="views/email/record/row-actions/dashlet";listView="views/email/record/list-expanded";setupActionList(){this.getAcl().checkScope(this.scope,"create")&&this.actionList.unshift({name:"compose",text:this.translate("Compose Email","labels",this.scope),iconHtml:'<span class="fas fa-plus"></span>'})}actionCompose(){var e=this.getCreateAttributes()||{},t=(Espo.Ui.notify(" ... "),this.getMetadata().get("clientDefs."+this.scope+".modalViews.compose")||"views/modals/compose-email");this.createView("modal",t,{scope:this.scope,attributes:e},e=>{e.render(),Espo.Ui.notify(!1),this.listenToOnce(e,"after:save",()=>{this.actionRefresh()})})}getSearchData(){return{advanced:[{attribute:"folderId",type:"inFolder",value:this.getOption("folder")||"inbox"}]}}}e.default=s}),define("views/dashlets/options/base",["exports","views/modal","model","views/record/edit-for-modal"],function(e,t,i,s){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),i=a(i),s=a(s);class l extends t.default{template="dashlets/options/base";cssName="options-modal";className="dialog dialog-record";name="";escapeDisabled=!0;saveDisabled=!1;buttonList=[{name:"save",label:"Apply",style:"primary",title:"Ctrl+Enter"},{name:"cancel",label:"Cancel",title:"Esc"}];shortcutKeys={"Control+Enter":"save",Escape:function(t){if(!this.saveDisabled){t.stopPropagation(),t.preventDefault();let e=this.getRecordView().getFocusedFieldView();e&&this.model.set(e.fetch(),{skipReRender:!0}),this.getRecordView().isChanged?this.confirm(this.translate("confirmLeaveOutMessage","messages")).then(()=>this.actionClose()):this.actionClose()}}};data(){return{options:this.optionsData}}getDetailLayout(){let e=this.getMetadata().get(["dashlets",this.name,"options","layout"]);if(e)return e;e=[{rows:[]}];let t=0,i=[];for(var s in this.fields)t%2||(i=[],e[0].rows.push(i)),i.push({name:s}),t++;return e}init(){super.init(),this.fields=Espo.Utils.cloneDeep(this.options.fields),this.fieldList=Object.keys(this.fields),this.optionsData=this.options.optionsData,this.name=this.options.name}setup(){this.id="dashlet-options";let e=this.model=new i.default;e.name="DashletOptions",e.setDefs({fields:this.fields}),e.set(this.optionsData),this.dataObject={dashletName:this.name,userId:this.options.userId},e.dashletName=this.name,e.userId=this.options.userId,this.middlePanelDefs={},this.middlePanelDefsList=[],this.setupBeforeFinal(),this.recordView=new s.default({model:e,detailLayout:this.getDetailLayout(),dataObject:this.dataObject}),this.assignView("record",this.recordView,".record"),this.$header=$("<span>").append($("<span>").text(this.getLanguage().translate("Dashlet Options"))," &middot; ",$("<span>").text(this.getLanguage().translate(this.name,"dashlets")))}setupBeforeFinal(){}onBackdropClick(){this.getRecordView().isChanged||this.close()}getRecordView(){return this.recordView}fetchAttributes(){var e=this.getRecordView().fetch();return this.getRecordView().validate()?null:e}actionSave(){var e=this.fetchAttributes();null!=e&&this.trigger("save",e)}getFieldViews(e){return this.hasView("record")?this.getRecordView().getFieldViews(e):{}}getFieldView(e){return(this.getFieldViews(!0)||{})[e]||null}hideField(e,t){this.getRecordView()?this.getRecordView().hideField(e,t):this.whenRendered().then(()=>this.hideField(e),t)}showField(e){this.getRecordView()?this.getRecordView().showField(e):this.whenRendered().then(()=>this.showField(e))}}e.default=l}),define("views/dashlets/fields/records/sort-direction",["views/fields/enum"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.listenTo(this.model,"change:entityType",()=>{this.setupOptions(),this.reRender()})}})}),define("views/dashlets/fields/records/sort-by",["views/fields/enum"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.listenTo(this.model,"change:entityType",()=>{this.setupOptions(),this.reRender()})},setupOptions:function(){var t,i,e=this.model.get("entityType"),s=e;e?(t=this.getMetadata().get("entityDefs."+s+".fields")||{},e=Object.keys(t).filter(e=>!t[e].notStorable).sort((e,t)=>this.translate(e,"fields",s).localeCompare(this.translate(t,"fields",s))),i={},e.forEach(e=>{i[e]=this.translate(e,"fields",s)}),this.params.options=e,this.translatedOptions=i):this.params.options=[]}})}),define("views/dashlets/fields/records/primary-filter",["views/fields/enum"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.listenTo(this.model,"change:entityType",()=>{this.setupOptions(),this.reRender()})},setupOptions:function(){var e,t=this.model.get("entityType");t?(e=this.getMetadata().get(["clientDefs",t,"filterList"])||[],this.params.options=[],e.forEach(e=>{if("object"==typeof e&&e.name)return!(e.accessDataList&&!Espo.Utils.checkAccessDataList(e.accessDataList,this.getAcl(),this.getUser(),null,!0))&&void this.params.options.push(e.name);this.params.options.push(e)}),this.params.options.unshift("all"),this.translatedOptions={},this.params.options.forEach(e=>{this.translatedOptions[e]=this.translate(e,"presetFilters",t)})):this.params.options=[]}})}),define("views/dashlets/fields/records/expanded-layout",["exports","views/fields/base","ui/multi-select"],function(e,t,l){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),l=i(l);class s extends t.default{listTemplate="dashlets/fields/records/expanded-layout/edit";detailTemplate="dashlets/fields/records/expanded-layout/edit";editTemplate="dashlets/fields/records/expanded-layout/edit";delimiter=":,:";getRowHtml(e,t){let i=[];return(e=e||[]).forEach(e=>{i.push(e.name)}),$("<div>").append($("<input>").attr("type","text").addClass("row-"+t.toString()).attr("value",i.join(this.delimiter))).get(0).outerHTML}afterRender(){this.$container=this.$el.find(">.layout-container");let e=(this.model.get(this.name)||{}).rows||[],a=((e=Espo.Utils.cloneDeep(e)).push([]),this.getFieldDataList());e.forEach((e,t)=>{e=this.getRowHtml(e,t);let i=$(e),s=(this.$container.append(i),i.find("input"));t={items:a,delimiter:this.delimiter,matchAnyWord:this.matchAnyWord,draggable:!0};l.default.init(s,t),s.on("change",()=>{this.trigger("change"),this.reRender()})})}getFieldDataList(){const i=this.model.get("entityType")||this.getMetadata().get(["dashlets",this.dataObject.dashletName,"entityType"]);if(!i)return[];let t=this.getMetadata().get(["entityDefs",i,"fields"])||{},s=this.getAcl().getScopeForbiddenFieldList(i),e=Object.keys(t).sort((e,t)=>this.translate(e,"fields",i).localeCompare(this.translate(t,"fields",i))).filter(e=>!(t[e].disabled||t[e].listLayoutDisabled||t[e].utility)&&(!(t[e].layoutAvailabilityList&&!t[e].layoutAvailabilityList.includes("list"))&&-1===s.indexOf(e))),a=[];return e.forEach(e=>{a.push({value:e,text:this.translate(e,"fields",i)})}),a}fetch(){var a={rows:[]};this.$el.find("input").each((e,t)=>{let i=[],s=($(t).val()||"").split(this.delimiter);0!==(s=1===s.length&&""===s[0]?[]:s).length&&(s.forEach(e=>{let t={name:e};"name"===e&&(t.link=!0),i.push(t)}),a.rows.push(i))});let e={};return e[this.name]=a,e}}e.default=s}),define("views/dashlets/fields/records/entity-type",["views/fields/enum"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.on("change",()=>{var e,t={primaryFilter:null,boolFilterList:[],title:this.translate("Records","dashlets"),sortBy:null,sortDirection:"asc",expandedLayout:{rows:[]}},i=this.model.get("entityType");i&&(t.title=this.translate(i,"scopeNamesPlural"),t.sortBy=this.getMetadata().get(["entityDefs",i,"collection","orderBy"]),e=this.getMetadata().get(["entityDefs",i,"collection","order"]),t.sortDirection=e||"asc",t.expandedLayout={rows:[[{name:"name",link:!0,scope:i}]]}),this.model.set(t)})},setupOptions:function(){this.params.options=Object.keys(this.getMetadata().get("scopes")).filter(e=>{if(!this.getMetadata().get("scopes."+e+".disabled")&&this.getAcl().checkScope(e,"read")&&this.getMetadata().get(["scopes",e,"entity"])&&this.getMetadata().get(["scopes",e,"object"]))return!0}).sort((e,t)=>this.translate(e,"scopeNames").localeCompare(this.translate(t,"scopeNames"))),this.params.options.unshift("")}})}),define("views/dashlets/fields/records/bool-filter-list",["views/fields/multi-enum"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.listenTo(this.model,"change:entityType",()=>{this.setupOptions(),this.reRender()})},setupOptions:function(){var e,t=this.model.get("entityType");t?(e=this.getMetadata().get(["clientDefs",t,"boolFilterList"])||[],this.params.options=[],e.forEach(e=>{if("object"==typeof e&&e.name)return!(e.accessDataList&&!Espo.Utils.checkAccessDataList(e.accessDataList,this.getAcl(),this.getUser(),null,!0))&&void this.params.options.push(e.name);this.params.options.push(e)}),this.getMetadata().get(["scopes",t,"stream"])&&this.getAcl().checkScope(t,"stream")&&this.params.options.push("followed"),this.translatedOptions={},this.params.options.forEach(e=>{this.translatedOptions[e]=this.translate(e,"boolFilters",t)})):this.params.options=[]}})}),define("views/dashlets/fields/emails/folder",["exports","views/fields/enum"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{folderDataList;setup(){super.setup();var e=this.dataObject.userId??this.getUser().id;this.wait(Espo.Ajax.getRequest("EmailFolder/action/listAll",{userId:e}).then(e=>this.folderDataList=e.list).then(()=>this.setupOptions())),this.setupOptions()}setupOptions(){this.folderDataList&&(this.params.options=this.folderDataList.map(e=>e.id).filter(e=>"inbox"!==e&&"trash"!==e),this.params.options.unshift(""),this.translatedOptions={"":this.translate("inbox","presetFilters","Email")},this.folderDataList.forEach(e=>{this.translatedOptions[e.id]=e.name}))}}e.default=s}),define("controllers/user",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getCollection(e){return super.getCollection().then(e=>(e.data.userType="internal",e))}createViewView(e,t,i){t.get("deleted")?super.createViewView(e,t,i="views/deleted-detail"):t.isPortal()?this.getRouter().dispatch("PortalUser","view",{id:t.id,model:t}):t.isApi()?this.getRouter().dispatch("ApiUser","view",{id:t.id,model:t}):super.createViewView(e,t,i)}}e.default=s}),define("controllers/team",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkAccess(e){return"read"===e||!!this.getUser().isAdmin()}}e.default=s}),define("controllers/stream",["exports","controller"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{defaultAction="index";actionIndex(){this.main("views/stream",{displayTitle:!0},e=>{e.render()})}actionPosts(){this.main("views/stream",{displayTitle:!0,filter:"posts"},e=>{e.render()})}actionUpdates(){this.main("views/stream",{displayTitle:!0,filter:"updates"},e=>{e.render()})}}e.default=s}),define("controllers/record-tree",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{defaultAction="listTree";beforeView(e){super.beforeView(e),(e=e||{}).model&&(e.model.unset("childCollection"),e.model.unset("childList"))}beforeListTree(){this.handleCheckAccess("read")}actionListTree(){this.getCollection().then(e=>{e.url=e.entityType+"/action/listTree",this.main(this.getViewName("listTree"),{scope:this.name,collection:e})})}}e.default=s}),define("controllers/preferences",["exports","controllers/record","models/preferences"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{defaultAction="own";getModel(e,t){let i=new s.default;return i.settings=this.getConfig(),i.defs=this.getMetadata().get("entityDefs.Preferences"),e&&e.call(this,i),new Promise(e=>{e(i)})}checkAccess(e){return!0}actionOwn(){this.actionEdit({id:this.getUser().id})}actionList(){}}e.default=a}),define("controllers/portal-user",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{entityType="User";getCollection(e){return super.getCollection().then(e=>(e.data.userType="portal",e))}createViewView(e,t,i){if(!t.isPortal())return t.isApi()?void this.getRouter().dispatch("ApiUser","view",{id:t.id,model:t}):void this.getRouter().dispatch("User","view",{id:t.id,model:t});super.createViewView(e,t,i)}actionCreate(e){(e=e||{}).attributes=e.attributes||{},e.attributes.type="portal",super.actionCreate(e)}checkAccess(e){return"yes"===this.getAcl().getPermissionLevel("portalPermission")}}e.default=s}),define("controllers/password-change-request",["exports","controller"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{actionPasswordChange(e){if(!(e=e||{}).id)throw new Error;this.entire("views/user/password-change-request",{requestId:e.id,strengthParams:e.strengthParams,notFound:e.notFound},e=>{e.render()})}}e.default=s}),define("controllers/notification",["exports","controller"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{defaultAction="index";actionIndex(){this.main("views/notification/list",{},e=>{e.render()})}}e.default=s}),define("controllers/note",["exports","controller"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{actionView(e){let t=e.id;if(!t)throw new Espo.Exceptions.NotFound;let i=this.getMetadata().get(["clientDefs",this.name,"views","detail"])||"views/note/detail",s;this.showLoadingNotification(),this.modelFactory.create("Note").then(e=>((s=e).id=t,s.fetch({main:!0}))).then(()=>{this.hideLoadingNotification(),this.main(i,{model:s})})}}e.default=s}),define("controllers/login-as",["exports","controller"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{actionLogin(e){var t=e.anotherUser,e=e.username;if(!t)throw new Error("No anotherUser.");this.baseController.login({anotherUser:t,username:e}),this.listenToOnce(this.baseController,"login",()=>{this.baseController.once("router-set",()=>{var e=window.location.href.split("?")[0];window.location.replace(e)})})}}e.default=s}),define("controllers/lead-capture-opt-in-confirmation",["exports","controller"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{actionOptInConfirmationSuccess(e){var t=this.getMetadata().get(["clientDefs","LeadCapture","optInConfirmationSuccessView"])||"views/lead-capture/opt-in-confirmation-success";this.entire(t,{resultData:e},e=>{e.render()})}actionOptInConfirmationExpired(e){var t=this.getMetadata().get(["clientDefs","LeadCapture","optInConfirmationExpiredView"])||"views/lead-capture/opt-in-confirmation-expired";this.entire(t,{resultData:e},e=>{e.render()})}}e.default=s}),define("controllers/last-viewed",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{entityType="ActionHistoryRecord";checkAccess(e){return this.getAcl().check(this.entityType,e)}}e.default=s}),define("controllers/import",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{defaultAction="index";checkAccessGlobal(){return!!this.getAcl().checkScope("Import")}checkAccess(e){return!!this.getAcl().checkScope("Import")}actionIndex(e){let t=null,i=((e=e||{}).step&&(t=parseInt(t)),null),s=null;this.storedData&&(i=this.storedData.formData,s=this.storedData.fileContents),i||(t=null),i=i||e.formData,this.main("views/import/index",{step:t,formData:i,fileContents:s,fromAdmin:e.fromAdmin},e=>{this.listenTo(e,"change",()=>{this.storedData={formData:e.formData,fileContents:e.fileContents}}),this.listenTo(e,"done",()=>{delete this.storedData}),e.render()})}}e.default=s}),define("controllers/home",["exports","controller"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{actionIndex(){this.main("views/home",null)}}e.default=s}),define("controllers/external-account",["exports","controller"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{defaultAction="list";actionList(){this.collectionFactory.create("ExternalAccount",e=>{e.once("sync",()=>{this.main("ExternalAccount.Index",{collection:e})}),e.fetch()})}actionEdit(e){let t=e.id;this.collectionFactory.create("ExternalAccount",e=>{e.once("sync",()=>{this.main("ExternalAccount.Index",{collection:e,id:t})}),e.fetch()})}}e.default=s}),define("controllers/email",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{prepareModelView(e,t){super.prepareModelView(e,t),this.listenToOnce(e,"after:send",()=>{var e=this.name+"List";this.getStoredMainView(e)&&this.clearStoredMainView(e)})}}e.default=s}),define("controllers/dashboard",["exports","controller"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{defaultAction="index";actionIndex(){this.main("views/dashboard",{displayTitle:!0},e=>{e.render()})}}e.default=s}),define("controllers/address-map",["exports","controller"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{defaultAction="index";actionIndex(){this.error404()}actionView(i){this.modelFactory.create(i.entityType).then(t=>{t.id=i.id,t.fetch().then(()=>{var e=this.getMetadata().get(["AddressMap","view"])||"views/address-map/view";this.main(e,{model:t,field:i.field})})})}}e.default=s}),define("controllers/about",["exports","controller"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{defaultAction="about";actionAbout(){this.main("About",{},e=>{e.render()})}}e.default=s}),define("collections/tree",["exports","collection"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{createSeed(){let e=new this.constructor;return e.url=this.url,e.model=this.model,e.name=this.name,e.entityType=this.entityType,e.defs=this.defs,e}prepareAttributes(e,t){t=super.prepareAttributes(e,t);let i=this.clone(),s=(i.reset(),this.path=e.path,this.categoryData=e.data||null,(e,i)=>{e.forEach(e=>{e.depth=i;let t=this.createSeed();if(e.childList)return e.childList.length&&(s(e.childList,i+1),t.set(e.childList)),void(e.childCollection=t);null!==e.childList?e.childCollection=t:e.childCollection=null})});return s(t,0),t}fetch(e){return(e=e||{}).data=e.data||{},this.parentId&&(e.data.parentId=this.parentId),e.data.maxDepth=this.maxDepth,super.fetch(e)}}e.default=s}),define("collections/note",["exports","collection"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{prepareAttributes(e,t){var i=this.total,s=super.prepareAttributes(e,t);return t.data&&t.data.after&&(0<=i&&0<=e.total?this.total=i+e.total:this.total=i),s}fetchNew(e){return(e=e||{}).data=e.data||{},e.fetchNew=!0,e.noRebuild=!0,e.lengthBeforeFetch=this.length,this.length&&(e.data.after=this.models[0].get("createdAt"),e.remove=!1,e.at=0,e.maxSize=null),this.fetch(e)}}e.default=s}),define("acl/user",["exports","acl"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkModelRead(e,t,i){return!(!e.isPortal()||"yes"!==this.get("portalPermission"))||this.checkModel(e,t,"read",i)}checkIsOwner(e){return this.getUser().id===e.id}}e.default=s}),define("acl/team",["exports","acl"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkInTeam(e){const t=this.getUser().getTeamIdList();return-1!==t.indexOf(e.id)}}e.default=s}),define("acl/preferences",["exports","acl"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkIsOwner(e){return this.getUser().id===e.id}}e.default=s}),define("acl/notification",["exports","acl"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkIsOwner(e){return this.getUser().id===e.get("userId")}}e.default=s}),define("acl/import",["exports","acl"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkScope(e,t,i,s){return!!e}checkModelRead(e,t,i){return!0}checkIsOwner(e){return this.getUser().id===e.get("createdById")}checkModelDelete(e,t,i){return!0}}e.default=s}),define("acl/foreign",["exports","acl"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkIsOwner(e){return!0}checkInTeam(e){return!0}}e.default=s}),define("acl/email",["exports","acl"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkModelRead(e,t,i){var s=this.checkModel(e,t,"read",i);if(s)return!0;if(!1===t)return!1;if("no"===(t||{}).read)return!1;if(e.has("usersIds")){if(~(e.get("usersIds")||[]).indexOf(this.getUser().id))return!0}else if(i)return null;return s}checkIsOwner(e){return this.getUser().id===e.get("assignedUserId")||this.getUser().id===e.get("createdById")||(e.has("assignedUsersIds")?!!~(e.get("assignedUsersIds")||[]).indexOf(this.getUser().id):null)}checkModelEdit(e,t,i){return"Draft"===e.get("status")&&e.get("createdById")===this.getUser().id||this.checkModel(e,t,"edit",i)}checkModelDelete(e,t,i){i=this.checkModel(e,t,"delete",i);return!!i||!1!==t&&("no"!==(t||{}).read&&(e.get("createdById")===this.getUser().id&&"Sent"!==e.get("status")&&"Archived"!==e.get("status")||i))}}e.default=s}),Espo.loader.mapBundleFile("admin","client/lib/espo-admin.js"),Espo.loader.mapBundleFile("crm","client/lib/espo-crm.js"),Espo.loader.mapBundleDependencies("chart",["flotr2","espo-funnel-chart"]),Espo.loader.mapBundleFile("chart","client/lib/espo-chart.js"),Espo.loader.mapBundleDependencies("calendar",["fullcalendar"]),Espo.loader.mapBundleFile("calendar","client/lib/espo-calendar.js"),Espo.loader.mapBundleDependencies("timeline",["vis-data","vis-timeline"]),Espo.loader.mapBundleFile("timeline","client/lib/espo-timeline.js"),Espo.loader.mapBundleFile("extra","client/lib/espo-extra.js"),Espo.loader.addBundleMapping({"views/admin/layouts/base":"admin","views/admin/layouts/rows":"admin","views/admin/layouts/side-panels-detail":"admin","views/admin/dynamic-logic/conditions-string/item-base":"admin","views/admin/layouts/grid":"admin","views/admin/layouts/default-page":"admin","views/admin/layouts/bottom-panels-detail":"admin","views/admin/layouts/modals/create":"admin","views/admin/dynamic-logic/conditions-string/item-operator-only-base":"admin","views/outbound-email/fields/test-send":"admin","views/role/record/table":"admin","views/role/record/list":"admin","views/role/record/edit":"admin","views/role/record/detail":"admin","views/inbound-email/record/detail":"admin","views/admin/index":"admin","views/admin/link-manager/index":"admin","views/admin/layouts/list":"admin","views/admin/layouts/index":"admin","views/admin/layouts/detail":"admin","views/admin/layouts/bottom-panels-edit":"admin","views/admin/integrations/edit":"admin","views/admin/field-manager/fields/options":"admin","views/admin/entity-manager/record/edit-formula":"admin","views/admin/entity-manager/modals/export":"admin","views/admin/dynamic-logic/conditions-string/item-operator-only-date":"admin","views/admin/dynamic-logic/conditions-string/group-base":"admin","views/admin/dynamic-logic/conditions/group-base":"admin","views/admin/dynamic-logic/conditions/field-types/base":"admin","views/email-account/fields/test-send":"admin","views/email-account/fields/test-connection":"admin","views/email-account/fields/folders":"admin","views/email-account/fields/folder":"admin","helpers/misc/authentication-provider":"admin","views/settings/record/edit":"admin","views/settings/edit":"admin","views/templates/event/record/detail":"admin","views/scheduled-job/list":"admin","views/scheduled-job/record/list":"admin","views/scheduled-job/record/detail":"admin","views/scheduled-job/record/panels/log":"admin","views/scheduled-job/fields/scheduling":"admin","views/scheduled-job/fields/job":"admin","views/role/list":"admin","views/role/record/detail-side":"admin","views/role/record/panels/side":"admin","views/role/modals/add-field":"admin","views/portal-role/list":"admin","views/portal-role/record/table":"admin","views/portal-role/record/list":"admin","views/portal-role/record/edit":"admin","views/portal-role/record/detail":"admin","views/lead-capture-log-record/modals/detail":"admin","views/lead-capture/opt-in-confirmation-success":"admin","views/lead-capture/opt-in-confirmation-expired":"admin","views/lead-capture/record/list":"admin","views/lead-capture/record/detail":"admin","views/lead-capture/record/panels/request":"admin","views/lead-capture/fields/smtp-account":"crm","views/lead-capture/fields/field-list":"admin","views/lead-capture/fields/api-key":"admin","views/layout-set/layouts":"admin","views/layout-set/record/list":"admin","views/layout-set/fields/layout-list":"admin","views/layout-set/fields/edit":"admin","views/inbound-email/record/list":"admin","views/inbound-email/record/edit":"admin","views/inbound-email/fields/test-send":"admin","views/inbound-email/fields/test-connection":"admin","views/inbound-email/fields/target-user-position":"admin","views/inbound-email/fields/folders":"admin","views/inbound-email/fields/folder":"admin","views/inbound-email/fields/email-address":"admin","views/authentication-provider/record/edit":"admin","views/authentication-provider/record/detail":"admin","views/authentication-provider/fields/method":"admin","views/admin/user-interface":"admin","views/admin/sms":"admin","views/admin/settings":"admin","views/admin/outbound-emails":"admin","views/admin/notifications":"admin","views/admin/jobs-settings":"admin","views/admin/inbound-emails":"admin","views/admin/currency":"admin","views/admin/authentication":"admin","views/admin/upgrade/ready":"admin","views/admin/upgrade/index":"admin","views/admin/upgrade/done":"admin","views/admin/template-manager/index":"admin","views/admin/template-manager/edit":"admin","views/admin/system-requirements/index":"admin","views/admin/panels/notifications":"admin","views/admin/link-manager/modals/edit":"admin","views/admin/link-manager/fields/foreign-link-entity-type-list":"admin","views/admin/layouts/side-panels-edit":"admin","views/admin/layouts/side-panels-edit-small":"admin","views/admin/layouts/side-panels-detail-small":"admin","views/admin/layouts/relationships":"admin","views/admin/layouts/mass-update":"admin","views/admin/layouts/list-small":"admin","views/admin/layouts/kanban":"admin","views/admin/layouts/filters":"admin","views/admin/layouts/detail-small":"admin","views/admin/layouts/detail-convert":"admin","views/admin/layouts/default-side-panel":"admin","views/admin/layouts/bottom-panels-edit-small":"admin","views/admin/layouts/record/edit-attributes":"admin","views/admin/layouts/modals/panel-attributes":"admin","views/admin/layouts/modals/edit-attributes":"admin","views/admin/label-manager/index":"admin","views/admin/label-manager/edit":"admin","views/admin/label-manager/category":"admin","views/admin/job/list":"admin","views/admin/job/record/list":"admin","views/admin/job/record/detail-small":"admin","views/admin/job/modals/detail":"admin","views/admin/job/fields/name":"admin","views/admin/integrations/oauth2":"admin","views/admin/integrations/index":"admin","views/admin/integrations/google-maps":"admin","views/admin/formula-sandbox/index":"admin","views/admin/formula-sandbox/record/edit":"admin","views/admin/formula/modals/add-function":"admin","views/admin/formula/modals/add-attribute":"admin","views/admin/formula/fields/attribute":"admin","views/admin/field-manager/list":"admin","views/admin/field-manager/index":"admin","views/admin/field-manager/header":"admin","views/admin/field-manager/edit":"admin","views/admin/field-manager/modals/add-field":"admin","views/admin/field-manager/fields/source-list":"admin","views/admin/field-manager/fields/pattern":"admin","views/admin/field-manager/fields/options-with-style":"admin","views/admin/field-manager/fields/options-reference":"admin","views/admin/field-manager/fields/not-actual-options":"admin","views/admin/field-manager/fields/entity-list":"admin","views/admin/field-manager/fields/dynamic-logic-options":"admin","views/admin/field-manager/fields/dynamic-logic-conditions":"admin","views/admin/field-manager/fields/currency-default":"admin","views/admin/field-manager/fields/phone/default":"admin","views/admin/field-manager/fields/options/default":"admin","views/admin/field-manager/fields/link-multiple/default":"admin","views/admin/field-manager/fields/link/default":"admin","views/admin/field-manager/fields/foreign/link":"admin","views/admin/field-manager/fields/foreign/field":"admin","views/admin/field-manager/fields/date/default":"admin","views/admin/field-manager/fields/date/after-before":"admin","views/admin/extensions/ready":"admin","views/admin/extensions/index":"admin","views/admin/extensions/done":"admin","views/admin/entity-manager/scope":"admin","views/admin/entity-manager/index":"admin","views/admin/entity-manager/formula":"admin","views/admin/entity-manager/edit":"admin","views/admin/entity-manager/record/edit":"admin","views/admin/entity-manager/modals/select-icon":"admin","views/admin/entity-manager/modals/select-formula":"admin","views/admin/entity-manager/fields/icon-class":"admin","views/admin/entity-manager/fields/duplicate-check-field-list":"admin","views/admin/dynamic-logic/modals/edit":"admin","views/admin/dynamic-logic/modals/add-field":"admin","views/admin/dynamic-logic/fields/field":"admin","views/admin/dynamic-logic/conditions-string/item-value-varchar":"admin","views/admin/dynamic-logic/conditions-string/item-value-link":"admin","views/admin/dynamic-logic/conditions-string/item-value-enum":"admin","views/admin/dynamic-logic/conditions-string/item-multiple-values-base":"admin","views/admin/dynamic-logic/conditions-string/item-is-today":"admin","views/admin/dynamic-logic/conditions-string/item-in-past":"admin","views/admin/dynamic-logic/conditions-string/item-in-future":"admin","views/admin/dynamic-logic/conditions-string/group-not":"admin","views/admin/dynamic-logic/conditions/or":"admin","views/admin/dynamic-logic/conditions/not":"admin","views/admin/dynamic-logic/conditions/and":"admin","views/admin/dynamic-logic/conditions/field-types/multi-enum":"admin","views/admin/dynamic-logic/conditions/field-types/link":"admin","views/admin/dynamic-logic/conditions/field-types/link-parent":"admin","views/admin/dynamic-logic/conditions/field-types/link-multiple":"admin","views/admin/dynamic-logic/conditions/field-types/enum":"admin","views/admin/dynamic-logic/conditions/field-types/date":"admin","views/admin/complex-expression/modals/add-function":"admin","views/admin/authentication/fields/test-connection":"admin","views/admin/auth-token/list":"admin","views/admin/auth-token/record/list":"admin","views/admin/auth-token/record/detail":"admin","views/admin/auth-token/record/detail-small":"admin","views/admin/auth-token/record/row-actions/default":"admin","views/admin/auth-token/modals/detail":"admin","views/admin/auth-log-record/list":"admin","views/admin/auth-log-record/record/list":"admin","views/admin/auth-log-record/record/detail":"admin","views/admin/auth-log-record/record/detail-small":"admin","views/admin/auth-log-record/modals/detail":"admin","controllers/role":"admin","controllers/portal-role":"admin","controllers/layout-set":"admin","controllers/inbound-email":"admin","controllers/api-user":"admin","controllers/admin":"admin","modules/crm/views/meeting/fields/attendees":"crm","modules/crm/views/meeting/fields/contacts":"crm","modules/crm/knowledge-base-helper":"crm","modules/crm/views/task/record/list":"crm","modules/crm/views/record/panels/tasks":"crm","modules/crm/views/record/panels/activities":"crm","modules/crm/views/opportunity/record/edit":"crm","modules/crm/views/meeting/detail":"crm","modules/crm/views/meeting/record/list":"crm","modules/crm/views/mass-email/record/edit":"crm","modules/crm/views/document/modals/select-records":"crm","modules/crm/views/dashlets/options/chart":"crm","modules/crm/views/contact/record/detail":"crm","modules/crm/views/call/record/list":"crm","modules/crm/views/call/fields/contacts":"crm","modules/crm/acl/meeting":"crm","views/notification/items/base":"crm","handlers/create-related":"crm","modules/crm/views/user/record/panels/tasks":"crm","modules/crm/views/task/list":"crm","modules/crm/views/task/detail":"crm","modules/crm/views/task/record/list-expanded":"crm","modules/crm/views/task/record/detail":"crm","modules/crm/views/task/record/row-actions/default":"crm","modules/crm/views/task/record/row-actions/dashlet":"crm","modules/crm/views/task/modals/detail":"crm","modules/crm/views/task/fields/priority-for-dashlet":"crm","modules/crm/views/task/fields/is-overdue":"crm","modules/crm/views/task/fields/date-end":"crm","modules/crm/views/target-list/record/detail":"crm","modules/crm/views/target-list/record/row-actions/opted-out":"crm","modules/crm/views/target-list/record/row-actions/default":"crm","modules/crm/views/target-list/record/panels/relationship":"crm","modules/crm/views/target-list/record/panels/opted-out":"crm","modules/crm/views/target-list/fields/target-status":"crm","modules/crm/views/target-list/fields/including-action-list":"crm","modules/crm/views/stream/notes/event-confirmation":"crm","modules/crm/views/record/list-activities-dashlet":"crm","modules/crm/views/record/row-actions/tasks":"crm","modules/crm/views/record/row-actions/relationship-target":"crm","modules/crm/views/record/row-actions/history":"crm","modules/crm/views/record/row-actions/activities":"crm","modules/crm/views/record/row-actions/activities-dashlet":"crm","modules/crm/views/record/panels/target-lists":"crm","modules/crm/views/record/panels/history":"crm","modules/crm/views/opportunity/detail":"crm","modules/crm/views/opportunity/record/list":"crm","modules/crm/views/opportunity/record/kanban":"crm","modules/crm/views/opportunity/record/edit-small":"crm","modules/crm/views/opportunity/record/panels/activities":"crm","modules/crm/views/opportunity/fields/stage":"crm","modules/crm/views/opportunity/fields/lead-source":"crm","modules/crm/views/opportunity/fields/last-stage":"crm","modules/crm/views/opportunity/fields/contacts":"crm","modules/crm/views/opportunity/fields/contact-role":"crm","modules/crm/views/opportunity/admin/field-manager/fields/probability-map":"crm","modules/crm/views/notification/items/event-attendee":"crm","modules/crm/views/meeting/popup-notification":"crm","modules/crm/views/meeting/record/list-expanded":"crm","modules/crm/views/meeting/record/edit-small":"crm","modules/crm/views/meeting/record/detail":"crm","modules/crm/views/meeting/record/row-actions/default":"crm","modules/crm/views/meeting/record/row-actions/dashlet":"crm","modules/crm/views/meeting/record/panels/scheduler":"crm","modules/crm/views/meeting/record/panels/attendees":"crm","modules/crm/views/meeting/modals/send-invitations":"crm","modules/crm/views/meeting/modals/send-cancellation":"crm","modules/crm/views/meeting/modals/detail":"crm","modules/crm/views/meeting/modals/acceptance-status":"crm","modules/crm/views/meeting/fields/users":"crm","modules/crm/views/meeting/fields/reminders":"crm","modules/crm/views/meeting/fields/date-start":"crm","modules/crm/views/meeting/fields/date-end":"crm","modules/crm/views/meeting/fields/acceptance-status":"crm","modules/crm/views/mass-email/detail":"crm","modules/crm/views/mass-email/record/list-for-campaign":"crm","modules/crm/views/mass-email/record/edit-small":"crm","modules/crm/views/mass-email/record/detail":"crm","modules/crm/views/mass-email/record/detail-bottom":"crm","modules/crm/views/mass-email/record/row-actions/for-campaign":"crm","modules/crm/views/mass-email/modals/send-test":"crm","modules/crm/views/mass-email/fields/smtp-account":"crm","modules/crm/views/mass-email/fields/from-address":"crm","modules/crm/views/mass-email/fields/email-template":"crm","modules/crm/views/lead/detail":"crm","modules/crm/views/lead/convert":"crm","modules/crm/views/lead/record/detail":"crm","modules/crm/views/lead/record/detail-side":"crm","modules/crm/views/lead/record/panels/converted-to":"crm","modules/crm/views/lead/fields/industry":"crm","modules/crm/views/lead/fields/created-opportunity":"crm","modules/crm/views/lead/fields/created-contact":"crm","modules/crm/views/lead/fields/acceptance-status":"crm","modules/crm/views/knowledge-base-article/list":"crm","modules/crm/views/knowledge-base-article/record/list":"crm","modules/crm/views/knowledge-base-article/record/list-for-case":"crm","modules/crm/views/knowledge-base-article/record/edit":"crm","modules/crm/views/knowledge-base-article/record/edit-quick":"crm","modules/crm/views/knowledge-base-article/record/detail":"crm","modules/crm/views/knowledge-base-article/record/detail-quick":"crm","modules/crm/views/knowledge-base-article/record/row-actions/for-case":"crm","modules/crm/views/knowledge-base-article/record/row-actions/default":"crm","modules/crm/views/knowledge-base-article/modals/select-records":"crm","modules/crm/views/knowledge-base-article/fields/status":"crm","modules/crm/views/knowledge-base-article/fields/language":"crm","modules/crm/views/fields/ico":"crm","modules/crm/views/event-confirmation/confirmation":"crm","modules/crm/views/email-queue-item/list":"crm","modules/crm/views/email-queue-item/record/list":"crm","modules/crm/views/document/list":"crm","modules/crm/views/document/fields/name":"crm","modules/crm/views/document/fields/file":"crm","modules/crm/views/dashlets/tasks":"crm","modules/crm/views/dashlets/meetings":"crm","modules/crm/views/dashlets/calls":"crm","modules/crm/views/dashlets/calendar":"crm","modules/crm/views/dashlets/activities":"crm","modules/crm/views/dashlets/options/sales-pipeline":"crm","modules/crm/views/dashlets/options/calendar":"crm","modules/crm/views/dashlets/options/activities":"crm","modules/crm/views/dashlets/options/sales-pipeline/fields/team":"crm","modules/crm/views/contact/detail":"crm","modules/crm/views/contact/record/detail-small":"crm","modules/crm/views/contact/modals/select-for-portal-user":"crm","modules/crm/views/contact/fields/title":"crm","modules/crm/views/contact/fields/opportunity-role":"crm","modules/crm/views/contact/fields/name-for-account":"crm","modules/crm/views/contact/fields/accounts":"crm","modules/crm/views/contact/fields/account":"crm","modules/crm/views/contact/fields/account-role":"crm","modules/crm/views/case/record/detail":"crm","modules/crm/views/case/record/panels/activities":"crm","modules/crm/views/case/fields/contacts":"crm","modules/crm/views/case/fields/contact":"crm","modules/crm/views/campaign-tracking-url/record/edit":"crm","modules/crm/views/campaign-tracking-url/record/edit-small":"crm","modules/crm/views/campaign-log-record/fields/data":"crm","modules/crm/views/campaign/unsubscribe":"crm","modules/crm/views/campaign/tracking-url":"crm","modules/crm/views/campaign/subscribe-again":"crm","modules/crm/views/campaign/detail":"crm","modules/crm/views/campaign/record/detail":"crm","modules/crm/views/campaign/record/detail-bottom":"crm","modules/crm/views/campaign/record/panels/campaign-stats":"crm","modules/crm/views/campaign/record/panels/campaign-log-records":"crm","modules/crm/views/campaign/modals/mail-merge-pdf":"crm","modules/crm/views/campaign/fields/template":"crm","modules/crm/views/campaign/fields/int-with-percentage":"crm","modules/crm/views/call/detail":"crm","modules/crm/views/call/record/list-expanded":"crm","modules/crm/views/call/record/edit-small":"crm","modules/crm/views/call/record/detail":"crm","modules/crm/views/call/record/row-actions/default":"crm","modules/crm/views/call/record/row-actions/dashlet":"crm","modules/crm/views/call/fields/leads":"crm","modules/crm/views/call/fields/date-end":"crm","modules/crm/views/calendar/mode-buttons":"crm","modules/crm/views/calendar/calendar-page":"crm","modules/crm/views/calendar/record/shared-options":"crm","modules/crm/views/calendar/record/edit-view":"crm","modules/crm/views/calendar/modals/shared-options":"crm","modules/crm/views/calendar/modals/edit":"crm","modules/crm/views/calendar/modals/edit-view":"crm","modules/crm/views/calendar/fields/users":"crm","modules/crm/views/calendar/fields/teams":"crm","modules/crm/views/admin/entity-manager/fields/status-list":"crm","modules/crm/views/activities/list":"crm","modules/crm/views/account/detail":"crm","modules/crm/views/account/fields/shipping-address":"crm","modules/crm/view-setup-handlers/document/record-list-drag-n-drop":"crm","modules/crm/handlers/opportunity/contacts-create":"crm","modules/crm/handlers/campaign/mass-emails-create":"crm","modules/crm/controllers/unsubscribe":"crm","modules/crm/controllers/tracking-url":"crm","modules/crm/controllers/lead":"crm","modules/crm/controllers/event-confirmation":"crm","modules/crm/controllers/calendar":"crm","modules/crm/controllers/activities":"crm","modules/crm/acl-portal/document":"crm","modules/crm/acl-portal/contact":"crm","modules/crm/acl-portal/account":"crm","modules/crm/acl/mass-email":"crm","modules/crm/acl/campaign-tracking-url":"crm","modules/crm/acl/call":"crm","modules/crm/views/dashlets/abstract/chart":"chart","modules/crm/views/dashlets/sales-pipeline":"chart","modules/crm/views/dashlets/sales-by-month":"chart","modules/crm/views/dashlets/opportunities-by-stage":"chart","modules/crm/views/dashlets/opportunities-by-lead-source":"chart","modules/crm/views/calendar/calendar":"calendar","modules/crm/views/scheduler/scheduler":"timeline","modules/crm/views/calendar/timeline":"timeline","views/email/record/detail":"extra","views/email/fields/email-address":"extra","views/user/record/detail":"extra","views/user/record/detail-side":"extra","views/settings/fields/theme":"extra","views/settings/fields/tab-list":"extra","views/settings/fields/quick-create-list":"extra","views/import/record/panels/imported":"extra","views/email-template/record/detail":"extra","views/email-account/record/detail":"extra","views/email/detail":"extra","views/email/record/list":"extra","views/email/record/edit":"extra","views/email/fields/person-string-data":"extra","views/email/fields/from-address-varchar":"extra","helpers/misc/field-language":"extra","handlers/select-related":"extra","handlers/login":"extra","views/wysiwyg/modals/insert-link":"extra","views/wysiwyg/modals/insert-image":"extra","views/working-time-range/fields/users":"extra","views/working-time-range/fields/date-end":"extra","views/working-time-calendar/fields/time-ranges":"extra","views/working-time-calendar/fields/time-ranges/item-edit":"extra","views/working-time-calendar/fields/time-ranges/item-detail":"extra","views/webhook/record/list":"extra","views/webhook/fields/user":"extra","views/webhook/fields/event":"extra","views/user-security/modals/two-factor-sms":"extra","views/user-security/modals/two-factor-email":"extra","views/user-security/modals/totp":"extra","views/user/password-change-request":"extra","views/user/list":"extra","views/user/detail":"extra","views/user/record/list":"extra","views/user/record/edit":"extra","views/user/record/edit-side":"extra","views/user/record/edit-quick":"extra","views/user/record/detail-quick":"extra","views/user/record/detail-quick-side":"extra","views/user/record/detail-bottom":"extra","views/user/record/row-actions/relationship-followers":"extra","views/user/record/row-actions/default":"extra","views/user/record/panels/stream":"extra","views/user/record/panels/default-side":"extra","views/user/modals/select-followers":"extra","views/user/modals/security":"extra","views/user/modals/password":"extra","views/user/modals/mass-update":"extra","views/user/modals/login-as":"extra","views/user/modals/detail":"extra","views/user/modals/access":"extra","views/user/fields/user-name":"extra","views/user/fields/teams":"extra","views/user/fields/password":"extra","views/user/fields/name":"extra","views/user/fields/generate-password":"extra","views/user/fields/contact":"extra","views/user/fields/avatar":"extra","views/user/fields/auto-follow-entity-type-list":"extra","views/template/record/edit":"extra","views/template/record/detail":"extra","views/template/fields/variables":"extra","views/template/fields/font-face":"extra","views/template/fields/entity-type":"extra","views/template/fields/body":"extra","views/team/record/list":"extra","views/team/record/edit":"extra","views/team/record/detail":"extra","views/team/modals/detail":"extra","views/site-portal/navbar":"extra","views/site-portal/master":"extra","views/site-portal/header":"extra","views/settings/modals/tab-list-field-add":"extra","views/settings/modals/edit-tab-group":"extra","views/settings/modals/edit-tab-divider":"extra","views/settings/fields/time-format":"extra","views/settings/fields/thousand-separator":"extra","views/settings/fields/stream-email-notifications-entity-list":"extra","views/settings/fields/sms-provider":"extra","views/settings/fields/pdf-engine":"extra","views/settings/fields/outbound-email-from-address":"extra","views/settings/fields/oidc-teams":"extra","views/settings/fields/oidc-redirect-uri":"extra","views/settings/fields/language":"extra","views/settings/fields/history-entity-list":"extra","views/settings/fields/group-tab-list":"extra","views/settings/fields/global-search-entity-list":"extra","views/settings/fields/fiscal-year-shift":"extra","views/settings/fields/email-address-lookup-entity-type-list":"extra","views/settings/fields/default-currency":"extra","views/settings/fields/date-format":"extra","views/settings/fields/dashboard-layout":"extra","views/settings/fields/currency-rates":"extra","views/settings/fields/currency-list":"extra","views/settings/fields/calendar-entity-list":"extra","views/settings/fields/busy-ranges-entity-list":"extra","views/settings/fields/authentication-method":"extra","views/settings/fields/auth-two-fa-method-list":"extra","views/settings/fields/assignment-notifications-entity-list":"extra","views/settings/fields/assignment-email-notifications-entity-list":"extra","views/settings/fields/address-preview":"extra","views/settings/fields/activities-entity-list":"extra","views/preferences/edit":"extra","views/preferences/record/edit":"extra","views/preferences/fields/week-start":"extra","views/preferences/fields/time-zone":"extra","views/preferences/fields/time-format":"extra","views/preferences/fields/theme":"extra","views/preferences/fields/tab-list":"extra","views/preferences/fields/signature":"extra","views/preferences/fields/language":"extra","views/preferences/fields/default-currency":"extra","views/preferences/fields/date-format":"extra","views/preferences/fields/dashboard-tab-list":"extra","views/preferences/fields/auto-follow-entity-type-list":"extra","views/preferences/fields/assignment-notifications-ignore-entity-type-list":"extra","views/preferences/fields/assignment-email-notifications-ignore-entity-type-list":"extra","views/portal-user/list":"extra","views/portal/record/list":"extra","views/portal/fields/tab-list":"extra","views/portal/fields/quick-create-list":"extra","views/portal/fields/custom-id":"extra","views/personal-data/record/record":"extra","views/personal-data/modals/personal-data":"extra","views/outbound-email/modals/test-send":"extra","views/notification/record/list":"extra","views/notification/items/system":"extra","views/notification/items/message":"extra","views/notification/items/entity-removed":"extra","views/notification/items/email-received":"extra","views/notification/items/assign":"extra","views/notification/fields/read":"extra","views/notification/fields/read-with-menu":"extra","views/notification/fields/container":"extra","views/last-viewed/list":"extra","views/last-viewed/record/list":"extra","views/import-error/fields/validation-failures":"extra","views/import-error/fields/line-number":"extra","views/import/step2":"extra","views/import/step1":"extra","views/import/list":"extra","views/import/index":"extra","views/import/detail":"extra","views/import/record/list":"extra","views/import/record/detail":"extra","views/import/record/row-actions/duplicates":"extra","views/import/record/panels/updated":"extra","views/import/record/panels/duplicates":"extra","views/group-email-folder/record/list":"extra","views/group-email-folder/record/row-actions/default":"extra","views/external-account/oauth2":"extra","views/external-account/index":"extra","views/extension/record/row-actions":"extra","views/extension/record/list":"extra","views/export/record/record":"extra","views/export/modals/idle":"extra","views/export/modals/export":"extra","views/event/fields/name-for-history":"extra","views/email-template/list":"extra","views/email-template/record/edit":"extra","views/email-template/record/edit-quick":"extra","views/email-template/record/panels/information":"extra","views/email-template/fields/insert-field":"extra","views/email-template/fields/body":"extra","views/email-folder/list":"extra","views/email-folder/list-side":"extra","views/email-folder/record/list":"extra","views/email-folder/record/row-actions/default":"extra","views/email-folder/modals/select-folder":"extra","views/email-filter/record/list":"extra","views/email-filter/modals/edit":"extra","views/email-filter/fields/parent":"extra","views/email-filter/fields/email-folder":"extra","views/email-filter/fields/action":"extra","views/email-account/list":"extra","views/email-account/record/list":"extra","views/email-account/record/edit":"extra","views/email-account/modals/select-folder":"extra","views/email-account/fields/email-folder":"extra","views/email-account/fields/email-address":"extra","views/email/list":"extra","views/email/record/list-related":"extra","views/email/record/list-expanded":"extra","views/email/record/edit-quick":"extra","views/email/record/detail-side":"extra","views/email/record/detail-quick":"extra","views/email/record/compose":"extra","views/email/record/row-actions/default":"extra","views/email/record/row-actions/dashlet":"extra","views/email/record/panels/event":"extra","views/email/record/panels/default-side":"extra","views/email/modals/insert-field":"extra","views/email/modals/detail":"extra","views/email/modals/body-plain":"extra","views/email/modals/attachments":"extra","views/email/fields/subject":"extra","views/email/fields/select-template":"extra","views/email/fields/replies":"extra","views/email/fields/replied":"extra","views/email/fields/person-string-data-for-expanded":"extra","views/email/fields/icon":"extra","views/email/fields/has-attachment":"extra","views/email/fields/from-email-address":"extra","views/email/fields/email-address-varchar":"extra","views/email/fields/created-event":"extra","views/email/fields/create-event":"extra","views/email/fields/compose-from-address":"extra","views/email/fields/body":"extra","views/dashboard-template/detail":"extra","views/dashboard-template/record/list":"extra","views/dashboard-template/modals/deploy-to-users":"extra","views/dashboard-template/modals/deploy-to-team":"extra","views/attachment/record/list":"extra","views/attachment/record/detail":"extra","views/attachment/modals/select-one":"extra","views/attachment/modals/detail":"extra","views/attachment/fields/parent":"extra","views/attachment/fields/name":"extra","views/api-user/list":"extra","views/address-map/view":"extra","views/action-history-record/record/list":"extra","views/action-history-record/modals/detail":"extra","views/action-history-record/fields/target":"extra","views/action-history-record/fields/target-type":"extra","helpers/misc/list-select-attributes":"extra","handlers/working-time-range":"extra","handlers/import":"extra","handlers/email-filter":"extra","handlers/select-related/same-account":"extra","handlers/select-related/same-account-many":"extra","handlers/login/oidc":"extra","acl-portal/preferences":"extra","acl-portal/notification":"extra","acl-portal/email":"extra"}),Espo.layoutTemplates={record:'<% var hasHiddenPanel = false; %>\r\n\r\n<% _.each(layout, function (panel, columnNumber) { %>\r\n    <% hasHiddenPanel = panel.hidden || hasHiddenPanel; %>\r\n    <div\r\n        class="panel panel-<%= panel.style %><%= panel.label ? \' headered\' : \'\' %><%= panel.tabNumber ? \' tab-hidden\' : \'\' %><% if (panel.name) { %>{{#if hiddenPanels.<%= panel.name %>}} hidden{{/if}}<% } %>"\r\n        <% if (panel.name) print(\'data-name="\'+panel.name+\'"\') %>\r\n        <% if (panel.style) print(\'data-style="\'+panel.style+\'"\') %>\r\n        data-tab="<%= panel.tabNumber %>"\r\n    >\r\n        <% if (panel.label) { %>\r\n        <div class="panel-heading"><h4 class="panel-title"><%= panel.label %></h4></div>\r\n        <% } %>\r\n        <div class="panel-body panel-body-form">\r\n\r\n        <% var rows = panel.rows || [] %>\r\n        <% var columns = panel.columns || [] %>\r\n\r\n        <% _.each(rows, function (row, rowNumber) { %>\r\n            <div class="row">\r\n            <% var columnCount = row.length; %>\r\n            <% _.each(row, function (cell, cellNumber) { %>\r\n\r\n                <%\r\n                    var spanClassBase;\r\n                    if (columnCount === 1) {\r\n                        spanClassBase = \'col-sm-12\';\r\n                    } else if (columnCount === 2) {\r\n                        spanClassBase = \'col-sm-6\';\r\n                    } else if (columnCount === 3) {\r\n                        spanClassBase = \'col-sm-4\';\r\n                    } else if (columnCount === 4) {\r\n                        spanClassBase = \'col-md-3 col-sm-6\';\r\n                    } else {\r\n                        spanClass = \'col-sm-12\';\r\n                    }\r\n                %>\r\n                <% if (cell != false) { %>\r\n                    <%\r\n                        var spanClass;\r\n                        if (columnCount === 1 || cell.fullWidth) {\r\n                            spanClass = \'col-sm-12\';\r\n                        } else if (columnCount === 2) {\r\n                            if (cell.span === 2) {\r\n                                spanClass = \'col-sm-12\';\r\n                            } else {\r\n                                spanClass = \'col-sm-6\';\r\n                            }\r\n                        } else if (columnCount === 3) {\r\n                            if (cell.span === 2) {\r\n                                spanClass = \'col-sm-8\';\r\n                            } else if (cell.span === 3) {\r\n                                spanClass = \'col-sm-12\';\r\n                            } else {\r\n                                spanClass = \'col-sm-4\';\r\n                            }\r\n                        } else if (columnCount === 4) {\r\n                            if (cell.span === 2) {\r\n                                spanClass = \'col-sm-6\';\r\n                            } else if (cell.span === 3) {\r\n                                spanClass = \'col-sm-9\';\r\n                            } else if (cell.span === 4) {\r\n                                spanClass = \'col-sm-12\';\r\n                            } else {\r\n                                spanClass = \'col-md-3 col-sm-6\';\r\n                            }\r\n                        } else {\r\n                            spanClass = \'col-sm-12\';\r\n                        }\r\n                    %>\r\n                    <div\r\n                        class="cell <%= spanClass %> form-group<% if (cell.field) { %>{{#if hiddenFields.<%= cell.field %>}} hidden-cell{{/if}}<% } %>"\r\n                        data-name="<%= cell.field %>"\r\n                        tabindex="-1"\r\n                    >\r\n                        <% if (!cell.noLabel) { %><label class="control-label<% if (cell.field) { %>{{#if hiddenFields.<%= cell.field %>}} hidden{{/if}}<% } %>" data-name="<%= cell.field %>"><span class="label-text"><%\r\n                            if (\'customLabel\' in cell) {\r\n                                print (cell.customLabel);\r\n                            } else {\r\n                                var label = cell.label || cell.field;\r\n                                print ("{{translate \\""+label+"\\" scope=\\""+model.name+"\\" category=\'fields\'}}");\r\n                            }\r\n                        %></span></label><% } %>\r\n                        <div class="field<% if (cell.field) { %>{{#if hiddenFields.<%= cell.field %>}} hidden{{/if}}<% } %>" data-name="<%= cell.field %>"><%\r\n                            if (\'customCode\' in cell) {\r\n                                print (cell.customCode);\r\n                            } else {\r\n                                print ("{{{this."+cell.name+"}}}");\r\n                            }\r\n                        %></div>\r\n                    </div>\r\n                <% } else { %>\r\n                    <div class="<%= spanClassBase %>"></div>\r\n                <% } %>\r\n            <% }); %>\r\n            </div>\r\n        <% }); %>\r\n\r\n        <%\r\n            var columnCount = columns.length;\r\n            if (columnCount) {\r\n                %>\r\n            <div class="row">\r\n                <%\r\n            }\r\n        %>\r\n        <% _.each(columns, function (column, columnNumber) { %>\r\n            <%\r\n                var spanClass;\r\n                if (!columnCount) return;\r\n\r\n                if (columnCount === 1 || column.fullWidth) {\r\n                    spanClass = \'col-sm-12\';\r\n                } else if (columnCount === 2) {\r\n                    if (column.span === 2) {\r\n                        spanClass = \'col-sm-12\';\r\n                    } else {\r\n                        spanClass = \'col-sm-6\';\r\n                    }\r\n                } else if (columnCount === 3) {\r\n                    if (column.span === 2) {\r\n                        spanClass = \'col-sm-8\';\r\n                    } else if (column.span === 3) {\r\n                        spanClass = \'col-sm-12\';\r\n                    } else {\r\n                        spanClass = \'col-sm-4\';\r\n                    }\r\n                } else if (columnCount === 4) {\r\n                    if (column.span === 2) {\r\n                        spanClass = \'col-sm-6\';\r\n                    } else if (column.span === 3) {\r\n                        spanClass = \'col-sm-9\';\r\n                    } else if (column.span === 4) {\r\n                        spanClass = \'col-sm-12\';\r\n                    } else {\r\n                        spanClass = \'col-md-3 col-sm-6\';\r\n                    }\r\n                } else {\r\n                    spanClass = \'col-sm-12\';\r\n                }\r\n            %>\r\n            <div class="column <%= spanClass %>">\r\n                <% _.each(column, function (cell, cellNumber) { %>\r\n                    <div class="cell form-group<% if (cell.field) { %>{{#if hiddenFields.<%= cell.field %>}} hidden-cell{{/if}}<% } %>" data-name="<%= cell.field %>">\r\n                        <% if (!cell.noLabel) { %><label class="control-label<% if (cell.field) { %>{{#if hiddenFields.<%= cell.field %>}} hidden{{/if}}<% } %>" data-name="<%= cell.field %>"><span class="label-text"><%\r\n                            if (\'customLabel\' in cell) {\r\n                                print (cell.customLabel);\r\n                            } else {\r\n                                print ("{{translate \\""+cell.field+"\\" scope=\\""+model.name+"\\" category=\'fields\'}}");\r\n                            }\r\n                        %></span></label><% } %>\r\n                        <div class="field<% if (cell.field) { %>{{#if hiddenFields.<%= cell.field %>}} hidden{{/if}}<% } %>" data-name="<%= cell.field %>"><%\r\n                            if (\'customCode\' in cell) {\r\n                                print (cell.customCode);\r\n                            } else {\r\n                                print ("{{{this."+cell.name+"}}}");\r\n                            }\r\n                        %></div>\r\n                    </div>\r\n                <% }); %>\r\n            </div>\r\n        <% }); %>\r\n        <%\r\n            if (columnCount) {\r\n                %>\r\n            </div>\r\n                <%\r\n            }\r\n        %>\r\n        </div>\r\n    </div>\r\n<% }); %>\r\n\r\n<%\r\nif (hasHiddenPanel) {\r\n%>\r\n<div class="panel panel-default panels-show-more-delimiter" data-name="showMoreDelimiter" data-tab="0">\r\n    <a role="button" tabindex="0" data-action="showMoreDetailPanels" title="{{translate \'Show more\'}}">\r\n        <span class="fas fa-ellipsis-h fa-lg"></span>\r\n    </a>\r\n</div>\r\n<%\r\n}\r\n%>\r\n',"list-row":"<% _.each(layout, function (defs, key) { %>\r\n    <%\r\n        var width = null;\r\n        if (defs.options && defs.options.defs && 'width' in defs.options.defs) {\r\n            width = (defs.options.defs.width + '%') || null;\r\n        }\r\n        if (defs.options && defs.options.defs && 'widthPx' in defs.options.defs) {\r\n            width = defs.options.defs.widthPx || null;\r\n        }\r\n        var align = false;\r\n        if (defs.options && defs.options.defs) {\r\n            align = defs.options.defs.align || false;\r\n        }\r\n    %>\r\n    <td class=\"cell\" data-name=\"<%= defs.columnName %>\" <% if (width) print(' width=\"'+width+'\"'); if (align) print(' align=\"'+align+'\"'); %>>\r\n    <%\r\n            var tag = 'tag' in defs ? defs.tag : false;\r\n            if (tag) {\r\n                print( '<' + tag);\r\n                if ('id' in defs) {\r\n                    print(' id=\"'+defs.id+'\"');\r\n                }\r\n                if ('class' in defs) {\r\n                    print(' class=\"'+defs.class+'\"');\r\n                };\r\n                print('>');\r\n            }\r\n        %>{{{this.<%= defs.name %>}}}<%\r\n            if (tag) {\r\n                print( '</' + tag + '>');\r\n            }\r\n    %>\r\n    </td>\r\n<% }); %>\r\n","list-row-expanded":"<% if (layout.right) { %>\r\n<div class=\"pull-right right cell\" data-name=\"buttons\">\r\n    {{{<%= layout.right.name %>}}}\r\n</div>\r\n<% } %>\r\n<% _.each(layout.rows, function (row, key) { %>\r\n    <div class=\"expanded-row\"><% _.each(row, function (defs, key) { %>{{#ifNotEmptyHtml this.<%= defs.name %>}}<span class=\"cell\" data-name=\"<%= defs.field %>\"><%\r\n                var tag = 'tag' in defs ? defs.tag : false;\r\n                if (tag) {\r\n                    print( '<' + tag);\r\n                    if ('id' in defs) {\r\n                        print(' id=\"'+defs.id+'\"');\r\n                    }\r\n                    if ('class' in defs) {\r\n                        print(' class=\"'+defs.class+'\"');\r\n                    };\r\n                    print('>');\r\n                }\r\n            %>{{{this.<%= defs.name %>}}}<%\r\n                if (tag) {\r\n                    print( '</' + tag + '>');\r\n                }\r\n        %></span>{{/ifNotEmptyHtml}}<% }); %></div>\r\n<% }); %>\r\n",default:"<% _.each(layout, function (defs, key) {\r\n        var tag = 'tag' in defs ? defs.tag : 'div';\r\n        print( '<' + tag);\r\n        if ('id' in defs) {\r\n            print(' id=\"'+defs.id+'\"');\r\n        }\r\n        if ('class' in defs) {\r\n            print(' class=\"'+defs.class+'\"');\r\n        }\r\n        print('>');\r\n    %>\r\n        {{{this.<%= defs.name %>}}}\r\n        <%= '</' + tag + '>' %>\r\n<% }); %>\r\n","columns-2":"<% _.each(layout, function (row, rowNumber) { %>\r\n    <div class=\"col-sm-6\">\r\n    <% _.each(row, function (defs, key) { %>\r\n        <%\r\n            var tag = 'tag' in defs ? defs.tag : 'div';\r\n            print( '<' + tag);\r\n            if ('id' in defs) {\r\n                print(' id=\"'+defs.id+'\"');\r\n            }\r\n            print(' class=\"');\r\n            if ('class' in defs) {\r\n                print(defs.class);\r\n            };\r\n            print('\"');\r\n            print('>');\r\n        %>\r\n            {{{this.<%= defs.name %>}}}\r\n            <%= '</' + tag + '>' %>\r\n    <% }); %>\r\n    </div>\r\n<% }); %>\r\n"};
//# sourceMappingURL=espo-main.js.map